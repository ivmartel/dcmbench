{"version":3,"file":"dwv.min.js","mappings":"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,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC35BD,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,GACllCD,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,MAK9lCO,IAAK,CACHP,IAAKN,GAtIT,SAAyB/C,GACvB,MAAMH,EAAU,EAAJG,EACZ,OAAIH,EAAMsD,IACDA,IAEFtD,CACT,IAiIIyD,MAAOP,GAvHX,SAA0B/C,GACxB,MAAM6D,EAvCc,IAuCU,EAC9B,IAAIhE,EAAM,EACV,OAAIG,GAAK6D,IACPhE,EAAoB,GAAbG,EAAI6D,GACPhE,EAAMsD,KACDA,IAGJtD,CACT,IA8GI0D,KAAMR,GArGV,SAAyB/C,GACvB,MAAM6D,EA1Dc,IA0DU,EAC9B,IAAIhE,EAAM,EACV,OAAIG,GAAK,EAAI6D,IACXhE,EAAwB,GAAjBG,EAAI,EAAI6D,GACXhE,EAAMsD,KACDA,IAGJtD,CACT,KAgGEiE,SAAU,CACRT,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC1sCC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC58BC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,MAM12BQ,IAAK,CACHV,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC1kCC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC9lCC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,MAMrpCS,eAAgB,CACdX,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC7iCC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC19BC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,MAMxmCU,WAAY,CACVZ,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACpnCC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC3lCC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK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","sources":["webpack://dwv/webpack/bootstrap","webpack://dwv/webpack/runtime/define property getters","webpack://dwv/webpack/runtime/get javascript chunk filename","webpack://dwv/webpack/runtime/hasOwnProperty shorthand","webpack://dwv/webpack/runtime/publicPath","webpack://dwv/webpack/runtime/jsonp chunk loading","webpack://dwv/./src/math/index.js","webpack://dwv/./src/image/modalityLut.js","webpack://dwv/./src/image/windowLut.js","webpack://dwv/./src/image/luts.js","webpack://dwv/./src/utils/logger.js","webpack://dwv/./src/image/voiLut.js","webpack://dwv/./src/image/windowLevel.js","webpack://dwv/./src/utils/colour.js","webpack://dwv/./src/app/custom.js","webpack://dwv/./src/image/viewFactory.js","webpack://dwv/./src/math/vector.js","webpack://dwv/./src/math/point.js","webpack://dwv/./src/math/matrix.js","webpack://dwv/./src/image/iterator.js","webpack://dwv/./src/utils/listen.js","webpack://dwv/./src/image/rsi.js","webpack://dwv/./src/image/maskSegmentViewHelper.js","webpack://dwv/./src/image/view.js","webpack://dwv/./src/image/viewMonochrome.js","webpack://dwv/./src/image/viewPaletteColor.js","webpack://dwv/./src/image/viewRgb.js","webpack://dwv/./src/image/viewYbrFull.js","webpack://dwv/./src/utils/i18n.js","webpack://dwv/./src/utils/string.js","webpack://dwv/./src/utils/array.js","webpack://dwv/./src/dicom/dictionary.js","webpack://dwv/./src/dicom/dicomTag.js","webpack://dwv/./src/dicom/dataElement.js","webpack://dwv/./src/dicom/dataReader.js","webpack://dwv/./src/dicom/dicomParser.js","webpack://dwv/./src/image/size.js","webpack://dwv/./src/image/spacing.js","webpack://dwv/./src/math/stats.js","webpack://dwv/./src/utils/result.js","webpack://dwv/./src/image/geometry.js","webpack://dwv/./src/math/orientation.js","webpack://dwv/./src/dicom/dicomImage.js","webpack://dwv/./src/dicom/dicomManufacturer.js","webpack://dwv/./src/dicom/dicomVolume.js","webpack://dwv/./src/dicom/dicomDate.js","webpack://dwv/./src/image/imageFactory.js","webpack://dwv/./src/dicom/dicomPet.js","webpack://dwv/./src/dicom/dataWriter.js","webpack://dwv/./src/dicom/dicomWriter.js","webpack://dwv/./src/dicom/dicomCode.js","webpack://dwv/./src/dicom/dicomSegment.js","webpack://dwv/./src/dicom/dicomSegmentFrameInfo.js","webpack://dwv/./src/image/maskFactory.js","webpack://dwv/./src/utils/thread.js","webpack://dwv/./src/image/labelingThread.js","webpack://dwv/./src/image/resamplingThread.js","webpack://dwv/./src/image/image.js","webpack://dwv/./src/image/annotationGroup.js","webpack://dwv/./src/dicom/dicomMeasuredValue.js","webpack://dwv/./src/dicom/dicomNumericMeasurement.js","webpack://dwv/./src/dicom/dicomSopInstanceReference.js","webpack://dwv/./src/dicom/dicomImageReference.js","webpack://dwv/./src/math/line.js","webpack://dwv/./src/math/protractor.js","webpack://dwv/./src/math/roi.js","webpack://dwv/./src/math/circle.js","webpack://dwv/./src/math/ellipse.js","webpack://dwv/./src/math/rectangle.js","webpack://dwv/./src/dicom/dicomSpatialCoordinate.js","webpack://dwv/./src/dicom/dicomSpatialCoordinate3D.js","webpack://dwv/./src/dicom/dicomSRContent.js","webpack://dwv/./src/image/planeHelper.js","webpack://dwv/./src/image/positionHelper.js","webpack://dwv/./src/app/viewController.js","webpack://dwv/./src/gui/generic.js","webpack://dwv/./src/gui/viewLayer.js","webpack://dwv/./src/utils/undoStack.js","webpack://dwv/./src/tools/drawCommands.js","webpack://dwv/./src/app/drawController.js","webpack://dwv/./src/tools/drawBounds.js","webpack://dwv/./src/gui/style.js","webpack://dwv/./src/gui/drawLayer.js","webpack://dwv/./src/gui/infoLayer.js","webpack://dwv/./src/gui/layerGroup.js","webpack://dwv/./src/tools/scrollWheel.js","webpack://dwv/./src/tools/drawShapeEditor.js","webpack://dwv/./src/tools/drawTrash.js","webpack://dwv/./src/tools/drawShapeHandler.js","webpack://dwv/./src/tools/brush.js","webpack://dwv/./src/math/path.js","webpack://dwv/./src/math/bucketQueue.js","webpack://dwv/./src/image/scissors.js","webpack://dwv/./src/tools/labelFactory.js","webpack://dwv/./src/image/filter.js","webpack://dwv/./src/tools/filter.js","webpack://dwv/./src/tools/index.js","webpack://dwv/./src/tools/windowLevel.js","webpack://dwv/./src/tools/scroll.js","webpack://dwv/./src/tools/zoomPan.js","webpack://dwv/./src/tools/opacity.js","webpack://dwv/./src/tools/draw.js","webpack://dwv/./src/tools/floodfill.js","webpack://dwv/./src/tools/livewire.js","webpack://dwv/./src/tools/arrow.js","webpack://dwv/./src/tools/circle.js","webpack://dwv/./src/tools/ellipse.js","webpack://dwv/./src/tools/protractor.js","webpack://dwv/./src/tools/rectangle.js","webpack://dwv/./src/tools/roi.js","webpack://dwv/./src/tools/ruler.js","webpack://dwv/./src/image/annotation.js","webpack://dwv/./src/image/annotationGroupFactory.js","webpack://dwv/./src/app/dataController.js","webpack://dwv/./src/utils/operator.js","webpack://dwv/./src/gui/stage.js","webpack://dwv/./src/io/state.js","webpack://dwv/./src/utils/uri.js","webpack://dwv/./src/app/toolboxController.js","webpack://dwv/./src/utils/progress.js","webpack://dwv/./src/io/urlsLoader.js","webpack://dwv/./src/dicom/dicomDir.js","webpack://dwv/./src/image/decoder.js","webpack://dwv/./src/image/dicomBufferToData.js","webpack://dwv/./src/io/memoryLoader.js","webpack://dwv/./src/image/domReader.js","webpack://dwv/./src/io/loaderList.js","webpack://dwv/./src/io/dicomDataLoader.js","webpack://dwv/./src/io/jsonTextLoader.js","webpack://dwv/./src/io/multipartLoader.js","webpack://dwv/./src/io/rawImageLoader.js","webpack://dwv/./src/io/rawVideoLoader.js","webpack://dwv/./src/io/zipLoader.js","webpack://dwv/./src/io/filesLoader.js","webpack://dwv/./src/app/loadController.js","webpack://dwv/./src/gui/infoData.js","webpack://dwv/./src/app/application.js","webpack://dwv/./src/image/maskSegmentHelper.js","webpack://dwv/./src/image/deleteSegmentCommand.js","webpack://dwv/./src/image/changeSegmentColourCommand.js","webpack://dwv/./src/image/label.js","webpack://dwv/./src/math/scalar.js","webpack://dwv/./src/math/value.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","// This function allow to reference async chunks\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"assets/workers/\" + {\"112\":\"jpegloss.worker\",\"201\":\"resampling.worker\",\"326\":\"rle.worker\",\"391\":\"labeling.worker\",\"557\":\"jpeg2000.worker\",\"968\":\"jpegbaseline.worker\"}[chunkId] + \".min.js\";\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (typeof import.meta.url === \"string\") scriptUrl = import.meta.url\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = (typeof document !== 'undefined' && document.baseURI) || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t842: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","/**\n * Immutable index.\n * Warning: the input array is NOT cloned, modifying it will\n *  modify the index values.\n */\nexport class Index {\n\n  /**\n   * Index values.\n   *\n   * @type {number[]}\n   */\n  #values;\n\n  /**\n   * @param {number[]} values The index values.\n   */\n  constructor(values) {\n    if (!values || typeof values === 'undefined') {\n      throw new Error('Cannot create index with no values.');\n    }\n    if (values.length === 0) {\n      throw new Error('Cannot create index with empty values.');\n    }\n    const valueCheck = function (val) {\n      return !isNaN(val);\n    };\n    if (!values.every(valueCheck)) {\n      throw new Error('Cannot create index with non number values.');\n    }\n    this.#values = values;\n  }\n\n  /**\n   * Get the index value at the given array index.\n   *\n   * @param {number} i The index to get.\n   * @returns {number|undefined} The value or undefined if not in range.\n   */\n  get(i) {\n    return this.#values[i];\n  }\n\n  /**\n   * Get the length of the index.\n   *\n   * @returns {number} The length.\n   */\n  length() {\n    return this.#values.length;\n  }\n\n  /**\n   * Get a string representation of the Index.\n   *\n   * @returns {string} The Index as a string.\n   */\n  toString() {\n    return '(' + this.#values.toString() + ')';\n  }\n\n  /**\n   * Get the values of this index.\n   *\n   * @returns {number[]} The array of values.\n   */\n  getValues() {\n    return this.#values.slice();\n  }\n\n  /**\n   * Check if the input index can be compared to this one.\n   *\n   * @param {Index} rhs The index to compare to.\n   * @returns {boolean} True if both indices are comparable.\n   */\n  canCompare(rhs) {\n    // check input\n    if (!rhs) {\n      return false;\n    }\n    // check length\n    if (this.length() !== rhs.length()) {\n      return false;\n    }\n    // seems ok!\n    return true;\n  }\n\n  /**\n   * Check for Index equality.\n   *\n   * @param {Index} rhs The index to compare to.\n   * @returns {boolean} True if both indices are equal.\n   */\n  equals(rhs) {\n    // check if can compare\n    if (!this.canCompare(rhs)) {\n      return false;\n    }\n    // check values\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\n      if (this.get(i) !== rhs.get(i)) {\n        return false;\n      }\n    }\n    // seems ok!\n    return true;\n  }\n\n  /**\n   * Compare indices and return different dimensions.\n   *\n   * @param {Index} rhs The index to compare to.\n   * @returns {number[]} The list of different dimensions.\n   */\n  compare(rhs) {\n    // check if can compare\n    if (!this.canCompare(rhs)) {\n      return null;\n    }\n    // check values\n    const diffDims = [];\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\n      if (this.get(i) !== rhs.get(i)) {\n        diffDims.push(i);\n      }\n    }\n    return diffDims;\n  }\n\n  /**\n   * Add another index to this one and return\n   *   the result as a new index.\n   *\n   * @param {Index} rhs The index to add.\n   * @returns {Index} The index representing the sum of both indices.\n   */\n  add(rhs) {\n    // check if can compare\n    if (!this.canCompare(rhs)) {\n      return null;\n    }\n    // add values\n    const values = [];\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\n      values.push(this.get(i) + rhs.get(i));\n    }\n    // seems ok!\n    return new Index(values);\n  }\n\n  /**\n   * Add the input value to this index at the given\n   *   dimension number and return the result\n   *   as a new index.\n   *\n   * @param {number} dim The dimension number.\n   * @param {number} value The value to add.\n   * @returns {Index} The result index.\n   */\n  #addToDim(dim, value) {\n    const values = this.#values.slice();\n    if (dim < values.length) {\n      values[dim] += value;\n    } else {\n      console.warn('Cannot add to given dimension: ', dim, values.length);\n    }\n    return new Index(values);\n  }\n\n  /**\n   * Increment this index by 1 at the given dimension\n   *   and return the result as a new index.\n   *\n   * @param {number} dim The dimension number.\n   * @returns {Index} The result index.\n   */\n  next(dim) {\n    return this.#addToDim(dim, 1);\n  }\n\n  /**\n   * Decrement this index by 1 at the given dimension\n   *   and return the result as a new index.\n   *\n   * @param {number} dim The dimension number.\n   * @returns {Index} The result index.\n   */\n  previous(dim) {\n    return this.#addToDim(dim, -1);\n  }\n\n  /**\n   * Get the current index with a new 2D base\n   *   and return the result as a new index.\n   *\n   * @param {number} i The new 0 index.\n   * @param {number} j The new 1 index.\n   * @returns {Index} The new index.\n   */\n  getWithNew2D(i, j) {\n    const values = [i, j];\n    for (let l = 2, lenl = this.length(); l < lenl; ++l) {\n      values.push(this.get(l));\n    }\n    return new Index(values);\n  }\n\n} // Index class\n\n/**\n * Get an index with values set to 0 and the input size.\n *\n * @param {number} size The size of the index.\n * @returns {Index} The zero index.\n */\nexport function getZeroIndex(size) {\n  const values = new Array(size);\n  values.fill(0);\n  return new Index(values);\n}\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {RescaleSlopeAndIntercept} from './rsi.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Modality LUT class: compensates for any modality-specific presentation.\n * Typically consists of a rescale slope and intercept to\n * rescale the data range.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.11.html}.\n */\nexport class ModalityLut {\n\n  /**\n   * The rescale slope.\n   *\n   * @type {RescaleSlopeAndIntercept}\n   */\n  #rsi;\n\n  /**\n   * Is the RSI an identity one.\n   *\n   * @type {boolean}\n   */\n  #isIdRsi;\n\n  /**\n   * The size of the LUT array.\n   *\n   * @type {number}\n   */\n  #length;\n\n  /**\n   * The internal LUT array.\n   *\n   * @type {Float32Array}\n   */\n  #lut;\n\n  /**\n   * @param {RescaleSlopeAndIntercept} rsi The rescale slope and intercept.\n   * @param {number} bitsStored The number of bits used to store the data.\n   */\n  constructor(rsi, bitsStored) {\n    this.#rsi = rsi;\n    this.#isIdRsi = rsi.isID();\n\n    this.#length = Math.pow(2, bitsStored);\n\n    // create lut if not identity RSI\n    if (!this.#isIdRsi) {\n      this.#lut = new Float32Array(this.#length);\n      for (let i = 0; i < this.#length; ++i) {\n        this.#lut[i] = this.#rsi.apply(i);\n      }\n    }\n  }\n\n  /**\n   * Get the Rescale Slope and Intercept (RSI).\n   *\n   * @returns {RescaleSlopeAndIntercept} The rescale slope and intercept object.\n   */\n  getRSI() {\n    return this.#rsi;\n  }\n\n  /**\n   * Get the length of the LUT array.\n   *\n   * @returns {number} The length of the LUT array.\n   */\n  getLength() {\n    return this.#length;\n  }\n\n  /**\n   * Get the value of the LUT at the given offset.\n   *\n   * @param {number} offset The input offset in [0,2^bitsStored] range\n   *   or full range for ID rescale.\n   * @returns {number} The float32 value of the LUT at the given offset.\n   */\n  getValue(offset) {\n    return this.#isIdRsi ? offset : this.#lut[offset];\n  }\n\n} // class ModalityLut\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {ModalityLut} from './modalityLut.js';\nimport {VoiLut} from './voiLut.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Window LUT class: combines a modality LUT and a VOI LUT.\n */\nexport class WindowLut {\n\n  /**\n   * The modality LUT.\n   *\n   * @type {ModalityLut}\n   */\n  #modalityLut;\n\n  /**\n   * The VOI LUT.\n   *\n   * @type {VoiLut}\n   */\n  #voiLut;\n\n  /**\n   * The internal LUT array: Uint8ClampedArray clamps between 0 and 255.\n   *\n   * @type {Uint8ClampedArray}\n   */\n  #lut;\n\n  /**\n   * Shift for signed data.\n   *\n   * @type {number}\n   */\n  #signedShift = 0;\n\n  /**\n   * Is the RSI discrete.\n   *\n   * @type {boolean}\n   */\n  #isDiscrete = true;\n\n  /**\n   * Construct a window LUT object, VOI LUT is set with\n   *   the 'setVoiLut' method.\n   *\n   * @param {ModalityLut} modalityLut The associated rescale LUT.\n   * @param {boolean} isSigned Flag to know if the data is signed or not.\n   * @param {boolean} isDiscrete Flag to know if the input data is discrete.\n   */\n  constructor(modalityLut, isSigned, isDiscrete) {\n    this.#modalityLut = modalityLut;\n\n    if (isSigned) {\n      const size = this.#modalityLut.getLength();\n      this.#signedShift = size / 2;\n    } else {\n      this.#signedShift = 0;\n    }\n\n    this.#isDiscrete = isDiscrete;\n  }\n\n  /**\n   * Get the VOI LUT.\n   *\n   * @returns {VoiLut} The VOI LUT.\n   */\n  getVoiLut() {\n    return this.#voiLut;\n  }\n\n  /**\n   * Get the modality LUT.\n   *\n   * @returns {ModalityLut} The modality LUT.\n   */\n  getModalityLut() {\n    return this.#modalityLut;\n  }\n\n  /**\n   * Set the VOI LUT.\n   *\n   * @param {VoiLut} lut The VOI LUT.\n   */\n  setVoiLut(lut) {\n    // store the window values\n    this.#voiLut = lut;\n\n    // possible signed shift (LUT indices are positive)\n    this.#voiLut.setSignedOffset(\n      this.#modalityLut.getRSI().getSlope() * this.#signedShift);\n\n    // create lut if not continous\n    if (this.#isDiscrete) {\n      const size = this.#modalityLut.getLength();\n      // use clamped array (polyfilled in env.js)\n      this.#lut = new Uint8ClampedArray(size);\n      // by default WindowLevel returns a value in the [0,255] range\n      // this is ok with regular Arrays and ClampedArray.\n      for (let i = 0; i < size; ++i) {\n        this.#lut[i] = this.#voiLut.apply(this.#modalityLut.getValue(i));\n      }\n    }\n  }\n\n  /**\n   * Get the value of the LUT at the given offset.\n   *\n   * @param {number} offset The input offset in [0,2^bitsStored] range\n   *   for discrete data or full range for non discrete.\n   * @returns {number} The integer value (default [0,255]) of the LUT\n   *   at the given offset.\n   */\n  getValue(offset) {\n    if (this.#isDiscrete) {\n      return this.#lut[offset + this.#signedShift];\n    } else {\n      return Math.floor(this.#voiLut.apply(offset + this.#signedShift));\n    }\n  }\n\n} // class WindowLut\n","/**\n * Lookup tables for image colour display.\n */\n\nconst lut_range_max = 256;\n\n/**\n * Build a LUT of size lut_range_max.\n *\n * @param {Function} func The i to lut function.\n * @returns {number[]} The LUT.\n */\nfunction buildLut(func) {\n  const lut = [];\n  for (let i = 0; i < lut_range_max; ++i) {\n    lut.push(func(i));\n  }\n  return lut;\n}\n\n/**\n * Ramp to lut_range_max minus one on the first third values.\n *\n * @param {number} i The input index.\n * @returns {number} The lut value.\n */\nfunction toMaxFirstThird(i) {\n  const val = i * 3;\n  if (val > lut_range_max - 1) {\n    return lut_range_max - 1;\n  }\n  return val;\n}\n\n/**\n * Ramp to lut_range_max minus one on the second third values,\n *   otherwise return 0 for the first third and\n *   lut_range_max minus one for the last third.\n *\n * @param {number} i The input index.\n * @returns {number} The lut value.\n */\nfunction toMaxSecondThird(i) {\n  const third = lut_range_max / 3;\n  let val = 0;\n  if (i >= third) {\n    val = (i - third) * 3;\n    if (val > lut_range_max - 1) {\n      return lut_range_max - 1;\n    }\n  }\n  return val;\n}\n\n/**\n * Ramp to lut_range_max minus one on the last third values,\n *   otherwise return 0.\n *\n * @param {number} i The input index.\n * @returns {number} The lut value.\n */\nfunction toMaxThirdThird(i) {\n  const third = lut_range_max / 3;\n  let val = 0;\n  if (i >= 2 * third) {\n    val = (i - 2 * third) * 3;\n    if (val > lut_range_max - 1) {\n      return lut_range_max - 1;\n    }\n  }\n  return val;\n}\n\n/**\n * Identity, returns i.\n *\n * @param {number} i The input index.\n * @returns {number} The lut value.\n */\nfunction id(i) {\n  return i;\n}\n\n/**\n * Returns lut_range_max minus one minus i.\n *\n * @param {number} i The input index.\n * @returns {number} The lut value.\n */\nfunction invId(i) {\n  return (lut_range_max - 1) - i;\n}\n\n/**\n * Colour map: red, green and blue components\n *   to associate with intensity values.\n */\nexport class ColourMap {\n  /**\n   * Red component: 256 values in the [0, 255] range.\n   *\n   * @type {number[]}\n   */\n  red;\n  /**\n   * Green component: 256 values in the [0, 255] range.\n   *\n   * @type {number[]}\n   */\n  green;\n  /**\n   * Blue component: 256 values in the [0, 255] range.\n   *\n   * @type {number[]}\n   */\n  blue;\n\n  /**\n   * @param {number[]} red Red component.\n   * @param {number[]} green Green component.\n   * @param {number[]} blue Blue component.\n   */\n  constructor(red, green, blue) {\n    this.red = red;\n    this.green = green;\n    this.blue = blue;\n  }\n}\n\n/**\n * List of available lookup tables (lut).\n *\n * @type {Object<string, ColourMap>}\n */\nexport const luts = {\n  // plain\n  plain: {\n    red: buildLut(id),\n    green: buildLut(id),\n    blue: buildLut(id)\n  },\n\n  // inverse plain\n  invPlain: {\n    red: buildLut(invId),\n    green: buildLut(invId),\n    blue: buildLut(invId)\n  },\n\n  // rainbow\n  /* eslint-disable @stylistic/js/max-len */\n  rainbow: {\n    blue: [0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152, 156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204, 208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 255, 247, 239, 231, 223, 215, 207, 199, 191, 183, 175, 167, 159, 151, 143, 135, 127, 119, 111, 103, 95, 87, 79, 71, 63, 55, 47, 39, 31, 23, 15, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    green: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96, 104, 112, 120, 128, 136, 144, 152, 160, 168, 176, 184, 192, 200, 208, 216, 224, 232, 240, 248, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 253, 251, 249, 247, 245, 243, 241, 239, 237, 235, 233, 231, 229, 227, 225, 223, 221, 219, 217, 215, 213, 211, 209, 207, 205, 203, 201, 199, 197, 195, 193, 192, 189, 186, 183, 180, 177, 174, 171, 168, 165, 162, 159, 156, 153, 150, 147, 144, 141, 138, 135, 132, 129, 126, 123, 120, 117, 114, 111, 108, 105, 102, 99, 96, 93, 90, 87, 84, 81, 78, 75, 72, 69, 66, 63, 60, 57, 54, 51, 48, 45, 42, 39, 36, 33, 30, 27, 24, 21, 18, 15, 12, 9, 6, 3],\n    red: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 62, 60, 58, 56, 54, 52, 50, 48, 46, 44, 42, 40, 38, 36, 34, 32, 30, 28, 26, 24, 22, 20, 18, 16, 14, 12, 10, 8, 6, 4, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152, 156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204, 208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]\n  },\n  /* eslint-enable @stylistic/js/max-len */\n\n  // hot\n  hot: {\n    red: buildLut(toMaxFirstThird),\n    green: buildLut(toMaxSecondThird),\n    blue: buildLut(toMaxThirdThird)\n  },\n\n  // hot iron\n  /* eslint-disable @stylistic/js/max-len */\n  hot_iron: {\n    red: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164, 166, 168, 170, 172, 174, 176, 178, 180, 182, 184, 186, 188, 190, 192, 194, 196, 198, 200, 202, 204, 206, 208, 210, 212, 214, 216, 218, 220, 222, 224, 226, 228, 230, 232, 234, 236, 238, 240, 242, 244, 246, 248, 250, 252, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\n    green: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164, 166, 168, 170, 172, 174, 176, 178, 180, 182, 184, 186, 188, 190, 192, 194, 196, 198, 200, 202, 204, 206, 208, 210, 212, 214, 216, 218, 220, 222, 224, 226, 228, 230, 232, 234, 236, 238, 240, 242, 244, 246, 248, 250, 252, 255],\n    blue: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 84, 88, 92, 96, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152, 156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204, 208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 255]\n  },\n  /* eslint-enable @stylistic/js/max-len */\n\n  // pet\n  /* eslint-disable @stylistic/js/max-len */\n  pet: {\n    red: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164, 166, 168, 170, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\n    green: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 128, 126, 124, 122, 120, 118, 116, 114, 112, 110, 108, 106, 104, 102, 100, 98, 96, 94, 92, 90, 88, 86, 84, 82, 80, 78, 76, 74, 72, 70, 68, 66, 64, 63, 61, 59, 57, 55, 53, 51, 49, 47, 45, 43, 41, 39, 37, 35, 33, 31, 29, 27, 25, 23, 21, 19, 17, 15, 13, 11, 9, 7, 5, 3, 1, 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164, 166, 168, 170, 172, 174, 176, 178, 180, 182, 184, 186, 188, 190, 192, 194, 196, 198, 200, 202, 204, 206, 208, 210, 212, 214, 216, 218, 220, 222, 224, 226, 228, 230, 232, 234, 236, 238, 240, 242, 244, 246, 248, 250, 252, 255],\n    blue: [0, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 85, 87, 89, 91, 93, 95, 97, 99, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 201, 203, 205, 207, 209, 211, 213, 215, 217, 219, 221, 223, 225, 227, 229, 231, 233, 235, 237, 239, 241, 243, 245, 247, 249, 251, 253, 255, 252, 248, 244, 240, 236, 232, 228, 224, 220, 216, 212, 208, 204, 200, 196, 192, 188, 184, 180, 176, 172, 168, 164, 160, 156, 152, 148, 144, 140, 136, 132, 128, 124, 120, 116, 112, 108, 104, 100, 96, 92, 88, 84, 80, 76, 72, 68, 64, 60, 56, 52, 48, 44, 40, 36, 32, 28, 24, 20, 16, 12, 8, 4, 0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 68, 72, 76, 80, 85, 89, 93, 97, 101, 105, 109, 113, 117, 121, 125, 129, 133, 137, 141, 145, 149, 153, 157, 161, 165, 170, 174, 178, 182, 186, 190, 194, 198, 202, 206, 210, 214, 218, 222, 226, 230, 234, 238, 242, 246, 250, 255]\n  },\n  /* eslint-enable @stylistic/js/max-len */\n\n  // hot metal blue\n  /* eslint-disable @stylistic/js/max-len */\n  hot_metal_blue: {\n    red: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 6, 9, 12, 15, 18, 21, 24, 26, 29, 32, 35, 38, 41, 44, 47, 50, 52, 55, 57, 59, 62, 64, 66, 69, 71, 74, 76, 78, 81, 83, 85, 88, 90, 93, 96, 99, 102, 105, 108, 111, 114, 116, 119, 122, 125, 128, 131, 134, 137, 140, 143, 146, 149, 152, 155, 158, 161, 164, 166, 169, 172, 175, 178, 181, 184, 187, 190, 194, 198, 201, 205, 209, 213, 217, 221, 224, 228, 232, 236, 240, 244, 247, 251, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\n    green: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 4, 6, 8, 9, 11, 13, 15, 17, 19, 21, 23, 24, 26, 28, 30, 32, 34, 36, 38, 40, 41, 43, 45, 47, 49, 51, 53, 55, 56, 58, 60, 62, 64, 66, 68, 70, 72, 73, 75, 77, 79, 81, 83, 85, 87, 88, 90, 92, 94, 96, 98, 100, 102, 104, 105, 107, 109, 111, 113, 115, 117, 119, 120, 122, 124, 126, 128, 130, 132, 134, 136, 137, 139, 141, 143, 145, 147, 149, 151, 152, 154, 156, 158, 160, 162, 164, 166, 168, 169, 171, 173, 175, 177, 179, 181, 183, 184, 186, 188, 190, 192, 194, 196, 198, 200, 201, 203, 205, 207, 209, 211, 213, 215, 216, 218, 220, 222, 224, 226, 228, 229, 231, 233, 235, 237, 239, 240, 242, 244, 246, 248, 250, 251, 253, 255],\n    blue: [0, 2, 4, 6, 8, 10, 12, 14, 16, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 77, 79, 81, 83, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159, 161, 163, 165, 167, 169, 171, 173, 175, 177, 179, 181, 183, 184, 186, 188, 190, 192, 194, 196, 198, 200, 197, 194, 191, 188, 185, 182, 179, 176, 174, 171, 168, 165, 162, 159, 156, 153, 150, 144, 138, 132, 126, 121, 115, 109, 103, 97, 91, 85, 79, 74, 68, 62, 56, 50, 47, 44, 41, 38, 35, 32, 29, 26, 24, 21, 18, 15, 12, 9, 6, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 6, 9, 12, 15, 18, 21, 24, 26, 29, 32, 35, 38, 41, 44, 47, 50, 53, 56, 59, 62, 65, 68, 71, 74, 76, 79, 82, 85, 88, 91, 94, 97, 100, 103, 106, 109, 112, 115, 118, 121, 124, 126, 129, 132, 135, 138, 141, 144, 147, 150, 153, 156, 159, 162, 165, 168, 171, 174, 176, 179, 182, 185, 188, 191, 194, 197, 200, 203, 206, 210, 213, 216, 219, 223, 226, 229, 232, 236, 239, 242, 245, 249, 252, 255]\n  },\n  /* eslint-enable @stylistic/js/max-len */\n\n  // pet 20 step\n  /* eslint-disable @stylistic/js/max-len */\n  pet_20step: {\n    red: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\n    green: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 208, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\n    blue: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 112, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]\n  }\n  /* eslint-enable @stylistic/js/max-len */\n};\n","export const logger = {\n  /**\n   * Available log levels.\n   * Note: need to activate verbose level in\n   *   Chrome console to see DEBUG messages.\n   */\n  levels: {\n    TRACE: 0,\n    DEBUG: 1,\n    INFO: 2,\n    WARN: 3,\n    ERROR: 4\n  },\n\n  /**\n   * Logger level: default to WARN.\n   */\n  level: 3,\n\n  /**\n   * Log a trace message.\n   *\n   * @param {string} msg The message to log.\n   */\n  trace: function (msg) {\n    if (this.level <= this.levels.TRACE) {\n      console.trace(msg);\n    }\n  },\n\n  /**\n   * Log a debug message.\n   * Careful: depends on console settings.\n   *\n   * @param {string} msg The message to log.\n   */\n  debug: function (msg) {\n    if (this.level <= this.levels.DEBUG) {\n      console.debug(msg);\n    }\n  },\n\n  /**\n   * Log an info message.\n   *\n   * @param {string} msg The message to log.\n   */\n  info: function (msg) {\n    if (this.level <= this.levels.INFO) {\n      console.info(msg);\n    }\n  },\n\n  /**\n   * Log a warn message.\n   *\n   * @param {string} msg The message to log.\n   */\n  warn: function (msg) {\n    if (this.level <= this.levels.WARN) {\n      console.warn(msg);\n    }\n  },\n\n  /**\n   * Log an error message.\n   *\n   * @param {string} msg The message to log.\n   */\n  error: function (msg) {\n    if (this.level <= this.levels.ERROR) {\n      console.error(msg);\n    }\n  }\n\n}; // logger\n","import {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {WindowLevel} from './windowLevel.js';\n/* eslint-enable no-unused-vars */\n\nexport const VoiLutFunctionNames = {\n  linear: 'LINEAR',\n  linear_exact: 'LINEAR_EXACT',\n  sigmoid: 'SIGMOID'\n};\n\n/**\n * VOI LUT linear function.\n *\n * Can be default linear or linear exact.\n *\n * ```\n * if (x <= c - 0.5 - (w-1)/2) then y = ymin\n * else if (x > c - 0.5 + (w-1)/2) then y = ymax\n * else y = ((x - (c - 0.5)) / (w-1) + 0.5) * (ymax - ymin) + ymin\n * ```\n *\n * ```\n * if (x <= c - w/2), then y = ymin\n * else if (x > c + w/2), then y = ymax\n * else y = ((x - c) / w + 0.5) * (ymax- ymin) + ymin\n * ```\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.11.2.html#sect_C.11.2.1.2}.\n */\nexport class VoiLutLinearFunction {\n  /**\n   * Input value minimum.\n   *\n   * @type {number}\n   */\n  #xmin;\n\n  /**\n   * Input value maximum.\n   *\n   * @type {number}\n   */\n  #xmax;\n\n  /**\n   * Output value minimum. Defaults to 0.\n   *\n   * @type {number}\n   */\n  #ymin = 0;\n\n  /**\n   * Output value maximum. Defaults to 255.\n   *\n   * @type {number}\n   */\n  #ymax = 255;\n\n  /**\n   * Function slope.\n   *\n   * @type {number}\n   */\n  #slope;\n\n  /**\n   * Function intercept.\n   *\n   * @type {number}\n   */\n  #intercept;\n\n  /**\n   * @param {number} center The window level center.\n   * @param {number} width The window level width.\n   * @param {boolean} [isExact] Is exact flag, defaults to false.\n   */\n  constructor(center, width, isExact) {\n    if (typeof isExact === 'undefined') {\n      isExact = false;\n    }\n    // from the standard\n    let c = center;\n    let w = width;\n    if (!isExact) {\n      c -= 0.5;\n      w -= 1;\n    }\n    this.#xmin = c - (w / 2);\n    this.#xmax = c + (w / 2);\n    // pre-calculate slope and intercept\n    this.#slope = (this.#ymax - this.#ymin) / w;\n    this.#intercept = (-c / w + 0.5) *\n      (this.#ymax - this.#ymin) + this.#ymin;\n  }\n\n  /**\n   * Get the value of the function at a given number.\n   *\n   * @param {number} x The input value.\n   * @returns {number} The value of the function at x.\n   */\n  getY(x) {\n    let res;\n    if (x <= this.#xmin) {\n      res = this.#ymin;\n    } else if (x > this.#xmax) {\n      res = this.#ymax;\n    } else {\n      res = (x * this.#slope) + this.#intercept;\n    }\n    return res;\n  }\n}\n\n/**\n * VOI LUT sigmoid function.\n *\n * ```\n * y = (ymax  ymin) / (1 + exp(4 * (x  c) / w)) + ymin\n * ```\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.11.2.html#sect_C.11.2.1.2}.\n */\nexport class VoiLutSigmoidFunction {\n  /**\n   * Output value minimum. Defaults to 0.\n   *\n   * @type {number}\n   */\n  #ymin = 0;\n\n  /**\n   * Output value maximum. Defaults to 255.\n   *\n   * @type {number}\n   */\n  #ymax = 255;\n\n  /**\n   * Window level center.\n   *\n   * @type {number}\n   */\n  #center;\n\n  /**\n   * Window level width.\n   *\n   * @type {number}\n   */\n  #width;\n\n  /**\n   * @param {number} center The window level center.\n   * @param {number} width The window level width.\n   */\n  constructor(center, width) {\n    this.#center = center;\n    this.#width = width;\n  }\n\n  /**\n   * Get the value of the function at a given number.\n   *\n   * @param {number} x The input value.\n   * @returns {number} The value of the function at x.\n   */\n  getY(x) {\n    return ((this.#ymax - this.#ymin) /\n      (1 + Math.exp(-4 * (x - this.#center) / this.#width))) +\n      this.#ymin;\n  }\n}\n\n/**\n * VOI (Values of Interest) LUT class: apply window centre and width\n * using a VOI LUT function.\n */\nexport class VoiLut {\n\n  /**\n   * The window and level.\n   *\n   * @type {WindowLevel}\n   */\n  #windowLevel;\n\n  /**\n   * Signed data offset. Defaults to 0.\n   *\n   * @type {number}\n   */\n  #signedOffset = 0;\n\n  /**\n   * VOI LUT function.\n   *\n   * @type {VoiLutLinearFunction|VoiLutSigmoidFunction}\n   */\n  #voiLutFunction;\n\n  /**\n   * VOI LUT function name.\n   *\n   * @type {string}\n   */\n  #voiLutFunctionName = VoiLutFunctionNames.linear;\n\n  /**\n   * @param {WindowLevel} wl The window center and width.\n   * @param {string} [voiLutFunctionName] The name of the VOI LUT function,\n   *   defaults to 'LINEAR'.\n   */\n  constructor(wl, voiLutFunctionName) {\n    this.#windowLevel = wl;\n\n    if (typeof voiLutFunctionName !== 'undefined') {\n      // valid name check\n      const names = [];\n      for (const key in VoiLutFunctionNames) {\n        names.push(VoiLutFunctionNames[key]);\n      }\n      if (names.includes(voiLutFunctionName)) {\n        this.#voiLutFunctionName = voiLutFunctionName;\n      } else {\n        logger.debug('Unknown VOI LUT function: ' + voiLutFunctionName);\n      }\n    }\n\n    this.#init();\n  }\n\n  /**\n   * Get the window and level.\n   *\n   * @returns {WindowLevel} The window center and width.\n   */\n  getWindowLevel() {\n    return this.#windowLevel;\n  }\n\n  /**\n   * Initialise members. Called at construction.\n   */\n  #init() {\n    const center = this.#windowLevel.center;\n    const width = this.#windowLevel.width;\n    const c = center + this.#signedOffset;\n\n    if (this.#voiLutFunctionName === VoiLutFunctionNames.linear_exact) {\n      this.#voiLutFunction = new VoiLutLinearFunction(c, width, true);\n    } else if (this.#voiLutFunctionName === VoiLutFunctionNames.sigmoid) {\n      this.#voiLutFunction = new VoiLutSigmoidFunction(c, width);\n    } else {\n      // default case\n      this.#voiLutFunction = new VoiLutLinearFunction(c, width);\n    }\n  }\n\n  /**\n   * Set the signed offset.\n   *\n   * @param {number} offset The signed data offset,\n   *   typically: slope * ( size / 2).\n   */\n  setSignedOffset(offset) {\n    this.#signedOffset = offset;\n    // re-initialise\n    this.#init();\n  }\n\n  /**\n   * Apply the window level on an input value.\n   *\n   * @param {number} value The value to rescale as an integer.\n   * @returns {number} The leveled value, in the [0,255] range.\n   */\n  apply(value) {\n    return this.#voiLutFunction.getY(value);\n  }\n\n} // class VoiLut\n","import {VoiLutFunctionNames} from './voiLut.js';\n\n/**\n * Window and Level also known as window width and center.\n */\nexport class WindowLevel {\n  /**\n   * The window center.\n   *\n   * @type {number}\n   */\n  center;\n\n  /**\n   * The window width.\n   *\n   * @type {number}\n   */\n  width;\n\n  /**\n   * @param {number} center The window center.\n   * @param {number} width The window width.\n   */\n  constructor(center, width) {\n    this.center = center;\n    this.width = width;\n  }\n\n} // WindowLevel class\n\n/**\n * Check for window level equality.\n *\n * @param {WindowLevel} wl0 The first window level.\n * @param {WindowLevel} wl1 The second window level.\n * @returns {boolean} True if both objects are equal.\n */\nexport function equalWl(wl0, wl1) {\n  return wl0 !== null &&\n    typeof wl0 !== 'undefined' &&\n    wl1 !== null &&\n    typeof wl1 !== 'undefined' &&\n    wl0.center === wl1.center &&\n    wl0.width === wl1.width;\n}\n\n/**\n * Validate and constrain an input window level.\n *\n * @param {WindowLevel} wl The window level to validate.\n * @param {object} range The image pixel data range.\n * @param {string} [voiLutFunctionName] The VOI LUT function name,\n *   defaults to 'LINEAR'.\n * @returns {WindowLevel|undefined} A valid window level.\n */\nexport function validateWindowLevel(\n  wl,\n  range,\n  voiLutFunctionName\n) {\n  if (typeof wl === 'undefined') {\n    return;\n  }\n\n  let centerBound = wl.center;\n  centerBound = Math.min(centerBound, range.max);\n  centerBound = Math.max(centerBound, range.min);\n\n  // width minimum depends on voi lut function\n  // see https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.11.2.html#sect_C.11.2.1\n  // (use linear min as default)\n  let minWindowWidth = 1;\n  if (typeof voiLutFunctionName !== 'undefined' &&\n    (voiLutFunctionName === VoiLutFunctionNames.linear_exact ||\n      voiLutFunctionName === VoiLutFunctionNames.sigmoid)) {\n    minWindowWidth = 0;\n  }\n\n  let widthBound = wl.width;\n  widthBound = Math.max(widthBound, minWindowWidth);\n  widthBound = Math.min(widthBound, range.max - range.min);\n\n  return new WindowLevel(centerBound, widthBound);\n}\n","// example implementation: dcmtk/dcmiod/libsrc/cielabutil.cc\n// https://github.com/DCMTK/dcmtk/blob/DCMTK-3.6.6/dcmiod/libsrc/cielabutil.cc\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Scalar3D} from '../math/scalar.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * RGB colour class.\n */\nexport class RGB {\n  /**\n   * Red component.\n   *\n   * @type {number}\n   */\n  r;\n  /**\n   * Green component.\n   *\n   * @type {number}\n   */\n  g;\n  /**\n   * Blue component.\n   *\n   * @type {number}\n   */\n  b;\n  /**\n   * @param {number} r Red component.\n   * @param {number} g Green component.\n   * @param {number} b Blue component.\n   */\n  constructor(r, g, b) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n  }\n}\n\n/**\n * Check if two rgb objects are equal.\n *\n * @param {RGB} c1 The first colour.\n * @param {RGB} c2 The second colour.\n * @returns {boolean} True if both colour are equal.\n */\nexport function isEqualRgb(c1, c2) {\n  return c1 !== null &&\n    c2 !== null &&\n    typeof c1 !== 'undefined' &&\n    typeof c2 !== 'undefined' &&\n    c1.r === c2.r &&\n    c1.g === c2.g &&\n    c1.b === c2.b;\n}\n\n/**\n * Convert YBR to RGB.\n *\n * Ref:\n * - {@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.7.6.3.html#sect_C.7.6.3.1.2},\n * - {@link https://en.wikipedia.org/wiki/YCbCr#JPEG_conversion}.\n *\n * @param {number} y The Y component.\n * @param {number} cb The Cb component.\n * @param {number} cr The Cr component.\n * @returns {RGB} RGB equivalent as {r,g,b}.\n */\nexport function ybrToRgb(y, cb, cr) {\n  return {\n    r: y + 1.402 * (cr - 128),\n    g: y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128),\n    b: y + 1.772 * (cb - 128)\n  };\n}\n\n/**\n * Convert a hex color into RGB.\n *\n * @param {string} hexStr The hex color as '#ab01ef'.\n * @returns {RGB} The RGB values as {r,g,b}.\n */\nexport function hexToRgb(hexStr) {\n  return {\n    r: parseInt(hexStr.substring(1, 3), 16),\n    g: parseInt(hexStr.substring(3, 5), 16),\n    b: parseInt(hexStr.substring(5, 7), 16)\n  };\n}\n\n/**\n * Convert RGB to its hex equivalent.\n *\n * @param {RGB} rgb The RGB object as {r,g,b}.\n * @returns {string} A string representing the hex color as '#ab01ef'.\n */\nexport function rgbToHex(rgb) {\n  return '#' +\n    ((1 << 24) + (rgb.r << 16) + (rgb.g << 8) + rgb.b).toString(16).slice(1);\n}\n\n/**\n * Get the brightness of a RGB colour: calculates\n * the luma (Y) of the YIQ colour space.\n *\n * Ref: {@link https://en.wikipedia.org/wiki/YIQ#From_RGB_to_YIQ}.\n *\n * @param {RGB} rgb RGB triplet.\n * @returns {number} The brightness ([0,1]).\n */\nexport function getBrightness(rgb) {\n  // 0.001172549 = 0.299 / 255\n  // 0.002301961 = 0.587 / 255\n  // 0.000447059 = 0.114 / 255\n  return rgb.r * 0.001172549 +\n    rgb.g * 0.002301961 +\n    rgb.b * 0.000447059;\n}\n\n/**\n * Check if a colour given in hexadecimal format is dark.\n *\n * @param {string} hexColour The colour (as '#ab01ef').\n * @returns {boolean} True if the colour is dark (brightness < 0.5).\n */\nexport function isDarkColour(hexColour) {\n  return getBrightness(hexToRgb(hexColour)) < 0.5;\n}\n\n/**\n * Get the shadow colour of an input colour.\n *\n * @param {string} hexColour The colour (as '#ab01ef').\n * @returns {string} The shadow colour (white or black).\n */\nexport function getShadowColour(hexColour) {\n  return isDarkColour(hexColour) ? '#fff' : '#000';\n}\n\n/**\n * Unsigned int CIE LAB value ([0, 65535]) to CIE LAB value\n *   (L: [0, 100], a: [-128, 127], b: [-128, 127]).\n *\n * @param {object} triplet CIE LAB triplet as {l,a,b} with unsigned range.\n * @returns {object} CIE LAB triplet as {l,a,b} with CIE LAB range.\n */\nexport function uintLabToLab(triplet) {\n  // 0.001525902 = 100 / 65535\n  // 0.003891051 = 255 / 65535\n  return {\n    l: 0.001525902 * triplet.l,\n    a: 0.003891051 * triplet.a - 128,\n    b: 0.003891051 * triplet.b - 128,\n  };\n}\n\n/**\n * CIE LAB value (L: [0, 100], a: [-128, 127], b: [-128, 127]) to\n *   unsigned int CIE LAB ([0, 65535]).\n *\n * @param {object} triplet CIE XYZ triplet as {l,a,b} with CIE LAB range.\n * @returns {object} CIE LAB triplet as {l,a,b} with unsigned range.\n */\nexport function labToUintLab(triplet) {\n  // 655.35 = 65535 / 100\n  // aUint = (a + 128) * 65535 / 255\n  // 257 = 65535 / 255\n  // 32896 = 257 * 128\n  return {\n    l: 655.35 * triplet.l,\n    a: 257 * triplet.a + 32896,\n    b: 257 * triplet.b + 32896,\n  };\n}\n\n/**\n * CIE Standard Illuminant D65, standard 2 observer.\n *\n * Ref: {@link https://en.wikipedia.org/wiki/Illuminant_D65}.\n */\nconst d65 = {\n  x: 95.0489,\n  y: 100,\n  z: 108.884\n};\n\n/**\n * Convert CIE LAB to CIE XYZ (standard illuminant D65, 2degree 1931).\n *\n * Ref: {@link https://en.wikipedia.org/wiki/CIELAB_color_space#From_CIELAB_to_CIEXYZ}.\n *\n * @param {object} triplet CIE LAB triplet as {l,a,b}.\n * @returns {Scalar3D} CIE XYZ triplet as {x,y,z}.\n */\nexport function cielabToCiexyz(triplet) {\n  /**\n   * Apply the inverse lab function.\n   *\n   * @param {number} x The input value.\n   * @returns {number} The result.\n   */\n  function invLabFunc(x) {\n    let res = null;\n    // delta = 6 / 29 = 0.206896552\n    if (x > 0.206896552) {\n      res = Math.pow(x, 3);\n    } else {\n      // 0.128418549 = 3 * delta^2\n      // 0.017712903 = 3 * delta^2 * (4 / 29)\n      res = 0.128418549 * x - 0.017712903;\n    }\n    return res;\n  }\n\n  const illuminant = d65;\n  const l0 = (triplet.l + 16) / 116;\n\n  return {\n    x: illuminant.x * invLabFunc(l0 + triplet.a / 500),\n    y: illuminant.y * invLabFunc(l0),\n    z: illuminant.z * invLabFunc(l0 - triplet.b / 200)\n  };\n}\n\n/**\n * Convert CIE XYZ to CIE LAB (standard illuminant D65, 2degree 1931).\n *\n * Ref: {@link https://en.wikipedia.org/wiki/CIELAB_color_space#From_CIEXYZ_to_CIELAB}.\n *\n * @param {Scalar3D} triplet CIE XYZ triplet as {x,y,z}.\n * @returns {object} CIE LAB triplet as {l,a,b}.\n */\nexport function ciexyzToCielab(triplet) {\n  /**\n   * Apply the lab function.\n   *\n   * @param {number} x The input value.\n   * @returns {number} The result.\n   */\n  function labFunc(x) {\n    let res = null;\n    // delta = 6 / 29 = 0.206896552\n    // delta^3 = 0.008856452\n    if (x > 0.008856452) {\n      res = Math.pow(x, 0.333333333);\n    } else {\n      // 7.787037037 = 1 / 3 * delta^2\n      // 0.137931034 = 4 / 29\n      res = 7.787037037 * x + 0.137931034;\n    }\n    return res;\n  }\n\n  const illuminant = d65;\n  const fy = labFunc(triplet.y / illuminant.y);\n\n  return {\n    l: 116 * fy - 16,\n    a: 500 * (labFunc(triplet.x / illuminant.x) - fy),\n    b: 200 * (fy - labFunc(triplet.z / illuminant.z))\n  };\n}\n\n/**\n * Convert CIE XYZ to sRGB.\n *\n * Ref: {@link https://en.wikipedia.org/wiki/SRGB#From_CIE_XYZ_to_sRGB}.\n *\n * @param {Scalar3D} triplet CIE XYZ triplet as {x,y,z}.\n * @returns {RGB} 'sRGB' triplet as {r,g,b}.\n */\nexport function ciexyzToSrgb(triplet) {\n  /**\n   * Apply the gamma function.\n   *\n   * @param {number} x The input value.\n   * @returns {number} The result.\n   */\n  function gammaFunc(x) {\n    let res = null;\n    if (x <= 0.0031308) {\n      res = 12.92 * x;\n    } else {\n      // 0.416666667 = 1 / 2.4\n      res = 1.055 * Math.pow(x, 0.416666667) - 0.055;\n    }\n    // clip [0,1]\n    return Math.min(1, Math.max(0, res));\n  }\n\n  const x = triplet.x / 100;\n  const y = triplet.y / 100;\n  const z = triplet.z / 100;\n\n  return {\n    r: Math.round(255 * gammaFunc(3.2406 * x - 1.5372 * y - 0.4986 * z)),\n    g: Math.round(255 * gammaFunc(-0.9689 * x + 1.8758 * y + 0.0415 * z)),\n    b: Math.round(255 * gammaFunc(0.0557 * x - 0.2040 * y + 1.0570 * z))\n  };\n}\n\n/**\n * Convert sRGB to CIE XYZ.\n *\n * Ref: {@link https://en.wikipedia.org/wiki/SRGB#From_sRGB_to_CIE_XYZ}.\n *\n * @param {RGB} triplet 'sRGB' triplet as {r,g,b}.\n * @returns {Scalar3D} CIE XYZ triplet as {x,y,z}.\n */\nexport function srgbToCiexyz(triplet) {\n  /**\n   * Apply the inverse gamma function.\n   *\n   * @param {number} x The input value.\n   * @returns {number} The result.\n   */\n  function invGammaFunc(x) {\n    let res = null;\n    if (x <= 0.04045) {\n      res = x / 12.92;\n    } else {\n      res = Math.pow((x + 0.055) / 1.055, 2.4);\n    }\n    return res;\n  }\n\n  const rl = invGammaFunc(triplet.r / 255);\n  const gl = invGammaFunc(triplet.g / 255);\n  const bl = invGammaFunc(triplet.b / 255);\n\n  return {\n    x: 100 * (0.4124 * rl + 0.3576 * gl + 0.1805 * bl),\n    y: 100 * (0.2126 * rl + 0.7152 * gl + 0.0722 * bl),\n    z: 100 * (0.0193 * rl + 0.1192 * gl + 0.9505 * bl)\n  };\n}\n\n/**\n * Convert CIE LAB to sRGB (standard illuminant D65).\n *\n * @param {object} triplet CIE LAB triplet as {l,a,b}.\n * @returns {RGB} 'sRGB' triplet as {r,g,b}.\n */\nexport function cielabToSrgb(triplet) {\n  return ciexyzToSrgb(cielabToCiexyz(triplet));\n}\n\n/**\n * Convert sRGB to CIE LAB (standard illuminant D65).\n *\n * @param {RGB} triplet 'sRGB' triplet as {r,g,b}.\n * @returns {object} CIE LAB triplet as {l,a,b}.\n */\nexport function srgbToCielab(triplet) {\n  return ciexyzToCielab(srgbToCiexyz(triplet));\n}\n\n/**\n * Get the hex code of a string colour for a colour used in pre dwv v0.17.\n *\n * @param {string} name The name of a colour.\n * @returns {string} The hex representing the colour.\n */\nexport function colourNameToHex(name) {\n  // default colours used in dwv version < 0.17\n  const dict = {\n    Yellow: '#ffff00',\n    Red: '#ff0000',\n    White: '#ffffff',\n    Green: '#008000',\n    Blue: '#0000ff',\n    Lime: '#00ff00',\n    Fuchsia: '#ff00ff',\n    Black: '#000000'\n  };\n  let res = '#ffff00';\n  if (typeof dict[name] !== 'undefined') {\n    res = dict[name];\n  }\n  return res;\n}\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {WindowLevel} from '../image/windowLevel.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Overridalbe custom object for client defined items.\n */\nexport const custom = {\n  /**\n   * List of default window level presets. Indexed bu modality\n   * and then by preset name. For example `wlPresets.MR.mediastimun`.\n   * No need to redefine all, just overrides is enough. Defaults\n   * are used if `custom.wlPresets[modality]` is undefined.\n   *\n   * @type {Object.<string, Object.<string, WindowLevel>>}\n   */\n  wlPresets: undefined,\n\n  /**\n   * List of default shape label texts. Indexed by shape name\n   * and then by modality. For example `labelTexts.arrow.MR`.\n   * No need to redefine all, just overrides is enough. Defaults\n   * are used if `custom.labelTexts[shapeName]` is undefined.\n   *\n   * @type {Object.<string, Object.<string, string>>}\n   */\n  labelTexts: undefined,\n\n  /**\n   * List of private diffusion b-value rules. Rules are either\n   * `{manufacturer, key}` or `{uidPrefix, key}`. For example:\n   * `{manufacturer: 'GE', key: '00431039'}`.\n   *\n   * @type {object[]}\n   */\n  privateBValueRules: undefined,\n\n  /**\n   * Open a dialogue to edit roi data. Defaults to window.prompt.\n   *\n   * @param {Annotation} annotation The roi data.\n   * @param {Function} callback The callback to launch on dialogue exit.\n   */\n  openRoiDialog: undefined,\n\n  /**\n   * Get the volume id from a list of dicom tags.\n   *\n   * @param {Object<string, DataElement>} elements The DICOM elements.\n   * @returns {number|undefined} The id value if available.\n   */\n  getVolumeIdTagValue: undefined,\n\n  /**\n   * Get the volume id from a list of dicom tags parsed after load finishes.\n   *\n   * @param {Object<string, DataElement>} elements The DICOM elements.\n   * @returns {number|undefined} The id value if available.\n   */\n  getPostLoadVolumeIdTagValue: undefined,\n\n  /**\n   * Get the pixel data unit from a list of dicom tags.\n   * Not used for PET data with SUV values.\n   *\n   * @param {Object<string, DataElement>} elements The DICOM elements.\n   * @returns {string|undefined} The unit value if available.\n   */\n  getTagPixelUnit: undefined,\n\n};","import {custom} from '../app/custom.js';\nimport {View} from './view.js';\nimport {WindowLevel} from './windowLevel.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Image} from './image.js';\nimport {DataElement} from '../dicom/dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * List of default window level presets.\n *\n * @type {Object.<string, Object.<string, WindowLevel>>}\n */\nconst defaultWlPresets = {\n  CT: {\n    mediastinum: new WindowLevel(40, 400),\n    lung: new WindowLevel(-500, 1500),\n    bone: new WindowLevel(500, 2000),\n    brain: new WindowLevel(40, 80),\n    head: new WindowLevel(90, 350)\n  }\n};\n\n/**\n * {@link View} factory.\n */\nexport class ViewFactory {\n\n  /**\n   * Get an View object from the read DICOM file.\n   *\n   * @param {Object<string, DataElement>} dataElements The DICOM tags.\n   * @param {Image} image The associated image.\n   * @returns {View} The new View.\n   */\n  create(dataElements, image) {\n    // view\n    const view = new View(image);\n\n    // default color map\n    if (image.getPhotometricInterpretation() === 'MONOCHROME1') {\n      view.setColourMap('invPlain');\n    }\n\n    // window level presets\n    let windowPresets = {};\n    // image presets\n    if (typeof image.getMeta().windowPresets !== 'undefined') {\n      windowPresets = image.getMeta().windowPresets;\n    }\n    // min/max\n    // Not filled yet since it is stil too costly to calculate min/max\n    // for each slice... It will be filled at first use\n    // (see view.setWindowLevelPreset).\n    // Order is important, if no wl from DICOM, this will be the default.\n    windowPresets.minmax = {name: 'minmax'};\n    // optional modality presets\n    const modality = image.getMeta().Modality;\n    let wlPresets;\n    if (typeof custom.wlPresets !== 'undefined' &&\n      typeof custom.wlPresets[modality] !== 'undefined') {\n      wlPresets = custom.wlPresets[modality];\n    } else {\n      wlPresets = defaultWlPresets[modality];\n    }\n    for (const key in wlPresets) {\n      const preset = wlPresets[key];\n      windowPresets[key] = {\n        wl: [new WindowLevel(preset.center, preset.width)],\n        name: key\n      };\n    }\n\n    // store\n    view.setWindowPresets(windowPresets);\n\n    return view;\n  }\n\n} // class ViewFactory\n","/**\n * Immutable 3D vector.\n */\nexport class Vector3D {\n\n  /**\n   * X coordinate.\n   *\n   * @type {number}\n   */\n  #x;\n\n  /**\n   * Y coordinate.\n   *\n   * @type {number}\n   */\n  #y;\n\n  /**\n   * Z coordinate.\n   *\n   * @type {number}\n   */\n  #z;\n\n  /**\n   * @param {number} x The X component of the vector.\n   * @param {number} y The Y component of the vector.\n   * @param {number} z The Z component of the vector.\n   */\n  constructor(x, y, z) {\n    this.#x = x;\n    this.#y = y;\n    this.#z = z;\n  }\n\n  /**\n   * Get the X component of the vector.\n   *\n   * @returns {number} The X component of the vector.\n   */\n  getX() {\n    return this.#x;\n  }\n\n  /**\n   * Get the Y component of the vector.\n   *\n   * @returns {number} The Y component of the vector.\n   */\n  getY() {\n    return this.#y;\n  }\n\n  /**\n   * Get the Z component of the vector.\n   *\n   * @returns {number} The Z component of the vector.\n   */\n  getZ() {\n    return this.#z;\n  }\n\n  /**\n   * Check for Vector3D equality.\n   *\n   * @param {Vector3D} rhs The other vector to compare to.\n   * @returns {boolean} True if both vectors are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      this.#x === rhs.getX() &&\n      this.#y === rhs.getY() &&\n      this.#z === rhs.getZ();\n  }\n\n  /**\n   * Get a string representation of the Vector3D.\n   *\n   * @returns {string} The vector as a string.\n   */\n  toString() {\n    return '(' + this.#x +\n      ', ' + this.#y +\n      ', ' + this.#z + ')';\n  }\n\n  /**\n   * Get the norm of the vector.\n   *\n   * @returns {number} The norm.\n   */\n  norm() {\n    return Math.sqrt(\n      (this.#x * this.#x) +\n      (this.#y * this.#y) +\n      (this.#z * this.#z)\n    );\n  }\n\n  /**\n   * Get the cross product with another Vector3D, ie the\n   * vector that is perpendicular to both a and b.\n   * If both vectors are parallel, the cross product is a zero vector.\n   *\n   * Ref: {@link https://en.wikipedia.org/wiki/Cross_product}.\n   *\n   * @param {Vector3D} vector3D The input vector.\n   * @returns {Vector3D} The result vector.\n   */\n  crossProduct(vector3D) {\n    return new Vector3D(\n      (this.#y * vector3D.getZ()) - (vector3D.getY() * this.#z),\n      (this.#z * vector3D.getX()) - (vector3D.getZ() * this.#x),\n      (this.#x * vector3D.getY()) - (vector3D.getX() * this.#y));\n  }\n\n  /**\n   * Get the dot product with another Vector3D.\n   *\n   * Ref: {@link https://en.wikipedia.org/wiki/Dot_product}.\n   *\n   * @param {Vector3D} vector3D The input vector.\n   * @returns {number} The dot product.\n   */\n  dotProduct(vector3D) {\n    return (this.#x * vector3D.getX()) +\n      (this.#y * vector3D.getY()) +\n      (this.#z * vector3D.getZ());\n  }\n\n  /**\n   * Is this vector codirectional to an input one.\n   *\n   * @param {Vector3D} vector3D The vector to test.\n   * @returns {boolean} True if codirectional, false is opposite.\n   */\n  isCodirectional(vector3D) {\n    // a.dot(b) = ||a|| * ||b|| * cos(theta)\n    // (https://en.wikipedia.org/wiki/Dot_product#Geometric_definition)\n    // -> the sign of the dot product depends on the cosinus of\n    //    the angle between the vectors\n    //   -> >0 => vectors are codirectional\n    //   -> <0 => vectors are opposite\n    return this.dotProduct(vector3D) > 0;\n  }\n\n} // Vector3D class","import {isSimilar} from './matrix.js';\nimport {Vector3D} from './vector.js';\n\n/**\n * Immutable 2D point.\n */\nexport class Point2D {\n\n  /**\n   * X position.\n   *\n   * @type {number}\n   */\n  #x;\n\n  /**\n   * Y position.\n   *\n   * @type {number}\n   */\n  #y;\n\n  /**\n   * @param {number} x The X coordinate for the point.\n   * @param {number} y The Y coordinate for the point.\n   */\n  constructor(x, y) {\n    this.#x = x;\n    this.#y = y;\n  }\n\n  /**\n   * Get the X position of the point.\n   *\n   * @returns {number} The X position of the point.\n   */\n  getX() {\n    return this.#x;\n  }\n\n  /**\n   * Get the Y position of the point.\n   *\n   * @returns {number} The Y position of the point.\n   */\n  getY() {\n    return this.#y;\n  }\n\n  /**\n   * Get the values of this point.\n   *\n   * @returns {number[]} The array of values.\n   */\n  getValues() {\n    return [this.#x, this.#y];\n  }\n\n  /**\n   * Get the centroid of the point, ie itself.\n   *\n   * @returns {Point2D} The centroid point.\n   */\n  getCentroid() {\n    return this;\n  }\n\n  /**\n   * Check for Point2D equality.\n   *\n   * @param {Point2D} rhs The other point to compare to.\n   * @returns {boolean} True if both points are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      typeof rhs !== 'undefined' &&\n      this.#x === rhs.getX() &&\n      this.#y === rhs.getY();\n  }\n\n  /**\n   * Get a string representation of the Point2D.\n   *\n   * @returns {string} The point as a string.\n   */\n  toString() {\n    return '(' + this.#x + ', ' + this.#y + ')';\n  }\n\n  /**\n   * Get the distance to another Point2D.\n   *\n   * @param {Point2D} point2D The input point.\n   * @returns {number} Ths distance to the input point.\n   */\n  getDistance(point2D) {\n    const dx = this.#x - point2D.getX();\n    const dy = this.#y - point2D.getY();\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n} // Point2D class\n\n/**\n * Immutable 3D point.\n */\nexport class Point3D {\n\n  /**\n   * X position.\n   *\n   * @type {number}\n   */\n  #x;\n\n  /**\n   * Y position.\n   *\n   * @type {number}\n   */\n  #y;\n\n  /**\n   * Z position.\n   *\n   * @type {number}\n   */\n  #z;\n\n  /**\n   * @param {number} x The X coordinate for the point.\n   * @param {number} y The Y coordinate for the point.\n   * @param {number} z The Z coordinate for the point.\n   */\n  constructor(x, y, z) {\n    this.#x = x;\n    this.#y = y;\n    this.#z = z;\n  }\n\n  /**\n   * Get the X position of the point.\n   *\n   * @returns {number} The X position of the point.\n   */\n  getX() {\n    return this.#x;\n  }\n\n  /**\n   * Get the Y position of the point.\n   *\n   * @returns {number} The Y position of the point.\n   */\n  getY() {\n    return this.#y;\n  }\n\n  /**\n   * Get the Z position of the point.\n   *\n   * @returns {number} The Z position of the point.\n   */\n  getZ() {\n    return this.#z;\n  }\n\n  /**\n   * Get the values of this point.\n   *\n   * @returns {number[]} The array of values.\n   */\n  getValues() {\n    return [this.#x, this.#y, this.#z];\n  }\n\n  /**\n   * Check for Point3D equality.\n   *\n   * @param {Point3D} rhs The other point to compare to.\n   * @returns {boolean} True if both points are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      this.#x === rhs.getX() &&\n      this.#y === rhs.getY() &&\n      this.#z === rhs.getZ();\n  }\n\n  /**\n   * Check for Point3D similarity.\n   *\n   * @param {Point3D} rhs The other point to compare to.\n   * @param {number} [tol] Optional number comparison tolerance,\n   *   defaults to Number.EPSILON.\n   * @returns {boolean} True if both points are similar.\n   */\n  isSimilar(rhs, tol) {\n    return rhs !== null &&\n      isSimilar(this.#x, rhs.getX(), tol) &&\n      isSimilar(this.#y, rhs.getY(), tol) &&\n      isSimilar(this.#z, rhs.getZ(), tol);\n  }\n\n  /**\n   * Get a string representation of the Point3D.\n   *\n   * @returns {string} The point as a string.\n   */\n  toString() {\n    return '(' + this.#x +\n      ', ' + this.#y +\n      ', ' + this.#z + ')';\n  }\n\n  /**\n   * Get the distance to another Point3D.\n   *\n   * @param {Point3D} point3D The input point.\n   * @returns {number} Ths distance to the input point.\n   */\n  getDistance(point3D) {\n    return Math.sqrt(this.#getSquaredDistance(point3D));\n  }\n\n  /**\n   * Get the square of the distance between this and\n   * an input point. Used for sorting.\n   *\n   * @param {Point3D} point3D The input point.\n   * @returns {number} The square of the distance.\n   */\n  #getSquaredDistance(point3D) {\n    const dx = this.#x - point3D.getX();\n    const dy = this.#y - point3D.getY();\n    const dz = this.#z - point3D.getZ();\n    return dx * dx + dy * dy + dz * dz;\n  }\n\n  /**\n   * Get the closest point to this in a Point3D list.\n   *\n   * @param {Point3D[]} pointList The list to check.\n   * @returns {number} The index of the closest point in the input list.\n   */\n  getClosest(pointList) {\n    let minIndex = 0;\n    // the order between squared distances and distances is the same\n    let minDist = this.#getSquaredDistance(pointList[minIndex]);\n    for (let i = 0; i < pointList.length; ++i) {\n      const dist = this.#getSquaredDistance(pointList[i]);\n      if (dist < minDist) {\n        minIndex = i;\n        minDist = dist;\n      }\n    }\n    return minIndex;\n  }\n\n  /**\n   * Get the difference to another Point3D.\n   *\n   * @param {Point3D} point3D The input point.\n   * @returns {Vector3D} The 3D vector from the input point to this one.\n   */\n  minus(point3D) {\n    return new Vector3D(\n      (this.#x - point3D.getX()),\n      (this.#y - point3D.getY()),\n      (this.#z - point3D.getZ()));\n  }\n\n} // Point3D class\n\n/**\n * Get an array find callback for an equal input point.\n *\n * @param {Point3D} point The point to compare to.\n * @returns {Function} A function that compares, using `equals`,\n *   its input point to the one given as input to this function.\n */\nexport function getEqualPoint3DFunction(point) {\n  return function (element) {\n    return element.equals(point);\n  };\n}\n\n/**\n * Immutable point.\n * Warning: the input array is NOT cloned, modifying it will\n *  modify the point values.\n */\nexport class Point {\n\n  /**\n   * Point values.\n   *\n   * @type {number[]}\n   */\n  #values;\n\n  /**\n   * @param {number[]} values The point values.\n   */\n  constructor(values) {\n    if (!values || typeof values === 'undefined') {\n      throw new Error('Cannot create point with no values.');\n    }\n    if (values.length === 0) {\n      throw new Error('Cannot create point with empty values.');\n    }\n    const valueCheck = function (val) {\n      return !isNaN(val);\n    };\n    if (!values.every(valueCheck)) {\n      throw new Error('Cannot create point with non number values.');\n    }\n    this.#values = values;\n  }\n\n  /**\n   * Get the point value at the given array index.\n   *\n   * @param {number} i The index to get.\n   * @returns {number} The value.\n   */\n  get(i) {\n    return this.#values[i];\n  }\n\n  /**\n   * Get the length of the point.\n   *\n   * @returns {number} The length.\n   */\n  length() {\n    return this.#values.length;\n  }\n\n  /**\n   * Get a string representation of the point.\n   *\n   * @returns {string} The point as a string.\n   */\n  toString() {\n    return '(' + this.#values.toString() + ')';\n  }\n\n  /**\n   * Get the values of this point.\n   *\n   * @returns {number[]} The array of values.\n   */\n  getValues() {\n    return this.#values.slice();\n  }\n\n  /**\n   * Check if the input point can be compared to this one.\n   *\n   * @param {Point} rhs The point to compare to.\n   * @returns {boolean} True if both points are comparable.\n   */\n  canCompare(rhs) {\n    // check input\n    if (!rhs) {\n      return false;\n    }\n    // check length\n    if (this.length() !== rhs.length()) {\n      return false;\n    }\n    // seems ok!\n    return true;\n  }\n\n  /**\n   * Check for Point equality.\n   *\n   * @param {Point} rhs The point to compare to.\n   * @returns {boolean} True if both points are equal.\n   */\n  equals(rhs) {\n    // check if can compare\n    if (!this.canCompare(rhs)) {\n      return false;\n    }\n    // check values\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\n      if (this.get(i) !== rhs.get(i)) {\n        return false;\n      }\n    }\n    // seems ok!\n    return true;\n  }\n\n  /**\n   * Compare points and return different dimensions.\n   *\n   * @param {Point} rhs The point to compare to.\n   * @returns {number[]} The list of different dimensions.\n   */\n  compare(rhs) {\n    // check if can compare\n    if (!this.canCompare(rhs)) {\n      return null;\n    }\n    // check values\n    const diffDims = [];\n    for (let i = 0, leni = this.length(); i < leni; ++i) {\n      if (this.get(i) !== rhs.get(i)) {\n        diffDims.push(i);\n      }\n    }\n    return diffDims;\n  }\n\n  /**\n   * Get the 3D part of this point.\n   *\n   * @returns {Point3D} The Point3D.\n   */\n  get3D() {\n    return new Point3D(this.get(0), this.get(1), this.get(2));\n  }\n\n  /**\n   * Add another point to this one.\n   *\n   * @param {Point} rhs The point to add.\n   * @returns {Point} The point representing the sum of both points.\n   */\n  add(rhs) {\n    // check if can compare\n    if (!this.canCompare(rhs)) {\n      return null;\n    }\n    const values = [];\n    const values0 = this.getValues();\n    const values1 = rhs.getValues();\n    for (let i = 0; i < values0.length; ++i) {\n      values.push(values0[i] + values1[i]);\n    }\n    return new Point(values);\n  }\n\n  /**\n   * Merge this point with a Point3D to create a new point.\n   *\n   * @param {Point3D} rhs The Point3D to merge with.\n   * @returns {Point} The merge result.\n   */\n  mergeWith3D(rhs) {\n    const values = this.getValues();\n    values[0] = rhs.getX();\n    values[1] = rhs.getY();\n    values[2] = rhs.getZ();\n    return new Point(values);\n  }\n\n} // Point class\n","import {Vector3D} from './vector.js';\nimport {Point3D} from './point.js';\nimport {Index} from './index.js';\nimport {logger} from '../utils/logger.js';\n\n// Number.EPSILON is difference between 1 and the smallest\n// floating point number greater than 1\n// -> ~2e-16\n// BIG_EPSILON -> ~2e-12\nexport const BIG_EPSILON = Number.EPSILON * 1e4;\nexport const BIG_EPSILON_EXPONENT = 12;\n// 'real world', for example when comparing positions\nexport const REAL_WORLD_EPSILON = 1e-4;\nexport const REAL_WORLD_EXPONENT = 5;\n\n/**\n * Check if two numbers are similar.\n *\n * @param {number} a The first number.\n * @param {number} b The second number.\n * @param {number} [tol] Optional comparison tolerance,\n *   defaults to Number.EPSILON.\n * @returns {boolean} True if similar.\n */\nexport function isSimilar(a, b, tol) {\n  if (typeof tol === 'undefined') {\n    tol = Number.EPSILON;\n  }\n  return Math.abs(a - b) < tol;\n}\n\n/**\n * Immutable 3x3 Matrix.\n */\nexport class Matrix33 {\n\n  /**\n   * Matrix values.\n   *\n   * @type {number[]}\n   */\n  #values;\n\n  /**\n   * Matrix inverse, calculated at first ask.\n   *\n   * @type {Matrix33}\n   */\n  #inverse;\n\n  /**\n   * @param {number[]} values Row-major ordered 9 values.\n   */\n  constructor(values) {\n    this.#values = values;\n  }\n\n  /**\n   * Get a value of the matrix.\n   *\n   * @param {number} row The row at wich to get the value.\n   * @param {number} col The column at wich to get the value.\n   * @returns {number|undefined} The value at the position.\n   */\n  get(row, col) {\n    return this.#values[row * 3 + col];\n  }\n\n  /**\n   * Get the inverse of this matrix.\n   *\n   * @returns {Matrix33|undefined} The inverse matrix or undefined\n   *   if the determinant is zero.\n   */\n  getInverse() {\n    if (typeof this.#inverse === 'undefined') {\n      this.#inverse = getMatrixInverse(this);\n    }\n    return this.#inverse;\n  }\n\n  /**\n   * Check for Matrix33 equality.\n   *\n   * @param {Matrix33} rhs The other matrix to compare to.\n   * @returns {boolean} True if both matrices are equal.\n   */\n  equals(rhs) {\n    // TODO: add type check\n    // check values\n    for (let i = 0; i < 3; ++i) {\n      for (let j = 0; j < 3; ++j) {\n        if (this.get(i, j) !== rhs.get(i, j)) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Check for Matrix33 similarity.\n   *\n   * @param {Matrix33} rhs The other matrix to compare to.\n   * @param {number} [tol] Optional number comparison tolerance,\n   *   defaults to Number.EPSILON.\n   * @returns {boolean} True if both matrices are similar.\n   */\n  isSimilar(rhs, tol) {\n    // TODO: add type check\n    // check values\n    for (let i = 0; i < 3; ++i) {\n      for (let j = 0; j < 3; ++j) {\n        if (!isSimilar(this.get(i, j), rhs.get(i, j), tol)) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Get a string representation of the Matrix33.\n   *\n   * @returns {string} The matrix as a string.\n   */\n  toString() {\n    let str = '[';\n    for (let i = 0; i < 3; ++i) {\n      if (i !== 0) {\n        str += ', \\n ';\n      }\n      for (let j = 0; j < 3; ++j) {\n        if (j !== 0) {\n          str += ', ';\n        }\n        str += this.get(i, j);\n      }\n    }\n    str += ']';\n    return str;\n  }\n\n  /**\n   * Multiply this matrix by another.\n   *\n   * @param {Matrix33} rhs The matrix to multiply by.\n   * @returns {Matrix33} The product matrix.\n   */\n  multiply(rhs) {\n    const values = [];\n    for (let i = 0; i < 3; ++i) {\n      for (let j = 0; j < 3; ++j) {\n        let tmp = 0;\n        for (let k = 0; k < 3; ++k) {\n          tmp += this.get(i, k) * rhs.get(k, j);\n        }\n        values.push(tmp);\n      }\n    }\n    return new Matrix33(values);\n  }\n\n  /**\n   * Get the absolute value of this matrix.\n   *\n   * @returns {Matrix33} The result matrix.\n   */\n  getAbs() {\n    const values = [];\n    for (let i = 0; i < 3; ++i) {\n      for (let j = 0; j < 3; ++j) {\n        values.push(Math.abs(this.get(i, j)));\n      }\n    }\n    return new Matrix33(values);\n  }\n\n  /**\n   * Multiply this matrix by a 3D array.\n   *\n   * @param {number[]} array3D The input 3D array.\n   * @returns {number[]} The result 3D array.\n   */\n  multiplyArray3D(array3D) {\n    if (array3D.length !== 3) {\n      throw new Error('Cannot multiply 3x3 matrix with non 3D array: ' +\n        array3D.length);\n    }\n    // (no loop for speedup)\n    const a0 = array3D[0];\n    const a1 = array3D[1];\n    const a2 = array3D[2];\n    const values = new Array(3);\n    values[0] =\n      this.#values[0] * a0 +\n      this.#values[1] * a1 +\n      this.#values[2] * a2;\n    values[1] =\n      this.#values[3] * a0 +\n      this.#values[4] * a1 +\n      this.#values[5] * a2;\n    values[2] =\n      this.#values[6] * a0 +\n      this.#values[7] * a1 +\n      this.#values[8] * a2;\n    return values;\n  }\n\n  /**\n   * Multiply this matrix by a 3D typed array.\n   *\n   * @typedef {(\n   *   Uint8Array | Int8Array |\n   *   Uint16Array | Int16Array |\n   *   Uint32Array | Int32Array\n   * )} TypedArray\n   *\n   * @param {TypedArray} sourceArray The input 3D array.\n   * @param {TypedArray} outArray The array to write to.\n   */\n  multiplyTypedArray3D(sourceArray, outArray) {\n    // (no loop for speedup)\n    const a0 = sourceArray[0];\n    const a1 = sourceArray[1];\n    const a2 = sourceArray[2];\n    outArray[0] =\n      this.#values[0] * a0 +\n      this.#values[1] * a1 +\n      this.#values[2] * a2;\n    outArray[1] =\n      this.#values[3] * a0 +\n      this.#values[4] * a1 +\n      this.#values[5] * a2;\n    outArray[2] =\n      this.#values[6] * a0 +\n      this.#values[7] * a1 +\n      this.#values[8] * a2;\n  }\n\n  /**\n   * Multiply this matrix by a 3D vector.\n   *\n   * @param {Vector3D} vector3D The input 3D vector.\n   * @returns {Vector3D} The result 3D vector.\n   */\n  multiplyVector3D(vector3D) {\n    const array3D = this.multiplyArray3D(\n      [vector3D.getX(), vector3D.getY(), vector3D.getZ()]\n    );\n    return new Vector3D(array3D[0], array3D[1], array3D[2]);\n  }\n\n  /**\n   * Multiply this matrix by a 3D point.\n   *\n   * @param {Point3D} point3D The input 3D point.\n   * @returns {Point3D} The result 3D point.\n   */\n  multiplyPoint3D(point3D) {\n    const array3D = this.multiplyArray3D(\n      [point3D.getX(), point3D.getY(), point3D.getZ()]\n    );\n    return new Point3D(array3D[0], array3D[1], array3D[2]);\n  }\n\n  /**\n   * Multiply this matrix by a 3D index.\n   *\n   * @param {Index} index3D The input 3D index.\n   * @returns {Index} The result 3D index.\n   */\n  multiplyIndex3D(index3D) {\n    const array3D = this.multiplyArray3D(index3D.getValues());\n    return new Index(array3D);\n  }\n\n  /**\n   * Get the index of the maximum in absolute value of a row.\n   *\n   * @param {number} row The row to get the maximum from.\n   * @returns {object} The {value,index} of the maximum.\n   */\n  getRowAbsMax(row) {\n    const values = [\n      Math.abs(this.get(row, 0)),\n      Math.abs(this.get(row, 1)),\n      Math.abs(this.get(row, 2))\n    ];\n    const absMax = Math.max.apply(null, values);\n    const index = values.indexOf(absMax);\n    return {\n      value: this.get(row, index),\n      index: index\n    };\n  }\n\n  /**\n   * Get the index of the maximum in absolute value of a column.\n   *\n   * @param {number} col The column to get the maximum from.\n   * @returns {object} The {value,index} of the maximum.\n   */\n  getColAbsMax(col) {\n    const values = [\n      Math.abs(this.get(0, col)),\n      Math.abs(this.get(1, col)),\n      Math.abs(this.get(2, col))\n    ];\n    const absMax = Math.max.apply(null, values);\n    const index = values.indexOf(absMax);\n    return {\n      value: this.get(index, col),\n      index: index\n    };\n  }\n\n  /**\n   * Get this matrix with only zero and +/- ones instead of the maximum.\n   *\n   * @returns {Matrix33} The simplified matrix.\n   */\n  asOneAndZeros() {\n    // TODO: This breaks at 45 degree angles\n    const res = [];\n    for (let j = 0; j < 3; ++j) {\n      const max = this.getRowAbsMax(j);\n      const sign = max.value > 0 ? 1 : -1;\n      for (let i = 0; i < 3; ++i) {\n        if (i === max.index) {\n          res.push(1 * sign);\n        } else {\n          res.push(0);\n        }\n      }\n    }\n    return new Matrix33(res);\n  }\n\n  /**\n   * Get the third column direction index of an orientation matrix.\n   *\n   * @returns {number} The index of the absolute maximum of the last column.\n   */\n  getThirdColMajorDirection() {\n    return this.getColAbsMax(2).index;\n  }\n\n  /**\n   * Get the values of the matrix as an array.\n   *\n   * @returns {number[]} The matrix.\n   */\n  getValues() {\n    return this.#values.slice();\n  }\n\n} // Matrix33\n\n/**\n * Get the inverse of an input 3*3 matrix.\n *\n * Ref:\n * - {@link https://en.wikipedia.org/wiki/Invertible_matrix#Inversion_of_3_%C3%97_3_matrices},\n * - {@link https://github.com/willnode/N-Matrix-Programmer}.\n *\n * @param {Matrix33} m The input matrix.\n * @returns {Matrix33|undefined} The inverse matrix or undefined\n *   if the determinant is zero.\n */\nfunction getMatrixInverse(m) {\n  const m00 = m.get(0, 0);\n  const m01 = m.get(0, 1);\n  const m02 = m.get(0, 2);\n  const m10 = m.get(1, 0);\n  const m11 = m.get(1, 1);\n  const m12 = m.get(1, 2);\n  const m20 = m.get(2, 0);\n  const m21 = m.get(2, 1);\n  const m22 = m.get(2, 2);\n\n  const a1212 = m11 * m22 - m12 * m21;\n  const a2012 = m12 * m20 - m10 * m22;\n  const a0112 = m10 * m21 - m11 * m20;\n\n  let det = m00 * a1212 + m01 * a2012 + m02 * a0112;\n  if (det === 0) {\n    logger.warn('Cannot invert 3*3 matrix with zero determinant.');\n    return undefined;\n  }\n  det = 1 / det;\n\n  const values = [\n    det * a1212,\n    det * (m02 * m21 - m01 * m22),\n    det * (m01 * m12 - m02 * m11),\n    det * a2012,\n    det * (m00 * m22 - m02 * m20),\n    det * (m02 * m10 - m00 * m12),\n    det * a0112,\n    det * (m01 * m20 - m00 * m21),\n    det * (m00 * m11 - m01 * m10)\n  ];\n\n  return new Matrix33(values);\n}\n\n/**\n * Create a 3x3 identity matrix.\n *\n * @returns {Matrix33} The identity matrix.\n */\nexport function getIdentityMat33() {\n  /* eslint-disable @stylistic/js/array-element-newline */\n  return new Matrix33([\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1\n  ]);\n  /* eslint-enable @stylistic/js/array-element-newline */\n}\n\n/**\n * Check if a matrix is a 3x3 identity matrix.\n *\n * @param {Matrix33} mat33 The matrix to test.\n * @returns {boolean} True if identity.\n */\nexport function isIdentityMat33(mat33) {\n  return mat33.equals(getIdentityMat33());\n}\n","import {Index} from '../math/index.js';\nimport {Point2D} from '../math/point.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Image} from './image.js';\nimport {Matrix33} from '../math/matrix.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Get an simple iterator for a given range for a one component data.\n *\n * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols}.\n *\n * @param {Function} dataAccessor Function to access data.\n * @param {number} start The start of the range (included).\n * @param {number} end The end of the range (excluded).\n * @param {number} [increment] The increment between indicies (default=1).\n * @returns {object} An iterator folowing the iterator and iterable protocol.\n */\nexport function simpleRange(dataAccessor, start, end, increment) {\n  if (typeof increment === 'undefined') {\n    increment = 1;\n  }\n  let nextIndex = start;\n  // result\n  return {\n    next: function () {\n      if (nextIndex < end) {\n        const result = {\n          value: dataAccessor(nextIndex),\n          done: false,\n          index: nextIndex\n        };\n        nextIndex += increment;\n        return result;\n      }\n      return {\n        done: true,\n        index: end\n      };\n    }\n  };\n}\n\n/**\n * Get an iterator for a given range for a one component data.\n *\n * Using 'maxIter' and not an 'end' index since it fails in some edge cases\n * (for ex coronal2, ie zxy).\n *\n * @param {Function} dataAccessor Function to access data.\n * @param {number} start Zero-based index at which to start the iteration.\n * @param {number} maxIter The maximum number of iterations.\n * @param {number} increment Increment between indicies.\n * @param {number} blockMaxIter Number of applied increment after which\n *   blockIncrement is applied.\n * @param {number} blockIncrement Increment after blockMaxIter is reached,\n *   the value is from block start to the next block start.\n * @param {boolean} reverse1 If true, loop from end to start.\n *   WARN: don't forget to set the value of start as the last index!\n * @param {boolean} reverse2 If true, loop from block end to block start.\n * @returns {object} An iterator folowing the iterator and iterable protocol.\n */\nexport function range(dataAccessor, start, maxIter, increment,\n  blockMaxIter, blockIncrement, reverse1, reverse2) {\n  if (typeof reverse1 === 'undefined') {\n    reverse1 = false;\n  }\n  if (typeof reverse2 === 'undefined') {\n    reverse2 = false;\n  }\n\n  // first index of the iteration\n  let nextIndex = start;\n  // adapt first index and increments to reverse values\n  if (reverse1) {\n    blockIncrement *= -1;\n    if (reverse2) {\n      // start at end of line\n      nextIndex -= (blockMaxIter - 1) * increment;\n    } else {\n      increment *= -1;\n    }\n  } else {\n    if (reverse2) {\n      // start at end of line\n      nextIndex += (blockMaxIter - 1) * increment;\n      increment *= -1;\n    }\n  }\n  const finalBlockIncrement = blockIncrement - blockMaxIter * increment;\n\n  // counters\n  let mainCount = 0;\n  let blockCount = 0;\n  // result\n  return {\n    next: function () {\n      if (mainCount < maxIter) {\n        const result = {\n          value: dataAccessor(nextIndex),\n          done: false,\n          index: nextIndex\n        };\n        nextIndex += increment;\n        ++mainCount;\n        ++blockCount;\n        if (blockCount === blockMaxIter) {\n          blockCount = 0;\n          nextIndex += finalBlockIncrement;\n        }\n        return result;\n      }\n      return {\n        done: true,\n        index: nextIndex\n      };\n    }\n  };\n}\n\n/**\n * Get an iterator for a given range with bounds (for a one component data).\n *\n * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols}.\n *\n * @param {Function} dataAccessor Function to access data.\n * @param {number} start The start of the range (included).\n * @param {number} end The end of the range (excluded).\n * @param {number} increment The increment between indicies.\n * @param {number} regionSize The size of the region to iterate through.\n * @param {number} regionOffset The offset between regions.\n * @returns {object} An iterator folowing the iterator and iterable protocol.\n */\nexport function rangeRegion(\n  dataAccessor, start, end, increment, regionSize, regionOffset) {\n  let nextIndex = start;\n  let regionElementCount = 0;\n  // result\n  return {\n    next: function () {\n      if (nextIndex < end) {\n        const result = {\n          value: dataAccessor(nextIndex),\n          done: false,\n          index: nextIndex\n        };\n        regionElementCount += 1;\n        nextIndex += increment;\n        if (regionElementCount === regionSize) {\n          regionElementCount = 0;\n          nextIndex += regionOffset;\n        }\n        return result;\n      }\n      return {\n        done: true,\n        index: end\n      };\n    }\n  };\n}\n\n/**\n * Get an iterator for a given range with bounds (for a one component data).\n *\n * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols}.\n *\n * @param {Function} dataAccessor Function to access data.\n * @param {number} start The start of the range (included).\n * @param {number} end The end of the range (excluded).\n * @param {number} increment The increment between indicies.\n * @param {number[][]} regions An array of regions: [off0, size, off1].\n * @returns {object} An iterator folowing the iterator and iterable protocol.\n */\nexport function rangeRegions(\n  dataAccessor, start, end, increment, regions) {\n  let nextIndex = start;\n  let regionCount = 0;\n  let regionElementCount = 0;\n  // result\n  return {\n    next: function () {\n      if (nextIndex < end) {\n        const result = {\n          value: dataAccessor(nextIndex),\n          done: false,\n          index: nextIndex\n        };\n        regionElementCount += 1;\n        nextIndex += increment;\n        if (regionElementCount === regions[regionCount][1]) {\n          regionElementCount = 0;\n          // off1 of current group\n          nextIndex += regions[regionCount][2];\n          regionCount += 1;\n          // off0 of next group\n          if (regionCount < regions.length) {\n            nextIndex += regions[regionCount][0];\n          }\n        }\n        return result;\n      }\n      return {\n        done: true,\n        index: end\n      };\n    }\n  };\n}\n\n/**\n * Get an iterator for a given range for a 3 components data.\n *\n * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols}.\n *\n * @param {Function} dataAccessor Function to access data.\n * @param {number} start The start of the range (included).\n * @param {number} end The end of the range (excluded).\n *   (end - start) needs to be a multiple of 3...\n * @param {number} increment The increment between indicies (default=1).\n * @param {boolean} isPlanar A flag to know if the data is planar\n *   (RRRR...GGGG...BBBB...) or not (RGBRGBRGBRGB...), defaults to false.\n * @returns {object} A 3 components iterator folowing the iterator and iterable\n *   protocol, the value is an array of size 3 with each component.\n */\nexport function simpleRange3d(\n  dataAccessor, start, end, increment, isPlanar) {\n  if (typeof increment === 'undefined') {\n    increment = 1;\n  }\n  if (typeof isPlanar === 'undefined') {\n    isPlanar = false;\n  }\n  let nextIndex = start;\n  let componentIncrement = 1;\n  if (isPlanar) {\n    componentIncrement = (end - start) / 3;\n  } else {\n    increment *= 3;\n  }\n  let nextIndex1 = nextIndex + componentIncrement;\n  let nextIndex2 = nextIndex + 2 * componentIncrement;\n\n  // result\n  return {\n    next: function () {\n      if (nextIndex < end) {\n        const result = {\n          value: [\n            dataAccessor(nextIndex),\n            dataAccessor(nextIndex1),\n            dataAccessor(nextIndex2)\n          ],\n          done: false,\n          index: [nextIndex, nextIndex1, nextIndex2]\n        };\n        nextIndex += increment;\n        nextIndex1 += increment;\n        nextIndex2 += increment;\n        return result;\n      }\n      return {\n        done: true,\n        index: [end]\n      };\n    }\n  };\n}\n\n/**\n * Get an iterator for a given range for a 3 components data.\n *\n * Using 'maxIter' and not an 'end' index since it fails in some edge cases\n * (for ex coronal2, ie zxy).\n *\n * @param {Function} dataAccessor Function to access data.\n * @param {number} start Zero-based index at which to start the iteration.\n * @param {number} maxIter The maximum number of iterations.\n * @param {number} increment Increment between indicies.\n * @param {number} blockMaxIter Number of applied increment after which\n *   blockIncrement is applied.\n * @param {number} blockIncrement Increment after blockMaxIter is reached,\n *   the value is from block start to the next block start.\n * @param {boolean} reverse1 If true, loop from end to start.\n *   WARN: don't forget to set the value of start as the last index!\n * @param {boolean} reverse2 If true, loop from block end to block start.\n * @param {boolean} isPlanar A flag to know if the data is planar\n *   (RRRR...GGGG...BBBB...) or not (RGBRGBRGBRGB...), defaults to false.\n * @returns {object} An iterator folowing the iterator and iterable protocol.\n */\nexport function range3d(dataAccessor, start, maxIter, increment,\n  blockMaxIter, blockIncrement, reverse1, reverse2, isPlanar) {\n  const iters = [];\n  if (isPlanar) {\n    iters.push(range(\n      dataAccessor, start, maxIter, increment,\n      blockMaxIter, blockIncrement, reverse1, reverse2\n    ));\n    iters.push(range(\n      dataAccessor, start + maxIter * increment, maxIter, increment,\n      blockMaxIter, blockIncrement, reverse1, reverse2\n    ));\n    iters.push(range(\n      dataAccessor, start + 2 * maxIter * increment, maxIter, increment,\n      blockMaxIter, blockIncrement, reverse1, reverse2\n    ));\n  } else {\n    increment *= 3;\n    blockIncrement *= 3;\n    iters.push(range(\n      dataAccessor, start, maxIter, increment,\n      blockMaxIter, blockIncrement, reverse1, reverse2\n    ));\n    iters.push(range(\n      dataAccessor, start + 1, maxIter, increment,\n      blockMaxIter, blockIncrement, reverse1, reverse2\n    ));\n    iters.push(range(\n      dataAccessor, start + 2, maxIter, increment,\n      blockMaxIter, blockIncrement, reverse1, reverse2\n    ));\n  }\n\n  // result\n  return {\n    next: function () {\n      const r0 = iters[0].next();\n      const r1 = iters[1].next();\n      const r2 = iters[2].next();\n      if (!r0.done) {\n        return {\n          value: [\n            r0.value,\n            r1.value,\n            r2.value\n          ],\n          done: false,\n          index: [\n            r0.index,\n            r1.index,\n            r2.index\n          ]\n        };\n      }\n      return {\n        done: true,\n        index: r2.index\n      };\n    }\n  };\n}\n\n/**\n * Get a list of values for a given iterator.\n *\n * @param {object} iterator The iterator to use to loop through data.\n * @returns {Array} The list of values.\n */\nexport function getIteratorValues(iterator) {\n  const values = [];\n  let ival = iterator.next();\n  while (!ival.done) {\n    values.push(ival.value);\n    ival = iterator.next();\n  }\n  return values;\n}\n\n/**\n * Get a slice index iterator.\n *\n * @param {Image} image The image to parse.\n * @param {Index} index The current index.\n * @param {boolean} isRescaled Flag for rescaled values (default false).\n * @param {Matrix33} viewOrientation The view orientation.\n * @returns {object} The slice iterator.\n */\nexport function getSliceIterator(\n  image, index, isRescaled, viewOrientation) {\n  const size = image.getGeometry().getSize();\n  // zero-ify non direction index\n  let dirMax2Index = 2;\n  if (viewOrientation && typeof viewOrientation !== 'undefined') {\n    dirMax2Index = viewOrientation.getColAbsMax(2).index;\n  }\n  const posValues = index.getValues();\n  // keep the main direction and any other than 3D\n  const indexFilter = function (element, i) {\n    return (i === dirMax2Index || i > 2) ? element : 0;\n  };\n  const posStart = new Index(posValues.map(indexFilter));\n  let start = size.indexToOffset(posStart);\n\n  // default to non rescaled data\n  if (typeof isRescaled === 'undefined') {\n    isRescaled = false;\n  }\n  let dataAccessor = null;\n  if (isRescaled) {\n    dataAccessor = function (offset) {\n      return image.getRescaledValueAtOffset(offset);\n    };\n  } else {\n    dataAccessor = function (offset) {\n      return image.getValueAtOffset(offset);\n    };\n  }\n\n  const ncols = size.get(0);\n  const nrows = size.get(1);\n  const nslices = size.get(2);\n  let sliceSize = size.getDimSize(2);\n\n  const ncomp = image.getNumberOfComponents();\n  const isPlanar = image.getPlanarConfiguration() === 1;\n  const getRange = function (\n    dataAccessor, start, maxIter, increment,\n    blockMaxIter, blockIncrement, reverse1, reverse2) {\n    if (ncomp === 1) {\n      return range(dataAccessor, start, maxIter, increment,\n        blockMaxIter, blockIncrement, reverse1, reverse2);\n    } else if (ncomp === 3) {\n      return range3d(dataAccessor, 3 * start, maxIter, increment,\n        blockMaxIter, blockIncrement, reverse1, reverse2, isPlanar);\n    }\n  };\n\n  let rangeObj = null;\n  if (viewOrientation && typeof viewOrientation !== 'undefined') {\n    const dirMax0 = viewOrientation.getColAbsMax(0);\n    const dirMax2 = viewOrientation.getColAbsMax(2);\n\n    // default reverse\n    const reverse1 = false;\n    const reverse2 = false;\n\n    let maxIter = null;\n    if (dirMax2.index === 2) {\n      // axial\n      maxIter = ncols * nrows;\n      if (dirMax0.index === 0) {\n        // xyz\n        rangeObj = getRange(dataAccessor,\n          start, maxIter, 1, ncols, ncols, reverse1, reverse2);\n      } else {\n        // yxz\n        rangeObj = getRange(dataAccessor,\n          start, maxIter, ncols, nrows, 1, reverse1, reverse2);\n      }\n    } else if (dirMax2.index === 0) {\n      // sagittal\n      maxIter = nslices * nrows;\n      if (dirMax0.index === 1) {\n        // yzx\n        rangeObj = getRange(dataAccessor,\n          start, maxIter, ncols, nrows, sliceSize, reverse1, reverse2);\n      } else {\n        // zyx\n        rangeObj = getRange(dataAccessor,\n          start, maxIter, sliceSize, nslices, ncols, reverse1, reverse2);\n      }\n    } else if (dirMax2.index === 1) {\n      // coronal\n      maxIter = nslices * ncols;\n      if (dirMax0.index === 0) {\n        // xzy\n        rangeObj = getRange(dataAccessor,\n          start, maxIter, 1, ncols, sliceSize, reverse1, reverse2);\n      } else {\n        // zxy\n        rangeObj = getRange(dataAccessor,\n          start, maxIter, sliceSize, nslices, 1, reverse1, reverse2);\n      }\n    } else {\n      throw new Error('Unknown direction: ' + dirMax2.index);\n    }\n  } else {\n    if (image.getNumberOfComponents() === 1) {\n      rangeObj = simpleRange(dataAccessor, start, start + sliceSize);\n    } else if (image.getNumberOfComponents() === 3) {\n      // 3 times bigger...\n      start *= 3;\n      sliceSize *= 3;\n      rangeObj = simpleRange3d(\n        dataAccessor, start, start + sliceSize, 1, isPlanar);\n    } else {\n      throw new Error('Unsupported number of components: ' +\n        image.getNumberOfComponents());\n    }\n  }\n\n  return rangeObj;\n}\n\n/**\n * Get a slice index iterator for a rectangular region.\n *\n * @param {Image} image The image to parse.\n * @param {Index} index The current index.\n * @param {boolean} isRescaled Flag for rescaled values (default false).\n * @param {Point2D} min The minimum position (optional).\n * @param {Point2D} max The maximum position (optional).\n * @returns {object} The slice iterator.\n */\nexport function getRegionSliceIterator(\n  image, index, isRescaled, min, max) {\n  if (image.getNumberOfComponents() !== 1) {\n    throw new Error('Unsupported number of components for region iterator: ' +\n      image.getNumberOfComponents());\n  }\n\n  // default to non rescaled data\n  if (typeof isRescaled === 'undefined') {\n    isRescaled = false;\n  }\n  let dataAccessor = null;\n  if (isRescaled) {\n    dataAccessor = function (offset) {\n      return image.getRescaledValueAtOffset(offset);\n    };\n  } else {\n    dataAccessor = function (offset) {\n      return image.getValueAtOffset(offset);\n    };\n  }\n\n  const size = image.getGeometry().getSize();\n  if (typeof min === 'undefined') {\n    min = new Point2D(0, 0);\n  }\n  if (typeof max === 'undefined') {\n    max = new Point2D(\n      size.get(0) - 1,\n      size.get(1)\n    );\n  }\n  // position to pixel for max: extra X is ok, remove extra Y\n  const startOffset = size.indexToOffset(index.getWithNew2D(\n    min.getX(), min.getY()\n  ));\n  const endOffset = size.indexToOffset(index.getWithNew2D(\n    max.getX(), max.getY() - 1\n  ));\n\n  // minimum 1 column\n  const rangeNumberOfColumns = Math.max(1, max.getX() - min.getX());\n  const rowIncrement = size.get(0) - rangeNumberOfColumns;\n\n  return rangeRegion(\n    dataAccessor, startOffset, endOffset + 1,\n    1, rangeNumberOfColumns, rowIncrement);\n}\n\n/**\n * Get a slice index iterator for a rectangular region.\n *\n * @param {Image} image The image to parse.\n * @param {Index} index The current index.\n * @param {boolean} isRescaled Flag for rescaled values (default false).\n * @param {number[][][]} regions An array of [x, y] pairs (min, max).\n * @returns {object|undefined} The slice iterator.\n */\nexport function getVariableRegionSliceIterator(\n  image, index, isRescaled, regions) {\n  if (image.getNumberOfComponents() !== 1) {\n    throw new Error('Unsupported number of components for region iterator: ' +\n      image.getNumberOfComponents());\n  }\n\n  // default to non rescaled data\n  if (typeof isRescaled === 'undefined') {\n    isRescaled = false;\n  }\n  let dataAccessor = null;\n  if (isRescaled) {\n    dataAccessor = function (offset) {\n      return image.getRescaledValueAtOffset(offset);\n    };\n  } else {\n    dataAccessor = function (offset) {\n      return image.getValueAtOffset(offset);\n    };\n  }\n\n  const size = image.getGeometry().getSize();\n\n  const offsetRegions = [];\n  let region;\n  let min = null;\n  let max = null;\n  let regionIndex = null;\n  for (let i = 0; i < regions.length; ++i) {\n    region = regions[i];\n    const width = region[1][0] - region[0][0];\n    if (width !== 0) {\n      regionIndex = i;\n      if (!min) {\n        min = region[0];\n      }\n      offsetRegions.push([\n        region[0][0],\n        width,\n        size.get(0) - region[1][0]\n      ]);\n    }\n  }\n  if (regionIndex !== null) {\n    max = regions[regionIndex][1];\n  }\n\n  // exit if no offsets\n  if (offsetRegions.length === 0) {\n    return undefined;\n  }\n\n  const startOffset = size.indexToOffset(index.getWithNew2D(\n    min[0], min[1]\n  ));\n  const endOffset = size.indexToOffset(index.getWithNew2D(\n    max[0], max[1]\n  ));\n\n  return rangeRegions(\n    dataAccessor, startOffset, endOffset + 1,\n    1, offsetRegions);\n}\n\n/**\n * Get a multiple value iterator. The input array defines the values and\n * their start index.\n *\n * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols}.\n *\n * @param {Array} values An array of {index, value} pairs.\n * @param {number} end The end of the range (excluded).\n * @returns {object} An iterator folowing the iterator and iterable protocol.\n */\nexport function valueRange(values, end) {\n  let nextIndex = 0;\n  let nextValueIndex = 0;\n  // result\n  return {\n    next: function () {\n      if (nextIndex < end) {\n        if (nextValueIndex + 1 < values.length &&\n          nextIndex >= values[nextValueIndex + 1].index) {\n          ++nextValueIndex;\n        }\n        const result = {\n          value: values[nextValueIndex].value,\n          done: false,\n          index: nextIndex\n        };\n        ++nextIndex;\n        return result;\n      }\n      return {\n        done: true,\n        index: end\n      };\n    }\n  };\n}\n","import {logger} from './logger.js';\n\n/**\n * ListenerHandler class: handles add/removing and firing listeners.\n *\n * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/API/EventTarget#example}.\n */\nexport class ListenerHandler {\n  /**\n   * Listeners.\n   *\n   * @type {object}\n   */\n  #listeners = {};\n\n  /**\n   * Add an event listener.\n   *\n   * @param {string} type The event type.\n   * @param {object} callback The method associated with the provided\n   *    event type, will be called with the fired event.\n   */\n  add(type, callback) {\n    // create array if not present\n    if (typeof this.#listeners[type] === 'undefined') {\n      this.#listeners[type] = [];\n    }\n    // add callback to listeners array\n    this.#listeners[type].push(callback);\n  }\n\n  /**\n   * Remove an event listener.\n   *\n   * @param {string} type The event type.\n   * @param {object} callback The method associated with the provided\n   *   event type.\n   */\n  remove(type, callback) {\n    // check if the type is present\n    if (typeof this.#listeners[type] === 'undefined') {\n      return;\n    }\n    // remove from listeners array\n    let nFound = 0;\n    for (let i = 0; i < this.#listeners[type].length; ++i) {\n      if (this.#listeners[type][i] === callback) {\n        ++nFound;\n        this.#listeners[type].splice(i, 1);\n      }\n    }\n    if (nFound === 0) {\n      logger.debug('No callback found on remove listener for type ' + type);\n    }\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  fireEvent = (event) => {\n    // check if they are listeners for the event type\n    if (typeof this.#listeners[event.type] === 'undefined') {\n      return;\n    }\n    // fire events from a copy of the listeners array\n    // to avoid interference from possible add/remove\n    const stack = this.#listeners[event.type].slice();\n    for (let i = 0; i < stack.length; ++i) {\n      stack[i](event);\n    }\n  };\n}\n","/**\n * Rescale Slope and Intercept.\n */\nexport class RescaleSlopeAndIntercept {\n\n  /**\n   * The slope.\n   *\n   * @type {number}\n   */\n  #slope;\n\n  /**\n   * The intercept.\n   *\n   * @type {number}\n   */\n  #intercept;\n\n  /**\n   * @param {number} slope The slope of the RSI.\n   * @param {number} intercept The intercept of the RSI.\n   */\n  constructor(slope, intercept) {\n    /*// Check the rescale slope.\n      if(typeof(slope) === 'undefined') {\n          slope = 1;\n      }\n      // Check the rescale intercept.\n      if(typeof(intercept) === 'undefined') {\n          intercept = 0;\n      }*/\n    this.#slope = slope;\n    this.#intercept = intercept;\n  }\n\n  /**\n   * Get the slope of the RSI.\n   *\n   * @returns {number} The slope of the RSI.\n   */\n  getSlope() {\n    return this.#slope;\n  }\n\n  /**\n   * Get the intercept of the RSI.\n   *\n   * @returns {number} The intercept of the RSI.\n   */\n  getIntercept() {\n    return this.#intercept;\n  }\n\n  /**\n   * Apply the RSI on an input value.\n   *\n   * @param {number} value The input value.\n   * @returns {number} The value to rescale.\n   */\n  apply(value) {\n    return value * this.#slope + this.#intercept;\n  }\n\n  /**\n   * Check for RSI equality.\n   *\n   * @param {RescaleSlopeAndIntercept} rhs The other RSI to compare to.\n   * @returns {boolean} True if both RSI are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      typeof rhs !== 'undefined' &&\n      this.getSlope() === rhs.getSlope() &&\n      this.getIntercept() === rhs.getIntercept();\n  }\n\n  /**\n   * Is this RSI an ID RSI.\n   *\n   * @returns {boolean} True if the RSI has a slope of 1 and no intercept.\n   */\n  isID() {\n    return (this.getSlope() === 1 && this.getIntercept() === 0);\n  }\n\n} // class RescaleSlopeAndIntercept\n","import {logger} from '../utils/logger.js';\n\n/**\n * Mask segment view helper: handles hidden segments.\n */\nexport class MaskSegmentViewHelper {\n\n  /**\n   * List of hidden segment numbers.\n   *\n   * @type {number[]}\n   */\n  #hiddenNumbers = [];\n\n  /**\n   * Get the index of a segment in the hidden list.\n   *\n   * @param {number} segmentNumber The segment number.\n   * @returns {number} The index in the array, -1 if not found.\n   */\n  #findHiddenIndex(segmentNumber) {\n    return this.#hiddenNumbers.indexOf(segmentNumber);\n  }\n\n  /**\n   * Check if a segment is in the hidden list.\n   *\n   * @param {number} segmentNumber The segment number.\n   * @returns {boolean} True if the segment is in the list.\n   */\n  isHidden(segmentNumber) {\n    return this.#findHiddenIndex(segmentNumber) !== -1;\n  }\n\n  /**\n   * Add a segment to the hidden list.\n   *\n   * @param {number} segmentNumber The segment number.\n   */\n  addToHidden(segmentNumber) {\n    if (!this.isHidden(segmentNumber)) {\n      this.#hiddenNumbers.push(segmentNumber);\n    } else {\n      logger.warn(\n        'Not hidding segment, it is allready in the hidden list: ' +\n        segmentNumber);\n    }\n  }\n\n  /**\n   * Remove a segment from the hidden list.\n   *\n   * @param {number} segmentNumber The segment number.\n   */\n  removeFromHidden(segmentNumber) {\n    const index = this.#findHiddenIndex(segmentNumber);\n    if (index !== -1) {\n      this.#hiddenNumbers.splice(index, 1);\n    } else {\n      logger.warn(\n        'Cannot remove segment, it is not in the hidden list: ' +\n        segmentNumber);\n    }\n  }\n}","import {Index} from '../math/index.js';\nimport {ModalityLut} from './modalityLut.js';\nimport {WindowLut} from './windowLut.js';\nimport {luts} from './luts.js';\nimport {VoiLut} from './voiLut.js';\nimport {\n  WindowLevel,\n  equalWl,\n  validateWindowLevel\n} from './windowLevel.js';\nimport {generateImageDataMonochrome} from './viewMonochrome.js';\nimport {generateImageDataPaletteColor} from './viewPaletteColor.js';\nimport {generateImageDataRgb} from './viewRgb.js';\nimport {generateImageDataYbrFull} from './viewYbrFull.js';\nimport {ViewFactory} from './viewFactory.js';\nimport {isIdentityMat33} from '../math/matrix.js';\nimport {getSliceIterator} from '../image/iterator.js';\nimport {ListenerHandler} from '../utils/listen.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Image} from './image.js';\nimport {RescaleSlopeAndIntercept} from './rsi.js';\nimport {ColourMap} from './luts.js';\nimport {Matrix33} from '../math/matrix.js';\nimport {\n  Point,\n  Point3D\n} from '../math/point.js';\nimport {DataElement} from '../dicom/dataElement.js';\nimport {MaskSegmentViewHelper} from '../image/maskSegmentViewHelper.js';\n/* eslint-enable no-unused-vars */\n\nexport const MAX_CONTOUR_SIZE = 10;\n\n/**\n * List of view event names.\n *\n * @type {string[]}\n */\nexport const viewEventNames = [\n  'wlchange',\n  'wlpresetadd',\n  'colourmapchange',\n  'positionchange',\n  'opacitychange',\n  'alphafuncchange',\n  'maskviewchange'\n];\n\n/**\n * Create a View from DICOM elements and image.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @param {Image} image The associated image.\n * @returns {View} The View object.\n */\nexport function createView(elements, image) {\n  const factory = new ViewFactory();\n  return factory.create(elements, image);\n}\n\n/**\n * View class.\n *\n * Need to set the window lookup table once created\n * (either directly or with helper methods).\n *\n * @example\n * import {DicomParser, createImage, createView} from '//esm.sh/dwv';\n * // XMLHttpRequest onload callback\n * const onload = function (event) {\n *   // parse the dicom buffer\n *   const dicomParser = new DicomParser();\n *   dicomParser.parse(event.target.response);\n *   // create the image object\n *   const image = createImage(dicomParser.getDicomElements());\n *   // create the view\n *   const view = createView(dicomParser.getDicomElements(), image);\n *   // setup canvas\n *   const canvas = document.createElement('canvas');\n *   canvas.width = 256;\n *   canvas.height = 256;\n *   const ctx = canvas.getContext(\"2d\");\n *   // update the image data\n *   const imageData = ctx.createImageData(256, 256);\n *   view.generateImageData(imageData);\n *   ctx.putImageData(imageData, 0, 0);\n *   // update html\n *   const div = document.getElementById('dwv');\n *   div.appendChild(canvas);\n * };\n * // DICOM file request\n * const request = new XMLHttpRequest();\n * const url = 'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm';\n * request.open('GET', url);\n * request.responseType = 'arraybuffer';\n * request.onload = onload;\n * request.send();\n */\nexport class View {\n\n  /**\n   * The associated image.\n   *\n   * @type {Image}\n   */\n  #image;\n\n  /**\n   * Window lookup tables, indexed per Rescale Slope and Intercept (RSI).\n   *\n   * @type {WindowLut}\n   */\n  #windowLut;\n\n  /**\n   * Flag for image constant RSI.\n   *\n   * @type {boolean}\n   */\n  #isConstantRSI;\n\n  /**\n   * Window presets.\n   * Minmax will be filled at first use (see view.setWindowLevelPreset).\n   *\n   * @type {object}\n   */\n  #windowPresets = {minmax: {name: 'minmax'}};\n\n  /**\n   * Current window preset name.\n   *\n   * @type {string}\n   */\n  #currentPresetName;\n\n  /**\n   * Current window level.\n   *\n   * @type {WindowLevel}\n   */\n  #currentWl;\n\n  /**\n   * Colour map name.\n   *\n   * @type {string}\n   */\n  #colourMapName = 'plain';\n\n  /**\n   * Current position as a Point.\n   * Store position and not index to stay geometry independent.\n   *\n   * @type {Point}\n   */\n  #currentPosition;\n\n  /**\n   * View orientation. Undefined will use the original slice ordering.\n   *\n   * @type {Matrix33}\n   */\n  #orientation;\n\n  /**\n   * The ill (non-contour) opacity relative to global opacity.\n   * This only has an effect on segmentation views, or any other alpha\n   * function that makes use of it.\n   *\n   * @type {number}\n   */\n  #fillOpacity = 0.33;\n\n  /**\n   * The thickness of the contour in pixels.\n   * This only has an effect on segmentation views, or any other alpha\n   * function that makes use of it.\n   *\n   * @type {number}\n   */\n  #contourThickness = 1;\n\n  /**\n   * @callback alphaFn\n   * @param {number[]|number} value The pixel value.\n   *   Can be a number for monochrome data or an array for RGB data.\n   * @param {number} index The values' index.\n   * @returns {number} The opacity of the input value in [0,255] range.\n   */\n\n  /**\n   * @callback maskAlphaFn\n   * @param {number} value The pixel value.\n   *   Can be a number for monochrome data or an array for RGB data.\n   * @param {number} index The values' index.\n   * @returns {number} The opacity of the input value in [0,255] range.\n   */\n\n  /**\n   * Per value alpha function.\n   *\n   * @type {alphaFn|maskAlphaFn}\n   */\n  #alphaFunction;\n\n  /**\n   * Image alpha function.\n   *\n   * @type {alphaFn}\n   */\n  #imageAlphaFunction = function (_value, _index) {\n    // default always returns fully visible\n    return 0xff;\n  };\n\n  /**\n   * Mask image alpha function.\n   *\n   * @type {maskAlphaFn}\n   */\n  #maskAlphaFuntion = (value, index) => {\n    // transparent: 0 (background) and hidden\n    if (value === 0 || this.#segmentViewHelper.isHidden(value)) {\n      return 0;\n    } else {\n      if (this.getContourThickness() !== 0) {\n        // ideally getContourDistance would be passed in by an\n        // iterator, but that would require a large change to a\n        // lot of components for this one edge case.\n        const contourDistance =\n          this.#image.getContourDistance(\n            index,\n            this.getOrientation()\n          );\n        if (contourDistance <= this.getContourThickness()) {\n          return 0xff;\n        } else {\n          return 0xff * this.getFillOpacity();\n        }\n      } else {\n        return 0xff * this.getFillOpacity();\n      }\n    }\n  };\n\n  /**\n   * Segment view helper to handle\n   *   hidden segments.\n   *\n   * @type {MaskSegmentViewHelper|undefined}\n   */\n  #segmentViewHelper;\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * @param {Image} image The associated image.\n   */\n  constructor(image) {\n    this.setImage(image);\n  }\n\n  /**\n   * Get the associated image.\n   *\n   * @returns {Image} The associated image.\n   */\n  getImage() {\n    return this.#image;\n  }\n\n  /**\n   * Set the associated image.\n   *\n   * @param {Image} image The associated image.\n   */\n  setImage(image) {\n    this.#image = image;\n\n    // default to middle index\n    if (typeof this.getCurrentPosition() === 'undefined') {\n      this.setCurrentIndex(this.#getMiddleIndex(), true);\n    }\n\n    // reset alpha function\n    if (this.isMask()) {\n      // default helper\n      this.#segmentViewHelper = new MaskSegmentViewHelper();\n      // mask alpha func\n      this.#alphaFunction = this.#maskAlphaFuntion;\n    } else {\n      // image alpha func\n      this.#alphaFunction = this.#imageAlphaFunction;\n      // listen to appendframe event to update the current position\n      //   to add the extra dimension\n      this.#image.addEventListener('appendframe', () => {\n        // update current position if first appendFrame\n        const index = this.getCurrentIndex();\n        if (index.length() === 3) {\n          // add dimension\n          const values = index.getValues();\n          values.push(0);\n          this.setCurrentIndex(new Index(values), true);\n        }\n      });\n    }\n  }\n\n  /**\n   * Check is the associated image is a mask.\n   *\n   * @returns {boolean} True if the associated image is a mask.\n   */\n  isMask() {\n    return this.#image.getMeta().Modality === 'SEG';\n  }\n\n  /**\n   * Set the mask segment view helper to handle\n   *   hidden segments.\n   *\n   * @param {MaskSegmentViewHelper} helper The helper.\n   */\n  setMaskViewHelper(helper) {\n    this.#segmentViewHelper = helper;\n\n    this.#fireEvent({\n      type: 'alphafuncchange'\n    });\n  }\n\n  /**\n   * Get the view orientation.\n   *\n   * @returns {Matrix33} The orientation matrix.\n   */\n  getOrientation() {\n    return this.#orientation;\n  }\n\n  /**\n   * Set the view orientation.\n   *\n   * @param {Matrix33} mat33 The orientation matrix.\n   */\n  setOrientation(mat33) {\n    this.#orientation = mat33;\n  }\n\n  /**\n   * Get the fill opacity relative to the global opacity.\n   *\n   * @returns {number} The fill opacity (between 0 and 1).\n   */\n  getFillOpacity() {\n    return this.#fillOpacity;\n  }\n\n  /**\n   * Set the fill opacity relative to the global opacity.\n   * This only has an effect on segmentation views, or any other alpha\n   * function that makes use of it.\n   *\n   * @param {number} opacity The fill opacity (between 0 and 1).\n   */\n  setFillOpacity(opacity) {\n    // Clamp to 0,1\n    if (opacity > 1) {\n      this.#fillOpacity = 1;\n    } else if (opacity < 0) {\n      this.#fillOpacity = 0;\n    } else {\n      this.#fillOpacity = opacity;\n    }\n\n    /**\n     * Mask view change event.\n     *\n     * @event View#maskviewchange\n     * @type {object}\n     * @property {string} type The event type.\n     */\n    this.#fireEvent({\n      type: 'maskviewchange',\n      value: [this.#fillOpacity, this.#contourThickness]\n    });\n  }\n\n  /**\n   * Get the thickness of the contour in pixels.\n   *\n   * @returns {number} The contour thickness (0 <= integer <= MAX_CONTOUR_SIZE).\n   */\n  getContourThickness() {\n    return this.#contourThickness;\n  }\n\n  /**\n   * Set the thickness of the contour in pixels.\n   * This only has an effect on segmentation views, or any other alpha\n   * function that makes use of it.\n   *\n   * @param {number} thickness The contour thickness\n   *  (0 <= integer <= MAX_CONTOUR_SIZE).\n   */\n  setContourThickness(thickness) {\n    if (thickness < 0) {\n      this.#contourThickness = 0;\n    } else if (thickness > MAX_CONTOUR_SIZE) {\n      this.#contourThickness = MAX_CONTOUR_SIZE;\n    } else {\n      this.#contourThickness = thickness;\n    }\n\n    // fire mask view change\n    this.#fireEvent({\n      type: 'maskviewchange',\n      value: [this.#fillOpacity, this.#contourThickness]\n    });\n  }\n\n  /**\n   * Get the middle index of the current image.\n   *\n   * @returns {Index} The middle index.\n   */\n  #getMiddleIndex() {\n    const geometry = this.#image.getGeometry();\n    const size = geometry.getSize();\n    const values = new Array(size.length());\n    values.fill(0);\n    // middle\n    values[0] = Math.floor(size.get(0) / 2);\n    values[1] = Math.floor(size.get(1) / 2);\n    values[2] = Math.floor(size.get(2) / 2);\n    return size.normaliseIndex(new Index(values));\n  }\n\n  /**\n   * Get the milliseconds per frame from frame rate.\n   *\n   * @param {number} recommendedDisplayFrameRate Recommended Display Frame Rate.\n   * @returns {number} The milliseconds per frame.\n   */\n  getPlaybackMilliseconds(recommendedDisplayFrameRate) {\n    if (!recommendedDisplayFrameRate) {\n      // Default to 10 FPS if none is found in the meta\n      recommendedDisplayFrameRate = 10;\n    }\n    // round milliseconds per frame to nearest whole number\n    return Math.round(1000 / recommendedDisplayFrameRate);\n  }\n\n  /**\n   * Get the alpha function.\n   *\n   * @returns {alphaFn} The function.\n   */\n  getAlphaFunction() {\n    return this.#alphaFunction;\n  }\n\n  /**\n   * Set alpha function.\n   *\n   * @param {alphaFn} func The function.\n   * @fires View#alphafuncchange\n   */\n  setAlphaFunction(func) {\n    this.#alphaFunction = func;\n    /**\n     * Alpha func change event.\n     *\n     * @event View#alphafuncchange\n     * @type {object}\n     * @property {string} type The event type.\n     */\n    this.#fireEvent({\n      type: 'alphafuncchange'\n    });\n  }\n\n  /**\n   * Get the window LUT of the image.\n   * Warning: can be undefined in no window/level was set.\n   *\n   * @returns {WindowLut} The window LUT of the image.\n   * @fires View#wlchange\n   */\n  #getCurrentWindowLut() {\n    // special case for 'perslice' presets\n    if (typeof this.#currentPresetName !== 'undefined' &&\n      typeof this.#windowPresets[this.#currentPresetName] !== 'undefined' &&\n      typeof this.#windowPresets[this.#currentPresetName].perslice !==\n      'undefined' &&\n      this.#windowPresets[this.#currentPresetName].perslice === true &&\n      // TODO: we currently can't handle per-slice wl on resampled images\n      !this.#image.isResampled()) {\n      // get the slice window level\n      const currentIndex = this.getCurrentIndex();\n      if (typeof currentIndex === 'undefined') {\n        throw new Error('Cannot get window lut with no current index');\n      }\n      const offset = this.#image.getSecondaryOffset(currentIndex);\n      const currentPreset = this.#windowPresets[this.#currentPresetName];\n      const sliceWl = currentPreset.wl[offset];\n      // set window level: will send a change event, mark it as silent as\n      // this change is always triggered by a position change\n      if (typeof sliceWl !== 'undefined') {\n        this.setWindowLevel(sliceWl, this.#currentPresetName, true);\n      }\n    }\n\n    // if no current, use first id\n    if (typeof this.#currentWl === 'undefined') {\n      this.setWindowLevelPresetById(0, true);\n    }\n\n    // get the window lut\n    if (typeof this.#isConstantRSI === 'undefined' ||\n      this.#image.isConstantRSI() !== this.#isConstantRSI) {\n      this.#isConstantRSI = this.#image.isConstantRSI();\n      // set or update windowLut if isConstantRSI has changed\n      // (can be different at first slice and after having loaded\n      //  the full volume...)\n      let rsi;\n      let isDiscrete;\n      if (this.#isConstantRSI) {\n        rsi = this.#image.getRescaleSlopeAndIntercept();\n        isDiscrete = true;\n      } else {\n        rsi = new RescaleSlopeAndIntercept(1, 0);\n        isDiscrete = false;\n      }\n      // create the rescale lookup table\n      const modalityLut = new ModalityLut(\n        rsi,\n        this.#image.getMeta().BitsStored);\n      // create the window lookup table\n      this.#windowLut = new WindowLut(\n        modalityLut,\n        this.#image.getMeta().PixelRepresentation === 1,\n        isDiscrete);\n    }\n\n    // update VOI lut if not present or its window level\n    // is different from the current one\n    const voiLut = this.#windowLut.getVoiLut();\n    let voiLutWl;\n    if (typeof voiLut !== 'undefined') {\n      voiLutWl = voiLut.getWindowLevel();\n    }\n    if (typeof voiLut === 'undefined' ||\n      !equalWl(this.#currentWl, voiLutWl)) {\n      // set lut window level\n      const voiLut = new VoiLut(\n        this.#currentWl,\n        this.#image.getMeta().VOILUTFunction\n      );\n      this.#windowLut.setVoiLut(voiLut);\n    }\n\n    // return\n    return this.#windowLut;\n  }\n\n  /**\n   * Get the window presets.\n   *\n   * @returns {object} The window presets.\n   */\n  getWindowPresets() {\n    return this.#windowPresets;\n  }\n\n  /**\n   * Get the window presets names.\n   *\n   * @returns {string[]} The list of window presets names.\n   */\n  getWindowPresetsNames() {\n    return Object.keys(this.#windowPresets);\n  }\n\n  /**\n   * Set the window presets.\n   *\n   * @param {object} presets The window presets.\n   */\n  setWindowPresets(presets) {\n    this.#windowPresets = presets;\n  }\n\n  /**\n   * Add window presets to the existing ones.\n   *\n   * @param {object} presets The window presets.\n   */\n  addWindowPresets(presets) {\n    const keys = Object.keys(presets);\n    let key = null;\n    for (let i = 0; i < keys.length; ++i) {\n      key = keys[i];\n      if (typeof this.#windowPresets[key] !== 'undefined') {\n        if (typeof this.#windowPresets[key].perslice !== 'undefined' &&\n          this.#windowPresets[key].perslice === true) {\n          throw new Error('Cannot add perslice preset');\n        } else {\n          // update existing\n          this.#windowPresets[key] = presets[key];\n        }\n      } else {\n        // add new\n        this.#windowPresets[key] = presets[key];\n        // fire event\n        /**\n         * Window/level add preset event.\n         *\n         * @event View#wlpresetadd\n         * @type {object}\n         * @property {string} type The event type.\n         * @property {string} name The name of the preset.\n         */\n        this.#fireEvent({\n          type: 'wlpresetadd',\n          name: key\n        });\n      }\n    }\n  }\n\n  /**\n   * Get the current window level preset name.\n   *\n   * @returns {string|undefined} The preset name.\n   */\n  getCurrentWindowPresetName() {\n    return this.#currentPresetName;\n  }\n\n  /**\n   * Get the colour map of the image.\n   *\n   * @returns {string} The colour map name.\n   */\n  getColourMap() {\n    return this.#colourMapName;\n  }\n\n  /**\n   * Get the colour map object.\n   *\n   * @returns {ColourMap} The colour map.\n   */\n  #getColourMapLut() {\n    return luts[this.#colourMapName];\n  }\n\n  /**\n   * Set the colour map of the image.\n   *\n   * @param {string} name The colour map name.\n   * @fires View#colourmapchange\n   */\n  setColourMap(name) {\n    // check if we have it\n    if (!luts[name]) {\n      throw new Error('Unknown colour map: \\'' + name + '\\'');\n    }\n\n    this.#colourMapName = name;\n\n    /**\n     * Color change event.\n     *\n     * @event View#colourmapchange\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {Array} value The changed value.\n     */\n    this.#fireEvent({\n      type: 'colourmapchange',\n      value: [name]\n    });\n  }\n\n  /**\n   * Get the current position.\n   *\n   * @returns {Point|undefined} The current position.\n   */\n  getCurrentPosition() {\n    return this.#currentPosition;\n  }\n\n  /**\n   * Get the current index.\n   *\n   * @returns {Index|undefined} The current index.\n   */\n  getCurrentIndex() {\n    const position = this.getCurrentPosition();\n    if (typeof position === 'undefined') {\n      return;\n    }\n    const geometry = this.getImage().getGeometry();\n    return geometry.worldToIndex(position);\n  }\n\n  /**\n   * Get the SOP image UID of the current image.\n   *\n   * @returns {string} The UID.\n   */\n  getCurrentImageUid() {\n    return this.#image.getImageUid(this.getCurrentIndex());\n  }\n\n  /**\n   * Get the image origin for a image UID.\n   *\n   * @param {string} uid The UID.\n   * @returns {Point3D|undefined} The origin.\n   */\n  getOriginForImageUid(uid) {\n    return this.#image.getOriginForImageUid(uid);\n  }\n\n  /**\n   * Check if the image includes an UID.\n   *\n   * @param {string} uid The UID.\n   * @returns {boolean} True if present.\n   */\n  includesImageUid(uid) {\n    return this.#image.includesImageUid(uid);\n  }\n\n  /**\n   * Check if the current position (default) or\n   * the provided position is in bounds.\n   *\n   * @param {Point} [position] Optional position.\n   * @returns {boolean} True is the position is in bounds.\n   */\n  isPositionInBounds(position) {\n    if (typeof position === 'undefined') {\n      position = this.#currentPosition;\n    }\n    const geometry = this.#image.getGeometry();\n    const index = geometry.worldToIndex(position);\n    const dirs = [this.getScrollDimIndex()];\n    if (index.length() === 4) {\n      dirs.push(3);\n    }\n    return geometry.isIndexInBounds(index, dirs);\n  }\n\n  /**\n   * Get the first origin or at a given position.\n   *\n   * @param {Point} [position] Optional position.\n   * @returns {Point3D} The origin.\n   */\n  getOrigin(position) {\n    const geometry = this.#image.getGeometry();\n    let originIndex = 0;\n    if (typeof position !== 'undefined') {\n      const index = geometry.worldToIndex(position);\n      // index is reoriented, 2 is scroll index\n      originIndex = index.get(2);\n    }\n    return geometry.getOrigins()[originIndex];\n  }\n\n  /**\n   * Set the current position via an index.\n   *\n   * @param {Index} index The new index.\n   * @param {boolean} [silent] Flag to fire event or not.\n   * @returns {boolean} False if not in bounds.\n   * @fires View#positionchange\n   */\n  setCurrentIndex(index, silent) {\n    const geometry = this.#image.getGeometry();\n    const position = geometry.indexToWorld(index);\n    return this.setCurrentPosition(position, silent);\n  }\n\n  /**\n   * Set current position.\n   *\n   * @param {Point} inPosition The new position.\n   * @param {boolean} [silent] Flag to fire event or not.\n   * @returns {boolean} False if not in bounds.\n   * @fires View#positionchange\n   */\n  setCurrentPosition(inPosition, silent) {\n    // check input\n    if (typeof silent === 'undefined') {\n      silent = false;\n    }\n\n    const geometry = this.#image.getGeometry();\n    const position = geometry.getSize().normalisePoint(\n      inPosition, this.#currentPosition);\n    const index = geometry.worldToIndex(position);\n\n    // check if possible\n    const dirs = [this.getScrollDimIndex()];\n    if (index.length() === 4) {\n      dirs.push(3);\n    }\n    if (!geometry.isIndexInBounds(index, dirs)) {\n      this.#currentPosition = position;\n      if (!silent) {\n        // fire event with valid: false\n        this.#fireEvent({\n          type: 'positionchange',\n          value: [\n            index.getValues(),\n            inPosition.getValues(),\n          ],\n          valid: false\n        });\n      }\n\n      // do no send invalid positionchange event: avoid empty repaint\n      return false;\n    }\n\n    // calculate diff dims before updating internal\n    let diffDims = [];\n    const currentIndex = this.getCurrentIndex();\n    if (typeof currentIndex !== 'undefined') {\n      if (currentIndex.canCompare(index)) {\n        diffDims = currentIndex.compare(index);\n      } else {\n        const minLen = Math.min(currentIndex.length(), index.length());\n        for (let i = 0; i < minLen; ++i) {\n          if (currentIndex.get(i) !== index.get(i)) {\n            diffDims.push(i);\n          }\n        }\n        const maxLen = Math.max(currentIndex.length(), index.length());\n        for (let j = minLen; j < maxLen; ++j) {\n          diffDims.push(j);\n        }\n      }\n    } else {\n      for (let k = 0; k < index.length(); ++k) {\n        diffDims.push(k);\n      }\n    }\n\n    // assign\n    this.#currentPosition = position;\n\n    if (!silent) {\n      /**\n       * Position change event.\n       *\n       * @event View#positionchange\n       * @type {object}\n       * @property {Array} value The changed value as [index, pixelValue].\n       * @property {number[]} diffDims An array of modified indices.\n       */\n      const posEvent = {\n        type: 'positionchange',\n        value: [\n          index.getValues(),\n          inPosition.getValues(),\n        ],\n        diffDims: diffDims,\n        data: {\n          imageUid: this.#image.getImageUid(index)\n        }\n      };\n\n      // add value if possible\n      if (this.#image.canQuantify()) {\n        const pixValue = this.#image.getRescaledValueAtIndex(index);\n        posEvent.value.push(pixValue);\n      }\n\n      // fire\n      this.#fireEvent(posEvent);\n    }\n\n    // all good\n    return true;\n  }\n\n  /**\n   * Set the view window/level.\n   *\n   * @param {WindowLevel} wl The window and level.\n   * @param {string} [name] Associated preset name, defaults to 'manual'.\n   * Warning: uses the latest set rescale LUT or the default linear one.\n   * @param {boolean} [silent] Flag to launch events with skipGenerate.\n   * @fires View#wlchange\n   */\n  setWindowLevel(wl, name, silent) {\n    // check input\n    if (typeof name === 'undefined') {\n      name = 'manual';\n    }\n    if (name !== 'manual' &&\n      typeof this.#windowPresets[name] === 'undefined') {\n      throw new Error('Unknown window level preset: \\'' + name + '\\'');\n    }\n    if (typeof silent === 'undefined') {\n      silent = false;\n    }\n\n    // bound window center and width\n    const wlBound = validateWindowLevel(\n      wl,\n      this.#image.getRescaledDataRange(),\n      this.#image.getMeta().VOILUTFunction\n    );\n\n    // check if new wl\n    const isNewWl = !equalWl(wlBound, this.#currentWl);\n    // check if new name\n    const isNewName = this.#currentPresetName !== name;\n\n    // compare to previous if present\n    if (isNewWl || isNewName) {\n      // assign\n      this.#currentWl = wlBound;\n      this.#currentPresetName = name;\n\n      // update manual\n      if (name === 'manual') {\n        if (typeof this.#windowPresets[name] !== 'undefined') {\n          this.#windowPresets[name].wl[0] = wlBound;\n        } else {\n          // add if not present\n          this.addWindowPresets({\n            manual: {\n              wl: [wlBound],\n              name: 'manual'\n            }\n          });\n        }\n      }\n\n      /**\n       * Window/level change event.\n       *\n       * @event View#wlchange\n       * @type {object}\n       * @property {string} type The event type.\n       * @property {Array} value The changed value.\n       * @property {number} wc The new window center value.\n       * @property {number} ww The new window wdth value.\n       * @property {boolean} skipGenerate Flag to skip view generation.\n       */\n      this.#fireEvent({\n        type: 'wlchange',\n        value: [wlBound.center, wlBound.width, name],\n        wc: wlBound.center,\n        ww: wlBound.width,\n        skipGenerate: silent\n      });\n    }\n  }\n\n  /**\n   * Get the window/level.\n   *\n   * @returns {WindowLevel} The window and level.\n   */\n  getWindowLevel() {\n    // same as #currentWl...\n    const windowLut = this.#getCurrentWindowLut();\n    return windowLut.getVoiLut().getWindowLevel();\n  }\n\n  /**\n   * Set the window level to the preset with the input name.\n   *\n   * @param {string} name The name of the preset to activate.\n   * @param {boolean} [silent] Flag to launch events with skipGenerate.\n   */\n  setWindowLevelPreset(name, silent) {\n    const preset = this.getWindowPresets()[name];\n    if (typeof preset === 'undefined') {\n      throw new Error('Unknown window level preset: \\'' + name + '\\'');\n    }\n    // special min/max\n    if (name === 'minmax' && typeof preset.wl === 'undefined') {\n      preset.wl = [this.getWindowLevelMinMax()];\n    }\n    // default to first\n    let wl = preset.wl[0];\n    // check if 'perslice' case\n    if (typeof preset.perslice !== 'undefined' &&\n      preset.perslice === true &&\n      // TODO: we currently can't handle per-slice wl on resampled images\n      !this.#image.isResampled()) {\n      const offset = this.#image.getSecondaryOffset(this.getCurrentIndex());\n      wl = preset.wl[offset];\n    }\n    // set w/l\n    if (typeof wl !== 'undefined') {\n      this.setWindowLevel(wl, name, silent);\n    }\n  }\n\n  /**\n   * Set the window level to the preset with the input id.\n   *\n   * @param {number} id The id of the preset to activate.\n   * @param {boolean} [silent] Flag to launch events with skipGenerate.\n   */\n  setWindowLevelPresetById(id, silent) {\n    const keys = Object.keys(this.getWindowPresets());\n    this.setWindowLevelPreset(keys[id], silent);\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    this.#listenerHandler.fireEvent(event);\n  };\n\n  /**\n   * Get the image window/level that covers the full data range.\n   * Warning: uses the latest set rescale LUT or the default linear one.\n   *\n   * @returns {WindowLevel} A min/max window level.\n   */\n  getWindowLevelMinMax() {\n    const range = this.getImage().getRescaledDataRange();\n    const width = range.max - range.min;\n    const center = range.min + width / 2;\n    return validateWindowLevel(\n      new WindowLevel(center, width),\n      range,\n      this.#image.getMeta().VOILUTFunction\n    );\n  }\n\n  /**\n   * Set the image window/level to cover the full data range.\n   * Warning: uses the latest set rescale LUT or the default linear one.\n   */\n  setWindowLevelMinMax() {\n    // calculate center and width\n    const wl = this.getWindowLevelMinMax();\n    // set window level\n    this.setWindowLevel(wl, 'minmax');\n  }\n\n  /**\n   * Generate display image data to be given to a canvas.\n   *\n   * @param {ImageData} data The iamge data to fill in.\n   * @param {Index} index Optional index at which to generate,\n   *   otherwise generates at current index.\n   */\n  generateImageData(data, index) {\n    // check index\n    if (typeof index === 'undefined') {\n      // use current index\n      index = this.getCurrentIndex();\n      if (typeof index === 'undefined') {\n        throw new Error('Cannot generate image data with no current index');\n      }\n    }\n\n    const image = this.getImage();\n    const isRescaled = !image.isConstantRSI();\n    const iterator = getSliceIterator(\n      image, index, isRescaled, this.getOrientation());\n\n    const photoInterpretation = image.getPhotometricInterpretation();\n    switch (photoInterpretation) {\n      case 'MONOCHROME1':\n      case 'MONOCHROME2':\n        generateImageDataMonochrome(\n          data,\n          iterator,\n          this.getAlphaFunction(),\n          this.#getCurrentWindowLut(),\n          this.#getColourMapLut()\n        );\n        break;\n\n      case 'PALETTE COLOR':\n        generateImageDataPaletteColor(\n          data,\n          iterator,\n          this.getAlphaFunction(),\n          image.getPaletteColourMap(),\n          image.getMeta().BitsStored === 16\n        );\n        break;\n\n      case 'RGB':\n        generateImageDataRgb(\n          data,\n          iterator,\n          this.getAlphaFunction()\n        );\n        break;\n\n      case 'YBR_FULL':\n        generateImageDataYbrFull(\n          data,\n          iterator,\n          this.getAlphaFunction()\n        );\n        break;\n\n      default:\n        throw new Error(\n          'Unsupported photometric interpretation: ' + photoInterpretation);\n    }\n  }\n\n  /**\n   * Get the scroll dimension index.\n   *\n   * @returns {number} The index.\n   */\n  getScrollDimIndex() {\n    // default to z\n    let index = 2;\n    // use orientation if available\n    const orientation = this.getOrientation();\n    if (typeof orientation !== 'undefined') {\n      index = orientation.getThirdColMajorDirection();\n    }\n    return index;\n  }\n\n  /**\n   * Is this view in the same orientation as the image aquisition.\n   *\n   * @returns {boolean} True if in aquisition plane.\n   */\n  isAquisitionOrientation() {\n    return isIdentityMat33(this.#orientation);\n  }\n\n} // class View\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {WindowLut} from './windowLut.js';\nimport {ColourMap} from './luts.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Generate image data for 'MONOCHROME*' photometric interpretation.\n *\n * @param {ImageData} array The array to store the outut data.\n * @param {object} iterator Position iterator.\n * @param {Function} alphaFunc The alpha function.\n * @param {WindowLut} windowLut The window/level LUT.\n * @param {ColourMap} colourMap The colour map.\n */\nexport function generateImageDataMonochrome(\n  array,\n  iterator,\n  alphaFunc,\n  windowLut,\n  colourMap) {\n  let index = 0;\n  let pxValue = 0;\n  let ival = iterator.next();\n  while (!ival.done) {\n    // pixel value\n    pxValue = windowLut.getValue(ival.value);\n    // store data\n    array.data[index] = colourMap.red[pxValue];\n    array.data[index + 1] = colourMap.green[pxValue];\n    array.data[index + 2] = colourMap.blue[pxValue];\n    array.data[index + 3] = alphaFunc(ival.value, ival.index);\n    // increment\n    index += 4;\n    ival = iterator.next();\n  }\n}\n","import {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {ColourMap} from './luts.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Generate image data for 'PALETTE COLOR' photometric interpretation.\n *\n * @param {ImageData} array The array to store the outut data.\n * @param {object} iterator Position iterator.\n * @param {Function} alphaFunc The alpha function.\n * @param {ColourMap} colourMap The colour map.\n * @param {boolean} is16BitsStored Flag to know if the data is 16bits.\n */\nexport function generateImageDataPaletteColor(\n  array,\n  iterator,\n  alphaFunc,\n  colourMap,\n  is16BitsStored) {\n  // right shift 8\n  const to8 = function (value) {\n    return value >> 8;\n  };\n\n  if (is16BitsStored) {\n    logger.info('Scaling 16bits data to 8bits.');\n  }\n\n  let index = 0;\n  let pxValue = 0;\n  let ival = iterator.next();\n  while (!ival.done) {\n    // pixel value\n    pxValue = ival.value;\n    // store data\n    // TODO check pxValue fits in lut\n    if (is16BitsStored) {\n      array.data[index] = to8(colourMap.red[pxValue]);\n      array.data[index + 1] = to8(colourMap.green[pxValue]);\n      array.data[index + 2] = to8(colourMap.blue[pxValue]);\n    } else {\n      array.data[index] = colourMap.red[pxValue];\n      array.data[index + 1] = colourMap.green[pxValue];\n      array.data[index + 2] = colourMap.blue[pxValue];\n    }\n    array.data[index + 3] = alphaFunc(pxValue, ival.index);\n    // increment\n    index += 4;\n    ival = iterator.next();\n  }\n}\n","/**\n * Generate image data for 'RGB' photometric interpretation.\n *\n * @param {ImageData} array The array to store the outut data.\n * @param {object} iterator Position iterator.\n * @param {Function} alphaFunc The alpha function.\n */\nexport function generateImageDataRgb(\n  array,\n  iterator,\n  alphaFunc) {\n  let index = 0;\n  let ival = iterator.next();\n  while (!ival.done) {\n    // store data\n    array.data[index] = ival.value[0];\n    array.data[index + 1] = ival.value[1];\n    array.data[index + 2] = ival.value[2];\n    array.data[index + 3] = alphaFunc(ival.value, ival.index);\n    // increment\n    index += 4;\n    ival = iterator.next();\n  }\n}\n","import {ybrToRgb} from '../utils/colour.js';\n\n/**\n * Generate image data for 'YBR_FULL' photometric interpretation.\n *\n * @param {ImageData} array The array to store the outut data.\n * @param {object} iterator Position iterator.\n * @param {Function} alphaFunc The alpha function.\n */\nexport function generateImageDataYbrFull(\n  array,\n  iterator,\n  alphaFunc) {\n  let index = 0;\n  let rgb = null;\n  let ival = iterator.next();\n  while (!ival.done) {\n    // convert ybr to rgb\n    rgb = ybrToRgb(ival.value[0], ival.value[1], ival.value[2]);\n    // store data\n    array.data[index] = rgb.r;\n    array.data[index + 1] = rgb.g;\n    array.data[index + 2] = rgb.b;\n    array.data[index + 3] = alphaFunc(ival.value, ival.index);\n    // increment\n    index += 4;\n    ival = iterator.next();\n  }\n}\n","/**\n * Namespace for translation function\n *   (in a namespace to allow for override from client).\n */\nexport const i18n = {\n\n  /**\n   * Get the translated text.\n   *\n   * @param {string} key The key to the text entry.\n   * @returns {string|undefined} The translated text.\n   */\n  t(key) {\n    let res = key;\n    const props = key.split('.');\n    // default units look like 'unit.cm2'\n    if (props.length === 2 &&\n      props[0] === 'unit') {\n      const units = {\n        mm: 'mm',\n        cm2: 'cm',\n        ml: 'ml',\n        degree: '',\n        pixel: 'pixels'\n      };\n      res = units[props[1]];\n    }\n    return res;\n  }\n\n};\n","\nimport {i18n} from './i18n.js';\n\n/**\n * Capitalise the first letter of a string.\n *\n * @param {string} string The string to capitalise the first letter.\n * @returns {string} The new string.\n */\nexport function capitaliseFirstLetter(string) {\n  let res = string;\n  if (string) {\n    res = string.charAt(0).toUpperCase() + string.slice(1);\n  }\n  return res;\n}\n\n/**\n * Check if a string starts with the input element.\n *\n * @param {string} str The input string.\n * @param {string} search The searched start.\n * @param {number} [rawPos] The position in this string at which to begin\n *  searching for searchString. Defaults to 0.\n * @returns {boolean} True if the input string starts with the searched string.\n */\nexport function startsWith(str, search, rawPos) {\n  if (typeof str === 'undefined' || str === null ||\n    typeof search === 'undefined' || search === null) {\n    return false;\n  }\n  const pos = rawPos > 0 ? rawPos | 0 : 0;\n  return str.substring(pos, pos + search.length) === search;\n}\n\n/**\n * Check if a string ends with the input element.\n *\n * @param {string} str The input string.\n * @param {string} search The searched ending.\n * @returns {boolean} True if the input string ends with the searched string.\n */\nexport function endsWith(str, search) {\n  if (typeof str === 'undefined' || str === null ||\n    typeof search === 'undefined' || search === null) {\n    return false;\n  }\n  return str.substring(str.length - search.length) === search;\n}\n\n/**\n * Split key/value string: `key0=val00&key0=val01&key1=val10\n *   will return `{key0 : [val00, val01], key1 : val1}`.\n *\n * @param {string} inputStr The string to split.\n * @returns {object} The split string.\n */\nexport function splitKeyValueString(inputStr) {\n  // result\n  const result = {};\n  // check input string\n  if (inputStr) {\n    // split key/value pairs\n    const pairs = inputStr.split('&');\n    for (let i = 0; i < pairs.length; ++i) {\n      const pair = pairs[i].split('=');\n      // if the key does not exist, create it\n      if (!result[pair[0]]) {\n        result[pair[0]] = pair[1];\n      } else {\n        // make it an array\n        if (!(result[pair[0]] instanceof Array)) {\n          result[pair[0]] = [result[pair[0]]];\n        }\n        result[pair[0]].push(pair[1]);\n      }\n    }\n  }\n  return result;\n}\n\n/**\n * Get flags from an input string. Flags are words surrounded with curly\n * braces.\n *\n * @param {string} inputStr The input string.\n * @returns {string[]} An array of found flags.\n */\nexport function getFlags(inputStr) {\n  const flags = [];\n  // check input string\n  if (inputStr === null || typeof inputStr === 'undefined') {\n    return flags;\n  }\n\n  // word surrounded by curly braces\n  const regex = /{(\\w+)}/g;\n\n  let match = regex.exec(inputStr);\n  while (match) {\n    flags.push(match[1]); // first matching group\n    match = regex.exec(inputStr);\n  }\n  return flags;\n}\n\n/**\n * Replace flags in a input string. Flags are keywords surrounded with curly\n * braces.\n *\n * @param {string} inputStr The input string.\n * @param {object} values A object of {value, unit}.\n * @returns {string} The result string.\n */\nexport function replaceFlags(inputStr, values) {\n  let res = '';\n  // check input string\n  if (inputStr === null || typeof inputStr === 'undefined') {\n    return res;\n  }\n  res = inputStr;\n  // check values\n  if (values === null || typeof values === 'undefined') {\n    return res;\n  }\n\n  // loop through flags\n  const keys = getFlags(inputStr);\n  for (let i = 0; i < keys.length; ++i) {\n    const valueObj = values[keys[i]];\n    if (valueObj !== null && typeof valueObj !== 'undefined' &&\n      valueObj.value !== null && typeof valueObj.value !== 'undefined') {\n      // value string\n      let valueStr = valueObj.value.toPrecision(4);\n      // add unit if available\n      // space or no space? Yes apart from degree...\n      // check: https://en.wikipedia.org/wiki/Space_(punctuation)#Spaces_and_unit_symbols\n      if (valueObj.unit !== null &&\n        typeof valueObj.unit !== 'undefined' &&\n        valueObj.unit.length !== 0) {\n        if (valueObj.unit !== 'unit.degree') {\n          valueStr += ' ';\n        }\n        valueStr += i18n.t(valueObj.unit);\n      }\n      // flag to replace\n      const flag = '{' + keys[i] + '}';\n      // replace\n      res = res.replace(flag, valueStr);\n    }\n  }\n  // return\n  return res;\n}\n\n/**\n * Get the root of an input path.\n * Splits using `/` as separator.\n *\n * @param {string} path The input path.\n * @returns {string} The input path without its last part.\n */\nexport function getRootPath(path) {\n  return path.split('/').slice(0, -1).join('/');\n}\n\n/**\n * Get a file extension: anything after the last dot.\n * File name starting with a dot are discarded.\n * Extensions are expected to contain at least one letter.\n *\n * @param {string} filePath The file path containing the file name.\n * @returns {string} The lower case file extension or null for none.\n */\nexport function getFileExtension(filePath) {\n  let ext = null;\n  if (typeof filePath !== 'undefined' &&\n    filePath !== null &&\n    filePath[0] !== '.') {\n    const pathSplit = filePath.toLowerCase().split('.');\n    if (pathSplit.length !== 1) {\n      ext = pathSplit.pop();\n      // extension should contain at least one letter and no slash\n      const regExp = /[a-z]/;\n      if (!regExp.test(ext) || ext.includes('/')) {\n        ext = null;\n      }\n    }\n  }\n  return ext;\n}\n\n/**\n * Convert a string to a Uint8Array.\n *\n * @param {string} str The string to convert.\n * @returns {Uint8Array} The Uint8Array.\n */\nexport function stringToUint8Array(str) {\n  const arr = new Uint8Array(str.length);\n  for (let i = 0, leni = str.length; i < leni; i++) {\n    arr[i] = str.charCodeAt(i);\n  }\n  return arr;\n}\n\n/**\n * Round a float number to a given precision.\n *\n * Inspired from {@link https://stackoverflow.com/a/49729715/3639892}.\n *\n * `toPrecision` uses all non zero digits of the number:\n * (123.009).toPrecision(4) = \"123.0\";\n * (0.09).toPrecision(4) = \"0.09000\".\n *\n * `toFixed` does not always behave as expected:\n * (123.009).toFixed(2) = \"123.01\";\n * (0.009).toFixed(2) = \"0.01\";\n * but\n * (-0.005).toFixed(2) = \"-0.01\" (expecting 0);\n * (1.005).toFixed(2) = \"1\" (expecting 1.01).\n *\n * @param {number} number The number to round.\n * @param {number} precision The rounding precision, ie the result number\n *   of digits after the comma.\n * @returns {number} The rounded number.\n */\nexport function precisionRound(number, precision) {\n  const factor = Math.pow(10, precision);\n  const delta = 0.01 / factor; // fixes precisionRound(1.005, 2)\n  return Math.round(number * factor + delta) / factor;\n}\n","import {stringToUint8Array} from './string.js';\n\n/**\n * Get a string id from array values in the form of: '#0-1_#1-2'.\n *\n * @param {Array} arr The input array.\n * @param {number[]} [dims] Optional list of dimensions to use.\n * @returns {string} The string id.\n */\nexport function toStringId(arr, dims) {\n  // use all dims if not as input\n  if (typeof dims === 'undefined') {\n    dims = [];\n    for (let i = 0; i < arr.length; ++i) {\n      dims.push(i);\n    }\n  }\n  // check dims\n  for (let i = 0; i < dims.length; ++i) {\n    if (dims[i] >= arr.length) {\n      throw new Error('Non valid dimension for toStringId');\n    }\n  }\n  // build string\n  let res = '';\n  for (let i = 0; i < dims.length; ++i) {\n    if (i !== 0) {\n      res += '_';\n    }\n    res += '#' + dims[i] + '-' + arr[dims[i]];\n  }\n  return res;\n}\n\n/**\n * Get an array from an id string in the form of: '#0-1_#1-2'\n * (result of toStringId).\n *\n * @param {string} inputStr The input string.\n * @returns {Array} The corresponding array (minimum size is 3D).\n */\nexport function getArrayFromStringId(inputStr) {\n  // split ids\n  const strIds = inputStr.split('_');\n  // get the size of the index (minimum 3)\n  let numberOfDims = 3;\n  let dim;\n  for (let i = 0; i < strIds.length; ++i) {\n    // expecting dim < 10\n    dim = parseInt(strIds[i].substring(1, 2), 10);\n    // dim is zero based\n    if (dim + 1 > numberOfDims) {\n      numberOfDims = dim + 1;\n    }\n  }\n  // default values\n  const values = new Array(numberOfDims);\n  values.fill(0);\n  // get other values from the input string\n  for (let j = 0; j < strIds.length; ++j) {\n    // expecting dim < 10\n    dim = parseInt(strIds[j].substring(1, 2), 10);\n    const value = parseInt(strIds[j].substring(3), 10);\n    values[dim] = value;\n  }\n\n  return values;\n}\n\n/**\n * Apply an input 'compare'function after having checked the two\n * inputs for undefined.\n *\n * @param {any} a The first input.\n * @param {any} b The second input.\n * @param {Function} func The compare function.\n * @returns {any} The result of the function applied to the inputs\n * or the not undefined input.\n */\nfunction checkAndApply(a, b, func) {\n  if (typeof a === 'undefined') {\n    return b;\n  }\n  if (typeof b === 'undefined') {\n    return a;\n  }\n  return func(a, b);\n};\n\n/**\n * Apply an input 'compare' function to items of 2 arrays.\n * The output will have a length that is the maximum of\n * both inputs.\n *\n * @param {Array} arr0 The first array.\n * @param {Array} arr1 The second array.\n * @param {Function} func The compare function.\n * @returns {Array} The result array.\n */\nexport function arrayMap(arr0, arr1, func) {\n  let res = arr0.map((v, i) => checkAndApply(v, arr1[i], func));\n  if (arr1.length > arr0.length) {\n    res = res.concat(arr1.slice(arr0.length));\n  }\n  return res;\n}\n\n/**\n * Check if the first input array contains all the\n * elements of the second input array.\n *\n * @param {string[]} arr0 The test array.\n * @param {string[]} arr1 The elements to check in the first array.\n * @returns {boolean} True if all the elements of arr1 are included in arr0.\n */\nexport function arrayContains(arr0, arr1) {\n  // check input\n  if (arr0 === null ||\n    arr1 === null ||\n    typeof arr0 === 'undefined' ||\n    typeof arr1 === 'undefined') {\n    return false;\n  }\n  if (arr0.length === 0 ||\n    arr1.length === 0 ||\n    arr1.length > arr0.length) {\n    return false;\n  }\n  // check values\n  for (const itemArr1 of arr1) {\n    if (!arr0.includes(itemArr1)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Check for array equality after sorting.\n *\n * @param {Array} arr0 First array.\n * @param {Array} arr1 Second array.\n * @returns {boolean} True if both array are defined and contain same values.\n */\nexport function arraySortEquals(arr0, arr1) {\n  if (arr0 === null ||\n    arr1 === null ||\n    typeof arr0 === 'undefined' ||\n    typeof arr1 === 'undefined') {\n    return false;\n  }\n  const arr0sorted = arr0.slice().sort();\n  const arr1sorted = arr1.slice().sort();\n  return arrayEquals(arr0sorted, arr1sorted);\n}\n\n/**\n * Check for array equality.\n *\n * @param {Array} arr0 First array.\n * @param {Array} arr1 Second array.\n * @returns {boolean} True if both array are defined and contain same values.\n */\nexport function arrayEquals(arr0, arr1) {\n  if (arr0 === null ||\n    arr1 === null ||\n    typeof arr0 === 'undefined' ||\n    typeof arr1 === 'undefined') {\n    return false;\n  }\n  if (arr0.length !== arr1.length) {\n    return false;\n  }\n  return arr0.every(function (element, index) {\n    return element === arr1[index];\n  });\n}\n\n/**\n * Convert a Uint8Array to a string.\n *\n * @param {Uint8Array} arr The array to convert.\n * @returns {string} The array as string.\n */\nexport function uint8ArrayToString(arr) {\n  return String.fromCharCode.apply(String, arr);\n}\n\n/**\n * Array find in a subset of the input array.\n * Equivalent to: `arr.slice(start, end).find(callbackFn)`.\n *\n * @param {Uint8Array} arr The input array to search.\n * @param {Function} callbackFn The find function.\n * @param {number|undefined} start The array start index.\n * @param {number|undefined} [end] The array end index.\n * @returns {number|undefined} The index where the element was found.\n */\nexport function findInArraySubset(arr, callbackFn, start, end) {\n  // check inputs\n  if (typeof start === 'undefined' ||\n    start < 0 ||\n    start >= arr.length\n  ) {\n    start = 0;\n  }\n  if (typeof end === 'undefined' ||\n    end <= start ||\n    end > arr.length) {\n    end = arr.length;\n  }\n  // run\n  for (let i = start; i < end; ++i) {\n    if (callbackFn(arr[i], i, arr)) {\n      return i;\n    }\n  }\n  return undefined;\n}\n\n/**\n * Get a find in array callback.\n *\n * @param {Uint8Array} arr1 The array to find.\n * @returns {Function} The find callback function.\n */\nexport function getFindArrayInArrayCallback(arr1) {\n  return function (element, index, arr0) {\n    for (let i = 0; i < arr1.length; ++i) {\n      if (arr0[index + i] !== arr1[i]) {\n        return false;\n      }\n    }\n    return true;\n  };\n}\n\n/**\n * Extract each element of a multipart ArrayBuffer.\n *\n * Ref: {@link https://en.wikipedia.org/wiki/MIME#Multipart_messages}.\n *\n * @param {ArrayBuffer} arr The multipart array.\n * @returns {Array} The multipart parts as an array of object as\n *   {'Content-Type', ..., data} (depending on header tags).\n */\nexport function parseMultipart(arr) {\n  const u8Array = new Uint8Array(arr);\n\n  const parts = [];\n  // check input\n  if (u8Array.length === 0) {\n    return parts;\n  }\n\n  // \\r\\n\\r\\n\n  const doubleReturnNew = new Uint8Array([0x0d, 0x0a, 0x0d, 0x0a]);\n  const partHeaderEndCb = getFindArrayInArrayCallback(doubleReturnNew);\n\n  // look for boundary in first part header\n  let partHeaderEndIndex = findInArraySubset(\n    u8Array, partHeaderEndCb, 0\n  );\n  if (typeof partHeaderEndIndex === 'undefined') {\n    throw new Error('Can\\'t find the end of the first multipart header');\n  }\n  const firstPartHeader = u8Array.slice(0, partHeaderEndIndex);\n  // switch to string to use split\n  const lines = uint8ArrayToString(firstPartHeader).split('\\r\\n');\n  // boundary should start with '--'\n  let boundaryStr;\n  for (let i = 0; i < lines.length; ++i) {\n    if (lines[i][0] === '-' && lines[i][1] === '-') {\n      boundaryStr = lines[i];\n      break;\n    }\n  }\n  if (typeof boundaryStr === 'undefined') {\n    throw new Error('Can\\'t find the boundary between multi-parts');\n  }\n  const boundary = stringToUint8Array(boundaryStr);\n  const boundaryCb = getFindArrayInArrayCallback(boundary);\n  const boundaryLen = boundaryStr.length;\n\n  // skip mime header\n  let nextBoundaryIndex = findInArraySubset(\n    u8Array, boundaryCb, 0\n  );\n\n  // loop through content\n  while (typeof partHeaderEndIndex !== 'undefined') {\n    const part = {};\n\n    // header\n    const partHeader = u8Array.slice(\n      nextBoundaryIndex + boundaryLen, partHeaderEndIndex);\n    // split into object\n    const partHeaderLines =\n      uint8ArrayToString(partHeader).split('\\r\\n');\n    for (let l = 0; l < partHeaderLines.length; ++l) {\n      const line = partHeaderLines[l];\n      const semiColonIndex = line.indexOf(':');\n      if (semiColonIndex !== -1) {\n        const key = line.substring(0, semiColonIndex).trim();\n        const val = line.substring(semiColonIndex + 1).trim();\n        part[key] = val;\n      }\n    }\n\n    // find next boundary\n    nextBoundaryIndex = findInArraySubset(\n      u8Array, boundaryCb, partHeaderEndIndex\n    );\n    // exit if none\n    if (typeof nextBoundaryIndex === 'undefined') {\n      break;\n    }\n\n    // get part\n    // partHeaderEndIndex plus the size of the '\\r\\n\\r\\n' separator\n    const dataBeginIndex = partHeaderEndIndex + 4;\n    // nextBoundaryIndex minus the previous '\\r\\n'\n    const dataEndIndex = nextBoundaryIndex - 2;\n    if (dataBeginIndex < dataEndIndex) {\n      part.data = u8Array.slice(dataBeginIndex, dataEndIndex).buffer;\n    } else {\n      part.data = new Uint8Array();\n    }\n\n    // store part\n    parts.push(part);\n\n    // find next part header end\n    partHeaderEndIndex = findInArraySubset(\n      u8Array, partHeaderEndCb,\n      nextBoundaryIndex + boundaryLen\n    );\n  }\n\n  return parts;\n}\n\n/**\n * Build a multipart message.\n *\n * Ref:\n * - {@link https://en.wikipedia.org/wiki/MIME#Multipart_messages},\n * - {@link https://hg.orthanc-server.com/orthanc-dicomweb/file/tip/Resources/Samples/JavaScript/stow-rs.js}.\n *\n * @param {Array} parts The message parts as an array of object containing\n *   content headers and messages as the data property (as returned by parse).\n * @param {string} boundary The message boundary.\n * @returns {Uint8Array} The full multipart message.\n */\nexport function buildMultipart(parts, boundary) {\n  const lineBreak = '\\r\\n';\n  // build headers and calculate size\n  let partsSize = 0;\n  const headers = [];\n  for (let i = 0; i < parts.length; ++i) {\n    let headerStr = '';\n    if (i !== 0) {\n      headerStr += lineBreak;\n    }\n    headerStr += '--' + boundary + lineBreak;\n    const partKeys = Object.keys(parts[i]);\n    for (let k = 0; k < partKeys.length; ++k) {\n      const key = partKeys[k];\n      if (key !== 'data') {\n        headerStr += key + ': ' + parts[i][key] + lineBreak;\n      }\n    }\n    headerStr += lineBreak;\n    const header = stringToUint8Array(headerStr);\n    headers.push(header);\n    partsSize += header.byteLength + parts[i].data.byteLength;\n  }\n  // build trailer\n  const trailerStr = lineBreak + '--' + boundary + '--' + lineBreak;\n  const trailer = stringToUint8Array(trailerStr);\n\n  // final buffer\n  const buffer = new Uint8Array(partsSize + trailer.byteLength);\n  let offset = 0;\n  // concatenate parts\n  for (let j = 0; j < parts.length; ++j) {\n    buffer.set(headers[j], offset);\n    offset += headers[j].byteLength;\n    buffer.set(new Uint8Array(parts[j].data), offset);\n    offset += parts[j].data.byteLength;\n  }\n  // end buffer with trailer\n  buffer.set(trailer, offset);\n\n  // return\n  return buffer;\n}\n","/* eslint-disable @stylistic/js/quote-props */\n/* eslint @stylistic/js/max-len:0 */\n\n/**\n * DICOM tag dictionary 2022a.\n * Generated using xml standard conversion from {@link https://github.com/ivmartel/dcmStdToJs} v0.1.0.\n *\n * Conversion changes:\n * - (vr) 'See Note' -> 'NONE',\n * - (vr) 'OB or OW' -> 'ox',\n * - (vr) 'US or SS' -> 'xs',\n * - (vr) 'US or OW' -> 'xx',\n * - (vr) 'US or SS or OW' -> 'xs',\n * - added 'GenericGroupLength' element to each group.\n *\n * Local changes:\n * - tag numbers with 'xx' were replaced with '00', 'xxx' with '001' and\n *  'xxxx' with '0004'.\n *\n * @type {Object<string, Object<string, string[]>>}\n */\nexport const dictionary = {\n  '0000': {\n    '0000': ['UL', '1', 'CommandGroupLength'],\n    '0001': ['UL', '1', 'CommandLengthToEnd'],\n    '0002': ['UI', '1', 'AffectedSOPClassUID'],\n    '0003': ['UI', '1', 'RequestedSOPClassUID'],\n    '0010': ['SH', '1', 'CommandRecognitionCode'],\n    '0100': ['US', '1', 'CommandField'],\n    '0110': ['US', '1', 'MessageID'],\n    '0120': ['US', '1', 'MessageIDBeingRespondedTo'],\n    '0200': ['AE', '1', 'Initiator'],\n    '0300': ['AE', '1', 'Receiver'],\n    '0400': ['AE', '1', 'FindLocation'],\n    '0600': ['AE', '1', 'MoveDestination'],\n    '0700': ['US', '1', 'Priority'],\n    '0800': ['US', '1', 'CommandDataSetType'],\n    '0850': ['US', '1', 'NumberOfMatches'],\n    '0860': ['US', '1', 'ResponseSequenceNumber'],\n    '0900': ['US', '1', 'Status'],\n    '0901': ['AT', '1-n', 'OffendingElement'],\n    '0902': ['LO', '1', 'ErrorComment'],\n    '0903': ['US', '1', 'ErrorID'],\n    '1000': ['UI', '1', 'AffectedSOPInstanceUID'],\n    '1001': ['UI', '1', 'RequestedSOPInstanceUID'],\n    '1002': ['US', '1', 'EventTypeID'],\n    '1005': ['AT', '1-n', 'AttributeIdentifierList'],\n    '1008': ['US', '1', 'ActionTypeID'],\n    '1020': ['US', '1', 'NumberOfRemainingSuboperations'],\n    '1021': ['US', '1', 'NumberOfCompletedSuboperations'],\n    '1022': ['US', '1', 'NumberOfFailedSuboperations'],\n    '1023': ['US', '1', 'NumberOfWarningSuboperations'],\n    '1030': ['AE', '1', 'MoveOriginatorApplicationEntityTitle'],\n    '1031': ['US', '1', 'MoveOriginatorMessageID'],\n    '4000': ['LT', '1', 'DialogReceiver'],\n    '4010': ['LT', '1', 'TerminalType'],\n    '5010': ['SH', '1', 'MessageSetID'],\n    '5020': ['SH', '1', 'EndMessageID'],\n    '5110': ['LT', '1', 'DisplayFormat'],\n    '5120': ['LT', '1', 'PagePositionID'],\n    '5130': ['CS', '1', 'TextFormatID'],\n    '5140': ['CS', '1', 'NormalReverse'],\n    '5150': ['CS', '1', 'AddGrayScale'],\n    '5160': ['CS', '1', 'Borders'],\n    '5170': ['IS', '1', 'Copies'],\n    '5180': ['CS', '1', 'CommandMagnificationType'],\n    '5190': ['CS', '1', 'Erase'],\n    '51A0': ['CS', '1', 'Print'],\n    '51B0': ['US', '1-n', 'Overlays']\n  },\n  '0002': {\n    '0000': ['UL', '1', 'FileMetaInformationGroupLength'],\n    '0001': ['OB', '1', 'FileMetaInformationVersion'],\n    '0002': ['UI', '1', 'MediaStorageSOPClassUID'],\n    '0003': ['UI', '1', 'MediaStorageSOPInstanceUID'],\n    '0010': ['UI', '1', 'TransferSyntaxUID'],\n    '0012': ['UI', '1', 'ImplementationClassUID'],\n    '0013': ['SH', '1', 'ImplementationVersionName'],\n    '0016': ['AE', '1', 'SourceApplicationEntityTitle'],\n    '0017': ['AE', '1', 'SendingApplicationEntityTitle'],\n    '0018': ['AE', '1', 'ReceivingApplicationEntityTitle'],\n    '0026': ['UR', '1', 'SourcePresentationAddress'],\n    '0027': ['UR', '1', 'SendingPresentationAddress'],\n    '0028': ['UR', '1', 'ReceivingPresentationAddress'],\n    '0031': ['OB', '1', 'RTVMetaInformationVersion'],\n    '0032': ['UI', '1', 'RTVCommunicationSOPClassUID'],\n    '0033': ['UI', '1', 'RTVCommunicationSOPInstanceUID'],\n    '0035': ['OB', '1', 'RTVSourceIdentifier'],\n    '0036': ['OB', '1', 'RTVFlowIdentifier'],\n    '0037': ['UL', '1', 'RTVFlowRTPSamplingRate'],\n    '0038': ['FD', '1', 'RTVFlowActualFrameDuration'],\n    '0100': ['UI', '1', 'PrivateInformationCreatorUID'],\n    '0102': ['OB', '1', 'PrivateInformation']\n  },\n  '0004': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '1130': ['CS', '1', 'FileSetID'],\n    '1141': ['CS', '1-8', 'FileSetDescriptorFileID'],\n    '1142': ['CS', '1', 'SpecificCharacterSetOfFileSetDescriptorFile'],\n    '1200': ['UL', '1', 'OffsetOfTheFirstDirectoryRecordOfTheRootDirectoryEntity'],\n    '1202': ['UL', '1', 'OffsetOfTheLastDirectoryRecordOfTheRootDirectoryEntity'],\n    '1212': ['US', '1', 'FileSetConsistencyFlag'],\n    '1220': ['SQ', '1', 'DirectoryRecordSequence'],\n    '1400': ['UL', '1', 'OffsetOfTheNextDirectoryRecord'],\n    '1410': ['US', '1', 'RecordInUseFlag'],\n    '1420': ['UL', '1', 'OffsetOfReferencedLowerLevelDirectoryEntity'],\n    '1430': ['CS', '1', 'DirectoryRecordType'],\n    '1432': ['UI', '1', 'PrivateRecordUID'],\n    '1500': ['CS', '1-8', 'ReferencedFileID'],\n    '1504': ['UL', '1', 'MRDRDirectoryRecordOffset'],\n    '1510': ['UI', '1', 'ReferencedSOPClassUIDInFile'],\n    '1511': ['UI', '1', 'ReferencedSOPInstanceUIDInFile'],\n    '1512': ['UI', '1', 'ReferencedTransferSyntaxUIDInFile'],\n    '151A': ['UI', '1-n', 'ReferencedRelatedGeneralSOPClassUIDInFile'],\n    '1600': ['UL', '1', 'NumberOfReferences']\n  },\n  '0008': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['UL', '1', 'LengthToEnd'],\n    '0005': ['CS', '1-n', 'SpecificCharacterSet'],\n    '0006': ['SQ', '1', 'LanguageCodeSequence'],\n    '0008': ['CS', '2-n', 'ImageType'],\n    '0010': ['SH', '1', 'RecognitionCode'],\n    '0012': ['DA', '1', 'InstanceCreationDate'],\n    '0013': ['TM', '1', 'InstanceCreationTime'],\n    '0014': ['UI', '1', 'InstanceCreatorUID'],\n    '0015': ['DT', '1', 'InstanceCoercionDateTime'],\n    '0016': ['UI', '1', 'SOPClassUID'],\n    '0018': ['UI', '1', 'SOPInstanceUID'],\n    '001A': ['UI', '1-n', 'RelatedGeneralSOPClassUID'],\n    '001B': ['UI', '1', 'OriginalSpecializedSOPClassUID'],\n    '0020': ['DA', '1', 'StudyDate'],\n    '0021': ['DA', '1', 'SeriesDate'],\n    '0022': ['DA', '1', 'AcquisitionDate'],\n    '0023': ['DA', '1', 'ContentDate'],\n    '0024': ['DA', '1', 'OverlayDate'],\n    '0025': ['DA', '1', 'CurveDate'],\n    '002A': ['DT', '1', 'AcquisitionDateTime'],\n    '0030': ['TM', '1', 'StudyTime'],\n    '0031': ['TM', '1', 'SeriesTime'],\n    '0032': ['TM', '1', 'AcquisitionTime'],\n    '0033': ['TM', '1', 'ContentTime'],\n    '0034': ['TM', '1', 'OverlayTime'],\n    '0035': ['TM', '1', 'CurveTime'],\n    '0040': ['US', '1', 'DataSetType'],\n    '0041': ['LO', '1', 'DataSetSubtype'],\n    '0042': ['CS', '1', 'NuclearMedicineSeriesType'],\n    '0050': ['SH', '1', 'AccessionNumber'],\n    '0051': ['SQ', '1', 'IssuerOfAccessionNumberSequence'],\n    '0052': ['CS', '1', 'QueryRetrieveLevel'],\n    '0053': ['CS', '1', 'QueryRetrieveView'],\n    '0054': ['AE', '1-n', 'RetrieveAETitle'],\n    '0055': ['AE', '1', 'StationAETitle'],\n    '0056': ['CS', '1', 'InstanceAvailability'],\n    '0058': ['UI', '1-n', 'FailedSOPInstanceUIDList'],\n    '0060': ['CS', '1', 'Modality'],\n    '0061': ['CS', '1-n', 'ModalitiesInStudy'],\n    '0062': ['UI', '1-n', 'SOPClassesInStudy'],\n    '0063': ['SQ', '1', 'AnatomicRegionsInStudyCodeSequence'],\n    '0064': ['CS', '1', 'ConversionType'],\n    '0068': ['CS', '1', 'PresentationIntentType'],\n    '0070': ['LO', '1', 'Manufacturer'],\n    '0080': ['LO', '1', 'InstitutionName'],\n    '0081': ['ST', '1', 'InstitutionAddress'],\n    '0082': ['SQ', '1', 'InstitutionCodeSequence'],\n    '0090': ['PN', '1', 'ReferringPhysicianName'],\n    '0092': ['ST', '1', 'ReferringPhysicianAddress'],\n    '0094': ['SH', '1-n', 'ReferringPhysicianTelephoneNumbers'],\n    '0096': ['SQ', '1', 'ReferringPhysicianIdentificationSequence'],\n    '009C': ['PN', '1-n', 'ConsultingPhysicianName'],\n    '009D': ['SQ', '1', 'ConsultingPhysicianIdentificationSequence'],\n    '0100': ['SH', '1', 'CodeValue'],\n    '0101': ['LO', '1', 'ExtendedCodeValue'],\n    '0102': ['SH', '1', 'CodingSchemeDesignator'],\n    '0103': ['SH', '1', 'CodingSchemeVersion'],\n    '0104': ['LO', '1', 'CodeMeaning'],\n    '0105': ['CS', '1', 'MappingResource'],\n    '0106': ['DT', '1', 'ContextGroupVersion'],\n    '0107': ['DT', '1', 'ContextGroupLocalVersion'],\n    '0108': ['LT', '1', 'ExtendedCodeMeaning'],\n    '0109': ['SQ', '1', 'CodingSchemeResourcesSequence'],\n    '010A': ['CS', '1', 'CodingSchemeURLType'],\n    '010B': ['CS', '1', 'ContextGroupExtensionFlag'],\n    '010C': ['UI', '1', 'CodingSchemeUID'],\n    '010D': ['UI', '1', 'ContextGroupExtensionCreatorUID'],\n    '010E': ['UR', '1', 'CodingSchemeURL'],\n    '010F': ['CS', '1', 'ContextIdentifier'],\n    '0110': ['SQ', '1', 'CodingSchemeIdentificationSequence'],\n    '0112': ['LO', '1', 'CodingSchemeRegistry'],\n    '0114': ['ST', '1', 'CodingSchemeExternalID'],\n    '0115': ['ST', '1', 'CodingSchemeName'],\n    '0116': ['ST', '1', 'CodingSchemeResponsibleOrganization'],\n    '0117': ['UI', '1', 'ContextUID'],\n    '0118': ['UI', '1', 'MappingResourceUID'],\n    '0119': ['UC', '1', 'LongCodeValue'],\n    '0120': ['UR', '1', 'URNCodeValue'],\n    '0121': ['SQ', '1', 'EquivalentCodeSequence'],\n    '0122': ['LO', '1', 'MappingResourceName'],\n    '0123': ['SQ', '1', 'ContextGroupIdentificationSequence'],\n    '0124': ['SQ', '1', 'MappingResourceIdentificationSequence'],\n    '0201': ['SH', '1', 'TimezoneOffsetFromUTC'],\n    '0202': ['', '', ''],\n    '0220': ['SQ', '1', 'ResponsibleGroupCodeSequence'],\n    '0221': ['CS', '1', 'EquipmentModality'],\n    '0222': ['LO', '1', 'ManufacturerRelatedModelGroup'],\n    '0300': ['SQ', '1', 'PrivateDataElementCharacteristicsSequence'],\n    '0301': ['US', '1', 'PrivateGroupReference'],\n    '0302': ['LO', '1', 'PrivateCreatorReference'],\n    '0303': ['CS', '1', 'BlockIdentifyingInformationStatus'],\n    '0304': ['US', '1-n', 'NonidentifyingPrivateElements'],\n    '0305': ['SQ', '1', 'DeidentificationActionSequence'],\n    '0306': ['US', '1-n', 'IdentifyingPrivateElements'],\n    '0307': ['CS', '1', 'DeidentificationAction'],\n    '0308': ['US', '1', 'PrivateDataElement'],\n    '0309': ['UL', '1-3', 'PrivateDataElementValueMultiplicity'],\n    '030A': ['CS', '1', 'PrivateDataElementValueRepresentation'],\n    '030B': ['UL', '1-2', 'PrivateDataElementNumberOfItems'],\n    '030C': ['UC', '1', 'PrivateDataElementName'],\n    '030D': ['UC', '1', 'PrivateDataElementKeyword'],\n    '030E': ['UT', '1', 'PrivateDataElementDescription'],\n    '030F': ['UT', '1', 'PrivateDataElementEncoding'],\n    '0310': ['SQ', '1', 'PrivateDataElementDefinitionSequence'],\n    '1000': ['AE', '1', 'NetworkID'],\n    '1010': ['SH', '1', 'StationName'],\n    '1030': ['LO', '1', 'StudyDescription'],\n    '1032': ['SQ', '1', 'ProcedureCodeSequence'],\n    '103E': ['LO', '1', 'SeriesDescription'],\n    '103F': ['SQ', '1', 'SeriesDescriptionCodeSequence'],\n    '1040': ['LO', '1', 'InstitutionalDepartmentName'],\n    '1041': ['SQ', '1', 'InstitutionalDepartmentTypeCodeSequence'],\n    '1048': ['PN', '1-n', 'PhysiciansOfRecord'],\n    '1049': ['SQ', '1', 'PhysiciansOfRecordIdentificationSequence'],\n    '1050': ['PN', '1-n', 'PerformingPhysicianName'],\n    '1052': ['SQ', '1', 'PerformingPhysicianIdentificationSequence'],\n    '1060': ['PN', '1-n', 'NameOfPhysiciansReadingStudy'],\n    '1062': ['SQ', '1', 'PhysiciansReadingStudyIdentificationSequence'],\n    '1070': ['PN', '1-n', 'OperatorsName'],\n    '1072': ['SQ', '1', 'OperatorIdentificationSequence'],\n    '1080': ['LO', '1-n', 'AdmittingDiagnosesDescription'],\n    '1084': ['SQ', '1', 'AdmittingDiagnosesCodeSequence'],\n    '1090': ['LO', '1', 'ManufacturerModelName'],\n    '1100': ['SQ', '1', 'ReferencedResultsSequence'],\n    '1110': ['SQ', '1', 'ReferencedStudySequence'],\n    '1111': ['SQ', '1', 'ReferencedPerformedProcedureStepSequence'],\n    '1115': ['SQ', '1', 'ReferencedSeriesSequence'],\n    '1120': ['SQ', '1', 'ReferencedPatientSequence'],\n    '1125': ['SQ', '1', 'ReferencedVisitSequence'],\n    '1130': ['SQ', '1', 'ReferencedOverlaySequence'],\n    '1134': ['SQ', '1', 'ReferencedStereometricInstanceSequence'],\n    '113A': ['SQ', '1', 'ReferencedWaveformSequence'],\n    '1140': ['SQ', '1', 'ReferencedImageSequence'],\n    '1145': ['SQ', '1', 'ReferencedCurveSequence'],\n    '114A': ['SQ', '1', 'ReferencedInstanceSequence'],\n    '114B': ['SQ', '1', 'ReferencedRealWorldValueMappingInstanceSequence'],\n    '1150': ['UI', '1', 'ReferencedSOPClassUID'],\n    '1155': ['UI', '1', 'ReferencedSOPInstanceUID'],\n    '1156': ['SQ', '1', 'DefinitionSourceSequence'],\n    '115A': ['UI', '1-n', 'SOPClassesSupported'],\n    '1160': ['IS', '1-n', 'ReferencedFrameNumber'],\n    '1161': ['UL', '1-n', 'SimpleFrameList'],\n    '1162': ['UL', '3-3n', 'CalculatedFrameList'],\n    '1163': ['FD', '2', 'TimeRange'],\n    '1164': ['SQ', '1', 'FrameExtractionSequence'],\n    '1167': ['UI', '1', 'MultiFrameSourceSOPInstanceUID'],\n    '1190': ['UR', '1', 'RetrieveURL'],\n    '1195': ['UI', '1', 'TransactionUID'],\n    '1196': ['US', '1', 'WarningReason'],\n    '1197': ['US', '1', 'FailureReason'],\n    '1198': ['SQ', '1', 'FailedSOPSequence'],\n    '1199': ['SQ', '1', 'ReferencedSOPSequence'],\n    '119A': ['SQ', '1', 'OtherFailuresSequence'],\n    '1200': ['SQ', '1', 'StudiesContainingOtherReferencedInstancesSequence'],\n    '1250': ['SQ', '1', 'RelatedSeriesSequence'],\n    '2110': ['CS', '1', 'LossyImageCompressionRetired'],\n    '2111': ['ST', '1', 'DerivationDescription'],\n    '2112': ['SQ', '1', 'SourceImageSequence'],\n    '2120': ['SH', '1', 'StageName'],\n    '2122': ['IS', '1', 'StageNumber'],\n    '2124': ['IS', '1', 'NumberOfStages'],\n    '2127': ['SH', '1', 'ViewName'],\n    '2128': ['IS', '1', 'ViewNumber'],\n    '2129': ['IS', '1', 'NumberOfEventTimers'],\n    '212A': ['IS', '1', 'NumberOfViewsInStage'],\n    '2130': ['DS', '1-n', 'EventElapsedTimes'],\n    '2132': ['LO', '1-n', 'EventTimerNames'],\n    '2133': ['SQ', '1', 'EventTimerSequence'],\n    '2134': ['FD', '1', 'EventTimeOffset'],\n    '2135': ['SQ', '1', 'EventCodeSequence'],\n    '2142': ['IS', '1', 'StartTrim'],\n    '2143': ['IS', '1', 'StopTrim'],\n    '2144': ['IS', '1', 'RecommendedDisplayFrameRate'],\n    '2200': ['CS', '1', 'TransducerPosition'],\n    '2204': ['CS', '1', 'TransducerOrientation'],\n    '2208': ['CS', '1', 'AnatomicStructure'],\n    '2218': ['SQ', '1', 'AnatomicRegionSequence'],\n    '2220': ['SQ', '1', 'AnatomicRegionModifierSequence'],\n    '2228': ['SQ', '1', 'PrimaryAnatomicStructureSequence'],\n    '2229': ['SQ', '1', 'AnatomicStructureSpaceOrRegionSequence'],\n    '2230': ['SQ', '1', 'PrimaryAnatomicStructureModifierSequence'],\n    '2240': ['SQ', '1', 'TransducerPositionSequence'],\n    '2242': ['SQ', '1', 'TransducerPositionModifierSequence'],\n    '2244': ['SQ', '1', 'TransducerOrientationSequence'],\n    '2246': ['SQ', '1', 'TransducerOrientationModifierSequence'],\n    '2251': ['SQ', '1', 'AnatomicStructureSpaceOrRegionCodeSequenceTrial'],\n    '2253': ['SQ', '1', 'AnatomicPortalOfEntranceCodeSequenceTrial'],\n    '2255': ['SQ', '1', 'AnatomicApproachDirectionCodeSequenceTrial'],\n    '2256': ['ST', '1', 'AnatomicPerspectiveDescriptionTrial'],\n    '2257': ['SQ', '1', 'AnatomicPerspectiveCodeSequenceTrial'],\n    '2258': ['ST', '1', 'AnatomicLocationOfExaminingInstrumentDescriptionTrial'],\n    '2259': ['SQ', '1', 'AnatomicLocationOfExaminingInstrumentCodeSequenceTrial'],\n    '225A': ['SQ', '1', 'AnatomicStructureSpaceOrRegionModifierCodeSequenceTrial'],\n    '225C': ['SQ', '1', 'OnAxisBackgroundAnatomicStructureCodeSequenceTrial'],\n    '3001': ['SQ', '1', 'AlternateRepresentationSequence'],\n    '3002': ['UI', '1-n', 'AvailableTransferSyntaxUID'],\n    '3010': ['UI', '1-n', 'IrradiationEventUID'],\n    '3011': ['SQ', '1', 'SourceIrradiationEventSequence'],\n    '3012': ['UI', '1', 'RadiopharmaceuticalAdministrationEventUID'],\n    '4000': ['LT', '1', 'IdentifyingComments'],\n    '9007': ['CS', '4', 'FrameType'],\n    '9092': ['SQ', '1', 'ReferencedImageEvidenceSequence'],\n    '9121': ['SQ', '1', 'ReferencedRawDataSequence'],\n    '9123': ['UI', '1', 'CreatorVersionUID'],\n    '9124': ['SQ', '1', 'DerivationImageSequence'],\n    '9154': ['SQ', '1', 'SourceImageEvidenceSequence'],\n    '9205': ['CS', '1', 'PixelPresentation'],\n    '9206': ['CS', '1', 'VolumetricProperties'],\n    '9207': ['CS', '1', 'VolumeBasedCalculationTechnique'],\n    '9208': ['CS', '1', 'ComplexImageComponent'],\n    '9209': ['CS', '1', 'AcquisitionContrast'],\n    '9215': ['SQ', '1', 'DerivationCodeSequence'],\n    '9237': ['SQ', '1', 'ReferencedPresentationStateSequence'],\n    '9410': ['SQ', '1', 'ReferencedOtherPlaneSequence'],\n    '9458': ['SQ', '1', 'FrameDisplaySequence'],\n    '9459': ['FL', '1', 'RecommendedDisplayFrameRateInFloat'],\n    '9460': ['CS', '1', 'SkipFrameRangeFlag']\n  },\n  '0010': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['PN', '1', 'PatientName'],\n    '0020': ['LO', '1', 'PatientID'],\n    '0021': ['LO', '1', 'IssuerOfPatientID'],\n    '0022': ['CS', '1', 'TypeOfPatientID'],\n    '0024': ['SQ', '1', 'IssuerOfPatientIDQualifiersSequence'],\n    '0026': ['SQ', '1', 'SourcePatientGroupIdentificationSequence'],\n    '0027': ['SQ', '1', 'GroupOfPatientsIdentificationSequence'],\n    '0028': ['US', '3', 'SubjectRelativePositionInImage'],\n    '0030': ['DA', '1', 'PatientBirthDate'],\n    '0032': ['TM', '1', 'PatientBirthTime'],\n    '0033': ['LO', '1', 'PatientBirthDateInAlternativeCalendar'],\n    '0034': ['LO', '1', 'PatientDeathDateInAlternativeCalendar'],\n    '0035': ['CS', '1', 'PatientAlternativeCalendar'],\n    '0040': ['CS', '1', 'PatientSex'],\n    '0050': ['SQ', '1', 'PatientInsurancePlanCodeSequence'],\n    '0101': ['SQ', '1', 'PatientPrimaryLanguageCodeSequence'],\n    '0102': ['SQ', '1', 'PatientPrimaryLanguageModifierCodeSequence'],\n    '0200': ['CS', '1', 'QualityControlSubject'],\n    '0201': ['SQ', '1', 'QualityControlSubjectTypeCodeSequence'],\n    '0212': ['UC', '1', 'StrainDescription'],\n    '0213': ['LO', '1', 'StrainNomenclature'],\n    '0214': ['LO', '1', 'StrainStockNumber'],\n    '0215': ['SQ', '1', 'StrainSourceRegistryCodeSequence'],\n    '0216': ['SQ', '1', 'StrainStockSequence'],\n    '0217': ['LO', '1', 'StrainSource'],\n    '0218': ['UT', '1', 'StrainAdditionalInformation'],\n    '0219': ['SQ', '1', 'StrainCodeSequence'],\n    '0221': ['SQ', '1', 'GeneticModificationsSequence'],\n    '0222': ['UC', '1', 'GeneticModificationsDescription'],\n    '0223': ['LO', '1', 'GeneticModificationsNomenclature'],\n    '0229': ['SQ', '1', 'GeneticModificationsCodeSequence'],\n    '1000': ['LO', '1-n', 'OtherPatientIDs'],\n    '1001': ['PN', '1-n', 'OtherPatientNames'],\n    '1002': ['SQ', '1', 'OtherPatientIDsSequence'],\n    '1005': ['PN', '1', 'PatientBirthName'],\n    '1010': ['AS', '1', 'PatientAge'],\n    '1020': ['DS', '1', 'PatientSize'],\n    '1021': ['SQ', '1', 'PatientSizeCodeSequence'],\n    '1022': ['DS', '1', 'PatientBodyMassIndex'],\n    '1023': ['DS', '1', 'MeasuredAPDimension'],\n    '1024': ['DS', '1', 'MeasuredLateralDimension'],\n    '1030': ['DS', '1', 'PatientWeight'],\n    '1040': ['LO', '1', 'PatientAddress'],\n    '1050': ['LO', '1-n', 'InsurancePlanIdentification'],\n    '1060': ['PN', '1', 'PatientMotherBirthName'],\n    '1080': ['LO', '1', 'MilitaryRank'],\n    '1081': ['LO', '1', 'BranchOfService'],\n    '1090': ['LO', '1', 'MedicalRecordLocator'],\n    '1100': ['SQ', '1', 'ReferencedPatientPhotoSequence'],\n    '2000': ['LO', '1-n', 'MedicalAlerts'],\n    '2110': ['LO', '1-n', 'Allergies'],\n    '2150': ['LO', '1', 'CountryOfResidence'],\n    '2152': ['LO', '1', 'RegionOfResidence'],\n    '2154': ['SH', '1-n', 'PatientTelephoneNumbers'],\n    '2155': ['LT', '1', 'PatientTelecomInformation'],\n    '2160': ['SH', '1', 'EthnicGroup'],\n    '2180': ['SH', '1', 'Occupation'],\n    '21A0': ['CS', '1', 'SmokingStatus'],\n    '21B0': ['LT', '1', 'AdditionalPatientHistory'],\n    '21C0': ['US', '1', 'PregnancyStatus'],\n    '21D0': ['DA', '1', 'LastMenstrualDate'],\n    '21F0': ['LO', '1', 'PatientReligiousPreference'],\n    '2201': ['LO', '1', 'PatientSpeciesDescription'],\n    '2202': ['SQ', '1', 'PatientSpeciesCodeSequence'],\n    '2203': ['CS', '1', 'PatientSexNeutered'],\n    '2210': ['CS', '1', 'AnatomicalOrientationType'],\n    '2292': ['LO', '1', 'PatientBreedDescription'],\n    '2293': ['SQ', '1', 'PatientBreedCodeSequence'],\n    '2294': ['SQ', '1', 'BreedRegistrationSequence'],\n    '2295': ['LO', '1', 'BreedRegistrationNumber'],\n    '2296': ['SQ', '1', 'BreedRegistryCodeSequence'],\n    '2297': ['PN', '1', 'ResponsiblePerson'],\n    '2298': ['CS', '1', 'ResponsiblePersonRole'],\n    '2299': ['LO', '1', 'ResponsibleOrganization'],\n    '4000': ['LT', '1', 'PatientComments'],\n    '9431': ['FL', '1', 'ExaminedBodyThickness']\n  },\n  '0012': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['LO', '1', 'ClinicalTrialSponsorName'],\n    '0020': ['LO', '1', 'ClinicalTrialProtocolID'],\n    '0021': ['LO', '1', 'ClinicalTrialProtocolName'],\n    '0030': ['LO', '1', 'ClinicalTrialSiteID'],\n    '0031': ['LO', '1', 'ClinicalTrialSiteName'],\n    '0040': ['LO', '1', 'ClinicalTrialSubjectID'],\n    '0042': ['LO', '1', 'ClinicalTrialSubjectReadingID'],\n    '0050': ['LO', '1', 'ClinicalTrialTimePointID'],\n    '0051': ['ST', '1', 'ClinicalTrialTimePointDescription'],\n    '0052': ['FD', '1', 'LongitudinalTemporalOffsetFromEvent'],\n    '0053': ['CS', '1', 'LongitudinalTemporalEventType'],\n    '0060': ['LO', '1', 'ClinicalTrialCoordinatingCenterName'],\n    '0062': ['CS', '1', 'PatientIdentityRemoved'],\n    '0063': ['LO', '1-n', 'DeidentificationMethod'],\n    '0064': ['SQ', '1', 'DeidentificationMethodCodeSequence'],\n    '0071': ['LO', '1', 'ClinicalTrialSeriesID'],\n    '0072': ['LO', '1', 'ClinicalTrialSeriesDescription'],\n    '0081': ['LO', '1', 'ClinicalTrialProtocolEthicsCommitteeName'],\n    '0082': ['LO', '1', 'ClinicalTrialProtocolEthicsCommitteeApprovalNumber'],\n    '0083': ['SQ', '1', 'ConsentForClinicalTrialUseSequence'],\n    '0084': ['CS', '1', 'DistributionType'],\n    '0085': ['CS', '1', 'ConsentForDistributionFlag'],\n    '0086': ['DA', '1', 'EthicsCommitteeApprovalEffectivenessStartDate'],\n    '0087': ['DA', '1', 'EthicsCommitteeApprovalEffectivenessEndDate']\n  },\n  '0014': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0023': ['ST', '1', 'CADFileFormat'],\n    '0024': ['ST', '1', 'ComponentReferenceSystem'],\n    '0025': ['ST', '1', 'ComponentManufacturingProcedure'],\n    '0028': ['ST', '1', 'ComponentManufacturer'],\n    '0030': ['DS', '1-n', 'MaterialThickness'],\n    '0032': ['DS', '1-n', 'MaterialPipeDiameter'],\n    '0034': ['DS', '1-n', 'MaterialIsolationDiameter'],\n    '0042': ['ST', '1', 'MaterialGrade'],\n    '0044': ['ST', '1', 'MaterialPropertiesDescription'],\n    '0045': ['ST', '1', 'MaterialPropertiesFileFormatRetired'],\n    '0046': ['LT', '1', 'MaterialNotes'],\n    '0050': ['CS', '1', 'ComponentShape'],\n    '0052': ['CS', '1', 'CurvatureType'],\n    '0054': ['DS', '1', 'OuterDiameter'],\n    '0056': ['DS', '1', 'InnerDiameter'],\n    '0100': ['LO', '1-n', 'ComponentWelderIDs'],\n    '0101': ['CS', '1', 'SecondaryApprovalStatus'],\n    '0102': ['DA', '1', 'SecondaryReviewDate'],\n    '0103': ['TM', '1', 'SecondaryReviewTime'],\n    '0104': ['PN', '1', 'SecondaryReviewerName'],\n    '0105': ['ST', '1', 'RepairID'],\n    '0106': ['SQ', '1', 'MultipleComponentApprovalSequence'],\n    '0107': ['CS', '1-n', 'OtherApprovalStatus'],\n    '0108': ['CS', '1-n', 'OtherSecondaryApprovalStatus'],\n    '1010': ['ST', '1', 'ActualEnvironmentalConditions'],\n    '1020': ['DA', '1', 'ExpiryDate'],\n    '1040': ['ST', '1', 'EnvironmentalConditions'],\n    '2002': ['SQ', '1', 'EvaluatorSequence'],\n    '2004': ['IS', '1', 'EvaluatorNumber'],\n    '2006': ['PN', '1', 'EvaluatorName'],\n    '2008': ['IS', '1', 'EvaluationAttempt'],\n    '2012': ['SQ', '1', 'IndicationSequence'],\n    '2014': ['IS', '1', 'IndicationNumber'],\n    '2016': ['SH', '1', 'IndicationLabel'],\n    '2018': ['ST', '1', 'IndicationDescription'],\n    '201A': ['CS', '1-n', 'IndicationType'],\n    '201C': ['CS', '1', 'IndicationDisposition'],\n    '201E': ['SQ', '1', 'IndicationROISequence'],\n    '2030': ['SQ', '1', 'IndicationPhysicalPropertySequence'],\n    '2032': ['SH', '1', 'PropertyLabel'],\n    '2202': ['IS', '1', 'CoordinateSystemNumberOfAxes'],\n    '2204': ['SQ', '1', 'CoordinateSystemAxesSequence'],\n    '2206': ['ST', '1', 'CoordinateSystemAxisDescription'],\n    '2208': ['CS', '1', 'CoordinateSystemDataSetMapping'],\n    '220A': ['IS', '1', 'CoordinateSystemAxisNumber'],\n    '220C': ['CS', '1', 'CoordinateSystemAxisType'],\n    '220E': ['CS', '1', 'CoordinateSystemAxisUnits'],\n    '2210': ['OB', '1', 'CoordinateSystemAxisValues'],\n    '2220': ['SQ', '1', 'CoordinateSystemTransformSequence'],\n    '2222': ['ST', '1', 'TransformDescription'],\n    '2224': ['IS', '1', 'TransformNumberOfAxes'],\n    '2226': ['IS', '1-n', 'TransformOrderOfAxes'],\n    '2228': ['CS', '1', 'TransformedAxisUnits'],\n    '222A': ['DS', '1-n', 'CoordinateSystemTransformRotationAndScaleMatrix'],\n    '222C': ['DS', '1-n', 'CoordinateSystemTransformTranslationMatrix'],\n    '3011': ['DS', '1', 'InternalDetectorFrameTime'],\n    '3012': ['DS', '1', 'NumberOfFramesIntegrated'],\n    '3020': ['SQ', '1', 'DetectorTemperatureSequence'],\n    '3022': ['ST', '1', 'SensorName'],\n    '3024': ['DS', '1', 'HorizontalOffsetOfSensor'],\n    '3026': ['DS', '1', 'VerticalOffsetOfSensor'],\n    '3028': ['DS', '1', 'SensorTemperature'],\n    '3040': ['SQ', '1', 'DarkCurrentSequence'],\n    '3050': ['ox', '1', 'DarkCurrentCounts'],\n    '3060': ['SQ', '1', 'GainCorrectionReferenceSequence'],\n    '3070': ['ox', '1', 'AirCounts'],\n    '3071': ['DS', '1', 'KVUsedInGainCalibration'],\n    '3072': ['DS', '1', 'MAUsedInGainCalibration'],\n    '3073': ['DS', '1', 'NumberOfFramesUsedForIntegration'],\n    '3074': ['LO', '1', 'FilterMaterialUsedInGainCalibration'],\n    '3075': ['DS', '1', 'FilterThicknessUsedInGainCalibration'],\n    '3076': ['DA', '1', 'DateOfGainCalibration'],\n    '3077': ['TM', '1', 'TimeOfGainCalibration'],\n    '3080': ['OB', '1', 'BadPixelImage'],\n    '3099': ['LT', '1', 'CalibrationNotes'],\n    '3100': ['LT', '1', 'LinearityCorrectionTechnique'],\n    '3101': ['LT', '1', 'BeamHardeningCorrectionTechnique'],\n    '4002': ['SQ', '1', 'PulserEquipmentSequence'],\n    '4004': ['CS', '1', 'PulserType'],\n    '4006': ['LT', '1', 'PulserNotes'],\n    '4008': ['SQ', '1', 'ReceiverEquipmentSequence'],\n    '400A': ['CS', '1', 'AmplifierType'],\n    '400C': ['LT', '1', 'ReceiverNotes'],\n    '400E': ['SQ', '1', 'PreAmplifierEquipmentSequence'],\n    '400F': ['LT', '1', 'PreAmplifierNotes'],\n    '4010': ['SQ', '1', 'TransmitTransducerSequence'],\n    '4011': ['SQ', '1', 'ReceiveTransducerSequence'],\n    '4012': ['US', '1', 'NumberOfElements'],\n    '4013': ['CS', '1', 'ElementShape'],\n    '4014': ['DS', '1', 'ElementDimensionA'],\n    '4015': ['DS', '1', 'ElementDimensionB'],\n    '4016': ['DS', '1', 'ElementPitchA'],\n    '4017': ['DS', '1', 'MeasuredBeamDimensionA'],\n    '4018': ['DS', '1', 'MeasuredBeamDimensionB'],\n    '4019': ['DS', '1', 'LocationOfMeasuredBeamDiameter'],\n    '401A': ['DS', '1', 'NominalFrequency'],\n    '401B': ['DS', '1', 'MeasuredCenterFrequency'],\n    '401C': ['DS', '1', 'MeasuredBandwidth'],\n    '401D': ['DS', '1', 'ElementPitchB'],\n    '4020': ['SQ', '1', 'PulserSettingsSequence'],\n    '4022': ['DS', '1', 'PulseWidth'],\n    '4024': ['DS', '1', 'ExcitationFrequency'],\n    '4026': ['CS', '1', 'ModulationType'],\n    '4028': ['DS', '1', 'Damping'],\n    '4030': ['SQ', '1', 'ReceiverSettingsSequence'],\n    '4031': ['DS', '1', 'AcquiredSoundpathLength'],\n    '4032': ['CS', '1', 'AcquisitionCompressionType'],\n    '4033': ['IS', '1', 'AcquisitionSampleSize'],\n    '4034': ['DS', '1', 'RectifierSmoothing'],\n    '4035': ['SQ', '1', 'DACSequence'],\n    '4036': ['CS', '1', 'DACType'],\n    '4038': ['DS', '1-n', 'DACGainPoints'],\n    '403A': ['DS', '1-n', 'DACTimePoints'],\n    '403C': ['DS', '1-n', 'DACAmplitude'],\n    '4040': ['SQ', '1', 'PreAmplifierSettingsSequence'],\n    '4050': ['SQ', '1', 'TransmitTransducerSettingsSequence'],\n    '4051': ['SQ', '1', 'ReceiveTransducerSettingsSequence'],\n    '4052': ['DS', '1', 'IncidentAngle'],\n    '4054': ['ST', '1', 'CouplingTechnique'],\n    '4056': ['ST', '1', 'CouplingMedium'],\n    '4057': ['DS', '1', 'CouplingVelocity'],\n    '4058': ['DS', '1', 'ProbeCenterLocationX'],\n    '4059': ['DS', '1', 'ProbeCenterLocationZ'],\n    '405A': ['DS', '1', 'SoundPathLength'],\n    '405C': ['ST', '1', 'DelayLawIdentifier'],\n    '4060': ['SQ', '1', 'GateSettingsSequence'],\n    '4062': ['DS', '1', 'GateThreshold'],\n    '4064': ['DS', '1', 'VelocityOfSound'],\n    '4070': ['SQ', '1', 'CalibrationSettingsSequence'],\n    '4072': ['ST', '1', 'CalibrationProcedure'],\n    '4074': ['SH', '1', 'ProcedureVersion'],\n    '4076': ['DA', '1', 'ProcedureCreationDate'],\n    '4078': ['DA', '1', 'ProcedureExpirationDate'],\n    '407A': ['DA', '1', 'ProcedureLastModifiedDate'],\n    '407C': ['TM', '1-n', 'CalibrationTime'],\n    '407E': ['DA', '1-n', 'CalibrationDate'],\n    '4080': ['SQ', '1', 'ProbeDriveEquipmentSequence'],\n    '4081': ['CS', '1', 'DriveType'],\n    '4082': ['LT', '1', 'ProbeDriveNotes'],\n    '4083': ['SQ', '1', 'DriveProbeSequence'],\n    '4084': ['DS', '1', 'ProbeInductance'],\n    '4085': ['DS', '1', 'ProbeResistance'],\n    '4086': ['SQ', '1', 'ReceiveProbeSequence'],\n    '4087': ['SQ', '1', 'ProbeDriveSettingsSequence'],\n    '4088': ['DS', '1', 'BridgeResistors'],\n    '4089': ['DS', '1', 'ProbeOrientationAngle'],\n    '408B': ['DS', '1', 'UserSelectedGainY'],\n    '408C': ['DS', '1', 'UserSelectedPhase'],\n    '408D': ['DS', '1', 'UserSelectedOffsetX'],\n    '408E': ['DS', '1', 'UserSelectedOffsetY'],\n    '4091': ['SQ', '1', 'ChannelSettingsSequence'],\n    '4092': ['DS', '1', 'ChannelThreshold'],\n    '409A': ['SQ', '1', 'ScannerSettingsSequence'],\n    '409B': ['ST', '1', 'ScanProcedure'],\n    '409C': ['DS', '1', 'TranslationRateX'],\n    '409D': ['DS', '1', 'TranslationRateY'],\n    '409F': ['DS', '1', 'ChannelOverlap'],\n    '40A0': ['LO', '1-n', 'ImageQualityIndicatorType'],\n    '40A1': ['LO', '1-n', 'ImageQualityIndicatorMaterial'],\n    '40A2': ['LO', '1-n', 'ImageQualityIndicatorSize'],\n    '5002': ['IS', '1', 'LINACEnergy'],\n    '5004': ['IS', '1', 'LINACOutput'],\n    '5100': ['US', '1', 'ActiveAperture'],\n    '5101': ['DS', '1', 'TotalAperture'],\n    '5102': ['DS', '1', 'ApertureElevation'],\n    '5103': ['DS', '1', 'MainLobeAngle'],\n    '5104': ['DS', '1', 'MainRoofAngle'],\n    '5105': ['CS', '1', 'ConnectorType'],\n    '5106': ['SH', '1', 'WedgeModelNumber'],\n    '5107': ['DS', '1', 'WedgeAngleFloat'],\n    '5108': ['DS', '1', 'WedgeRoofAngle'],\n    '5109': ['CS', '1', 'WedgeElement1Position'],\n    '510A': ['DS', '1', 'WedgeMaterialVelocity'],\n    '510B': ['SH', '1', 'WedgeMaterial'],\n    '510C': ['DS', '1', 'WedgeOffsetZ'],\n    '510D': ['DS', '1', 'WedgeOriginOffsetX'],\n    '510E': ['DS', '1', 'WedgeTimeDelay'],\n    '510F': ['SH', '1', 'WedgeName'],\n    '5110': ['SH', '1', 'WedgeManufacturerName'],\n    '5111': ['LO', '1', 'WedgeDescription'],\n    '5112': ['DS', '1', 'NominalBeamAngle'],\n    '5113': ['DS', '1', 'WedgeOffsetX'],\n    '5114': ['DS', '1', 'WedgeOffsetY'],\n    '5115': ['DS', '1', 'WedgeTotalLength'],\n    '5116': ['DS', '1', 'WedgeInContactLength'],\n    '5117': ['DS', '1', 'WedgeFrontGap'],\n    '5118': ['DS', '1', 'WedgeTotalHeight'],\n    '5119': ['DS', '1', 'WedgeFrontHeight'],\n    '511A': ['DS', '1', 'WedgeRearHeight'],\n    '511B': ['DS', '1', 'WedgeTotalWidth'],\n    '511C': ['DS', '1', 'WedgeInContactWidth'],\n    '511D': ['DS', '1', 'WedgeChamferHeight'],\n    '511E': ['CS', '1', 'WedgeCurve'],\n    '511F': ['DS', '1', 'RadiusAlongWedge']\n  },\n  '0016': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['DS', '1', 'WhitePoint'],\n    '0002': ['DS', '3', 'PrimaryChromaticities'],\n    '0003': ['UT', '1', 'BatteryLevel'],\n    '0004': ['DS', '1', 'ExposureTimeInSeconds'],\n    '0005': ['DS', '1', 'FNumber'],\n    '0006': ['IS', '1', 'OECFRows'],\n    '0007': ['IS', '1', 'OECFColumns'],\n    '0008': ['UC', '1-n', 'OECFColumnNames'],\n    '0009': ['DS', '1-n', 'OECFValues'],\n    '000A': ['IS', '1', 'SpatialFrequencyResponseRows'],\n    '000B': ['IS', '1', 'SpatialFrequencyResponseColumns'],\n    '000C': ['UC', '1-n', 'SpatialFrequencyResponseColumnNames'],\n    '000D': ['DS', '1-n', 'SpatialFrequencyResponseValues'],\n    '000E': ['IS', '1', 'ColorFilterArrayPatternRows'],\n    '000F': ['IS', '1', 'ColorFilterArrayPatternColumns'],\n    '0010': ['DS', '1-n', 'ColorFilterArrayPatternValues'],\n    '0011': ['US', '1', 'FlashFiringStatus'],\n    '0012': ['US', '1', 'FlashReturnStatus'],\n    '0013': ['US', '1', 'FlashMode'],\n    '0014': ['US', '1', 'FlashFunctionPresent'],\n    '0015': ['US', '1', 'FlashRedEyeMode'],\n    '0016': ['US', '1', 'ExposureProgram'],\n    '0017': ['UT', '1', 'SpectralSensitivity'],\n    '0018': ['IS', '1', 'PhotographicSensitivity'],\n    '0019': ['IS', '1', 'SelfTimerMode'],\n    '001A': ['US', '1', 'SensitivityType'],\n    '001B': ['IS', '1', 'StandardOutputSensitivity'],\n    '001C': ['IS', '1', 'RecommendedExposureIndex'],\n    '001D': ['IS', '1', 'ISOSpeed'],\n    '001E': ['IS', '1', 'ISOSpeedLatitudeyyy'],\n    '001F': ['IS', '1', 'ISOSpeedLatitudezzz'],\n    '0020': ['UT', '1', 'EXIFVersion'],\n    '0021': ['DS', '1', 'ShutterSpeedValue'],\n    '0022': ['DS', '1', 'ApertureValue'],\n    '0023': ['DS', '1', 'BrightnessValue'],\n    '0024': ['DS', '1', 'ExposureBiasValue'],\n    '0025': ['DS', '1', 'MaxApertureValue'],\n    '0026': ['DS', '1', 'SubjectDistance'],\n    '0027': ['US', '1', 'MeteringMode'],\n    '0028': ['US', '1', 'LightSource'],\n    '0029': ['DS', '1', 'FocalLength'],\n    '002A': ['IS', '2-4', 'SubjectArea'],\n    '002B': ['OB', '1', 'MakerNote'],\n    '0030': ['DS', '1', 'Temperature'],\n    '0031': ['DS', '1', 'Humidity'],\n    '0032': ['DS', '1', 'Pressure'],\n    '0033': ['DS', '1', 'WaterDepth'],\n    '0034': ['DS', '1', 'Acceleration'],\n    '0035': ['DS', '1', 'CameraElevationAngle'],\n    '0036': ['DS', '1-2', 'FlashEnergy'],\n    '0037': ['IS', '2', 'SubjectLocation'],\n    '0038': ['DS', '1', 'PhotographicExposureIndex'],\n    '0039': ['US', '1', 'SensingMethod'],\n    '003A': ['US', '1', 'FileSource'],\n    '003B': ['US', '1', 'SceneType'],\n    '0041': ['US', '1', 'CustomRendered'],\n    '0042': ['US', '1', 'ExposureMode'],\n    '0043': ['US', '1', 'WhiteBalance'],\n    '0044': ['DS', '1', 'DigitalZoomRatio'],\n    '0045': ['IS', '1', 'FocalLengthIn35mmFilm'],\n    '0046': ['US', '1', 'SceneCaptureType'],\n    '0047': ['US', '1', 'GainControl'],\n    '0048': ['US', '1', 'Contrast'],\n    '0049': ['US', '1', 'Saturation'],\n    '004A': ['US', '1', 'Sharpness'],\n    '004B': ['OB', '1', 'DeviceSettingDescription'],\n    '004C': ['US', '1', 'SubjectDistanceRange'],\n    '004D': ['UT', '1', 'CameraOwnerName'],\n    '004E': ['DS', '4', 'LensSpecification'],\n    '004F': ['UT', '1', 'LensMake'],\n    '0050': ['UT', '1', 'LensModel'],\n    '0051': ['UT', '1', 'LensSerialNumber'],\n    '0061': ['CS', '1', 'InteroperabilityIndex'],\n    '0062': ['OB', '1', 'InteroperabilityVersion'],\n    '0070': ['OB', '1', 'GPSVersionID'],\n    '0071': ['CS', '1', 'GPSLatitudeRef'],\n    '0072': ['DS', '3', 'GPSLatitude'],\n    '0073': ['CS', '1', 'GPSLongitudeRef'],\n    '0074': ['DS', '3', 'GPSLongitude'],\n    '0075': ['US', '1', 'GPSAltitudeRef'],\n    '0076': ['DS', '1', 'GPSAltitude'],\n    '0077': ['DT', '1', 'GPSTimeStamp'],\n    '0078': ['UT', '1', 'GPSSatellites'],\n    '0079': ['CS', '1', 'GPSStatus'],\n    '007A': ['CS', '1', 'GPSMeasureMode'],\n    '007B': ['DS', '1', 'GPSDOP'],\n    '007C': ['CS', '1', 'GPSSpeedRef'],\n    '007D': ['DS', '1', 'GPSSpeed'],\n    '007E': ['CS', '1', 'GPSTrackRef'],\n    '007F': ['DS', '1', 'GPSTrack'],\n    '0080': ['CS', '1', 'GPSImgDirectionRef'],\n    '0081': ['DS', '1', 'GPSImgDirection'],\n    '0082': ['UT', '1', 'GPSMapDatum'],\n    '0083': ['CS', '1', 'GPSDestLatitudeRef'],\n    '0084': ['DS', '3', 'GPSDestLatitude'],\n    '0085': ['CS', '1', 'GPSDestLongitudeRef'],\n    '0086': ['DS', '3', 'GPSDestLongitude'],\n    '0087': ['CS', '1', 'GPSDestBearingRef'],\n    '0088': ['DS', '1', 'GPSDestBearing'],\n    '0089': ['CS', '1', 'GPSDestDistanceRef'],\n    '008A': ['DS', '1', 'GPSDestDistance'],\n    '008B': ['OB', '1', 'GPSProcessingMethod'],\n    '008C': ['OB', '1', 'GPSAreaInformation'],\n    '008D': ['DT', '1', 'GPSDateStamp'],\n    '008E': ['IS', '1', 'GPSDifferential'],\n    '1001': ['CS', '1', 'LightSourcePolarization'],\n    '1002': ['DS', '1', 'EmitterColorTemperature'],\n    '1003': ['CS', '1', 'ContactMethod'],\n    '1004': ['CS', '1-n', 'ImmersionMedia'],\n    '1005': ['DS', '1', 'OpticalMagnificationFactor']\n  },\n  '0018': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['LO', '1', 'ContrastBolusAgent'],\n    '0012': ['SQ', '1', 'ContrastBolusAgentSequence'],\n    '0013': ['FL', '1', 'ContrastBolusT1Relaxivity'],\n    '0014': ['SQ', '1', 'ContrastBolusAdministrationRouteSequence'],\n    '0015': ['CS', '1', 'BodyPartExamined'],\n    '0020': ['CS', '1-n', 'ScanningSequence'],\n    '0021': ['CS', '1-n', 'SequenceVariant'],\n    '0022': ['CS', '1-n', 'ScanOptions'],\n    '0023': ['CS', '1', 'MRAcquisitionType'],\n    '0024': ['SH', '1', 'SequenceName'],\n    '0025': ['CS', '1', 'AngioFlag'],\n    '0026': ['SQ', '1', 'InterventionDrugInformationSequence'],\n    '0027': ['TM', '1', 'InterventionDrugStopTime'],\n    '0028': ['DS', '1', 'InterventionDrugDose'],\n    '0029': ['SQ', '1', 'InterventionDrugCodeSequence'],\n    '002A': ['SQ', '1', 'AdditionalDrugSequence'],\n    '0030': ['LO', '1-n', 'Radionuclide'],\n    '0031': ['LO', '1', 'Radiopharmaceutical'],\n    '0032': ['DS', '1', 'EnergyWindowCenterline'],\n    '0033': ['DS', '1-n', 'EnergyWindowTotalWidth'],\n    '0034': ['LO', '1', 'InterventionDrugName'],\n    '0035': ['TM', '1', 'InterventionDrugStartTime'],\n    '0036': ['SQ', '1', 'InterventionSequence'],\n    '0037': ['CS', '1', 'TherapyType'],\n    '0038': ['CS', '1', 'InterventionStatus'],\n    '0039': ['CS', '1', 'TherapyDescription'],\n    '003A': ['ST', '1', 'InterventionDescription'],\n    '0040': ['IS', '1', 'CineRate'],\n    '0042': ['CS', '1', 'InitialCineRunState'],\n    '0050': ['DS', '1', 'SliceThickness'],\n    '0060': ['DS', '1', 'KVP'],\n    '0061': ['DS', '1', ''],\n    '0070': ['IS', '1', 'CountsAccumulated'],\n    '0071': ['CS', '1', 'AcquisitionTerminationCondition'],\n    '0072': ['DS', '1', 'EffectiveDuration'],\n    '0073': ['CS', '1', 'AcquisitionStartCondition'],\n    '0074': ['IS', '1', 'AcquisitionStartConditionData'],\n    '0075': ['IS', '1', 'AcquisitionTerminationConditionData'],\n    '0080': ['DS', '1', 'RepetitionTime'],\n    '0081': ['DS', '1', 'EchoTime'],\n    '0082': ['DS', '1', 'InversionTime'],\n    '0083': ['DS', '1', 'NumberOfAverages'],\n    '0084': ['DS', '1', 'ImagingFrequency'],\n    '0085': ['SH', '1', 'ImagedNucleus'],\n    '0086': ['IS', '1-n', 'EchoNumbers'],\n    '0087': ['DS', '1', 'MagneticFieldStrength'],\n    '0088': ['DS', '1', 'SpacingBetweenSlices'],\n    '0089': ['IS', '1', 'NumberOfPhaseEncodingSteps'],\n    '0090': ['DS', '1', 'DataCollectionDiameter'],\n    '0091': ['IS', '1', 'EchoTrainLength'],\n    '0093': ['DS', '1', 'PercentSampling'],\n    '0094': ['DS', '1', 'PercentPhaseFieldOfView'],\n    '0095': ['DS', '1', 'PixelBandwidth'],\n    '1000': ['LO', '1', 'DeviceSerialNumber'],\n    '1002': ['UI', '1', 'DeviceUID'],\n    '1003': ['LO', '1', 'DeviceID'],\n    '1004': ['LO', '1', 'PlateID'],\n    '1005': ['LO', '1', 'GeneratorID'],\n    '1006': ['LO', '1', 'GridID'],\n    '1007': ['LO', '1', 'CassetteID'],\n    '1008': ['LO', '1', 'GantryID'],\n    '1009': ['UT', '1', 'UniqueDeviceIdentifier'],\n    '100A': ['SQ', '1', 'UDISequence'],\n    '100B': ['UI', '1-n', 'ManufacturerDeviceClassUID'],\n    '1010': ['LO', '1', 'SecondaryCaptureDeviceID'],\n    '1011': ['LO', '1', 'HardcopyCreationDeviceID'],\n    '1012': ['DA', '1', 'DateOfSecondaryCapture'],\n    '1014': ['TM', '1', 'TimeOfSecondaryCapture'],\n    '1016': ['LO', '1', 'SecondaryCaptureDeviceManufacturer'],\n    '1017': ['LO', '1', 'HardcopyDeviceManufacturer'],\n    '1018': ['LO', '1', 'SecondaryCaptureDeviceManufacturerModelName'],\n    '1019': ['LO', '1-n', 'SecondaryCaptureDeviceSoftwareVersions'],\n    '101A': ['LO', '1-n', 'HardcopyDeviceSoftwareVersion'],\n    '101B': ['LO', '1', 'HardcopyDeviceManufacturerModelName'],\n    '1020': ['LO', '1-n', 'SoftwareVersions'],\n    '1022': ['SH', '1', 'VideoImageFormatAcquired'],\n    '1023': ['LO', '1', 'DigitalImageFormatAcquired'],\n    '1030': ['LO', '1', 'ProtocolName'],\n    '1040': ['LO', '1', 'ContrastBolusRoute'],\n    '1041': ['DS', '1', 'ContrastBolusVolume'],\n    '1042': ['TM', '1', 'ContrastBolusStartTime'],\n    '1043': ['TM', '1', 'ContrastBolusStopTime'],\n    '1044': ['DS', '1', 'ContrastBolusTotalDose'],\n    '1045': ['IS', '1', 'SyringeCounts'],\n    '1046': ['DS', '1-n', 'ContrastFlowRate'],\n    '1047': ['DS', '1-n', 'ContrastFlowDuration'],\n    '1048': ['CS', '1', 'ContrastBolusIngredient'],\n    '1049': ['DS', '1', 'ContrastBolusIngredientConcentration'],\n    '1050': ['DS', '1', 'SpatialResolution'],\n    '1060': ['DS', '1', 'TriggerTime'],\n    '1061': ['LO', '1', 'TriggerSourceOrType'],\n    '1062': ['IS', '1', 'NominalInterval'],\n    '1063': ['DS', '1', 'FrameTime'],\n    '1064': ['LO', '1', 'CardiacFramingType'],\n    '1065': ['DS', '1-n', 'FrameTimeVector'],\n    '1066': ['DS', '1', 'FrameDelay'],\n    '1067': ['DS', '1', 'ImageTriggerDelay'],\n    '1068': ['DS', '1', 'MultiplexGroupTimeOffset'],\n    '1069': ['DS', '1', 'TriggerTimeOffset'],\n    '106A': ['CS', '1', 'SynchronizationTrigger'],\n    '106C': ['US', '2', 'SynchronizationChannel'],\n    '106E': ['UL', '1', 'TriggerSamplePosition'],\n    '1070': ['LO', '1', 'RadiopharmaceuticalRoute'],\n    '1071': ['DS', '1', 'RadiopharmaceuticalVolume'],\n    '1072': ['TM', '1', 'RadiopharmaceuticalStartTime'],\n    '1073': ['TM', '1', 'RadiopharmaceuticalStopTime'],\n    '1074': ['DS', '1', 'RadionuclideTotalDose'],\n    '1075': ['DS', '1', 'RadionuclideHalfLife'],\n    '1076': ['DS', '1', 'RadionuclidePositronFraction'],\n    '1077': ['DS', '1', 'RadiopharmaceuticalSpecificActivity'],\n    '1078': ['DT', '1', 'RadiopharmaceuticalStartDateTime'],\n    '1079': ['DT', '1', 'RadiopharmaceuticalStopDateTime'],\n    '1080': ['CS', '1', 'BeatRejectionFlag'],\n    '1081': ['IS', '1', 'LowRRValue'],\n    '1082': ['IS', '1', 'HighRRValue'],\n    '1083': ['IS', '1', 'IntervalsAcquired'],\n    '1084': ['IS', '1', 'IntervalsRejected'],\n    '1085': ['LO', '1', 'PVCRejection'],\n    '1086': ['IS', '1', 'SkipBeats'],\n    '1088': ['IS', '1', 'HeartRate'],\n    '1090': ['IS', '1', 'CardiacNumberOfImages'],\n    '1094': ['IS', '1', 'TriggerWindow'],\n    '1100': ['DS', '1', 'ReconstructionDiameter'],\n    '1110': ['DS', '1', 'DistanceSourceToDetector'],\n    '1111': ['DS', '1', 'DistanceSourceToPatient'],\n    '1114': ['DS', '1', 'EstimatedRadiographicMagnificationFactor'],\n    '1120': ['DS', '1', 'GantryDetectorTilt'],\n    '1121': ['DS', '1', 'GantryDetectorSlew'],\n    '1130': ['DS', '1', 'TableHeight'],\n    '1131': ['DS', '1', 'TableTraverse'],\n    '1134': ['CS', '1', 'TableMotion'],\n    '1135': ['DS', '1-n', 'TableVerticalIncrement'],\n    '1136': ['DS', '1-n', 'TableLateralIncrement'],\n    '1137': ['DS', '1-n', 'TableLongitudinalIncrement'],\n    '1138': ['DS', '1', 'TableAngle'],\n    '113A': ['CS', '1', 'TableType'],\n    '1140': ['CS', '1', 'RotationDirection'],\n    '1141': ['DS', '1', 'AngularPosition'],\n    '1142': ['DS', '1-n', 'RadialPosition'],\n    '1143': ['DS', '1', 'ScanArc'],\n    '1144': ['DS', '1', 'AngularStep'],\n    '1145': ['DS', '1', 'CenterOfRotationOffset'],\n    '1146': ['DS', '1-n', 'RotationOffset'],\n    '1147': ['CS', '1', 'FieldOfViewShape'],\n    '1149': ['IS', '1-2', 'FieldOfViewDimensions'],\n    '1150': ['IS', '1', 'ExposureTime'],\n    '1151': ['IS', '1', 'XRayTubeCurrent'],\n    '1152': ['IS', '1', 'Exposure'],\n    '1153': ['IS', '1', 'ExposureInuAs'],\n    '1154': ['DS', '1', 'AveragePulseWidth'],\n    '1155': ['CS', '1', 'RadiationSetting'],\n    '1156': ['CS', '1', 'RectificationType'],\n    '115A': ['CS', '1', 'RadiationMode'],\n    '115E': ['DS', '1', 'ImageAndFluoroscopyAreaDoseProduct'],\n    '1160': ['SH', '1', 'FilterType'],\n    '1161': ['LO', '1-n', 'TypeOfFilters'],\n    '1162': ['DS', '1', 'IntensifierSize'],\n    '1164': ['DS', '2', 'ImagerPixelSpacing'],\n    '1166': ['CS', '1-n', 'Grid'],\n    '1170': ['IS', '1', 'GeneratorPower'],\n    '1180': ['SH', '1', 'CollimatorGridName'],\n    '1181': ['CS', '1', 'CollimatorType'],\n    '1182': ['IS', '1-2', 'FocalDistance'],\n    '1183': ['DS', '1-2', 'XFocusCenter'],\n    '1184': ['DS', '1-2', 'YFocusCenter'],\n    '1190': ['DS', '1-n', 'FocalSpots'],\n    '1191': ['CS', '1', 'AnodeTargetMaterial'],\n    '11A0': ['DS', '1', 'BodyPartThickness'],\n    '11A2': ['DS', '1', 'CompressionForce'],\n    '11A3': ['DS', '1', 'CompressionPressure'],\n    '11A4': ['LO', '1', 'PaddleDescription'],\n    '11A5': ['DS', '1', 'CompressionContactArea'],\n    '11B0': ['LO', '1', 'AcquisitionMode'],\n    '11B1': ['LO', '1', 'DoseModeName'],\n    '11B2': ['CS', '1', 'AcquiredSubtractionMaskFlag'],\n    '11B3': ['CS', '1', 'FluoroscopyPersistenceFlag'],\n    '11B4': ['CS', '1', 'FluoroscopyLastImageHoldPersistenceFlag'],\n    '11B5': ['IS', '1', 'UpperLimitNumberOfPersistentFluoroscopyFrames'],\n    '11B6': ['CS', '1', 'ContrastBolusAutoInjectionTriggerFlag'],\n    '11B7': ['FD', '1', 'ContrastBolusInjectionDelay'],\n    '11B8': ['SQ', '1', 'XAAcquisitionPhaseDetailsSequence'],\n    '11B9': ['FD', '1', 'XAAcquisitionFrameRate'],\n    '11BA': ['SQ', '1', 'XAPlaneDetailsSequence'],\n    '11BB': ['LO', '1', 'AcquisitionFieldOfViewLabel'],\n    '11BC': ['SQ', '1', 'XRayFilterDetailsSequence'],\n    '11BD': ['FD', '1', 'XAAcquisitionDuration'],\n    '11BE': ['CS', '1', 'ReconstructionPipelineType'],\n    '11BF': ['SQ', '1', 'ImageFilterDetailsSequence'],\n    '11C0': ['CS', '1', 'AppliedMaskSubtractionFlag'],\n    '11C1': ['SQ', '1', 'RequestedSeriesDescriptionCodeSequence'],\n    '1200': ['DA', '1-n', 'DateOfLastCalibration'],\n    '1201': ['TM', '1-n', 'TimeOfLastCalibration'],\n    '1202': ['DT', '1', 'DateTimeOfLastCalibration'],\n    '1203': ['DT', '1', 'CalibrationDateTime'],\n    '1210': ['SH', '1-n', 'ConvolutionKernel'],\n    '1240': ['IS', '1-n', 'UpperLowerPixelValues'],\n    '1242': ['IS', '1', 'ActualFrameDuration'],\n    '1243': ['IS', '1', 'CountRate'],\n    '1244': ['US', '1', 'PreferredPlaybackSequencing'],\n    '1250': ['SH', '1', 'ReceiveCoilName'],\n    '1251': ['SH', '1', 'TransmitCoilName'],\n    '1260': ['SH', '1', 'PlateType'],\n    '1261': ['LO', '1', 'PhosphorType'],\n    '1271': ['FD', '1', 'WaterEquivalentDiameter'],\n    '1272': ['SQ', '1', 'WaterEquivalentDiameterCalculationMethodCodeSequence'],\n    '1300': ['DS', '1', 'ScanVelocity'],\n    '1301': ['CS', '1-n', 'WholeBodyTechnique'],\n    '1302': ['IS', '1', 'ScanLength'],\n    '1310': ['US', '4', 'AcquisitionMatrix'],\n    '1312': ['CS', '1', 'InPlanePhaseEncodingDirection'],\n    '1314': ['DS', '1', 'FlipAngle'],\n    '1315': ['CS', '1', 'VariableFlipAngleFlag'],\n    '1316': ['DS', '1', 'SAR'],\n    '1318': ['DS', '1', 'dBdt'],\n    '1320': ['FL', '1', 'B1rms'],\n    '1400': ['LO', '1', 'AcquisitionDeviceProcessingDescription'],\n    '1401': ['LO', '1', 'AcquisitionDeviceProcessingCode'],\n    '1402': ['CS', '1', 'CassetteOrientation'],\n    '1403': ['CS', '1', 'CassetteSize'],\n    '1404': ['US', '1', 'ExposuresOnPlate'],\n    '1405': ['IS', '1', 'RelativeXRayExposure'],\n    '1411': ['DS', '1', 'ExposureIndex'],\n    '1412': ['DS', '1', 'TargetExposureIndex'],\n    '1413': ['DS', '1', 'DeviationIndex'],\n    '1450': ['DS', '1', 'ColumnAngulation'],\n    '1460': ['DS', '1', 'TomoLayerHeight'],\n    '1470': ['DS', '1', 'TomoAngle'],\n    '1480': ['DS', '1', 'TomoTime'],\n    '1490': ['CS', '1', 'TomoType'],\n    '1491': ['CS', '1', 'TomoClass'],\n    '1495': ['IS', '1', 'NumberOfTomosynthesisSourceImages'],\n    '1500': ['CS', '1', 'PositionerMotion'],\n    '1508': ['CS', '1', 'PositionerType'],\n    '1510': ['DS', '1', 'PositionerPrimaryAngle'],\n    '1511': ['DS', '1', 'PositionerSecondaryAngle'],\n    '1520': ['DS', '1-n', 'PositionerPrimaryAngleIncrement'],\n    '1521': ['DS', '1-n', 'PositionerSecondaryAngleIncrement'],\n    '1530': ['DS', '1', 'DetectorPrimaryAngle'],\n    '1531': ['DS', '1', 'DetectorSecondaryAngle'],\n    '1600': ['CS', '1-3', 'ShutterShape'],\n    '1602': ['IS', '1', 'ShutterLeftVerticalEdge'],\n    '1604': ['IS', '1', 'ShutterRightVerticalEdge'],\n    '1606': ['IS', '1', 'ShutterUpperHorizontalEdge'],\n    '1608': ['IS', '1', 'ShutterLowerHorizontalEdge'],\n    '1610': ['IS', '2', 'CenterOfCircularShutter'],\n    '1612': ['IS', '1', 'RadiusOfCircularShutter'],\n    '1620': ['IS', '2-2n', 'VerticesOfThePolygonalShutter'],\n    '1622': ['US', '1', 'ShutterPresentationValue'],\n    '1623': ['US', '1', 'ShutterOverlayGroup'],\n    '1624': ['US', '3', 'ShutterPresentationColorCIELabValue'],\n    '1630': ['CS', '1', 'OutlineShapeType'],\n    '1631': ['FD', '1', 'OutlineLeftVerticalEdge'],\n    '1632': ['FD', '1', 'OutlineRightVerticalEdge'],\n    '1633': ['FD', '1', 'OutlineUpperHorizontalEdge'],\n    '1634': ['FD', '1', 'OutlineLowerHorizontalEdge'],\n    '1635': ['FD', '2', 'CenterOfCircularOutline'],\n    '1636': ['FD', '1', 'DiameterOfCircularOutline'],\n    '1637': ['UL', '1', 'NumberOfPolygonalVertices'],\n    '1638': ['OF', '1', 'VerticesOfThePolygonalOutline'],\n    '1700': ['CS', '1-3', 'CollimatorShape'],\n    '1702': ['IS', '1', 'CollimatorLeftVerticalEdge'],\n    '1704': ['IS', '1', 'CollimatorRightVerticalEdge'],\n    '1706': ['IS', '1', 'CollimatorUpperHorizontalEdge'],\n    '1708': ['IS', '1', 'CollimatorLowerHorizontalEdge'],\n    '1710': ['IS', '2', 'CenterOfCircularCollimator'],\n    '1712': ['IS', '1', 'RadiusOfCircularCollimator'],\n    '1720': ['IS', '2-2n', 'VerticesOfThePolygonalCollimator'],\n    '1800': ['CS', '1', 'AcquisitionTimeSynchronized'],\n    '1801': ['SH', '1', 'TimeSource'],\n    '1802': ['CS', '1', 'TimeDistributionProtocol'],\n    '1803': ['LO', '1', 'NTPSourceAddress'],\n    '2001': ['IS', '1-n', 'PageNumberVector'],\n    '2002': ['SH', '1-n', 'FrameLabelVector'],\n    '2003': ['DS', '1-n', 'FramePrimaryAngleVector'],\n    '2004': ['DS', '1-n', 'FrameSecondaryAngleVector'],\n    '2005': ['DS', '1-n', 'SliceLocationVector'],\n    '2006': ['SH', '1-n', 'DisplayWindowLabelVector'],\n    '2010': ['DS', '2', 'NominalScannedPixelSpacing'],\n    '2020': ['CS', '1', 'DigitizingDeviceTransportDirection'],\n    '2030': ['DS', '1', 'RotationOfScannedFilm'],\n    '2041': ['SQ', '1', 'BiopsyTargetSequence'],\n    '2042': ['UI', '1', 'TargetUID'],\n    '2043': ['FL', '2', 'LocalizingCursorPosition'],\n    '2044': ['FL', '3', 'CalculatedTargetPosition'],\n    '2045': ['SH', '1', 'TargetLabel'],\n    '2046': ['FL', '1', 'DisplayedZValue'],\n    '3100': ['CS', '1', 'IVUSAcquisition'],\n    '3101': ['DS', '1', 'IVUSPullbackRate'],\n    '3102': ['DS', '1', 'IVUSGatedRate'],\n    '3103': ['IS', '1', 'IVUSPullbackStartFrameNumber'],\n    '3104': ['IS', '1', 'IVUSPullbackStopFrameNumber'],\n    '3105': ['IS', '1-n', 'LesionNumber'],\n    '4000': ['LT', '1', 'AcquisitionComments'],\n    '5000': ['SH', '1-n', 'OutputPower'],\n    '5010': ['LO', '1-n', 'TransducerData'],\n    '5011': ['SQ', '1', 'TransducerIdentificationSequence'],\n    '5012': ['DS', '1', 'FocusDepth'],\n    '5020': ['LO', '1', 'ProcessingFunction'],\n    '5021': ['LO', '1', 'PostprocessingFunction'],\n    '5022': ['DS', '1', 'MechanicalIndex'],\n    '5024': ['DS', '1', 'BoneThermalIndex'],\n    '5026': ['DS', '1', 'CranialThermalIndex'],\n    '5027': ['DS', '1', 'SoftTissueThermalIndex'],\n    '5028': ['DS', '1', 'SoftTissueFocusThermalIndex'],\n    '5029': ['DS', '1', 'SoftTissueSurfaceThermalIndex'],\n    '5030': ['DS', '1', 'DynamicRange'],\n    '5040': ['DS', '1', 'TotalGain'],\n    '5050': ['IS', '1', 'DepthOfScanField'],\n    '5100': ['CS', '1', 'PatientPosition'],\n    '5101': ['CS', '1', 'ViewPosition'],\n    '5104': ['SQ', '1', 'ProjectionEponymousNameCodeSequence'],\n    '5210': ['DS', '6', 'ImageTransformationMatrix'],\n    '5212': ['DS', '3', 'ImageTranslationVector'],\n    '6000': ['DS', '1', 'Sensitivity'],\n    '6011': ['SQ', '1', 'SequenceOfUltrasoundRegions'],\n    '6012': ['US', '1', 'RegionSpatialFormat'],\n    '6014': ['US', '1', 'RegionDataType'],\n    '6016': ['UL', '1', 'RegionFlags'],\n    '6018': ['UL', '1', 'RegionLocationMinX0'],\n    '601A': ['UL', '1', 'RegionLocationMinY0'],\n    '601C': ['UL', '1', 'RegionLocationMaxX1'],\n    '601E': ['UL', '1', 'RegionLocationMaxY1'],\n    '6020': ['SL', '1', 'ReferencePixelX0'],\n    '6022': ['SL', '1', 'ReferencePixelY0'],\n    '6024': ['US', '1', 'PhysicalUnitsXDirection'],\n    '6026': ['US', '1', 'PhysicalUnitsYDirection'],\n    '6028': ['FD', '1', 'ReferencePixelPhysicalValueX'],\n    '602A': ['FD', '1', 'ReferencePixelPhysicalValueY'],\n    '602C': ['FD', '1', 'PhysicalDeltaX'],\n    '602E': ['FD', '1', 'PhysicalDeltaY'],\n    '6030': ['UL', '1', 'TransducerFrequency'],\n    '6031': ['CS', '1', 'TransducerType'],\n    '6032': ['UL', '1', 'PulseRepetitionFrequency'],\n    '6034': ['FD', '1', 'DopplerCorrectionAngle'],\n    '6036': ['FD', '1', 'SteeringAngle'],\n    '6038': ['UL', '1', 'DopplerSampleVolumeXPositionRetired'],\n    '6039': ['SL', '1', 'DopplerSampleVolumeXPosition'],\n    '603A': ['UL', '1', 'DopplerSampleVolumeYPositionRetired'],\n    '603B': ['SL', '1', 'DopplerSampleVolumeYPosition'],\n    '603C': ['UL', '1', 'TMLinePositionX0Retired'],\n    '603D': ['SL', '1', 'TMLinePositionX0'],\n    '603E': ['UL', '1', 'TMLinePositionY0Retired'],\n    '603F': ['SL', '1', 'TMLinePositionY0'],\n    '6040': ['UL', '1', 'TMLinePositionX1Retired'],\n    '6041': ['SL', '1', 'TMLinePositionX1'],\n    '6042': ['UL', '1', 'TMLinePositionY1Retired'],\n    '6043': ['SL', '1', 'TMLinePositionY1'],\n    '6044': ['US', '1', 'PixelComponentOrganization'],\n    '6046': ['UL', '1', 'PixelComponentMask'],\n    '6048': ['UL', '1', 'PixelComponentRangeStart'],\n    '604A': ['UL', '1', 'PixelComponentRangeStop'],\n    '604C': ['US', '1', 'PixelComponentPhysicalUnits'],\n    '604E': ['US', '1', 'PixelComponentDataType'],\n    '6050': ['UL', '1', 'NumberOfTableBreakPoints'],\n    '6052': ['UL', '1-n', 'TableOfXBreakPoints'],\n    '6054': ['FD', '1-n', 'TableOfYBreakPoints'],\n    '6056': ['UL', '1', 'NumberOfTableEntries'],\n    '6058': ['UL', '1-n', 'TableOfPixelValues'],\n    '605A': ['FL', '1-n', 'TableOfParameterValues'],\n    '6060': ['FL', '1-n', 'RWaveTimeVector'],\n    '6070': ['US', '1', 'ActiveImageAreaOverlayGroup'],\n    '7000': ['CS', '1', 'DetectorConditionsNominalFlag'],\n    '7001': ['DS', '1', 'DetectorTemperature'],\n    '7004': ['CS', '1', 'DetectorType'],\n    '7005': ['CS', '1', 'DetectorConfiguration'],\n    '7006': ['LT', '1', 'DetectorDescription'],\n    '7008': ['LT', '1', 'DetectorMode'],\n    '700A': ['SH', '1', 'DetectorID'],\n    '700C': ['DA', '1', 'DateOfLastDetectorCalibration'],\n    '700E': ['TM', '1', 'TimeOfLastDetectorCalibration'],\n    '7010': ['IS', '1', 'ExposuresOnDetectorSinceLastCalibration'],\n    '7011': ['IS', '1', 'ExposuresOnDetectorSinceManufactured'],\n    '7012': ['DS', '1', 'DetectorTimeSinceLastExposure'],\n    '7014': ['DS', '1', 'DetectorActiveTime'],\n    '7016': ['DS', '1', 'DetectorActivationOffsetFromExposure'],\n    '701A': ['DS', '2', 'DetectorBinning'],\n    '7020': ['DS', '2', 'DetectorElementPhysicalSize'],\n    '7022': ['DS', '2', 'DetectorElementSpacing'],\n    '7024': ['CS', '1', 'DetectorActiveShape'],\n    '7026': ['DS', '1-2', 'DetectorActiveDimensions'],\n    '7028': ['DS', '2', 'DetectorActiveOrigin'],\n    '702A': ['LO', '1', 'DetectorManufacturerName'],\n    '702B': ['LO', '1', 'DetectorManufacturerModelName'],\n    '7030': ['DS', '2', 'FieldOfViewOrigin'],\n    '7032': ['DS', '1', 'FieldOfViewRotation'],\n    '7034': ['CS', '1', 'FieldOfViewHorizontalFlip'],\n    '7036': ['FL', '2', 'PixelDataAreaOriginRelativeToFOV'],\n    '7038': ['FL', '1', 'PixelDataAreaRotationAngleRelativeToFOV'],\n    '7040': ['LT', '1', 'GridAbsorbingMaterial'],\n    '7041': ['LT', '1', 'GridSpacingMaterial'],\n    '7042': ['DS', '1', 'GridThickness'],\n    '7044': ['DS', '1', 'GridPitch'],\n    '7046': ['IS', '2', 'GridAspectRatio'],\n    '7048': ['DS', '1', 'GridPeriod'],\n    '704C': ['DS', '1', 'GridFocalDistance'],\n    '7050': ['CS', '1-n', 'FilterMaterial'],\n    '7052': ['DS', '1-n', 'FilterThicknessMinimum'],\n    '7054': ['DS', '1-n', 'FilterThicknessMaximum'],\n    '7056': ['FL', '1-n', 'FilterBeamPathLengthMinimum'],\n    '7058': ['FL', '1-n', 'FilterBeamPathLengthMaximum'],\n    '7060': ['CS', '1', 'ExposureControlMode'],\n    '7062': ['LT', '1', 'ExposureControlModeDescription'],\n    '7064': ['CS', '1', 'ExposureStatus'],\n    '7065': ['DS', '1', 'PhototimerSetting'],\n    '8150': ['DS', '1', 'ExposureTimeInuS'],\n    '8151': ['DS', '1', 'XRayTubeCurrentInuA'],\n    '9004': ['CS', '1', 'ContentQualification'],\n    '9005': ['SH', '1', 'PulseSequenceName'],\n    '9006': ['SQ', '1', 'MRImagingModifierSequence'],\n    '9008': ['CS', '1', 'EchoPulseSequence'],\n    '9009': ['CS', '1', 'InversionRecovery'],\n    '9010': ['CS', '1', 'FlowCompensation'],\n    '9011': ['CS', '1', 'MultipleSpinEcho'],\n    '9012': ['CS', '1', 'MultiPlanarExcitation'],\n    '9014': ['CS', '1', 'PhaseContrast'],\n    '9015': ['CS', '1', 'TimeOfFlightContrast'],\n    '9016': ['CS', '1', 'Spoiling'],\n    '9017': ['CS', '1', 'SteadyStatePulseSequence'],\n    '9018': ['CS', '1', 'EchoPlanarPulseSequence'],\n    '9019': ['FD', '1', 'TagAngleFirstAxis'],\n    '9020': ['CS', '1', 'MagnetizationTransfer'],\n    '9021': ['CS', '1', 'T2Preparation'],\n    '9022': ['CS', '1', 'BloodSignalNulling'],\n    '9024': ['CS', '1', 'SaturationRecovery'],\n    '9025': ['CS', '1', 'SpectrallySelectedSuppression'],\n    '9026': ['CS', '1', 'SpectrallySelectedExcitation'],\n    '9027': ['CS', '1', 'SpatialPresaturation'],\n    '9028': ['CS', '1', 'Tagging'],\n    '9029': ['CS', '1', 'OversamplingPhase'],\n    '9030': ['FD', '1', 'TagSpacingFirstDimension'],\n    '9032': ['CS', '1', 'GeometryOfKSpaceTraversal'],\n    '9033': ['CS', '1', 'SegmentedKSpaceTraversal'],\n    '9034': ['CS', '1', 'RectilinearPhaseEncodeReordering'],\n    '9035': ['FD', '1', 'TagThickness'],\n    '9036': ['CS', '1', 'PartialFourierDirection'],\n    '9037': ['CS', '1', 'CardiacSynchronizationTechnique'],\n    '9041': ['LO', '1', 'ReceiveCoilManufacturerName'],\n    '9042': ['SQ', '1', 'MRReceiveCoilSequence'],\n    '9043': ['CS', '1', 'ReceiveCoilType'],\n    '9044': ['CS', '1', 'QuadratureReceiveCoil'],\n    '9045': ['SQ', '1', 'MultiCoilDefinitionSequence'],\n    '9046': ['LO', '1', 'MultiCoilConfiguration'],\n    '9047': ['SH', '1', 'MultiCoilElementName'],\n    '9048': ['CS', '1', 'MultiCoilElementUsed'],\n    '9049': ['SQ', '1', 'MRTransmitCoilSequence'],\n    '9050': ['LO', '1', 'TransmitCoilManufacturerName'],\n    '9051': ['CS', '1', 'TransmitCoilType'],\n    '9052': ['FD', '1-2', 'SpectralWidth'],\n    '9053': ['FD', '1-2', 'ChemicalShiftReference'],\n    '9054': ['CS', '1', 'VolumeLocalizationTechnique'],\n    '9058': ['US', '1', 'MRAcquisitionFrequencyEncodingSteps'],\n    '9059': ['CS', '1', 'Decoupling'],\n    '9060': ['CS', '1-2', 'DecoupledNucleus'],\n    '9061': ['FD', '1-2', 'DecouplingFrequency'],\n    '9062': ['CS', '1', 'DecouplingMethod'],\n    '9063': ['FD', '1-2', 'DecouplingChemicalShiftReference'],\n    '9064': ['CS', '1', 'KSpaceFiltering'],\n    '9065': ['CS', '1-2', 'TimeDomainFiltering'],\n    '9066': ['US', '1-2', 'NumberOfZeroFills'],\n    '9067': ['CS', '1', 'BaselineCorrection'],\n    '9069': ['FD', '1', 'ParallelReductionFactorInPlane'],\n    '9070': ['FD', '1', 'CardiacRRIntervalSpecified'],\n    '9073': ['FD', '1', 'AcquisitionDuration'],\n    '9074': ['DT', '1', 'FrameAcquisitionDateTime'],\n    '9075': ['CS', '1', 'DiffusionDirectionality'],\n    '9076': ['SQ', '1', 'DiffusionGradientDirectionSequence'],\n    '9077': ['CS', '1', 'ParallelAcquisition'],\n    '9078': ['CS', '1', 'ParallelAcquisitionTechnique'],\n    '9079': ['FD', '1-n', 'InversionTimes'],\n    '9080': ['ST', '1', 'MetaboliteMapDescription'],\n    '9081': ['CS', '1', 'PartialFourier'],\n    '9082': ['FD', '1', 'EffectiveEchoTime'],\n    '9083': ['SQ', '1', 'MetaboliteMapCodeSequence'],\n    '9084': ['SQ', '1', 'ChemicalShiftSequence'],\n    '9085': ['CS', '1', 'CardiacSignalSource'],\n    '9087': ['FD', '1', 'DiffusionBValue'],\n    '9089': ['FD', '3', 'DiffusionGradientOrientation'],\n    '9090': ['FD', '3', 'VelocityEncodingDirection'],\n    '9091': ['FD', '1', 'VelocityEncodingMinimumValue'],\n    '9092': ['SQ', '1', 'VelocityEncodingAcquisitionSequence'],\n    '9093': ['US', '1', 'NumberOfKSpaceTrajectories'],\n    '9094': ['CS', '1', 'CoverageOfKSpace'],\n    '9095': ['UL', '1', 'SpectroscopyAcquisitionPhaseRows'],\n    '9096': ['FD', '1', 'ParallelReductionFactorInPlaneRetired'],\n    '9098': ['FD', '1-2', 'TransmitterFrequency'],\n    '9100': ['CS', '1-2', 'ResonantNucleus'],\n    '9101': ['CS', '1', 'FrequencyCorrection'],\n    '9103': ['SQ', '1', 'MRSpectroscopyFOVGeometrySequence'],\n    '9104': ['FD', '1', 'SlabThickness'],\n    '9105': ['FD', '3', 'SlabOrientation'],\n    '9106': ['FD', '3', 'MidSlabPosition'],\n    '9107': ['SQ', '1', 'MRSpatialSaturationSequence'],\n    '9112': ['SQ', '1', 'MRTimingAndRelatedParametersSequence'],\n    '9114': ['SQ', '1', 'MREchoSequence'],\n    '9115': ['SQ', '1', 'MRModifierSequence'],\n    '9117': ['SQ', '1', 'MRDiffusionSequence'],\n    '9118': ['SQ', '1', 'CardiacSynchronizationSequence'],\n    '9119': ['SQ', '1', 'MRAveragesSequence'],\n    '9125': ['SQ', '1', 'MRFOVGeometrySequence'],\n    '9126': ['SQ', '1', 'VolumeLocalizationSequence'],\n    '9127': ['UL', '1', 'SpectroscopyAcquisitionDataColumns'],\n    '9147': ['CS', '1', 'DiffusionAnisotropyType'],\n    '9151': ['DT', '1', 'FrameReferenceDateTime'],\n    '9152': ['SQ', '1', 'MRMetaboliteMapSequence'],\n    '9155': ['FD', '1', 'ParallelReductionFactorOutOfPlane'],\n    '9159': ['UL', '1', 'SpectroscopyAcquisitionOutOfPlanePhaseSteps'],\n    '9166': ['CS', '1', 'BulkMotionStatus'],\n    '9168': ['FD', '1', 'ParallelReductionFactorSecondInPlane'],\n    '9169': ['CS', '1', 'CardiacBeatRejectionTechnique'],\n    '9170': ['CS', '1', 'RespiratoryMotionCompensationTechnique'],\n    '9171': ['CS', '1', 'RespiratorySignalSource'],\n    '9172': ['CS', '1', 'BulkMotionCompensationTechnique'],\n    '9173': ['CS', '1', 'BulkMotionSignalSource'],\n    '9174': ['CS', '1', 'ApplicableSafetyStandardAgency'],\n    '9175': ['LO', '1', 'ApplicableSafetyStandardDescription'],\n    '9176': ['SQ', '1', 'OperatingModeSequence'],\n    '9177': ['CS', '1', 'OperatingModeType'],\n    '9178': ['CS', '1', 'OperatingMode'],\n    '9179': ['CS', '1', 'SpecificAbsorptionRateDefinition'],\n    '9180': ['CS', '1', 'GradientOutputType'],\n    '9181': ['FD', '1', 'SpecificAbsorptionRateValue'],\n    '9182': ['FD', '1', 'GradientOutput'],\n    '9183': ['CS', '1', 'FlowCompensationDirection'],\n    '9184': ['FD', '1', 'TaggingDelay'],\n    '9185': ['ST', '1', 'RespiratoryMotionCompensationTechniqueDescription'],\n    '9186': ['SH', '1', 'RespiratorySignalSourceID'],\n    '9195': ['FD', '1', 'ChemicalShiftMinimumIntegrationLimitInHz'],\n    '9196': ['FD', '1', 'ChemicalShiftMaximumIntegrationLimitInHz'],\n    '9197': ['SQ', '1', 'MRVelocityEncodingSequence'],\n    '9198': ['CS', '1', 'FirstOrderPhaseCorrection'],\n    '9199': ['CS', '1', 'WaterReferencedPhaseCorrection'],\n    '9200': ['CS', '1', 'MRSpectroscopyAcquisitionType'],\n    '9214': ['CS', '1', 'RespiratoryCyclePosition'],\n    '9217': ['FD', '1', 'VelocityEncodingMaximumValue'],\n    '9218': ['FD', '1', 'TagSpacingSecondDimension'],\n    '9219': ['SS', '1', 'TagAngleSecondAxis'],\n    '9220': ['FD', '1', 'FrameAcquisitionDuration'],\n    '9226': ['SQ', '1', 'MRImageFrameTypeSequence'],\n    '9227': ['SQ', '1', 'MRSpectroscopyFrameTypeSequence'],\n    '9231': ['US', '1', 'MRAcquisitionPhaseEncodingStepsInPlane'],\n    '9232': ['US', '1', 'MRAcquisitionPhaseEncodingStepsOutOfPlane'],\n    '9234': ['UL', '1', 'SpectroscopyAcquisitionPhaseColumns'],\n    '9236': ['CS', '1', 'CardiacCyclePosition'],\n    '9239': ['SQ', '1', 'SpecificAbsorptionRateSequence'],\n    '9240': ['US', '1', 'RFEchoTrainLength'],\n    '9241': ['US', '1', 'GradientEchoTrainLength'],\n    '9250': ['CS', '1', 'ArterialSpinLabelingContrast'],\n    '9251': ['SQ', '1', 'MRArterialSpinLabelingSequence'],\n    '9252': ['LO', '1', 'ASLTechniqueDescription'],\n    '9253': ['US', '1', 'ASLSlabNumber'],\n    '9254': ['FD', '1', 'ASLSlabThickness'],\n    '9255': ['FD', '3', 'ASLSlabOrientation'],\n    '9256': ['FD', '3', 'ASLMidSlabPosition'],\n    '9257': ['CS', '1', 'ASLContext'],\n    '9258': ['UL', '1', 'ASLPulseTrainDuration'],\n    '9259': ['CS', '1', 'ASLCrusherFlag'],\n    '925A': ['FD', '1', 'ASLCrusherFlowLimit'],\n    '925B': ['LO', '1', 'ASLCrusherDescription'],\n    '925C': ['CS', '1', 'ASLBolusCutoffFlag'],\n    '925D': ['SQ', '1', 'ASLBolusCutoffTimingSequence'],\n    '925E': ['LO', '1', 'ASLBolusCutoffTechnique'],\n    '925F': ['UL', '1', 'ASLBolusCutoffDelayTime'],\n    '9260': ['SQ', '1', 'ASLSlabSequence'],\n    '9295': ['FD', '1', 'ChemicalShiftMinimumIntegrationLimitInppm'],\n    '9296': ['FD', '1', 'ChemicalShiftMaximumIntegrationLimitInppm'],\n    '9297': ['CS', '1', 'WaterReferenceAcquisition'],\n    '9298': ['IS', '1', 'EchoPeakPosition'],\n    '9301': ['SQ', '1', 'CTAcquisitionTypeSequence'],\n    '9302': ['CS', '1', 'AcquisitionType'],\n    '9303': ['FD', '1', 'TubeAngle'],\n    '9304': ['SQ', '1', 'CTAcquisitionDetailsSequence'],\n    '9305': ['FD', '1', 'RevolutionTime'],\n    '9306': ['FD', '1', 'SingleCollimationWidth'],\n    '9307': ['FD', '1', 'TotalCollimationWidth'],\n    '9308': ['SQ', '1', 'CTTableDynamicsSequence'],\n    '9309': ['FD', '1', 'TableSpeed'],\n    '9310': ['FD', '1', 'TableFeedPerRotation'],\n    '9311': ['FD', '1', 'SpiralPitchFactor'],\n    '9312': ['SQ', '1', 'CTGeometrySequence'],\n    '9313': ['FD', '3', 'DataCollectionCenterPatient'],\n    '9314': ['SQ', '1', 'CTReconstructionSequence'],\n    '9315': ['CS', '1', 'ReconstructionAlgorithm'],\n    '9316': ['CS', '1', 'ConvolutionKernelGroup'],\n    '9317': ['FD', '2', 'ReconstructionFieldOfView'],\n    '9318': ['FD', '3', 'ReconstructionTargetCenterPatient'],\n    '9319': ['FD', '1', 'ReconstructionAngle'],\n    '9320': ['SH', '1', 'ImageFilter'],\n    '9321': ['SQ', '1', 'CTExposureSequence'],\n    '9322': ['FD', '2', 'ReconstructionPixelSpacing'],\n    '9323': ['CS', '1-n', 'ExposureModulationType'],\n    '9324': ['FD', '1', 'EstimatedDoseSaving'],\n    '9325': ['SQ', '1', 'CTXRayDetailsSequence'],\n    '9326': ['SQ', '1', 'CTPositionSequence'],\n    '9327': ['FD', '1', 'TablePosition'],\n    '9328': ['FD', '1', 'ExposureTimeInms'],\n    '9329': ['SQ', '1', 'CTImageFrameTypeSequence'],\n    '9330': ['FD', '1', 'XRayTubeCurrentInmA'],\n    '9332': ['FD', '1', 'ExposureInmAs'],\n    '9333': ['CS', '1', 'ConstantVolumeFlag'],\n    '9334': ['CS', '1', 'FluoroscopyFlag'],\n    '9335': ['FD', '1', 'DistanceSourceToDataCollectionCenter'],\n    '9337': ['US', '1', 'ContrastBolusAgentNumber'],\n    '9338': ['SQ', '1', 'ContrastBolusIngredientCodeSequence'],\n    '9340': ['SQ', '1', 'ContrastAdministrationProfileSequence'],\n    '9341': ['SQ', '1', 'ContrastBolusUsageSequence'],\n    '9342': ['CS', '1', 'ContrastBolusAgentAdministered'],\n    '9343': ['CS', '1', 'ContrastBolusAgentDetected'],\n    '9344': ['CS', '1', 'ContrastBolusAgentPhase'],\n    '9345': ['FD', '1', 'CTDIvol'],\n    '9346': ['SQ', '1', 'CTDIPhantomTypeCodeSequence'],\n    '9351': ['FL', '1', 'CalciumScoringMassFactorPatient'],\n    '9352': ['FL', '3', 'CalciumScoringMassFactorDevice'],\n    '9353': ['FL', '1', 'EnergyWeightingFactor'],\n    '9360': ['SQ', '1', 'CTAdditionalXRaySourceSequence'],\n    '9361': ['CS', '1', 'MultienergyCTAcquisition'],\n    '9362': ['SQ', '1', 'MultienergyCTAcquisitionSequence'],\n    '9363': ['SQ', '1', 'MultienergyCTProcessingSequence'],\n    '9364': ['SQ', '1', 'MultienergyCTCharacteristicsSequence'],\n    '9365': ['SQ', '1', 'MultienergyCTXRaySourceSequence'],\n    '9366': ['US', '1', 'XRaySourceIndex'],\n    '9367': ['UC', '1', 'XRaySourceID'],\n    '9368': ['CS', '1', 'MultienergySourceTechnique'],\n    '9369': ['DT', '1', 'SourceStartDateTime'],\n    '936A': ['DT', '1', 'SourceEndDateTime'],\n    '936B': ['US', '1', 'SwitchingPhaseNumber'],\n    '936C': ['DS', '1', 'SwitchingPhaseNominalDuration'],\n    '936D': ['DS', '1', 'SwitchingPhaseTransitionDuration'],\n    '936E': ['DS', '1', 'EffectiveBinEnergy'],\n    '936F': ['SQ', '1', 'MultienergyCTXRayDetectorSequence'],\n    '9370': ['US', '1', 'XRayDetectorIndex'],\n    '9371': ['UC', '1', 'XRayDetectorID'],\n    '9372': ['CS', '1', 'MultienergyDetectorType'],\n    '9373': ['ST', '1', 'XRayDetectorLabel'],\n    '9374': ['DS', '1', 'NominalMaxEnergy'],\n    '9375': ['DS', '1', 'NominalMinEnergy'],\n    '9376': ['US', '1-n', 'ReferencedXRayDetectorIndex'],\n    '9377': ['US', '1-n', 'ReferencedXRaySourceIndex'],\n    '9378': ['US', '1-n', 'ReferencedPathIndex'],\n    '9379': ['SQ', '1', 'MultienergyCTPathSequence'],\n    '937A': ['US', '1', 'MultienergyCTPathIndex'],\n    '937B': ['UT', '1', 'MultienergyAcquisitionDescription'],\n    '937C': ['FD', '1', 'MonoenergeticEnergyEquivalent'],\n    '937D': ['SQ', '1', 'MaterialCodeSequence'],\n    '937E': ['CS', '1', 'DecompositionMethod'],\n    '937F': ['UT', '1', 'DecompositionDescription'],\n    '9380': ['SQ', '1', 'DecompositionAlgorithmIdentificationSequence'],\n    '9381': ['SQ', '1', 'DecompositionMaterialSequence'],\n    '9382': ['SQ', '1', 'MaterialAttenuationSequence'],\n    '9383': ['DS', '1', 'PhotonEnergy'],\n    '9384': ['DS', '1', 'XRayMassAttenuationCoefficient'],\n    '9401': ['SQ', '1', 'ProjectionPixelCalibrationSequence'],\n    '9402': ['FL', '1', 'DistanceSourceToIsocenter'],\n    '9403': ['FL', '1', 'DistanceObjectToTableTop'],\n    '9404': ['FL', '2', 'ObjectPixelSpacingInCenterOfBeam'],\n    '9405': ['SQ', '1', 'PositionerPositionSequence'],\n    '9406': ['SQ', '1', 'TablePositionSequence'],\n    '9407': ['SQ', '1', 'CollimatorShapeSequence'],\n    '9410': ['CS', '1', 'PlanesInAcquisition'],\n    '9412': ['SQ', '1', 'XAXRFFrameCharacteristicsSequence'],\n    '9417': ['SQ', '1', 'FrameAcquisitionSequence'],\n    '9420': ['CS', '1', 'XRayReceptorType'],\n    '9423': ['LO', '1', 'AcquisitionProtocolName'],\n    '9424': ['LT', '1', 'AcquisitionProtocolDescription'],\n    '9425': ['CS', '1', 'ContrastBolusIngredientOpaque'],\n    '9426': ['FL', '1', 'DistanceReceptorPlaneToDetectorHousing'],\n    '9427': ['CS', '1', 'IntensifierActiveShape'],\n    '9428': ['FL', '1-2', 'IntensifierActiveDimensions'],\n    '9429': ['FL', '2', 'PhysicalDetectorSize'],\n    '9430': ['FL', '2', 'PositionOfIsocenterProjection'],\n    '9432': ['SQ', '1', 'FieldOfViewSequence'],\n    '9433': ['LO', '1', 'FieldOfViewDescription'],\n    '9434': ['SQ', '1', 'ExposureControlSensingRegionsSequence'],\n    '9435': ['CS', '1', 'ExposureControlSensingRegionShape'],\n    '9436': ['SS', '1', 'ExposureControlSensingRegionLeftVerticalEdge'],\n    '9437': ['SS', '1', 'ExposureControlSensingRegionRightVerticalEdge'],\n    '9438': ['SS', '1', 'ExposureControlSensingRegionUpperHorizontalEdge'],\n    '9439': ['SS', '1', 'ExposureControlSensingRegionLowerHorizontalEdge'],\n    '9440': ['SS', '2', 'CenterOfCircularExposureControlSensingRegion'],\n    '9441': ['US', '1', 'RadiusOfCircularExposureControlSensingRegion'],\n    '9442': ['SS', '2-n', 'VerticesOfThePolygonalExposureControlSensingRegion'],\n    '9445': ['', '', ''],\n    '9447': ['FL', '1', 'ColumnAngulationPatient'],\n    '9449': ['FL', '1', 'BeamAngle'],\n    '9451': ['SQ', '1', 'FrameDetectorParametersSequence'],\n    '9452': ['FL', '1', 'CalculatedAnatomyThickness'],\n    '9455': ['SQ', '1', 'CalibrationSequence'],\n    '9456': ['SQ', '1', 'ObjectThicknessSequence'],\n    '9457': ['CS', '1', 'PlaneIdentification'],\n    '9461': ['FL', '1-2', 'FieldOfViewDimensionsInFloat'],\n    '9462': ['SQ', '1', 'IsocenterReferenceSystemSequence'],\n    '9463': ['FL', '1', 'PositionerIsocenterPrimaryAngle'],\n    '9464': ['FL', '1', 'PositionerIsocenterSecondaryAngle'],\n    '9465': ['FL', '1', 'PositionerIsocenterDetectorRotationAngle'],\n    '9466': ['FL', '1', 'TableXPositionToIsocenter'],\n    '9467': ['FL', '1', 'TableYPositionToIsocenter'],\n    '9468': ['FL', '1', 'TableZPositionToIsocenter'],\n    '9469': ['FL', '1', 'TableHorizontalRotationAngle'],\n    '9470': ['FL', '1', 'TableHeadTiltAngle'],\n    '9471': ['FL', '1', 'TableCradleTiltAngle'],\n    '9472': ['SQ', '1', 'FrameDisplayShutterSequence'],\n    '9473': ['FL', '1', 'AcquiredImageAreaDoseProduct'],\n    '9474': ['CS', '1', 'CArmPositionerTabletopRelationship'],\n    '9476': ['SQ', '1', 'XRayGeometrySequence'],\n    '9477': ['SQ', '1', 'IrradiationEventIdentificationSequence'],\n    '9504': ['SQ', '1', 'XRay3DFrameTypeSequence'],\n    '9506': ['SQ', '1', 'ContributingSourcesSequence'],\n    '9507': ['SQ', '1', 'XRay3DAcquisitionSequence'],\n    '9508': ['FL', '1', 'PrimaryPositionerScanArc'],\n    '9509': ['FL', '1', 'SecondaryPositionerScanArc'],\n    '9510': ['FL', '1', 'PrimaryPositionerScanStartAngle'],\n    '9511': ['FL', '1', 'SecondaryPositionerScanStartAngle'],\n    '9514': ['FL', '1', 'PrimaryPositionerIncrement'],\n    '9515': ['FL', '1', 'SecondaryPositionerIncrement'],\n    '9516': ['DT', '1', 'StartAcquisitionDateTime'],\n    '9517': ['DT', '1', 'EndAcquisitionDateTime'],\n    '9518': ['SS', '1', 'PrimaryPositionerIncrementSign'],\n    '9519': ['SS', '1', 'SecondaryPositionerIncrementSign'],\n    '9524': ['LO', '1', 'ApplicationName'],\n    '9525': ['LO', '1', 'ApplicationVersion'],\n    '9526': ['LO', '1', 'ApplicationManufacturer'],\n    '9527': ['CS', '1', 'AlgorithmType'],\n    '9528': ['LO', '1', 'AlgorithmDescription'],\n    '9530': ['SQ', '1', 'XRay3DReconstructionSequence'],\n    '9531': ['LO', '1', 'ReconstructionDescription'],\n    '9538': ['SQ', '1', 'PerProjectionAcquisitionSequence'],\n    '9541': ['SQ', '1', 'DetectorPositionSequence'],\n    '9542': ['SQ', '1', 'XRayAcquisitionDoseSequence'],\n    '9543': ['FD', '1', 'XRaySourceIsocenterPrimaryAngle'],\n    '9544': ['FD', '1', 'XRaySourceIsocenterSecondaryAngle'],\n    '9545': ['FD', '1', 'BreastSupportIsocenterPrimaryAngle'],\n    '9546': ['FD', '1', 'BreastSupportIsocenterSecondaryAngle'],\n    '9547': ['FD', '1', 'BreastSupportXPositionToIsocenter'],\n    '9548': ['FD', '1', 'BreastSupportYPositionToIsocenter'],\n    '9549': ['FD', '1', 'BreastSupportZPositionToIsocenter'],\n    '9550': ['FD', '1', 'DetectorIsocenterPrimaryAngle'],\n    '9551': ['FD', '1', 'DetectorIsocenterSecondaryAngle'],\n    '9552': ['FD', '1', 'DetectorXPositionToIsocenter'],\n    '9553': ['FD', '1', 'DetectorYPositionToIsocenter'],\n    '9554': ['FD', '1', 'DetectorZPositionToIsocenter'],\n    '9555': ['SQ', '1', 'XRayGridSequence'],\n    '9556': ['SQ', '1', 'XRayFilterSequence'],\n    '9557': ['FD', '3', 'DetectorActiveAreaTLHCPosition'],\n    '9558': ['FD', '6', 'DetectorActiveAreaOrientation'],\n    '9559': ['CS', '1', 'PositionerPrimaryAngleDirection'],\n    '9601': ['SQ', '1', 'DiffusionBMatrixSequence'],\n    '9602': ['FD', '1', 'DiffusionBValueXX'],\n    '9603': ['FD', '1', 'DiffusionBValueXY'],\n    '9604': ['FD', '1', 'DiffusionBValueXZ'],\n    '9605': ['FD', '1', 'DiffusionBValueYY'],\n    '9606': ['FD', '1', 'DiffusionBValueYZ'],\n    '9607': ['FD', '1', 'DiffusionBValueZZ'],\n    '9621': ['SQ', '1', 'FunctionalMRSequence'],\n    '9622': ['CS', '1', 'FunctionalSettlingPhaseFramesPresent'],\n    '9623': ['DT', '1', 'FunctionalSyncPulse'],\n    '9624': ['CS', '1', 'SettlingPhaseFrame'],\n    '9701': ['DT', '1', 'DecayCorrectionDateTime'],\n    '9715': ['FD', '1', 'StartDensityThreshold'],\n    '9716': ['FD', '1', 'StartRelativeDensityDifferenceThreshold'],\n    '9717': ['FD', '1', 'StartCardiacTriggerCountThreshold'],\n    '9718': ['FD', '1', 'StartRespiratoryTriggerCountThreshold'],\n    '9719': ['FD', '1', 'TerminationCountsThreshold'],\n    '9720': ['FD', '1', 'TerminationDensityThreshold'],\n    '9721': ['FD', '1', 'TerminationRelativeDensityThreshold'],\n    '9722': ['FD', '1', 'TerminationTimeThreshold'],\n    '9723': ['FD', '1', 'TerminationCardiacTriggerCountThreshold'],\n    '9724': ['FD', '1', 'TerminationRespiratoryTriggerCountThreshold'],\n    '9725': ['CS', '1', 'DetectorGeometry'],\n    '9726': ['FD', '1', 'TransverseDetectorSeparation'],\n    '9727': ['FD', '1', 'AxialDetectorDimension'],\n    '9729': ['US', '1', 'RadiopharmaceuticalAgentNumber'],\n    '9732': ['SQ', '1', 'PETFrameAcquisitionSequence'],\n    '9733': ['SQ', '1', 'PETDetectorMotionDetailsSequence'],\n    '9734': ['SQ', '1', 'PETTableDynamicsSequence'],\n    '9735': ['SQ', '1', 'PETPositionSequence'],\n    '9736': ['SQ', '1', 'PETFrameCorrectionFactorsSequence'],\n    '9737': ['SQ', '1', 'RadiopharmaceuticalUsageSequence'],\n    '9738': ['CS', '1', 'AttenuationCorrectionSource'],\n    '9739': ['US', '1', 'NumberOfIterations'],\n    '9740': ['US', '1', 'NumberOfSubsets'],\n    '9749': ['SQ', '1', 'PETReconstructionSequence'],\n    '9751': ['SQ', '1', 'PETFrameTypeSequence'],\n    '9755': ['CS', '1', 'TimeOfFlightInformationUsed'],\n    '9756': ['CS', '1', 'ReconstructionType'],\n    '9758': ['CS', '1', 'DecayCorrected'],\n    '9759': ['CS', '1', 'AttenuationCorrected'],\n    '9760': ['CS', '1', 'ScatterCorrected'],\n    '9761': ['CS', '1', 'DeadTimeCorrected'],\n    '9762': ['CS', '1', 'GantryMotionCorrected'],\n    '9763': ['CS', '1', 'PatientMotionCorrected'],\n    '9764': ['CS', '1', 'CountLossNormalizationCorrected'],\n    '9765': ['CS', '1', 'RandomsCorrected'],\n    '9766': ['CS', '1', 'NonUniformRadialSamplingCorrected'],\n    '9767': ['CS', '1', 'SensitivityCalibrated'],\n    '9768': ['CS', '1', 'DetectorNormalizationCorrection'],\n    '9769': ['CS', '1', 'IterativeReconstructionMethod'],\n    '9770': ['CS', '1', 'AttenuationCorrectionTemporalRelationship'],\n    '9771': ['SQ', '1', 'PatientPhysiologicalStateSequence'],\n    '9772': ['SQ', '1', 'PatientPhysiologicalStateCodeSequence'],\n    '9801': ['FD', '1-n', 'DepthsOfFocus'],\n    '9803': ['SQ', '1', 'ExcludedIntervalsSequence'],\n    '9804': ['DT', '1', 'ExclusionStartDateTime'],\n    '9805': ['FD', '1', 'ExclusionDuration'],\n    '9806': ['SQ', '1', 'USImageDescriptionSequence'],\n    '9807': ['SQ', '1', 'ImageDataTypeSequence'],\n    '9808': ['CS', '1', 'DataType'],\n    '9809': ['SQ', '1', 'TransducerScanPatternCodeSequence'],\n    '980B': ['CS', '1', 'AliasedDataType'],\n    '980C': ['CS', '1', 'PositionMeasuringDeviceUsed'],\n    '980D': ['SQ', '1', 'TransducerGeometryCodeSequence'],\n    '980E': ['SQ', '1', 'TransducerBeamSteeringCodeSequence'],\n    '980F': ['SQ', '1', 'TransducerApplicationCodeSequence'],\n    '9810': ['xs', '1', 'ZeroVelocityPixelValue'],\n    '9900': ['LO', '1', 'ReferenceLocationLabel'],\n    '9901': ['UT', '1', 'ReferenceLocationDescription'],\n    '9902': ['SQ', '1', 'ReferenceBasisCodeSequence'],\n    '9903': ['SQ', '1', 'ReferenceGeometryCodeSequence'],\n    '9904': ['DS', '1', 'OffsetDistance'],\n    '9905': ['CS', '1', 'OffsetDirection'],\n    '9906': ['SQ', '1', 'PotentialScheduledProtocolCodeSequence'],\n    '9907': ['SQ', '1', 'PotentialRequestedProcedureCodeSequence'],\n    '9908': ['UC', '1-n', 'PotentialReasonsForProcedure'],\n    '9909': ['SQ', '1', 'PotentialReasonsForProcedureCodeSequence'],\n    '990A': ['UC', '1-n', 'PotentialDiagnosticTasks'],\n    '990B': ['SQ', '1', 'ContraindicationsCodeSequence'],\n    '990C': ['SQ', '1', 'ReferencedDefinedProtocolSequence'],\n    '990D': ['SQ', '1', 'ReferencedPerformedProtocolSequence'],\n    '990E': ['SQ', '1', 'PredecessorProtocolSequence'],\n    '990F': ['UT', '1', 'ProtocolPlanningInformation'],\n    '9910': ['UT', '1', 'ProtocolDesignRationale'],\n    '9911': ['SQ', '1', 'PatientSpecificationSequence'],\n    '9912': ['SQ', '1', 'ModelSpecificationSequence'],\n    '9913': ['SQ', '1', 'ParametersSpecificationSequence'],\n    '9914': ['SQ', '1', 'InstructionSequence'],\n    '9915': ['US', '1', 'InstructionIndex'],\n    '9916': ['LO', '1', 'InstructionText'],\n    '9917': ['UT', '1', 'InstructionDescription'],\n    '9918': ['CS', '1', 'InstructionPerformedFlag'],\n    '9919': ['DT', '1', 'InstructionPerformedDateTime'],\n    '991A': ['UT', '1', 'InstructionPerformanceComment'],\n    '991B': ['SQ', '1', 'PatientPositioningInstructionSequence'],\n    '991C': ['SQ', '1', 'PositioningMethodCodeSequence'],\n    '991D': ['SQ', '1', 'PositioningLandmarkSequence'],\n    '991E': ['UI', '1', 'TargetFrameOfReferenceUID'],\n    '991F': ['SQ', '1', 'AcquisitionProtocolElementSpecificationSequence'],\n    '9920': ['SQ', '1', 'AcquisitionProtocolElementSequence'],\n    '9921': ['US', '1', 'ProtocolElementNumber'],\n    '9922': ['LO', '1', 'ProtocolElementName'],\n    '9923': ['UT', '1', 'ProtocolElementCharacteristicsSummary'],\n    '9924': ['UT', '1', 'ProtocolElementPurpose'],\n    '9930': ['CS', '1', 'AcquisitionMotion'],\n    '9931': ['SQ', '1', 'AcquisitionStartLocationSequence'],\n    '9932': ['SQ', '1', 'AcquisitionEndLocationSequence'],\n    '9933': ['SQ', '1', 'ReconstructionProtocolElementSpecificationSequence'],\n    '9934': ['SQ', '1', 'ReconstructionProtocolElementSequence'],\n    '9935': ['SQ', '1', 'StorageProtocolElementSpecificationSequence'],\n    '9936': ['SQ', '1', 'StorageProtocolElementSequence'],\n    '9937': ['LO', '1', 'RequestedSeriesDescription'],\n    '9938': ['US', '1-n', 'SourceAcquisitionProtocolElementNumber'],\n    '9939': ['US', '1-n', 'SourceAcquisitionBeamNumber'],\n    '993A': ['US', '1-n', 'SourceReconstructionProtocolElementNumber'],\n    '993B': ['SQ', '1', 'ReconstructionStartLocationSequence'],\n    '993C': ['SQ', '1', 'ReconstructionEndLocationSequence'],\n    '993D': ['SQ', '1', 'ReconstructionAlgorithmSequence'],\n    '993E': ['SQ', '1', 'ReconstructionTargetCenterLocationSequence'],\n    '9941': ['UT', '1', 'ImageFilterDescription'],\n    '9942': ['FD', '1', 'CTDIvolNotificationTrigger'],\n    '9943': ['FD', '1', 'DLPNotificationTrigger'],\n    '9944': ['CS', '1', 'AutoKVPSelectionType'],\n    '9945': ['FD', '1', 'AutoKVPUpperBound'],\n    '9946': ['FD', '1', 'AutoKVPLowerBound'],\n    '9947': ['CS', '1', 'ProtocolDefinedPatientPosition'],\n    'A001': ['SQ', '1', 'ContributingEquipmentSequence'],\n    'A002': ['DT', '1', 'ContributionDateTime'],\n    'A003': ['ST', '1', 'ContributionDescription']\n  },\n  '0020': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '000D': ['UI', '1', 'StudyInstanceUID'],\n    '000E': ['UI', '1', 'SeriesInstanceUID'],\n    '0010': ['SH', '1', 'StudyID'],\n    '0011': ['IS', '1', 'SeriesNumber'],\n    '0012': ['IS', '1', 'AcquisitionNumber'],\n    '0013': ['IS', '1', 'InstanceNumber'],\n    '0014': ['IS', '1', 'IsotopeNumber'],\n    '0015': ['IS', '1', 'PhaseNumber'],\n    '0016': ['IS', '1', 'IntervalNumber'],\n    '0017': ['IS', '1', 'TimeSlotNumber'],\n    '0018': ['IS', '1', 'AngleNumber'],\n    '0019': ['IS', '1', 'ItemNumber'],\n    '0020': ['CS', '2', 'PatientOrientation'],\n    '0022': ['IS', '1', 'OverlayNumber'],\n    '0024': ['IS', '1', 'CurveNumber'],\n    '0026': ['IS', '1', 'LUTNumber'],\n    '0030': ['DS', '3', 'ImagePosition'],\n    '0032': ['DS', '3', 'ImagePositionPatient'],\n    '0035': ['DS', '6', 'ImageOrientation'],\n    '0037': ['DS', '6', 'ImageOrientationPatient'],\n    '0050': ['DS', '1', 'Location'],\n    '0052': ['UI', '1', 'FrameOfReferenceUID'],\n    '0060': ['CS', '1', 'Laterality'],\n    '0062': ['CS', '1', 'ImageLaterality'],\n    '0070': ['LO', '1', 'ImageGeometryType'],\n    '0080': ['CS', '1-n', 'MaskingImage'],\n    '00AA': ['IS', '1', 'ReportNumber'],\n    '0100': ['IS', '1', 'TemporalPositionIdentifier'],\n    '0105': ['IS', '1', 'NumberOfTemporalPositions'],\n    '0110': ['DS', '1', 'TemporalResolution'],\n    '0200': ['UI', '1', 'SynchronizationFrameOfReferenceUID'],\n    '0242': ['UI', '1', 'SOPInstanceUIDOfConcatenationSource'],\n    '1000': ['IS', '1', 'SeriesInStudy'],\n    '1001': ['IS', '1', 'AcquisitionsInSeries'],\n    '1002': ['IS', '1', 'ImagesInAcquisition'],\n    '1003': ['IS', '1', 'ImagesInSeries'],\n    '1004': ['IS', '1', 'AcquisitionsInStudy'],\n    '1005': ['IS', '1', 'ImagesInStudy'],\n    '1020': ['LO', '1-n', 'Reference'],\n    '103F': ['LO', '1', 'TargetPositionReferenceIndicator'],\n    '1040': ['LO', '1', 'PositionReferenceIndicator'],\n    '1041': ['DS', '1', 'SliceLocation'],\n    '1070': ['IS', '1-n', 'OtherStudyNumbers'],\n    '1200': ['IS', '1', 'NumberOfPatientRelatedStudies'],\n    '1202': ['IS', '1', 'NumberOfPatientRelatedSeries'],\n    '1204': ['IS', '1', 'NumberOfPatientRelatedInstances'],\n    '1206': ['IS', '1', 'NumberOfStudyRelatedSeries'],\n    '1208': ['IS', '1', 'NumberOfStudyRelatedInstances'],\n    '1209': ['IS', '1', 'NumberOfSeriesRelatedInstances'],\n    '3100': ['CS', '1-n', 'SourceImageIDs'],\n    '3401': ['CS', '1', 'ModifyingDeviceID'],\n    '3402': ['CS', '1', 'ModifiedImageID'],\n    '3403': ['DA', '1', 'ModifiedImageDate'],\n    '3404': ['LO', '1', 'ModifyingDeviceManufacturer'],\n    '3405': ['TM', '1', 'ModifiedImageTime'],\n    '3406': ['LO', '1', 'ModifiedImageDescription'],\n    '4000': ['LT', '1', 'ImageComments'],\n    '5000': ['AT', '1-n', 'OriginalImageIdentification'],\n    '5002': ['LO', '1-n', 'OriginalImageIdentificationNomenclature'],\n    '9056': ['SH', '1', 'StackID'],\n    '9057': ['UL', '1', 'InStackPositionNumber'],\n    '9071': ['SQ', '1', 'FrameAnatomySequence'],\n    '9072': ['CS', '1', 'FrameLaterality'],\n    '9111': ['SQ', '1', 'FrameContentSequence'],\n    '9113': ['SQ', '1', 'PlanePositionSequence'],\n    '9116': ['SQ', '1', 'PlaneOrientationSequence'],\n    '9128': ['UL', '1', 'TemporalPositionIndex'],\n    '9153': ['FD', '1', 'NominalCardiacTriggerDelayTime'],\n    '9154': ['FL', '1', 'NominalCardiacTriggerTimePriorToRPeak'],\n    '9155': ['FL', '1', 'ActualCardiacTriggerTimePriorToRPeak'],\n    '9156': ['US', '1', 'FrameAcquisitionNumber'],\n    '9157': ['UL', '1-n', 'DimensionIndexValues'],\n    '9158': ['LT', '1', 'FrameComments'],\n    '9161': ['UI', '1', 'ConcatenationUID'],\n    '9162': ['US', '1', 'InConcatenationNumber'],\n    '9163': ['US', '1', 'InConcatenationTotalNumber'],\n    '9164': ['UI', '1', 'DimensionOrganizationUID'],\n    '9165': ['AT', '1', 'DimensionIndexPointer'],\n    '9167': ['AT', '1', 'FunctionalGroupPointer'],\n    '9170': ['SQ', '1', 'UnassignedSharedConvertedAttributesSequence'],\n    '9171': ['SQ', '1', 'UnassignedPerFrameConvertedAttributesSequence'],\n    '9172': ['SQ', '1', 'ConversionSourceAttributesSequence'],\n    '9213': ['LO', '1', 'DimensionIndexPrivateCreator'],\n    '9221': ['SQ', '1', 'DimensionOrganizationSequence'],\n    '9222': ['SQ', '1', 'DimensionIndexSequence'],\n    '9228': ['UL', '1', 'ConcatenationFrameOffsetNumber'],\n    '9238': ['LO', '1', 'FunctionalGroupPrivateCreator'],\n    '9241': ['FL', '1', 'NominalPercentageOfCardiacPhase'],\n    '9245': ['FL', '1', 'NominalPercentageOfRespiratoryPhase'],\n    '9246': ['FL', '1', 'StartingRespiratoryAmplitude'],\n    '9247': ['CS', '1', 'StartingRespiratoryPhase'],\n    '9248': ['FL', '1', 'EndingRespiratoryAmplitude'],\n    '9249': ['CS', '1', 'EndingRespiratoryPhase'],\n    '9250': ['CS', '1', 'RespiratoryTriggerType'],\n    '9251': ['FD', '1', 'RRIntervalTimeNominal'],\n    '9252': ['FD', '1', 'ActualCardiacTriggerDelayTime'],\n    '9253': ['SQ', '1', 'RespiratorySynchronizationSequence'],\n    '9254': ['FD', '1', 'RespiratoryIntervalTime'],\n    '9255': ['FD', '1', 'NominalRespiratoryTriggerDelayTime'],\n    '9256': ['FD', '1', 'RespiratoryTriggerDelayThreshold'],\n    '9257': ['FD', '1', 'ActualRespiratoryTriggerDelayTime'],\n    '9301': ['FD', '3', 'ImagePositionVolume'],\n    '9302': ['FD', '6', 'ImageOrientationVolume'],\n    '9307': ['CS', '1', 'UltrasoundAcquisitionGeometry'],\n    '9308': ['FD', '3', 'ApexPosition'],\n    '9309': ['FD', '16', 'VolumeToTransducerMappingMatrix'],\n    '930A': ['FD', '16', 'VolumeToTableMappingMatrix'],\n    '930B': ['CS', '1', 'VolumeToTransducerRelationship'],\n    '930C': ['CS', '1', 'PatientFrameOfReferenceSource'],\n    '930D': ['FD', '1', 'TemporalPositionTimeOffset'],\n    '930E': ['SQ', '1', 'PlanePositionVolumeSequence'],\n    '930F': ['SQ', '1', 'PlaneOrientationVolumeSequence'],\n    '9310': ['SQ', '1', 'TemporalPositionSequence'],\n    '9311': ['CS', '1', 'DimensionOrganizationType'],\n    '9312': ['UI', '1', 'VolumeFrameOfReferenceUID'],\n    '9313': ['UI', '1', 'TableFrameOfReferenceUID'],\n    '9421': ['LO', '1', 'DimensionDescriptionLabel'],\n    '9450': ['SQ', '1', 'PatientOrientationInFrameSequence'],\n    '9453': ['LO', '1', 'FrameLabel'],\n    '9518': ['US', '1-n', 'AcquisitionIndex'],\n    '9529': ['SQ', '1', 'ContributingSOPInstancesReferenceSequence'],\n    '9536': ['US', '1', 'ReconstructionIndex']\n  },\n  '0022': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['US', '1', 'LightPathFilterPassThroughWavelength'],\n    '0002': ['US', '2', 'LightPathFilterPassBand'],\n    '0003': ['US', '1', 'ImagePathFilterPassThroughWavelength'],\n    '0004': ['US', '2', 'ImagePathFilterPassBand'],\n    '0005': ['CS', '1', 'PatientEyeMovementCommanded'],\n    '0006': ['SQ', '1', 'PatientEyeMovementCommandCodeSequence'],\n    '0007': ['FL', '1', 'SphericalLensPower'],\n    '0008': ['FL', '1', 'CylinderLensPower'],\n    '0009': ['FL', '1', 'CylinderAxis'],\n    '000A': ['FL', '1', 'EmmetropicMagnification'],\n    '000B': ['FL', '1', 'IntraOcularPressure'],\n    '000C': ['FL', '1', 'HorizontalFieldOfView'],\n    '000D': ['CS', '1', 'PupilDilated'],\n    '000E': ['FL', '1', 'DegreeOfDilation'],\n    '0010': ['FL', '1', 'StereoBaselineAngle'],\n    '0011': ['FL', '1', 'StereoBaselineDisplacement'],\n    '0012': ['FL', '1', 'StereoHorizontalPixelOffset'],\n    '0013': ['FL', '1', 'StereoVerticalPixelOffset'],\n    '0014': ['FL', '1', 'StereoRotation'],\n    '0015': ['SQ', '1', 'AcquisitionDeviceTypeCodeSequence'],\n    '0016': ['SQ', '1', 'IlluminationTypeCodeSequence'],\n    '0017': ['SQ', '1', 'LightPathFilterTypeStackCodeSequence'],\n    '0018': ['SQ', '1', 'ImagePathFilterTypeStackCodeSequence'],\n    '0019': ['SQ', '1', 'LensesCodeSequence'],\n    '001A': ['SQ', '1', 'ChannelDescriptionCodeSequence'],\n    '001B': ['SQ', '1', 'RefractiveStateSequence'],\n    '001C': ['SQ', '1', 'MydriaticAgentCodeSequence'],\n    '001D': ['SQ', '1', 'RelativeImagePositionCodeSequence'],\n    '001E': ['FL', '1', 'CameraAngleOfView'],\n    '0020': ['SQ', '1', 'StereoPairsSequence'],\n    '0021': ['SQ', '1', 'LeftImageSequence'],\n    '0022': ['SQ', '1', 'RightImageSequence'],\n    '0028': ['CS', '1', 'StereoPairsPresent'],\n    '0030': ['FL', '1', 'AxialLengthOfTheEye'],\n    '0031': ['SQ', '1', 'OphthalmicFrameLocationSequence'],\n    '0032': ['FL', '2-2n', 'ReferenceCoordinates'],\n    '0035': ['FL', '1', 'DepthSpatialResolution'],\n    '0036': ['FL', '1', 'MaximumDepthDistortion'],\n    '0037': ['FL', '1', 'AlongScanSpatialResolution'],\n    '0038': ['FL', '1', 'MaximumAlongScanDistortion'],\n    '0039': ['CS', '1', 'OphthalmicImageOrientation'],\n    '0041': ['FL', '1', 'DepthOfTransverseImage'],\n    '0042': ['SQ', '1', 'MydriaticAgentConcentrationUnitsSequence'],\n    '0048': ['FL', '1', 'AcrossScanSpatialResolution'],\n    '0049': ['FL', '1', 'MaximumAcrossScanDistortion'],\n    '004E': ['DS', '1', 'MydriaticAgentConcentration'],\n    '0055': ['FL', '1', 'IlluminationWaveLength'],\n    '0056': ['FL', '1', 'IlluminationPower'],\n    '0057': ['FL', '1', 'IlluminationBandwidth'],\n    '0058': ['SQ', '1', 'MydriaticAgentSequence'],\n    '1007': ['SQ', '1', 'OphthalmicAxialMeasurementsRightEyeSequence'],\n    '1008': ['SQ', '1', 'OphthalmicAxialMeasurementsLeftEyeSequence'],\n    '1009': ['CS', '1', 'OphthalmicAxialMeasurementsDeviceType'],\n    '1010': ['CS', '1', 'OphthalmicAxialLengthMeasurementsType'],\n    '1012': ['SQ', '1', 'OphthalmicAxialLengthSequence'],\n    '1019': ['FL', '1', 'OphthalmicAxialLength'],\n    '1024': ['SQ', '1', 'LensStatusCodeSequence'],\n    '1025': ['SQ', '1', 'VitreousStatusCodeSequence'],\n    '1028': ['SQ', '1', 'IOLFormulaCodeSequence'],\n    '1029': ['LO', '1', 'IOLFormulaDetail'],\n    '1033': ['FL', '1', 'KeratometerIndex'],\n    '1035': ['SQ', '1', 'SourceOfOphthalmicAxialLengthCodeSequence'],\n    '1036': ['SQ', '1', 'SourceOfCornealSizeDataCodeSequence'],\n    '1037': ['FL', '1', 'TargetRefraction'],\n    '1039': ['CS', '1', 'RefractiveProcedureOccurred'],\n    '1040': ['SQ', '1', 'RefractiveSurgeryTypeCodeSequence'],\n    '1044': ['SQ', '1', 'OphthalmicUltrasoundMethodCodeSequence'],\n    '1045': ['SQ', '1', 'SurgicallyInducedAstigmatismSequence'],\n    '1046': ['CS', '1', 'TypeOfOpticalCorrection'],\n    '1047': ['SQ', '1', 'ToricIOLPowerSequence'],\n    '1048': ['SQ', '1', 'PredictedToricErrorSequence'],\n    '1049': ['CS', '1', 'PreSelectedForImplantation'],\n    '104A': ['SQ', '1', 'ToricIOLPowerForExactEmmetropiaSequence'],\n    '104B': ['SQ', '1', 'ToricIOLPowerForExactTargetRefractionSequence'],\n    '1050': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsSequence'],\n    '1053': ['FL', '1', 'IOLPower'],\n    '1054': ['FL', '1', 'PredictedRefractiveError'],\n    '1059': ['FL', '1', 'OphthalmicAxialLengthVelocity'],\n    '1065': ['LO', '1', 'LensStatusDescription'],\n    '1066': ['LO', '1', 'VitreousStatusDescription'],\n    '1090': ['SQ', '1', 'IOLPowerSequence'],\n    '1092': ['SQ', '1', 'LensConstantSequence'],\n    '1093': ['LO', '1', 'IOLManufacturer'],\n    '1094': ['LO', '1', 'LensConstantDescription'],\n    '1095': ['LO', '1', 'ImplantName'],\n    '1096': ['SQ', '1', 'KeratometryMeasurementTypeCodeSequence'],\n    '1097': ['LO', '1', 'ImplantPartNumber'],\n    '1100': ['SQ', '1', 'ReferencedOphthalmicAxialMeasurementsSequence'],\n    '1101': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsSegmentNameCodeSequence'],\n    '1103': ['SQ', '1', 'RefractiveErrorBeforeRefractiveSurgeryCodeSequence'],\n    '1121': ['FL', '1', 'IOLPowerForExactEmmetropia'],\n    '1122': ['FL', '1', 'IOLPowerForExactTargetRefraction'],\n    '1125': ['SQ', '1', 'AnteriorChamberDepthDefinitionCodeSequence'],\n    '1127': ['SQ', '1', 'LensThicknessSequence'],\n    '1128': ['SQ', '1', 'AnteriorChamberDepthSequence'],\n    '112A': ['SQ', '1', 'CalculationCommentSequence'],\n    '112B': ['CS', '1', 'CalculationCommentType'],\n    '112C': ['LT', '1', 'CalculationComment'],\n    '1130': ['FL', '1', 'LensThickness'],\n    '1131': ['FL', '1', 'AnteriorChamberDepth'],\n    '1132': ['SQ', '1', 'SourceOfLensThicknessDataCodeSequence'],\n    '1133': ['SQ', '1', 'SourceOfAnteriorChamberDepthDataCodeSequence'],\n    '1134': ['SQ', '1', 'SourceOfRefractiveMeasurementsSequence'],\n    '1135': ['SQ', '1', 'SourceOfRefractiveMeasurementsCodeSequence'],\n    '1140': ['CS', '1', 'OphthalmicAxialLengthMeasurementModified'],\n    '1150': ['SQ', '1', 'OphthalmicAxialLengthDataSourceCodeSequence'],\n    '1153': ['SQ', '1', 'OphthalmicAxialLengthAcquisitionMethodCodeSequence'],\n    '1155': ['FL', '1', 'SignalToNoiseRatio'],\n    '1159': ['LO', '1', 'OphthalmicAxialLengthDataSourceDescription'],\n    '1210': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsTotalLengthSequence'],\n    '1211': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsSegmentalLengthSequence'],\n    '1212': ['SQ', '1', 'OphthalmicAxialLengthMeasurementsLengthSummationSequence'],\n    '1220': ['SQ', '1', 'UltrasoundOphthalmicAxialLengthMeasurementsSequence'],\n    '1225': ['SQ', '1', 'OpticalOphthalmicAxialLengthMeasurementsSequence'],\n    '1230': ['SQ', '1', 'UltrasoundSelectedOphthalmicAxialLengthSequence'],\n    '1250': ['SQ', '1', 'OphthalmicAxialLengthSelectionMethodCodeSequence'],\n    '1255': ['SQ', '1', 'OpticalSelectedOphthalmicAxialLengthSequence'],\n    '1257': ['SQ', '1', 'SelectedSegmentalOphthalmicAxialLengthSequence'],\n    '1260': ['SQ', '1', 'SelectedTotalOphthalmicAxialLengthSequence'],\n    '1262': ['SQ', '1', 'OphthalmicAxialLengthQualityMetricSequence'],\n    '1265': ['SQ', '1', 'OphthalmicAxialLengthQualityMetricTypeCodeSequence'],\n    '1273': ['LO', '1', 'OphthalmicAxialLengthQualityMetricTypeDescription'],\n    '1300': ['SQ', '1', 'IntraocularLensCalculationsRightEyeSequence'],\n    '1310': ['SQ', '1', 'IntraocularLensCalculationsLeftEyeSequence'],\n    '1330': ['SQ', '1', 'ReferencedOphthalmicAxialLengthMeasurementQCImageSequence'],\n    '1415': ['CS', '1', 'OphthalmicMappingDeviceType'],\n    '1420': ['SQ', '1', 'AcquisitionMethodCodeSequence'],\n    '1423': ['SQ', '1', 'AcquisitionMethodAlgorithmSequence'],\n    '1436': ['SQ', '1', 'OphthalmicThicknessMapTypeCodeSequence'],\n    '1443': ['SQ', '1', 'OphthalmicThicknessMappingNormalsSequence'],\n    '1445': ['SQ', '1', 'RetinalThicknessDefinitionCodeSequence'],\n    '1450': ['SQ', '1', 'PixelValueMappingToCodedConceptSequence'],\n    '1452': ['xs', '1', 'MappedPixelValue'],\n    '1454': ['LO', '1', 'PixelValueMappingExplanation'],\n    '1458': ['SQ', '1', 'OphthalmicThicknessMapQualityThresholdSequence'],\n    '1460': ['FL', '1', 'OphthalmicThicknessMapThresholdQualityRating'],\n    '1463': ['FL', '2', 'AnatomicStructureReferencePoint'],\n    '1465': ['SQ', '1', 'RegistrationToLocalizerSequence'],\n    '1466': ['CS', '1', 'RegisteredLocalizerUnits'],\n    '1467': ['FL', '2', 'RegisteredLocalizerTopLeftHandCorner'],\n    '1468': ['FL', '2', 'RegisteredLocalizerBottomRightHandCorner'],\n    '1470': ['SQ', '1', 'OphthalmicThicknessMapQualityRatingSequence'],\n    '1472': ['SQ', '1', 'RelevantOPTAttributesSequence'],\n    '1512': ['SQ', '1', 'TransformationMethodCodeSequence'],\n    '1513': ['SQ', '1', 'TransformationAlgorithmSequence'],\n    '1515': ['CS', '1', 'OphthalmicAxialLengthMethod'],\n    '1517': ['FL', '1', 'OphthalmicFOV'],\n    '1518': ['SQ', '1', 'TwoDimensionalToThreeDimensionalMapSequence'],\n    '1525': ['SQ', '1', 'WideFieldOphthalmicPhotographyQualityRatingSequence'],\n    '1526': ['SQ', '1', 'WideFieldOphthalmicPhotographyQualityThresholdSequence'],\n    '1527': ['FL', '1', 'WideFieldOphthalmicPhotographyThresholdQualityRating'],\n    '1528': ['FL', '1', 'XCoordinatesCenterPixelViewAngle'],\n    '1529': ['FL', '1', 'YCoordinatesCenterPixelViewAngle'],\n    '1530': ['UL', '1', 'NumberOfMapPoints'],\n    '1531': ['OF', '1', 'TwoDimensionalToThreeDimensionalMapData'],\n    '1612': ['SQ', '1', 'DerivationAlgorithmSequence'],\n    '1615': ['SQ', '1', 'OphthalmicImageTypeCodeSequence'],\n    '1616': ['LO', '1', 'OphthalmicImageTypeDescription'],\n    '1618': ['SQ', '1', 'ScanPatternTypeCodeSequence'],\n    '1620': ['SQ', '1', 'ReferencedSurfaceMeshIdentificationSequence'],\n    '1622': ['CS', '1', 'OphthalmicVolumetricPropertiesFlag'],\n    '1624': ['FL', '1', 'OphthalmicAnatomicReferencePointXCoordinate'],\n    '1626': ['FL', '1', 'OphthalmicAnatomicReferencePointYCoordinate'],\n    '1628': ['SQ', '1', 'OphthalmicEnFaceImageQualityRatingSequence'],\n    '1630': ['DS', '1', 'QualityThreshold'],\n    '1640': ['SQ', '1', 'OCTBscanAnalysisAcquisitionParametersSequence'],\n    '1642': ['UL', '1', 'NumberOfBscansPerFrame'],\n    '1643': ['FL', '1', 'BscanSlabThickness'],\n    '1644': ['FL', '1', 'DistanceBetweenBscanSlabs'],\n    '1645': ['FL', '1', 'BscanCycleTime'],\n    '1646': ['FL', '1-n', 'BscanCycleTimeVector'],\n    '1649': ['FL', '1', 'AscanRate'],\n    '1650': ['FL', '1', 'BscanRate'],\n    '1658': ['UL', '1', 'SurfaceMeshZPixelOffset']\n  },\n  '0024': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['FL', '1', 'VisualFieldHorizontalExtent'],\n    '0011': ['FL', '1', 'VisualFieldVerticalExtent'],\n    '0012': ['CS', '1', 'VisualFieldShape'],\n    '0016': ['SQ', '1', 'ScreeningTestModeCodeSequence'],\n    '0018': ['FL', '1', 'MaximumStimulusLuminance'],\n    '0020': ['FL', '1', 'BackgroundLuminance'],\n    '0021': ['SQ', '1', 'StimulusColorCodeSequence'],\n    '0024': ['SQ', '1', 'BackgroundIlluminationColorCodeSequence'],\n    '0025': ['FL', '1', 'StimulusArea'],\n    '0028': ['FL', '1', 'StimulusPresentationTime'],\n    '0032': ['SQ', '1', 'FixationSequence'],\n    '0033': ['SQ', '1', 'FixationMonitoringCodeSequence'],\n    '0034': ['SQ', '1', 'VisualFieldCatchTrialSequence'],\n    '0035': ['US', '1', 'FixationCheckedQuantity'],\n    '0036': ['US', '1', 'PatientNotProperlyFixatedQuantity'],\n    '0037': ['CS', '1', 'PresentedVisualStimuliDataFlag'],\n    '0038': ['US', '1', 'NumberOfVisualStimuli'],\n    '0039': ['CS', '1', 'ExcessiveFixationLossesDataFlag'],\n    '0040': ['CS', '1', 'ExcessiveFixationLosses'],\n    '0042': ['US', '1', 'StimuliRetestingQuantity'],\n    '0044': ['LT', '1', 'CommentsOnPatientPerformanceOfVisualField'],\n    '0045': ['CS', '1', 'FalseNegativesEstimateFlag'],\n    '0046': ['FL', '1', 'FalseNegativesEstimate'],\n    '0048': ['US', '1', 'NegativeCatchTrialsQuantity'],\n    '0050': ['US', '1', 'FalseNegativesQuantity'],\n    '0051': ['CS', '1', 'ExcessiveFalseNegativesDataFlag'],\n    '0052': ['CS', '1', 'ExcessiveFalseNegatives'],\n    '0053': ['CS', '1', 'FalsePositivesEstimateFlag'],\n    '0054': ['FL', '1', 'FalsePositivesEstimate'],\n    '0055': ['CS', '1', 'CatchTrialsDataFlag'],\n    '0056': ['US', '1', 'PositiveCatchTrialsQuantity'],\n    '0057': ['CS', '1', 'TestPointNormalsDataFlag'],\n    '0058': ['SQ', '1', 'TestPointNormalsSequence'],\n    '0059': ['CS', '1', 'GlobalDeviationProbabilityNormalsFlag'],\n    '0060': ['US', '1', 'FalsePositivesQuantity'],\n    '0061': ['CS', '1', 'ExcessiveFalsePositivesDataFlag'],\n    '0062': ['CS', '1', 'ExcessiveFalsePositives'],\n    '0063': ['CS', '1', 'VisualFieldTestNormalsFlag'],\n    '0064': ['SQ', '1', 'ResultsNormalsSequence'],\n    '0065': ['SQ', '1', 'AgeCorrectedSensitivityDeviationAlgorithmSequence'],\n    '0066': ['FL', '1', 'GlobalDeviationFromNormal'],\n    '0067': ['SQ', '1', 'GeneralizedDefectSensitivityDeviationAlgorithmSequence'],\n    '0068': ['FL', '1', 'LocalizedDeviationFromNormal'],\n    '0069': ['LO', '1', 'PatientReliabilityIndicator'],\n    '0070': ['FL', '1', 'VisualFieldMeanSensitivity'],\n    '0071': ['FL', '1', 'GlobalDeviationProbability'],\n    '0072': ['CS', '1', 'LocalDeviationProbabilityNormalsFlag'],\n    '0073': ['FL', '1', 'LocalizedDeviationProbability'],\n    '0074': ['CS', '1', 'ShortTermFluctuationCalculated'],\n    '0075': ['FL', '1', 'ShortTermFluctuation'],\n    '0076': ['CS', '1', 'ShortTermFluctuationProbabilityCalculated'],\n    '0077': ['FL', '1', 'ShortTermFluctuationProbability'],\n    '0078': ['CS', '1', 'CorrectedLocalizedDeviationFromNormalCalculated'],\n    '0079': ['FL', '1', 'CorrectedLocalizedDeviationFromNormal'],\n    '0080': ['CS', '1', 'CorrectedLocalizedDeviationFromNormalProbabilityCalculated'],\n    '0081': ['FL', '1', 'CorrectedLocalizedDeviationFromNormalProbability'],\n    '0083': ['SQ', '1', 'GlobalDeviationProbabilitySequence'],\n    '0085': ['SQ', '1', 'LocalizedDeviationProbabilitySequence'],\n    '0086': ['CS', '1', 'FovealSensitivityMeasured'],\n    '0087': ['FL', '1', 'FovealSensitivity'],\n    '0088': ['FL', '1', 'VisualFieldTestDuration'],\n    '0089': ['SQ', '1', 'VisualFieldTestPointSequence'],\n    '0090': ['FL', '1', 'VisualFieldTestPointXCoordinate'],\n    '0091': ['FL', '1', 'VisualFieldTestPointYCoordinate'],\n    '0092': ['FL', '1', 'AgeCorrectedSensitivityDeviationValue'],\n    '0093': ['CS', '1', 'StimulusResults'],\n    '0094': ['FL', '1', 'SensitivityValue'],\n    '0095': ['CS', '1', 'RetestStimulusSeen'],\n    '0096': ['FL', '1', 'RetestSensitivityValue'],\n    '0097': ['SQ', '1', 'VisualFieldTestPointNormalsSequence'],\n    '0098': ['FL', '1', 'QuantifiedDefect'],\n    '0100': ['FL', '1', 'AgeCorrectedSensitivityDeviationProbabilityValue'],\n    '0102': ['CS', '1', 'GeneralizedDefectCorrectedSensitivityDeviationFlag'],\n    '0103': ['FL', '1', 'GeneralizedDefectCorrectedSensitivityDeviationValue'],\n    '0104': ['FL', '1', 'GeneralizedDefectCorrectedSensitivityDeviationProbabilityValue'],\n    '0105': ['FL', '1', 'MinimumSensitivityValue'],\n    '0106': ['CS', '1', 'BlindSpotLocalized'],\n    '0107': ['FL', '1', 'BlindSpotXCoordinate'],\n    '0108': ['FL', '1', 'BlindSpotYCoordinate'],\n    '0110': ['SQ', '1', 'VisualAcuityMeasurementSequence'],\n    '0112': ['SQ', '1', 'RefractiveParametersUsedOnPatientSequence'],\n    '0113': ['CS', '1', 'MeasurementLaterality'],\n    '0114': ['SQ', '1', 'OphthalmicPatientClinicalInformationLeftEyeSequence'],\n    '0115': ['SQ', '1', 'OphthalmicPatientClinicalInformationRightEyeSequence'],\n    '0117': ['CS', '1', 'FovealPointNormativeDataFlag'],\n    '0118': ['FL', '1', 'FovealPointProbabilityValue'],\n    '0120': ['CS', '1', 'ScreeningBaselineMeasured'],\n    '0122': ['SQ', '1', 'ScreeningBaselineMeasuredSequence'],\n    '0124': ['CS', '1', 'ScreeningBaselineType'],\n    '0126': ['FL', '1', 'ScreeningBaselineValue'],\n    '0202': ['LO', '1', 'AlgorithmSource'],\n    '0306': ['LO', '1', 'DataSetName'],\n    '0307': ['LO', '1', 'DataSetVersion'],\n    '0308': ['LO', '1', 'DataSetSource'],\n    '0309': ['LO', '1', 'DataSetDescription'],\n    '0317': ['SQ', '1', 'VisualFieldTestReliabilityGlobalIndexSequence'],\n    '0320': ['SQ', '1', 'VisualFieldGlobalResultsIndexSequence'],\n    '0325': ['SQ', '1', 'DataObservationSequence'],\n    '0338': ['CS', '1', 'IndexNormalsFlag'],\n    '0341': ['FL', '1', 'IndexProbability'],\n    '0344': ['SQ', '1', 'IndexProbabilitySequence']\n  },\n  '0028': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0002': ['US', '1', 'SamplesPerPixel'],\n    '0003': ['US', '1', 'SamplesPerPixelUsed'],\n    '0004': ['CS', '1', 'PhotometricInterpretation'],\n    '0005': ['US', '1', 'ImageDimensions'],\n    '0006': ['US', '1', 'PlanarConfiguration'],\n    '0008': ['IS', '1', 'NumberOfFrames'],\n    '0009': ['AT', '1-n', 'FrameIncrementPointer'],\n    '000A': ['AT', '1-n', 'FrameDimensionPointer'],\n    '0010': ['US', '1', 'Rows'],\n    '0011': ['US', '1', 'Columns'],\n    '0012': ['US', '1', 'Planes'],\n    '0014': ['US', '1', 'UltrasoundColorDataPresent'],\n    '0020': ['', '', ''],\n    '0030': ['DS', '2', 'PixelSpacing'],\n    '0031': ['DS', '2', 'ZoomFactor'],\n    '0032': ['DS', '2', 'ZoomCenter'],\n    '0034': ['IS', '2', 'PixelAspectRatio'],\n    '0040': ['CS', '1', 'ImageFormat'],\n    '0050': ['LO', '1-n', 'ManipulatedImage'],\n    '0051': ['CS', '1-n', 'CorrectedImage'],\n    '005F': ['LO', '1', 'CompressionRecognitionCode'],\n    '0060': ['CS', '1', 'CompressionCode'],\n    '0061': ['SH', '1', 'CompressionOriginator'],\n    '0062': ['LO', '1', 'CompressionLabel'],\n    '0063': ['SH', '1', 'CompressionDescription'],\n    '0065': ['CS', '1-n', 'CompressionSequence'],\n    '0066': ['AT', '1-n', 'CompressionStepPointers'],\n    '0068': ['US', '1', 'RepeatInterval'],\n    '0069': ['US', '1', 'BitsGrouped'],\n    '0070': ['US', '1-n', 'PerimeterTable'],\n    '0071': ['xs', '1', 'PerimeterValue'],\n    '0080': ['US', '1', 'PredictorRows'],\n    '0081': ['US', '1', 'PredictorColumns'],\n    '0082': ['US', '1-n', 'PredictorConstants'],\n    '0090': ['CS', '1', 'BlockedPixels'],\n    '0091': ['US', '1', 'BlockRows'],\n    '0092': ['US', '1', 'BlockColumns'],\n    '0093': ['US', '1', 'RowOverlap'],\n    '0094': ['US', '1', 'ColumnOverlap'],\n    '0100': ['US', '1', 'BitsAllocated'],\n    '0101': ['US', '1', 'BitsStored'],\n    '0102': ['US', '1', 'HighBit'],\n    '0103': ['US', '1', 'PixelRepresentation'],\n    '0104': ['xs', '1', 'SmallestValidPixelValue'],\n    '0105': ['xs', '1', 'LargestValidPixelValue'],\n    '0106': ['xs', '1', 'SmallestImagePixelValue'],\n    '0107': ['xs', '1', 'LargestImagePixelValue'],\n    '0108': ['xs', '1', 'SmallestPixelValueInSeries'],\n    '0109': ['xs', '1', 'LargestPixelValueInSeries'],\n    '0110': ['xs', '1', 'SmallestImagePixelValueInPlane'],\n    '0111': ['xs', '1', 'LargestImagePixelValueInPlane'],\n    '0120': ['xs', '1', 'PixelPaddingValue'],\n    '0121': ['xs', '1', 'PixelPaddingRangeLimit'],\n    '0122': ['FL', '1', 'FloatPixelPaddingValue'],\n    '0123': ['FD', '1', 'DoubleFloatPixelPaddingValue'],\n    '0124': ['FL', '1', 'FloatPixelPaddingRangeLimit'],\n    '0125': ['FD', '1', 'DoubleFloatPixelPaddingRangeLimit'],\n    '0200': ['US', '1', 'ImageLocation'],\n    '0300': ['CS', '1', 'QualityControlImage'],\n    '0301': ['CS', '1', 'BurnedInAnnotation'],\n    '0302': ['CS', '1', 'RecognizableVisualFeatures'],\n    '0303': ['CS', '1', 'LongitudinalTemporalInformationModified'],\n    '0304': ['UI', '1', 'ReferencedColorPaletteInstanceUID'],\n    '0400': ['LO', '1', 'TransformLabel'],\n    '0401': ['LO', '1', 'TransformVersionNumber'],\n    '0402': ['US', '1', 'NumberOfTransformSteps'],\n    '0403': ['LO', '1-n', 'SequenceOfCompressedData'],\n    '0404': ['AT', '1-n', 'DetailsOfCoefficients'],\n    '04x0': ['US', '1', 'RowsForNthOrderCoefficients'],\n    '04x1': ['US', '1', 'ColumnsForNthOrderCoefficients'],\n    '04x2': ['LO', '1-n', 'CoefficientCoding'],\n    '04x3': ['AT', '1-n', 'CoefficientCodingPointers'],\n    '0700': ['LO', '1', 'DCTLabel'],\n    '0701': ['CS', '1-n', 'DataBlockDescription'],\n    '0702': ['AT', '1-n', 'DataBlock'],\n    '0710': ['US', '1', 'NormalizationFactorFormat'],\n    '0720': ['US', '1', 'ZonalMapNumberFormat'],\n    '0721': ['AT', '1-n', 'ZonalMapLocation'],\n    '0722': ['US', '1', 'ZonalMapFormat'],\n    '0730': ['US', '1', 'AdaptiveMapFormat'],\n    '0740': ['US', '1', 'CodeNumberFormat'],\n    '08x0': ['CS', '1-n', 'CodeLabel'],\n    '08x2': ['US', '1', 'NumberOfTables'],\n    '08x3': ['AT', '1-n', 'CodeTableLocation'],\n    '08x4': ['US', '1', 'BitsForCodeWord'],\n    '08x8': ['AT', '1-n', 'ImageDataLocation'],\n    '0A02': ['CS', '1', 'PixelSpacingCalibrationType'],\n    '0A04': ['LO', '1', 'PixelSpacingCalibrationDescription'],\n    '1040': ['CS', '1', 'PixelIntensityRelationship'],\n    '1041': ['SS', '1', 'PixelIntensityRelationshipSign'],\n    '1050': ['DS', '1-n', 'WindowCenter'],\n    '1051': ['DS', '1-n', 'WindowWidth'],\n    '1052': ['DS', '1', 'RescaleIntercept'],\n    '1053': ['DS', '1', 'RescaleSlope'],\n    '1054': ['LO', '1', 'RescaleType'],\n    '1055': ['LO', '1-n', 'WindowCenterWidthExplanation'],\n    '1056': ['CS', '1', 'VOILUTFunction'],\n    '1080': ['CS', '1', 'GrayScale'],\n    '1090': ['CS', '1', 'RecommendedViewingMode'],\n    '1100': ['xs', '3', 'GrayLookupTableDescriptor'],\n    '1101': ['xs', '3', 'RedPaletteColorLookupTableDescriptor'],\n    '1102': ['xs', '3', 'GreenPaletteColorLookupTableDescriptor'],\n    '1103': ['xs', '3', 'BluePaletteColorLookupTableDescriptor'],\n    '1104': ['US', '3', 'AlphaPaletteColorLookupTableDescriptor'],\n    '1111': ['xs', '4', 'LargeRedPaletteColorLookupTableDescriptor'],\n    '1112': ['xs', '4', 'LargeGreenPaletteColorLookupTableDescriptor'],\n    '1113': ['xs', '4', 'LargeBluePaletteColorLookupTableDescriptor'],\n    '1199': ['UI', '1', 'PaletteColorLookupTableUID'],\n    '1200': ['xs', '1-n or 1', 'GrayLookupTableData'],\n    '1201': ['OW', '1', 'RedPaletteColorLookupTableData'],\n    '1202': ['OW', '1', 'GreenPaletteColorLookupTableData'],\n    '1203': ['OW', '1', 'BluePaletteColorLookupTableData'],\n    '1204': ['OW', '1', 'AlphaPaletteColorLookupTableData'],\n    '1211': ['OW', '1', 'LargeRedPaletteColorLookupTableData'],\n    '1212': ['OW', '1', 'LargeGreenPaletteColorLookupTableData'],\n    '1213': ['OW', '1', 'LargeBluePaletteColorLookupTableData'],\n    '1214': ['UI', '1', 'LargePaletteColorLookupTableUID'],\n    '1221': ['OW', '1', 'SegmentedRedPaletteColorLookupTableData'],\n    '1222': ['OW', '1', 'SegmentedGreenPaletteColorLookupTableData'],\n    '1223': ['OW', '1', 'SegmentedBluePaletteColorLookupTableData'],\n    '1224': ['OW', '1', 'SegmentedAlphaPaletteColorLookupTableData'],\n    '1230': ['SQ', '1', 'StoredValueColorRangeSequence'],\n    '1231': ['FD', '1', 'MinimumStoredValueMapped'],\n    '1232': ['FD', '1', 'MaximumStoredValueMapped'],\n    '1300': ['CS', '1', 'BreastImplantPresent'],\n    '1350': ['CS', '1', 'PartialView'],\n    '1351': ['ST', '1', 'PartialViewDescription'],\n    '1352': ['SQ', '1', 'PartialViewCodeSequence'],\n    '135A': ['CS', '1', 'SpatialLocationsPreserved'],\n    '1401': ['SQ', '1', 'DataFrameAssignmentSequence'],\n    '1402': ['CS', '1', 'DataPathAssignment'],\n    '1403': ['US', '1', 'BitsMappedToColorLookupTable'],\n    '1404': ['SQ', '1', 'BlendingLUT1Sequence'],\n    '1405': ['CS', '1', 'BlendingLUT1TransferFunction'],\n    '1406': ['FD', '1', 'BlendingWeightConstant'],\n    '1407': ['US', '3', 'BlendingLookupTableDescriptor'],\n    '1408': ['OW', '1', 'BlendingLookupTableData'],\n    '140B': ['SQ', '1', 'EnhancedPaletteColorLookupTableSequence'],\n    '140C': ['SQ', '1', 'BlendingLUT2Sequence'],\n    '140D': ['CS', '1', 'BlendingLUT2TransferFunction'],\n    '140E': ['CS', '1', 'DataPathID'],\n    '140F': ['CS', '1', 'RGBLUTTransferFunction'],\n    '1410': ['CS', '1', 'AlphaLUTTransferFunction'],\n    '2000': ['OB', '1', 'ICCProfile'],\n    '2002': ['CS', '1', 'ColorSpace'],\n    '2110': ['CS', '1', 'LossyImageCompression'],\n    '2112': ['DS', '1-n', 'LossyImageCompressionRatio'],\n    '2114': ['CS', '1-n', 'LossyImageCompressionMethod'],\n    '3000': ['SQ', '1', 'ModalityLUTSequence'],\n    '3002': ['xs', '3', 'LUTDescriptor'],\n    '3003': ['LO', '1', 'LUTExplanation'],\n    '3004': ['LO', '1', 'ModalityLUTType'],\n    '3006': ['xx', '1-n or 1', 'LUTData'],\n    '3010': ['SQ', '1', 'VOILUTSequence'],\n    '3110': ['SQ', '1', 'SoftcopyVOILUTSequence'],\n    '4000': ['LT', '1', 'ImagePresentationComments'],\n    '5000': ['SQ', '1', 'BiPlaneAcquisitionSequence'],\n    '6010': ['US', '1', 'RepresentativeFrameNumber'],\n    '6020': ['US', '1-n', 'FrameNumbersOfInterest'],\n    '6022': ['LO', '1-n', 'FrameOfInterestDescription'],\n    '6023': ['CS', '1-n', 'FrameOfInterestType'],\n    '6030': ['US', '1-n', 'MaskPointers'],\n    '6040': ['US', '1-n', 'RWavePointer'],\n    '6100': ['SQ', '1', 'MaskSubtractionSequence'],\n    '6101': ['CS', '1', 'MaskOperation'],\n    '6102': ['US', '2-2n', 'ApplicableFrameRange'],\n    '6110': ['US', '1-n', 'MaskFrameNumbers'],\n    '6112': ['US', '1', 'ContrastFrameAveraging'],\n    '6114': ['FL', '2', 'MaskSubPixelShift'],\n    '6120': ['SS', '1', 'TIDOffset'],\n    '6190': ['ST', '1', 'MaskOperationExplanation'],\n    '7000': ['SQ', '1', 'EquipmentAdministratorSequence'],\n    '7001': ['US', '1', 'NumberOfDisplaySubsystems'],\n    '7002': ['US', '1', 'CurrentConfigurationID'],\n    '7003': ['US', '1', 'DisplaySubsystemID'],\n    '7004': ['SH', '1', 'DisplaySubsystemName'],\n    '7005': ['LO', '1', 'DisplaySubsystemDescription'],\n    '7006': ['CS', '1', 'SystemStatus'],\n    '7007': ['LO', '1', 'SystemStatusComment'],\n    '7008': ['SQ', '1', 'TargetLuminanceCharacteristicsSequence'],\n    '7009': ['US', '1', 'LuminanceCharacteristicsID'],\n    '700A': ['SQ', '1', 'DisplaySubsystemConfigurationSequence'],\n    '700B': ['US', '1', 'ConfigurationID'],\n    '700C': ['SH', '1', 'ConfigurationName'],\n    '700D': ['LO', '1', 'ConfigurationDescription'],\n    '700E': ['US', '1', 'ReferencedTargetLuminanceCharacteristicsID'],\n    '700F': ['SQ', '1', 'QAResultsSequence'],\n    '7010': ['SQ', '1', 'DisplaySubsystemQAResultsSequence'],\n    '7011': ['SQ', '1', 'ConfigurationQAResultsSequence'],\n    '7012': ['SQ', '1', 'MeasurementEquipmentSequence'],\n    '7013': ['CS', '1-n', 'MeasurementFunctions'],\n    '7014': ['CS', '1', 'MeasurementEquipmentType'],\n    '7015': ['SQ', '1', 'VisualEvaluationResultSequence'],\n    '7016': ['SQ', '1', 'DisplayCalibrationResultSequence'],\n    '7017': ['US', '1', 'DDLValue'],\n    '7018': ['FL', '2', 'CIExyWhitePoint'],\n    '7019': ['CS', '1', 'DisplayFunctionType'],\n    '701A': ['FL', '1', 'GammaValue'],\n    '701B': ['US', '1', 'NumberOfLuminancePoints'],\n    '701C': ['SQ', '1', 'LuminanceResponseSequence'],\n    '701D': ['FL', '1', 'TargetMinimumLuminance'],\n    '701E': ['FL', '1', 'TargetMaximumLuminance'],\n    '701F': ['FL', '1', 'LuminanceValue'],\n    '7020': ['LO', '1', 'LuminanceResponseDescription'],\n    '7021': ['CS', '1', 'WhitePointFlag'],\n    '7022': ['SQ', '1', 'DisplayDeviceTypeCodeSequence'],\n    '7023': ['SQ', '1', 'DisplaySubsystemSequence'],\n    '7024': ['SQ', '1', 'LuminanceResultSequence'],\n    '7025': ['CS', '1', 'AmbientLightValueSource'],\n    '7026': ['CS', '1-n', 'MeasuredCharacteristics'],\n    '7027': ['SQ', '1', 'LuminanceUniformityResultSequence'],\n    '7028': ['SQ', '1', 'VisualEvaluationTestSequence'],\n    '7029': ['CS', '1', 'TestResult'],\n    '702A': ['LO', '1', 'TestResultComment'],\n    '702B': ['CS', '1', 'TestImageValidation'],\n    '702C': ['SQ', '1', 'TestPatternCodeSequence'],\n    '702D': ['SQ', '1', 'MeasurementPatternCodeSequence'],\n    '702E': ['SQ', '1', 'VisualEvaluationMethodCodeSequence'],\n    '7FE0': ['UR', '1', 'PixelDataProviderURL'],\n    '9001': ['UL', '1', 'DataPointRows'],\n    '9002': ['UL', '1', 'DataPointColumns'],\n    '9003': ['CS', '1', 'SignalDomainColumns'],\n    '9099': ['US', '1', 'LargestMonochromePixelValue'],\n    '9108': ['CS', '1', 'DataRepresentation'],\n    '9110': ['SQ', '1', 'PixelMeasuresSequence'],\n    '9132': ['SQ', '1', 'FrameVOILUTSequence'],\n    '9145': ['SQ', '1', 'PixelValueTransformationSequence'],\n    '9235': ['CS', '1', 'SignalDomainRows'],\n    '9411': ['FL', '1', 'DisplayFilterPercentage'],\n    '9415': ['SQ', '1', 'FramePixelShiftSequence'],\n    '9416': ['US', '1', 'SubtractionItemID'],\n    '9422': ['SQ', '1', 'PixelIntensityRelationshipLUTSequence'],\n    '9443': ['SQ', '1', 'FramePixelDataPropertiesSequence'],\n    '9444': ['CS', '1', 'GeometricalProperties'],\n    '9445': ['FL', '1', 'GeometricMaximumDistortion'],\n    '9446': ['CS', '1-n', 'ImageProcessingApplied'],\n    '9454': ['CS', '1', 'MaskSelectionMode'],\n    '9474': ['CS', '1', 'LUTFunction'],\n    '9478': ['FL', '1', 'MaskVisibilityPercentage'],\n    '9501': ['SQ', '1', 'PixelShiftSequence'],\n    '9502': ['SQ', '1', 'RegionPixelShiftSequence'],\n    '9503': ['SS', '2-2n', 'VerticesOfTheRegion'],\n    '9505': ['SQ', '1', 'MultiFramePresentationSequence'],\n    '9506': ['US', '2-2n', 'PixelShiftFrameRange'],\n    '9507': ['US', '2-2n', 'LUTFrameRange'],\n    '9520': ['DS', '16', 'ImageToEquipmentMappingMatrix'],\n    '9537': ['CS', '1', 'EquipmentCoordinateSystemIdentification']\n  },\n  '0032': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '000A': ['CS', '1', 'StudyStatusID'],\n    '000C': ['CS', '1', 'StudyPriorityID'],\n    '0012': ['LO', '1', 'StudyIDIssuer'],\n    '0032': ['DA', '1', 'StudyVerifiedDate'],\n    '0033': ['TM', '1', 'StudyVerifiedTime'],\n    '0034': ['DA', '1', 'StudyReadDate'],\n    '0035': ['TM', '1', 'StudyReadTime'],\n    '1000': ['DA', '1', 'ScheduledStudyStartDate'],\n    '1001': ['TM', '1', 'ScheduledStudyStartTime'],\n    '1010': ['DA', '1', 'ScheduledStudyStopDate'],\n    '1011': ['TM', '1', 'ScheduledStudyStopTime'],\n    '1020': ['LO', '1', 'ScheduledStudyLocation'],\n    '1021': ['AE', '1-n', 'ScheduledStudyLocationAETitle'],\n    '1030': ['LO', '1', 'ReasonForStudy'],\n    '1031': ['SQ', '1', 'RequestingPhysicianIdentificationSequence'],\n    '1032': ['PN', '1', 'RequestingPhysician'],\n    '1033': ['LO', '1', 'RequestingService'],\n    '1034': ['SQ', '1', 'RequestingServiceCodeSequence'],\n    '1040': ['DA', '1', 'StudyArrivalDate'],\n    '1041': ['TM', '1', 'StudyArrivalTime'],\n    '1050': ['DA', '1', 'StudyCompletionDate'],\n    '1051': ['TM', '1', 'StudyCompletionTime'],\n    '1055': ['CS', '1', 'StudyComponentStatusID'],\n    '1060': ['LO', '1', 'RequestedProcedureDescription'],\n    '1064': ['SQ', '1', 'RequestedProcedureCodeSequence'],\n    '1065': ['SQ', '1', 'RequestedLateralityCodeSequence'],\n    '1066': ['UT', '1', 'ReasonForVisit'],\n    '1067': ['SQ', '1', 'ReasonForVisitCodeSequence'],\n    '1070': ['LO', '1', 'RequestedContrastAgent'],\n    '4000': ['LT', '1', 'StudyComments']\n  },\n  '0034': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['SQ', '1', 'FlowIdentifierSequence'],\n    '0002': ['OB', '1', 'FlowIdentifier'],\n    '0003': ['UI', '1', 'FlowTransferSyntaxUID'],\n    '0004': ['UL', '1', 'FlowRTPSamplingRate'],\n    '0005': ['OB', '1', 'SourceIdentifier'],\n    '0007': ['OB', '1', 'FrameOriginTimestamp'],\n    '0008': ['CS', '1', 'IncludesImagingSubject'],\n    '0009': ['SQ', '1', 'FrameUsefulnessGroupSequence'],\n    '000A': ['SQ', '1', 'RealTimeBulkDataFlowSequence'],\n    '000B': ['SQ', '1', 'CameraPositionGroupSequence'],\n    '000C': ['CS', '1', 'IncludesInformation'],\n    '000D': ['SQ', '1', 'TimeOfFrameGroupSequence']\n  },\n  '0038': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0004': ['SQ', '1', 'ReferencedPatientAliasSequence'],\n    '0008': ['CS', '1', 'VisitStatusID'],\n    '0010': ['LO', '1', 'AdmissionID'],\n    '0011': ['LO', '1', 'IssuerOfAdmissionID'],\n    '0014': ['SQ', '1', 'IssuerOfAdmissionIDSequence'],\n    '0016': ['LO', '1', 'RouteOfAdmissions'],\n    '001A': ['DA', '1', 'ScheduledAdmissionDate'],\n    '001B': ['TM', '1', 'ScheduledAdmissionTime'],\n    '001C': ['DA', '1', 'ScheduledDischargeDate'],\n    '001D': ['TM', '1', 'ScheduledDischargeTime'],\n    '001E': ['LO', '1', 'ScheduledPatientInstitutionResidence'],\n    '0020': ['DA', '1', 'AdmittingDate'],\n    '0021': ['TM', '1', 'AdmittingTime'],\n    '0030': ['DA', '1', 'DischargeDate'],\n    '0032': ['TM', '1', 'DischargeTime'],\n    '0040': ['LO', '1', 'DischargeDiagnosisDescription'],\n    '0044': ['SQ', '1', 'DischargeDiagnosisCodeSequence'],\n    '0050': ['LO', '1', 'SpecialNeeds'],\n    '0060': ['LO', '1', 'ServiceEpisodeID'],\n    '0061': ['LO', '1', 'IssuerOfServiceEpisodeID'],\n    '0062': ['LO', '1', 'ServiceEpisodeDescription'],\n    '0064': ['SQ', '1', 'IssuerOfServiceEpisodeIDSequence'],\n    '0100': ['SQ', '1', 'PertinentDocumentsSequence'],\n    '0101': ['SQ', '1', 'PertinentResourcesSequence'],\n    '0102': ['LO', '1', 'ResourceDescription'],\n    '0300': ['LO', '1', 'CurrentPatientLocation'],\n    '0400': ['LO', '1', 'PatientInstitutionResidence'],\n    '0500': ['LO', '1', 'PatientState'],\n    '0502': ['SQ', '1', 'PatientClinicalTrialParticipationSequence'],\n    '4000': ['LT', '1', 'VisitComments']\n  },\n  '003A': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0004': ['CS', '1', 'WaveformOriginality'],\n    '0005': ['US', '1', 'NumberOfWaveformChannels'],\n    '0010': ['UL', '1', 'NumberOfWaveformSamples'],\n    '001A': ['DS', '1', 'SamplingFrequency'],\n    '0020': ['SH', '1', 'MultiplexGroupLabel'],\n    '0200': ['SQ', '1', 'ChannelDefinitionSequence'],\n    '0202': ['IS', '1', 'WaveformChannelNumber'],\n    '0203': ['SH', '1', 'ChannelLabel'],\n    '0205': ['CS', '1-n', 'ChannelStatus'],\n    '0208': ['SQ', '1', 'ChannelSourceSequence'],\n    '0209': ['SQ', '1', 'ChannelSourceModifiersSequence'],\n    '020A': ['SQ', '1', 'SourceWaveformSequence'],\n    '020C': ['LO', '1', 'ChannelDerivationDescription'],\n    '0210': ['DS', '1', 'ChannelSensitivity'],\n    '0211': ['SQ', '1', 'ChannelSensitivityUnitsSequence'],\n    '0212': ['DS', '1', 'ChannelSensitivityCorrectionFactor'],\n    '0213': ['DS', '1', 'ChannelBaseline'],\n    '0214': ['DS', '1', 'ChannelTimeSkew'],\n    '0215': ['DS', '1', 'ChannelSampleSkew'],\n    '0218': ['DS', '1', 'ChannelOffset'],\n    '021A': ['US', '1', 'WaveformBitsStored'],\n    '0220': ['DS', '1', 'FilterLowFrequency'],\n    '0221': ['DS', '1', 'FilterHighFrequency'],\n    '0222': ['DS', '1', 'NotchFilterFrequency'],\n    '0223': ['DS', '1', 'NotchFilterBandwidth'],\n    '0230': ['FL', '1', 'WaveformDataDisplayScale'],\n    '0231': ['US', '3', 'WaveformDisplayBackgroundCIELabValue'],\n    '0240': ['SQ', '1', 'WaveformPresentationGroupSequence'],\n    '0241': ['US', '1', 'PresentationGroupNumber'],\n    '0242': ['SQ', '1', 'ChannelDisplaySequence'],\n    '0244': ['US', '3', 'ChannelRecommendedDisplayCIELabValue'],\n    '0245': ['FL', '1', 'ChannelPosition'],\n    '0246': ['CS', '1', 'DisplayShadingFlag'],\n    '0247': ['FL', '1', 'FractionalChannelDisplayScale'],\n    '0248': ['FL', '1', 'AbsoluteChannelDisplayScale'],\n    '0300': ['SQ', '1', 'MultiplexedAudioChannelsDescriptionCodeSequence'],\n    '0301': ['IS', '1', 'ChannelIdentificationCode'],\n    '0302': ['CS', '1', 'ChannelMode'],\n    '0310': ['UI', '1', 'MultiplexGroupUID'],\n    '0311': ['DS', '1', 'PowerlineFrequency'],\n    '0312': ['SQ', '1', 'ChannelImpedanceSequence'],\n    '0313': ['DS', '1', 'ImpedanceValue'],\n    '0314': ['DT', '1', 'ImpedanceMeasurementDateTime'],\n    '0315': ['DS', '1', 'ImpedanceMeasurementFrequency'],\n    '0316': ['CS', '1', 'ImpedanceMeasurementCurrentType']\n  },\n  '0040': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['AE', '1-n', 'ScheduledStationAETitle'],\n    '0002': ['DA', '1', 'ScheduledProcedureStepStartDate'],\n    '0003': ['TM', '1', 'ScheduledProcedureStepStartTime'],\n    '0004': ['DA', '1', 'ScheduledProcedureStepEndDate'],\n    '0005': ['TM', '1', 'ScheduledProcedureStepEndTime'],\n    '0006': ['PN', '1', 'ScheduledPerformingPhysicianName'],\n    '0007': ['LO', '1', 'ScheduledProcedureStepDescription'],\n    '0008': ['SQ', '1', 'ScheduledProtocolCodeSequence'],\n    '0009': ['SH', '1', 'ScheduledProcedureStepID'],\n    '000A': ['SQ', '1', 'StageCodeSequence'],\n    '000B': ['SQ', '1', 'ScheduledPerformingPhysicianIdentificationSequence'],\n    '0010': ['SH', '1-n', 'ScheduledStationName'],\n    '0011': ['SH', '1', 'ScheduledProcedureStepLocation'],\n    '0012': ['LO', '1', 'PreMedication'],\n    '0020': ['CS', '1', 'ScheduledProcedureStepStatus'],\n    '0026': ['SQ', '1', 'OrderPlacerIdentifierSequence'],\n    '0027': ['SQ', '1', 'OrderFillerIdentifierSequence'],\n    '0031': ['UT', '1', 'LocalNamespaceEntityID'],\n    '0032': ['UT', '1', 'UniversalEntityID'],\n    '0033': ['CS', '1', 'UniversalEntityIDType'],\n    '0035': ['CS', '1', 'IdentifierTypeCode'],\n    '0036': ['SQ', '1', 'AssigningFacilitySequence'],\n    '0039': ['SQ', '1', 'AssigningJurisdictionCodeSequence'],\n    '003A': ['SQ', '1', 'AssigningAgencyOrDepartmentCodeSequence'],\n    '0100': ['SQ', '1', 'ScheduledProcedureStepSequence'],\n    '0220': ['SQ', '1', 'ReferencedNonImageCompositeSOPInstanceSequence'],\n    '0241': ['AE', '1', 'PerformedStationAETitle'],\n    '0242': ['SH', '1', 'PerformedStationName'],\n    '0243': ['SH', '1', 'PerformedLocation'],\n    '0244': ['DA', '1', 'PerformedProcedureStepStartDate'],\n    '0245': ['TM', '1', 'PerformedProcedureStepStartTime'],\n    '0250': ['DA', '1', 'PerformedProcedureStepEndDate'],\n    '0251': ['TM', '1', 'PerformedProcedureStepEndTime'],\n    '0252': ['CS', '1', 'PerformedProcedureStepStatus'],\n    '0253': ['SH', '1', 'PerformedProcedureStepID'],\n    '0254': ['LO', '1', 'PerformedProcedureStepDescription'],\n    '0255': ['LO', '1', 'PerformedProcedureTypeDescription'],\n    '0260': ['SQ', '1', 'PerformedProtocolCodeSequence'],\n    '0261': ['CS', '1', 'PerformedProtocolType'],\n    '0270': ['SQ', '1', 'ScheduledStepAttributesSequence'],\n    '0275': ['SQ', '1', 'RequestAttributesSequence'],\n    '0280': ['ST', '1', 'CommentsOnThePerformedProcedureStep'],\n    '0281': ['SQ', '1', 'PerformedProcedureStepDiscontinuationReasonCodeSequence'],\n    '0293': ['SQ', '1', 'QuantitySequence'],\n    '0294': ['DS', '1', 'Quantity'],\n    '0295': ['SQ', '1', 'MeasuringUnitsSequence'],\n    '0296': ['SQ', '1', 'BillingItemSequence'],\n    '0300': ['US', '1', 'TotalTimeOfFluoroscopy'],\n    '0301': ['US', '1', 'TotalNumberOfExposures'],\n    '0302': ['US', '1', 'EntranceDose'],\n    '0303': ['US', '1-2', 'ExposedArea'],\n    '0306': ['DS', '1', 'DistanceSourceToEntrance'],\n    '0307': ['DS', '1', 'DistanceSourceToSupport'],\n    '030E': ['SQ', '1', 'ExposureDoseSequence'],\n    '0310': ['ST', '1', 'CommentsOnRadiationDose'],\n    '0312': ['DS', '1', 'XRayOutput'],\n    '0314': ['DS', '1', 'HalfValueLayer'],\n    '0316': ['DS', '1', 'OrganDose'],\n    '0318': ['CS', '1', 'OrganExposed'],\n    '0320': ['SQ', '1', 'BillingProcedureStepSequence'],\n    '0321': ['SQ', '1', 'FilmConsumptionSequence'],\n    '0324': ['SQ', '1', 'BillingSuppliesAndDevicesSequence'],\n    '0330': ['SQ', '1', 'ReferencedProcedureStepSequence'],\n    '0340': ['SQ', '1', 'PerformedSeriesSequence'],\n    '0400': ['LT', '1', 'CommentsOnTheScheduledProcedureStep'],\n    '0440': ['SQ', '1', 'ProtocolContextSequence'],\n    '0441': ['SQ', '1', 'ContentItemModifierSequence'],\n    '0500': ['SQ', '1', 'ScheduledSpecimenSequence'],\n    '050A': ['LO', '1', 'SpecimenAccessionNumber'],\n    '0512': ['LO', '1', 'ContainerIdentifier'],\n    '0513': ['SQ', '1', 'IssuerOfTheContainerIdentifierSequence'],\n    '0515': ['SQ', '1', 'AlternateContainerIdentifierSequence'],\n    '0518': ['SQ', '1', 'ContainerTypeCodeSequence'],\n    '051A': ['LO', '1', 'ContainerDescription'],\n    '0520': ['SQ', '1', 'ContainerComponentSequence'],\n    '0550': ['SQ', '1', 'SpecimenSequence'],\n    '0551': ['LO', '1', 'SpecimenIdentifier'],\n    '0552': ['SQ', '1', 'SpecimenDescriptionSequenceTrial'],\n    '0553': ['ST', '1', 'SpecimenDescriptionTrial'],\n    '0554': ['UI', '1', 'SpecimenUID'],\n    '0555': ['SQ', '1', 'AcquisitionContextSequence'],\n    '0556': ['ST', '1', 'AcquisitionContextDescription'],\n    '0560': ['SQ', '1', 'SpecimenDescriptionSequence'],\n    '0562': ['SQ', '1', 'IssuerOfTheSpecimenIdentifierSequence'],\n    '059A': ['SQ', '1', 'SpecimenTypeCodeSequence'],\n    '0600': ['LO', '1', 'SpecimenShortDescription'],\n    '0602': ['UT', '1', 'SpecimenDetailedDescription'],\n    '0610': ['SQ', '1', 'SpecimenPreparationSequence'],\n    '0612': ['SQ', '1', 'SpecimenPreparationStepContentItemSequence'],\n    '0620': ['SQ', '1', 'SpecimenLocalizationContentItemSequence'],\n    '06FA': ['LO', '1', 'SlideIdentifier'],\n    '0710': ['SQ', '1', 'WholeSlideMicroscopyImageFrameTypeSequence'],\n    '071A': ['SQ', '1', 'ImageCenterPointCoordinatesSequence'],\n    '072A': ['DS', '1', 'XOffsetInSlideCoordinateSystem'],\n    '073A': ['DS', '1', 'YOffsetInSlideCoordinateSystem'],\n    '074A': ['DS', '1', 'ZOffsetInSlideCoordinateSystem'],\n    '08D8': ['SQ', '1', 'PixelSpacingSequence'],\n    '08DA': ['SQ', '1', 'CoordinateSystemAxisCodeSequence'],\n    '08EA': ['SQ', '1', 'MeasurementUnitsCodeSequence'],\n    '09F8': ['SQ', '1', 'VitalStainCodeSequenceTrial'],\n    '1001': ['SH', '1', 'RequestedProcedureID'],\n    '1002': ['LO', '1', 'ReasonForTheRequestedProcedure'],\n    '1003': ['SH', '1', 'RequestedProcedurePriority'],\n    '1004': ['LO', '1', 'PatientTransportArrangements'],\n    '1005': ['LO', '1', 'RequestedProcedureLocation'],\n    '1006': ['SH', '1', 'PlacerOrderNumberProcedure'],\n    '1007': ['SH', '1', 'FillerOrderNumberProcedure'],\n    '1008': ['LO', '1', 'ConfidentialityCode'],\n    '1009': ['SH', '1', 'ReportingPriority'],\n    '100A': ['SQ', '1', 'ReasonForRequestedProcedureCodeSequence'],\n    '1010': ['PN', '1-n', 'NamesOfIntendedRecipientsOfResults'],\n    '1011': ['SQ', '1', 'IntendedRecipientsOfResultsIdentificationSequence'],\n    '1012': ['SQ', '1', 'ReasonForPerformedProcedureCodeSequence'],\n    '1060': ['LO', '1', 'RequestedProcedureDescriptionTrial'],\n    '1101': ['SQ', '1', 'PersonIdentificationCodeSequence'],\n    '1102': ['ST', '1', 'PersonAddress'],\n    '1103': ['LO', '1-n', 'PersonTelephoneNumbers'],\n    '1104': ['LT', '1', 'PersonTelecomInformation'],\n    '1400': ['LT', '1', 'RequestedProcedureComments'],\n    '2001': ['LO', '1', 'ReasonForTheImagingServiceRequest'],\n    '2004': ['DA', '1', 'IssueDateOfImagingServiceRequest'],\n    '2005': ['TM', '1', 'IssueTimeOfImagingServiceRequest'],\n    '2006': ['SH', '1', 'PlacerOrderNumberImagingServiceRequestRetired'],\n    '2007': ['SH', '1', 'FillerOrderNumberImagingServiceRequestRetired'],\n    '2008': ['PN', '1', 'OrderEnteredBy'],\n    '2009': ['SH', '1', 'OrderEntererLocation'],\n    '2010': ['SH', '1', 'OrderCallbackPhoneNumber'],\n    '2011': ['LT', '1', 'OrderCallbackTelecomInformation'],\n    '2016': ['LO', '1', 'PlacerOrderNumberImagingServiceRequest'],\n    '2017': ['LO', '1', 'FillerOrderNumberImagingServiceRequest'],\n    '2400': ['LT', '1', 'ImagingServiceRequestComments'],\n    '3001': ['LO', '1', 'ConfidentialityConstraintOnPatientDataDescription'],\n    '4001': ['CS', '1', 'GeneralPurposeScheduledProcedureStepStatus'],\n    '4002': ['CS', '1', 'GeneralPurposePerformedProcedureStepStatus'],\n    '4003': ['CS', '1', 'GeneralPurposeScheduledProcedureStepPriority'],\n    '4004': ['SQ', '1', 'ScheduledProcessingApplicationsCodeSequence'],\n    '4005': ['DT', '1', 'ScheduledProcedureStepStartDateTime'],\n    '4006': ['CS', '1', 'MultipleCopiesFlag'],\n    '4007': ['SQ', '1', 'PerformedProcessingApplicationsCodeSequence'],\n    '4008': ['DT', '1', 'ScheduledProcedureStepExpirationDateTime'],\n    '4009': ['SQ', '1', 'HumanPerformerCodeSequence'],\n    '4010': ['DT', '1', 'ScheduledProcedureStepModificationDateTime'],\n    '4011': ['DT', '1', 'ExpectedCompletionDateTime'],\n    '4015': ['SQ', '1', 'ResultingGeneralPurposePerformedProcedureStepsSequence'],\n    '4016': ['SQ', '1', 'ReferencedGeneralPurposeScheduledProcedureStepSequence'],\n    '4018': ['SQ', '1', 'ScheduledWorkitemCodeSequence'],\n    '4019': ['SQ', '1', 'PerformedWorkitemCodeSequence'],\n    '4020': ['CS', '1', 'InputAvailabilityFlag'],\n    '4021': ['SQ', '1', 'InputInformationSequence'],\n    '4022': ['SQ', '1', 'RelevantInformationSequence'],\n    '4023': ['UI', '1', 'ReferencedGeneralPurposeScheduledProcedureStepTransactionUID'],\n    '4025': ['SQ', '1', 'ScheduledStationNameCodeSequence'],\n    '4026': ['SQ', '1', 'ScheduledStationClassCodeSequence'],\n    '4027': ['SQ', '1', 'ScheduledStationGeographicLocationCodeSequence'],\n    '4028': ['SQ', '1', 'PerformedStationNameCodeSequence'],\n    '4029': ['SQ', '1', 'PerformedStationClassCodeSequence'],\n    '4030': ['SQ', '1', 'PerformedStationGeographicLocationCodeSequence'],\n    '4031': ['SQ', '1', 'RequestedSubsequentWorkitemCodeSequence'],\n    '4032': ['SQ', '1', 'NonDICOMOutputCodeSequence'],\n    '4033': ['SQ', '1', 'OutputInformationSequence'],\n    '4034': ['SQ', '1', 'ScheduledHumanPerformersSequence'],\n    '4035': ['SQ', '1', 'ActualHumanPerformersSequence'],\n    '4036': ['LO', '1', 'HumanPerformerOrganization'],\n    '4037': ['PN', '1', 'HumanPerformerName'],\n    '4040': ['CS', '1', 'RawDataHandling'],\n    '4041': ['CS', '1', 'InputReadinessState'],\n    '4050': ['DT', '1', 'PerformedProcedureStepStartDateTime'],\n    '4051': ['DT', '1', 'PerformedProcedureStepEndDateTime'],\n    '4052': ['DT', '1', 'ProcedureStepCancellationDateTime'],\n    '4070': ['SQ', '1', 'OutputDestinationSequence'],\n    '4071': ['SQ', '1', 'DICOMStorageSequence'],\n    '4072': ['SQ', '1', 'STOWRSStorageSequence'],\n    '4073': ['UR', '1', 'StorageURL'],\n    '4074': ['SQ', '1', 'XDSStorageSequence'],\n    '8302': ['DS', '1', 'EntranceDoseInmGy'],\n    '8303': ['CS', '1', 'EntranceDoseDerivation'],\n    '9092': ['SQ', '1', 'ParametricMapFrameTypeSequence'],\n    '9094': ['SQ', '1', 'ReferencedImageRealWorldValueMappingSequence'],\n    '9096': ['SQ', '1', 'RealWorldValueMappingSequence'],\n    '9098': ['SQ', '1', 'PixelValueMappingCodeSequence'],\n    '9210': ['SH', '1', 'LUTLabel'],\n    '9211': ['xs', '1', 'RealWorldValueLastValueMapped'],\n    '9212': ['FD', '1-n', 'RealWorldValueLUTData'],\n    '9213': ['FD', '1', 'DoubleFloatRealWorldValueLastValueMapped'],\n    '9214': ['FD', '1', 'DoubleFloatRealWorldValueFirstValueMapped'],\n    '9216': ['xs', '1', 'RealWorldValueFirstValueMapped'],\n    '9220': ['SQ', '1', 'QuantityDefinitionSequence'],\n    '9224': ['FD', '1', 'RealWorldValueIntercept'],\n    '9225': ['FD', '1', 'RealWorldValueSlope'],\n    'A007': ['CS', '1', 'FindingsFlagTrial'],\n    'A010': ['CS', '1', 'RelationshipType'],\n    'A020': ['SQ', '1', 'FindingsSequenceTrial'],\n    'A021': ['UI', '1', 'FindingsGroupUIDTrial'],\n    'A022': ['UI', '1', 'ReferencedFindingsGroupUIDTrial'],\n    'A023': ['DA', '1', 'FindingsGroupRecordingDateTrial'],\n    'A024': ['TM', '1', 'FindingsGroupRecordingTimeTrial'],\n    'A026': ['SQ', '1', 'FindingsSourceCategoryCodeSequenceTrial'],\n    'A027': ['LO', '1', 'VerifyingOrganization'],\n    'A028': ['SQ', '1', 'DocumentingOrganizationIdentifierCodeSequenceTrial'],\n    'A030': ['DT', '1', 'VerificationDateTime'],\n    'A032': ['DT', '1', 'ObservationDateTime'],\n    'A033': ['DT', '1', 'ObservationStartDateTime'],\n    'A040': ['CS', '1', 'ValueType'],\n    'A043': ['SQ', '1', 'ConceptNameCodeSequence'],\n    'A047': ['LO', '1', 'MeasurementPrecisionDescriptionTrial'],\n    'A050': ['CS', '1', 'ContinuityOfContent'],\n    'A057': ['CS', '1-n', 'UrgencyOrPriorityAlertsTrial'],\n    'A060': ['LO', '1', 'SequencingIndicatorTrial'],\n    'A066': ['SQ', '1', 'DocumentIdentifierCodeSequenceTrial'],\n    'A067': ['PN', '1', 'DocumentAuthorTrial'],\n    'A068': ['SQ', '1', 'DocumentAuthorIdentifierCodeSequenceTrial'],\n    'A070': ['SQ', '1', 'IdentifierCodeSequenceTrial'],\n    'A073': ['SQ', '1', 'VerifyingObserverSequence'],\n    'A074': ['OB', '1', 'ObjectBinaryIdentifierTrial'],\n    'A075': ['PN', '1', 'VerifyingObserverName'],\n    'A076': ['SQ', '1', 'DocumentingObserverIdentifierCodeSequenceTrial'],\n    'A078': ['SQ', '1', 'AuthorObserverSequence'],\n    'A07A': ['SQ', '1', 'ParticipantSequence'],\n    'A07C': ['SQ', '1', 'CustodialOrganizationSequence'],\n    'A080': ['CS', '1', 'ParticipationType'],\n    'A082': ['DT', '1', 'ParticipationDateTime'],\n    'A084': ['CS', '1', 'ObserverType'],\n    'A085': ['SQ', '1', 'ProcedureIdentifierCodeSequenceTrial'],\n    'A088': ['SQ', '1', 'VerifyingObserverIdentificationCodeSequence'],\n    'A089': ['OB', '1', 'ObjectDirectoryBinaryIdentifierTrial'],\n    'A090': ['SQ', '1', 'EquivalentCDADocumentSequence'],\n    'A0B0': ['US', '2-2n', 'ReferencedWaveformChannels'],\n    'A110': ['DA', '1', 'DateOfDocumentOrVerbalTransactionTrial'],\n    'A112': ['TM', '1', 'TimeOfDocumentCreationOrVerbalTransactionTrial'],\n    'A120': ['DT', '1', 'DateTime'],\n    'A121': ['DA', '1', 'Date'],\n    'A122': ['TM', '1', 'Time'],\n    'A123': ['PN', '1', 'PersonName'],\n    'A124': ['UI', '1', 'UID'],\n    'A125': ['CS', '2', 'ReportStatusIDTrial'],\n    'A130': ['CS', '1', 'TemporalRangeType'],\n    'A132': ['UL', '1-n', 'ReferencedSamplePositions'],\n    'A136': ['US', '1-n', 'ReferencedFrameNumbers'],\n    'A138': ['DS', '1-n', 'ReferencedTimeOffsets'],\n    'A13A': ['DT', '1-n', 'ReferencedDateTime'],\n    'A160': ['UT', '1', 'TextValue'],\n    'A161': ['FD', '1-n', 'FloatingPointValue'],\n    'A162': ['SL', '1-n', 'RationalNumeratorValue'],\n    'A163': ['UL', '1-n', 'RationalDenominatorValue'],\n    'A167': ['SQ', '1', 'ObservationCategoryCodeSequenceTrial'],\n    'A168': ['SQ', '1', 'ConceptCodeSequence'],\n    'A16A': ['ST', '1', 'BibliographicCitationTrial'],\n    'A170': ['SQ', '1', 'PurposeOfReferenceCodeSequence'],\n    'A171': ['UI', '1', 'ObservationUID'],\n    'A172': ['UI', '1', 'ReferencedObservationUIDTrial'],\n    'A173': ['CS', '1', 'ReferencedObservationClassTrial'],\n    'A174': ['CS', '1', 'ReferencedObjectObservationClassTrial'],\n    'A180': ['US', '1', 'AnnotationGroupNumber'],\n    'A192': ['DA', '1', 'ObservationDateTrial'],\n    'A193': ['TM', '1', 'ObservationTimeTrial'],\n    'A194': ['CS', '1', 'MeasurementAutomationTrial'],\n    'A195': ['SQ', '1', 'ModifierCodeSequence'],\n    'A224': ['ST', '1', 'IdentificationDescriptionTrial'],\n    'A290': ['CS', '1', 'CoordinatesSetGeometricTypeTrial'],\n    'A296': ['SQ', '1', 'AlgorithmCodeSequenceTrial'],\n    'A297': ['ST', '1', 'AlgorithmDescriptionTrial'],\n    'A29A': ['SL', '2-2n', 'PixelCoordinatesSetTrial'],\n    'A300': ['SQ', '1', 'MeasuredValueSequence'],\n    'A301': ['SQ', '1', 'NumericValueQualifierCodeSequence'],\n    'A307': ['PN', '1', 'CurrentObserverTrial'],\n    'A30A': ['DS', '1-n', 'NumericValue'],\n    'A313': ['SQ', '1', 'ReferencedAccessionSequenceTrial'],\n    'A33A': ['ST', '1', 'ReportStatusCommentTrial'],\n    'A340': ['SQ', '1', 'ProcedureContextSequenceTrial'],\n    'A352': ['PN', '1', 'VerbalSourceTrial'],\n    'A353': ['ST', '1', 'AddressTrial'],\n    'A354': ['LO', '1', 'TelephoneNumberTrial'],\n    'A358': ['SQ', '1', 'VerbalSourceIdentifierCodeSequenceTrial'],\n    'A360': ['SQ', '1', 'PredecessorDocumentsSequence'],\n    'A370': ['SQ', '1', 'ReferencedRequestSequence'],\n    'A372': ['SQ', '1', 'PerformedProcedureCodeSequence'],\n    'A375': ['SQ', '1', 'CurrentRequestedProcedureEvidenceSequence'],\n    'A380': ['SQ', '1', 'ReportDetailSequenceTrial'],\n    'A385': ['SQ', '1', 'PertinentOtherEvidenceSequence'],\n    'A390': ['SQ', '1', 'HL7StructuredDocumentReferenceSequence'],\n    'A402': ['UI', '1', 'ObservationSubjectUIDTrial'],\n    'A403': ['CS', '1', 'ObservationSubjectClassTrial'],\n    'A404': ['SQ', '1', 'ObservationSubjectTypeCodeSequenceTrial'],\n    'A491': ['CS', '1', 'CompletionFlag'],\n    'A492': ['LO', '1', 'CompletionFlagDescription'],\n    'A493': ['CS', '1', 'VerificationFlag'],\n    'A494': ['CS', '1', 'ArchiveRequested'],\n    'A496': ['CS', '1', 'PreliminaryFlag'],\n    'A504': ['SQ', '1', 'ContentTemplateSequence'],\n    'A525': ['SQ', '1', 'IdenticalDocumentsSequence'],\n    'A600': ['CS', '1', 'ObservationSubjectContextFlagTrial'],\n    'A601': ['CS', '1', 'ObserverContextFlagTrial'],\n    'A603': ['CS', '1', 'ProcedureContextFlagTrial'],\n    'A730': ['SQ', '1', 'ContentSequence'],\n    'A731': ['SQ', '1', 'RelationshipSequenceTrial'],\n    'A732': ['SQ', '1', 'RelationshipTypeCodeSequenceTrial'],\n    'A744': ['SQ', '1', 'LanguageCodeSequenceTrial'],\n    'A801': ['SQ', '1', 'TabulatedValuesSequence'],\n    'A802': ['UL', '1', 'NumberOfTableRows'],\n    'A803': ['UL', '1', 'NumberOfTableColumns'],\n    'A804': ['UL', '1', 'TableRowNumber'],\n    'A805': ['UL', '1', 'TableColumnNumber'],\n    'A806': ['SQ', '1', 'TableRowDefinitionSequence'],\n    'A807': ['SQ', '1', 'TableColumnDefinitionSequence'],\n    'A808': ['SQ', '1', 'CellValuesSequence'],\n    'A992': ['ST', '1', 'UniformResourceLocatorTrial'],\n    'B020': ['SQ', '1', 'WaveformAnnotationSequence'],\n    'DB00': ['CS', '1', 'TemplateIdentifier'],\n    'DB06': ['DT', '1', 'TemplateVersion'],\n    'DB07': ['DT', '1', 'TemplateLocalVersion'],\n    'DB0B': ['CS', '1', 'TemplateExtensionFlag'],\n    'DB0C': ['UI', '1', 'TemplateExtensionOrganizationUID'],\n    'DB0D': ['UI', '1', 'TemplateExtensionCreatorUID'],\n    'DB73': ['UL', '1-n', 'ReferencedContentItemIdentifier'],\n    'E001': ['ST', '1', 'HL7InstanceIdentifier'],\n    'E004': ['DT', '1', 'HL7DocumentEffectiveTime'],\n    'E006': ['SQ', '1', 'HL7DocumentTypeCodeSequence'],\n    'E008': ['SQ', '1', 'DocumentClassCodeSequence'],\n    'E010': ['UR', '1', 'RetrieveURI'],\n    'E011': ['UI', '1', 'RetrieveLocationUID'],\n    'E020': ['CS', '1', 'TypeOfInstances'],\n    'E021': ['SQ', '1', 'DICOMRetrievalSequence'],\n    'E022': ['SQ', '1', 'DICOMMediaRetrievalSequence'],\n    'E023': ['SQ', '1', 'WADORetrievalSequence'],\n    'E024': ['SQ', '1', 'XDSRetrievalSequence'],\n    'E025': ['SQ', '1', 'WADORSRetrievalSequence'],\n    'E030': ['UI', '1', 'RepositoryUniqueID'],\n    'E031': ['UI', '1', 'HomeCommunityID']\n  },\n  '0042': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['ST', '1', 'DocumentTitle'],\n    '0011': ['OB', '1', 'EncapsulatedDocument'],\n    '0012': ['LO', '1', 'MIMETypeOfEncapsulatedDocument'],\n    '0013': ['SQ', '1', 'SourceInstanceSequence'],\n    '0014': ['LO', '1-n', 'ListOfMIMETypes'],\n    '0015': ['UL', '1', 'EncapsulatedDocumentLength']\n  },\n  '0044': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['ST', '1', 'ProductPackageIdentifier'],\n    '0002': ['CS', '1', 'SubstanceAdministrationApproval'],\n    '0003': ['LT', '1', 'ApprovalStatusFurtherDescription'],\n    '0004': ['DT', '1', 'ApprovalStatusDateTime'],\n    '0007': ['SQ', '1', 'ProductTypeCodeSequence'],\n    '0008': ['LO', '1-n', 'ProductName'],\n    '0009': ['LT', '1', 'ProductDescription'],\n    '000A': ['LO', '1', 'ProductLotIdentifier'],\n    '000B': ['DT', '1', 'ProductExpirationDateTime'],\n    '0010': ['DT', '1', 'SubstanceAdministrationDateTime'],\n    '0011': ['LO', '1', 'SubstanceAdministrationNotes'],\n    '0012': ['LO', '1', 'SubstanceAdministrationDeviceID'],\n    '0013': ['SQ', '1', 'ProductParameterSequence'],\n    '0019': ['SQ', '1', 'SubstanceAdministrationParameterSequence'],\n    '0100': ['SQ', '1', 'ApprovalSequence'],\n    '0101': ['SQ', '1', 'AssertionCodeSequence'],\n    '0102': ['UI', '1', 'AssertionUID'],\n    '0103': ['SQ', '1', 'AsserterIdentificationSequence'],\n    '0104': ['DT', '1', 'AssertionDateTime'],\n    '0105': ['DT', '1', 'AssertionExpirationDateTime'],\n    '0106': ['UT', '1', 'AssertionComments'],\n    '0107': ['SQ', '1', 'RelatedAssertionSequence'],\n    '0108': ['UI', '1', 'ReferencedAssertionUID'],\n    '0109': ['SQ', '1', 'ApprovalSubjectSequence'],\n    '010A': ['SQ', '1', 'OrganizationalRoleCodeSequence']\n  },\n  '0046': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0012': ['LO', '1', 'LensDescription'],\n    '0014': ['SQ', '1', 'RightLensSequence'],\n    '0015': ['SQ', '1', 'LeftLensSequence'],\n    '0016': ['SQ', '1', 'UnspecifiedLateralityLensSequence'],\n    '0018': ['SQ', '1', 'CylinderSequence'],\n    '0028': ['SQ', '1', 'PrismSequence'],\n    '0030': ['FD', '1', 'HorizontalPrismPower'],\n    '0032': ['CS', '1', 'HorizontalPrismBase'],\n    '0034': ['FD', '1', 'VerticalPrismPower'],\n    '0036': ['CS', '1', 'VerticalPrismBase'],\n    '0038': ['CS', '1', 'LensSegmentType'],\n    '0040': ['FD', '1', 'OpticalTransmittance'],\n    '0042': ['FD', '1', 'ChannelWidth'],\n    '0044': ['FD', '1', 'PupilSize'],\n    '0046': ['FD', '1', 'CornealSize'],\n    '0047': ['SQ', '1', 'CornealSizeSequence'],\n    '0050': ['SQ', '1', 'AutorefractionRightEyeSequence'],\n    '0052': ['SQ', '1', 'AutorefractionLeftEyeSequence'],\n    '0060': ['FD', '1', 'DistancePupillaryDistance'],\n    '0062': ['FD', '1', 'NearPupillaryDistance'],\n    '0063': ['FD', '1', 'IntermediatePupillaryDistance'],\n    '0064': ['FD', '1', 'OtherPupillaryDistance'],\n    '0070': ['SQ', '1', 'KeratometryRightEyeSequence'],\n    '0071': ['SQ', '1', 'KeratometryLeftEyeSequence'],\n    '0074': ['SQ', '1', 'SteepKeratometricAxisSequence'],\n    '0075': ['FD', '1', 'RadiusOfCurvature'],\n    '0076': ['FD', '1', 'KeratometricPower'],\n    '0077': ['FD', '1', 'KeratometricAxis'],\n    '0080': ['SQ', '1', 'FlatKeratometricAxisSequence'],\n    '0092': ['CS', '1', 'BackgroundColor'],\n    '0094': ['CS', '1', 'Optotype'],\n    '0095': ['CS', '1', 'OptotypePresentation'],\n    '0097': ['SQ', '1', 'SubjectiveRefractionRightEyeSequence'],\n    '0098': ['SQ', '1', 'SubjectiveRefractionLeftEyeSequence'],\n    '0100': ['SQ', '1', 'AddNearSequence'],\n    '0101': ['SQ', '1', 'AddIntermediateSequence'],\n    '0102': ['SQ', '1', 'AddOtherSequence'],\n    '0104': ['FD', '1', 'AddPower'],\n    '0106': ['FD', '1', 'ViewingDistance'],\n    '0110': ['SQ', '1', 'CorneaMeasurementsSequence'],\n    '0111': ['SQ', '1', 'SourceOfCorneaMeasurementDataCodeSequence'],\n    '0112': ['SQ', '1', 'SteepCornealAxisSequence'],\n    '0113': ['SQ', '1', 'FlatCornealAxisSequence'],\n    '0114': ['FD', '1', 'CornealPower'],\n    '0115': ['FD', '1', 'CornealAxis'],\n    '0116': ['SQ', '1', 'CorneaMeasurementMethodCodeSequence'],\n    '0117': ['FL', '1', 'RefractiveIndexOfCornea'],\n    '0118': ['FL', '1', 'RefractiveIndexOfAqueousHumor'],\n    '0121': ['SQ', '1', 'VisualAcuityTypeCodeSequence'],\n    '0122': ['SQ', '1', 'VisualAcuityRightEyeSequence'],\n    '0123': ['SQ', '1', 'VisualAcuityLeftEyeSequence'],\n    '0124': ['SQ', '1', 'VisualAcuityBothEyesOpenSequence'],\n    '0125': ['CS', '1', 'ViewingDistanceType'],\n    '0135': ['SS', '2', 'VisualAcuityModifiers'],\n    '0137': ['FD', '1', 'DecimalVisualAcuity'],\n    '0139': ['LO', '1', 'OptotypeDetailedDefinition'],\n    '0145': ['SQ', '1', 'ReferencedRefractiveMeasurementsSequence'],\n    '0146': ['FD', '1', 'SpherePower'],\n    '0147': ['FD', '1', 'CylinderPower'],\n    '0201': ['CS', '1', 'CornealTopographySurface'],\n    '0202': ['FL', '2', 'CornealVertexLocation'],\n    '0203': ['FL', '1', 'PupilCentroidXCoordinate'],\n    '0204': ['FL', '1', 'PupilCentroidYCoordinate'],\n    '0205': ['FL', '1', 'EquivalentPupilRadius'],\n    '0207': ['SQ', '1', 'CornealTopographyMapTypeCodeSequence'],\n    '0208': ['IS', '2-2n', 'VerticesOfTheOutlineOfPupil'],\n    '0210': ['SQ', '1', 'CornealTopographyMappingNormalsSequence'],\n    '0211': ['SQ', '1', 'MaximumCornealCurvatureSequence'],\n    '0212': ['FL', '1', 'MaximumCornealCurvature'],\n    '0213': ['FL', '2', 'MaximumCornealCurvatureLocation'],\n    '0215': ['SQ', '1', 'MinimumKeratometricSequence'],\n    '0218': ['SQ', '1', 'SimulatedKeratometricCylinderSequence'],\n    '0220': ['FL', '1', 'AverageCornealPower'],\n    '0224': ['FL', '1', 'CornealISValue'],\n    '0227': ['FL', '1', 'AnalyzedArea'],\n    '0230': ['FL', '1', 'SurfaceRegularityIndex'],\n    '0232': ['FL', '1', 'SurfaceAsymmetryIndex'],\n    '0234': ['FL', '1', 'CornealEccentricityIndex'],\n    '0236': ['FL', '1', 'KeratoconusPredictionIndex'],\n    '0238': ['FL', '1', 'DecimalPotentialVisualAcuity'],\n    '0242': ['CS', '1', 'CornealTopographyMapQualityEvaluation'],\n    '0244': ['SQ', '1', 'SourceImageCornealProcessedDataSequence'],\n    '0247': ['FL', '3', 'CornealPointLocation'],\n    '0248': ['CS', '1', 'CornealPointEstimated'],\n    '0249': ['FL', '1', 'AxialPower'],\n    '0250': ['FL', '1', 'TangentialPower'],\n    '0251': ['FL', '1', 'RefractivePower'],\n    '0252': ['FL', '1', 'RelativeElevation'],\n    '0253': ['FL', '1', 'CornealWavefront']\n  },\n  '0048': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['FL', '1', 'ImagedVolumeWidth'],\n    '0002': ['FL', '1', 'ImagedVolumeHeight'],\n    '0003': ['FL', '1', 'ImagedVolumeDepth'],\n    '0006': ['UL', '1', 'TotalPixelMatrixColumns'],\n    '0007': ['UL', '1', 'TotalPixelMatrixRows'],\n    '0008': ['SQ', '1', 'TotalPixelMatrixOriginSequence'],\n    '0010': ['CS', '1', 'SpecimenLabelInImage'],\n    '0011': ['CS', '1', 'FocusMethod'],\n    '0012': ['CS', '1', 'ExtendedDepthOfField'],\n    '0013': ['US', '1', 'NumberOfFocalPlanes'],\n    '0014': ['FL', '1', 'DistanceBetweenFocalPlanes'],\n    '0015': ['US', '3', 'RecommendedAbsentPixelCIELabValue'],\n    '0100': ['SQ', '1', 'IlluminatorTypeCodeSequence'],\n    '0102': ['DS', '6', 'ImageOrientationSlide'],\n    '0105': ['SQ', '1', 'OpticalPathSequence'],\n    '0106': ['SH', '1', 'OpticalPathIdentifier'],\n    '0107': ['ST', '1', 'OpticalPathDescription'],\n    '0108': ['SQ', '1', 'IlluminationColorCodeSequence'],\n    '0110': ['SQ', '1', 'SpecimenReferenceSequence'],\n    '0111': ['DS', '1', 'CondenserLensPower'],\n    '0112': ['DS', '1', 'ObjectiveLensPower'],\n    '0113': ['DS', '1', 'ObjectiveLensNumericalAperture'],\n    '0120': ['SQ', '1', 'PaletteColorLookupTableSequence'],\n    '0200': ['SQ', '1', 'ReferencedImageNavigationSequence'],\n    '0201': ['US', '2', 'TopLeftHandCornerOfLocalizerArea'],\n    '0202': ['US', '2', 'BottomRightHandCornerOfLocalizerArea'],\n    '0207': ['SQ', '1', 'OpticalPathIdentificationSequence'],\n    '021A': ['SQ', '1', 'PlanePositionSlideSequence'],\n    '021E': ['SL', '1', 'ColumnPositionInTotalImagePixelMatrix'],\n    '021F': ['SL', '1', 'RowPositionInTotalImagePixelMatrix'],\n    '0301': ['CS', '1', 'PixelOriginInterpretation'],\n    '0302': ['UL', '1', 'NumberOfOpticalPaths'],\n    '0303': ['UL', '1', 'TotalPixelMatrixFocalPlanes']\n  },\n  '0050': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0004': ['CS', '1', 'CalibrationImage'],\n    '0010': ['SQ', '1', 'DeviceSequence'],\n    '0012': ['SQ', '1', 'ContainerComponentTypeCodeSequence'],\n    '0013': ['FD', '1', 'ContainerComponentThickness'],\n    '0014': ['DS', '1', 'DeviceLength'],\n    '0015': ['FD', '1', 'ContainerComponentWidth'],\n    '0016': ['DS', '1', 'DeviceDiameter'],\n    '0017': ['CS', '1', 'DeviceDiameterUnits'],\n    '0018': ['DS', '1', 'DeviceVolume'],\n    '0019': ['DS', '1', 'InterMarkerDistance'],\n    '001A': ['CS', '1', 'ContainerComponentMaterial'],\n    '001B': ['LO', '1', 'ContainerComponentID'],\n    '001C': ['FD', '1', 'ContainerComponentLength'],\n    '001D': ['FD', '1', 'ContainerComponentDiameter'],\n    '001E': ['LO', '1', 'ContainerComponentDescription'],\n    '0020': ['LO', '1', 'DeviceDescription'],\n    '0021': ['ST', '1', 'LongDeviceDescription']\n  },\n  '0052': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['FL', '1', 'ContrastBolusIngredientPercentByVolume'],\n    '0002': ['FD', '1', 'OCTFocalDistance'],\n    '0003': ['FD', '1', 'BeamSpotSize'],\n    '0004': ['FD', '1', 'EffectiveRefractiveIndex'],\n    '0006': ['CS', '1', 'OCTAcquisitionDomain'],\n    '0007': ['FD', '1', 'OCTOpticalCenterWavelength'],\n    '0008': ['FD', '1', 'AxialResolution'],\n    '0009': ['FD', '1', 'RangingDepth'],\n    '0011': ['FD', '1', 'ALineRate'],\n    '0012': ['US', '1', 'ALinesPerFrame'],\n    '0013': ['FD', '1', 'CatheterRotationalRate'],\n    '0014': ['FD', '1', 'ALinePixelSpacing'],\n    '0016': ['SQ', '1', 'ModeOfPercutaneousAccessSequence'],\n    '0025': ['SQ', '1', 'IntravascularOCTFrameTypeSequence'],\n    '0026': ['CS', '1', 'OCTZOffsetApplied'],\n    '0027': ['SQ', '1', 'IntravascularFrameContentSequence'],\n    '0028': ['FD', '1', 'IntravascularLongitudinalDistance'],\n    '0029': ['SQ', '1', 'IntravascularOCTFrameContentSequence'],\n    '0030': ['SS', '1', 'OCTZOffsetCorrection'],\n    '0031': ['CS', '1', 'CatheterDirectionOfRotation'],\n    '0033': ['FD', '1', 'SeamLineLocation'],\n    '0034': ['FD', '1', 'FirstALineLocation'],\n    '0036': ['US', '1', 'SeamLineIndex'],\n    '0038': ['US', '1', 'NumberOfPaddedALines'],\n    '0039': ['CS', '1', 'InterpolationType'],\n    '003A': ['CS', '1', 'RefractiveIndexApplied']\n  },\n  '0054': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['US', '1-n', 'EnergyWindowVector'],\n    '0011': ['US', '1', 'NumberOfEnergyWindows'],\n    '0012': ['SQ', '1', 'EnergyWindowInformationSequence'],\n    '0013': ['SQ', '1', 'EnergyWindowRangeSequence'],\n    '0014': ['DS', '1', 'EnergyWindowLowerLimit'],\n    '0015': ['DS', '1', 'EnergyWindowUpperLimit'],\n    '0016': ['SQ', '1', 'RadiopharmaceuticalInformationSequence'],\n    '0017': ['IS', '1', 'ResidualSyringeCounts'],\n    '0018': ['SH', '1', 'EnergyWindowName'],\n    '0020': ['US', '1-n', 'DetectorVector'],\n    '0021': ['US', '1', 'NumberOfDetectors'],\n    '0022': ['SQ', '1', 'DetectorInformationSequence'],\n    '0030': ['US', '1-n', 'PhaseVector'],\n    '0031': ['US', '1', 'NumberOfPhases'],\n    '0032': ['SQ', '1', 'PhaseInformationSequence'],\n    '0033': ['US', '1', 'NumberOfFramesInPhase'],\n    '0036': ['IS', '1', 'PhaseDelay'],\n    '0038': ['IS', '1', 'PauseBetweenFrames'],\n    '0039': ['CS', '1', 'PhaseDescription'],\n    '0050': ['US', '1-n', 'RotationVector'],\n    '0051': ['US', '1', 'NumberOfRotations'],\n    '0052': ['SQ', '1', 'RotationInformationSequence'],\n    '0053': ['US', '1', 'NumberOfFramesInRotation'],\n    '0060': ['US', '1-n', 'RRIntervalVector'],\n    '0061': ['US', '1', 'NumberOfRRIntervals'],\n    '0062': ['SQ', '1', 'GatedInformationSequence'],\n    '0063': ['SQ', '1', 'DataInformationSequence'],\n    '0070': ['US', '1-n', 'TimeSlotVector'],\n    '0071': ['US', '1', 'NumberOfTimeSlots'],\n    '0072': ['SQ', '1', 'TimeSlotInformationSequence'],\n    '0073': ['DS', '1', 'TimeSlotTime'],\n    '0080': ['US', '1-n', 'SliceVector'],\n    '0081': ['US', '1', 'NumberOfSlices'],\n    '0090': ['US', '1-n', 'AngularViewVector'],\n    '0100': ['US', '1-n', 'TimeSliceVector'],\n    '0101': ['US', '1', 'NumberOfTimeSlices'],\n    '0200': ['DS', '1', 'StartAngle'],\n    '0202': ['CS', '1', 'TypeOfDetectorMotion'],\n    '0210': ['IS', '1-n', 'TriggerVector'],\n    '0211': ['US', '1', 'NumberOfTriggersInPhase'],\n    '0220': ['SQ', '1', 'ViewCodeSequence'],\n    '0222': ['SQ', '1', 'ViewModifierCodeSequence'],\n    '0300': ['SQ', '1', 'RadionuclideCodeSequence'],\n    '0302': ['SQ', '1', 'AdministrationRouteCodeSequence'],\n    '0304': ['SQ', '1', 'RadiopharmaceuticalCodeSequence'],\n    '0306': ['SQ', '1', 'CalibrationDataSequence'],\n    '0308': ['US', '1', 'EnergyWindowNumber'],\n    '0400': ['SH', '1', 'ImageID'],\n    '0410': ['SQ', '1', 'PatientOrientationCodeSequence'],\n    '0412': ['SQ', '1', 'PatientOrientationModifierCodeSequence'],\n    '0414': ['SQ', '1', 'PatientGantryRelationshipCodeSequence'],\n    '0500': ['CS', '1', 'SliceProgressionDirection'],\n    '0501': ['CS', '1', 'ScanProgressionDirection'],\n    '1000': ['CS', '2', 'SeriesType'],\n    '1001': ['CS', '1', 'Units'],\n    '1002': ['CS', '1', 'CountsSource'],\n    '1004': ['CS', '1', 'ReprojectionMethod'],\n    '1006': ['CS', '1', 'SUVType'],\n    '1100': ['CS', '1', 'RandomsCorrectionMethod'],\n    '1101': ['LO', '1', 'AttenuationCorrectionMethod'],\n    '1102': ['CS', '1', 'DecayCorrection'],\n    '1103': ['LO', '1', 'ReconstructionMethod'],\n    '1104': ['LO', '1', 'DetectorLinesOfResponseUsed'],\n    '1105': ['LO', '1', 'ScatterCorrectionMethod'],\n    '1200': ['DS', '1', 'AxialAcceptance'],\n    '1201': ['IS', '2', 'AxialMash'],\n    '1202': ['IS', '1', 'TransverseMash'],\n    '1203': ['DS', '2', 'DetectorElementSize'],\n    '1210': ['DS', '1', 'CoincidenceWindowWidth'],\n    '1220': ['CS', '1-n', 'SecondaryCountsType'],\n    '1300': ['DS', '1', 'FrameReferenceTime'],\n    '1310': ['IS', '1', 'PrimaryPromptsCountsAccumulated'],\n    '1311': ['IS', '1-n', 'SecondaryCountsAccumulated'],\n    '1320': ['DS', '1', 'SliceSensitivityFactor'],\n    '1321': ['DS', '1', 'DecayFactor'],\n    '1322': ['DS', '1', 'DoseCalibrationFactor'],\n    '1323': ['DS', '1', 'ScatterFractionFactor'],\n    '1324': ['DS', '1', 'DeadTimeFactor'],\n    '1330': ['US', '1', 'ImageIndex'],\n    '1400': ['CS', '1-n', 'CountsIncluded'],\n    '1401': ['CS', '1', 'DeadTimeCorrectionFlag']\n  },\n  '0060': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '3000': ['SQ', '1', 'HistogramSequence'],\n    '3002': ['US', '1', 'HistogramNumberOfBins'],\n    '3004': ['xs', '1', 'HistogramFirstBinValue'],\n    '3006': ['xs', '1', 'HistogramLastBinValue'],\n    '3008': ['US', '1', 'HistogramBinWidth'],\n    '3010': ['LO', '1', 'HistogramExplanation'],\n    '3020': ['UL', '1-n', 'HistogramData']\n  },\n  '0062': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['CS', '1', 'SegmentationType'],\n    '0002': ['SQ', '1', 'SegmentSequence'],\n    '0003': ['SQ', '1', 'SegmentedPropertyCategoryCodeSequence'],\n    '0004': ['US', '1', 'SegmentNumber'],\n    '0005': ['LO', '1', 'SegmentLabel'],\n    '0006': ['ST', '1', 'SegmentDescription'],\n    '0007': ['SQ', '1', 'SegmentationAlgorithmIdentificationSequence'],\n    '0008': ['CS', '1', 'SegmentAlgorithmType'],\n    '0009': ['LO', '1-n', 'SegmentAlgorithmName'],\n    '000A': ['SQ', '1', 'SegmentIdentificationSequence'],\n    '000B': ['US', '1-n', 'ReferencedSegmentNumber'],\n    '000C': ['US', '1', 'RecommendedDisplayGrayscaleValue'],\n    '000D': ['US', '3', 'RecommendedDisplayCIELabValue'],\n    '000E': ['US', '1', 'MaximumFractionalValue'],\n    '000F': ['SQ', '1', 'SegmentedPropertyTypeCodeSequence'],\n    '0010': ['CS', '1', 'SegmentationFractionalType'],\n    '0011': ['SQ', '1', 'SegmentedPropertyTypeModifierCodeSequence'],\n    '0012': ['SQ', '1', 'UsedSegmentsSequence'],\n    '0013': ['CS', '1', 'SegmentsOverlap'],\n    '0020': ['UT', '1', 'TrackingID'],\n    '0021': ['UI', '1', 'TrackingUID']\n  },\n  '0064': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0002': ['SQ', '1', 'DeformableRegistrationSequence'],\n    '0003': ['UI', '1', 'SourceFrameOfReferenceUID'],\n    '0005': ['SQ', '1', 'DeformableRegistrationGridSequence'],\n    '0007': ['UL', '3', 'GridDimensions'],\n    '0008': ['FD', '3', 'GridResolution'],\n    '0009': ['OF', '1', 'VectorGridData'],\n    '000F': ['SQ', '1', 'PreDeformationMatrixRegistrationSequence'],\n    '0010': ['SQ', '1', 'PostDeformationMatrixRegistrationSequence']\n  },\n  '0066': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['UL', '1', 'NumberOfSurfaces'],\n    '0002': ['SQ', '1', 'SurfaceSequence'],\n    '0003': ['UL', '1', 'SurfaceNumber'],\n    '0004': ['LT', '1', 'SurfaceComments'],\n    '0009': ['CS', '1', 'SurfaceProcessing'],\n    '000A': ['FL', '1', 'SurfaceProcessingRatio'],\n    '000B': ['LO', '1', 'SurfaceProcessingDescription'],\n    '000C': ['FL', '1', 'RecommendedPresentationOpacity'],\n    '000D': ['CS', '1', 'RecommendedPresentationType'],\n    '000E': ['CS', '1', 'FiniteVolume'],\n    '0010': ['CS', '1', 'Manifold'],\n    '0011': ['SQ', '1', 'SurfacePointsSequence'],\n    '0012': ['SQ', '1', 'SurfacePointsNormalsSequence'],\n    '0013': ['SQ', '1', 'SurfaceMeshPrimitivesSequence'],\n    '0015': ['UL', '1', 'NumberOfSurfacePoints'],\n    '0016': ['OF', '1', 'PointCoordinatesData'],\n    '0017': ['FL', '3', 'PointPositionAccuracy'],\n    '0018': ['FL', '1', 'MeanPointDistance'],\n    '0019': ['FL', '1', 'MaximumPointDistance'],\n    '001A': ['FL', '6', 'PointsBoundingBoxCoordinates'],\n    '001B': ['FL', '3', 'AxisOfRotation'],\n    '001C': ['FL', '3', 'CenterOfRotation'],\n    '001E': ['UL', '1', 'NumberOfVectors'],\n    '001F': ['US', '1', 'VectorDimensionality'],\n    '0020': ['FL', '1-n', 'VectorAccuracy'],\n    '0021': ['OF', '1', 'VectorCoordinateData'],\n    '0022': ['OD', '1', 'DoublePointCoordinatesData'],\n    '0023': ['OW', '1', 'TrianglePointIndexList'],\n    '0024': ['OW', '1', 'EdgePointIndexList'],\n    '0025': ['OW', '1', 'VertexPointIndexList'],\n    '0026': ['SQ', '1', 'TriangleStripSequence'],\n    '0027': ['SQ', '1', 'TriangleFanSequence'],\n    '0028': ['SQ', '1', 'LineSequence'],\n    '0029': ['OW', '1', 'PrimitivePointIndexList'],\n    '002A': ['UL', '1', 'SurfaceCount'],\n    '002B': ['SQ', '1', 'ReferencedSurfaceSequence'],\n    '002C': ['UL', '1', 'ReferencedSurfaceNumber'],\n    '002D': ['SQ', '1', 'SegmentSurfaceGenerationAlgorithmIdentificationSequence'],\n    '002E': ['SQ', '1', 'SegmentSurfaceSourceInstanceSequence'],\n    '002F': ['SQ', '1', 'AlgorithmFamilyCodeSequence'],\n    '0030': ['SQ', '1', 'AlgorithmNameCodeSequence'],\n    '0031': ['LO', '1', 'AlgorithmVersion'],\n    '0032': ['LT', '1', 'AlgorithmParameters'],\n    '0034': ['SQ', '1', 'FacetSequence'],\n    '0035': ['SQ', '1', 'SurfaceProcessingAlgorithmIdentificationSequence'],\n    '0036': ['LO', '1', 'AlgorithmName'],\n    '0037': ['FL', '1', 'RecommendedPointRadius'],\n    '0038': ['FL', '1', 'RecommendedLineThickness'],\n    '0040': ['OL', '1', 'LongPrimitivePointIndexList'],\n    '0041': ['OL', '1', 'LongTrianglePointIndexList'],\n    '0042': ['OL', '1', 'LongEdgePointIndexList'],\n    '0043': ['OL', '1', 'LongVertexPointIndexList'],\n    '0101': ['SQ', '1', 'TrackSetSequence'],\n    '0102': ['SQ', '1', 'TrackSequence'],\n    '0103': ['OW', '1', 'RecommendedDisplayCIELabValueList'],\n    '0104': ['SQ', '1', 'TrackingAlgorithmIdentificationSequence'],\n    '0105': ['UL', '1', 'TrackSetNumber'],\n    '0106': ['LO', '1', 'TrackSetLabel'],\n    '0107': ['UT', '1', 'TrackSetDescription'],\n    '0108': ['SQ', '1', 'TrackSetAnatomicalTypeCodeSequence'],\n    '0121': ['SQ', '1', 'MeasurementsSequence'],\n    '0124': ['SQ', '1', 'TrackSetStatisticsSequence'],\n    '0125': ['OF', '1', 'FloatingPointValues'],\n    '0129': ['OL', '1', 'TrackPointIndexList'],\n    '0130': ['SQ', '1', 'TrackStatisticsSequence'],\n    '0132': ['SQ', '1', 'MeasurementValuesSequence'],\n    '0133': ['SQ', '1', 'DiffusionAcquisitionCodeSequence'],\n    '0134': ['SQ', '1', 'DiffusionModelCodeSequence']\n  },\n  '0068': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '6210': ['LO', '1', 'ImplantSize'],\n    '6221': ['LO', '1', 'ImplantTemplateVersion'],\n    '6222': ['SQ', '1', 'ReplacedImplantTemplateSequence'],\n    '6223': ['CS', '1', 'ImplantType'],\n    '6224': ['SQ', '1', 'DerivationImplantTemplateSequence'],\n    '6225': ['SQ', '1', 'OriginalImplantTemplateSequence'],\n    '6226': ['DT', '1', 'EffectiveDateTime'],\n    '6230': ['SQ', '1', 'ImplantTargetAnatomySequence'],\n    '6260': ['SQ', '1', 'InformationFromManufacturerSequence'],\n    '6265': ['SQ', '1', 'NotificationFromManufacturerSequence'],\n    '6270': ['DT', '1', 'InformationIssueDateTime'],\n    '6280': ['ST', '1', 'InformationSummary'],\n    '62A0': ['SQ', '1', 'ImplantRegulatoryDisapprovalCodeSequence'],\n    '62A5': ['FD', '1', 'OverallTemplateSpatialTolerance'],\n    '62C0': ['SQ', '1', 'HPGLDocumentSequence'],\n    '62D0': ['US', '1', 'HPGLDocumentID'],\n    '62D5': ['LO', '1', 'HPGLDocumentLabel'],\n    '62E0': ['SQ', '1', 'ViewOrientationCodeSequence'],\n    '62F0': ['SQ', '1', 'ViewOrientationModifierCodeSequence'],\n    '62F2': ['FD', '1', 'HPGLDocumentScaling'],\n    '6300': ['OB', '1', 'HPGLDocument'],\n    '6310': ['US', '1', 'HPGLContourPenNumber'],\n    '6320': ['SQ', '1', 'HPGLPenSequence'],\n    '6330': ['US', '1', 'HPGLPenNumber'],\n    '6340': ['LO', '1', 'HPGLPenLabel'],\n    '6345': ['ST', '1', 'HPGLPenDescription'],\n    '6346': ['FD', '2', 'RecommendedRotationPoint'],\n    '6347': ['FD', '4', 'BoundingRectangle'],\n    '6350': ['US', '1-n', 'ImplantTemplate3DModelSurfaceNumber'],\n    '6360': ['SQ', '1', 'SurfaceModelDescriptionSequence'],\n    '6380': ['LO', '1', 'SurfaceModelLabel'],\n    '6390': ['FD', '1', 'SurfaceModelScalingFactor'],\n    '63A0': ['SQ', '1', 'MaterialsCodeSequence'],\n    '63A4': ['SQ', '1', 'CoatingMaterialsCodeSequence'],\n    '63A8': ['SQ', '1', 'ImplantTypeCodeSequence'],\n    '63AC': ['SQ', '1', 'FixationMethodCodeSequence'],\n    '63B0': ['SQ', '1', 'MatingFeatureSetsSequence'],\n    '63C0': ['US', '1', 'MatingFeatureSetID'],\n    '63D0': ['LO', '1', 'MatingFeatureSetLabel'],\n    '63E0': ['SQ', '1', 'MatingFeatureSequence'],\n    '63F0': ['US', '1', 'MatingFeatureID'],\n    '6400': ['SQ', '1', 'MatingFeatureDegreeOfFreedomSequence'],\n    '6410': ['US', '1', 'DegreeOfFreedomID'],\n    '6420': ['CS', '1', 'DegreeOfFreedomType'],\n    '6430': ['SQ', '1', 'TwoDMatingFeatureCoordinatesSequence'],\n    '6440': ['US', '1', 'ReferencedHPGLDocumentID'],\n    '6450': ['FD', '2', 'TwoDMatingPoint'],\n    '6460': ['FD', '4', 'TwoDMatingAxes'],\n    '6470': ['SQ', '1', 'TwoDDegreeOfFreedomSequence'],\n    '6490': ['FD', '3', 'ThreeDDegreeOfFreedomAxis'],\n    '64A0': ['FD', '2', 'RangeOfFreedom'],\n    '64C0': ['FD', '3', 'ThreeDMatingPoint'],\n    '64D0': ['FD', '9', 'ThreeDMatingAxes'],\n    '64F0': ['FD', '3', 'TwoDDegreeOfFreedomAxis'],\n    '6500': ['SQ', '1', 'PlanningLandmarkPointSequence'],\n    '6510': ['SQ', '1', 'PlanningLandmarkLineSequence'],\n    '6520': ['SQ', '1', 'PlanningLandmarkPlaneSequence'],\n    '6530': ['US', '1', 'PlanningLandmarkID'],\n    '6540': ['LO', '1', 'PlanningLandmarkDescription'],\n    '6545': ['SQ', '1', 'PlanningLandmarkIdentificationCodeSequence'],\n    '6550': ['SQ', '1', 'TwoDPointCoordinatesSequence'],\n    '6560': ['FD', '2', 'TwoDPointCoordinates'],\n    '6590': ['FD', '3', 'ThreeDPointCoordinates'],\n    '65A0': ['SQ', '1', 'TwoDLineCoordinatesSequence'],\n    '65B0': ['FD', '4', 'TwoDLineCoordinates'],\n    '65D0': ['FD', '6', 'ThreeDLineCoordinates'],\n    '65E0': ['SQ', '1', 'TwoDPlaneCoordinatesSequence'],\n    '65F0': ['FD', '4', 'TwoDPlaneIntersection'],\n    '6610': ['FD', '3', 'ThreeDPlaneOrigin'],\n    '6620': ['FD', '3', 'ThreeDPlaneNormal'],\n    '7001': ['CS', '1', 'ModelModification'],\n    '7002': ['CS', '1', 'ModelMirroring'],\n    '7003': ['SQ', '1', 'ModelUsageCodeSequence'],\n    '7004': ['UI', '1', 'ModelGroupUID'],\n    '7005': ['UR', '1', 'RelativeURIReferenceWithinEncapsulatedDocument']\n  },\n  '006A': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['CS', '1', 'AnnotationCoordinateType'],\n    '0002': ['SQ', '1', 'AnnotationGroupSequence'],\n    '0003': ['UI', '1', 'AnnotationGroupUID'],\n    '0005': ['LO', '1', 'AnnotationGroupLabel'],\n    '0006': ['UT', '1', 'AnnotationGroupDescription'],\n    '0007': ['CS', '1', 'AnnotationGroupGenerationType'],\n    '0008': ['SQ', '1', 'AnnotationGroupAlgorithmIdentificationSequence'],\n    '0009': ['SQ', '1', 'AnnotationPropertyCategoryCodeSequence'],\n    '000A': ['SQ', '1', 'AnnotationPropertyTypeCodeSequence'],\n    '000B': ['SQ', '1', 'AnnotationPropertyTypeModifierCodeSequence'],\n    '000C': ['UL', '1', 'NumberOfAnnotations'],\n    '000D': ['CS', '1', 'AnnotationAppliesToAllOpticalPaths'],\n    '000E': ['SH', '1-n', 'ReferencedOpticalPathIdentifier'],\n    '000F': ['CS', '1', 'AnnotationAppliesToAllZPlanes'],\n    '0010': ['FD', '1-n', 'CommonZCoordinateValue'],\n    '0011': ['OL', '1', 'AnnotationIndexList']\n  },\n  '0070': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['SQ', '1', 'GraphicAnnotationSequence'],\n    '0002': ['CS', '1', 'GraphicLayer'],\n    '0003': ['CS', '1', 'BoundingBoxAnnotationUnits'],\n    '0004': ['CS', '1', 'AnchorPointAnnotationUnits'],\n    '0005': ['CS', '1', 'GraphicAnnotationUnits'],\n    '0006': ['ST', '1', 'UnformattedTextValue'],\n    '0008': ['SQ', '1', 'TextObjectSequence'],\n    '0009': ['SQ', '1', 'GraphicObjectSequence'],\n    '0010': ['FL', '2', 'BoundingBoxTopLeftHandCorner'],\n    '0011': ['FL', '2', 'BoundingBoxBottomRightHandCorner'],\n    '0012': ['CS', '1', 'BoundingBoxTextHorizontalJustification'],\n    '0014': ['FL', '2', 'AnchorPoint'],\n    '0015': ['CS', '1', 'AnchorPointVisibility'],\n    '0020': ['US', '1', 'GraphicDimensions'],\n    '0021': ['US', '1', 'NumberOfGraphicPoints'],\n    '0022': ['FL', '2-n', 'GraphicData'],\n    '0023': ['CS', '1', 'GraphicType'],\n    '0024': ['CS', '1', 'GraphicFilled'],\n    '0040': ['IS', '1', 'ImageRotationRetired'],\n    '0041': ['CS', '1', 'ImageHorizontalFlip'],\n    '0042': ['US', '1', 'ImageRotation'],\n    '0050': ['US', '2', 'DisplayedAreaTopLeftHandCornerTrial'],\n    '0051': ['US', '2', 'DisplayedAreaBottomRightHandCornerTrial'],\n    '0052': ['SL', '2', 'DisplayedAreaTopLeftHandCorner'],\n    '0053': ['SL', '2', 'DisplayedAreaBottomRightHandCorner'],\n    '005A': ['SQ', '1', 'DisplayedAreaSelectionSequence'],\n    '0060': ['SQ', '1', 'GraphicLayerSequence'],\n    '0062': ['IS', '1', 'GraphicLayerOrder'],\n    '0066': ['US', '1', 'GraphicLayerRecommendedDisplayGrayscaleValue'],\n    '0067': ['US', '3', 'GraphicLayerRecommendedDisplayRGBValue'],\n    '0068': ['LO', '1', 'GraphicLayerDescription'],\n    '0080': ['CS', '1', 'ContentLabel'],\n    '0081': ['LO', '1', 'ContentDescription'],\n    '0082': ['DA', '1', 'PresentationCreationDate'],\n    '0083': ['TM', '1', 'PresentationCreationTime'],\n    '0084': ['PN', '1', 'ContentCreatorName'],\n    '0086': ['SQ', '1', 'ContentCreatorIdentificationCodeSequence'],\n    '0087': ['SQ', '1', 'AlternateContentDescriptionSequence'],\n    '0100': ['CS', '1', 'PresentationSizeMode'],\n    '0101': ['DS', '2', 'PresentationPixelSpacing'],\n    '0102': ['IS', '2', 'PresentationPixelAspectRatio'],\n    '0103': ['FL', '1', 'PresentationPixelMagnificationRatio'],\n    '0207': ['LO', '1', 'GraphicGroupLabel'],\n    '0208': ['ST', '1', 'GraphicGroupDescription'],\n    '0209': ['SQ', '1', 'CompoundGraphicSequence'],\n    '0226': ['UL', '1', 'CompoundGraphicInstanceID'],\n    '0227': ['LO', '1', 'FontName'],\n    '0228': ['CS', '1', 'FontNameType'],\n    '0229': ['LO', '1', 'CSSFontName'],\n    '0230': ['FD', '1', 'RotationAngle'],\n    '0231': ['SQ', '1', 'TextStyleSequence'],\n    '0232': ['SQ', '1', 'LineStyleSequence'],\n    '0233': ['SQ', '1', 'FillStyleSequence'],\n    '0234': ['SQ', '1', 'GraphicGroupSequence'],\n    '0241': ['US', '3', 'TextColorCIELabValue'],\n    '0242': ['CS', '1', 'HorizontalAlignment'],\n    '0243': ['CS', '1', 'VerticalAlignment'],\n    '0244': ['CS', '1', 'ShadowStyle'],\n    '0245': ['FL', '1', 'ShadowOffsetX'],\n    '0246': ['FL', '1', 'ShadowOffsetY'],\n    '0247': ['US', '3', 'ShadowColorCIELabValue'],\n    '0248': ['CS', '1', 'Underlined'],\n    '0249': ['CS', '1', 'Bold'],\n    '0250': ['CS', '1', 'Italic'],\n    '0251': ['US', '3', 'PatternOnColorCIELabValue'],\n    '0252': ['US', '3', 'PatternOffColorCIELabValue'],\n    '0253': ['FL', '1', 'LineThickness'],\n    '0254': ['CS', '1', 'LineDashingStyle'],\n    '0255': ['UL', '1', 'LinePattern'],\n    '0256': ['OB', '1', 'FillPattern'],\n    '0257': ['CS', '1', 'FillMode'],\n    '0258': ['FL', '1', 'ShadowOpacity'],\n    '0261': ['FL', '1', 'GapLength'],\n    '0262': ['FL', '1', 'DiameterOfVisibility'],\n    '0273': ['FL', '2', 'RotationPoint'],\n    '0274': ['CS', '1', 'TickAlignment'],\n    '0278': ['CS', '1', 'ShowTickLabel'],\n    '0279': ['CS', '1', 'TickLabelAlignment'],\n    '0282': ['CS', '1', 'CompoundGraphicUnits'],\n    '0284': ['FL', '1', 'PatternOnOpacity'],\n    '0285': ['FL', '1', 'PatternOffOpacity'],\n    '0287': ['SQ', '1', 'MajorTicksSequence'],\n    '0288': ['FL', '1', 'TickPosition'],\n    '0289': ['SH', '1', 'TickLabel'],\n    '0294': ['CS', '1', 'CompoundGraphicType'],\n    '0295': ['UL', '1', 'GraphicGroupID'],\n    '0306': ['CS', '1', 'ShapeType'],\n    '0308': ['SQ', '1', 'RegistrationSequence'],\n    '0309': ['SQ', '1', 'MatrixRegistrationSequence'],\n    '030A': ['SQ', '1', 'MatrixSequence'],\n    '030B': ['FD', '16', 'FrameOfReferenceToDisplayedCoordinateSystemTransformationMatrix'],\n    '030C': ['CS', '1', 'FrameOfReferenceTransformationMatrixType'],\n    '030D': ['SQ', '1', 'RegistrationTypeCodeSequence'],\n    '030F': ['ST', '1', 'FiducialDescription'],\n    '0310': ['SH', '1', 'FiducialIdentifier'],\n    '0311': ['SQ', '1', 'FiducialIdentifierCodeSequence'],\n    '0312': ['FD', '1', 'ContourUncertaintyRadius'],\n    '0314': ['SQ', '1', 'UsedFiducialsSequence'],\n    '0318': ['SQ', '1', 'GraphicCoordinatesDataSequence'],\n    '031A': ['UI', '1', 'FiducialUID'],\n    '031B': ['UI', '1', 'ReferencedFiducialUID'],\n    '031C': ['SQ', '1', 'FiducialSetSequence'],\n    '031E': ['SQ', '1', 'FiducialSequence'],\n    '031F': ['SQ', '1', 'FiducialsPropertyCategoryCodeSequence'],\n    '0401': ['US', '3', 'GraphicLayerRecommendedDisplayCIELabValue'],\n    '0402': ['SQ', '1', 'BlendingSequence'],\n    '0403': ['FL', '1', 'RelativeOpacity'],\n    '0404': ['SQ', '1', 'ReferencedSpatialRegistrationSequence'],\n    '0405': ['CS', '1', 'BlendingPosition'],\n    '1101': ['UI', '1', 'PresentationDisplayCollectionUID'],\n    '1102': ['UI', '1', 'PresentationSequenceCollectionUID'],\n    '1103': ['US', '1', 'PresentationSequencePositionIndex'],\n    '1104': ['SQ', '1', 'RenderedImageReferenceSequence'],\n    '1201': ['SQ', '1', 'VolumetricPresentationStateInputSequence'],\n    '1202': ['CS', '1', 'PresentationInputType'],\n    '1203': ['US', '1', 'InputSequencePositionIndex'],\n    '1204': ['CS', '1', 'Crop'],\n    '1205': ['US', '1-n', 'CroppingSpecificationIndex'],\n    '1206': ['CS', '1', 'CompositingMethod'],\n    '1207': ['US', '1', 'VolumetricPresentationInputNumber'],\n    '1208': ['CS', '1', 'ImageVolumeGeometry'],\n    '1209': ['UI', '1', 'VolumetricPresentationInputSetUID'],\n    '120A': ['SQ', '1', 'VolumetricPresentationInputSetSequence'],\n    '120B': ['CS', '1', 'GlobalCrop'],\n    '120C': ['US', '1-n', 'GlobalCroppingSpecificationIndex'],\n    '120D': ['CS', '1', 'RenderingMethod'],\n    '1301': ['SQ', '1', 'VolumeCroppingSequence'],\n    '1302': ['CS', '1', 'VolumeCroppingMethod'],\n    '1303': ['FD', '6', 'BoundingBoxCrop'],\n    '1304': ['SQ', '1', 'ObliqueCroppingPlaneSequence'],\n    '1305': ['FD', '4', 'Plane'],\n    '1306': ['FD', '3', 'PlaneNormal'],\n    '1309': ['US', '1', 'CroppingSpecificationNumber'],\n    '1501': ['CS', '1', 'MultiPlanarReconstructionStyle'],\n    '1502': ['CS', '1', 'MPRThicknessType'],\n    '1503': ['FD', '1', 'MPRSlabThickness'],\n    '1505': ['FD', '3', 'MPRTopLeftHandCorner'],\n    '1507': ['FD', '3', 'MPRViewWidthDirection'],\n    '1508': ['FD', '1', 'MPRViewWidth'],\n    '150C': ['UL', '1', 'NumberOfVolumetricCurvePoints'],\n    '150D': ['OD', '1', 'VolumetricCurvePoints'],\n    '1511': ['FD', '3', 'MPRViewHeightDirection'],\n    '1512': ['FD', '1', 'MPRViewHeight'],\n    '1602': ['CS', '1', 'RenderProjection'],\n    '1603': ['FD', '3', 'ViewpointPosition'],\n    '1604': ['FD', '3', 'ViewpointLookAtPoint'],\n    '1605': ['FD', '3', 'ViewpointUpDirection'],\n    '1606': ['FD', '6', 'RenderFieldOfView'],\n    '1607': ['FD', '1', 'SamplingStepSize'],\n    '1701': ['CS', '1', 'ShadingStyle'],\n    '1702': ['FD', '1', 'AmbientReflectionIntensity'],\n    '1703': ['FD', '3', 'LightDirection'],\n    '1704': ['FD', '1', 'DiffuseReflectionIntensity'],\n    '1705': ['FD', '1', 'SpecularReflectionIntensity'],\n    '1706': ['FD', '1', 'Shininess'],\n    '1801': ['SQ', '1', 'PresentationStateClassificationComponentSequence'],\n    '1802': ['CS', '1', 'ComponentType'],\n    '1803': ['SQ', '1', 'ComponentInputSequence'],\n    '1804': ['US', '1', 'VolumetricPresentationInputIndex'],\n    '1805': ['SQ', '1', 'PresentationStateCompositorComponentSequence'],\n    '1806': ['SQ', '1', 'WeightingTransferFunctionSequence'],\n    '1807': ['US', '3', 'WeightingLookupTableDescriptor'],\n    '1808': ['OB', '1', 'WeightingLookupTableData'],\n    '1901': ['SQ', '1', 'VolumetricAnnotationSequence'],\n    '1903': ['SQ', '1', 'ReferencedStructuredContextSequence'],\n    '1904': ['UI', '1', 'ReferencedContentItem'],\n    '1905': ['SQ', '1', 'VolumetricPresentationInputAnnotationSequence'],\n    '1907': ['CS', '1', 'AnnotationClipping'],\n    '1A01': ['CS', '1', 'PresentationAnimationStyle'],\n    '1A03': ['FD', '1', 'RecommendedAnimationRate'],\n    '1A04': ['SQ', '1', 'AnimationCurveSequence'],\n    '1A05': ['FD', '1', 'AnimationStepSize'],\n    '1A06': ['FD', '1', 'SwivelRange'],\n    '1A07': ['OD', '1', 'VolumetricCurveUpDirections'],\n    '1A08': ['SQ', '1', 'VolumeStreamSequence'],\n    '1A09': ['LO', '1', 'RGBATransferFunctionDescription'],\n    '1B01': ['SQ', '1', 'AdvancedBlendingSequence'],\n    '1B02': ['US', '1', 'BlendingInputNumber'],\n    '1B03': ['SQ', '1', 'BlendingDisplayInputSequence'],\n    '1B04': ['SQ', '1', 'BlendingDisplaySequence'],\n    '1B06': ['CS', '1', 'BlendingMode'],\n    '1B07': ['CS', '1', 'TimeSeriesBlending'],\n    '1B08': ['CS', '1', 'GeometryForDisplay'],\n    '1B11': ['SQ', '1', 'ThresholdSequence'],\n    '1B12': ['SQ', '1', 'ThresholdValueSequence'],\n    '1B13': ['CS', '1', 'ThresholdType'],\n    '1B14': ['FD', '1', 'ThresholdValue']\n  },\n  '0072': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0002': ['SH', '1', 'HangingProtocolName'],\n    '0004': ['LO', '1', 'HangingProtocolDescription'],\n    '0006': ['CS', '1', 'HangingProtocolLevel'],\n    '0008': ['LO', '1', 'HangingProtocolCreator'],\n    '000A': ['DT', '1', 'HangingProtocolCreationDateTime'],\n    '000C': ['SQ', '1', 'HangingProtocolDefinitionSequence'],\n    '000E': ['SQ', '1', 'HangingProtocolUserIdentificationCodeSequence'],\n    '0010': ['LO', '1', 'HangingProtocolUserGroupName'],\n    '0012': ['SQ', '1', 'SourceHangingProtocolSequence'],\n    '0014': ['US', '1', 'NumberOfPriorsReferenced'],\n    '0020': ['SQ', '1', 'ImageSetsSequence'],\n    '0022': ['SQ', '1', 'ImageSetSelectorSequence'],\n    '0024': ['CS', '1', 'ImageSetSelectorUsageFlag'],\n    '0026': ['AT', '1', 'SelectorAttribute'],\n    '0028': ['US', '1', 'SelectorValueNumber'],\n    '0030': ['SQ', '1', 'TimeBasedImageSetsSequence'],\n    '0032': ['US', '1', 'ImageSetNumber'],\n    '0034': ['CS', '1', 'ImageSetSelectorCategory'],\n    '0038': ['US', '2', 'RelativeTime'],\n    '003A': ['CS', '1', 'RelativeTimeUnits'],\n    '003C': ['SS', '2', 'AbstractPriorValue'],\n    '003E': ['SQ', '1', 'AbstractPriorCodeSequence'],\n    '0040': ['LO', '1', 'ImageSetLabel'],\n    '0050': ['CS', '1', 'SelectorAttributeVR'],\n    '0052': ['AT', '1-n', 'SelectorSequencePointer'],\n    '0054': ['LO', '1-n', 'SelectorSequencePointerPrivateCreator'],\n    '0056': ['LO', '1', 'SelectorAttributePrivateCreator'],\n    '005E': ['AE', '1-n', 'SelectorAEValue'],\n    '005F': ['AS', '1-n', 'SelectorASValue'],\n    '0060': ['AT', '1-n', 'SelectorATValue'],\n    '0061': ['DA', '1-n', 'SelectorDAValue'],\n    '0062': ['CS', '1-n', 'SelectorCSValue'],\n    '0063': ['DT', '1-n', 'SelectorDTValue'],\n    '0064': ['IS', '1-n', 'SelectorISValue'],\n    '0065': ['OB', '1', 'SelectorOBValue'],\n    '0066': ['LO', '1-n', 'SelectorLOValue'],\n    '0067': ['OF', '1', 'SelectorOFValue'],\n    '0068': ['LT', '1', 'SelectorLTValue'],\n    '0069': ['OW', '1', 'SelectorOWValue'],\n    '006A': ['PN', '1-n', 'SelectorPNValue'],\n    '006B': ['TM', '1-n', 'SelectorTMValue'],\n    '006C': ['SH', '1-n', 'SelectorSHValue'],\n    '006D': ['UN', '1', 'SelectorUNValue'],\n    '006E': ['ST', '1', 'SelectorSTValue'],\n    '006F': ['UC', '1-n', 'SelectorUCValue'],\n    '0070': ['UT', '1', 'SelectorUTValue'],\n    '0071': ['UR', '1', 'SelectorURValue'],\n    '0072': ['DS', '1-n', 'SelectorDSValue'],\n    '0073': ['OD', '1', 'SelectorODValue'],\n    '0074': ['FD', '1-n', 'SelectorFDValue'],\n    '0075': ['OL', '1', 'SelectorOLValue'],\n    '0076': ['FL', '1-n', 'SelectorFLValue'],\n    '0078': ['UL', '1-n', 'SelectorULValue'],\n    '007A': ['US', '1-n', 'SelectorUSValue'],\n    '007C': ['SL', '1-n', 'SelectorSLValue'],\n    '007E': ['SS', '1-n', 'SelectorSSValue'],\n    '007F': ['UI', '1-n', 'SelectorUIValue'],\n    '0080': ['SQ', '1', 'SelectorCodeSequenceValue'],\n    '0081': ['OV', '1', 'SelectorOVValue'],\n    '0082': ['SV', '1-n', 'SelectorSVValue'],\n    '0083': ['UV', '1-n', 'SelectorUVValue'],\n    '0100': ['US', '1', 'NumberOfScreens'],\n    '0102': ['SQ', '1', 'NominalScreenDefinitionSequence'],\n    '0104': ['US', '1', 'NumberOfVerticalPixels'],\n    '0106': ['US', '1', 'NumberOfHorizontalPixels'],\n    '0108': ['FD', '4', 'DisplayEnvironmentSpatialPosition'],\n    '010A': ['US', '1', 'ScreenMinimumGrayscaleBitDepth'],\n    '010C': ['US', '1', 'ScreenMinimumColorBitDepth'],\n    '010E': ['US', '1', 'ApplicationMaximumRepaintTime'],\n    '0200': ['SQ', '1', 'DisplaySetsSequence'],\n    '0202': ['US', '1', 'DisplaySetNumber'],\n    '0203': ['LO', '1', 'DisplaySetLabel'],\n    '0204': ['US', '1', 'DisplaySetPresentationGroup'],\n    '0206': ['LO', '1', 'DisplaySetPresentationGroupDescription'],\n    '0208': ['CS', '1', 'PartialDataDisplayHandling'],\n    '0210': ['SQ', '1', 'SynchronizedScrollingSequence'],\n    '0212': ['US', '2-n', 'DisplaySetScrollingGroup'],\n    '0214': ['SQ', '1', 'NavigationIndicatorSequence'],\n    '0216': ['US', '1', 'NavigationDisplaySet'],\n    '0218': ['US', '1-n', 'ReferenceDisplaySets'],\n    '0300': ['SQ', '1', 'ImageBoxesSequence'],\n    '0302': ['US', '1', 'ImageBoxNumber'],\n    '0304': ['CS', '1', 'ImageBoxLayoutType'],\n    '0306': ['US', '1', 'ImageBoxTileHorizontalDimension'],\n    '0308': ['US', '1', 'ImageBoxTileVerticalDimension'],\n    '0310': ['CS', '1', 'ImageBoxScrollDirection'],\n    '0312': ['CS', '1', 'ImageBoxSmallScrollType'],\n    '0314': ['US', '1', 'ImageBoxSmallScrollAmount'],\n    '0316': ['CS', '1', 'ImageBoxLargeScrollType'],\n    '0318': ['US', '1', 'ImageBoxLargeScrollAmount'],\n    '0320': ['US', '1', 'ImageBoxOverlapPriority'],\n    '0330': ['FD', '1', 'CineRelativeToRealTime'],\n    '0400': ['SQ', '1', 'FilterOperationsSequence'],\n    '0402': ['CS', '1', 'FilterByCategory'],\n    '0404': ['CS', '1', 'FilterByAttributePresence'],\n    '0406': ['CS', '1', 'FilterByOperator'],\n    '0420': ['US', '3', 'StructuredDisplayBackgroundCIELabValue'],\n    '0421': ['US', '3', 'EmptyImageBoxCIELabValue'],\n    '0422': ['SQ', '1', 'StructuredDisplayImageBoxSequence'],\n    '0424': ['SQ', '1', 'StructuredDisplayTextBoxSequence'],\n    '0427': ['SQ', '1', 'ReferencedFirstFrameSequence'],\n    '0430': ['SQ', '1', 'ImageBoxSynchronizationSequence'],\n    '0432': ['US', '2-n', 'SynchronizedImageBoxList'],\n    '0434': ['CS', '1', 'TypeOfSynchronization'],\n    '0500': ['CS', '1', 'BlendingOperationType'],\n    '0510': ['CS', '1', 'ReformattingOperationType'],\n    '0512': ['FD', '1', 'ReformattingThickness'],\n    '0514': ['FD', '1', 'ReformattingInterval'],\n    '0516': ['CS', '1', 'ReformattingOperationInitialViewDirection'],\n    '0520': ['CS', '1-n', 'ThreeDRenderingType'],\n    '0600': ['SQ', '1', 'SortingOperationsSequence'],\n    '0602': ['CS', '1', 'SortByCategory'],\n    '0604': ['CS', '1', 'SortingDirection'],\n    '0700': ['CS', '2', 'DisplaySetPatientOrientation'],\n    '0702': ['CS', '1', 'VOIType'],\n    '0704': ['CS', '1', 'PseudoColorType'],\n    '0705': ['SQ', '1', 'PseudoColorPaletteInstanceReferenceSequence'],\n    '0706': ['CS', '1', 'ShowGrayscaleInverted'],\n    '0710': ['CS', '1', 'ShowImageTrueSizeFlag'],\n    '0712': ['CS', '1', 'ShowGraphicAnnotationFlag'],\n    '0714': ['CS', '1', 'ShowPatientDemographicsFlag'],\n    '0716': ['CS', '1', 'ShowAcquisitionTechniquesFlag'],\n    '0717': ['CS', '1', 'DisplaySetHorizontalJustification'],\n    '0718': ['CS', '1', 'DisplaySetVerticalJustification']\n  },\n  '0074': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0120': ['FD', '1', 'ContinuationStartMeterset'],\n    '0121': ['FD', '1', 'ContinuationEndMeterset'],\n    '1000': ['CS', '1', 'ProcedureStepState'],\n    '1002': ['SQ', '1', 'ProcedureStepProgressInformationSequence'],\n    '1004': ['DS', '1', 'ProcedureStepProgress'],\n    '1006': ['ST', '1', 'ProcedureStepProgressDescription'],\n    '1007': ['SQ', '1', 'ProcedureStepProgressParametersSequence'],\n    '1008': ['SQ', '1', 'ProcedureStepCommunicationsURISequence'],\n    '100A': ['UR', '1', 'ContactURI'],\n    '100C': ['LO', '1', 'ContactDisplayName'],\n    '100E': ['SQ', '1', 'ProcedureStepDiscontinuationReasonCodeSequence'],\n    '1020': ['SQ', '1', 'BeamTaskSequence'],\n    '1022': ['CS', '1', 'BeamTaskType'],\n    '1024': ['IS', '1', 'BeamOrderIndexTrial'],\n    '1025': ['CS', '1', 'AutosequenceFlag'],\n    '1026': ['FD', '1', 'TableTopVerticalAdjustedPosition'],\n    '1027': ['FD', '1', 'TableTopLongitudinalAdjustedPosition'],\n    '1028': ['FD', '1', 'TableTopLateralAdjustedPosition'],\n    '102A': ['FD', '1', 'PatientSupportAdjustedAngle'],\n    '102B': ['FD', '1', 'TableTopEccentricAdjustedAngle'],\n    '102C': ['FD', '1', 'TableTopPitchAdjustedAngle'],\n    '102D': ['FD', '1', 'TableTopRollAdjustedAngle'],\n    '1030': ['SQ', '1', 'DeliveryVerificationImageSequence'],\n    '1032': ['CS', '1', 'VerificationImageTiming'],\n    '1034': ['CS', '1', 'DoubleExposureFlag'],\n    '1036': ['CS', '1', 'DoubleExposureOrdering'],\n    '1038': ['DS', '1', 'DoubleExposureMetersetTrial'],\n    '103A': ['DS', '4', 'DoubleExposureFieldDeltaTrial'],\n    '1040': ['SQ', '1', 'RelatedReferenceRTImageSequence'],\n    '1042': ['SQ', '1', 'GeneralMachineVerificationSequence'],\n    '1044': ['SQ', '1', 'ConventionalMachineVerificationSequence'],\n    '1046': ['SQ', '1', 'IonMachineVerificationSequence'],\n    '1048': ['SQ', '1', 'FailedAttributesSequence'],\n    '104A': ['SQ', '1', 'OverriddenAttributesSequence'],\n    '104C': ['SQ', '1', 'ConventionalControlPointVerificationSequence'],\n    '104E': ['SQ', '1', 'IonControlPointVerificationSequence'],\n    '1050': ['SQ', '1', 'AttributeOccurrenceSequence'],\n    '1052': ['AT', '1', 'AttributeOccurrencePointer'],\n    '1054': ['UL', '1', 'AttributeItemSelector'],\n    '1056': ['LO', '1', 'AttributeOccurrencePrivateCreator'],\n    '1057': ['IS', '1-n', 'SelectorSequencePointerItems'],\n    '1200': ['CS', '1', 'ScheduledProcedureStepPriority'],\n    '1202': ['LO', '1', 'WorklistLabel'],\n    '1204': ['LO', '1', 'ProcedureStepLabel'],\n    '1210': ['SQ', '1', 'ScheduledProcessingParametersSequence'],\n    '1212': ['SQ', '1', 'PerformedProcessingParametersSequence'],\n    '1216': ['SQ', '1', 'UnifiedProcedureStepPerformedProcedureSequence'],\n    '1220': ['SQ', '1', 'RelatedProcedureStepSequence'],\n    '1222': ['LO', '1', 'ProcedureStepRelationshipType'],\n    '1224': ['SQ', '1', 'ReplacedProcedureStepSequence'],\n    '1230': ['LO', '1', 'DeletionLock'],\n    '1234': ['AE', '1', 'ReceivingAE'],\n    '1236': ['AE', '1', 'RequestingAE'],\n    '1238': ['LT', '1', 'ReasonForCancellation'],\n    '1242': ['CS', '1', 'SCPStatus'],\n    '1244': ['CS', '1', 'SubscriptionListStatus'],\n    '1246': ['CS', '1', 'UnifiedProcedureStepListStatus'],\n    '1324': ['UL', '1', 'BeamOrderIndex'],\n    '1338': ['FD', '1', 'DoubleExposureMeterset'],\n    '133A': ['FD', '4', 'DoubleExposureFieldDelta'],\n    '1401': ['SQ', '1', 'BrachyTaskSequence'],\n    '1402': ['DS', '1', 'ContinuationStartTotalReferenceAirKerma'],\n    '1403': ['DS', '1', 'ContinuationEndTotalReferenceAirKerma'],\n    '1404': ['IS', '1', 'ContinuationPulseNumber'],\n    '1405': ['SQ', '1', 'ChannelDeliveryOrderSequence'],\n    '1406': ['IS', '1', 'ReferencedChannelNumber'],\n    '1407': ['DS', '1', 'StartCumulativeTimeWeight'],\n    '1408': ['DS', '1', 'EndCumulativeTimeWeight'],\n    '1409': ['SQ', '1', 'OmittedChannelSequence'],\n    '140A': ['CS', '1', 'ReasonForChannelOmission'],\n    '140B': ['LO', '1', 'ReasonForChannelOmissionDescription'],\n    '140C': ['IS', '1', 'ChannelDeliveryOrderIndex'],\n    '140D': ['SQ', '1', 'ChannelDeliveryContinuationSequence'],\n    '140E': ['SQ', '1', 'OmittedApplicationSetupSequence']\n  },\n  '0076': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['LO', '1', 'ImplantAssemblyTemplateName'],\n    '0003': ['LO', '1', 'ImplantAssemblyTemplateIssuer'],\n    '0006': ['LO', '1', 'ImplantAssemblyTemplateVersion'],\n    '0008': ['SQ', '1', 'ReplacedImplantAssemblyTemplateSequence'],\n    '000A': ['CS', '1', 'ImplantAssemblyTemplateType'],\n    '000C': ['SQ', '1', 'OriginalImplantAssemblyTemplateSequence'],\n    '000E': ['SQ', '1', 'DerivationImplantAssemblyTemplateSequence'],\n    '0010': ['SQ', '1', 'ImplantAssemblyTemplateTargetAnatomySequence'],\n    '0020': ['SQ', '1', 'ProcedureTypeCodeSequence'],\n    '0030': ['LO', '1', 'SurgicalTechnique'],\n    '0032': ['SQ', '1', 'ComponentTypesSequence'],\n    '0034': ['SQ', '1', 'ComponentTypeCodeSequence'],\n    '0036': ['CS', '1', 'ExclusiveComponentType'],\n    '0038': ['CS', '1', 'MandatoryComponentType'],\n    '0040': ['SQ', '1', 'ComponentSequence'],\n    '0055': ['US', '1', 'ComponentID'],\n    '0060': ['SQ', '1', 'ComponentAssemblySequence'],\n    '0070': ['US', '1', 'Component1ReferencedID'],\n    '0080': ['US', '1', 'Component1ReferencedMatingFeatureSetID'],\n    '0090': ['US', '1', 'Component1ReferencedMatingFeatureID'],\n    '00A0': ['US', '1', 'Component2ReferencedID'],\n    '00B0': ['US', '1', 'Component2ReferencedMatingFeatureSetID'],\n    '00C0': ['US', '1', 'Component2ReferencedMatingFeatureID']\n  },\n  '0078': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['LO', '1', 'ImplantTemplateGroupName'],\n    '0010': ['ST', '1', 'ImplantTemplateGroupDescription'],\n    '0020': ['LO', '1', 'ImplantTemplateGroupIssuer'],\n    '0024': ['LO', '1', 'ImplantTemplateGroupVersion'],\n    '0026': ['SQ', '1', 'ReplacedImplantTemplateGroupSequence'],\n    '0028': ['SQ', '1', 'ImplantTemplateGroupTargetAnatomySequence'],\n    '002A': ['SQ', '1', 'ImplantTemplateGroupMembersSequence'],\n    '002E': ['US', '1', 'ImplantTemplateGroupMemberID'],\n    '0050': ['FD', '3', 'ThreeDImplantTemplateGroupMemberMatchingPoint'],\n    '0060': ['FD', '9', 'ThreeDImplantTemplateGroupMemberMatchingAxes'],\n    '0070': ['SQ', '1', 'ImplantTemplateGroupMemberMatching2DCoordinatesSequence'],\n    '0090': ['FD', '2', 'TwoDImplantTemplateGroupMemberMatchingPoint'],\n    '00A0': ['FD', '4', 'TwoDImplantTemplateGroupMemberMatchingAxes'],\n    '00B0': ['SQ', '1', 'ImplantTemplateGroupVariationDimensionSequence'],\n    '00B2': ['LO', '1', 'ImplantTemplateGroupVariationDimensionName'],\n    '00B4': ['SQ', '1', 'ImplantTemplateGroupVariationDimensionRankSequence'],\n    '00B6': ['US', '1', 'ReferencedImplantTemplateGroupMemberID'],\n    '00B8': ['US', '1', 'ImplantTemplateGroupVariationDimensionRank']\n  },\n  '0080': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['SQ', '1', 'SurfaceScanAcquisitionTypeCodeSequence'],\n    '0002': ['SQ', '1', 'SurfaceScanModeCodeSequence'],\n    '0003': ['SQ', '1', 'RegistrationMethodCodeSequence'],\n    '0004': ['FD', '1', 'ShotDurationTime'],\n    '0005': ['FD', '1', 'ShotOffsetTime'],\n    '0006': ['US', '1-n', 'SurfacePointPresentationValueData'],\n    '0007': ['US', '3-3n', 'SurfacePointColorCIELabValueData'],\n    '0008': ['SQ', '1', 'UVMappingSequence'],\n    '0009': ['SH', '1', 'TextureLabel'],\n    '0010': ['OF', '1', 'UValueData'],\n    '0011': ['OF', '1', 'VValueData'],\n    '0012': ['SQ', '1', 'ReferencedTextureSequence'],\n    '0013': ['SQ', '1', 'ReferencedSurfaceDataSequence']\n  },\n  '0082': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['CS', '1', 'AssessmentSummary'],\n    '0003': ['UT', '1', 'AssessmentSummaryDescription'],\n    '0004': ['SQ', '1', 'AssessedSOPInstanceSequence'],\n    '0005': ['SQ', '1', 'ReferencedComparisonSOPInstanceSequence'],\n    '0006': ['UL', '1', 'NumberOfAssessmentObservations'],\n    '0007': ['SQ', '1', 'AssessmentObservationsSequence'],\n    '0008': ['CS', '1', 'ObservationSignificance'],\n    '000A': ['UT', '1', 'ObservationDescription'],\n    '000C': ['SQ', '1', 'StructuredConstraintObservationSequence'],\n    '0010': ['SQ', '1', 'AssessedAttributeValueSequence'],\n    '0016': ['LO', '1', 'AssessmentSetID'],\n    '0017': ['SQ', '1', 'AssessmentRequesterSequence'],\n    '0018': ['LO', '1', 'SelectorAttributeName'],\n    '0019': ['LO', '1', 'SelectorAttributeKeyword'],\n    '0021': ['SQ', '1', 'AssessmentTypeCodeSequence'],\n    '0022': ['SQ', '1', 'ObservationBasisCodeSequence'],\n    '0023': ['LO', '1', 'AssessmentLabel'],\n    '0032': ['CS', '1', 'ConstraintType'],\n    '0033': ['UT', '1', 'SpecificationSelectionGuidance'],\n    '0034': ['SQ', '1', 'ConstraintValueSequence'],\n    '0035': ['SQ', '1', 'RecommendedDefaultValueSequence'],\n    '0036': ['CS', '1', 'ConstraintViolationSignificance'],\n    '0037': ['UT', '1', 'ConstraintViolationCondition'],\n    '0038': ['CS', '1', 'ModifiableConstraintFlag']\n  },\n  '0088': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0130': ['SH', '1', 'StorageMediaFileSetID'],\n    '0140': ['UI', '1', 'StorageMediaFileSetUID'],\n    '0200': ['SQ', '1', 'IconImageSequence'],\n    '0904': ['LO', '1', 'TopicTitle'],\n    '0906': ['ST', '1', 'TopicSubject'],\n    '0910': ['LO', '1', 'TopicAuthor'],\n    '0912': ['LO', '1-32', 'TopicKeywords']\n  },\n  '0100': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0410': ['CS', '1', 'SOPInstanceStatus'],\n    '0420': ['DT', '1', 'SOPAuthorizationDateTime'],\n    '0424': ['LT', '1', 'SOPAuthorizationComment'],\n    '0426': ['LO', '1', 'AuthorizationEquipmentCertificationNumber']\n  },\n  '0400': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0005': ['US', '1', 'MACIDNumber'],\n    '0010': ['UI', '1', 'MACCalculationTransferSyntaxUID'],\n    '0015': ['CS', '1', 'MACAlgorithm'],\n    '0020': ['AT', '1-n', 'DataElementsSigned'],\n    '0100': ['UI', '1', 'DigitalSignatureUID'],\n    '0105': ['DT', '1', 'DigitalSignatureDateTime'],\n    '0110': ['CS', '1', 'CertificateType'],\n    '0115': ['OB', '1', 'CertificateOfSigner'],\n    '0120': ['OB', '1', 'Signature'],\n    '0305': ['CS', '1', 'CertifiedTimestampType'],\n    '0310': ['OB', '1', 'CertifiedTimestamp'],\n    '0315': ['FL', '1', ''],\n    '0401': ['SQ', '1', 'DigitalSignaturePurposeCodeSequence'],\n    '0402': ['SQ', '1', 'ReferencedDigitalSignatureSequence'],\n    '0403': ['SQ', '1', 'ReferencedSOPInstanceMACSequence'],\n    '0404': ['OB', '1', 'MAC'],\n    '0500': ['SQ', '1', 'EncryptedAttributesSequence'],\n    '0510': ['UI', '1', 'EncryptedContentTransferSyntaxUID'],\n    '0520': ['OB', '1', 'EncryptedContent'],\n    '0550': ['SQ', '1', 'ModifiedAttributesSequence'],\n    '0551': ['SQ', '1', 'NonconformingModifiedAttributesSequence'],\n    '0552': ['OB', '1', 'NonconformingDataElementValue'],\n    '0561': ['SQ', '1', 'OriginalAttributesSequence'],\n    '0562': ['DT', '1', 'AttributeModificationDateTime'],\n    '0563': ['LO', '1', 'ModifyingSystem'],\n    '0564': ['LO', '1', 'SourceOfPreviousValues'],\n    '0565': ['CS', '1', 'ReasonForTheAttributeModification'],\n    '0600': ['CS', '1', 'InstanceOriginStatus']\n  },\n  '1000': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['US', '3', 'EscapeTriplet'],\n    '0011': ['US', '3', 'RunLengthTriplet'],\n    '0012': ['US', '1', 'HuffmanTableSize'],\n    '0013': ['US', '3', 'HuffmanTableTriplet'],\n    '0014': ['US', '1', 'ShiftTableSize'],\n    '0015': ['US', '3', 'ShiftTableTriplet']\n  },\n  '1010': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0004': ['US', '1-n', 'ZonalMap']\n  },\n  '2000': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['IS', '1', 'NumberOfCopies'],\n    '001E': ['SQ', '1', 'PrinterConfigurationSequence'],\n    '0020': ['CS', '1', 'PrintPriority'],\n    '0030': ['CS', '1', 'MediumType'],\n    '0040': ['CS', '1', 'FilmDestination'],\n    '0050': ['LO', '1', 'FilmSessionLabel'],\n    '0060': ['IS', '1', 'MemoryAllocation'],\n    '0061': ['IS', '1', 'MaximumMemoryAllocation'],\n    '0062': ['CS', '1', 'ColorImagePrintingFlag'],\n    '0063': ['CS', '1', 'CollationFlag'],\n    '0065': ['CS', '1', 'AnnotationFlag'],\n    '0067': ['CS', '1', 'ImageOverlayFlag'],\n    '0069': ['CS', '1', 'PresentationLUTFlag'],\n    '006A': ['CS', '1', 'ImageBoxPresentationLUTFlag'],\n    '00A0': ['US', '1', 'MemoryBitDepth'],\n    '00A1': ['US', '1', 'PrintingBitDepth'],\n    '00A2': ['SQ', '1', 'MediaInstalledSequence'],\n    '00A4': ['SQ', '1', 'OtherMediaAvailableSequence'],\n    '00A8': ['SQ', '1', 'SupportedImageDisplayFormatsSequence'],\n    '0500': ['SQ', '1', 'ReferencedFilmBoxSequence'],\n    '0510': ['SQ', '1', 'ReferencedStoredPrintSequence']\n  },\n  '2010': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['ST', '1', 'ImageDisplayFormat'],\n    '0030': ['CS', '1', 'AnnotationDisplayFormatID'],\n    '0040': ['CS', '1', 'FilmOrientation'],\n    '0050': ['CS', '1', 'FilmSizeID'],\n    '0052': ['CS', '1', 'PrinterResolutionID'],\n    '0054': ['CS', '1', 'DefaultPrinterResolutionID'],\n    '0060': ['CS', '1', 'MagnificationType'],\n    '0080': ['CS', '1', 'SmoothingType'],\n    '00A6': ['CS', '1', 'DefaultMagnificationType'],\n    '00A7': ['CS', '1-n', 'OtherMagnificationTypesAvailable'],\n    '00A8': ['CS', '1', 'DefaultSmoothingType'],\n    '00A9': ['CS', '1-n', 'OtherSmoothingTypesAvailable'],\n    '0100': ['CS', '1', 'BorderDensity'],\n    '0110': ['CS', '1', 'EmptyImageDensity'],\n    '0120': ['US', '1', 'MinDensity'],\n    '0130': ['US', '1', 'MaxDensity'],\n    '0140': ['CS', '1', 'Trim'],\n    '0150': ['ST', '1', 'ConfigurationInformation'],\n    '0152': ['LT', '1', 'ConfigurationInformationDescription'],\n    '0154': ['IS', '1', 'MaximumCollatedFilms'],\n    '015E': ['US', '1', 'Illumination'],\n    '0160': ['US', '1', 'ReflectedAmbientLight'],\n    '0376': ['DS', '2', 'PrinterPixelSpacing'],\n    '0500': ['SQ', '1', 'ReferencedFilmSessionSequence'],\n    '0510': ['SQ', '1', 'ReferencedImageBoxSequence'],\n    '0520': ['SQ', '1', 'ReferencedBasicAnnotationBoxSequence']\n  },\n  '2020': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['US', '1', 'ImageBoxPosition'],\n    '0020': ['CS', '1', 'Polarity'],\n    '0030': ['DS', '1', 'RequestedImageSize'],\n    '0040': ['CS', '1', 'RequestedDecimateCropBehavior'],\n    '0050': ['CS', '1', 'RequestedResolutionID'],\n    '00A0': ['CS', '1', 'RequestedImageSizeFlag'],\n    '00A2': ['CS', '1', 'DecimateCropResult'],\n    '0110': ['SQ', '1', 'BasicGrayscaleImageSequence'],\n    '0111': ['SQ', '1', 'BasicColorImageSequence'],\n    '0130': ['SQ', '1', 'ReferencedImageOverlayBoxSequence'],\n    '0140': ['SQ', '1', 'ReferencedVOILUTBoxSequence']\n  },\n  '2030': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['US', '1', 'AnnotationPosition'],\n    '0020': ['LO', '1', 'TextString']\n  },\n  '2040': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['SQ', '1', 'ReferencedOverlayPlaneSequence'],\n    '0011': ['US', '1-99', 'ReferencedOverlayPlaneGroups'],\n    '0020': ['SQ', '1', 'OverlayPixelDataSequence'],\n    '0060': ['CS', '1', 'OverlayMagnificationType'],\n    '0070': ['CS', '1', 'OverlaySmoothingType'],\n    '0072': ['CS', '1', 'OverlayOrImageMagnification'],\n    '0074': ['US', '1', 'MagnifyToNumberOfColumns'],\n    '0080': ['CS', '1', 'OverlayForegroundDensity'],\n    '0082': ['CS', '1', 'OverlayBackgroundDensity'],\n    '0090': ['CS', '1', 'OverlayMode'],\n    '0100': ['CS', '1', 'ThresholdDensity'],\n    '0500': ['SQ', '1', 'ReferencedImageBoxSequenceRetired']\n  },\n  '2050': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['SQ', '1', 'PresentationLUTSequence'],\n    '0020': ['CS', '1', 'PresentationLUTShape'],\n    '0500': ['SQ', '1', 'ReferencedPresentationLUTSequence']\n  },\n  '2100': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['SH', '1', 'PrintJobID'],\n    '0020': ['CS', '1', 'ExecutionStatus'],\n    '0030': ['CS', '1', 'ExecutionStatusInfo'],\n    '0040': ['DA', '1', 'CreationDate'],\n    '0050': ['TM', '1', 'CreationTime'],\n    '0070': ['AE', '1', 'Originator'],\n    '0140': ['AE', '1', 'DestinationAE'],\n    '0160': ['SH', '1', 'OwnerID'],\n    '0170': ['IS', '1', 'NumberOfFilms'],\n    '0500': ['SQ', '1', 'ReferencedPrintJobSequencePullStoredPrint']\n  },\n  '2110': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['CS', '1', 'PrinterStatus'],\n    '0020': ['CS', '1', 'PrinterStatusInfo'],\n    '0030': ['LO', '1', 'PrinterName'],\n    '0099': ['SH', '1', 'PrintQueueID']\n  },\n  '2120': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['CS', '1', 'QueueStatus'],\n    '0050': ['SQ', '1', 'PrintJobDescriptionSequence'],\n    '0070': ['SQ', '1', 'ReferencedPrintJobSequence']\n  },\n  '2130': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['SQ', '1', 'PrintManagementCapabilitiesSequence'],\n    '0015': ['SQ', '1', 'PrinterCharacteristicsSequence'],\n    '0030': ['SQ', '1', 'FilmBoxContentSequence'],\n    '0040': ['SQ', '1', 'ImageBoxContentSequence'],\n    '0050': ['SQ', '1', 'AnnotationContentSequence'],\n    '0060': ['SQ', '1', 'ImageOverlayBoxContentSequence'],\n    '0080': ['SQ', '1', 'PresentationLUTContentSequence'],\n    '00A0': ['SQ', '1', 'ProposedStudySequence'],\n    '00C0': ['SQ', '1', 'OriginalImageSequence']\n  },\n  '2200': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['CS', '1', 'LabelUsingInformationExtractedFromInstances'],\n    '0002': ['UT', '1', 'LabelText'],\n    '0003': ['CS', '1', 'LabelStyleSelection'],\n    '0004': ['LT', '1', 'MediaDisposition'],\n    '0005': ['LT', '1', 'BarcodeValue'],\n    '0006': ['CS', '1', 'BarcodeSymbology'],\n    '0007': ['CS', '1', 'AllowMediaSplitting'],\n    '0008': ['CS', '1', 'IncludeNonDICOMObjects'],\n    '0009': ['CS', '1', 'IncludeDisplayApplication'],\n    '000A': ['CS', '1', 'PreserveCompositeInstancesAfterMediaCreation'],\n    '000B': ['US', '1', 'TotalNumberOfPiecesOfMediaCreated'],\n    '000C': ['LO', '1', 'RequestedMediaApplicationProfile'],\n    '000D': ['SQ', '1', 'ReferencedStorageMediaSequence'],\n    '000E': ['AT', '1-n', 'FailureAttributes'],\n    '000F': ['CS', '1', 'AllowLossyCompression'],\n    '0020': ['CS', '1', 'RequestPriority']\n  },\n  '3002': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0002': ['SH', '1', 'RTImageLabel'],\n    '0003': ['LO', '1', 'RTImageName'],\n    '0004': ['ST', '1', 'RTImageDescription'],\n    '000A': ['CS', '1', 'ReportedValuesOrigin'],\n    '000C': ['CS', '1', 'RTImagePlane'],\n    '000D': ['DS', '3', 'XRayImageReceptorTranslation'],\n    '000E': ['DS', '1', 'XRayImageReceptorAngle'],\n    '0010': ['DS', '6', 'RTImageOrientation'],\n    '0011': ['DS', '2', 'ImagePlanePixelSpacing'],\n    '0012': ['DS', '2', 'RTImagePosition'],\n    '0020': ['SH', '1', 'RadiationMachineName'],\n    '0022': ['DS', '1', 'RadiationMachineSAD'],\n    '0024': ['DS', '1', 'RadiationMachineSSD'],\n    '0026': ['DS', '1', 'RTImageSID'],\n    '0028': ['DS', '1', 'SourceToReferenceObjectDistance'],\n    '0029': ['IS', '1', 'FractionNumber'],\n    '0030': ['SQ', '1', 'ExposureSequence'],\n    '0032': ['DS', '1', 'MetersetExposure'],\n    '0034': ['DS', '4', 'DiaphragmPosition'],\n    '0040': ['SQ', '1', 'FluenceMapSequence'],\n    '0041': ['CS', '1', 'FluenceDataSource'],\n    '0042': ['DS', '1', 'FluenceDataScale'],\n    '0050': ['SQ', '1', 'PrimaryFluenceModeSequence'],\n    '0051': ['CS', '1', 'FluenceMode'],\n    '0052': ['SH', '1', 'FluenceModeID']\n  },\n  '3004': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['CS', '1', 'DVHType'],\n    '0002': ['CS', '1', 'DoseUnits'],\n    '0004': ['CS', '1', 'DoseType'],\n    '0005': ['CS', '1', 'SpatialTransformOfDose'],\n    '0006': ['LO', '1', 'DoseComment'],\n    '0008': ['DS', '3', 'NormalizationPoint'],\n    '000A': ['CS', '1', 'DoseSummationType'],\n    '000C': ['DS', '2-n', 'GridFrameOffsetVector'],\n    '000E': ['DS', '1', 'DoseGridScaling'],\n    '0010': ['SQ', '1', 'RTDoseROISequence'],\n    '0012': ['DS', '1', 'DoseValue'],\n    '0014': ['CS', '1-3', 'TissueHeterogeneityCorrection'],\n    '0040': ['DS', '3', 'DVHNormalizationPoint'],\n    '0042': ['DS', '1', 'DVHNormalizationDoseValue'],\n    '0050': ['SQ', '1', 'DVHSequence'],\n    '0052': ['DS', '1', 'DVHDoseScaling'],\n    '0054': ['CS', '1', 'DVHVolumeUnits'],\n    '0056': ['IS', '1', 'DVHNumberOfBins'],\n    '0058': ['DS', '2-2n', 'DVHData'],\n    '0060': ['SQ', '1', 'DVHReferencedROISequence'],\n    '0062': ['CS', '1', 'DVHROIContributionType'],\n    '0070': ['DS', '1', 'DVHMinimumDose'],\n    '0072': ['DS', '1', 'DVHMaximumDose'],\n    '0074': ['DS', '1', 'DVHMeanDose']\n  },\n  '3006': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0002': ['SH', '1', 'StructureSetLabel'],\n    '0004': ['LO', '1', 'StructureSetName'],\n    '0006': ['ST', '1', 'StructureSetDescription'],\n    '0008': ['DA', '1', 'StructureSetDate'],\n    '0009': ['TM', '1', 'StructureSetTime'],\n    '0010': ['SQ', '1', 'ReferencedFrameOfReferenceSequence'],\n    '0012': ['SQ', '1', 'RTReferencedStudySequence'],\n    '0014': ['SQ', '1', 'RTReferencedSeriesSequence'],\n    '0016': ['SQ', '1', 'ContourImageSequence'],\n    '0018': ['SQ', '1', 'PredecessorStructureSetSequence'],\n    '0020': ['SQ', '1', 'StructureSetROISequence'],\n    '0022': ['IS', '1', 'ROINumber'],\n    '0024': ['UI', '1', 'ReferencedFrameOfReferenceUID'],\n    '0026': ['LO', '1', 'ROIName'],\n    '0028': ['ST', '1', 'ROIDescription'],\n    '002A': ['IS', '3', 'ROIDisplayColor'],\n    '002C': ['DS', '1', 'ROIVolume'],\n    '0030': ['SQ', '1', 'RTRelatedROISequence'],\n    '0033': ['CS', '1', 'RTROIRelationship'],\n    '0036': ['CS', '1', 'ROIGenerationAlgorithm'],\n    '0037': ['SQ', '1', 'ROIDerivationAlgorithmIdentificationSequence'],\n    '0038': ['LO', '1', 'ROIGenerationDescription'],\n    '0039': ['SQ', '1', 'ROIContourSequence'],\n    '0040': ['SQ', '1', 'ContourSequence'],\n    '0042': ['CS', '1', 'ContourGeometricType'],\n    '0044': ['DS', '1', 'ContourSlabThickness'],\n    '0045': ['DS', '3', 'ContourOffsetVector'],\n    '0046': ['IS', '1', 'NumberOfContourPoints'],\n    '0048': ['IS', '1', 'ContourNumber'],\n    '0049': ['IS', '1-n', 'AttachedContours'],\n    '004A': ['SQ', '1', 'SourcePixelPlanesCharacteristicsSequence'],\n    '0050': ['DS', '3-3n', 'ContourData'],\n    '0080': ['SQ', '1', 'RTROIObservationsSequence'],\n    '0082': ['IS', '1', 'ObservationNumber'],\n    '0084': ['IS', '1', 'ReferencedROINumber'],\n    '0085': ['SH', '1', 'ROIObservationLabel'],\n    '0086': ['SQ', '1', 'RTROIIdentificationCodeSequence'],\n    '0088': ['ST', '1', 'ROIObservationDescription'],\n    '00A0': ['SQ', '1', 'RelatedRTROIObservationsSequence'],\n    '00A4': ['CS', '1', 'RTROIInterpretedType'],\n    '00A6': ['PN', '1', 'ROIInterpreter'],\n    '00B0': ['SQ', '1', 'ROIPhysicalPropertiesSequence'],\n    '00B2': ['CS', '1', 'ROIPhysicalProperty'],\n    '00B4': ['DS', '1', 'ROIPhysicalPropertyValue'],\n    '00B6': ['SQ', '1', 'ROIElementalCompositionSequence'],\n    '00B7': ['US', '1', 'ROIElementalCompositionAtomicNumber'],\n    '00B8': ['FL', '1', 'ROIElementalCompositionAtomicMassFraction'],\n    '00B9': ['SQ', '1', 'AdditionalRTROIIdentificationCodeSequence'],\n    '00C0': ['SQ', '1', 'FrameOfReferenceRelationshipSequence'],\n    '00C2': ['UI', '1', 'RelatedFrameOfReferenceUID'],\n    '00C4': ['CS', '1', 'FrameOfReferenceTransformationType'],\n    '00C6': ['DS', '16', 'FrameOfReferenceTransformationMatrix'],\n    '00C8': ['LO', '1', 'FrameOfReferenceTransformationComment'],\n    '00C9': ['SQ', '1', 'PatientLocationCoordinatesSequence'],\n    '00CA': ['SQ', '1', 'PatientLocationCoordinatesCodeSequence'],\n    '00CB': ['SQ', '1', 'PatientSupportPositionSequence']\n  },\n  '3008': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['SQ', '1', 'MeasuredDoseReferenceSequence'],\n    '0012': ['ST', '1', 'MeasuredDoseDescription'],\n    '0014': ['CS', '1', 'MeasuredDoseType'],\n    '0016': ['DS', '1', 'MeasuredDoseValue'],\n    '0020': ['SQ', '1', 'TreatmentSessionBeamSequence'],\n    '0021': ['SQ', '1', 'TreatmentSessionIonBeamSequence'],\n    '0022': ['IS', '1', 'CurrentFractionNumber'],\n    '0024': ['DA', '1', 'TreatmentControlPointDate'],\n    '0025': ['TM', '1', 'TreatmentControlPointTime'],\n    '002A': ['CS', '1', 'TreatmentTerminationStatus'],\n    '002B': ['SH', '1', 'TreatmentTerminationCode'],\n    '002C': ['CS', '1', 'TreatmentVerificationStatus'],\n    '0030': ['SQ', '1', 'ReferencedTreatmentRecordSequence'],\n    '0032': ['DS', '1', 'SpecifiedPrimaryMeterset'],\n    '0033': ['DS', '1', 'SpecifiedSecondaryMeterset'],\n    '0036': ['DS', '1', 'DeliveredPrimaryMeterset'],\n    '0037': ['DS', '1', 'DeliveredSecondaryMeterset'],\n    '003A': ['DS', '1', 'SpecifiedTreatmentTime'],\n    '003B': ['DS', '1', 'DeliveredTreatmentTime'],\n    '0040': ['SQ', '1', 'ControlPointDeliverySequence'],\n    '0041': ['SQ', '1', 'IonControlPointDeliverySequence'],\n    '0042': ['DS', '1', 'SpecifiedMeterset'],\n    '0044': ['DS', '1', 'DeliveredMeterset'],\n    '0045': ['FL', '1', 'MetersetRateSet'],\n    '0046': ['FL', '1', 'MetersetRateDelivered'],\n    '0047': ['FL', '1-n', 'ScanSpotMetersetsDelivered'],\n    '0048': ['DS', '1', 'DoseRateDelivered'],\n    '0050': ['SQ', '1', 'TreatmentSummaryCalculatedDoseReferenceSequence'],\n    '0052': ['DS', '1', 'CumulativeDoseToDoseReference'],\n    '0054': ['DA', '1', 'FirstTreatmentDate'],\n    '0056': ['DA', '1', 'MostRecentTreatmentDate'],\n    '005A': ['IS', '1', 'NumberOfFractionsDelivered'],\n    '0060': ['SQ', '1', 'OverrideSequence'],\n    '0061': ['AT', '1', 'ParameterSequencePointer'],\n    '0062': ['AT', '1', 'OverrideParameterPointer'],\n    '0063': ['IS', '1', 'ParameterItemIndex'],\n    '0064': ['IS', '1', 'MeasuredDoseReferenceNumber'],\n    '0065': ['AT', '1', 'ParameterPointer'],\n    '0066': ['ST', '1', 'OverrideReason'],\n    '0067': ['US', '1', 'ParameterValueNumber'],\n    '0068': ['SQ', '1', 'CorrectedParameterSequence'],\n    '006A': ['FL', '1', 'CorrectionValue'],\n    '0070': ['SQ', '1', 'CalculatedDoseReferenceSequence'],\n    '0072': ['IS', '1', 'CalculatedDoseReferenceNumber'],\n    '0074': ['ST', '1', 'CalculatedDoseReferenceDescription'],\n    '0076': ['DS', '1', 'CalculatedDoseReferenceDoseValue'],\n    '0078': ['DS', '1', 'StartMeterset'],\n    '007A': ['DS', '1', 'EndMeterset'],\n    '0080': ['SQ', '1', 'ReferencedMeasuredDoseReferenceSequence'],\n    '0082': ['IS', '1', 'ReferencedMeasuredDoseReferenceNumber'],\n    '0090': ['SQ', '1', 'ReferencedCalculatedDoseReferenceSequence'],\n    '0092': ['IS', '1', 'ReferencedCalculatedDoseReferenceNumber'],\n    '00A0': ['SQ', '1', 'BeamLimitingDeviceLeafPairsSequence'],\n    '00B0': ['SQ', '1', 'RecordedWedgeSequence'],\n    '00C0': ['SQ', '1', 'RecordedCompensatorSequence'],\n    '00D0': ['SQ', '1', 'RecordedBlockSequence'],\n    '00D1': ['SQ', '1', 'RecordedBlockSlabSequence'],\n    '00E0': ['SQ', '1', 'TreatmentSummaryMeasuredDoseReferenceSequence'],\n    '00F0': ['SQ', '1', 'RecordedSnoutSequence'],\n    '00F2': ['SQ', '1', 'RecordedRangeShifterSequence'],\n    '00F4': ['SQ', '1', 'RecordedLateralSpreadingDeviceSequence'],\n    '00F6': ['SQ', '1', 'RecordedRangeModulatorSequence'],\n    '0100': ['SQ', '1', 'RecordedSourceSequence'],\n    '0105': ['LO', '1', 'SourceSerialNumber'],\n    '0110': ['SQ', '1', 'TreatmentSessionApplicationSetupSequence'],\n    '0116': ['CS', '1', 'ApplicationSetupCheck'],\n    '0120': ['SQ', '1', 'RecordedBrachyAccessoryDeviceSequence'],\n    '0122': ['IS', '1', 'ReferencedBrachyAccessoryDeviceNumber'],\n    '0130': ['SQ', '1', 'RecordedChannelSequence'],\n    '0132': ['DS', '1', 'SpecifiedChannelTotalTime'],\n    '0134': ['DS', '1', 'DeliveredChannelTotalTime'],\n    '0136': ['IS', '1', 'SpecifiedNumberOfPulses'],\n    '0138': ['IS', '1', 'DeliveredNumberOfPulses'],\n    '013A': ['DS', '1', 'SpecifiedPulseRepetitionInterval'],\n    '013C': ['DS', '1', 'DeliveredPulseRepetitionInterval'],\n    '0140': ['SQ', '1', 'RecordedSourceApplicatorSequence'],\n    '0142': ['IS', '1', 'ReferencedSourceApplicatorNumber'],\n    '0150': ['SQ', '1', 'RecordedChannelShieldSequence'],\n    '0152': ['IS', '1', 'ReferencedChannelShieldNumber'],\n    '0160': ['SQ', '1', 'BrachyControlPointDeliveredSequence'],\n    '0162': ['DA', '1', 'SafePositionExitDate'],\n    '0164': ['TM', '1', 'SafePositionExitTime'],\n    '0166': ['DA', '1', 'SafePositionReturnDate'],\n    '0168': ['TM', '1', 'SafePositionReturnTime'],\n    '0171': ['SQ', '1', 'PulseSpecificBrachyControlPointDeliveredSequence'],\n    '0172': ['US', '1', 'PulseNumber'],\n    '0173': ['SQ', '1', 'BrachyPulseControlPointDeliveredSequence'],\n    '0200': ['CS', '1', 'CurrentTreatmentStatus'],\n    '0202': ['ST', '1', 'TreatmentStatusComment'],\n    '0220': ['SQ', '1', 'FractionGroupSummarySequence'],\n    '0223': ['IS', '1', 'ReferencedFractionNumber'],\n    '0224': ['CS', '1', 'FractionGroupType'],\n    '0230': ['CS', '1', 'BeamStopperPosition'],\n    '0240': ['SQ', '1', 'FractionStatusSummarySequence'],\n    '0250': ['DA', '1', 'TreatmentDate'],\n    '0251': ['TM', '1', 'TreatmentTime']\n  },\n  '300A': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0002': ['SH', '1', 'RTPlanLabel'],\n    '0003': ['LO', '1', 'RTPlanName'],\n    '0004': ['ST', '1', 'RTPlanDescription'],\n    '0006': ['DA', '1', 'RTPlanDate'],\n    '0007': ['TM', '1', 'RTPlanTime'],\n    '0009': ['LO', '1-n', 'TreatmentProtocols'],\n    '000A': ['CS', '1', 'PlanIntent'],\n    '000B': ['LO', '1-n', 'TreatmentSites'],\n    '000C': ['CS', '1', 'RTPlanGeometry'],\n    '000E': ['ST', '1', 'PrescriptionDescription'],\n    '0010': ['SQ', '1', 'DoseReferenceSequence'],\n    '0012': ['IS', '1', 'DoseReferenceNumber'],\n    '0013': ['UI', '1', 'DoseReferenceUID'],\n    '0014': ['CS', '1', 'DoseReferenceStructureType'],\n    '0015': ['CS', '1', 'NominalBeamEnergyUnit'],\n    '0016': ['LO', '1', 'DoseReferenceDescription'],\n    '0018': ['DS', '3', 'DoseReferencePointCoordinates'],\n    '001A': ['DS', '1', 'NominalPriorDose'],\n    '0020': ['CS', '1', 'DoseReferenceType'],\n    '0021': ['DS', '1', 'ConstraintWeight'],\n    '0022': ['DS', '1', 'DeliveryWarningDose'],\n    '0023': ['DS', '1', 'DeliveryMaximumDose'],\n    '0025': ['DS', '1', 'TargetMinimumDose'],\n    '0026': ['DS', '1', 'TargetPrescriptionDose'],\n    '0027': ['DS', '1', 'TargetMaximumDose'],\n    '0028': ['DS', '1', 'TargetUnderdoseVolumeFraction'],\n    '002A': ['DS', '1', 'OrganAtRiskFullVolumeDose'],\n    '002B': ['DS', '1', 'OrganAtRiskLimitDose'],\n    '002C': ['DS', '1', 'OrganAtRiskMaximumDose'],\n    '002D': ['DS', '1', 'OrganAtRiskOverdoseVolumeFraction'],\n    '0040': ['SQ', '1', 'ToleranceTableSequence'],\n    '0042': ['IS', '1', 'ToleranceTableNumber'],\n    '0043': ['SH', '1', 'ToleranceTableLabel'],\n    '0044': ['DS', '1', 'GantryAngleTolerance'],\n    '0046': ['DS', '1', 'BeamLimitingDeviceAngleTolerance'],\n    '0048': ['SQ', '1', 'BeamLimitingDeviceToleranceSequence'],\n    '004A': ['DS', '1', 'BeamLimitingDevicePositionTolerance'],\n    '004B': ['FL', '1', 'SnoutPositionTolerance'],\n    '004C': ['DS', '1', 'PatientSupportAngleTolerance'],\n    '004E': ['DS', '1', 'TableTopEccentricAngleTolerance'],\n    '004F': ['FL', '1', 'TableTopPitchAngleTolerance'],\n    '0050': ['FL', '1', 'TableTopRollAngleTolerance'],\n    '0051': ['DS', '1', 'TableTopVerticalPositionTolerance'],\n    '0052': ['DS', '1', 'TableTopLongitudinalPositionTolerance'],\n    '0053': ['DS', '1', 'TableTopLateralPositionTolerance'],\n    '0055': ['CS', '1', 'RTPlanRelationship'],\n    '0070': ['SQ', '1', 'FractionGroupSequence'],\n    '0071': ['IS', '1', 'FractionGroupNumber'],\n    '0072': ['LO', '1', 'FractionGroupDescription'],\n    '0078': ['IS', '1', 'NumberOfFractionsPlanned'],\n    '0079': ['IS', '1', 'NumberOfFractionPatternDigitsPerDay'],\n    '007A': ['IS', '1', 'RepeatFractionCycleLength'],\n    '007B': ['LT', '1', 'FractionPattern'],\n    '0080': ['IS', '1', 'NumberOfBeams'],\n    '0082': ['DS', '3', 'BeamDoseSpecificationPoint'],\n    '0083': ['UI', '1', 'ReferencedDoseReferenceUID'],\n    '0084': ['DS', '1', 'BeamDose'],\n    '0086': ['DS', '1', 'BeamMeterset'],\n    '0088': ['FL', '1', 'BeamDosePointDepth'],\n    '0089': ['FL', '1', 'BeamDosePointEquivalentDepth'],\n    '008A': ['FL', '1', 'BeamDosePointSSD'],\n    '008B': ['CS', '1', 'BeamDoseMeaning'],\n    '008C': ['SQ', '1', 'BeamDoseVerificationControlPointSequence'],\n    '008D': ['FL', '1', 'AverageBeamDosePointDepth'],\n    '008E': ['FL', '1', 'AverageBeamDosePointEquivalentDepth'],\n    '008F': ['FL', '1', 'AverageBeamDosePointSSD'],\n    '0090': ['CS', '1', 'BeamDoseType'],\n    '0091': ['DS', '1', 'AlternateBeamDose'],\n    '0092': ['CS', '1', 'AlternateBeamDoseType'],\n    '0093': ['CS', '1', 'DepthValueAveragingFlag'],\n    '0094': ['DS', '1', 'BeamDosePointSourceToExternalContourDistance'],\n    '00A0': ['IS', '1', 'NumberOfBrachyApplicationSetups'],\n    '00A2': ['DS', '3', 'BrachyApplicationSetupDoseSpecificationPoint'],\n    '00A4': ['DS', '1', 'BrachyApplicationSetupDose'],\n    '00B0': ['SQ', '1', 'BeamSequence'],\n    '00B2': ['SH', '1', 'TreatmentMachineName'],\n    '00B3': ['CS', '1', 'PrimaryDosimeterUnit'],\n    '00B4': ['DS', '1', 'SourceAxisDistance'],\n    '00B6': ['SQ', '1', 'BeamLimitingDeviceSequence'],\n    '00B8': ['CS', '1', 'RTBeamLimitingDeviceType'],\n    '00BA': ['DS', '1', 'SourceToBeamLimitingDeviceDistance'],\n    '00BB': ['FL', '1', 'IsocenterToBeamLimitingDeviceDistance'],\n    '00BC': ['IS', '1', 'NumberOfLeafJawPairs'],\n    '00BE': ['DS', '3-n', 'LeafPositionBoundaries'],\n    '00C0': ['IS', '1', 'BeamNumber'],\n    '00C2': ['LO', '1', 'BeamName'],\n    '00C3': ['ST', '1', 'BeamDescription'],\n    '00C4': ['CS', '1', 'BeamType'],\n    '00C5': ['FD', '1', 'BeamDeliveryDurationLimit'],\n    '00C6': ['CS', '1', 'RadiationType'],\n    '00C7': ['CS', '1', 'HighDoseTechniqueType'],\n    '00C8': ['IS', '1', 'ReferenceImageNumber'],\n    '00CA': ['SQ', '1', 'PlannedVerificationImageSequence'],\n    '00CC': ['LO', '1-n', 'ImagingDeviceSpecificAcquisitionParameters'],\n    '00CE': ['CS', '1', 'TreatmentDeliveryType'],\n    '00D0': ['IS', '1', 'NumberOfWedges'],\n    '00D1': ['SQ', '1', 'WedgeSequence'],\n    '00D2': ['IS', '1', 'WedgeNumber'],\n    '00D3': ['CS', '1', 'WedgeType'],\n    '00D4': ['SH', '1', 'WedgeID'],\n    '00D5': ['IS', '1', 'WedgeAngle'],\n    '00D6': ['DS', '1', 'WedgeFactor'],\n    '00D7': ['FL', '1', 'TotalWedgeTrayWaterEquivalentThickness'],\n    '00D8': ['DS', '1', 'WedgeOrientation'],\n    '00D9': ['FL', '1', 'IsocenterToWedgeTrayDistance'],\n    '00DA': ['DS', '1', 'SourceToWedgeTrayDistance'],\n    '00DB': ['FL', '1', 'WedgeThinEdgePosition'],\n    '00DC': ['SH', '1', 'BolusID'],\n    '00DD': ['ST', '1', 'BolusDescription'],\n    '00DE': ['DS', '1', 'EffectiveWedgeAngle'],\n    '00E0': ['IS', '1', 'NumberOfCompensators'],\n    '00E1': ['SH', '1', 'MaterialID'],\n    '00E2': ['DS', '1', 'TotalCompensatorTrayFactor'],\n    '00E3': ['SQ', '1', 'CompensatorSequence'],\n    '00E4': ['IS', '1', 'CompensatorNumber'],\n    '00E5': ['SH', '1', 'CompensatorID'],\n    '00E6': ['DS', '1', 'SourceToCompensatorTrayDistance'],\n    '00E7': ['IS', '1', 'CompensatorRows'],\n    '00E8': ['IS', '1', 'CompensatorColumns'],\n    '00E9': ['DS', '2', 'CompensatorPixelSpacing'],\n    '00EA': ['DS', '2', 'CompensatorPosition'],\n    '00EB': ['DS', '1-n', 'CompensatorTransmissionData'],\n    '00EC': ['DS', '1-n', 'CompensatorThicknessData'],\n    '00ED': ['IS', '1', 'NumberOfBoli'],\n    '00EE': ['CS', '1', 'CompensatorType'],\n    '00EF': ['SH', '1', 'CompensatorTrayID'],\n    '00F0': ['IS', '1', 'NumberOfBlocks'],\n    '00F2': ['DS', '1', 'TotalBlockTrayFactor'],\n    '00F3': ['FL', '1', 'TotalBlockTrayWaterEquivalentThickness'],\n    '00F4': ['SQ', '1', 'BlockSequence'],\n    '00F5': ['SH', '1', 'BlockTrayID'],\n    '00F6': ['DS', '1', 'SourceToBlockTrayDistance'],\n    '00F7': ['FL', '1', 'IsocenterToBlockTrayDistance'],\n    '00F8': ['CS', '1', 'BlockType'],\n    '00F9': ['LO', '1', 'AccessoryCode'],\n    '00FA': ['CS', '1', 'BlockDivergence'],\n    '00FB': ['CS', '1', 'BlockMountingPosition'],\n    '00FC': ['IS', '1', 'BlockNumber'],\n    '00FE': ['LO', '1', 'BlockName'],\n    '0100': ['DS', '1', 'BlockThickness'],\n    '0102': ['DS', '1', 'BlockTransmission'],\n    '0104': ['IS', '1', 'BlockNumberOfPoints'],\n    '0106': ['DS', '2-2n', 'BlockData'],\n    '0107': ['SQ', '1', 'ApplicatorSequence'],\n    '0108': ['SH', '1', 'ApplicatorID'],\n    '0109': ['CS', '1', 'ApplicatorType'],\n    '010A': ['LO', '1', 'ApplicatorDescription'],\n    '010C': ['DS', '1', 'CumulativeDoseReferenceCoefficient'],\n    '010E': ['DS', '1', 'FinalCumulativeMetersetWeight'],\n    '0110': ['IS', '1', 'NumberOfControlPoints'],\n    '0111': ['SQ', '1', 'ControlPointSequence'],\n    '0112': ['IS', '1', 'ControlPointIndex'],\n    '0114': ['DS', '1', 'NominalBeamEnergy'],\n    '0115': ['DS', '1', 'DoseRateSet'],\n    '0116': ['SQ', '1', 'WedgePositionSequence'],\n    '0118': ['CS', '1', 'WedgePosition'],\n    '011A': ['SQ', '1', 'BeamLimitingDevicePositionSequence'],\n    '011C': ['DS', '2-2n', 'LeafJawPositions'],\n    '011E': ['DS', '1', 'GantryAngle'],\n    '011F': ['CS', '1', 'GantryRotationDirection'],\n    '0120': ['DS', '1', 'BeamLimitingDeviceAngle'],\n    '0121': ['CS', '1', 'BeamLimitingDeviceRotationDirection'],\n    '0122': ['DS', '1', 'PatientSupportAngle'],\n    '0123': ['CS', '1', 'PatientSupportRotationDirection'],\n    '0124': ['DS', '1', 'TableTopEccentricAxisDistance'],\n    '0125': ['DS', '1', 'TableTopEccentricAngle'],\n    '0126': ['CS', '1', 'TableTopEccentricRotationDirection'],\n    '0128': ['DS', '1', 'TableTopVerticalPosition'],\n    '0129': ['DS', '1', 'TableTopLongitudinalPosition'],\n    '012A': ['DS', '1', 'TableTopLateralPosition'],\n    '012C': ['DS', '3', 'IsocenterPosition'],\n    '012E': ['DS', '3', 'SurfaceEntryPoint'],\n    '0130': ['DS', '1', 'SourceToSurfaceDistance'],\n    '0131': ['FL', '1', 'AverageBeamDosePointSourceToExternalContourDistance'],\n    '0132': ['FL', '1', 'SourceToExternalContourDistance'],\n    '0133': ['FL', '3', 'ExternalContourEntryPoint'],\n    '0134': ['DS', '1', 'CumulativeMetersetWeight'],\n    '0140': ['FL', '1', 'TableTopPitchAngle'],\n    '0142': ['CS', '1', 'TableTopPitchRotationDirection'],\n    '0144': ['FL', '1', 'TableTopRollAngle'],\n    '0146': ['CS', '1', 'TableTopRollRotationDirection'],\n    '0148': ['FL', '1', 'HeadFixationAngle'],\n    '014A': ['FL', '1', 'GantryPitchAngle'],\n    '014C': ['CS', '1', 'GantryPitchRotationDirection'],\n    '014E': ['FL', '1', 'GantryPitchAngleTolerance'],\n    '0150': ['CS', '1', 'FixationEye'],\n    '0151': ['DS', '1', 'ChairHeadFramePosition'],\n    '0152': ['DS', '1', 'HeadFixationAngleTolerance'],\n    '0153': ['DS', '1', 'ChairHeadFramePositionTolerance'],\n    '0154': ['DS', '1', 'FixationLightAzimuthalAngleTolerance'],\n    '0155': ['DS', '1', 'FixationLightPolarAngleTolerance'],\n    '0180': ['SQ', '1', 'PatientSetupSequence'],\n    '0182': ['IS', '1', 'PatientSetupNumber'],\n    '0183': ['LO', '1', 'PatientSetupLabel'],\n    '0184': ['LO', '1', 'PatientAdditionalPosition'],\n    '0190': ['SQ', '1', 'FixationDeviceSequence'],\n    '0192': ['CS', '1', 'FixationDeviceType'],\n    '0194': ['SH', '1', 'FixationDeviceLabel'],\n    '0196': ['ST', '1', 'FixationDeviceDescription'],\n    '0198': ['SH', '1', 'FixationDevicePosition'],\n    '0199': ['FL', '1', 'FixationDevicePitchAngle'],\n    '019A': ['FL', '1', 'FixationDeviceRollAngle'],\n    '01A0': ['SQ', '1', 'ShieldingDeviceSequence'],\n    '01A2': ['CS', '1', 'ShieldingDeviceType'],\n    '01A4': ['SH', '1', 'ShieldingDeviceLabel'],\n    '01A6': ['ST', '1', 'ShieldingDeviceDescription'],\n    '01A8': ['SH', '1', 'ShieldingDevicePosition'],\n    '01B0': ['CS', '1', 'SetupTechnique'],\n    '01B2': ['ST', '1', 'SetupTechniqueDescription'],\n    '01B4': ['SQ', '1', 'SetupDeviceSequence'],\n    '01B6': ['CS', '1', 'SetupDeviceType'],\n    '01B8': ['SH', '1', 'SetupDeviceLabel'],\n    '01BA': ['ST', '1', 'SetupDeviceDescription'],\n    '01BC': ['DS', '1', 'SetupDeviceParameter'],\n    '01D0': ['ST', '1', 'SetupReferenceDescription'],\n    '01D2': ['DS', '1', 'TableTopVerticalSetupDisplacement'],\n    '01D4': ['DS', '1', 'TableTopLongitudinalSetupDisplacement'],\n    '01D6': ['DS', '1', 'TableTopLateralSetupDisplacement'],\n    '0200': ['CS', '1', 'BrachyTreatmentTechnique'],\n    '0202': ['CS', '1', 'BrachyTreatmentType'],\n    '0206': ['SQ', '1', 'TreatmentMachineSequence'],\n    '0210': ['SQ', '1', 'SourceSequence'],\n    '0212': ['IS', '1', 'SourceNumber'],\n    '0214': ['CS', '1', 'SourceType'],\n    '0216': ['LO', '1', 'SourceManufacturer'],\n    '0218': ['DS', '1', 'ActiveSourceDiameter'],\n    '021A': ['DS', '1', 'ActiveSourceLength'],\n    '021B': ['SH', '1', 'SourceModelID'],\n    '021C': ['LO', '1', 'SourceDescription'],\n    '0222': ['DS', '1', 'SourceEncapsulationNominalThickness'],\n    '0224': ['DS', '1', 'SourceEncapsulationNominalTransmission'],\n    '0226': ['LO', '1', 'SourceIsotopeName'],\n    '0228': ['DS', '1', 'SourceIsotopeHalfLife'],\n    '0229': ['CS', '1', 'SourceStrengthUnits'],\n    '022A': ['DS', '1', 'ReferenceAirKermaRate'],\n    '022B': ['DS', '1', 'SourceStrength'],\n    '022C': ['DA', '1', 'SourceStrengthReferenceDate'],\n    '022E': ['TM', '1', 'SourceStrengthReferenceTime'],\n    '0230': ['SQ', '1', 'ApplicationSetupSequence'],\n    '0232': ['CS', '1', 'ApplicationSetupType'],\n    '0234': ['IS', '1', 'ApplicationSetupNumber'],\n    '0236': ['LO', '1', 'ApplicationSetupName'],\n    '0238': ['LO', '1', 'ApplicationSetupManufacturer'],\n    '0240': ['IS', '1', 'TemplateNumber'],\n    '0242': ['SH', '1', 'TemplateType'],\n    '0244': ['LO', '1', 'TemplateName'],\n    '0250': ['DS', '1', 'TotalReferenceAirKerma'],\n    '0260': ['SQ', '1', 'BrachyAccessoryDeviceSequence'],\n    '0262': ['IS', '1', 'BrachyAccessoryDeviceNumber'],\n    '0263': ['SH', '1', 'BrachyAccessoryDeviceID'],\n    '0264': ['CS', '1', 'BrachyAccessoryDeviceType'],\n    '0266': ['LO', '1', 'BrachyAccessoryDeviceName'],\n    '026A': ['DS', '1', 'BrachyAccessoryDeviceNominalThickness'],\n    '026C': ['DS', '1', 'BrachyAccessoryDeviceNominalTransmission'],\n    '0271': ['DS', '1', 'ChannelEffectiveLength'],\n    '0272': ['DS', '1', 'ChannelInnerLength'],\n    '0273': ['SH', '1', 'AfterloaderChannelID'],\n    '0274': ['DS', '1', 'SourceApplicatorTipLength'],\n    '0280': ['SQ', '1', 'ChannelSequence'],\n    '0282': ['IS', '1', 'ChannelNumber'],\n    '0284': ['DS', '1', 'ChannelLength'],\n    '0286': ['DS', '1', 'ChannelTotalTime'],\n    '0288': ['CS', '1', 'SourceMovementType'],\n    '028A': ['IS', '1', 'NumberOfPulses'],\n    '028C': ['DS', '1', 'PulseRepetitionInterval'],\n    '0290': ['IS', '1', 'SourceApplicatorNumber'],\n    '0291': ['SH', '1', 'SourceApplicatorID'],\n    '0292': ['CS', '1', 'SourceApplicatorType'],\n    '0294': ['LO', '1', 'SourceApplicatorName'],\n    '0296': ['DS', '1', 'SourceApplicatorLength'],\n    '0298': ['LO', '1', 'SourceApplicatorManufacturer'],\n    '029C': ['DS', '1', 'SourceApplicatorWallNominalThickness'],\n    '029E': ['DS', '1', 'SourceApplicatorWallNominalTransmission'],\n    '02A0': ['DS', '1', 'SourceApplicatorStepSize'],\n    '02A1': ['IS', '1', 'ApplicatorShapeReferencedROINumber'],\n    '02A2': ['IS', '1', 'TransferTubeNumber'],\n    '02A4': ['DS', '1', 'TransferTubeLength'],\n    '02B0': ['SQ', '1', 'ChannelShieldSequence'],\n    '02B2': ['IS', '1', 'ChannelShieldNumber'],\n    '02B3': ['SH', '1', 'ChannelShieldID'],\n    '02B4': ['LO', '1', 'ChannelShieldName'],\n    '02B8': ['DS', '1', 'ChannelShieldNominalThickness'],\n    '02BA': ['DS', '1', 'ChannelShieldNominalTransmission'],\n    '02C8': ['DS', '1', 'FinalCumulativeTimeWeight'],\n    '02D0': ['SQ', '1', 'BrachyControlPointSequence'],\n    '02D2': ['DS', '1', 'ControlPointRelativePosition'],\n    '02D4': ['DS', '3', 'ControlPoint3DPosition'],\n    '02D6': ['DS', '1', 'CumulativeTimeWeight'],\n    '02E0': ['CS', '1', 'CompensatorDivergence'],\n    '02E1': ['CS', '1', 'CompensatorMountingPosition'],\n    '02E2': ['DS', '1-n', 'SourceToCompensatorDistance'],\n    '02E3': ['FL', '1', 'TotalCompensatorTrayWaterEquivalentThickness'],\n    '02E4': ['FL', '1', 'IsocenterToCompensatorTrayDistance'],\n    '02E5': ['FL', '1', 'CompensatorColumnOffset'],\n    '02E6': ['FL', '1-n', 'IsocenterToCompensatorDistances'],\n    '02E7': ['FL', '1', 'CompensatorRelativeStoppingPowerRatio'],\n    '02E8': ['FL', '1', 'CompensatorMillingToolDiameter'],\n    '02EA': ['SQ', '1', 'IonRangeCompensatorSequence'],\n    '02EB': ['LT', '1', 'CompensatorDescription'],\n    '0302': ['IS', '1', 'RadiationMassNumber'],\n    '0304': ['IS', '1', 'RadiationAtomicNumber'],\n    '0306': ['SS', '1', 'RadiationChargeState'],\n    '0308': ['CS', '1', 'ScanMode'],\n    '0309': ['CS', '1', 'ModulatedScanModeType'],\n    '030A': ['FL', '2', 'VirtualSourceAxisDistances'],\n    '030C': ['SQ', '1', 'SnoutSequence'],\n    '030D': ['FL', '1', 'SnoutPosition'],\n    '030F': ['SH', '1', 'SnoutID'],\n    '0312': ['IS', '1', 'NumberOfRangeShifters'],\n    '0314': ['SQ', '1', 'RangeShifterSequence'],\n    '0316': ['IS', '1', 'RangeShifterNumber'],\n    '0318': ['SH', '1', 'RangeShifterID'],\n    '0320': ['CS', '1', 'RangeShifterType'],\n    '0322': ['LO', '1', 'RangeShifterDescription'],\n    '0330': ['IS', '1', 'NumberOfLateralSpreadingDevices'],\n    '0332': ['SQ', '1', 'LateralSpreadingDeviceSequence'],\n    '0334': ['IS', '1', 'LateralSpreadingDeviceNumber'],\n    '0336': ['SH', '1', 'LateralSpreadingDeviceID'],\n    '0338': ['CS', '1', 'LateralSpreadingDeviceType'],\n    '033A': ['LO', '1', 'LateralSpreadingDeviceDescription'],\n    '033C': ['FL', '1', 'LateralSpreadingDeviceWaterEquivalentThickness'],\n    '0340': ['IS', '1', 'NumberOfRangeModulators'],\n    '0342': ['SQ', '1', 'RangeModulatorSequence'],\n    '0344': ['IS', '1', 'RangeModulatorNumber'],\n    '0346': ['SH', '1', 'RangeModulatorID'],\n    '0348': ['CS', '1', 'RangeModulatorType'],\n    '034A': ['LO', '1', 'RangeModulatorDescription'],\n    '034C': ['SH', '1', 'BeamCurrentModulationID'],\n    '0350': ['CS', '1', 'PatientSupportType'],\n    '0352': ['SH', '1', 'PatientSupportID'],\n    '0354': ['LO', '1', 'PatientSupportAccessoryCode'],\n    '0355': ['LO', '1', 'TrayAccessoryCode'],\n    '0356': ['FL', '1', 'FixationLightAzimuthalAngle'],\n    '0358': ['FL', '1', 'FixationLightPolarAngle'],\n    '035A': ['FL', '1', 'MetersetRate'],\n    '0360': ['SQ', '1', 'RangeShifterSettingsSequence'],\n    '0362': ['LO', '1', 'RangeShifterSetting'],\n    '0364': ['FL', '1', 'IsocenterToRangeShifterDistance'],\n    '0366': ['FL', '1', 'RangeShifterWaterEquivalentThickness'],\n    '0370': ['SQ', '1', 'LateralSpreadingDeviceSettingsSequence'],\n    '0372': ['LO', '1', 'LateralSpreadingDeviceSetting'],\n    '0374': ['FL', '1', 'IsocenterToLateralSpreadingDeviceDistance'],\n    '0380': ['SQ', '1', 'RangeModulatorSettingsSequence'],\n    '0382': ['FL', '1', 'RangeModulatorGatingStartValue'],\n    '0384': ['FL', '1', 'RangeModulatorGatingStopValue'],\n    '0386': ['FL', '1', 'RangeModulatorGatingStartWaterEquivalentThickness'],\n    '0388': ['FL', '1', 'RangeModulatorGatingStopWaterEquivalentThickness'],\n    '038A': ['FL', '1', 'IsocenterToRangeModulatorDistance'],\n    '038F': ['FL', '1-n', 'ScanSpotTimeOffset'],\n    '0390': ['SH', '1', 'ScanSpotTuneID'],\n    '0391': ['IS', '1-n', 'ScanSpotPrescribedIndices'],\n    '0392': ['IS', '1', 'NumberOfScanSpotPositions'],\n    '0393': ['CS', '1', 'ScanSpotReordered'],\n    '0394': ['FL', '1-n', 'ScanSpotPositionMap'],\n    '0395': ['CS', '1', 'ScanSpotReorderingAllowed'],\n    '0396': ['FL', '1-n', 'ScanSpotMetersetWeights'],\n    '0398': ['FL', '2', 'ScanningSpotSize'],\n    '0399': ['FL', '2-2n', 'ScanSpotSizesDelivered'],\n    '039A': ['IS', '1', 'NumberOfPaintings'],\n    '03A0': ['SQ', '1', 'IonToleranceTableSequence'],\n    '03A2': ['SQ', '1', 'IonBeamSequence'],\n    '03A4': ['SQ', '1', 'IonBeamLimitingDeviceSequence'],\n    '03A6': ['SQ', '1', 'IonBlockSequence'],\n    '03A8': ['SQ', '1', 'IonControlPointSequence'],\n    '03AA': ['SQ', '1', 'IonWedgeSequence'],\n    '03AC': ['SQ', '1', 'IonWedgePositionSequence'],\n    '0401': ['SQ', '1', 'ReferencedSetupImageSequence'],\n    '0402': ['ST', '1', 'SetupImageComment'],\n    '0410': ['SQ', '1', 'MotionSynchronizationSequence'],\n    '0412': ['FL', '3', 'ControlPointOrientation'],\n    '0420': ['SQ', '1', 'GeneralAccessorySequence'],\n    '0421': ['SH', '1', 'GeneralAccessoryID'],\n    '0422': ['ST', '1', 'GeneralAccessoryDescription'],\n    '0423': ['CS', '1', 'GeneralAccessoryType'],\n    '0424': ['IS', '1', 'GeneralAccessoryNumber'],\n    '0425': ['FL', '1', 'SourceToGeneralAccessoryDistance'],\n    '0426': ['DS', '1', 'IsocenterToGeneralAccessoryDistance'],\n    '0431': ['SQ', '1', 'ApplicatorGeometrySequence'],\n    '0432': ['CS', '1', 'ApplicatorApertureShape'],\n    '0433': ['FL', '1', 'ApplicatorOpening'],\n    '0434': ['FL', '1', 'ApplicatorOpeningX'],\n    '0435': ['FL', '1', 'ApplicatorOpeningY'],\n    '0436': ['FL', '1', 'SourceToApplicatorMountingPositionDistance'],\n    '0440': ['IS', '1', 'NumberOfBlockSlabItems'],\n    '0441': ['SQ', '1', 'BlockSlabSequence'],\n    '0442': ['DS', '1', 'BlockSlabThickness'],\n    '0443': ['US', '1', 'BlockSlabNumber'],\n    '0450': ['SQ', '1', 'DeviceMotionControlSequence'],\n    '0451': ['CS', '1', 'DeviceMotionExecutionMode'],\n    '0452': ['CS', '1', 'DeviceMotionObservationMode'],\n    '0453': ['SQ', '1', 'DeviceMotionParameterCodeSequence'],\n    '0501': ['FL', '1', 'DistalDepthFraction'],\n    '0502': ['FL', '1', 'DistalDepth'],\n    '0503': ['FL', '2', 'NominalRangeModulationFractions'],\n    '0504': ['FL', '2', 'NominalRangeModulatedRegionDepths'],\n    '0505': ['SQ', '1', 'DepthDoseParametersSequence'],\n    '0506': ['SQ', '1', 'DeliveredDepthDoseParametersSequence'],\n    '0507': ['FL', '1', 'DeliveredDistalDepthFraction'],\n    '0508': ['FL', '1', 'DeliveredDistalDepth'],\n    '0509': ['FL', '2', 'DeliveredNominalRangeModulationFractions'],\n    '0510': ['FL', '2', 'DeliveredNominalRangeModulatedRegionDepths'],\n    '0511': ['CS', '1', 'DeliveredReferenceDoseDefinition'],\n    '0512': ['CS', '1', 'ReferenceDoseDefinition'],\n    '0600': ['US', '1', 'RTControlPointIndex'],\n    '0601': ['US', '1', 'RadiationGenerationModeIndex'],\n    '0602': ['US', '1', 'ReferencedDefinedDeviceIndex'],\n    '0603': ['US', '1', 'RadiationDoseIdentificationIndex'],\n    '0604': ['US', '1', 'NumberOfRTControlPoints'],\n    '0605': ['US', '1', 'ReferencedRadiationGenerationModeIndex'],\n    '0606': ['US', '1', 'TreatmentPositionIndex'],\n    '0607': ['US', '1', 'ReferencedDeviceIndex'],\n    '0608': ['LO', '1', 'TreatmentPositionGroupLabel'],\n    '0609': ['UI', '1', 'TreatmentPositionGroupUID'],\n    '060A': ['SQ', '1', 'TreatmentPositionGroupSequence'],\n    '060B': ['US', '1', 'ReferencedTreatmentPositionIndex'],\n    '060C': ['US', '1', 'ReferencedRadiationDoseIdentificationIndex'],\n    '060D': ['FD', '1', 'RTAccessoryHolderWaterEquivalentThickness'],\n    '060E': ['US', '1', 'ReferencedRTAccessoryHolderDeviceIndex'],\n    '060F': ['CS', '1', 'RTAccessoryHolderSlotExistenceFlag'],\n    '0610': ['SQ', '1', 'RTAccessoryHolderSlotSequence'],\n    '0611': ['LO', '1', 'RTAccessoryHolderSlotID'],\n    '0612': ['FD', '1', 'RTAccessoryHolderSlotDistance'],\n    '0613': ['FD', '1', 'RTAccessorySlotDistance'],\n    '0614': ['SQ', '1', 'RTAccessoryHolderDefinitionSequence'],\n    '0615': ['LO', '1', 'RTAccessoryDeviceSlotID'],\n    '0616': ['SQ', '1', 'RTRadiationSequence'],\n    '0617': ['SQ', '1', 'RadiationDoseSequence'],\n    '0618': ['SQ', '1', 'RadiationDoseIdentificationSequence'],\n    '0619': ['LO', '1', 'RadiationDoseIdentificationLabel'],\n    '061A': ['CS', '1', 'ReferenceDoseType'],\n    '061B': ['CS', '1', 'PrimaryDoseValueIndicator'],\n    '061C': ['SQ', '1', 'DoseValuesSequence'],\n    '061D': ['CS', '1-n', 'DoseValuePurpose'],\n    '061E': ['FD', '3', 'ReferenceDosePointCoordinates'],\n    '061F': ['SQ', '1', 'RadiationDoseValuesParametersSequence'],\n    '0620': ['SQ', '1', 'MetersetToDoseMappingSequence'],\n    '0621': ['SQ', '1', 'ExpectedInVivoMeasurementValuesSequence'],\n    '0622': ['US', '1', 'ExpectedInVivoMeasurementValueIndex'],\n    '0623': ['LO', '1', 'RadiationDoseInVivoMeasurementLabel'],\n    '0624': ['FD', '2', 'RadiationDoseCentralAxisDisplacement'],\n    '0625': ['FD', '1', 'RadiationDoseValue'],\n    '0626': ['FD', '1', 'RadiationDoseSourceToSkinDistance'],\n    '0627': ['FD', '3', 'RadiationDoseMeasurementPointCoordinates'],\n    '0628': ['FD', '1', 'RadiationDoseSourceToExternalContourDistance'],\n    '0629': ['SQ', '1', 'RTToleranceSetSequence'],\n    '062A': ['LO', '1', 'RTToleranceSetLabel'],\n    '062B': ['SQ', '1', 'AttributeToleranceValuesSequence'],\n    '062C': ['FD', '1', 'ToleranceValue'],\n    '062D': ['SQ', '1', 'PatientSupportPositionToleranceSequence'],\n    '062E': ['FD', '1', 'TreatmentTimeLimit'],\n    '062F': ['SQ', '1', 'CArmPhotonElectronControlPointSequence'],\n    '0630': ['SQ', '1', 'ReferencedRTRadiationSequence'],\n    '0631': ['SQ', '1', 'ReferencedRTInstanceSequence'],\n    '0632': ['SQ', '1', 'ReferencedRTPatientSetupSequence'],\n    '0634': ['FD', '1', 'SourceToPatientSurfaceDistance'],\n    '0635': ['SQ', '1', 'TreatmentMachineSpecialModeCodeSequence'],\n    '0636': ['US', '1', 'IntendedNumberOfFractions'],\n    '0637': ['CS', '1', 'RTRadiationSetIntent'],\n    '0638': ['CS', '1', 'RTRadiationPhysicalAndGeometricContentDetailFlag'],\n    '0639': ['CS', '1', 'RTRecordFlag'],\n    '063A': ['SQ', '1', 'TreatmentDeviceIdentificationSequence'],\n    '063B': ['SQ', '1', 'ReferencedRTPhysicianIntentSequence'],\n    '063C': ['FD', '1', 'CumulativeMeterset'],\n    '063D': ['FD', '1', 'DeliveryRate'],\n    '063E': ['SQ', '1', 'DeliveryRateUnitSequence'],\n    '063F': ['SQ', '1', 'TreatmentPositionSequence'],\n    '0640': ['FD', '1', 'RadiationSourceAxisDistance'],\n    '0641': ['US', '1', 'NumberOfRTBeamLimitingDevices'],\n    '0642': ['FD', '1', 'RTBeamLimitingDeviceProximalDistance'],\n    '0643': ['FD', '1', 'RTBeamLimitingDeviceDistalDistance'],\n    '0644': ['SQ', '1', 'ParallelRTBeamDelimiterDeviceOrientationLabelCodeSequence'],\n    '0645': ['FD', '1', 'BeamModifierOrientationAngle'],\n    '0646': ['SQ', '1', 'FixedRTBeamDelimiterDeviceSequence'],\n    '0647': ['SQ', '1', 'ParallelRTBeamDelimiterDeviceSequence'],\n    '0648': ['US', '1', 'NumberOfParallelRTBeamDelimiters'],\n    '0649': ['FD', '2-n', 'ParallelRTBeamDelimiterBoundaries'],\n    '064A': ['FD', '2-n', 'ParallelRTBeamDelimiterPositions'],\n    '064B': ['FD', '2', 'RTBeamLimitingDeviceOffset'],\n    '064C': ['SQ', '1', 'RTBeamDelimiterGeometrySequence'],\n    '064D': ['SQ', '1', 'RTBeamLimitingDeviceDefinitionSequence'],\n    '064E': ['CS', '1', 'ParallelRTBeamDelimiterOpeningMode'],\n    '064F': ['CS', '1-n', 'ParallelRTBeamDelimiterLeafMountingSide'],\n    '0650': ['UI', '1', 'PatientSetupUID'],\n    '0651': ['SQ', '1', 'WedgeDefinitionSequence'],\n    '0652': ['FD', '1', 'RadiationBeamWedgeAngle'],\n    '0653': ['FD', '1', 'RadiationBeamWedgeThinEdgeDistance'],\n    '0654': ['FD', '1', 'RadiationBeamEffectiveWedgeAngle'],\n    '0655': ['US', '1', 'NumberOfWedgePositions'],\n    '0656': ['SQ', '1', 'RTBeamLimitingDeviceOpeningSequence'],\n    '0657': ['US', '1', 'NumberOfRTBeamLimitingDeviceOpenings'],\n    '0658': ['SQ', '1', 'RadiationDosimeterUnitSequence'],\n    '0659': ['SQ', '1', 'RTDeviceDistanceReferenceLocationCodeSequence'],\n    '065A': ['SQ', '1', 'RadiationDeviceConfigurationAndCommissioningKeySequence'],\n    '065B': ['SQ', '1', 'PatientSupportPositionParameterSequence'],\n    '065C': ['CS', '1', 'PatientSupportPositionSpecificationMethod'],\n    '065D': ['SQ', '1', 'PatientSupportPositionDeviceParameterSequence'],\n    '065E': ['US', '1', 'DeviceOrderIndex'],\n    '065F': ['US', '1', 'PatientSupportPositionParameterOrderIndex'],\n    '0660': ['SQ', '1', 'PatientSupportPositionDeviceToleranceSequence'],\n    '0661': ['US', '1', 'PatientSupportPositionToleranceOrderIndex'],\n    '0662': ['SQ', '1', 'CompensatorDefinitionSequence'],\n    '0663': ['CS', '1', 'CompensatorMapOrientation'],\n    '0664': ['OF', '1', 'CompensatorProximalThicknessMap'],\n    '0665': ['OF', '1', 'CompensatorDistalThicknessMap'],\n    '0666': ['FD', '1', 'CompensatorBasePlaneOffset'],\n    '0667': ['SQ', '1', 'CompensatorShapeFabricationCodeSequence'],\n    '0668': ['SQ', '1', 'CompensatorShapeSequence'],\n    '0669': ['FD', '1', 'RadiationBeamCompensatorMillingToolDiameter'],\n    '066A': ['SQ', '1', 'BlockDefinitionSequence'],\n    '066B': ['OF', '1', 'BlockEdgeData'],\n    '066C': ['CS', '1', 'BlockOrientation'],\n    '066D': ['FD', '1', 'RadiationBeamBlockThickness'],\n    '066E': ['FD', '1', 'RadiationBeamBlockSlabThickness'],\n    '066F': ['SQ', '1', 'BlockEdgeDataSequence'],\n    '0670': ['US', '1', 'NumberOfRTAccessoryHolders'],\n    '0671': ['SQ', '1', 'GeneralAccessoryDefinitionSequence'],\n    '0672': ['US', '1', 'NumberOfGeneralAccessories'],\n    '0673': ['SQ', '1', 'BolusDefinitionSequence'],\n    '0674': ['US', '1', 'NumberOfBoluses'],\n    '0675': ['UI', '1', 'EquipmentFrameOfReferenceUID'],\n    '0676': ['ST', '1', 'EquipmentFrameOfReferenceDescription'],\n    '0677': ['SQ', '1', 'EquipmentReferencePointCoordinatesSequence'],\n    '0678': ['SQ', '1', 'EquipmentReferencePointCodeSequence'],\n    '0679': ['FD', '1', 'RTBeamLimitingDeviceAngle'],\n    '067A': ['FD', '1', 'SourceRollAngle'],\n    '067B': ['SQ', '1', 'RadiationGenerationModeSequence'],\n    '067C': ['SH', '1', 'RadiationGenerationModeLabel'],\n    '067D': ['ST', '1', 'RadiationGenerationModeDescription'],\n    '067E': ['SQ', '1', 'RadiationGenerationModeMachineCodeSequence'],\n    '067F': ['SQ', '1', 'RadiationTypeCodeSequence'],\n    '0680': ['DS', '1', 'NominalEnergy'],\n    '0681': ['DS', '1', 'MinimumNominalEnergy'],\n    '0682': ['DS', '1', 'MaximumNominalEnergy'],\n    '0683': ['SQ', '1', 'RadiationFluenceModifierCodeSequence'],\n    '0684': ['SQ', '1', 'EnergyUnitCodeSequence'],\n    '0685': ['US', '1', 'NumberOfRadiationGenerationModes'],\n    '0686': ['SQ', '1', 'PatientSupportDevicesSequence'],\n    '0687': ['US', '1', 'NumberOfPatientSupportDevices'],\n    '0688': ['FD', '1', 'RTBeamModifierDefinitionDistance'],\n    '0689': ['SQ', '1', 'BeamAreaLimitSequence'],\n    '068A': ['SQ', '1', 'ReferencedRTPrescriptionSequence'],\n    '0700': ['UI', '1', 'TreatmentSessionUID'],\n    '0701': ['CS', '1', 'RTRadiationUsage'],\n    '0702': ['SQ', '1', 'ReferencedRTRadiationSetSequence'],\n    '0703': ['SQ', '1', 'ReferencedRTRadiationRecordSequence'],\n    '0704': ['US', '1', 'RTRadiationSetDeliveryNumber'],\n    '0705': ['US', '1', 'ClinicalFractionNumber'],\n    '0706': ['CS', '1', 'RTTreatmentFractionCompletionStatus'],\n    '0707': ['CS', '1', 'RTRadiationSetUsage'],\n    '0708': ['CS', '1', 'TreatmentDeliveryContinuationFlag'],\n    '0709': ['CS', '1', 'TreatmentRecordContentOrigin'],\n    '0714': ['CS', '1', 'RTTreatmentTerminationStatus'],\n    '0715': ['SQ', '1', 'RTTreatmentTerminationReasonCodeSequence'],\n    '0716': ['SQ', '1', 'MachineSpecificTreatmentTerminationCodeSequence'],\n    '0722': ['SQ', '1', 'RTRadiationSalvageRecordControlPointSequence'],\n    '0723': ['CS', '1', 'StartingMetersetValueKnownFlag'],\n    '0730': ['ST', '1', 'TreatmentTerminationDescription'],\n    '0731': ['SQ', '1', 'TreatmentToleranceViolationSequence'],\n    '0732': ['CS', '1', 'TreatmentToleranceViolationCategory'],\n    '0733': ['SQ', '1', 'TreatmentToleranceViolationAttributeSequence'],\n    '0734': ['ST', '1', 'TreatmentToleranceViolationDescription'],\n    '0735': ['ST', '1', 'TreatmentToleranceViolationIdentification'],\n    '0736': ['DT', '1', 'TreatmentToleranceViolationDateTime'],\n    '073A': ['DT', '1', 'RecordedRTControlPointDateTime'],\n    '073B': ['US', '1', 'ReferencedRadiationRTControlPointIndex'],\n    '073E': ['SQ', '1', 'AlternateValueSequence'],\n    '073F': ['SQ', '1', 'ConfirmationSequence'],\n    '0740': ['SQ', '1', 'InterlockSequence'],\n    '0741': ['DT', '1', 'InterlockDateTime'],\n    '0742': ['ST', '1', 'InterlockDescription'],\n    '0743': ['SQ', '1', 'InterlockOriginatingDeviceSequence'],\n    '0744': ['SQ', '1', 'InterlockCodeSequence'],\n    '0745': ['SQ', '1', 'InterlockResolutionCodeSequence'],\n    '0746': ['SQ', '1', 'InterlockResolutionUserSequence'],\n    '0760': ['DT', '1', 'OverrideDateTime'],\n    '0761': ['SQ', '1', 'TreatmentToleranceViolationTypeCodeSequence'],\n    '0762': ['SQ', '1', 'TreatmentToleranceViolationCauseCodeSequence'],\n    '0772': ['SQ', '1', 'MeasuredMetersetToDoseMappingSequence'],\n    '0773': ['US', '1', 'ReferencedExpectedInVivoMeasurementValueIndex'],\n    '0774': ['SQ', '1', 'DoseMeasurementDeviceCodeSequence'],\n    '0780': ['SQ', '1', 'AdditionalParameterRecordingInstanceSequence'],\n    '0782': ['US', '1', ''],\n    '0783': ['ST', '1', 'InterlockOriginDescription'],\n    '0784': ['SQ', '1', 'RTPatientPositionScopeSequence'],\n    '0785': ['UI', '1', 'ReferencedTreatmentPositionGroupUID'],\n    '0786': ['US', '1', 'RadiationOrderIndex'],\n    '0787': ['SQ', '1', 'OmittedRadiationSequence'],\n    '0788': ['SQ', '1', 'ReasonForOmissionCodeSequence'],\n    '0789': ['SQ', '1', 'RTDeliveryStartPatientPositionSequence'],\n    '078A': ['SQ', '1', 'RTTreatmentPreparationPatientPositionSequence'],\n    '078B': ['SQ', '1', 'ReferencedRTTreatmentPreparationSequence'],\n    '078C': ['SQ', '1', 'ReferencedPatientSetupPhotoSequence'],\n    '078D': ['SQ', '1', 'PatientTreatmentPreparationMethodCodeSequence'],\n    '078E': ['LT', '1', 'PatientTreatmentPreparationProcedureParameterDescription'],\n    '078F': ['SQ', '1', 'PatientTreatmentPreparationDeviceSequence'],\n    '0790': ['SQ', '1', 'PatientTreatmentPreparationProcedureSequence'],\n    '0791': ['SQ', '1', 'PatientTreatmentPreparationProcedureCodeSequence'],\n    '0792': ['LT', '1', 'PatientTreatmentPreparationMethodDescription'],\n    '0793': ['SQ', '1', 'PatientTreatmentPreparationProcedureParameterSequence'],\n    '0794': ['LT', '1', 'PatientSetupPhotoDescription'],\n    '0795': ['US', '1', 'PatientTreatmentPreparationProcedureIndex'],\n    '0796': ['US', '1', 'ReferencedPatientSetupProcedureIndex'],\n    '0797': ['SQ', '1', 'RTRadiationTaskSequence'],\n    '0798': ['SQ', '1', 'RTPatientPositionDisplacementSequence'],\n    '0799': ['SQ', '1', 'RTPatientPositionSequence'],\n    '079A': ['LO', '1', 'DisplacementReferenceLabel'],\n    '079B': ['FD', '16', 'DisplacementMatrix'],\n    '079C': ['SQ', '1', 'PatientSupportDisplacementSequence'],\n    '079D': ['SQ', '1', 'DisplacementReferenceLocationCodeSequence'],\n    '079E': ['CS', '1', 'RTRadiationSetDeliveryUsage']\n  },\n  '300C': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0002': ['SQ', '1', 'ReferencedRTPlanSequence'],\n    '0004': ['SQ', '1', 'ReferencedBeamSequence'],\n    '0006': ['IS', '1', 'ReferencedBeamNumber'],\n    '0007': ['IS', '1', 'ReferencedReferenceImageNumber'],\n    '0008': ['DS', '1', 'StartCumulativeMetersetWeight'],\n    '0009': ['DS', '1', 'EndCumulativeMetersetWeight'],\n    '000A': ['SQ', '1', 'ReferencedBrachyApplicationSetupSequence'],\n    '000C': ['IS', '1', 'ReferencedBrachyApplicationSetupNumber'],\n    '000E': ['IS', '1', 'ReferencedSourceNumber'],\n    '0020': ['SQ', '1', 'ReferencedFractionGroupSequence'],\n    '0022': ['IS', '1', 'ReferencedFractionGroupNumber'],\n    '0040': ['SQ', '1', 'ReferencedVerificationImageSequence'],\n    '0042': ['SQ', '1', 'ReferencedReferenceImageSequence'],\n    '0050': ['SQ', '1', 'ReferencedDoseReferenceSequence'],\n    '0051': ['IS', '1', 'ReferencedDoseReferenceNumber'],\n    '0055': ['SQ', '1', 'BrachyReferencedDoseReferenceSequence'],\n    '0060': ['SQ', '1', 'ReferencedStructureSetSequence'],\n    '006A': ['IS', '1', 'ReferencedPatientSetupNumber'],\n    '0080': ['SQ', '1', 'ReferencedDoseSequence'],\n    '00A0': ['IS', '1', 'ReferencedToleranceTableNumber'],\n    '00B0': ['SQ', '1', 'ReferencedBolusSequence'],\n    '00C0': ['IS', '1', 'ReferencedWedgeNumber'],\n    '00D0': ['IS', '1', 'ReferencedCompensatorNumber'],\n    '00E0': ['IS', '1', 'ReferencedBlockNumber'],\n    '00F0': ['IS', '1', 'ReferencedControlPointIndex'],\n    '00F2': ['SQ', '1', 'ReferencedControlPointSequence'],\n    '00F4': ['IS', '1', 'ReferencedStartControlPointIndex'],\n    '00F6': ['IS', '1', 'ReferencedStopControlPointIndex'],\n    '0100': ['IS', '1', 'ReferencedRangeShifterNumber'],\n    '0102': ['IS', '1', 'ReferencedLateralSpreadingDeviceNumber'],\n    '0104': ['IS', '1', 'ReferencedRangeModulatorNumber'],\n    '0111': ['SQ', '1', 'OmittedBeamTaskSequence'],\n    '0112': ['CS', '1', 'ReasonForOmission'],\n    '0113': ['LO', '1', 'ReasonForOmissionDescription'],\n    '0114': ['SQ', '1', 'PrescriptionOverviewSequence'],\n    '0115': ['FL', '1', 'TotalPrescriptionDose'],\n    '0116': ['SQ', '1', 'PlanOverviewSequence'],\n    '0117': ['US', '1', 'PlanOverviewIndex'],\n    '0118': ['US', '1', 'ReferencedPlanOverviewIndex'],\n    '0119': ['US', '1', 'NumberOfFractionsIncluded'],\n    '0120': ['SQ', '1', 'DoseCalibrationConditionsSequence'],\n    '0121': ['FD', '1', 'AbsorbedDoseToMetersetRatio'],\n    '0122': ['FD', '2', 'DelineatedRadiationFieldSize'],\n    '0123': ['CS', '1', 'DoseCalibrationConditionsVerifiedFlag'],\n    '0124': ['FD', '1', 'CalibrationReferencePointDepth'],\n    '0125': ['SQ', '1', 'GatingBeamHoldTransitionSequence'],\n    '0126': ['CS', '1', 'BeamHoldTransition'],\n    '0127': ['DT', '1', 'BeamHoldTransitionDateTime'],\n    '0128': ['SQ', '1', 'BeamHoldOriginatingDeviceSequence']\n  },\n  '300E': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0002': ['CS', '1', 'ApprovalStatus'],\n    '0004': ['DA', '1', 'ReviewDate'],\n    '0005': ['TM', '1', 'ReviewTime'],\n    '0008': ['PN', '1', 'ReviewerName']\n  },\n  '3010': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['SQ', '1', 'RadiobiologicalDoseEffectSequence'],\n    '0002': ['CS', '1', 'RadiobiologicalDoseEffectFlag'],\n    '0003': ['SQ', '1', 'EffectiveDoseCalculationMethodCategoryCodeSequence'],\n    '0004': ['SQ', '1', 'EffectiveDoseCalculationMethodCodeSequence'],\n    '0005': ['LO', '1', 'EffectiveDoseCalculationMethodDescription'],\n    '0006': ['UI', '1', 'ConceptualVolumeUID'],\n    '0007': ['SQ', '1', 'OriginatingSOPInstanceReferenceSequence'],\n    '0008': ['SQ', '1', 'ConceptualVolumeConstituentSequence'],\n    '0009': ['SQ', '1', 'EquivalentConceptualVolumeInstanceReferenceSequence'],\n    '000A': ['SQ', '1', 'EquivalentConceptualVolumesSequence'],\n    '000B': ['UI', '1', 'ReferencedConceptualVolumeUID'],\n    '000C': ['UT', '1', 'ConceptualVolumeCombinationExpression'],\n    '000D': ['US', '1', 'ConceptualVolumeConstituentIndex'],\n    '000E': ['CS', '1', 'ConceptualVolumeCombinationFlag'],\n    '000F': ['ST', '1', 'ConceptualVolumeCombinationDescription'],\n    '0010': ['CS', '1', 'ConceptualVolumeSegmentationDefinedFlag'],\n    '0011': ['SQ', '1', 'ConceptualVolumeSegmentationReferenceSequence'],\n    '0012': ['SQ', '1', 'ConceptualVolumeConstituentSegmentationReferenceSequence'],\n    '0013': ['UI', '1', 'ConstituentConceptualVolumeUID'],\n    '0014': ['SQ', '1', 'DerivationConceptualVolumeSequence'],\n    '0015': ['UI', '1', 'SourceConceptualVolumeUID'],\n    '0016': ['SQ', '1', 'ConceptualVolumeDerivationAlgorithmSequence'],\n    '0017': ['ST', '1', 'ConceptualVolumeDescription'],\n    '0018': ['SQ', '1', 'SourceConceptualVolumeSequence'],\n    '0019': ['SQ', '1', 'AuthorIdentificationSequence'],\n    '001A': ['LO', '1', 'ManufacturerModelVersion'],\n    '001B': ['UC', '1', 'DeviceAlternateIdentifier'],\n    '001C': ['CS', '1', 'DeviceAlternateIdentifierType'],\n    '001D': ['LT', '1', 'DeviceAlternateIdentifierFormat'],\n    '001E': ['LO', '1', 'SegmentationCreationTemplateLabel'],\n    '001F': ['UI', '1', 'SegmentationTemplateUID'],\n    '0020': ['US', '1', 'ReferencedSegmentReferenceIndex'],\n    '0021': ['SQ', '1', 'SegmentReferenceSequence'],\n    '0022': ['US', '1', 'SegmentReferenceIndex'],\n    '0023': ['SQ', '1', 'DirectSegmentReferenceSequence'],\n    '0024': ['SQ', '1', 'CombinationSegmentReferenceSequence'],\n    '0025': ['SQ', '1', 'ConceptualVolumeSequence'],\n    '0026': ['SQ', '1', 'SegmentedRTAccessoryDeviceSequence'],\n    '0027': ['SQ', '1', 'SegmentCharacteristicsSequence'],\n    '0028': ['SQ', '1', 'RelatedSegmentCharacteristicsSequence'],\n    '0029': ['US', '1', 'SegmentCharacteristicsPrecedence'],\n    '002A': ['SQ', '1', 'RTSegmentAnnotationSequence'],\n    '002B': ['SQ', '1', 'SegmentAnnotationCategoryCodeSequence'],\n    '002C': ['SQ', '1', 'SegmentAnnotationTypeCodeSequence'],\n    '002D': ['LO', '1', 'DeviceLabel'],\n    '002E': ['SQ', '1', 'DeviceTypeCodeSequence'],\n    '002F': ['SQ', '1', 'SegmentAnnotationTypeModifierCodeSequence'],\n    '0030': ['SQ', '1', 'PatientEquipmentRelationshipCodeSequence'],\n    '0031': ['UI', '1', 'ReferencedFiducialsUID'],\n    '0032': ['SQ', '1', 'PatientTreatmentOrientationSequence'],\n    '0033': ['SH', '1', 'UserContentLabel'],\n    '0034': ['LO', '1', 'UserContentLongLabel'],\n    '0035': ['SH', '1', 'EntityLabel'],\n    '0036': ['LO', '1', 'EntityName'],\n    '0037': ['ST', '1', 'EntityDescription'],\n    '0038': ['LO', '1', 'EntityLongLabel'],\n    '0039': ['US', '1', 'DeviceIndex'],\n    '003A': ['US', '1', 'RTTreatmentPhaseIndex'],\n    '003B': ['UI', '1', 'RTTreatmentPhaseUID'],\n    '003C': ['US', '1', 'RTPrescriptionIndex'],\n    '003D': ['US', '1', 'RTSegmentAnnotationIndex'],\n    '003E': ['US', '1', 'BasisRTTreatmentPhaseIndex'],\n    '003F': ['US', '1', 'RelatedRTTreatmentPhaseIndex'],\n    '0040': ['US', '1', 'ReferencedRTTreatmentPhaseIndex'],\n    '0041': ['US', '1', 'ReferencedRTPrescriptionIndex'],\n    '0042': ['US', '1', 'ReferencedParentRTPrescriptionIndex'],\n    '0043': ['ST', '1', 'ManufacturerDeviceIdentifier'],\n    '0044': ['SQ', '1', 'InstanceLevelReferencedPerformedProcedureStepSequence'],\n    '0045': ['CS', '1', 'RTTreatmentPhaseIntentPresenceFlag'],\n    '0046': ['CS', '1', 'RadiotherapyTreatmentType'],\n    '0047': ['CS', '1-n', 'TeletherapyRadiationType'],\n    '0048': ['CS', '1-n', 'BrachytherapySourceType'],\n    '0049': ['SQ', '1', 'ReferencedRTTreatmentPhaseSequence'],\n    '004A': ['SQ', '1', 'ReferencedDirectSegmentInstanceSequence'],\n    '004B': ['SQ', '1', 'IntendedRTTreatmentPhaseSequence'],\n    '004C': ['DA', '1', 'IntendedPhaseStartDate'],\n    '004D': ['DA', '1', 'IntendedPhaseEndDate'],\n    '004E': ['SQ', '1', 'RTTreatmentPhaseIntervalSequence'],\n    '004F': ['CS', '1', 'TemporalRelationshipIntervalAnchor'],\n    '0050': ['FD', '1', 'MinimumNumberOfIntervalDays'],\n    '0051': ['FD', '1', 'MaximumNumberOfIntervalDays'],\n    '0052': ['UI', '1-n', 'PertinentSOPClassesInStudy'],\n    '0053': ['UI', '1-n', 'PertinentSOPClassesInSeries'],\n    '0054': ['LO', '1', 'RTPrescriptionLabel'],\n    '0055': ['SQ', '1', 'RTPhysicianIntentPredecessorSequence'],\n    '0056': ['LO', '1', 'RTTreatmentApproachLabel'],\n    '0057': ['SQ', '1', 'RTPhysicianIntentSequence'],\n    '0058': ['US', '1', 'RTPhysicianIntentIndex'],\n    '0059': ['CS', '1', 'RTTreatmentIntentType'],\n    '005A': ['UT', '1', 'RTPhysicianIntentNarrative'],\n    '005B': ['SQ', '1', 'RTProtocolCodeSequence'],\n    '005C': ['ST', '1', 'ReasonForSuperseding'],\n    '005D': ['SQ', '1', 'RTDiagnosisCodeSequence'],\n    '005E': ['US', '1', 'ReferencedRTPhysicianIntentIndex'],\n    '005F': ['SQ', '1', 'RTPhysicianIntentInputInstanceSequence'],\n    '0060': ['SQ', '1', 'RTAnatomicPrescriptionSequence'],\n    '0061': ['UT', '1', 'PriorTreatmentDoseDescription'],\n    '0062': ['SQ', '1', 'PriorTreatmentReferenceSequence'],\n    '0063': ['CS', '1', 'DosimetricObjectiveEvaluationScope'],\n    '0064': ['SQ', '1', 'TherapeuticRoleCategoryCodeSequence'],\n    '0065': ['SQ', '1', 'TherapeuticRoleTypeCodeSequence'],\n    '0066': ['US', '1', 'ConceptualVolumeOptimizationPrecedence'],\n    '0067': ['SQ', '1', 'ConceptualVolumeCategoryCodeSequence'],\n    '0068': ['CS', '1', 'ConceptualVolumeBlockingConstraint'],\n    '0069': ['SQ', '1', 'ConceptualVolumeTypeCodeSequence'],\n    '006A': ['SQ', '1', 'ConceptualVolumeTypeModifierCodeSequence'],\n    '006B': ['SQ', '1', 'RTPrescriptionSequence'],\n    '006C': ['SQ', '1', 'DosimetricObjectiveSequence'],\n    '006D': ['SQ', '1', 'DosimetricObjectiveTypeCodeSequence'],\n    '006E': ['UI', '1', 'DosimetricObjectiveUID'],\n    '006F': ['UI', '1', 'ReferencedDosimetricObjectiveUID'],\n    '0070': ['SQ', '1', 'DosimetricObjectiveParameterSequence'],\n    '0071': ['SQ', '1', 'ReferencedDosimetricObjectivesSequence'],\n    '0073': ['CS', '1', 'AbsoluteDosimetricObjectiveFlag'],\n    '0074': ['FD', '1', 'DosimetricObjectiveWeight'],\n    '0075': ['CS', '1', 'DosimetricObjectivePurpose'],\n    '0076': ['SQ', '1', 'PlanningInputInformationSequence'],\n    '0077': ['LO', '1', 'TreatmentSite'],\n    '0078': ['SQ', '1', 'TreatmentSiteCodeSequence'],\n    '0079': ['SQ', '1', 'FractionPatternSequence'],\n    '007A': ['UT', '1', 'TreatmentTechniqueNotes'],\n    '007B': ['UT', '1', 'PrescriptionNotes'],\n    '007C': ['IS', '1', 'NumberOfIntervalFractions'],\n    '007D': ['US', '1', 'NumberOfFractions'],\n    '007E': ['US', '1', 'IntendedDeliveryDuration'],\n    '007F': ['UT', '1', 'FractionationNotes'],\n    '0080': ['SQ', '1', 'RTTreatmentTechniqueCodeSequence'],\n    '0081': ['SQ', '1', 'PrescriptionNotesSequence'],\n    '0082': ['SQ', '1', 'FractionBasedRelationshipSequence'],\n    '0083': ['CS', '1', 'FractionBasedRelationshipIntervalAnchor'],\n    '0084': ['FD', '1', 'MinimumHoursBetweenFractions'],\n    '0085': ['TM', '1-n', 'IntendedFractionStartTime'],\n    '0086': ['LT', '1', 'IntendedStartDayOfWeek'],\n    '0087': ['SQ', '1', 'WeekdayFractionPatternSequence'],\n    '0088': ['SQ', '1', 'DeliveryTimeStructureCodeSequence'],\n    '0089': ['SQ', '1', 'TreatmentSiteModifierCodeSequence'],\n    '0090': ['CS', '1', 'RoboticBaseLocationIndicator'],\n    '0091': ['SQ', '1', 'RoboticPathNodeSetCodeSequence'],\n    '0092': ['UL', '1', 'RoboticNodeIdentifier'],\n    '0093': ['FD', '3', 'RTTreatmentSourceCoordinates'],\n    '0094': ['FD', '1', 'RadiationSourceCoordinateSystemYawAngle'],\n    '0095': ['FD', '1', 'RadiationSourceCoordinateSystemRollAngle'],\n    '0096': ['FD', '1', 'RadiationSourceCoordinateSystemPitchAngle'],\n    '0097': ['SQ', '1', 'RoboticPathControlPointSequence'],\n    '0098': ['SQ', '1', 'TomotherapeuticControlPointSequence'],\n    '0099': ['FD', '1-n', 'TomotherapeuticLeafOpenDurations'],\n    '009A': ['FD', '1-n', 'TomotherapeuticLeafInitialClosedDurations']\n  },\n  '4000': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['LT', '1', 'Arbitrary'],\n    '4000': ['LT', '1', 'TextComments']\n  },\n  '4008': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0040': ['SH', '1', 'ResultsID'],\n    '0042': ['LO', '1', 'ResultsIDIssuer'],\n    '0050': ['SQ', '1', 'ReferencedInterpretationSequence'],\n    '00FF': ['CS', '1', 'ReportProductionStatusTrial'],\n    '0100': ['DA', '1', 'InterpretationRecordedDate'],\n    '0101': ['TM', '1', 'InterpretationRecordedTime'],\n    '0102': ['PN', '1', 'InterpretationRecorder'],\n    '0103': ['LO', '1', 'ReferenceToRecordedSound'],\n    '0108': ['DA', '1', 'InterpretationTranscriptionDate'],\n    '0109': ['TM', '1', 'InterpretationTranscriptionTime'],\n    '010A': ['PN', '1', 'InterpretationTranscriber'],\n    '010B': ['ST', '1', 'InterpretationText'],\n    '010C': ['PN', '1', 'InterpretationAuthor'],\n    '0111': ['SQ', '1', 'InterpretationApproverSequence'],\n    '0112': ['DA', '1', 'InterpretationApprovalDate'],\n    '0113': ['TM', '1', 'InterpretationApprovalTime'],\n    '0114': ['PN', '1', 'PhysicianApprovingInterpretation'],\n    '0115': ['LT', '1', 'InterpretationDiagnosisDescription'],\n    '0117': ['SQ', '1', 'InterpretationDiagnosisCodeSequence'],\n    '0118': ['SQ', '1', 'ResultsDistributionListSequence'],\n    '0119': ['PN', '1', 'DistributionName'],\n    '011A': ['LO', '1', 'DistributionAddress'],\n    '0200': ['SH', '1', 'InterpretationID'],\n    '0202': ['LO', '1', 'InterpretationIDIssuer'],\n    '0210': ['CS', '1', 'InterpretationTypeID'],\n    '0212': ['CS', '1', 'InterpretationStatusID'],\n    '0300': ['ST', '1', 'Impressions'],\n    '4000': ['ST', '1', 'ResultsComments']\n  },\n  '4010': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['CS', '1', 'LowEnergyDetectors'],\n    '0002': ['CS', '1', 'HighEnergyDetectors'],\n    '0004': ['SQ', '1', 'DetectorGeometrySequence'],\n    '1001': ['SQ', '1', 'ThreatROIVoxelSequence'],\n    '1004': ['FL', '3', 'ThreatROIBase'],\n    '1005': ['FL', '3', 'ThreatROIExtents'],\n    '1006': ['OB', '1', 'ThreatROIBitmap'],\n    '1007': ['SH', '1', 'RouteSegmentID'],\n    '1008': ['CS', '1', 'GantryType'],\n    '1009': ['CS', '1', 'OOIOwnerType'],\n    '100A': ['SQ', '1', 'RouteSegmentSequence'],\n    '1010': ['US', '1', 'PotentialThreatObjectID'],\n    '1011': ['SQ', '1', 'ThreatSequence'],\n    '1012': ['CS', '1', 'ThreatCategory'],\n    '1013': ['LT', '1', 'ThreatCategoryDescription'],\n    '1014': ['CS', '1', 'ATDAbilityAssessment'],\n    '1015': ['CS', '1', 'ATDAssessmentFlag'],\n    '1016': ['FL', '1', 'ATDAssessmentProbability'],\n    '1017': ['FL', '1', 'Mass'],\n    '1018': ['FL', '1', 'Density'],\n    '1019': ['FL', '1', 'ZEffective'],\n    '101A': ['SH', '1', 'BoardingPassID'],\n    '101B': ['FL', '3', 'CenterOfMass'],\n    '101C': ['FL', '3', 'CenterOfPTO'],\n    '101D': ['FL', '6-n', 'BoundingPolygon'],\n    '101E': ['SH', '1', 'RouteSegmentStartLocationID'],\n    '101F': ['SH', '1', 'RouteSegmentEndLocationID'],\n    '1020': ['CS', '1', 'RouteSegmentLocationIDType'],\n    '1021': ['CS', '1-n', 'AbortReason'],\n    '1023': ['FL', '1', 'VolumeOfPTO'],\n    '1024': ['CS', '1', 'AbortFlag'],\n    '1025': ['DT', '1', 'RouteSegmentStartTime'],\n    '1026': ['DT', '1', 'RouteSegmentEndTime'],\n    '1027': ['CS', '1', 'TDRType'],\n    '1028': ['CS', '1', 'InternationalRouteSegment'],\n    '1029': ['LO', '1-n', 'ThreatDetectionAlgorithmAndVersion'],\n    '102A': ['SH', '1', 'AssignedLocation'],\n    '102B': ['DT', '1', 'AlarmDecisionTime'],\n    '1031': ['CS', '1', 'AlarmDecision'],\n    '1033': ['US', '1', 'NumberOfTotalObjects'],\n    '1034': ['US', '1', 'NumberOfAlarmObjects'],\n    '1037': ['SQ', '1', 'PTORepresentationSequence'],\n    '1038': ['SQ', '1', 'ATDAssessmentSequence'],\n    '1039': ['CS', '1', 'TIPType'],\n    '103A': ['CS', '1', 'DICOSVersion'],\n    '1041': ['DT', '1', 'OOIOwnerCreationTime'],\n    '1042': ['CS', '1', 'OOIType'],\n    '1043': ['FL', '3', 'OOISize'],\n    '1044': ['CS', '1', 'AcquisitionStatus'],\n    '1045': ['SQ', '1', 'BasisMaterialsCodeSequence'],\n    '1046': ['CS', '1', 'PhantomType'],\n    '1047': ['SQ', '1', 'OOIOwnerSequence'],\n    '1048': ['CS', '1', 'ScanType'],\n    '1051': ['LO', '1', 'ItineraryID'],\n    '1052': ['SH', '1', 'ItineraryIDType'],\n    '1053': ['LO', '1', 'ItineraryIDAssigningAuthority'],\n    '1054': ['SH', '1', 'RouteID'],\n    '1055': ['SH', '1', 'RouteIDAssigningAuthority'],\n    '1056': ['CS', '1', 'InboundArrivalType'],\n    '1058': ['SH', '1', 'CarrierID'],\n    '1059': ['CS', '1', 'CarrierIDAssigningAuthority'],\n    '1060': ['FL', '3', 'SourceOrientation'],\n    '1061': ['FL', '3', 'SourcePosition'],\n    '1062': ['FL', '1', 'BeltHeight'],\n    '1064': ['SQ', '1', 'AlgorithmRoutingCodeSequence'],\n    '1067': ['CS', '1', 'TransportClassification'],\n    '1068': ['LT', '1', 'OOITypeDescriptor'],\n    '1069': ['FL', '1', 'TotalProcessingTime'],\n    '106C': ['OB', '1', 'DetectorCalibrationData'],\n    '106D': ['CS', '1', 'AdditionalScreeningPerformed'],\n    '106E': ['CS', '1', 'AdditionalInspectionSelectionCriteria'],\n    '106F': ['SQ', '1', 'AdditionalInspectionMethodSequence'],\n    '1070': ['CS', '1', 'AITDeviceType'],\n    '1071': ['SQ', '1', 'QRMeasurementsSequence'],\n    '1072': ['SQ', '1', 'TargetMaterialSequence'],\n    '1073': ['FD', '1', 'SNRThreshold'],\n    '1075': ['DS', '1', 'ImageScaleRepresentation'],\n    '1076': ['SQ', '1', 'ReferencedPTOSequence'],\n    '1077': ['SQ', '1', 'ReferencedTDRInstanceSequence'],\n    '1078': ['ST', '1', 'PTOLocationDescription'],\n    '1079': ['SQ', '1', 'AnomalyLocatorIndicatorSequence'],\n    '107A': ['FL', '3', 'AnomalyLocatorIndicator'],\n    '107B': ['SQ', '1', 'PTORegionSequence'],\n    '107C': ['CS', '1', 'InspectionSelectionCriteria'],\n    '107D': ['SQ', '1', 'SecondaryInspectionMethodSequence'],\n    '107E': ['DS', '6', 'PRCSToRCSOrientation']\n  },\n  '4FFE': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['SQ', '1', 'MACParametersSequence']\n  },\n  '5000': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0005': ['US', '1', 'CurveDimensions'],\n    '0010': ['US', '1', 'NumberOfPoints'],\n    '0020': ['CS', '1', 'TypeOfData'],\n    '0022': ['LO', '1', 'CurveDescription'],\n    '0030': ['SH', '1-n', 'AxisUnits'],\n    '0040': ['SH', '1-n', 'AxisLabels'],\n    '0103': ['US', '1', 'DataValueRepresentation'],\n    '0104': ['US', '1-n', 'MinimumCoordinateValue'],\n    '0105': ['US', '1-n', 'MaximumCoordinateValue'],\n    '0106': ['SH', '1-n', 'CurveRange'],\n    '0110': ['US', '1-n', 'CurveDataDescriptor'],\n    '0112': ['US', '1-n', 'CoordinateStartValue'],\n    '0114': ['US', '1-n', 'CoordinateStepValue'],\n    '1001': ['CS', '1', 'CurveActivationLayer'],\n    '2000': ['US', '1', 'AudioType'],\n    '2002': ['US', '1', 'AudioSampleFormat'],\n    '2004': ['US', '1', 'NumberOfChannels'],\n    '2006': ['UL', '1', 'NumberOfSamples'],\n    '2008': ['UL', '1', 'SampleRate'],\n    '200A': ['UL', '1', 'TotalTime'],\n    '200C': ['ox', '1', 'AudioSampleData'],\n    '200E': ['LT', '1', 'AudioComments'],\n    '2500': ['LO', '1', 'CurveLabel'],\n    '2600': ['SQ', '1', 'CurveReferencedOverlaySequence'],\n    '2610': ['US', '1', 'CurveReferencedOverlayGroup'],\n    '3000': ['ox', '1', 'CurveData']\n  },\n  '5200': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '9229': ['SQ', '1', 'SharedFunctionalGroupsSequence'],\n    '9230': ['SQ', '1', 'PerFrameFunctionalGroupsSequence']\n  },\n  '5400': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0100': ['SQ', '1', 'WaveformSequence'],\n    '0110': ['ox', '1', 'ChannelMinimumValue'],\n    '0112': ['ox', '1', 'ChannelMaximumValue'],\n    '1004': ['US', '1', 'WaveformBitsAllocated'],\n    '1006': ['CS', '1', 'WaveformSampleInterpretation'],\n    '100A': ['ox', '1', 'WaveformPaddingValue'],\n    '1010': ['ox', '1', 'WaveformData']\n  },\n  '5600': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['OF', '1', 'FirstOrderPhaseCorrectionAngle'],\n    '0020': ['OF', '1', 'SpectroscopyData']\n  },\n  '6000': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['US', '1', 'OverlayRows'],\n    '0011': ['US', '1', 'OverlayColumns'],\n    '0012': ['US', '1', 'OverlayPlanes'],\n    '0015': ['IS', '1', 'NumberOfFramesInOverlay'],\n    '0022': ['LO', '1', 'OverlayDescription'],\n    '0040': ['CS', '1', 'OverlayType'],\n    '0045': ['LO', '1', 'OverlaySubtype'],\n    '0050': ['SS', '2', 'OverlayOrigin'],\n    '0051': ['US', '1', 'ImageFrameOrigin'],\n    '0052': ['US', '1', 'OverlayPlaneOrigin'],\n    '0060': ['CS', '1', 'OverlayCompressionCode'],\n    '0061': ['SH', '1', 'OverlayCompressionOriginator'],\n    '0062': ['SH', '1', 'OverlayCompressionLabel'],\n    '0063': ['CS', '1', 'OverlayCompressionDescription'],\n    '0066': ['AT', '1-n', 'OverlayCompressionStepPointers'],\n    '0068': ['US', '1', 'OverlayRepeatInterval'],\n    '0069': ['US', '1', 'OverlayBitsGrouped'],\n    '0100': ['US', '1', 'OverlayBitsAllocated'],\n    '0102': ['US', '1', 'OverlayBitPosition'],\n    '0110': ['CS', '1', 'OverlayFormat'],\n    '0200': ['US', '1', 'OverlayLocation'],\n    '0800': ['CS', '1-n', 'OverlayCodeLabel'],\n    '0802': ['US', '1', 'OverlayNumberOfTables'],\n    '0803': ['AT', '1-n', 'OverlayCodeTableLocation'],\n    '0804': ['US', '1', 'OverlayBitsForCodeWord'],\n    '1001': ['CS', '1', 'OverlayActivationLayer'],\n    '1100': ['US', '1', 'OverlayDescriptorGray'],\n    '1101': ['US', '1', 'OverlayDescriptorRed'],\n    '1102': ['US', '1', 'OverlayDescriptorGreen'],\n    '1103': ['US', '1', 'OverlayDescriptorBlue'],\n    '1200': ['US', '1-n', 'OverlaysGray'],\n    '1201': ['US', '1-n', 'OverlaysRed'],\n    '1202': ['US', '1-n', 'OverlaysGreen'],\n    '1203': ['US', '1-n', 'OverlaysBlue'],\n    '1301': ['IS', '1', 'ROIArea'],\n    '1302': ['DS', '1', 'ROIMean'],\n    '1303': ['DS', '1', 'ROIStandardDeviation'],\n    '1500': ['LO', '1', 'OverlayLabel'],\n    '3000': ['ox', '1', 'OverlayData'],\n    '4000': ['LT', '1', 'OverlayComments']\n  },\n  '7F00': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0010': ['ox', '1', 'VariablePixelData'],\n    '0011': ['US', '1', 'VariableNextDataGroup'],\n    '0020': ['OW', '1', 'VariableCoefficientsSDVN'],\n    '0030': ['OW', '1', 'VariableCoefficientsSDHN'],\n    '0040': ['OW', '1', 'VariableCoefficientsSDDN']\n  },\n  '7FE0': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    '0001': ['OV', '1', 'ExtendedOffsetTable'],\n    '0002': ['OV', '1', 'ExtendedOffsetTableLengths'],\n    '0008': ['OF', '1', 'FloatPixelData'],\n    '0009': ['OD', '1', 'DoubleFloatPixelData'],\n    '0010': ['ox', '1', 'PixelData'],\n    '0020': ['OW', '1', 'CoefficientsSDVN'],\n    '0030': ['OW', '1', 'CoefficientsSDHN'],\n    '0040': ['OW', '1', 'CoefficientsSDDN']\n  },\n  'FFFA': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    'FFFA': ['SQ', '1', 'DigitalSignaturesSequence']\n  },\n  'FFFC': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    'FFFC': ['OB', '1', 'DataSetTrailingPadding']\n  },\n  'FFFE': {\n    '0000': ['UL', '1', 'GenericGroupLength'],\n    'E000': ['NONE', '1', 'Item'],\n    'E00D': ['NONE', '1', 'ItemDelimitationItem'],\n    'E0DD': ['NONE', '1', 'SequenceDelimitationItem']\n  }\n}; // Dictionary\n\n/**\n * Add tags to the dictionary.\n *\n * @param {string} group The group key.\n * @param {Object<string, string[]>} tags The tags to add as an\n *   object indexed by element key with values as:\n *   [VR, multiplicity, TagName] (all strings).\n */\nexport function addTagsToDictionary(group, tags) {\n  // TODO: add checks!\n  dictionary[group] = tags;\n}\n\n/**\n * Tag groups: key to name pairs.\n * Copied from gdcm-2.6.1\\Source\\DataDictionary\\GroupName.dic\n * -> removed duplicates (commented).\n *\n * @type {Object<string, string>}\n */\nexport const tagGroups = {\n  '0000': 'Command',\n  '0002': 'Meta Element',\n  '0004': 'File Set',\n  //'0004': 'Directory',\n  '0008': 'Identifying',\n  '0009': 'SPI Identifying',\n  '0010': 'Patient',\n  '0012': 'Clinical Trial',\n  '0018': 'Acquisition',\n  '0019': 'SPI Acquisition',\n  '0020': 'Image',\n  '0021': 'SPI Image',\n  '0022': 'Ophtalmology',\n  '0028': 'Image Presentation',\n  '0032': 'Study',\n  '0038': 'Visit',\n  '003A': 'Waveform',\n  '0040': 'Procedure',\n  //'0040': ''Modality Worklist',\n  '0042': 'Encapsulated Document',\n  '0050': 'Device Informations',\n  //'0050': 'XRay Angio Device',\n  '0054': 'Nuclear Medicine',\n  '0060': 'Histogram',\n  '0070': 'Presentation State',\n  '0072': 'Hanging Protocol',\n  '0088': 'Storage',\n  //'0088': 'Medicine',\n  '0100': 'Authorization',\n  '0400': 'Digital Signature',\n  '1000': 'Code Table',\n  '1010': 'Zonal Map',\n  '2000': 'Film Session',\n  '2010': 'Film Box',\n  '2020': 'Image Box',\n  '2030': 'Annotation',\n  '2040': 'Overlay Box',\n  '2050': 'Presentation LUT',\n  '2100': 'Print Job',\n  '2110': 'Printer',\n  '2120': 'Queue',\n  '2130': 'Print Content',\n  '2200': 'Media Creation',\n  '3002': 'RT Image',\n  '3004': 'RT Dose',\n  '3006': 'RT StructureSet',\n  '3008': 'RT Treatment',\n  '300A': 'RT Plan',\n  '300C': 'RT Relationship',\n  '300E': 'RT Approval',\n  '4000': 'Text',\n  '4008': 'Results',\n  '4FFE': 'MAC Parameters',\n  '5000': 'Curve',\n  '5002': 'Curve',\n  '5004': 'Curve',\n  '5006': 'Curve',\n  '5008': 'Curve',\n  '500A': 'Curve',\n  '500C': 'Curve',\n  '500E': 'Curve',\n  '5400': 'Waveform Data',\n  '6000': 'Overlays',\n  '6002': 'Overlays',\n  '6004': 'Overlays',\n  '6008': 'Overlays',\n  '600A': 'Overlays',\n  '600C': 'Overlays',\n  '600E': 'Overlays',\n  'FFFC': 'Generic',\n  '7FE0': 'Pixel Data',\n  'FFFF': 'Unknown'\n};\n\n/**\n * List of Value Representation (VR) with 32bit Value Length (VL).\n *\n * Added locally used 'ox'.\n * See {@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/chapter_7.html#table_7.1-1}.\n *\n * @type {Object<string, boolean>}\n */\nconst vr32bitVL = {\n  OB: true,\n  OD: true,\n  OF: true,\n  OL: true,\n  OV: true,\n  OW: true,\n  SQ: true,\n  SV: true,\n  UC: true,\n  UN: true,\n  UR: true,\n  UT: true,\n  UV: true,\n  ox: true\n};\n\n/**\n * Does the input Value Representation (VR) have a 32bit Value Length (VL).\n *\n * @param {string} vr The data Value Representation (VR).\n * @returns {boolean} True if this VR has a 32-bit VL.\n */\nexport function is32bitVLVR(vr) {\n  return typeof vr32bitVL[vr] !== 'undefined';\n}\n\n/**\n * List of string VR with extended or replaced default character repertoire defined in\n *   Specific Character Set (0008,0005).\n *\n * See {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/chapter_6.html#sect_6.1.2.2}.\n *\n * @type {Object<string, boolean>}\n */\nconst vrCharSetString = {\n  SH: true,\n  LO: true,\n  UC: true,\n  ST: true,\n  LT: true,\n  UT: true,\n  PN: true\n};\n\n/**\n * Does the input Value Representation (VR) have an special character repertoire.\n *\n * @param {string} vr The data VR.\n * @returns {boolean} True if this VR has a special char set.\n */\nexport function isCharSetStringVR(vr) {\n  return typeof vrCharSetString[vr] !== 'undefined';\n}\n\n/**\n * VR equivalent javascript types.\n *\n * See {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/sect_6.2.html#table_6.2-1}.\n *\n * @type {Object<string, string>}\n */\nexport const vrTypes = {\n  AE: 'string',\n  AS: 'string',\n  AT: undefined,\n  CS: 'string',\n  DA: 'string',\n  DS: 'string',\n  DT: 'string',\n  FL: 'Float32',\n  FD: 'Float64',\n  IS: 'string',\n  LO: 'string',\n  LT: 'string',\n  OB: 'Uint8',\n  OD: 'Uint64',\n  OF: 'Uint32',\n  OL: 'Uint32',\n  OV: 'Uint64',\n  OW: 'Uint16',\n  PN: 'string',\n  SH: 'string',\n  SL: 'Int32',\n  SQ: undefined,\n  SS: 'Int16',\n  ST: 'string',\n  SV: 'Int64',\n  TM: 'string',\n  UC: 'string',\n  UI: 'string',\n  UL: 'Uint32',\n  UN: 'Uint8',\n  UR: 'string',\n  US: 'Uint16',\n  UT: 'string',\n  UV: 'Uint64'\n};\n\n/**\n * Transfer syntaxes.\n *\n * See {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part06/chapter_A.html#table_A-1}.\n *\n * @type {Object<string, string>}\n */\nexport const transferSyntaxes = {\n  '1.2.840.10008.1.2': 'Implicit VR Little Endian',\n  '1.2.840.10008.1.2.1': 'Explicit VR Little Endian',\n  '1.2.840.10008.1.2.1.98': 'Encapsulated Uncompressed Explicit VR Little Endian',\n  '1.2.840.10008.1.2.1.99': 'Deflated Explicit VR Little Endian',\n  '1.2.840.10008.1.2.2': 'Explicit VR Big Endian (Retired)',\n  '1.2.840.10008.1.2.4.50': 'JPEG Baseline (Process 1)',\n  '1.2.840.10008.1.2.4.51': 'JPEG Extended (Process 2 & 4)',\n  '1.2.840.10008.1.2.4.52': 'JPEG Extended (Process 3 & 5) (Retired)',\n  '1.2.840.10008.1.2.4.53': 'JPEG Spectral Selection, Non-Hierarchical (Process 6 & 8) (Retired)',\n  '1.2.840.10008.1.2.4.54': 'JPEG Spectral Selection, Non-Hierarchical (Process 7 & 9) (Retired)',\n  '1.2.840.10008.1.2.4.55': 'JPEG Full Progression, Non-Hierarchical (Process 10 & 12) (Retired)',\n  '1.2.840.10008.1.2.4.56': 'JPEG Full Progression, Non-Hierarchical (Process 11 & 13) (Retired)',\n  '1.2.840.10008.1.2.4.57': 'JPEG Lossless, Non-Hierarchical (Process 14)',\n  '1.2.840.10008.1.2.4.58': 'JPEG Lossless, Non-Hierarchical (Process 15) (Retired)',\n  '1.2.840.10008.1.2.4.59': 'JPEG Extended, Hierarchical (Process 16 & 18) (Retired)',\n  '1.2.840.10008.1.2.4.60': 'JPEG Extended, Hierarchical (Process 17 & 19) (Retired)',\n  '1.2.840.10008.1.2.4.61': 'JPEG Spectral Selection, Hierarchical (Process 20 & 22) (Retired)',\n  '1.2.840.10008.1.2.4.62': 'JPEG Spectral Selection, Hierarchical (Process 21 & 23) (Retired)',\n  '1.2.840.10008.1.2.4.63': 'JPEG Full Progression, Hierarchical (Process 24 & 26) (Retired)',\n  '1.2.840.10008.1.2.4.64': 'JPEG Full Progression, Hierarchical (Process 25 & 27) (Retired)',\n  '1.2.840.10008.1.2.4.65': 'JPEG Lossless, Hierarchical (Process 28) (Retired)',\n  '1.2.840.10008.1.2.4.66': 'JPEG Lossless, Hierarchical (Process 29) (Retired)',\n  '1.2.840.10008.1.2.4.70': 'JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])',\n  '1.2.840.10008.1.2.4.80': 'JPEG-LS Lossless Image Compression',\n  '1.2.840.10008.1.2.4.81': 'JPEG-LS Lossy (Near-Lossless) Image Compression',\n  '1.2.840.10008.1.2.4.90': 'JPEG 2000 Image Compression (Lossless Only)',\n  '1.2.840.10008.1.2.4.91': 'JPEG 2000 Image Compression',\n  '1.2.840.10008.1.2.4.92': 'JPEG 2000 Part 2 Multi-component Image Compression (Lossless Only)',\n  '1.2.840.10008.1.2.4.93': 'JPEG 2000 Part 2 Multi-component Image Compression',\n  '1.2.840.10008.1.2.4.94': 'JPIP Referenced',\n  '1.2.840.10008.1.2.4.95': 'JPIP Referenced Deflate',\n  '1.2.840.10008.1.2.4.100': 'MPEG2 Main Profile / Main Level',\n  '1.2.840.10008.1.2.4.101': 'MPEG2 Main Profile / High Level',\n  '1.2.840.10008.1.2.4.102': 'MPEG-4 AVC/H.264 High Profile / Level 4.1',\n  '1.2.840.10008.1.2.4.103': 'MPEG-4 AVC/H.264 BD-compatible High Profile / Level 4.1',\n  '1.2.840.10008.1.2.4.104': 'MPEG-4 AVC/H.264 High Profile / Level 4.2 For 2D Video',\n  '1.2.840.10008.1.2.4.105': 'MPEG-4 AVC/H.264 High Profile / Level 4.2 For 3D Video',\n  '1.2.840.10008.1.2.4.106': 'MPEG-4 AVC/H.264 Stereo High Profile / Level 4.2',\n  '1.2.840.10008.1.2.4.107': 'HEVC/H.265 Main Profile / Level 5.1',\n  '1.2.840.10008.1.2.4.108': 'HEVC/H.265 Main 10 Profile / Level 5.1',\n  '1.2.840.10008.1.2.5': 'RLE Lossless',\n  '1.2.840.10008.1.2.6.1': 'RFC 2557 MIME encapsulation (Retired)',\n  '1.2.840.10008.1.2.6.2': 'XML Encoding (Retired)',\n  '1.2.840.10008.1.2.7.1': 'SMPTE ST 2110-20 Uncompressed Progressive Active Video',\n  '1.2.840.10008.1.2.7.2': 'SMPTE ST 2110-20 Uncompressed Interlaced Active Video',\n  '1.2.840.10008.1.2.7.3': 'SMPTE ST 2110-30 PCM Digital Audio',\n  '1.2.840.10008.1.20': 'Papyrus 3 Implicit VR Little Endian (Retired)'\n};\n\n/**\n * Transfer syntaxes indexed by keyword.\n *\n * @type {Object<string, string>}\n */\nexport const transferSyntaxKeywords = {\n  ImplicitVRLittleEndian: '1.2.840.10008.1.2',\n  ExplicitVRLittleEndian: '1.2.840.10008.1.2.1',\n  EncapsulatedUncompressedExplicitVRLittleEndian: '1.2.840.10008.1.2.1.98',\n  DeflatedExplicitVRLittleEndian: '1.2.840.10008.1.2.1.99',\n  ExplicitVRBigEndian: '1.2.840.10008.1.2.2',\n  JPEGBaseline8Bit: '1.2.840.10008.1.2.4.50',\n  JPEGExtended12Bit: '1.2.840.10008.1.2.4.51',\n  JPEGExtended35: '1.2.840.10008.1.2.4.52',\n  JPEGSpectralSelectionNonHierarchical68: '1.2.840.10008.1.2.4.53',\n  JPEGSpectralSelectionNonHierarchical79: '1.2.840.10008.1.2.4.54',\n  JPEGFullProgressionNonHierarchical1012: '1.2.840.10008.1.2.4.55',\n  JPEGFullProgressionNonHierarchical1113: '1.2.840.10008.1.2.4.56',\n  JPEGLossless: '1.2.840.10008.1.2.4.57',\n  JPEGLosslessNonHierarchical15: '1.2.840.10008.1.2.4.58',\n  JPEGExtendedHierarchical1618: '1.2.840.10008.1.2.4.59',\n  JPEGExtendedHierarchical1719: '1.2.840.10008.1.2.4.60',\n  JPEGSpectralSelectionHierarchical2022: '1.2.840.10008.1.2.4.61',\n  JPEGSpectralSelectionHierarchical2123: '1.2.840.10008.1.2.4.62',\n  JPEGFullProgressionHierarchical2426: '1.2.840.10008.1.2.4.63',\n  JPEGFullProgressionHierarchical2527: '1.2.840.10008.1.2.4.64',\n  JPEGLosslessHierarchical28: '1.2.840.10008.1.2.4.65',\n  JPEGLosslessHierarchical29: '1.2.840.10008.1.2.4.66',\n  JPEGLosslessSV1: '1.2.840.10008.1.2.4.70',\n  JPEGLSLossless: '1.2.840.10008.1.2.4.80',\n  JPEGLSNearLossless: '1.2.840.10008.1.2.4.81',\n  JPEG2000Lossless: '1.2.840.10008.1.2.4.90',\n  JPEG2000: '1.2.840.10008.1.2.4.91',\n  JPEG2000MCLossless: '1.2.840.10008.1.2.4.92',\n  JPEG2000MC: '1.2.840.10008.1.2.4.93',\n  JPIPReferenced: '1.2.840.10008.1.2.4.94',\n  JPIPReferencedDeflate: '1.2.840.10008.1.2.4.95',\n  MPEG2MPML: '1.2.840.10008.1.2.4.100',\n  MPEG2MPHL: '1.2.840.10008.1.2.4.101',\n  MPEG4HP41: '1.2.840.10008.1.2.4.102',\n  MPEG4HP41BD: '1.2.840.10008.1.2.4.103',\n  MPEG4HP422D: '1.2.840.10008.1.2.4.104',\n  MPEG4HP423D: '1.2.840.10008.1.2.4.105',\n  MPEG4HP42STEREO: '1.2.840.10008.1.2.4.106',\n  HEVCMP51: '1.2.840.10008.1.2.4.107',\n  HEVCM10P51: '1.2.840.10008.1.2.4.108',\n  RLELossless: '1.2.840.10008.1.2.5',\n  RFC2557MIMEEncapsulation: '1.2.840.10008.1.2.6.1',\n  XMLEncoding: '1.2.840.10008.1.2.6.2',\n  SMPTEST211020UncompressedProgressiveActiveVideo: '1.2.840.10008.1.2.7.1',\n  SMPTEST211020UncompressedInterlacedActiveVideo: '1.2.840.10008.1.2.7.2',\n  SMPTEST211030PCMDigitalAudio: '1.2.840.10008.1.2.7.3',\n  Papyrus3ImplicitVRLittleEndian: '1.2.840.10008.1.20'\n};\n\n/**\n * Standard SOP Class UIDs indexed by keyword. Not comprehensive, just ones needed by DWV.\n *\n * See {@link https://dicom.nema.org/dicom/2013/output/chtml/part04/sect_B.5.html#table_B.5-1}.\n *\n * @type {Object<string, string>}\n */\nexport const SOPClassUIDs = {\n  SecondaryCapture: '1.2.840.10008.5.1.4.1.1.7'\n};","import {\n  dictionary,\n  tagGroups\n} from './dictionary.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from '../dicom/dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Immutable tag.\n */\nexport class Tag {\n\n  /**\n   * The tag group.\n   *\n   * @type {string}\n   */\n  #group;\n\n  /**\n   * The tag element.\n   *\n   * @type {string}\n   */\n  #element;\n\n  /**\n   * @param {string} group The tag group as '####'.\n   * @param {string} element The tag element as '####'.\n   */\n  constructor(group, element) {\n    if (!group || typeof group === 'undefined') {\n      throw new Error('Cannot create tag with no group.');\n    }\n    if (group.length !== 4) {\n      throw new Error('Cannot create tag with badly sized group: ' + group);\n    }\n    if (!element || typeof element === 'undefined') {\n      throw new Error('Cannot create tag with no element.');\n    }\n    if (element.length !== 4) {\n      throw new Error('Cannot create tag with badly sized element: ' + element);\n    }\n    this.#group = group;\n    this.#element = element;\n  }\n\n  /**\n   * Get the tag group.\n   *\n   * @returns {string} The tag group.\n   */\n  getGroup() {\n    return this.#group;\n  }\n\n  /**\n   * Get the tag element.\n   *\n   * @returns {string} The tag element.\n   */\n  getElement() {\n    return this.#element;\n  }\n\n  /**\n   * Get as string representation of the tag: 'key: name'.\n   *\n   * @returns {string} A string representing the tag.\n   */\n  toString() {\n    return this.getKey() + ': ' + this.getNameFromDictionary();\n  }\n\n  /**\n   * Check for Tag equality.\n   *\n   * @param {Tag} rhs The other tag to compare to.\n   * @returns {boolean} True if both tags are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      typeof rhs !== 'undefined' &&\n      this.#group === rhs.getGroup() &&\n      this.#element === rhs.getElement();\n  }\n\n  /**\n   * Get the group-element key used to store DICOM elements.\n   *\n   * @returns {string} The key as '########'.\n   */\n  getKey() {\n    return this.#group + this.#element;\n  }\n\n  /**\n   * Get the group name as defined in TagGroups.\n   *\n   * @returns {string} The name.\n   */\n  getGroupName() {\n    return tagGroups[this.#group];\n  }\n\n  /**\n   * Does this tag have a VR.\n   * Basically not the Item, ItemDelimitationItem nor\n   *  SequenceDelimitationItem tags.\n   *\n   * @returns {boolean} True if this tag has a VR.\n   */\n  isWithVR() {\n    return !(this.#group === 'FFFE' &&\n      (this.#element === 'E000' ||\n        this.#element === 'E00D' ||\n        this.#element === 'E0DD')\n    );\n  }\n\n  /**\n   * Is the tag group a private tag group ?\n   *\n   * See: {@link http://dicom.nema.org/medical/dicom/2022a/output/html/part05.html#sect_7.8}.\n   *\n   * @returns {boolean} True if the tag group is private,\n   *   ie if its group is an odd number.\n   */\n  isPrivate() {\n    return parseInt(this.#group, 16) % 2 === 1;\n  }\n\n  /**\n   * Get the tag info from the dicom dictionary.\n   *\n   * @returns {string[]|undefined} The info as [vr, multiplicity, name].\n   */\n  #getInfoFromDictionary() {\n    let info;\n    if (typeof dictionary[this.#group] !== 'undefined' &&\n      typeof dictionary[this.#group][this.#element] !==\n      'undefined') {\n      info = dictionary[this.#group][this.#element];\n    }\n    return info;\n  }\n\n  /**\n   * Get the tag Value Representation (VR) from the dicom dictionary.\n   *\n   * @returns {string|undefined} The VR.\n   */\n  getVrFromDictionary() {\n    let vr;\n    const info = this.#getInfoFromDictionary();\n    if (typeof info !== 'undefined') {\n      vr = info[0];\n    }\n    return vr;\n  }\n\n  /**\n   * Get the multiplicity from the dicom dictionary.\n   *\n   * @returns {number|undefined} The multiplicity.\n   */\n  getMultiplicityFromDictionary() {\n    let multiplicity;\n    const info = this.#getInfoFromDictionary();\n    if (typeof info !== 'undefined') {\n      multiplicity = parseInt(info[1], 10);\n    }\n    return multiplicity;\n  }\n\n  /**\n   * Get the tag name from the dicom dictionary.\n   *\n   * @returns {string|undefined} The VR.\n   */\n  getNameFromDictionary() {\n    let name;\n    const info = this.#getInfoFromDictionary();\n    if (typeof info !== 'undefined') {\n      name = info[2];\n    }\n    return name;\n  }\n\n} // Tag class\n\n/**\n * Tag compare function.\n *\n * @param {Tag} a The first tag.\n * @param {Tag} b The second tag.\n * @returns {number} The result of the tag comparison,\n *   positive for b before a, negative for a before b and\n *   zero to keep same order.\n */\nexport function tagCompareFunction(a, b) {\n  // first by group\n  let res = parseInt(a.getGroup(), 16) - parseInt(b.getGroup(), 16);\n  if (res === 0) {\n    // by element if same group\n    res = parseInt(a.getElement(), 16) - parseInt(b.getElement(), 16);\n  }\n  return res;\n}\n\n/**\n * Split a group-element key used to store DICOM elements.\n *\n * @param {string} key The key in form \"00280102\" as generated by tag::getKey.\n * @returns {Tag} The DICOM tag.\n */\nexport function getTagFromKey(key) {\n  if (!key || typeof key === 'undefined') {\n    throw new Error('Cannot create tag with no key.');\n  }\n  if (key.length !== 8) {\n    throw new Error('Cannot create tag with badly sized key: ' + key);\n  }\n  return new Tag(key.substring(0, 4), key.substring(4, 8));\n}\n\n/**\n * Get the TransferSyntaxUID Tag.\n *\n * @returns {Tag} The tag.\n */\nexport function getTransferSyntaxUIDTag() {\n  return new Tag('0002', '0010');\n}\n\n/**\n * Get the FileMetaInformationGroupLength Tag.\n *\n * @returns {Tag} The tag.\n */\nexport function getFileMetaInformationGroupLengthTag() {\n  return new Tag('0002', '0000');\n}\n\n/**\n * Is the input tag the FileMetaInformationGroupLength Tag.\n *\n * @param {Tag} tag The tag to test.\n * @returns {boolean} True if the asked tag.\n */\nexport function isFileMetaInformationGroupLengthTag(tag) {\n  return tag.equals(getFileMetaInformationGroupLengthTag());\n}\n\n/**\n * Get the Item Tag.\n *\n * @returns {Tag} The tag.\n */\nexport function getItemTag() {\n  return new Tag('FFFE', 'E000');\n}\n\n/**\n * Is the input tag the Item Tag.\n *\n * @param {Tag} tag The tag to test.\n * @returns {boolean} True if the asked tag.\n */\nexport function isItemTag(tag) {\n  // faster than tag.equals(getItemTag());\n  return tag.getKey() === 'FFFEE000';\n}\n\n/**\n * Get the ItemDelimitationItem Tag.\n *\n * @returns {Tag} The tag.\n */\nexport function getItemDelimitationItemTag() {\n  return new Tag('FFFE', 'E00D');\n}\n\n/**\n * Is the input tag the ItemDelimitationItem Tag.\n *\n * @param {Tag} tag The tag to test.\n * @returns {boolean} True if the asked tag.\n */\nexport function isItemDelimitationItemTag(tag) {\n  // faster than tag.equals(getItemDelimitationItemTag());\n  return tag.getKey() === 'FFFEE00D';\n}\n\n/**\n * Get the SequenceDelimitationItem Tag.\n *\n * @returns {Tag} The tag.\n */\nexport function getSequenceDelimitationItemTag() {\n  return new Tag('FFFE', 'E0DD');\n}\n\n/**\n * Is the input tag the SequenceDelimitationItem Tag.\n *\n * @param {Tag} tag The tag to test.\n * @returns {boolean} True if the asked tag.\n */\nexport function isSequenceDelimitationItemTag(tag) {\n  // faster than tag.equals(getSequenceDelimitationItemTag());\n  return tag.getKey() === 'FFFEE0DD';\n}\n\n/**\n * Get the PixelData Tag.\n *\n * @returns {Tag} The tag.\n */\nexport function getPixelDataTag() {\n  return new Tag('7FE0', '0010');\n}\n\n/**\n * Get the list of pixel data DICOM tag keys: PixelData,\n *   FloatPixelData and DoubleFloatPixelData.\n *\n * @returns {string[]} The key list.\n */\nfunction getAllPixelDataTagKeys() {\n  return ['7FE00010', '7FE00009', '7FE00008'];\n}\n\n/**\n * Is the input tag one of the pixel data tag.\n *\n * @param {Tag} tag The tag to test.\n * @returns {boolean} True if input is a pixel data tag.\n */\nexport function isAnyPixelDataTag(tag) {\n  const keys = getAllPixelDataTagKeys();\n  return keys.includes(tag.getKey());\n}\n\n/**\n * Get the dicom data element for the pixel data (can be regular,\n * float or double data).\n *\n * @param {Object<string, DataElement>} elements The data elements.\n * @returns {DataElement|undefined} The pixel data element.\n */\nexport function getAnyPixelDataElement(elements) {\n  const keys = getAllPixelDataTagKeys();\n  let res;\n  for (const key of keys) {\n    if (typeof elements[key] !== 'undefined') {\n      res = elements[key];\n      break;\n    }\n  }\n  return res;\n}\n\n/**\n * Check if an input data elements contains a pixel data element.\n *\n * @param {Object<string, DataElement>} elements Data elements.\n * @returns {boolean} True if the elements contain one of the\n *   pixel data tags.\n */\nexport function hasAnyPixelDataElement(elements) {\n  return typeof getAnyPixelDataElement(elements) !== 'undefined';\n}\n\n/**\n * Get a tag from the dictionary using a tag string name.\n *\n * @param {string} tagName The tag string name.\n * @returns {Tag|undefined} The tag object or null if not found.\n */\nexport function getTagFromDictionary(tagName) {\n  if (typeof tagName === 'undefined' || tagName === null) {\n    return null;\n  }\n  let group = null;\n  let element = null;\n  const dict = dictionary;\n  const keys0 = Object.keys(dict);\n  let keys1 = null;\n  let foundTag = false;\n  // search through dictionary\n  for (let k0 = 0, lenK0 = keys0.length; k0 < lenK0; ++k0) {\n    group = keys0[k0];\n    keys1 = Object.keys(dict[group]);\n    for (let k1 = 0, lenK1 = keys1.length; k1 < lenK1; ++k1) {\n      element = keys1[k1];\n      if (dict[group][element][2] === tagName) {\n        foundTag = true;\n        break;\n      }\n    }\n    if (foundTag) {\n      break;\n    }\n  }\n  let tag;\n  if (foundTag) {\n    tag = new Tag(group, element);\n  }\n  return tag;\n}\n\n/**\n * Get an array reducer to reduce an array of tag keys taken from\n *   the input dataElements and return as simple elements.\n *\n * @param {Object<string, DataElement>} dataElements The meta data\n *   index by tag keys.\n * @returns {any} An array reducer callbackFn.\n */\nfunction getSimpleElementReducer(dataElements) {\n  return function (accumulator, currentValue) {\n    // get the tag name\n    const tag = getTagFromKey(currentValue);\n    let tagName = tag.getNameFromDictionary();\n    if (typeof tagName === 'undefined') {\n      // add 'x' to list private at end\n      tagName = 'x' + tag.getKey();\n    }\n    const currentMeta = dataElements[currentValue];\n    // remove undefined properties\n    for (const property in currentMeta) {\n      if (typeof currentMeta[property] === 'undefined') {\n        delete currentMeta[property];\n      }\n    }\n    let tagValue;\n    // recurse for sequences\n    if (currentMeta.vr === 'SQ') {\n      tagValue = {value: []};\n      // valid for 1D array, not for merged data elements\n      for (let i = 0; i < currentMeta.value.length; ++i) {\n        const item = currentMeta.value[i];\n        tagValue.value.push(Object.keys(item).reduce(\n          getSimpleElementReducer(item), {}));\n      }\n    } else {\n      if (currentMeta.value.length === 1) {\n        tagValue = currentMeta.value[0];\n      } else {\n        tagValue = currentMeta.value;\n      }\n    }\n    accumulator[tagName] = tagValue;\n    return accumulator;\n  };\n}\n\n/**\n * Get the meta data as simple elements:\n * - indexed by tag names instead of tag keys,\n * - no element object, just value if not sequence nor merged item.\n *\n * @param {Object<string, DataElement>} metaData The meta data\n *   index by tag keys.\n * @returns {Object<string, any>} The simple elements.\n */\nexport function getAsSimpleElements(metaData) {\n  const meta = structuredClone(metaData);\n  return Object.keys(meta).reduce(getSimpleElementReducer(meta), {});\n}\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {Tag} from './dicomTag.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * DICOM data element.\n */\nexport class DataElement {\n  /**\n   * The element Value Representation.\n   *\n   * @type {string}\n   */\n  vr;\n  /**\n   * The element value.\n   *\n   * @type {Array}\n   */\n  value;\n\n  // [start] internal values\n  // only present during parsing or writing otherwise not set\n\n  /**\n   * The element dicom tag.\n   *\n   * @type {Tag}\n   */\n  tag;\n\n  /**\n   * The element Value Length.\n   *\n   * @type {number}\n   */\n  vl;\n\n  /**\n   * Flag to know if defined or undefined sequence length.\n   *\n   * @type {boolean}\n   */\n  undefinedLength;\n\n  /**\n   * The element start offset.\n   *\n   * @type {number}\n   */\n  startOffset;\n\n  /**\n   * The element end offset.\n   *\n   * @type {number}\n   */\n  endOffset;\n\n  /**\n   * The sequence items.\n   *\n   * @type {Array}\n   */\n  items;\n\n  // [end] internal values\n\n  /**\n   * @param {string} vr The element VR (Value Representation).\n   */\n  constructor(vr) {\n    this.vr = vr;\n  }\n}\n\n/**\n * Check an input data element, returns true if:\n * - the element is not undefined,\n * - the elements' value is not undefined,\n * - the elements' value has content.\n *\n * @param {DataElement} element The data element.\n * @returns {boolean} True if there is a value.\n */\nfunction hasValue(element) {\n  return typeof element !== 'undefined' &&\n    typeof element.value !== 'undefined' &&\n    element.value.length !== 0;\n}\n\n/**\n * Safely get an elements' first value from a list of elements.\n *\n * @param {Object<string, DataElement>} dataElements A list of data elements.\n * @param {string} key The tag key as for example '00100020'.\n * @returns {any|undefined} The elements' value or undefined.\n */\nexport function safeGet(dataElements, key) {\n  let res;\n  if (hasValue(dataElements[key])) {\n    res = dataElements[key].value[0];\n  }\n  return res;\n};\n\n/**\n * Safely get all of an elements' values from a list of elements.\n *\n * @param {Object<string, DataElement>} dataElements A list of data elements.\n * @param {string} key The tag key as for example '00100020'.\n * @returns {any[]|undefined} The elements' values or undefined.\n */\nexport function safeGetAll(dataElements, key) {\n  let res;\n  if (hasValue(dataElements[key])) {\n    res = dataElements[key].value;\n  }\n  return res;\n};\n\n/**\n * Check a DICOM data element: checks\n * - if the element is not undefined,\n * - if the elements' value is not undefined,\n * - if the elements' value is not empty,\n * - (optional) if the elements' values have specific values.\n *\n * @param {DataElement} element The element to check.\n * @param {string} name The element name.\n * @param {Array} [values] Optional list of expected values.\n * @returns {string} A warning if the element is not as expected.\n */\nexport function checkDataElement(element, name, values) {\n  let warning = '';\n  if (typeof element === 'undefined') {\n    warning += ' ' + name + ' is undefined,';\n  } else if (typeof element.value === 'undefined') {\n    warning += ' ' + name + ' has undefined value,';\n  } else if (element.value.length === 0) {\n    warning += ' ' + name + ' is empty,';\n  } else {\n    if (typeof values !== 'undefined') {\n      for (let i = 0; i < values.length; ++i) {\n        if (!element.value.includes(values[i])) {\n          warning += ' ' + name + ' does not contain ' + values[i] +\n            ' (value: ' + element.value + '),';\n        }\n      }\n    }\n  }\n  return warning;\n}\n","/**\n * Is the Native endianness Little Endian.\n *\n * @returns {boolean} True if little endian.\n */\nexport function isNativeLittleEndian() {\n  return new Int8Array(new Int16Array([1]).buffer)[0] > 0;\n}\n\n/**\n * Flip an array's endianness.\n * Inspired from [DataStream.js]{@link https://github.com/kig/DataStream.js}.\n *\n * @param {object} array The array to flip (modified).\n */\nfunction flipArrayEndianness(array) {\n  const blen = array.byteLength;\n  const u8 = new Uint8Array(array.buffer, array.byteOffset, blen);\n  const bpe = array.BYTES_PER_ELEMENT;\n  let tmp;\n  for (let i = 0; i < blen; i += bpe) {\n    for (let j = i + bpe - 1, k = i; j > k; j--, k++) {\n      tmp = u8[k];\n      u8[k] = u8[j];\n      u8[j] = tmp;\n    }\n  }\n}\n\n/**\n * Data reader.\n */\nexport class DataReader {\n\n  /**\n   * The input buffer.\n   *\n   * @type {ArrayBuffer}\n   */\n  #buffer;\n\n  /**\n   * Is the endianness Little Endian.\n   *\n   * @type {boolean}\n   */\n  #isLittleEndian = true;\n\n  /**\n   * Is the Native endianness Little Endian.\n   *\n   * @type {boolean}\n   */\n  #isNativeLittleEndian = isNativeLittleEndian();\n\n  /**\n   * Flag to know if the TypedArray data needs flipping.\n   *\n   * @type {boolean}\n   */\n  #needFlip;\n\n  /**\n   * The main data view.\n   *\n   * @type {DataView}\n   */\n  #view;\n\n  /**\n   * @param {ArrayBuffer} buffer The input array buffer.\n   * @param {boolean} [isLittleEndian] Flag to tell if the data is little\n   *   or big endian (default: true).\n   */\n  constructor(buffer, isLittleEndian) {\n    this.#buffer = buffer;\n    // Set endian flag if not defined.\n    if (typeof isLittleEndian !== 'undefined') {\n      this.#isLittleEndian = isLittleEndian;\n    }\n    this.#needFlip = (this.#isLittleEndian !== this.#isNativeLittleEndian);\n    this.#view = new DataView(buffer);\n  }\n\n  /**\n   * Read Uint16 (2 bytes) data.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @returns {number} The read data.\n   */\n  readUint16(byteOffset) {\n    return this.#view.getUint16(byteOffset, this.#isLittleEndian);\n  }\n\n  /**\n   * Read Int16 (2 bytes) data.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @returns {number} The read data.\n   */\n  readInt16(byteOffset) {\n    return this.#view.getInt16(byteOffset, this.#isLittleEndian);\n  }\n\n  /**\n   * Read Uint32 (4 bytes) data.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @returns {number} The read data.\n   */\n  readUint32(byteOffset) {\n    return this.#view.getUint32(byteOffset, this.#isLittleEndian);\n  }\n\n  /**\n   * Read BigUint64 (8 bytes) data.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @returns {bigint} The read data.\n   */\n  readBigUint64(byteOffset) {\n    return this.#view.getBigUint64(byteOffset, this.#isLittleEndian);\n  }\n\n  /**\n   * Read Int32 (4 bytes) data.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @returns {number} The read data.\n   */\n  readInt32(byteOffset) {\n    return this.#view.getInt32(byteOffset, this.#isLittleEndian);\n  }\n\n  /**\n   * Read BigInt64 (8 bytes) data.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @returns {bigint} The read data.\n   */\n  readBigInt64(byteOffset) {\n    return this.#view.getBigInt64(byteOffset, this.#isLittleEndian);\n  }\n\n  /**\n   * Read Float32 (4 bytes) data.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @returns {number} The read data.\n   */\n  readFloat32(byteOffset) {\n    return this.#view.getFloat32(byteOffset, this.#isLittleEndian);\n  }\n\n  /**\n   * Read Float64 (8 bytes) data.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @returns {number} The read data.\n   */\n  readFloat64(byteOffset) {\n    return this.#view.getFloat64(byteOffset, this.#isLittleEndian);\n  }\n\n  /**\n   * Read binary (0/1) bitpacked array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the input array.\n   * @param {number} [outputSize] The size of the output buffer, defaults\n   * to 8 times the input size.\n   * @returns {Uint8Array} The read data.\n   */\n  readBinaryArray(byteOffset, size, outputSize) {\n    // input\n    const bitArray = new Uint8Array(this.#buffer, byteOffset, size);\n    // result\n    let byteArrayLength;\n    if (typeof outputSize !== 'undefined') {\n      byteArrayLength = outputSize;\n    } else {\n      byteArrayLength = 8 * bitArray.length;\n    }\n    const data = new Uint8Array(byteArrayLength);\n    let bitNumber = 0;\n    let bitIndex = 0;\n    for (let i = 0; i < byteArrayLength; ++i) {\n      bitNumber = i % 8;\n      bitIndex = Math.floor(i / 8);\n      // see https://stackoverflow.com/questions/4854207/get-a-specific-bit-from-byte/4854257\n      // @ts-ignore\n      data[i] = 255 * ((bitArray[bitIndex] & (1 << bitNumber)) !== 0);\n    }\n    return data;\n  }\n\n  /**\n   * Read Uint8 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {Uint8Array} The read data.\n   */\n  readUint8Array(byteOffset, size) {\n    return new Uint8Array(this.#buffer, byteOffset, size);\n  }\n\n  /**\n   * Read Int8 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {Int8Array} The read data.\n   */\n  readInt8Array(byteOffset, size) {\n    return new Int8Array(this.#buffer, byteOffset, size);\n  }\n\n  /**\n   * Read Uint16 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {Uint16Array} The read data.\n   */\n  readUint16Array(byteOffset, size) {\n    const bpe = Uint16Array.BYTES_PER_ELEMENT;\n    const arraySize = size / bpe;\n    let data = null;\n    // byteOffset should be a multiple of Uint16Array.BYTES_PER_ELEMENT (=2)\n    if (byteOffset % bpe === 0) {\n      data = new Uint16Array(this.#buffer, byteOffset, arraySize);\n      if (this.#needFlip) {\n        flipArrayEndianness(data);\n      }\n    } else {\n      data = new Uint16Array(arraySize);\n      let index = byteOffset;\n      for (let i = 0; i < arraySize; ++i) {\n        data[i] = this.readUint16(index);\n        index += bpe;\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Read Int16 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {Int16Array} The read data.\n   */\n  readInt16Array(byteOffset, size) {\n    const bpe = Int16Array.BYTES_PER_ELEMENT;\n    const arraySize = size / bpe;\n    let data = null;\n    // byteOffset should be a multiple of Int16Array.BYTES_PER_ELEMENT (=2)\n    if (byteOffset % bpe === 0) {\n      data = new Int16Array(this.#buffer, byteOffset, arraySize);\n      if (this.#needFlip) {\n        flipArrayEndianness(data);\n      }\n    } else {\n      data = new Int16Array(arraySize);\n      let index = byteOffset;\n      for (let i = 0; i < arraySize; ++i) {\n        data[i] = this.readInt16(index);\n        index += bpe;\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Read Uint32 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {Uint32Array} The read data.\n   */\n  readUint32Array(byteOffset, size) {\n    const bpe = Uint32Array.BYTES_PER_ELEMENT;\n    const arraySize = size / bpe;\n    let data = null;\n    // byteOffset should be a multiple of Uint32Array.BYTES_PER_ELEMENT (=4)\n    if (byteOffset % bpe === 0) {\n      data = new Uint32Array(this.#buffer, byteOffset, arraySize);\n      if (this.#needFlip) {\n        flipArrayEndianness(data);\n      }\n    } else {\n      data = new Uint32Array(arraySize);\n      let index = byteOffset;\n      for (let i = 0; i < arraySize; ++i) {\n        data[i] = this.readUint32(index);\n        index += bpe;\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Read Uint64 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {BigUint64Array} The read data.\n   */\n  readUint64Array(byteOffset, size) {\n    const bpe = BigUint64Array.BYTES_PER_ELEMENT;\n    const arraySize = size / bpe;\n    let data = null;\n    // byteOffset should be a multiple of BigUint64Array.BYTES_PER_ELEMENT (=8)\n    if (byteOffset % bpe === 0) {\n      data = new BigUint64Array(this.#buffer, byteOffset, arraySize);\n      if (this.#needFlip) {\n        flipArrayEndianness(data);\n      }\n    } else {\n      data = new BigUint64Array(arraySize);\n      let index = byteOffset;\n      for (let i = 0; i < arraySize; ++i) {\n        data[i] = this.readBigUint64(index);\n        index += bpe;\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Read Int32 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {Int32Array} The read data.\n   */\n  readInt32Array(byteOffset, size) {\n    const bpe = Int32Array.BYTES_PER_ELEMENT;\n    const arraySize = size / bpe;\n    let data = null;\n    // byteOffset should be a multiple of Int32Array.BYTES_PER_ELEMENT (=4)\n    if (byteOffset % bpe === 0) {\n      data = new Int32Array(this.#buffer, byteOffset, arraySize);\n      if (this.#needFlip) {\n        flipArrayEndianness(data);\n      }\n    } else {\n      data = new Int32Array(arraySize);\n      let index = byteOffset;\n      for (let i = 0; i < arraySize; ++i) {\n        data[i] = this.readInt32(index);\n        index += bpe;\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Read Int64 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {BigInt64Array} The read data.\n   */\n  readInt64Array(byteOffset, size) {\n    const bpe = BigInt64Array.BYTES_PER_ELEMENT;\n    const arraySize = size / bpe;\n    let data = null;\n    // byteOffset should be a multiple of BigInt64Array.BYTES_PER_ELEMENT (=8)\n    if (byteOffset % bpe === 0) {\n      data = new BigInt64Array(this.#buffer, byteOffset, arraySize);\n      if (this.#needFlip) {\n        flipArrayEndianness(data);\n      }\n    } else {\n      data = new BigInt64Array(arraySize);\n      let index = byteOffset;\n      for (let i = 0; i < arraySize; ++i) {\n        data[i] = this.readBigInt64(index);\n        index += bpe;\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Read Float32 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {Float32Array} The read data.\n   */\n  readFloat32Array(byteOffset, size) {\n    const bpe = Float32Array.BYTES_PER_ELEMENT;\n    const arraySize = size / bpe;\n    let data = null;\n    // byteOffset should be a multiple of Float32Array.BYTES_PER_ELEMENT (=4)\n    if (byteOffset % bpe === 0) {\n      data = new Float32Array(this.#buffer, byteOffset, arraySize);\n      if (this.#needFlip) {\n        flipArrayEndianness(data);\n      }\n    } else {\n      data = new Float32Array(arraySize);\n      let index = byteOffset;\n      for (let i = 0; i < arraySize; ++i) {\n        data[i] = this.readFloat32(index);\n        index += bpe;\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Read Float64 array.\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @param {number} size The size of the array.\n   * @returns {Float64Array} The read data.\n   */\n  readFloat64Array(byteOffset, size) {\n    const bpe = Float64Array.BYTES_PER_ELEMENT;\n    const arraySize = size / bpe;\n    let data = null;\n    // byteOffset should be a multiple of Float64Array.BYTES_PER_ELEMENT (=8)\n    if (byteOffset % bpe === 0) {\n      data = new Float64Array(this.#buffer, byteOffset, arraySize);\n      if (this.#needFlip) {\n        flipArrayEndianness(data);\n      }\n    } else {\n      data = new Float64Array(arraySize);\n      let index = byteOffset;\n      for (let i = 0; i < arraySize; ++i) {\n        data[i] = this.readFloat64(index);\n        index += bpe;\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Read data as an hexadecimal string of length 4 (no '0x' prefix).\n   *\n   * @param {number} byteOffset The offset to start reading from.\n   * @returns {string} The read data ('####').\n   */\n  readHex(byteOffset) {\n    // read and convert to hex string\n    const str = this.readUint16(byteOffset).toString(16);\n    // return padded\n    return '0000'.substring(0, 4 - str.length) + str.toUpperCase();\n  }\n\n} // class DataReader\n","import {\n  Tag,\n  getTransferSyntaxUIDTag,\n  isSequenceDelimitationItemTag,\n  isItemDelimitationItemTag,\n  isAnyPixelDataTag,\n  hasAnyPixelDataElement\n} from './dicomTag.js';\nimport {\n  is32bitVLVR,\n  isCharSetStringVR,\n  transferSyntaxes,\n  transferSyntaxKeywords,\n  vrTypes,\n} from './dictionary.js';\nimport {\n  safeGet,\n  DataElement\n} from './dataElement.js';\nimport {DataReader} from './dataReader.js';\nimport {logger} from '../utils/logger.js';\n\n/**\n * List of DICOM data elements indexed via a 8 character string formed from\n * the group and element numbers.\n *\n * @typedef {Object<string, DataElement>} DataElements\n */\n\n/**\n * Get the version of the library.\n *\n * @returns {string} The version of the library.\n */\nexport function getDwvVersion() {\n  return '0.36.1';\n}\n\n/**\n * Get the version of the library as a Unique Identifier (UI),\n * meaning just numbers and dots.\n *\n * @returns {string} The UI version of the library.\n */\nexport function getDwvVersionUI() {\n  // replace beta with '.99'\n  return getDwvVersion().replace('-beta', '.99');\n}\n\n/**\n * Get the dwv UID prefix.\n * Issued by Medical Connections Ltd (www.medicalconnections.co.uk)\n *   on 25/10/2017.\n *\n * @returns {string} The dwv UID prefix.\n */\nexport function getDwvUIDPrefix() {\n  return '1.2.826.0.1.3680043.9.7278.1';\n}\n\n/**\n * Get the value of the ImplementationVersionName tag.\n *\n * @returns {string} The name.\n */\nexport function getImplementationVersionName() {\n  return 'DWV_' + getDwvVersion();\n}\n\n/**\n * Get the value of the ImplementationClassUID tag.\n *\n * @returns {string} The uid.\n */\nexport function getImplementationClassUID() {\n  return getDwvUIDPrefix() + '.' + getDwvVersionUI();\n}\n\n/**\n * Get the dwv version from the value of the\n *   ImplementationClassUID tag.\n *\n * @param {string} uid The uid.\n * @returns {string|undefined} The dwv version.\n */\nexport function getDwvVersionFromImplementationClassUID(uid) {\n  let version;\n  const dwvPrefix = getDwvUIDPrefix();\n  if (uid.startsWith(dwvPrefix)) {\n    // reverse getDwvVersionUI\n    version = uid.substring(dwvPrefix.length + 1).replace('.99', '-beta');\n  }\n  return version;\n}\n\n/**\n * Split a string version into parts.\n * The input version follows a 'm.n.p[-beta.q]' version sheme (related\n *   to semantic versioning).\n *\n * @param {string} version The version.\n * @returns {string[]} The splited version.\n */\nfunction splitVersion(version) {\n  const split = version.split('-');\n  let versions = [];\n  for (const s of split) {\n    versions = versions.concat(s.split('.'));\n  }\n  return versions;\n}\n\n/**\n * Compare versions.\n * The input versions follow a 'm.n.p[-beta.q]' version sheme (related\n *   to semantic versioning).\n *\n * @param {string} a The first version.\n * @param {string} b The second version.\n * @returns {number} >0 to sort a after b, <0 to sort a before b,\n *   0 to not change order.\n */\nexport function compareVersions(a, b) {\n  let res = 0;\n  const splitA = splitVersion(a);\n  const splitB = splitVersion(b);\n  for (let i = 0; i < 3; ++i) {\n    res = parseInt(splitA[i], 10) - parseInt(splitB[i], 10);\n    if (res !== 0) {\n      break;\n    }\n  }\n  // beta part\n  if (res === 0) {\n    const betaIndex = 4;\n    const betaA = splitA[betaIndex];\n    const betaB = splitB[betaIndex];\n    if (typeof betaA === 'undefined' &&\n      typeof betaB === 'undefined') {\n      res = 0;\n    } else if (typeof betaA === 'undefined' &&\n      typeof betaB !== 'undefined') {\n      res = 1;\n    } else if (typeof betaA !== 'undefined' &&\n      typeof betaB === 'undefined') {\n      res = -1;\n    } else {\n      res = parseInt(betaA, 10) - parseInt(betaB, 10);\n    }\n  }\n  return res;\n}\n\n/**\n * Check if a version in inside bounds (bounds inclusives).\n * The input version follows a 'm.n.p[-beta.q]' version sheme (related\n *   to semantic versioning).\n *\n * @param {string} version The version to check.\n * @param {string} min The minimum version.\n * @param {string} max The maximum version.\n * @returns {boolean} True if the version in inside the bounds.\n */\nexport function isVersionInBounds(version, min, max) {\n  const compareMin = compareVersions(version, min);\n  const compareMax = compareVersions(version, max);\n  return compareMin >= 0 && compareMax <= 0;\n}\n\n/**\n * Check that an input buffer includes the DICOM prefix 'DICM'\n *   after the 128 bytes preamble.\n *\n * Ref: [DICOM File Meta]{@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part10/chapter_7.html#sect_7.1}.\n *\n * @param {ArrayBuffer} buffer The buffer to check.\n * @returns {boolean} True if the buffer includes the prefix.\n */\nexport function hasDicomPrefix(buffer) {\n  // check size: typed array constructor will throw RangeError if\n  // byteOffset + length * TypedArray.BYTES_PER_ELEMENT > buffer.byteLength\n  if (buffer.byteLength < 132) {\n    return false;\n  }\n  const prefixArray = new Uint8Array(buffer, 128, 4);\n  const stringReducer = function (previous, current) {\n    return previous += String.fromCharCode(current);\n  };\n  return prefixArray.reduce(stringReducer, '') === 'DICM';\n}\n\n// Zero-width space (u200B)\n// @ts-ignore\nconst ZWS = String.fromCharCode('u200B');\n\n/**\n * Clean string: remove zero-width space ending and trim.\n * Warning: no tests are done on the input, will fail if\n *   null or undefined or not string.\n * Exported for tests only.\n *\n * @param {string} inputStr The string to clean.\n * @returns {string} The cleaned string.\n */\nexport function cleanString(inputStr) {\n  let res = inputStr;\n  // get rid of ending zero-width space\n  const lastIndex = inputStr.length - 1;\n  if (inputStr[lastIndex] === ZWS) {\n    res = inputStr.substring(0, lastIndex);\n  }\n  // trim spaces\n  res = res.trim();\n  // return\n  return res;\n}\n\n/**\n * Get the utfLabel (used by the TextDecoder) from a character set term.\n *\n * References:\n * - DICOM [Value Encoding]{@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/chapter_6.html},\n * - DICOM [Specific Character Set]{@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.12.html#sect_C.12.1.1.2},\n * - [TextDecoder#Parameters]{@link https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder/TextDecoder#Parameters}.\n *\n * @param {string} charSetTerm The DICOM character set.\n * @returns {string} The corresponding UTF label.\n */\nfunction getUtfLabel(charSetTerm) {\n  let label = 'utf-8';\n  if (charSetTerm === 'ISO_IR 100') {\n    label = 'iso-8859-1';\n  } else if (charSetTerm === 'ISO_IR 101') {\n    label = 'iso-8859-2';\n  } else if (charSetTerm === 'ISO_IR 109') {\n    label = 'iso-8859-3';\n  } else if (charSetTerm === 'ISO_IR 110') {\n    label = 'iso-8859-4';\n  } else if (charSetTerm === 'ISO_IR 144') {\n    label = 'iso-8859-5';\n  } else if (charSetTerm === 'ISO_IR 127') {\n    label = 'iso-8859-6';\n  } else if (charSetTerm === 'ISO_IR 126') {\n    label = 'iso-8859-7';\n  } else if (charSetTerm === 'ISO_IR 138') {\n    label = 'iso-8859-8';\n  } else if (charSetTerm === 'ISO_IR 148') {\n    label = 'iso-8859-9';\n  } else if (charSetTerm === 'ISO_IR 13') {\n    label = 'shift-jis';\n  } else if (charSetTerm === 'ISO_IR 166') {\n    label = 'iso-8859-11';\n  } else if (charSetTerm === 'ISO 2022 IR 87') {\n    label = 'iso-2022-jp';\n  } else if (charSetTerm === 'ISO 2022 IR 149') {\n    // not supported by TextDecoder when it says it should...\n    //label = \"iso-2022-kr\";\n  } else if (charSetTerm === 'ISO 2022 IR 58') {\n    // not supported by TextDecoder...\n    //label = \"iso-2022-cn\";\n  } else if (charSetTerm === 'ISO_IR 192') {\n    label = 'utf-8';\n  } else if (charSetTerm === 'GB18030') {\n    label = 'gb18030';\n  } else if (charSetTerm === 'GB2312') {\n    label = 'gb2312';\n  } else if (charSetTerm === 'GBK') {\n    label = 'chinese';\n  }\n  return label;\n}\n\n/**\n * Default text decoder.\n */\nclass DefaultTextDecoder {\n  /**\n   * Decode an input string buffer.\n   *\n   * @param {Uint8Array} buffer The buffer to decode.\n   * @returns {string} The decoded string.\n   */\n  decode(buffer) {\n    let result = '';\n    for (let i = 0, leni = buffer.length; i < leni; ++i) {\n      result += String.fromCharCode(buffer[i]);\n    }\n    return result;\n  }\n}\n\n/**\n * Get patient orientation label in the reverse direction.\n *\n * @param {string} ori Patient Orientation value.\n * @returns {string} Reverse Orientation Label.\n */\nexport function getReverseOrientation(ori) {\n  if (!ori) {\n    return null;\n  }\n  // reverse labels\n  const rlabels = {\n    L: 'R',\n    R: 'L',\n    A: 'P',\n    P: 'A',\n    H: 'F',\n    F: 'H'\n  };\n\n  let rori = '';\n  for (let n = 0; n < ori.length; n++) {\n    const o = ori.substring(n, n + 1);\n    const r = rlabels[o];\n    if (r) {\n      rori += r;\n    }\n  }\n  // return\n  return rori;\n}\n\n/**\n * Tell if a given syntax is an implicit one (element with no VR).\n *\n * @param {string} syntax The transfer syntax to test.\n * @returns {boolean} True if an implicit syntax.\n */\nexport function isImplicitTransferSyntax(syntax) {\n  return syntax === transferSyntaxKeywords.ImplicitVRLittleEndian;\n}\n\n/**\n * Tell if a given syntax is a big endian syntax.\n *\n * @param {string} syntax The transfer syntax to test.\n * @returns {boolean} True if a big endian syntax.\n */\nexport function isBigEndianTransferSyntax(syntax) {\n  return syntax === transferSyntaxKeywords.ExplicitVRBigEndian;\n}\n\n/**\n * Tell if a given syntax is a JPEG baseline one.\n *\n * @param {string} syntax The transfer syntax to test.\n * @returns {boolean} True if a jpeg baseline syntax.\n */\nexport function isJpegBaselineTransferSyntax(syntax) {\n  return syntax === transferSyntaxKeywords.JPEGBaseline8Bit ||\n    syntax === transferSyntaxKeywords.JPEGExtended12Bit;\n}\n\n/**\n * Tell if a given syntax is a JPEG Lossless one.\n *\n * @param {string} syntax The transfer syntax to test.\n * @returns {boolean} True if a jpeg lossless syntax.\n */\nexport function isJpegLosslessTransferSyntax(syntax) {\n  return syntax === transferSyntaxKeywords.JPEGLossless ||\n    syntax === transferSyntaxKeywords.JPEGLosslessSV1;\n}\n\n/**\n * Tell if a given syntax is a JPEG 2000 one.\n *\n * @param {string} syntax The transfer syntax to test.\n * @returns {boolean} True if a jpeg 2000 syntax.\n */\nexport function isJpeg2000TransferSyntax(syntax) {\n  return syntax.match(/1.2.840.10008.1.2.4.9/) !== null;\n}\n\n/**\n * Tell if a given syntax is a RLE (Run-length encoding) one.\n *\n * @param {string} syntax The transfer syntax to test.\n * @returns {boolean} True if a RLE syntax.\n */\nfunction isRleTransferSyntax(syntax) {\n  return syntax === transferSyntaxKeywords.RLELossless;\n}\n\n/**\n * Tell if a given syntax needs decompression.\n *\n * @param {string} syntax The transfer syntax to test.\n * @returns {string|undefined} The name of the decompression algorithm.\n */\nexport function getSyntaxDecompressionName(syntax) {\n  let algo;\n  if (isJpeg2000TransferSyntax(syntax)) {\n    algo = 'jpeg2000';\n  } else if (isJpegBaselineTransferSyntax(syntax)) {\n    algo = 'jpeg-baseline';\n  } else if (isJpegLosslessTransferSyntax(syntax)) {\n    algo = 'jpeg-lossless';\n  } else if (isRleTransferSyntax(syntax)) {\n    algo = 'rle';\n  }\n  return algo;\n}\n\n/**\n * Tell if a given syntax is supported for reading.\n *\n * @param {string} syntax The transfer syntax to test.\n * @returns {boolean} True if a supported syntax.\n */\nfunction isReadSupportedTransferSyntax(syntax) {\n  return (syntax === transferSyntaxKeywords.ImplicitVRLittleEndian ||\n    syntax === transferSyntaxKeywords.ExplicitVRLittleEndian ||\n    syntax === transferSyntaxKeywords.ExplicitVRBigEndian ||\n    isJpegBaselineTransferSyntax(syntax) ||\n    isJpegLosslessTransferSyntax(syntax) ||\n    isJpeg2000TransferSyntax(syntax) ||\n    isRleTransferSyntax(syntax));\n}\n\n/**\n * Get a transfer syntax name from its UID.\n *\n * @param {string} syntax The transfer syntax UID value.\n * @returns {string} The transfer syntax name.\n */\nexport function getTransferSyntaxName(syntax) {\n  let name = 'Unknown';\n  if (typeof transferSyntaxes[syntax] !== 'undefined') {\n    name = transferSyntaxes[syntax];\n  }\n  return name;\n}\n\n/**\n * Guess the transfer syntax from the first data element.\n *\n * See {@link https://github.com/ivmartel/dwv/issues/188}\n *   (Allow to load DICOM with no DICM preamble) for more details.\n *\n * @param {DataElement} firstDataElement The first data element\n *   of the DICOM header.\n * @returns {DataElement} The transfer syntax data element.\n */\nfunction guessTransferSyntax(firstDataElement) {\n  const oEightGroupBigEndian = '0800';\n  const oEightGroupLittleEndian = '0008';\n  // check that group is 0008\n  const group = firstDataElement.tag.getGroup();\n  if (group !== oEightGroupBigEndian &&\n    group !== oEightGroupLittleEndian) {\n    throw new Error(\n      'Not a valid DICOM file (invalid DICM word found' +\n      ' and first element not in 0008 group)'\n    );\n  }\n  // reasonable assumption: 2 uppercase characters => explicit vr\n  const vr = firstDataElement.vr;\n  const vr0 = vr.charCodeAt(0);\n  const vr1 = vr.charCodeAt(1);\n  const implicit = (vr0 >= 65 && vr0 <= 90 && vr1 >= 65 && vr1 <= 90)\n    ? false : true;\n  // guess transfer syntax\n  let syntax = null;\n  if (group === oEightGroupLittleEndian) {\n    if (implicit) {\n      syntax = transferSyntaxKeywords.ImplicitVRLittleEndian;\n    } else {\n      syntax = transferSyntaxKeywords.ExplicitVRLittleEndian;\n    }\n  } else {\n    if (implicit) {\n      // ImplicitVRBigEndian: impossible\n      throw new Error(\n        'Not a valid DICOM file (no magic DICM word found' +\n        'and implicit VR big endian detected)'\n      );\n    } else {\n      syntax = transferSyntaxKeywords.ExplicitVRBigEndian;\n    }\n  }\n  // set transfer syntax data element\n  const dataElement = new DataElement('UI');\n  dataElement.tag = getTransferSyntaxUIDTag();\n  dataElement.value = [syntax];\n  dataElement.vl = dataElement.value[0].length;\n  dataElement.startOffset = firstDataElement.startOffset;\n  dataElement.endOffset = dataElement.startOffset + dataElement.vl;\n\n  return dataElement;\n}\n\n/**\n * Get the appropriate TypedArray in function of arguments.\n *\n * @param {number} bitsAllocated The number of bites used to store\n *   the data: [8, 16, 32].\n * @param {number} pixelRepresentation The pixel representation,\n *   0:unsigned;1:signed.\n * @param {number} size The size of the new array.\n * @returns {Uint8Array|Int8Array|Uint16Array|Int16Array|Uint32Array|Int32Array}\n *   The good typed array.\n */\nexport function getTypedArray(bitsAllocated, pixelRepresentation, size) {\n  let res = null;\n  try {\n    if (bitsAllocated === 1 || bitsAllocated === 8) {\n      if (pixelRepresentation === 0) {\n        res = new Uint8Array(size);\n      } else {\n        res = new Int8Array(size);\n      }\n    } else if (bitsAllocated === 16) {\n      if (pixelRepresentation === 0) {\n        res = new Uint16Array(size);\n      } else {\n        res = new Int16Array(size);\n      }\n    } else if (bitsAllocated === 32) {\n      if (pixelRepresentation === 0) {\n        res = new Uint32Array(size);\n      } else {\n        res = new Int32Array(size);\n      }\n    }\n  } catch (error) {\n    if (error instanceof RangeError) {\n      const powerOf2 = Math.floor(Math.log(size) / Math.log(2));\n      logger.error('Cannot allocate array of size: ' +\n        size + ' (>2^' + powerOf2 + ').');\n    }\n  }\n  return res;\n}\n\n/**\n * Get the number of bytes occupied by a data element prefix,\n *   (without its value).\n *\n * WARNING: this is valid for tags with a VR, if not sure use\n *   the 'isTagWithVR' function first.\n *\n * Reference:\n * - [Data Element explicit]{@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/chapter_7.html#table_7.1-1},\n * - [Data Element implicit]{@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/sect_7.5.2.html#table_7.5-1}.\n *\n * ```\n * | Tag | VR  | VL | Value |\n * | 4   | 2   | 2  | X     | -> regular explicit: 8 + X\n * | 4   | 2+2 | 4  | X     | -> 32bit VL: 12 + X\n *\n * | Tag | VL | Value |\n * | 4   | 4  | X     | -> implicit (32bit VL): 8 + X\n *\n * | Tag | Len | Value |\n * | 4   | 4   | X     | -> item: 8 + X\n * ```\n *\n * @param {string} vr The Value Representation of the element.\n * @param {boolean} isImplicit Does the data use implicit VR?\n * @returns {number} The size of the element prefix.\n */\nexport function getDataElementPrefixByteSize(vr, isImplicit) {\n  return isImplicit ? 8 : is32bitVLVR(vr) ? 12 : 8;\n}\n\n/**\n * Is the input VR a known VR.\n *\n * @param {string} vr The vr to test.\n * @returns {boolean} True if known.\n */\nfunction isKnownVR(vr) {\n  const extraVrTypes = ['NONE', 'ox', 'xx', 'xs'];\n  const knownTypes = Object.keys(vrTypes).concat(extraVrTypes);\n  return knownTypes.includes(vr);\n}\n\n/**\n * Small list of used tag keys.\n */\nconst TagKeys = {\n  TransferSyntax: '00020010',\n  SpecificCharacterSet: '00080005',\n  Rows: '00280010',\n  Columns: '00280011',\n  NumberOfFrames: '00280008',\n  BitsAllocated: '00280100',\n  PixelRepresentation: '00280103',\n  PixelData: '7FE00010'\n};\n\n/**\n * DicomParser class.\n *\n * @example\n * import {DicomParser} from '//esm.sh/dwv';\n * // XMLHttpRequest onload callback\n * const onload = function (event) {\n *   // setup the dicom parser\n *   const dicomParser = new DicomParser();\n *   // parse the buffer\n *   dicomParser.parse(event.target.response);\n *   // get the dicom tags\n *   const tags = dicomParser.getDicomElements();\n *   // display the modality\n *   const div = document.getElementById('dwv');\n *   div.appendChild(document.createTextNode(\n *     'Modality: ' + tags['00080060'].value[0]\n *   ));\n * };\n * // DICOM file request\n * const request = new XMLHttpRequest();\n * const url = 'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm';\n * request.open('GET', url);\n * request.responseType = 'arraybuffer';\n * request.onload = onload;\n * request.send();\n */\nexport class DicomParser {\n\n  /**\n   * The list of DICOM elements.\n   *\n   * @type {DataElements}\n   */\n  #dataElements = {};\n\n  /**\n   * Default character set (optional).\n   *\n   * @type {string}\n   */\n  #defaultCharacterSet;\n\n  /**\n   * Default text decoder.\n   *\n   * @type {DefaultTextDecoder}\n   */\n  #defaultTextDecoder = new DefaultTextDecoder();\n\n  /**\n   * Special text decoder.\n   *\n   * @type {DefaultTextDecoder|TextDecoder}\n   */\n  #textDecoder = this.#defaultTextDecoder;\n\n  /**\n   * Decode an input string buffer using the default text decoder.\n   *\n   * @param {Uint8Array} buffer The buffer to decode.\n   * @returns {string} The decoded string.\n   */\n  #decodeString(buffer) {\n    return this.#defaultTextDecoder.decode(buffer);\n  }\n\n  /**\n   * Decode an input string buffer using the 'special' text decoder.\n   *\n   * @param {Uint8Array} buffer The buffer to decode.\n   * @returns {string} The decoded string.\n   */\n  #decodeSpecialString(buffer) {\n    return this.#textDecoder.decode(buffer);\n  }\n\n  /**\n   * Get the default character set.\n   *\n   * @returns {string} The default character set.\n   */\n  getDefaultCharacterSet() {\n    return this.#defaultCharacterSet;\n  }\n\n  /**\n   * Set the default character set.\n   *\n   * @param {string} characterSet The input character set.\n   */\n  setDefaultCharacterSet(characterSet) {\n    this.#defaultCharacterSet = characterSet;\n  }\n\n  /**\n   * Set the text decoder character set.\n   *\n   * @param {string} characterSet The input character set.\n   */\n  setDecoderCharacterSet(characterSet) {\n    /**\n     * The text decoder.\n     *\n     * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder}.\n     *\n     * @external TextDecoder\n     */\n    this.#textDecoder = new TextDecoder(characterSet);\n  }\n\n  // not using type DataElements since the typedef is not exported with the API\n\n  /**\n   * Get the DICOM data elements.\n   *\n   * @returns {Object<string, DataElement>} The data elements.\n   */\n  getDicomElements() {\n    return this.#dataElements;\n  }\n\n  /**\n   * Safely get an elements' first value from the parsed elements.\n   *\n   * @param {string} key The tag key as for example '00100020'.\n   * @returns {any|undefined} The elements' value or undefined.\n   */\n  safeGet(key) {\n    return safeGet(this.#dataElements, key);\n  }\n\n  /**\n   * Read a DICOM tag.\n   *\n   * @param {DataReader} reader The raw data reader.\n   * @param {number} offset The offset where to start to read.\n   * @returns {object} An object containing the tag and the end offset.\n   */\n  #readTag(reader, offset) {\n    // group\n    const group = reader.readHex(offset);\n    offset += Uint16Array.BYTES_PER_ELEMENT;\n    // element\n    const element = reader.readHex(offset);\n    offset += Uint16Array.BYTES_PER_ELEMENT;\n    // return\n    return {\n      tag: new Tag(group, element),\n      endOffset: offset\n    };\n  }\n\n  /**\n   * Read an item data element.\n   *\n   * @param {DataReader} reader The raw data reader.\n   * @param {number} offset The offset where to start to read.\n   * @param {boolean} implicit Is the DICOM VR implicit?\n   * @returns {object} The item data as a list of data elements.\n   */\n  #readItemDataElement(reader, offset, implicit) {\n    const itemData = {};\n\n    // read the first item\n    let item = this.#readDataElement(reader, offset, implicit);\n    offset = item.endOffset;\n\n    // exit if it is a sequence delimitation item\n    if (isSequenceDelimitationItemTag(item.tag)) {\n      return {\n        data: itemData,\n        endOffset: item.endOffset,\n        isSeqDelim: true\n      };\n    }\n\n    // store item (mainly to keep vl)\n    itemData[item.tag.getKey()] = {\n      tag: item.tag,\n      vr: 'NONE',\n      vl: item.vl,\n      undefinedLength: item.undefinedLength\n    };\n\n    if (!item.undefinedLength) {\n      // explicit VR item: read until the end offset\n      const endOffset = offset;\n      offset -= item.vl;\n      while (offset < endOffset) {\n        item = this.#readDataElement(reader, offset, implicit);\n        offset = item.endOffset;\n        itemData[item.tag.getKey()] = item;\n      }\n    } else {\n      // implicit VR item: read until the item delimitation item\n      let isItemDelim = false;\n      while (!isItemDelim) {\n        item = this.#readDataElement(reader, offset, implicit);\n        offset = item.endOffset;\n        isItemDelim = isItemDelimitationItemTag(item.tag);\n        if (!isItemDelim) {\n          itemData[item.tag.getKey()] = item;\n        }\n      }\n    }\n\n    return {\n      data: itemData,\n      endOffset: offset,\n      isSeqDelim: false\n    };\n  }\n\n  /**\n   * Read the pixel item data element.\n   * Ref: [Single frame fragments]{@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/sect_A.4.html#table_A.4-1}.\n   *\n   * @param {DataReader} reader The raw data reader.\n   * @param {number} offset The offset where to start to read.\n   * @param {boolean} implicit Is the DICOM VR implicit?\n   * @returns {object} The item data as an array of data elements.\n   */\n  #readPixelItemDataElement(\n    reader, offset, implicit) {\n    const itemData = [];\n\n    // first item: basic offset table\n    let item = this.#readDataElement(reader, offset, implicit);\n    const offsetTableVl = item.vl;\n    offset = item.endOffset;\n\n    // read until the sequence delimitation item\n    let isSeqDelim = false;\n    while (!isSeqDelim) {\n      item = this.#readDataElement(reader, offset, implicit);\n      offset = item.endOffset;\n      isSeqDelim = isSequenceDelimitationItemTag(item.tag);\n      if (!isSeqDelim) {\n        // force pixel item vr to OB\n        item.vr = 'OB';\n        itemData.push(item);\n      }\n    }\n\n    return {\n      data: itemData,\n      endOffset: offset,\n      offsetTableVl: offsetTableVl\n    };\n  }\n\n  /**\n   * Read a DICOM data element.\n   *\n   * Reference: [DICOM VRs]{@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/sect_6.2.html#table_6.2-1}.\n   *\n   * @param {DataReader} reader The raw data reader.\n   * @param {number} offset The offset where to start to read.\n   * @param {boolean} implicit Is the DICOM VR implicit?\n   * @param {Tag} [untilTag] Optional tag to stop the reading once reached,\n   *   the returned element will only contain the tag.\n   * @returns {DataElement} The data element.\n   */\n  #readDataElement(reader, offset, implicit, untilTag) {\n    // Tag: group, element\n    const readTagRes = this.#readTag(reader, offset);\n    const tag = readTagRes.tag;\n\n    if (typeof untilTag !== 'undefined' &&\n      tag.equals(untilTag)) {\n      const element = new DataElement('');\n      element.tag = tag;\n      return element;\n    }\n\n    offset = readTagRes.endOffset;\n\n    // Value Representation (VR)\n    let vr = null;\n    let is32bitVL = false;\n    if (tag.isWithVR()) {\n      // implicit VR\n      if (implicit) {\n        vr = tag.getVrFromDictionary();\n        if (typeof vr === 'undefined') {\n          vr = 'UN';\n        }\n        is32bitVL = true;\n      } else {\n        vr = this.#decodeString(reader.readUint8Array(offset, 2));\n        offset += 2 * Uint8Array.BYTES_PER_ELEMENT;\n        is32bitVL = is32bitVLVR(vr);\n        // reserved 2 bytes\n        if (is32bitVL) {\n          offset += 2 * Uint8Array.BYTES_PER_ELEMENT;\n        }\n      }\n    } else {\n      vr = 'NONE';\n      is32bitVL = true;\n    }\n\n    // check vr\n    if (!isKnownVR(vr)) {\n      logger.warn('Unknown VR: ' + vr +\n        ' (for tag ' + tag.getKey() + '), treating as \\'UN\\'');\n      vr = 'UN';\n    }\n\n    // Value Length (VL)\n    let vl = 0;\n    if (is32bitVL) {\n      vl = reader.readUint32(offset);\n      offset += Uint32Array.BYTES_PER_ELEMENT;\n    } else {\n      vl = reader.readUint16(offset);\n      offset += Uint16Array.BYTES_PER_ELEMENT;\n    }\n\n    // check the value of VL\n    let undefinedLength = false;\n    if (vl === 0xffffffff) {\n      undefinedLength = true;\n      vl = 0;\n    }\n\n    // treat private tag with unknown VR and zero VL as a sequence (see #799)\n    if (tag.isPrivate() && vr === 'UN' && vl === 0) {\n      vr = 'SQ';\n    }\n\n    let startOffset = offset;\n    let endOffset = startOffset + vl;\n\n    // read sequence elements\n    let data;\n    if (isAnyPixelDataTag(tag) && undefinedLength) {\n      // pixel data sequence (implicit)\n      const pixItemData =\n        this.#readPixelItemDataElement(reader, offset, implicit);\n      offset = pixItemData.endOffset;\n      startOffset += pixItemData.offsetTableVl;\n      data = pixItemData.data;\n      endOffset = offset;\n      vl = offset - startOffset;\n    } else if (vr === 'SQ') {\n      // sequence\n      data = [];\n      let itemData;\n      if (!undefinedLength) {\n        if (vl !== 0) {\n          // explicit VR sequence: read until the end offset\n          const sqEndOffset = offset + vl;\n          while (offset < sqEndOffset) {\n            itemData = this.#readItemDataElement(reader, offset, implicit);\n            data.push(itemData.data);\n            offset = itemData.endOffset;\n          }\n          endOffset = offset;\n          vl = offset - startOffset;\n        }\n      } else {\n        // implicit VR sequence: read until the sequence delimitation item\n        let isSeqDelim = false;\n        while (!isSeqDelim) {\n          itemData = this.#readItemDataElement(reader, offset, implicit);\n          isSeqDelim = itemData.isSeqDelim;\n          offset = itemData.endOffset;\n          // do not store the delimitation item\n          if (!isSeqDelim) {\n            data.push(itemData.data);\n          }\n        }\n        endOffset = offset;\n        vl = offset - startOffset;\n      }\n    }\n\n    // return\n    const element = new DataElement(vr);\n    element.tag = tag;\n    element.vl = vl;\n    element.startOffset = startOffset;\n    element.endOffset = endOffset;\n    // only set if true (only for sequences and items)\n    if (undefinedLength) {\n      element.undefinedLength = undefinedLength;\n    }\n    if (data) {\n      element.items = data;\n    }\n    return element;\n  }\n\n  /**\n   * Interpret the data of an element.\n   *\n   * @param {DataElement} element The data element.\n   * @param {DataReader} reader The raw data reader.\n   * @param {object} [pixelTags] Pixel data related tags.\n   * @returns {object} The interpreted data.\n   */\n  #interpretElement(element, reader, pixelTags) {\n\n    const tag = element.tag;\n    const vl = element.vl;\n    const vr = element.vr;\n    const offset = element.startOffset;\n\n    let bitsAllocated;\n    let pixelRepresentation;\n    if (typeof pixelTags !== 'undefined') {\n      bitsAllocated = pixelTags.bitsAllocated;\n      pixelRepresentation = pixelTags.pixelRepresentation;\n    }\n\n    // data\n    let data = null;\n    const vrType = vrTypes[vr];\n    if (isAnyPixelDataTag(tag)) {\n      if (element.undefinedLength) {\n        // implicit pixel data sequence\n        data = [];\n        for (let j = 0; j < element.items.length; ++j) {\n          data.push(this.#interpretElement(\n            element.items[j], reader, pixelTags));\n        }\n        // remove non parsed items\n        delete element.items;\n      } else {\n        // check bits allocated and VR\n        // https://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/sect_A.2.html\n        if (bitsAllocated > 8 && vr === 'OB') {\n          logger.warn(\n            'Reading DICOM pixel data with bitsAllocated>8 and OB VR' +\n            ', treating as OW'\n          );\n          element.vr = 'OW';\n        }\n        // read\n        data = [];\n        if (bitsAllocated === 1) {\n          data.push(reader.readBinaryArray(\n            offset, vl, pixelTags.imageBufferSize));\n        } else if (bitsAllocated === 8) {\n          if (pixelRepresentation === 0) {\n            data.push(reader.readUint8Array(offset, vl));\n          } else {\n            data.push(reader.readInt8Array(offset, vl));\n          }\n        } else if (bitsAllocated === 16) {\n          if (pixelRepresentation === 0) {\n            data.push(reader.readUint16Array(offset, vl));\n          } else {\n            data.push(reader.readInt16Array(offset, vl));\n          }\n        } else if (bitsAllocated === 32) {\n          data.push(reader.readFloat32Array(offset, vl));\n        } else if (bitsAllocated === 64) {\n          data.push(reader.readFloat64Array(offset, vl));\n        } else {\n          throw new Error('Unsupported bits allocated: ' + bitsAllocated);\n        }\n      }\n    } else if (typeof vrType !== 'undefined') {\n      if (vrType === 'Uint8') {\n        data = reader.readUint8Array(offset, vl);\n      } else if (vrType === 'Uint16') {\n        data = reader.readUint16Array(offset, vl);\n        // keep as binary for 'O*' VR\n        if (vr[0] !== 'O') {\n          data = Array.from(data);\n        }\n      } else if (vrType === 'Uint32') {\n        data = reader.readUint32Array(offset, vl);\n        // keep as binary for 'O*' VR\n        if (vr[0] !== 'O') {\n          data = Array.from(data);\n        }\n      } else if (vrType === 'Uint64') {\n        data = reader.readUint64Array(offset, vl);\n      } else if (vrType === 'Int16') {\n        data = Array.from(reader.readInt16Array(offset, vl));\n      } else if (vrType === 'Int32') {\n        data = Array.from(reader.readInt32Array(offset, vl));\n      } else if (vrType === 'Int64') {\n        data = reader.readInt64Array(offset, vl);\n      } else if (vrType === 'Float32') {\n        data = Array.from(reader.readFloat32Array(offset, vl));\n      } else if (vrType === 'Float64') {\n        data = Array.from(reader.readFloat64Array(offset, vl));\n      } else if (vrType === 'string') {\n        const stream = reader.readUint8Array(offset, vl);\n        if (isCharSetStringVR(vr)) {\n          data = this.#decodeSpecialString(stream);\n        } else {\n          data = this.#decodeString(stream);\n        }\n        data = cleanString(data).split('\\\\');\n      } else {\n        throw new Error('Unknown VR type: ' + vrType);\n      }\n    } else if (vr === 'xx') {\n      // US or OW\n      data = Array.from(reader.readUint16Array(offset, vl));\n    } else if (vr === 'ox') {\n      // OB or OW\n      if (bitsAllocated === 8) {\n        if (pixelRepresentation === 0) {\n          data = Array.from(reader.readUint8Array(offset, vl));\n        } else {\n          data = Array.from(reader.readInt8Array(offset, vl));\n        }\n      } else {\n        if (pixelRepresentation === 0) {\n          data = Array.from(reader.readUint16Array(offset, vl));\n        } else {\n          data = Array.from(reader.readInt16Array(offset, vl));\n        }\n      }\n    } else if (vr === 'xs') {\n      // (US or SS) or (US or SS or OW)\n      if (pixelRepresentation === 0) {\n        data = Array.from(reader.readUint16Array(offset, vl));\n      } else {\n        data = Array.from(reader.readInt16Array(offset, vl));\n      }\n    } else if (vr === 'AT') {\n      // attribute\n      const raw = reader.readUint16Array(offset, vl);\n      data = [];\n      for (let i = 0, leni = raw.length; i < leni; i += 2) {\n        const stri = raw[i].toString(16);\n        const stri1 = raw[i + 1].toString(16);\n        let str = '(';\n        str += '0000'.substring(0, 4 - stri.length) + stri.toUpperCase();\n        str += ',';\n        str += '0000'.substring(0, 4 - stri1.length) + stri1.toUpperCase();\n        str += ')';\n        data.push(str);\n      }\n    } else if (vr === 'SQ') {\n      // sequence\n      data = [];\n      for (let k = 0; k < element.items.length; ++k) {\n        const item = element.items[k];\n        const itemData = {};\n        const keys = Object.keys(item);\n        let sqBitsAllocated = bitsAllocated;\n        let sqPixelRepresentation = pixelRepresentation;\n        for (let l = 0; l < keys.length; ++l) {\n          // check if local bitsAllocated\n          // (inside item loop to get interpreted value)\n          let dataElement = item[TagKeys.BitsAllocated];\n          if (typeof dataElement !== 'undefined' &&\n            typeof dataElement.value !== 'undefined') {\n            sqBitsAllocated = dataElement.value[0];\n          }\n          // check if local pixelRepresentation\n          // (inside item loop to get interpreted value)\n          dataElement = item[TagKeys.PixelRepresentation];\n          if (typeof dataElement !== 'undefined' &&\n            typeof dataElement.value !== 'undefined') {\n            sqPixelRepresentation = dataElement.value[0];\n          }\n          const sqPixelTags = {\n            bitsAllocated: sqBitsAllocated,\n            pixelRepresentation: sqPixelRepresentation\n          };\n          const subElement = item[keys[l]];\n          subElement.value = this.#interpretElement(\n            subElement, reader, sqPixelTags);\n          delete subElement.tag;\n          delete subElement.vl;\n          delete subElement.startOffset;\n          delete subElement.endOffset;\n          itemData[keys[l]] = subElement;\n        }\n        data.push(itemData);\n      }\n      // remove non parsed elements\n      delete element.items;\n    } else if (vr === 'NONE') {\n      // no VR -> no data\n      data = [];\n    } else {\n      logger.warn('Unknown VR: ' + vr +\n        ' (for tag ' + element.tag.getKey() + ')');\n      // empty data...\n      data = [];\n    }\n\n    return data;\n  }\n\n  /**\n   * Interpret the data of a list of elements.\n   *\n   * @param {DataElements} elements A list of data elements.\n   * @param {DataReader} reader The raw data reader.\n   * @param {object} [pixelTags] Pixel data related tags.\n   */\n  #interpret(elements, reader, pixelTags) {\n\n    const keys = Object.keys(elements);\n    for (let i = 0; i < keys.length; ++i) {\n      const element = elements[keys[i]];\n      if (typeof element.value === 'undefined') {\n        element.value = this.#interpretElement(\n          element, reader, pixelTags);\n      }\n      // delete interpretation specific properties\n      delete element.tag;\n      delete element.vl;\n      delete element.startOffset;\n      delete element.endOffset;\n    }\n  }\n\n  /**\n   * Parse a DICOM buffer.\n   * Fills in the member object 'dataElements'.\n   *\n   * @param {ArrayBuffer} buffer The input array buffer.\n   * @param {Tag} [untilTag] Optional tag to stop the parsing once reached.\n   */\n  parse(buffer, untilTag) {\n    let offset = 0;\n    let syntax = '';\n    let dataElement = null;\n    // default readers\n    const metaReader = new DataReader(buffer);\n    let dataReader = new DataReader(buffer);\n\n    // 128 -> 132: magic word\n    offset = 128;\n    const magicword = this.#decodeString(metaReader.readUint8Array(offset, 4));\n    offset += 4 * Uint8Array.BYTES_PER_ELEMENT;\n    if (magicword === 'DICM') {\n      // 0002, 0000: FileMetaInformationGroupLength (vr='UL')\n      dataElement = this.#readDataElement(metaReader, offset, false);\n      dataElement.value = this.#interpretElement(dataElement, metaReader);\n      // increment offset\n      offset = dataElement.endOffset;\n      // store the data element\n      this.#dataElements[dataElement.tag.getKey()] = dataElement;\n      // get meta length\n      const metaLength = dataElement.value[0];\n\n      // meta elements\n      const metaEnd = offset + metaLength;\n      while (offset < metaEnd) {\n        // get the data element\n        dataElement = this.#readDataElement(metaReader, offset, false);\n        offset = dataElement.endOffset;\n        // store the data element\n        this.#dataElements[dataElement.tag.getKey()] = dataElement;\n      }\n\n      // check the TransferSyntaxUID (has to be there!)\n      dataElement = this.#dataElements[TagKeys.TransferSyntax];\n      if (typeof dataElement === 'undefined') {\n        throw new Error('Not a valid DICOM file (no TransferSyntaxUID found)');\n      }\n      dataElement.value = this.#interpretElement(dataElement, metaReader);\n      syntax = dataElement.value[0];\n\n    } else {\n      logger.warn('Invalid DICM prefix (' + magicword +\n        '), trying to guess tansfer syntax.');\n      // read first element\n      dataElement = this.#readDataElement(dataReader, 0, false);\n      // guess transfer syntax\n      const tsElement = guessTransferSyntax(dataElement);\n      // store\n      this.#dataElements[tsElement.tag.getKey()] = tsElement;\n      syntax = tsElement.value[0];\n      // reset offset\n      offset = 0;\n    }\n\n    // check transfer syntax support\n    if (!isReadSupportedTransferSyntax(syntax)) {\n      throw new Error('Unsupported DICOM transfer syntax: \\'' + syntax +\n        '\\' (' + getTransferSyntaxName(syntax) + ')');\n    }\n\n    // set implicit flag\n    let implicit = false;\n    if (isImplicitTransferSyntax(syntax)) {\n      implicit = true;\n    }\n\n    // Big Endian\n    if (isBigEndianTransferSyntax(syntax)) {\n      dataReader = new DataReader(buffer, false);\n    }\n\n    let reachedUntilTag = false;\n\n    // DICOM data elements\n    while (offset < buffer.byteLength) {\n      // get the data element\n      dataElement = this.#readDataElement(\n        dataReader, offset, implicit, untilTag);\n      // until tag\n      if (typeof untilTag !== 'undefined' &&\n        dataElement.tag.equals(untilTag)) {\n        reachedUntilTag = true;\n        break;\n      }\n      // increment offset\n      offset = dataElement.endOffset;\n      // store the data element\n      const key = dataElement.tag.getKey();\n      if (typeof this.#dataElements[key] === 'undefined') {\n        this.#dataElements[key] = dataElement;\n      } else {\n        logger.warn('Not saving duplicate tag: ' + key);\n      }\n    }\n\n    // safety checks...\n    if (isNaN(offset)) {\n      throw new Error('Problem while parsing, bad offset');\n    }\n    if (!reachedUntilTag && buffer.byteLength !== offset) {\n      logger.warn('Did not reach the end of the buffer: ' +\n        offset + ' != ' + buffer.byteLength);\n    }\n\n    //-------------------------------------------------\n    // values needed for data interpretation\n\n    // pixel specific\n    let pixelTags;\n    if (hasAnyPixelDataElement(this.#dataElements)) {\n      // PixelRepresentation 0->unsigned, 1->signed\n      let pixelRepresentation = 0;\n      dataElement = this.#dataElements[TagKeys.PixelRepresentation];\n      if (typeof dataElement !== 'undefined') {\n        dataElement.value = this.#interpretElement(dataElement, dataReader);\n        pixelRepresentation = dataElement.value[0];\n      } else {\n        logger.warn(\n          'Reading DICOM pixel data with default pixelRepresentation.');\n      }\n\n      // BitsAllocated\n      let bitsAllocated = 16;\n      dataElement = this.#dataElements[TagKeys.BitsAllocated];\n      if (typeof dataElement !== 'undefined') {\n        dataElement.value = this.#interpretElement(dataElement, dataReader);\n        bitsAllocated = dataElement.value[0];\n      } else {\n        logger.warn('Reading DICOM pixel data with default bitsAllocated.');\n      }\n\n      // NumberOfFrames\n      let numberOfFrames = 1;\n      dataElement = this.#dataElements[TagKeys.NumberOfFrames];\n      if (typeof dataElement !== 'undefined') {\n        dataElement.value = this.#interpretElement(dataElement, dataReader);\n        numberOfFrames = parseInt(dataElement.value[0], 10);\n      }\n\n      pixelTags = {\n        pixelRepresentation,\n        bitsAllocated,\n        numberOfFrames\n      };\n\n      // image buffer size\n      let rows;\n      dataElement = this.#dataElements[TagKeys.Rows];\n      if (typeof dataElement !== 'undefined') {\n        dataElement.value = this.#interpretElement(dataElement, dataReader);\n        rows = parseInt(dataElement.value[0], 10);\n      }\n      let cols;\n      dataElement = this.#dataElements[TagKeys.Columns];\n      if (typeof dataElement !== 'undefined') {\n        dataElement.value = this.#interpretElement(dataElement, dataReader);\n        cols = parseInt(dataElement.value[0], 10);\n      }\n      if (typeof rows !== 'undefined' &&\n        typeof cols !== 'undefined') {\n        pixelTags['imageBufferSize'] = rows * cols * numberOfFrames;\n      }\n    }\n\n    // default character set\n    if (typeof this.#defaultCharacterSet !== 'undefined') {\n      this.setDecoderCharacterSet(this.#defaultCharacterSet);\n    }\n\n    // SpecificCharacterSet\n    dataElement = this.#dataElements[TagKeys.SpecificCharacterSet];\n    if (typeof dataElement !== 'undefined') {\n      dataElement.value = this.#interpretElement(dataElement, dataReader);\n      let charSetTerm;\n      if (dataElement.value.length === 1) {\n        charSetTerm = dataElement.value[0];\n      } else {\n        charSetTerm = dataElement.value[1];\n        logger.warn('Unsupported character set with code extensions: \\'' +\n          charSetTerm + '\\'.');\n      }\n      this.setDecoderCharacterSet(getUtfLabel(charSetTerm));\n    }\n\n    // interpret the dicom elements\n    this.#interpret(this.#dataElements, dataReader, pixelTags);\n\n    // handle fragmented pixel buffer\n    // Reference: http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/sect_8.2.html\n    // (third note, \"Depending on the transfer syntax...\")\n    dataElement = this.#dataElements[TagKeys.PixelData];\n    if (typeof dataElement !== 'undefined') {\n      if (dataElement.undefinedLength) {\n        const numberOfFrames = pixelTags.numberOfFrames;\n        const pixItems = dataElement.value;\n        if (pixItems.length > 1 && pixItems.length > numberOfFrames) {\n          // concatenate pixel data items\n          // concat does not work on typed arrays\n          //this.pixelBuffer = this.pixelBuffer.concat( dataElement.data );\n          // manual concat...\n          const nItemPerFrame = pixItems.length / numberOfFrames;\n          const newPixItems = [];\n          let index = 0;\n          for (let f = 0; f < numberOfFrames; ++f) {\n            index = f * nItemPerFrame;\n            // calculate the size of a frame\n            let size = 0;\n            for (let i = 0; i < nItemPerFrame; ++i) {\n              size += pixItems[index + i].length;\n            }\n            // create new buffer\n            const newBuffer = new pixItems[0].constructor(size);\n            // fill new buffer\n            let fragOffset = 0;\n            for (let j = 0; j < nItemPerFrame; ++j) {\n              newBuffer.set(pixItems[index + j], fragOffset);\n              fragOffset += pixItems[index + j].length;\n            }\n            newPixItems[f] = newBuffer;\n          }\n          // store as pixel data\n          dataElement.value = newPixItems;\n        }\n      }\n    }\n  }\n\n} // class DicomParser\n","import {Index} from '../math/index.js';\nimport {Point} from '../math/point.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Matrix33} from '../math/matrix.js';\nimport {Scalar2D} from '../math/scalar.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Immutable Size class.\n * Warning: the input array is NOT cloned, modifying it will\n *  modify the index values.\n */\nexport class Size {\n\n  /**\n   * The size values.\n   *\n   * @type {number[]}\n   */\n  #values;\n\n  /**\n   * @param {number[]} values The size values.\n   */\n  constructor(values) {\n    if (!values || typeof values === 'undefined') {\n      throw new Error('Cannot create size with no values.');\n    }\n    if (values.length === 0) {\n      throw new Error('Cannot create size with empty values.');\n    }\n    const valueCheck = function (val) {\n      return !isNaN(val) && val !== 0;\n    };\n    if (!values.every(valueCheck)) {\n      throw new Error('Cannot create size with non number or zero values.');\n    }\n    this.#values = values;\n  }\n\n  /**\n   * Get the size value at the given array index.\n   *\n   * @param {number} i The index to get.\n   * @returns {number} The value.\n   */\n  get(i) {\n    return this.#values[i];\n  }\n\n  /**\n   * Get the length of the index.\n   *\n   * @returns {number} The length.\n   */\n  length() {\n    return this.#values.length;\n  }\n\n  /**\n   * Get a string representation of the size.\n   *\n   * @returns {string} The Size as a string.\n   */\n  toString() {\n    return '(' + this.#values.toString() + ')';\n  }\n\n  /**\n   * Get the values of this index.\n   *\n   * @returns {number[]} The array of values.\n   */\n  getValues() {\n    return this.#values.slice();\n  }\n\n  /**\n   * Check if a dimension exists and has more than one element.\n   *\n   * @param {number} dimension The dimension to check.\n   * @returns {boolean} True if the size is more than one.\n   */\n  moreThanOne(dimension) {\n    return this.length() >= dimension + 1 && this.get(dimension) !== 1;\n  }\n\n  /**\n   * Check if the associated data is scrollable in 3D.\n   *\n   * @param {Matrix33} [viewOrientation] The orientation matrix.\n   * @returns {boolean} True if scrollable.\n   */\n  canScroll3D(viewOrientation) {\n    let dimension = 2;\n    if (typeof viewOrientation !== 'undefined') {\n      dimension = viewOrientation.getThirdColMajorDirection();\n    }\n    return this.moreThanOne(dimension);\n  }\n\n  /**\n   * Check if the associated data is scrollable: either in 3D or\n   * in other directions.\n   *\n   * @param {Matrix33} viewOrientation The orientation matrix.\n   * @returns {boolean} True if scrollable.\n   */\n  canScroll(viewOrientation) {\n    let canScroll = this.canScroll3D(viewOrientation);\n    // check possible other dimensions\n    for (let i = 3; i < this.length(); ++i) {\n      canScroll = canScroll || this.moreThanOne(i);\n    }\n    return canScroll;\n  }\n\n  /**\n   * Get the size of a given dimension.\n   *\n   * @param {number} dimension The dimension.\n   * @param {number} [start] Optional start dimension to start counting from.\n   * @returns {number} The size.\n   */\n  getDimSize(dimension, start) {\n    if (dimension > this.length()) {\n      return null;\n    }\n    if (typeof start === 'undefined') {\n      start = 0;\n    } else {\n      if (start < 0 || start > dimension) {\n        throw new Error('Invalid start value for getDimSize');\n      }\n    }\n    let size = 1;\n    for (let i = start; i < dimension; ++i) {\n      size *= this.get(i);\n    }\n    return size;\n  }\n\n  /**\n   * Get the total size.\n   *\n   * @param {number} [start] Optional start dimension to base the offset on.\n   * @returns {number} The total size.\n   */\n  getTotalSize(start) {\n    return this.getDimSize(this.length(), start);\n  }\n\n  /**\n   * Check for equality.\n   *\n   * @param {Size} rhs The object to compare to.\n   * @returns {boolean} True if both objects are equal.\n   */\n  equals(rhs) {\n    // check input\n    if (!rhs) {\n      return false;\n    }\n    // check length\n    const length = this.length();\n    if (length !== rhs.length()) {\n      return false;\n    }\n    // check values\n    for (let i = 0; i < length; ++i) {\n      if (this.get(i) !== rhs.get(i)) {\n        return false;\n      }\n    }\n    // seems ok!\n    return true;\n  }\n\n  /**\n   * Check that an index is within bounds.\n   *\n   * @param {Index} index The index to check.\n   * @param {number[]} dirs Optional list of directions to check.\n   * @returns {boolean} True if the given coordinates are within bounds.\n   */\n  isInBounds(index, dirs) {\n    // check input\n    if (!index) {\n      return false;\n    }\n    // check length\n    const length = this.length();\n    if (length !== index.length()) {\n      return false;\n    }\n    // create dirs if not there\n    if (typeof dirs === 'undefined') {\n      dirs = [];\n      for (let j = 0; j < length; ++j) {\n        dirs.push(j);\n      }\n    } else {\n      for (let k = 0; k < length; ++k) {\n        if (dirs[k] > length - 1) {\n          throw new Error('Wrong input dir value: ' + dirs[k]);\n        }\n      }\n    }\n    // check values is 0 <= v < size\n    const inBound = function (value, size) {\n      return value >= 0 && value < size;\n    };\n    // check\n    for (let i = 0; i < dirs.length; ++i) {\n      if (!inBound(index.get(dirs[i]), this.get(dirs[i]))) {\n        return false;\n      }\n    }\n    // seems ok!\n    return true;\n  }\n\n  /**\n   * Convert an index to an offset in memory.\n   *\n   * @param {Index} index The index to convert.\n   * @param {number} [start] Optional start dimension to base the offset on.\n   * @returns {number} The offset or -1 if out of bounds.\n   */\n  indexToOffset(index, start) {\n    // index cannot have more dimensions than this size\n    if (index.length() > this.length()) {\n      throw new Error('Incompatible index and size length');\n    }\n    if (typeof start === 'undefined') {\n      start = 0;\n    } else {\n      if (start < 0 || start > this.length() - 1) {\n        throw new Error('Invalid start value for indexToOffset');\n      }\n    }\n    let offset = 0;\n    for (let i = start; i < index.length(); ++i) {\n      const dimMax = this.get(i);\n      const dimIndex = index.get(i);\n\n      if (dimIndex >= dimMax || dimIndex < 0) {\n        // This index is outside the bounds of the geometry\n        return -1;\n      }\n\n      offset += dimIndex * this.getDimSize(i, start);\n    }\n    return offset;\n  }\n\n  /**\n   * Convert an offset in memory to an index.\n   *\n   * @param {number} offset The offset to convert.\n   * @returns {Index} The index.\n   */\n  offsetToIndex(offset) {\n    const values = new Array(this.length());\n    let off = offset;\n    let dimSize = 0;\n    for (let i = this.length() - 1; i > 0; --i) {\n      dimSize = this.getDimSize(i);\n      values[i] = Math.floor(off / dimSize);\n      off = off - values[i] * dimSize;\n    }\n    values[0] = off;\n    return new Index(values);\n  }\n\n  /**\n   * Get the 2D base of this size.\n   *\n   * @returns {Scalar2D} The 2D base [0,1] as {x,y}.\n   */\n  get2D() {\n    return {\n      x: this.get(0),\n      y: this.get(1)\n    };\n  }\n\n  /**\n   * Normalise a list of values to this size.\n   *\n   * @param {number[]} inValues The input values.\n   * @param {number[]} [extraValues] Optional values used\n   * to fill extra dimensions.\n   * @returns {number[]} The result values.\n   */\n  #normaliseValues(inValues, extraValues) {\n    // will reduce if needed\n    const values = inValues.slice(0, this.length());\n    // append if needed\n    for (let i = inValues.length; i < this.length(); ++i) {\n      if (typeof extraValues !== 'undefined' &&\n        typeof extraValues[i] !== 'undefined'\n      ) {\n        values.push(extraValues[i]);\n      } else {\n        values.push(0);\n      }\n    }\n    return values;\n  }\n\n  /**\n   * Normalise a point to this size.\n   *\n   * @param {Point} point The input point.\n   * @param {Point} [extra] Optional point used to fill extra dimensions.\n   * @returns {Point} The result point.\n   */\n  normalisePoint(point, extra) {\n    let extraValues;\n    if (typeof extra !== 'undefined') {\n      extraValues = extra.getValues();\n    }\n    const newValues = this.#normaliseValues(point.getValues(), extraValues);\n    return new Point(newValues);\n  }\n\n  /**\n   * Normalise an index to this size.\n   *\n   * @param {Index} index The input index.\n   * @param {Index} [extra] Optional index used to fill extra dimensions.\n   * @returns {Index} The result point.\n   */\n  normaliseIndex(index, extra) {\n    let extraValues;\n    if (typeof extra !== 'undefined') {\n      extraValues = extra.getValues();\n    }\n    const newValues = this.#normaliseValues(index.getValues(), extraValues);\n    return new Index(newValues);\n  }\n\n} // Size class\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {Scalar2D} from '../math/scalar.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Immutable Spacing class.\n * Warning: the input array is NOT cloned, modifying it will\n *  modify the index values.\n */\nexport class Spacing {\n\n  /**\n   * The spacing values.\n   *\n   * @type {number[]}\n   */\n  #values;\n\n  /**\n   * @param {number[]} values The spacing values.\n   */\n  constructor(values) {\n    if (!values || typeof values === 'undefined') {\n      throw new Error('Cannot create spacing with no values.');\n    }\n    if (values.length === 0) {\n      throw new Error('Cannot create spacing with empty values.');\n    }\n    const valueCheck = function (val) {\n      return !isNaN(val) && val !== 0;\n    };\n    if (!values.every(valueCheck)) {\n      throw new Error('Cannot create spacing with non number or zero values.');\n    }\n    this.#values = values;\n  }\n\n  /**\n   * Get the spacing value at the given array index.\n   *\n   * @param {number} i The index to get.\n   * @returns {number} The value.\n   */\n  get(i) {\n    return this.#values[i];\n  }\n\n  /**\n   * Get the length of the spacing.\n   *\n   * @returns {number} The length.\n   */\n  length() {\n    return this.#values.length;\n  }\n\n  /**\n   * Get a string representation of the spacing.\n   *\n   * @returns {string} The spacing as a string.\n   */\n  toString() {\n    return '(' + this.#values.toString() + ')';\n  }\n\n  /**\n   * Get the values of this spacing.\n   *\n   * @returns {number[]} The array of values.\n   */\n  getValues() {\n    return this.#values.slice();\n  }\n\n  /**\n   * Check for equality.\n   *\n   * @param {Spacing} rhs The object to compare to.\n   * @returns {boolean} True if both objects are equal.\n   */\n  equals(rhs) {\n    // check input\n    if (!rhs) {\n      return false;\n    }\n    // check length\n    const length = this.length();\n    if (length !== rhs.length()) {\n      return false;\n    }\n    // check values\n    for (let i = 0; i < length; ++i) {\n      if (this.get(i) !== rhs.get(i)) {\n        return false;\n      }\n    }\n    // seems ok!\n    return true;\n  }\n\n  /**\n   * Get the 2D base of this size.\n   *\n   * @returns {Scalar2D} The 2D base [col,row] as {x,y}.\n   */\n  get2D() {\n    return {\n      x: this.get(0),\n      y: this.get(1)\n    };\n  }\n\n} // Spacing class\n","/**\n * Statistics storage class.\n * 'simple' statistics do not include median, p25 nor p75.\n */\nexport class Statistics {\n  /**\n   * Minimum.\n   *\n   * @type {number}\n   */\n  min;\n  /**\n   * Maximum.\n   *\n   * @type {number}\n   */\n  max;\n  /**\n   * Mean.\n   *\n   * @type {number}\n   */\n  mean;\n  /**\n   * Standard deviation.\n   *\n   * @type {number}\n   */\n  stdDev;\n  /**\n   * Median.\n   *\n   * @type {number|undefined}\n   */\n  median;\n  /**\n   * 25th percentile.\n   *\n   * @type {number|undefined}\n   */\n  p25;\n  /**\n   * 75th percentile.\n   *\n   * @type {number|undefined}\n   */\n  p75;\n\n  /**\n   * @param {number} min The minimum.\n   * @param {number} max The maxnimum.\n   * @param {number} mean The mean.\n   * @param {number} stdDev The standard deviation.\n   */\n  constructor(min, max, mean, stdDev) {\n    this.min = min;\n    this.max = max;\n    this.mean = mean;\n    this.stdDev = stdDev;\n  }\n}\n\n/**\n * Get statistics on an input array of number.\n * Note: could use {@link https://github.com/tmcw/simple-statistics}.\n *\n * @param {number[]} values The array of values to extract stats from.\n * @param {string[]} flags A list of stat value names to calculate.\n * @returns {Statistics} A statistics object.\n */\nexport function getStats(values, flags) {\n  if (includesFullStatsFlags(flags)) {\n    return getFullStats(values);\n  } else {\n    return getBasicStats(values);\n  }\n}\n\n/**\n * Does the input flag list contain a full stat element?\n *\n * @param {string[]} flags A list of stat values to calculate.\n * @returns {boolean} True if one of the flags is a full stat flag.\n */\nfunction includesFullStatsFlags(flags) {\n  return typeof flags !== 'undefined' &&\n    flags !== null &&\n    (flags.includes('median') ||\n      flags.includes('p25') ||\n      flags.includes('p75'));\n}\n\n/**\n * Get simple stats: minimum, maximum, mean and standard deviation\n * of an array of values.\n *\n * @param {number[]} values The array of values to extract stats from.\n * @returns {Statistics} Simple statistics (no median, p25 nor p75).\n */\nexport function getBasicStats(values) {\n  let min = values[0];\n  let max = min;\n  let sum = 0;\n  let sumSqr = 0;\n  let val = 0;\n  const length = values.length;\n  for (let i = 0; i < length; ++i) {\n    val = values[i];\n    if (val < min) {\n      min = val;\n    } else if (val > max) {\n      max = val;\n    }\n    sum += val;\n    sumSqr += val * val;\n  }\n\n  const mean = sum / length;\n  // see http://en.wikipedia.org/wiki/Algorithms_for_calculating_variance\n  let variance = sumSqr / length - mean * mean;\n  if (variance < 0) {\n    variance = 0;\n  }\n  const stdDev = Math.sqrt(variance);\n\n  return new Statistics(min, max, mean, stdDev);\n}\n\n/**\n * Get full stats: minimum, maximum, mean, standard deviation, median, 25%\n * and 75% percentile of an array of values.\n *\n * @param {number[]} values The array of values to extract stats from.\n * @returns {Statistics} Complete statistics (includes median, p25 and p75).\n */\nfunction getFullStats(values) {\n  // get basic stats\n  const stats = getBasicStats(values);\n\n  // sort array... can get slow...\n  values.sort(function (a, b) {\n    return a - b;\n  });\n\n  stats.median = getPercentile(values, 0.5);\n  stats.p25 = getPercentile(values, 0.25);\n  stats.p75 = getPercentile(values, 0.75);\n\n  return stats;\n}\n\n/**\n * Get an arrays' percentile. Uses linear interpolation for percentiles\n *   that lie between data points.\n * See: {@link https://en.wikipedia.org/wiki/Percentile} (second variant interpolation).\n *\n * @param {number[]} values The sorted array of values.\n * @param {number} ratio The percentile ratio [0-1].\n * @returns {number} The percentile.\n */\nfunction getPercentile(values, ratio) {\n  // check input\n  if (values.length === 0) {\n    throw new Error('Empty array provided for percentile calculation.');\n  }\n  if (ratio < 0 || ratio > 1) {\n    throw new Error(\n      'Invalid ratio provided for percentile calculation: ' + ratio);\n  }\n  // return min for ratio=0 amd max for ratio=1\n  if (ratio === 0) {\n    return values[0];\n  } else if (ratio === 1) {\n    return values[values.length - 1];\n  }\n  // general case: interpolate between indices if needed\n  const i = (values.length - 1) * ratio;\n  const i0 = Math.floor(i);\n  const v0 = values[i0];\n  const v1 = values[i0 + 1];\n  return v0 + (v1 - v0) * (i - i0);\n}\n\n/**\n * Unique ID generator.\n *\n * See {@link http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript}\n *   and this {@link http://stackoverflow.com/a/13403498 answer}.\n *\n * @returns {string} A unique ID.\n */\nexport function guid() {\n  return Math.random().toString(36).substring(2, 15);\n}\n\n/**\n * Number range.\n */\nexport class NumberRange {\n  /**\n   * @type {number}\n   */\n  min;\n  /**\n   * @type {number}\n   */\n  max;\n  /**\n   * @param {number} min The minimum.\n   * @param {number} max The maximum.\n   */\n  constructor(min, max) {\n    this.min = min;\n    this.max = max;\n  }\n}\n","/**\n * Class to store a boolean result and a message.\n */\nexport class BooleanResult {\n  /**\n   * @type {boolean}\n   */\n  success;\n  /**\n   * @type {string|undefined}\n   */\n  message;\n\n  /**\n   * @param {boolean} success The success flag.\n   */\n  constructor(success) {\n    this.success = success;\n  }\n}\n","import {\n  getIdentityMat33,\n  REAL_WORLD_EPSILON,\n  REAL_WORLD_EXPONENT\n} from '../math/matrix.js';\nimport {Point3D, Point} from '../math/point.js';\nimport {Vector3D} from '../math/vector.js';\nimport {Index} from '../math/index.js';\nimport {getBasicStats} from '../math/stats.js';\nimport {precisionRound} from '../utils/string.js';\nimport {logger} from '../utils/logger.js';\nimport {Size} from './size.js';\nimport {Spacing} from './spacing.js';\nimport {BooleanResult} from '../utils/result.js';\nimport {arrayMap} from '../utils/array.js';\nimport {Matrix33} from '../math/matrix.js';\n\n/**\n * 2D/3D Geometry class.\n */\nexport class Geometry {\n\n  /**\n   * Array of origins.\n   *\n   * @type {Point3D[]}\n   */\n  #origins;\n\n  /**\n   * Data size.\n   *\n   * @type {Size}\n   */\n  #size;\n\n  /**\n   * Data spacing.\n   *\n   * @type {Spacing}\n   */\n  #spacing;\n\n  /**\n   * Local helper object for time points.\n   *\n   * @type {Object<string, Point3D[]>}\n   */\n  #timeOrigins = {};\n\n  /**\n   * Initial time index.\n   *\n   * @type {number}\n   */\n  #initialTime;\n\n  /**\n   * Data orientation.\n   *\n   * @type {Matrix33}\n   */\n  #orientation = getIdentityMat33();\n\n  /**\n   * @param {Point3D[]} origins The object origins.\n   * @param {Size} size The object size.\n   * @param {Spacing} spacing The object spacing.\n   * @param {Matrix33} [orientation] The object orientation (3*3 matrix,\n   *   default to 3*3 identity).\n   * @param {number} [time] Optional time index.\n   */\n  constructor(origins, size, spacing, orientation, time) {\n    this.#origins = origins;\n    this.#size = size;\n    this.#spacing = spacing;\n    if (typeof time !== 'undefined') {\n      this.#initialTime = time;\n      this.#timeOrigins[time] = origins.slice();\n    }\n    // check input orientation\n    if (typeof orientation !== 'undefined') {\n      this.#orientation = orientation;\n    }\n  }\n\n  /**\n   * Clone the geometry.\n   *\n   * @returns {Geometry} A clone of this geometry.\n   */\n  clone() {\n    return new Geometry(\n      this.#origins.slice(),\n      new Size(this.#size.getValues()),\n      new Spacing(this.#spacing.getValues()),\n      new Matrix33(this.#orientation.getValues()),\n      this.#initialTime\n    );\n  }\n\n  /**\n   * Get the time value that was passed at construction.\n   *\n   * @returns {number} The time value.\n   */\n  getInitialTime() {\n    return this.#initialTime;\n  }\n\n  /**\n   * Set the initial time.\n   *\n   * @param {number} time The new time.\n   */\n  setInitialTime(time) {\n    if (typeof this.#timeOrigins[this.#initialTime] !== 'undefined') {\n      delete this.#timeOrigins[this.#initialTime];\n    }\n    this.#initialTime = time;\n    this.#timeOrigins[time] = this.#origins.slice();\n  }\n\n  /**\n   * Get the total number of slices.\n   * Can be different from what is stored in the size object\n   *  during a volume with time points creation process.\n   *\n   * @returns {number} The total count.\n   */\n  getCurrentTotalNumberOfSlices() {\n    const keys = Object.keys(this.#timeOrigins);\n    if (keys.length === 0) {\n      return this.#origins.length;\n    }\n    let count = 0;\n    for (let i = 0; i < keys.length; ++i) {\n      count += this.#timeOrigins[keys[i]].length;\n    }\n    return count;\n  }\n\n  /**\n   * Check if a time point has associated slices.\n   *\n   * @param {number} time The time point to check.\n   * @returns {boolean} True if slices are present.\n   */\n  hasSlicesAtTime(time) {\n    return typeof this.#timeOrigins[time] !== 'undefined';\n  }\n\n  /**\n   * Get the number of slices stored for time points preceding\n   * the input one.\n   *\n   * @param {number} time The time point to check.\n   * @returns {number|undefined} The count.\n   */\n  getCurrentNumberOfSlicesBeforeTime(time) {\n    const keys = Object.keys(this.#timeOrigins);\n    if (keys.length === 0) {\n      return undefined;\n    }\n    let count = 0;\n    for (let i = 0; i < keys.length; ++i) {\n      const key = keys[i];\n      if (parseInt(key, 10) === time) {\n        break;\n      }\n      count += this.#timeOrigins[key].length;\n    }\n    return count;\n  }\n\n  /**\n   * Get the object origin.\n   * This should be the lowest origin to ease calculations (?).\n   *\n   * @returns {Point3D} The object origin.\n   */\n  getOrigin() {\n    return this.#origins[0];\n  }\n\n  /**\n   * Get the object origins.\n   *\n   * @returns {Point3D[]} The object origins.\n   */\n  getOrigins() {\n    return this.#origins;\n  }\n\n  /**\n   * Check if a point is in the origin list.\n   *\n   * @param {Point3D} point3D The point to check.\n   * @param {number} [tol] Optional number comparison tolerance\n   *   defaults to Number.EPSILON.\n   * @returns {boolean} True if in list.\n   */\n  includesOrigin(point3D, tol) {\n    for (let i = 0; i < this.#origins.length; ++i) {\n      if (this.#origins[i].isSimilar(point3D, tol)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Get the object size.\n   * Warning: the size comes as stored in DICOM, meaning that it could\n   * be oriented.\n   *\n   * @param {Matrix33} [viewOrientation] The view orientation (optional).\n   * @returns {Size} The object size.\n   */\n  getSize(viewOrientation) {\n    let res = this.#size;\n    if (viewOrientation && typeof viewOrientation !== 'undefined') {\n      let values = getOrientedArray3D(\n        [\n          this.#size.get(0),\n          this.#size.get(1),\n          this.#size.get(2)\n        ],\n        viewOrientation);\n      values = values.map(Math.abs);\n      res = new Size(values.concat(this.#size.getValues().slice(3)));\n    }\n    return res;\n  }\n\n  /**\n   * Calculate slice spacing from origins and replace current\n   *   if needed.\n   */\n  updateSliceSpacing() {\n    const geoSliceSpacing = getSliceGeometrySpacing(this.#origins);\n    // update local if needed\n    if (typeof geoSliceSpacing !== 'undefined') {\n      // 1 is default\n      if (this.#spacing.get(2) !== 1 &&\n        this.#spacing.get(2) !== geoSliceSpacing) {\n        logger.debug('Using geometric spacing ' + geoSliceSpacing +\n          ' instead of tag spacing ' + this.#spacing.get(2));\n      }\n      const values = this.#spacing.getValues();\n      values[2] = geoSliceSpacing;\n      this.#spacing = new Spacing(values);\n    }\n  }\n\n  /**\n   * Get the object spacing.\n   * Warning: the spacing comes as stored in DICOM, meaning that it could\n   * be oriented.\n   *\n   * @param {Matrix33} [viewOrientation] The view orientation (optional).\n   * @returns {Spacing} The object spacing.\n   */\n  getSpacing(viewOrientation) {\n    let res = this.#spacing;\n    if (viewOrientation && typeof viewOrientation !== 'undefined') {\n      let orientedValues = getOrientedArray3D(\n        [\n          this.#spacing.get(0),\n          this.#spacing.get(1),\n          this.#spacing.get(2)\n        ],\n        viewOrientation);\n      orientedValues = orientedValues.map(Math.abs);\n      res = new Spacing(orientedValues);\n    }\n    return res;\n  }\n\n  /**\n   * Get the image spacing in real world.\n   *\n   * @returns {Spacing} The object spacing.\n   */\n  getRealSpacing() {\n    // asOneAndZeros to not change spacing values...\n    return this.getSpacing(\n      this.#orientation.getInverse().asOneAndZeros()\n    );\n  }\n\n  /**\n   * Get the object orientation.\n   *\n   * @returns {Matrix33} The object orientation.\n   */\n  getOrientation() {\n    return this.#orientation;\n  }\n\n  /**\n   * Get the slice position of a point in the current slice layout.\n   * Slice indices increase with decreasing origins (high index -> low origin),\n   * this simplified the handling of reconstruction since it means\n   * the displayed data is in the same 'direction' as the extracted data.\n   * As seen in the getOrigin method, the main origin is the lowest one.\n   * This implies that the index to world and reverse method do some flipping\n   * magic...\n   *\n   * @param {Point3D} point The point to evaluate.\n   * @param {number} [time] Optional time index.\n   * @returns {number} The slice index.\n   */\n  getSliceIndex(point, time) {\n    // cannot use this.worldToIndex(point).getK() since\n    // we cannot guaranty consecutive slices...\n\n    let localOrigins = this.#origins;\n    if (typeof time !== 'undefined') {\n      localOrigins = this.#timeOrigins[time];\n    }\n\n    // find the closest origin\n    const closestOriginIndex = point.getClosest(localOrigins);\n    const closestOrigin = localOrigins[closestOriginIndex];\n\n    // direction between the input point and the closest origin\n    const pointDir = point.minus(closestOrigin);\n\n    // use third orientation matrix column as plane normal vector\n    const normal = new Vector3D(\n      this.#orientation.get(0, 2),\n      this.#orientation.get(1, 2),\n      this.#orientation.get(2, 2)\n    );\n\n    // codirectional vectors: above slice index\n    // oposite vectors: below slice index\n    const isCodirectional = normal.isCodirectional(pointDir);\n    const sliceIndex = isCodirectional\n      ? closestOriginIndex + 1 : closestOriginIndex;\n\n    return sliceIndex;\n  }\n\n  /**\n   * Check if another geometry is compatible with this one, ie that\n   * slices with these geometries can be merged into one volume.\n   *\n   * @param {Geometry} rhs The geometry to check.\n   * @returns {BooleanResult} Result with success set to true if\n   *   the geometry is compatible.\n   */\n  canAppend(rhs) {\n    // check size\n    const rhsSize = rhs.getSize();\n    if (rhsSize.get(2) !== 1) {\n      return {\n        success: false,\n        message: 'Cannot append more than one slice'\n      };\n    }\n    const size = this.getSize();\n    if (size.get(0) !== rhsSize.get(0)) {\n      return {\n        success: false,\n        message: 'Cannot append a slice with different number of columns'\n      };\n    }\n    if (size.get(1) !== rhsSize.get(1)) {\n      return {\n        success: false,\n        message: 'Cannot append a slice with different number of rows'\n      };\n    }\n    // check orientation\n    if (!this.getOrientation().isSimilar(\n      rhs.getOrientation(), REAL_WORLD_EPSILON)) {\n      return {\n        success: false,\n        message: 'Cannot append a slice with different orientation'\n      };\n    }\n    // check origin\n    const canAppendOrigin =\n      this.canAppendOrigin(rhs.getOrigin(), rhs.getInitialTime());\n    if (!canAppendOrigin.success) {\n      return canAppendOrigin;\n    }\n\n    return new BooleanResult(true);\n  }\n\n  /**\n   * Check if an origin can be appended to this geometry.\n   *\n   * @param {Point3D} origin The origin to append.\n   * @param {number} [time] Optional time index.\n   * @returns {BooleanResult} Result with success set to true if\n   *   the origin is compatible.\n   */\n  canAppendOrigin(origin, time) {\n    // equal callback\n    const equalToOrigin = function (element) {\n      return element.equals(origin);\n    };\n    if (typeof time !== 'undefined' && time !== this.#initialTime) {\n      // check if not already in list\n      if (typeof this.#timeOrigins[time] !== 'undefined') {\n        const found = this.#timeOrigins[time].find(equalToOrigin);\n        if (typeof found !== 'undefined') {\n          return {\n            success: false,\n            message: 'Cannot append same time origin twice'\n          };\n        }\n      }\n    } else {\n      // check if not already in list\n      const found = this.#origins.find(equalToOrigin);\n      if (typeof found !== 'undefined') {\n        return {\n          success: false,\n          message: 'Cannot append same origin twice'\n        };\n      }\n    }\n    return new BooleanResult(true);\n  }\n\n  /**\n   * Append an origin to the geometry.\n   *\n   * @param {Point3D} origin The origin to append.\n   * @param {number} index The index at which to append.\n   * @param {number} [time] Optional time index.\n   */\n  appendOrigin(origin, index, time) {\n    // check if possible\n    const canAppend = this.canAppendOrigin(origin, time);\n    if (!canAppend.success) {\n      throw new Error(canAppend.message);\n    }\n\n    // add in origin array\n    if (typeof time !== 'undefined') {\n      this.#timeOrigins[time].splice(index, 0, origin);\n    }\n    if (typeof time === 'undefined' || time === this.#initialTime) {\n      this.#origins.splice(index, 0, origin);\n      // increment second dimension\n      const values = this.#size.getValues();\n      values[2] += 1;\n      this.#size = new Size(values);\n    }\n  }\n\n  /**\n   * Append a frame to the geometry.\n   *\n   * @param {Point3D} origin The origin to append.\n   * @param {number} time Optional time index.\n   */\n  appendFrame(origin, time) {\n    // add origin to list\n    this.#timeOrigins[time] = [origin];\n    // increment third dimension\n    const sizeValues = this.#size.getValues();\n    const spacingValues = this.#spacing.getValues();\n    if (sizeValues.length === 4) {\n      sizeValues[3] += 1;\n    } else {\n      sizeValues.push(2);\n      spacingValues.push(1);\n    }\n    this.#size = new Size(sizeValues);\n    this.#spacing = new Spacing(spacingValues);\n  }\n\n  /**\n   * Get a string representation of the geometry.\n   *\n   * @returns {string} The geometry as a string.\n   */\n  toString() {\n    return 'Origin: ' + this.getOrigin() +\n      ', Size: ' + this.getSize() +\n      ', Spacing: ' + this.getSpacing() +\n      ', Orientation: ' + this.getOrientation();\n  }\n\n  /**\n   * Check for equality.\n   *\n   * @param {Geometry} rhs The object to compare to.\n   * @returns {boolean} True if both objects are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      typeof rhs !== 'undefined' &&\n      this.getOrigin().equals(rhs.getOrigin()) &&\n      this.getSize().equals(rhs.getSize()) &&\n      this.getSpacing().equals(rhs.getSpacing()) &&\n      this.getOrientation().equals(rhs.getOrientation());\n  }\n\n  /**\n   * Check that a point is within bounds.\n   *\n   * @param {Point} point The point to check.\n   * @returns {boolean} True if the given coordinates are within bounds.\n   */\n  isInBounds(point) {\n    return this.isIndexInBounds(this.worldToIndex(point));\n  }\n\n  /**\n   * Check that a index is within bounds.\n   *\n   * @param {Index} index The index to check.\n   * @param {number[]} [dirs] Optional list of directions to check.\n   * @returns {boolean} True if the given coordinates are within bounds.\n   */\n  isIndexInBounds(index, dirs) {\n    return this.getSize().isInBounds(index, dirs);\n  }\n\n  /**\n   * Get the geometrical range, ie the minimum and maximum\n   *   positions.\n   *\n   * @returns {Point[]} The min and max positions.\n   */\n  getRange() {\n    const nDims = this.getSize().length();\n    const minValues = new Array(nDims);\n    minValues.fill(0);\n    const minIndex = new Index(minValues);\n    const maxIndex = new Index(this.getSize().getValues());\n    return [\n      this.indexToWorld(minIndex),\n      this.indexToWorld(maxIndex)\n    ];\n  }\n\n  /**\n   * Convert an index into world coordinates.\n   *\n   * @param {Index} index The index to convert.\n   * @returns {Point} The corresponding point.\n   */\n  indexToWorld(index) {\n    // apply spacing\n    // (spacing is oriented, apply before orientation)\n    const spacing = this.getSpacing();\n    const orientedPoint3D = new Point3D(\n      index.get(0) * spacing.get(0),\n      index.get(1) * spacing.get(1),\n      index.get(2) * spacing.get(2)\n    );\n    // de-orient\n    const point3D = this.getOrientation().multiplyPoint3D(orientedPoint3D);\n    // keep >3d values\n    const values = index.getValues();\n    const origin = this.getOrigin();\n    values[0] = origin.getX() + point3D.getX();\n    values[1] = origin.getY() + point3D.getY();\n    values[2] = origin.getZ() + point3D.getZ();\n    // return point\n    return new Point(values);\n  }\n\n  /**\n   * Convert a 3D point into world coordinates.\n   *\n   * @param {Point3D} point The 3D point to convert.\n   * @returns {Point3D} The corresponding world 3D point.\n   */\n  pointToWorld(point) {\n    // apply spacing\n    // (spacing is oriented, apply before orientation)\n    const spacing = this.getSpacing();\n    const orientedPoint3D = new Point3D(\n      point.getX() * spacing.get(0),\n      point.getY() * spacing.get(1),\n      point.getZ() * spacing.get(2)\n    );\n    // de-orient\n    const point3D = this.getOrientation().multiplyPoint3D(orientedPoint3D);\n    // return point3D\n    const origin = this.getOrigin();\n    return new Point3D(\n      origin.getX() + point3D.getX(),\n      origin.getY() + point3D.getY(),\n      origin.getZ() + point3D.getZ()\n    );\n  }\n\n  /**\n   * Convert world coordinates into an index.\n   *\n   * @param {Point} point The point to convert.\n   * @returns {Index} The corresponding index.\n   */\n  worldToIndex(point) {\n    // compensate for origin\n    // (origin is not oriented, compensate before orientation)\n    // TODO: use slice origin...\n    const origin = this.getOrigin();\n    const point3D = new Point3D(\n      point.get(0) - origin.getX(),\n      point.get(1) - origin.getY(),\n      point.get(2) - origin.getZ()\n    );\n    // orient\n    const orientedPoint3D =\n      this.getOrientation().getInverse().multiplyPoint3D(point3D);\n    // keep >3d values\n    const values = point.getValues();\n    // apply spacing and floor\n    // (precisionRound to avoid float number inaccuracies)\n    const spacing = this.getSpacing();\n    values[0] = Math.floor(precisionRound(\n      orientedPoint3D.getX() / spacing.get(0),\n      REAL_WORLD_EXPONENT\n    ));\n    values[1] = Math.floor(precisionRound(\n      orientedPoint3D.getY() / spacing.get(1),\n      REAL_WORLD_EXPONENT\n    ));\n    values[2] = Math.floor(precisionRound(\n      orientedPoint3D.getZ() / spacing.get(2),\n      REAL_WORLD_EXPONENT\n    ));\n    // return index\n    return new Index(values);\n  }\n\n  /**\n   * Convert world coordinates into an point.\n   *\n   * @param {Point} point The world point to convert.\n   * @returns {Point3D} The corresponding point.\n   */\n  worldToPoint(point) {\n    // compensate for origin\n    // (origin is not oriented, compensate before orientation)\n    const origin = this.getOrigin();\n    const point3D = new Point3D(\n      point.get(0) - origin.getX(),\n      point.get(1) - origin.getY(),\n      point.get(2) - origin.getZ()\n    );\n    // orient\n    const orientedPoint3D =\n      this.getOrientation().getInverse().multiplyPoint3D(point3D);\n    // keep >3d values\n    const values = point.getValues();\n    // apply spacing and round\n    const spacing = this.getSpacing();\n    values[0] = orientedPoint3D.getX() / spacing.get(0);\n    values[1] = orientedPoint3D.getY() / spacing.get(1);\n    values[2] = orientedPoint3D.getZ() / spacing.get(2);\n\n    // return index\n    return new Point3D(values[0], values[1], values[2]);\n  }\n\n} // class Geometry\n\n/**\n * Get the oriented values of an input 3D array.\n *\n * @param {number[]} array3D The 3D array.\n * @param {Matrix33} orientation The orientation 3D matrix.\n * @returns {number[]} The values reordered according to the orientation.\n */\nexport function getOrientedArray3D(array3D, orientation) {\n  // values = orientation * orientedValues\n  // -> inv(orientation) * values = orientedValues\n  return orientation.getInverse().multiplyArray3D(array3D);\n}\n\n/**\n * Get the raw values of an oriented input 3D array.\n *\n * @param {number[]} array3D The 3D array.\n * @param {Matrix33} orientation The orientation 3D matrix.\n * @returns {number[]} The values reordered to compensate the orientation.\n */\nexport function getDeOrientedArray3D(array3D, orientation) {\n  // values = orientation * orientedValues\n  return orientation.multiplyArray3D(array3D);\n}\n\n/**\n * Get the slice spacing from the difference in the Z directions\n * of input origins.\n *\n * @param {Point3D[]} origins An array of Point3D.\n * @returns {number|undefined} The spacing.\n */\nexport function getSliceGeometrySpacing(origins) {\n  // check origins\n  if (origins.length <= 1) {\n    return;\n  }\n\n  const spacings = [];\n  for (let i = 0; i < origins.length - 1; ++i) {\n    const origin1 = origins[i];\n    const origin2 = origins[i + 1];\n    const sliceSpacing = origin1.getDistance(origin2);\n    if (sliceSpacing === 0) {\n      throw new Error('Zero slice spacing ' +\n        origin1.toString() + ' ' + origin2.toString());\n    }\n    spacings.push(sliceSpacing);\n  }\n\n  // use rounded mean value as spacing\n  const stats = getBasicStats(spacings);\n  const spacing = precisionRound(stats.mean, 4);\n\n  // warn if non constant\n  if (stats.stdDev > REAL_WORLD_EPSILON) {\n    logger.warn('Varying slice spacing, value: ' + spacing +\n      ' (mean: ' + stats.mean +\n      ', min: ' + stats.min +\n      ', max: ' + stats.max +\n      ', stdDev: ' + stats.stdDev + ')');\n  }\n\n  return spacing;\n}\n\n/**\n * Merge two geometries into one using the merge size and\n *   smallest resolution.\n * WARNING: needs to be called with the final geometries.\n *\n * @param {Geometry} geometry1 The first geometry.\n * @param {Geometry} geometry2 The second geometry.\n * @returns {Geometry} The merged geometry.\n */\nexport function mergeGeometries(geometry1, geometry2) {\n  const orientation = geometry1.getOrientation();\n  // check input\n  if (!orientation.isSimilar(geometry2.getOrientation(), REAL_WORLD_EPSILON)) {\n    throw new Error('Cannot merge geometries with different orientation');\n  }\n  const invOrientation = orientation.getInverse();\n\n  const minByIndex = function (array1, array2) {\n    return arrayMap(array1, array2, Math.min);\n  };\n  const maxByIndex = function (array1, array2) {\n    return arrayMap(array1, array2, Math.max);\n  };\n\n  const newSpacing = new Spacing(minByIndex(\n    geometry1.getSpacing().getValues(),\n    geometry2.getSpacing().getValues()\n  ));\n\n  const deorient = function (item) {\n    return invOrientation.multiplyPoint3D(item.get3D());\n  };\n  const range1 = geometry1.getRange().map(deorient);\n  const range2 = geometry2.getRange().map(deorient);\n\n  const minRangeValues = minByIndex(\n    range1[0].getValues(),\n    range2[0].getValues()\n  );\n  const maxRangeValues = maxByIndex(\n    range1[1].getValues(),\n    range2[1].getValues()\n  );\n\n  let sizeValues = [];\n  for (let i = 0; i < minRangeValues.length; ++i) {\n    sizeValues.push(Math.round(\n      Math.abs(maxRangeValues[i] - minRangeValues[i]) / newSpacing.get(i)\n    ));\n  }\n  // handle extra dims\n  const maxSize = maxByIndex(\n    geometry1.getSize().getValues(),\n    geometry2.getSize().getValues()\n  );\n  sizeValues = sizeValues.concat(maxSize.slice(3));\n  const newSize = new Size(sizeValues);\n\n  const newOrigins = [];\n  for (let i = 0; i < newSize.get(2); ++i) {\n    const values = minRangeValues.slice();\n    values[2] = minRangeValues[2] + i * newSpacing.get(2);\n    const origin = new Point3D(values[0], values[1], values[2]);\n    newOrigins.push(orientation.multiplyPoint3D(origin));\n  }\n\n  return new Geometry(\n    newOrigins,\n    newSize,\n    newSpacing,\n    orientation\n  );\n}\n","import {Vector3D} from './vector.js';\nimport {\n  Matrix33,\n  getIdentityMat33\n} from './matrix.js';\n\n/**\n * Create a 3x3 coronal (xzy) matrix.\n *\n * @returns {Matrix33} The coronal matrix.\n */\nexport function getCoronalMat33() {\n  /* eslint-disable @stylistic/js/array-element-newline */\n  return new Matrix33([\n    1, 0, 0,\n    0, 0, 1,\n    0, -1, 0\n  ]);\n  /* eslint-enable @stylistic/js/array-element-newline */\n}\n\n/**\n * Create a 3x3 sagittal (yzx) matrix.\n *\n * @returns {Matrix33} The sagittal matrix.\n */\nexport function getSagittalMat33() {\n  /* eslint-disable @stylistic/js/array-element-newline */\n  return new Matrix33([\n    0, 0, -1,\n    1, 0, 0,\n    0, -1, 0\n  ]);\n  /* eslint-enable @stylistic/js/array-element-newline */\n}\n\n/**\n * Default anatomical plane orientations.\n */\nexport const Orientation = {\n  /**\n   * Axial, also known as transverse.\n   */\n  Axial: 'axial',\n  /**\n   * Coronal, also known as frontal.\n   */\n  Coronal: 'coronal',\n  /**\n   * Sagittal, also known as anteroposterior.\n   */\n  Sagittal: 'sagittal'\n};\n\n/**\n * Get an orientation matrix from a name.\n *\n * @param {string} name The orientation name.\n * @returns {Matrix33|undefined} The orientation matrix.\n */\nexport function getMatrixFromName(name) {\n  let matrix;\n  if (name === Orientation.Axial) {\n    matrix = getIdentityMat33();\n  } else if (name === Orientation.Coronal) {\n    matrix = getCoronalMat33();\n  } else if (name === Orientation.Sagittal) {\n    matrix = getSagittalMat33();\n  }\n  return matrix;\n}\n\n/**\n * Get the orientation code of an orientation matrix. Each letter defines\n * the towards direction. Letters are: R (right), L (left),\n * A (anterior), P (posterior), I (inferior) and S (superior).\n *\n * @param {Matrix33} matrix The orientation matrix.\n * @returns {string} The orientation code.\n */\nexport function getOrientationStringLPS(matrix) {\n  const v0 = new Vector3D(\n    matrix.get(0, 0),\n    matrix.get(1, 0),\n    matrix.get(2, 0)\n  );\n  const v1 = new Vector3D(\n    matrix.get(0, 1),\n    matrix.get(1, 1),\n    matrix.get(2, 1)\n  );\n  const v2 = new Vector3D(\n    matrix.get(0, 2),\n    matrix.get(1, 2),\n    matrix.get(2, 2)\n  );\n  return getVectorStringLPS(v0) +\n    getVectorStringLPS(v1) +\n    getVectorStringLPS(v2);\n}\n\n/**\n * Get the orientation code of an orientation vector.\n * Credits: David Clunie, {@link https://www.dclunie.com/medical-image-faq/html/part2.html}.\n *\n * @param {Vector3D} vector The orientation vector.\n * @returns {string} The orientation code.\n */\nfunction getVectorStringLPS(vector) {\n  let abs = new Vector3D(\n    Math.abs(vector.getX()),\n    Math.abs(vector.getY()),\n    Math.abs(vector.getZ())\n  );\n\n  let orientation = '';\n  const orientationX = vector.getX() < 0 ? 'R' : 'L';\n  const orientationY = vector.getY() < 0 ? 'A' : 'P';\n  // as defined in DICOM\n  //const orientationZ = vector.getZ() < 0 ? 'F' : 'H';\n  const orientationZ = vector.getZ() < 0 ? 'I' : 'S';\n\n  const threshold = 0.0001;\n\n  for (let i = 0; i < 3; i++) {\n    if (abs.getX() > threshold &&\n      abs.getX() > abs.getY() &&\n      abs.getX() > abs.getZ()) {\n      orientation += orientationX;\n      abs = new Vector3D(0, abs.getY(), abs.getZ());\n    } else if (abs.getY() > threshold &&\n      abs.getY() > abs.getX() &&\n      abs.getY() > abs.getZ()) {\n      orientation += orientationY;\n      abs = new Vector3D(abs.getX(), 0, abs.getZ());\n    } else if (abs.getZ() > threshold &&\n      abs.getZ() > abs.getX() &&\n      abs.getZ() > abs.getY()) {\n      orientation += orientationZ;\n      abs = new Vector3D(abs.getX(), abs.getY(), 0);\n    } else {\n      break;\n    }\n  }\n\n  return orientation;\n}\n\n/**\n * Get the LPS 'group' (axial, coronal or sagittal) from a LPS code.\n *\n * @param {string} code The LPS code string.\n * @returns {string|undefined} The group.\n */\nfunction getLPSGroup(code) {\n  let orientStr;\n  const axialCodes =\n    ['LPS', 'LAI', 'RPI', 'RAS', 'ALS', 'ARI', 'PLI', 'PRS'];\n  const coronalCodes =\n    ['LSA', 'LIP', 'RSP', 'RIA', 'ILA', 'IRP', 'SLP', 'SRA'];\n  const sagittalCodes =\n    ['PSL', 'PIR', 'ASR', 'AIL', 'IAR', 'IPL', 'SAL', 'SPR'];\n  if (axialCodes.includes(code)) {\n    orientStr = Orientation.Axial;\n  } else if (coronalCodes.includes(code)) {\n    orientStr = Orientation.Coronal;\n  } else if (sagittalCodes.includes(code)) {\n    orientStr = Orientation.Sagittal;\n  }\n  return orientStr;\n}\n\n/**\n * Get the name of an image orientation patient.\n *\n * @param {number[]} cosines The image orientation\n *   patient cosines (6 values).\n * @returns {string|undefined} The orientation\n *   name: axial, coronal or sagittal.\n */\nexport function getOrientationName(cosines) {\n  let name;\n  const orientMatrix = getOrientationFromCosines(cosines);\n  if (typeof orientMatrix !== 'undefined') {\n    const lpsStr = getOrientationStringLPS(orientMatrix.asOneAndZeros());\n    name = getLPSGroup(lpsStr);\n  }\n  return name;\n}\n\n/**\n * Get the orientation matrix associated to the direction cosines.\n *\n * @param {number[]} cosines The image orientation\n *   patient cosines (6 values).\n * @returns {Matrix33|undefined} The orientation matrix.\n */\nexport function getOrientationFromCosines(cosines) {\n  let orientationMatrix;\n  if (typeof cosines !== 'undefined' && cosines.length === 6) {\n    const rowCosines = new Vector3D(cosines[0], cosines[1], cosines[2]);\n    const colCosines = new Vector3D(cosines[3], cosines[4], cosines[5]);\n    const normal = rowCosines.crossProduct(colCosines);\n    /* eslint-disable @stylistic/js/array-element-newline */\n    orientationMatrix = new Matrix33([\n      rowCosines.getX(), colCosines.getX(), normal.getX(),\n      rowCosines.getY(), colCosines.getY(), normal.getY(),\n      rowCosines.getZ(), colCosines.getZ(), normal.getZ()\n    ]);\n    /* eslint-enable @stylistic/js/array-element-newline */\n  }\n  return orientationMatrix;\n}\n\n/**\n * Get the direction cosines from an orientation matrix.\n *\n * @param {Matrix33} matrix The input matrix.\n * @returns {number[]} The image orientation\n *   patient cosines (6 values).\n */\nexport function getCosinesFromOrientation(matrix) {\n  return [\n    matrix.get(0, 0),\n    matrix.get(1, 0),\n    matrix.get(2, 0),\n    matrix.get(0, 1),\n    matrix.get(1, 1),\n    matrix.get(2, 1)\n  ];\n}\n\n/**\n * Get the view orientation according to an image and target orientation.\n * The view orientation is used to go from target to image space.\n *\n * @param {Matrix33} imageOrientation The image geometry.\n * @param {Matrix33} targetOrientation The target orientation.\n * @returns {Matrix33} The view orientation.\n */\nexport function getViewOrientation(imageOrientation, targetOrientation) {\n  let viewOrientation = getIdentityMat33();\n  if (typeof targetOrientation !== 'undefined') {\n    // i: image, v: view, t: target, O: orientation, P: point\n    // [Img] -- Oi --> [Real] <-- Ot -- [Target]\n    // Pi = (Oi)-1 * Ot * Pt = Ov * Pt\n    // -> Ov = (Oi)-1 * Ot\n    // TODO: asOneAndZeros simplifies but not nice...\n    viewOrientation =\n      imageOrientation.asOneAndZeros().getInverse().multiply(targetOrientation);\n  }\n  // TODO: why abs???\n  return viewOrientation.getAbs();\n}\n\n/**\n * Get the target orientation according to an image and view orientation.\n * The target orientation is used to go from target to real space.\n *\n * @param {Matrix33} imageOrientation The image geometry.\n * @param {Matrix33} viewOrientation The view orientation.\n * @returns {Matrix33} The target orientation.\n */\nexport function getTargetOrientation(imageOrientation, viewOrientation) {\n  // i: image, v: view, t: target, O: orientation, P: point\n  // [Img] -- Oi --> [Real] <-- Ot -- [Target]\n  // Pi = (Oi)-1 * Ot * Pt = Ov * Pt\n  // -> Ot = Oi * Ov\n  // note: asOneAndZeros as in getViewOrientation...\n  let targetOrientation =\n    imageOrientation.asOneAndZeros().multiply(viewOrientation);\n\n  // TODO: why abs???\n  const simpleImageOrientation = imageOrientation.asOneAndZeros().getAbs();\n  if (simpleImageOrientation.isSimilar(getCoronalMat33().getAbs())) {\n    targetOrientation = targetOrientation.getAbs();\n  }\n\n  return targetOrientation;\n}\n","import {custom} from '../app/custom.js';\nimport {\n  isJpeg2000TransferSyntax,\n  isJpegBaselineTransferSyntax,\n  isJpegLosslessTransferSyntax\n} from './dicomParser.js';\nimport {safeGet, safeGetAll} from './dataElement.js';\nimport {getOrientationFromCosines} from '../math/orientation.js';\nimport {Spacing} from '../image/spacing.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Matrix33} from '../math/matrix.js';\nimport {DataElement} from './dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  TransferSyntax: '00020010',\n  SOPClassUID: '00080016',\n  Modality: '00080060',\n  ReferencedSeriesSequence: '00081115',\n  SeriesInstanceUID: '0020000E',\n  Rows: '00280010',\n  Columns: '00280011',\n  PixelSpacing: '00280030',\n  ImagerPixelSpacing: '00181164',\n  NominalScannedPixelSpacing: '00182010',\n  DistanceSourceToDetector: '00181110',\n  DistanceSourceToPatient: '00181111',\n  EstimatedRadiographicMagnificationFactor: '00181114',\n  PixelAspectRatio: '00280034',\n  SpacingBetweenSlices: '00180088',\n  RescaleType: '00281054',\n  Units: '00541001',\n  ImageOrientationPatient: '00200037',\n  PhotometricInterpretation: '00280004',\n  SamplesPerPixel: '00280002',\n  PixelMeasuresSequence: '00289110',\n  SharedFunctionalGroupsSequence: '52009229',\n  PerFrameFunctionalGroupsSequence: '52009230'\n};\n\n/**\n * Extract the 2D size from dicom elements.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {number[]|undefined} The sizes as [columns, rows] or\n *   undefined if not present.\n */\nexport function getImage2DSize(elements) {\n  let res;\n  const rows = safeGet(elements, TagKeys.Rows);\n  const columns = safeGet(elements, TagKeys.Columns);\n  if (typeof rows !== 'undefined' &&\n    typeof columns !== 'undefined') {\n    res = [columns, rows];\n  }\n  return res;\n}\n\n/**\n * Get the 2D spacing values.\n *\n * @param {Object<string, DataElement>} elements The dicom element.\n * @param {string} tagKey The tag key.\n * @returns {number[]|undefined} The values if present.\n */\nfunction get2DSpacingValues(elements, tagKey) {\n  let res;\n  const values = safeGetAll(elements, tagKey);\n  if (typeof values !== 'undefined' &&\n    values.length === 2) {\n    // dicom spacing order: [row, column]\n    res = [\n      parseFloat(values[1]),\n      parseFloat(values[0])\n    ];\n  }\n  return res;\n}\n\n/**\n * Get the 2D spacing values from a functional group.\n *\n * @param {Object<string, DataElement>} funcGroupElements The dicom elements.\n * @returns {number[]|undefined} The values if present.\n */\nfunction get2DSpacingValuesFromFuncGroup(funcGroupElements) {\n  let res;\n  // Pixel Measures Sequence\n  const pixelMeasuresSeq =\n    safeGetAll(funcGroupElements, TagKeys.PixelMeasuresSequence);\n  if (typeof pixelMeasuresSeq !== 'undefined') {\n    // should be only one\n    res = get2DSpacingValues(pixelMeasuresSeq[0], TagKeys.PixelSpacing);\n  }\n  return res;\n}\n\n/**\n * Get the pixel spacing for projection data.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {number[]|undefined} The values if present.\n */\nfunction getProjection2DSpacingValues(elements) {\n  // ImagerPixelSpacing\n  let res = get2DSpacingValues(elements, TagKeys.ImagerPixelSpacing);\n  if (typeof res !== 'undefined') {\n    let factor;\n    const magnification = parseFloat(\n      safeGet(elements, TagKeys.EstimatedRadiographicMagnificationFactor));\n    if (!isNaN(magnification)) {\n      factor = magnification;\n    } else {\n      const d0 = parseFloat(\n        safeGet(elements, TagKeys.DistanceSourceToDetector));\n      const d1 = parseFloat(\n        safeGet(elements, TagKeys.DistanceSourceToPatient));\n      if (!isNaN(d0) && !isNaN(d1) && d1 !== 0) {\n        factor = d0 / d1;\n      }\n    }\n    if (typeof factor !== 'undefined') {\n      res = res.map((value) => value / factor);\n      logger.warn('Got pixel spacing from corrected ImagerPixelSpacing tag');\n    } else {\n      logger.warn('Got pixel spacing from raw ImagerPixelSpacing tag');\n    }\n  }\n  return res;\n}\n\n/**\n * Get the pixel spacing for secondary capture data.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {number[]|undefined} The values if present.\n */\nfunction getSecondaryCapture2DSpacingValues(elements) {\n  // NominalScannedPixelSpacing\n  const res = get2DSpacingValues(elements, TagKeys.NominalScannedPixelSpacing);\n  if (typeof res !== 'undefined') {\n    logger.warn('Got pixel spacing from NominalScannedPixelSpacing tag');\n  }\n  return res;\n}\n\n/**\n * Get the pixel spacing for multi-frame data.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {number[]|undefined} The values if present.\n */\nfunction getMultiFrame2DSpacingValues(elements) {\n  let res;\n\n  // SharedFunctionalGroupsSequence (multi-frame)\n  const sharedFunctionalGroupsSeq =\n    safeGetAll(elements, TagKeys.SharedFunctionalGroupsSequence);\n  if (typeof sharedFunctionalGroupsSeq !== 'undefined') {\n    // should be only one\n    const funcGroup = sharedFunctionalGroupsSeq[0];\n    res = get2DSpacingValuesFromFuncGroup(funcGroup);\n  }\n\n  // PerFrameFunctionalGroupsSequence (multi-frame)\n  if (typeof res === 'undefined') {\n    const perFrameFunctionalGroupsSeq =\n      safeGetAll(elements, TagKeys.PerFrameFunctionalGroupsSequence);\n    if (typeof perFrameFunctionalGroupsSeq !== 'undefined') {\n      // take first one\n      // TODO: use proper frame\n      const funcGroup = perFrameFunctionalGroupsSeq[0];\n      res = get2DSpacingValuesFromFuncGroup(funcGroup);\n    }\n  }\n\n  return res;\n}\n\n/**\n * Get the pixel spacing from the different spacing tags.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {number[]|undefined} The spacing as [columnSapcing, rowSpacing] or\n *   undefined if not present.\n */\nexport function getPixelSpacing(elements) {\n  // main tag\n  let res = get2DSpacingValues(elements, TagKeys.PixelSpacing);\n  // projection related\n  // TODO: use SOPClassUID filter?\n  if (typeof res === 'undefined') {\n    res = getProjection2DSpacingValues(elements);\n  }\n  // secondary capture (before multi-frame case)\n  if (typeof res === 'undefined') {\n    res = getSecondaryCapture2DSpacingValues(elements);\n  }\n  // multi-frame case (spacing in functional group)\n  if (typeof res === 'undefined') {\n    res = getMultiFrame2DSpacingValues(elements);\n  }\n  // return\n  return res;\n}\n\n/**\n * Get the pixel aspect ratio.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {number[]|undefined} The values if present.\n */\nexport function getPixelAspectRatio(elements) {\n  return get2DSpacingValues(elements, TagKeys.PixelAspectRatio);\n}\n\n/**\n * Get a spacing object from a dicom measure element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {Spacing|undefined} A spacing object.\n */\nexport function getSpacingFromMeasure(dataElements) {\n  // Pixel Spacing\n  const spacingValues = get2DSpacingValues(dataElements, TagKeys.PixelSpacing);\n  if (typeof spacingValues === 'undefined') {\n    return undefined;\n  }\n  // Spacing Between Slices\n  const sbs = safeGet(dataElements, TagKeys.SpacingBetweenSlices);\n  if (typeof sbs !== 'undefined') {\n    spacingValues.push(parseFloat(sbs));\n  }\n  return new Spacing(spacingValues);\n}\n\n/**\n * Get pixel data unit from a list of tags.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {string|undefined} The unit value if available.\n */\nexport function getTagPixelUnit(elements) {\n  if (typeof custom.getTagPixelUnit !== 'undefined') {\n    return custom.getTagPixelUnit(elements);\n  } else {\n    return defaultGetTagPixelUnit(elements);\n  }\n}\n\n/**\n * Default get pixel data unit.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {string|undefined} The unit value if available.\n */\nfunction defaultGetTagPixelUnit(elements) {\n  let unit;\n  const tags = ['RescaleType', 'Units'];\n  for (const tag of tags) {\n    unit = safeGet(elements, TagKeys[tag]);\n    if (typeof unit !== 'undefined') {\n      break;\n    }\n  }\n  // default rescale type for CT\n  if (typeof unit === 'undefined') {\n    const modality = safeGet(elements, TagKeys.Modality);\n    if (typeof modality !== 'undefined' && modality === 'CT') {\n      unit = 'HU';\n    }\n  }\n  return unit;\n}\n\n/**\n * Get an orientation matrix from a dicom orientation element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {Matrix33|undefined} The orientation matrix.\n */\nexport function getOrientationMatrix(dataElements) {\n  const imageOrientationPatient =\n    safeGetAll(dataElements, TagKeys.ImageOrientationPatient);\n  let orientationMatrix;\n  // slice orientation (cosines are matrices' columns)\n  // http://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.7.6.2.html#sect_C.7.6.2.1.1\n  if (typeof imageOrientationPatient !== 'undefined') {\n    orientationMatrix =\n      getOrientationFromCosines(\n        imageOrientationPatient.map((item) => parseFloat(item))\n      );\n  }\n  return orientationMatrix;\n}\n\n/**\n * Get a dicom item from a measure sequence.\n *\n * @param {Spacing} spacing The spacing object.\n * @returns {object} The dicom item.\n */\nexport function getDicomMeasureItem(spacing) {\n  return {\n    SpacingBetweenSlices: spacing.get(2),\n    PixelSpacing: [spacing.get(1), spacing.get(0)]\n  };\n}\n\n/**\n * Get a dicom element from a plane orientation sequence.\n *\n * @param {Matrix33} orientation The image orientation.\n * @returns {object} The dicom element.\n */\nexport function getDicomPlaneOrientationItem(orientation) {\n  return {\n    ImageOrientationPatient: [\n      orientation.get(0, 0),\n      orientation.get(1, 0),\n      orientation.get(2, 0),\n      orientation.get(0, 1),\n      orientation.get(1, 1),\n      orientation.get(2, 1)\n    ]\n  };\n}\n\n/**\n * Get the photometric interpretation from the data elements.\n *\n * @param {Object<string, DataElement>} dataElements The data elements.\n * @returns {string|undefined} The photometric interpretation value.\n */\nexport function getPhotometricInterpretation(dataElements) {\n  const photometricInterpretation =\n    safeGet(dataElements, TagKeys.PhotometricInterpretation);\n  const transferSyntax = safeGet(dataElements, TagKeys.TransferSyntax);\n\n  if (typeof photometricInterpretation !== 'undefined' &&\n    typeof transferSyntax !== 'undefined') {\n    let photo = photometricInterpretation.toUpperCase();\n    // TransferSyntaxUID\n    const isJpeg = isJpeg2000TransferSyntax(transferSyntax) ||\n      isJpegBaselineTransferSyntax(transferSyntax) ||\n      isJpegLosslessTransferSyntax(transferSyntax);\n    // jpeg decoders output RGB data\n    if (isJpeg && !isMonochrome(photo)) {\n      photo = 'RGB';\n    }\n    // samplesPerPixel\n    let samplesPerPixel = safeGet(dataElements, TagKeys.SamplesPerPixel);\n    if (typeof samplesPerPixel === 'undefined') {\n      samplesPerPixel = 1;\n    }\n    // check samples per pixels\n    if (photo === 'RGB' && samplesPerPixel === 1) {\n      photo = 'PALETTE COLOR';\n    }\n    return photo;\n  }\n}\n\n/**\n * Check if an input photometricInterpretation is monochrome.\n *\n * @param {string} photometricInterpretation The photometric interpretation.\n * @returns {boolean} True if the input string starts with 'MONOCHROME'.\n */\nexport function isMonochrome(photometricInterpretation) {\n  return typeof photometricInterpretation !== 'undefined' &&\n    photometricInterpretation.match(/MONOCHROME/) !== null;\n}\n\n/**\n * Check if the received string represents a secondary capture.\n *\n * @param {string} SOPClassUID The sop class uid.\n * @returns {boolean} True if it is secondary capture.\n */\nexport function isSecondatyCapture(SOPClassUID) {\n  const pattern = /^1\\.2\\.840\\.10008\\.5\\.1\\.4\\.1\\.1\\.7/;\n  return typeof SOPClassUID !== 'undefined' &&\n    pattern.test(SOPClassUID);\n}\n\n/**\n * Get the referenced series UID from the data elements.\n *\n * @param {Object<string, DataElement>} dataElements The data elements.\n * @returns {string|undefined} The referenced series UID.\n */\nexport function getReferencedSeriesUID(dataElements) {\n  let res;\n  const refSeriesSq =\n    safeGetAll(dataElements, TagKeys.ReferencedSeriesSequence);\n  if (typeof refSeriesSq !== 'undefined') {\n    res = safeGet(refSeriesSq[0], TagKeys.SeriesInstanceUID);\n  }\n  return res;\n}\n","import {safeGet} from '../dicom/dataElement.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from '../dicom/dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  Manufacturer: '00080070',\n};\n\n/**\n * Normalised manufacturer names.\n */\nexport const NormalisedManufacturers = {\n  GE: 'ge',\n  SIEMENS: 'siemens',\n  PHILIPS: 'philips',\n  HITASHI: 'hitashi'\n};\n\n/**\n * Get the manufacturer.\n *\n * @param {Object<string, DataElement>} elements The DICOM tags.\n * @returns {string|undefined} The manufacturer.\n */\nexport function getManufacturer(elements) {\n  return safeGet(elements, TagKeys.Manufacturer);\n}\n\n/**\n * Get the normalised manufacturer.\n *\n * @param {Object<string, DataElement>} elements The DICOM tags.\n * @returns {string|undefined} The manufacturer as a unique\n *   all lower case string.\n */\nexport function getNormalisedManufacturer(elements) {\n  let res;\n  const manufacturer = getManufacturer(elements);\n  if (typeof manufacturer !== 'undefined') {\n    if (manufacturer.toUpperCase().startsWith('SIEMENS')) {\n      // 'SIEMENS', 'Siemens Healthineers'\n      res = NormalisedManufacturers.SIEMENS;\n    } else if (manufacturer.startsWith('GE')) {\n      // 'GE MEDICAL SYSTEMS'\n      res = NormalisedManufacturers.GE;\n    } else if (manufacturer.startsWith('Philips')) {\n      // 'Philips Healthcare', 'Philips Medical Systems'\n      res = NormalisedManufacturers.PHILIPS;\n    } else {\n      res = manufacturer.toLowerCase();\n    }\n  }\n  return res;\n}\n","import {custom} from '../app/custom.js';\nimport {\n  safeGet,\n  safeGetAll\n} from '../dicom/dataElement.js';\nimport {\n  NormalisedManufacturers,\n  getNormalisedManufacturer\n} from './dicomManufacturer.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from '../dicom/dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  SOPClassUID: '00080016',\n  SOPInstanceUID: '00080018',\n  Manufacturer: '00080070',\n  AcquisitionTime: '00080032',\n  DimensionIndexSequence: '00209222',\n  DimensionIndexPointer: '00209165',\n  SharedFunctionalGroupsSequence: '52009229',\n  PerFrameFunctionalGroupsSequence: '52009230',\n  MRDiffusionSequence: '00189117',\n  DiffusionBValue: '00189087',\n  DiffusionBValueAT: '(0018,9087)',\n  FrameContentSequence: '00209111',\n  DimensionIndexValues: '00209157'\n};\n\n/**\n * Private b-value tag rules. Tested in order.\n * Rules are either `{manufacturer, key}` or `{uidPrefix, key}`.\n *\n * @type {object[]}\n */\nconst LocalBValueRules = [\n  {\n    manufacturer: NormalisedManufacturers.SIEMENS,\n    key: '0019100C'\n  },\n  {\n    manufacturer: NormalisedManufacturers.GE,\n    key: '00431039'\n  },\n  {\n    manufacturer: NormalisedManufacturers.HITASHI,\n    key: '00291030'\n  }\n];\n\n/**\n * Related SOP class UIDs.\n */\nconst SOPClassUIDs = {\n  MR: '1.2.840.10008.5.1.4.1.1.4',\n  EnhancedMR: '1.2.840.10008.5.1.4.1.1.4.1',\n  MRSpectroscopy: '1.2.840.10008.5.1.4.1.1.4.2',\n  EnhancedMRColorImage: '1.2.840.10008.5.1.4.1.1.4.3'\n};\n\n/**\n * Get the diffusion b-value from a functional DICOM sequence.\n *\n * @param {Object<string, DataElement>} elements The DICOM tags.\n * @returns {string|undefined} The value, if present.\n */\nfunction getDiffusionBValueFromFunctionalSeq(elements) {\n  let res;\n  const diffSeq = safeGetAll(elements, TagKeys.MRDiffusionSequence);\n  if (typeof diffSeq !== 'undefined') {\n    // should only contain one item\n    res = safeGet(diffSeq[0], TagKeys.DiffusionBValue);\n  }\n  return res;\n}\n\n/**\n * Get the diffusion b-value from standard DICOM tag.\n *\n * @param {Object<string, DataElement>} elements The DICOM tags.\n * @returns {string|undefined} The value, if present.\n */\nfunction getStandardDiffusionBValueFromEMR(elements) {\n  let res;\n  // from Shared Functional Groups Sequence\n  const sharedGroupSeq =\n    safeGetAll(elements, TagKeys.SharedFunctionalGroupsSequence);\n  if (typeof sharedGroupSeq !== 'undefined') {\n    // should only contain one item\n    res = getDiffusionBValueFromFunctionalSeq(sharedGroupSeq[0]);\n  }\n  // from Per Frame Functional Groups Sequence\n  if (typeof res === 'undefined') {\n    const perFrameGroupSeq =\n      safeGetAll(elements, TagKeys.PerFrameFunctionalGroupsSequence);\n    if (typeof perFrameGroupSeq !== 'undefined') {\n      // TODO: go to specific frame number?\n      for (const group of perFrameGroupSeq) {\n        res = getDiffusionBValueFromFunctionalSeq(group);\n        if (typeof res !== 'undefined') {\n          break;\n        }\n      }\n    }\n  }\n  return res;\n}\n\n/**\n * Get the diffusion b-value from MR from non standard\n *   and/or private DICOM tags.\n *\n * @param {Object<string, DataElement>} elements The DICOM tags.\n * @returns {string|undefined} The value, if present.\n */\nfunction getNonStandardDiffusionBValueFromMR(elements) {\n  let res;\n\n  // manufacturers private tag\n  if (typeof res === 'undefined') {\n    const manufacturer = getNormalisedManufacturer(elements);\n    const sopInstanceUID = safeGet(elements, TagKeys.SOPInstanceUID);\n\n    let rules;\n    if (typeof custom.privateBValueRules !== 'undefined') {\n      rules = custom.privateBValueRules;\n    } else {\n      rules = LocalBValueRules;\n    }\n\n    for (const rule of rules) {\n      if (typeof rule.uidPrefix !== 'undefined' &&\n        typeof sopInstanceUID !== 'undefined' &&\n        sopInstanceUID.startsWith(rule.uidPrefix)) {\n        res = safeGet(elements, rule.key);\n      } else if (typeof rule.manufacturer !== 'undefined' &&\n        typeof manufacturer !== 'undefined' &&\n        rule.manufacturer === manufacturer) {\n        res = safeGet(elements, rule.key);\n      }\n      // break at first valid result\n      if (typeof res !== 'undefined' &&\n        !isNaN(parseInt(res, 10))) {\n        // TODO just break or exit function?\n        break;\n      }\n    }\n  }\n\n  // b-value at root level\n  if (typeof res === 'undefined') {\n    res = safeGet(elements, TagKeys.DiffusionBValue);\n  }\n\n  return res;\n}\n\n/**\n * Get the b-value from the frame content sequence if\n * the dimension index sequence has a pointer to the b-value.\n *\n * @param {Object<string, DataElement>} elements The DICOM tags.\n * @returns {string|undefined} The value, if present.\n */\nfunction getDiffusionBValueFromFrameContent(elements) {\n  let res;\n\n  // check if the dim pointer is for b-value\n  let gotBValuePointer = false;\n  const indexSeq = safeGetAll(elements, TagKeys.DimensionIndexSequence);\n  if (typeof indexSeq !== 'undefined') {\n    for (const dimIndex of indexSeq) {\n      const pointer = safeGet(dimIndex, TagKeys.DimensionIndexPointer);\n      if (typeof pointer !== 'undefined' &&\n        pointer === TagKeys.DiffusionBValueAT\n      ) {\n        gotBValuePointer = true;\n        break;\n      }\n    }\n  }\n  // get from per frame functional group\n  if (gotBValuePointer) {\n    const perFrameGroupSeq =\n      safeGetAll(elements, TagKeys.PerFrameFunctionalGroupsSequence);\n    if (typeof perFrameGroupSeq !== 'undefined') {\n      const group = perFrameGroupSeq[0];\n      const frameContentSeq = safeGetAll(group, TagKeys.FrameContentSequence);\n      if (typeof frameContentSeq !== 'undefined') {\n        // should be only one\n        const dimValues =\n          safeGetAll(frameContentSeq[0], TagKeys.DimensionIndexValues);\n        if (typeof dimValues !== 'undefined') {\n          // does not follow order set in DimensionIndexSequence...\n          res = dimValues[2];\n        }\n      }\n    }\n  }\n\n  return res;\n}\n\n/**\n * Get the diffusion b-value from Enhanced MR from non standard\n *   and/or private DICOM tags.\n *\n * @param {Object<string, DataElement>} elements The DICOM tags.\n * @returns {string|undefined} The value, if present.\n */\nfunction getNonStandardDiffusionBValueFromEMR(elements) {\n  let res;\n\n  // manufacturer\n  const manufacturer = getNormalisedManufacturer(elements);\n\n  // philips can use frame content\n  if (typeof manufacturer !== 'undefined' &&\n    manufacturer === NormalisedManufacturers.PHILIPS) {\n    res = getDiffusionBValueFromFrameContent(elements);\n  }\n\n  return res;\n}\n\n/**\n * Get the diffusion b-value.\n *\n * @param {Object<string, DataElement>} elements The DICOM tags.\n * @returns {number|undefined} The value, if present.\n */\nfunction getDiffusionBValue(elements) {\n  let res;\n  // SOP class UID\n  const sopClassUID = safeGet(elements, TagKeys.SOPClassUID);\n\n  if (sopClassUID === SOPClassUIDs.EnhancedMR ||\n    sopClassUID === SOPClassUIDs.MRSpectroscopy ||\n    sopClassUID === SOPClassUIDs.EnhancedMRColorImage\n  ) {\n    // standard tag\n    res = getStandardDiffusionBValueFromEMR(elements);\n    // if not found, check non standard tag\n    if (typeof res === 'undefined') {\n      res = getNonStandardDiffusionBValueFromEMR(elements);\n      if (typeof res !== 'undefined') {\n        console.log('got b-value for enhanced MR from non standard tag');\n      }\n    }\n  } else if (sopClassUID === SOPClassUIDs.MR) {\n    // non standard for MR\n    res = getNonStandardDiffusionBValueFromMR(elements);\n    // if not found, check standard EMR tag\n    if (typeof res === 'undefined') {\n      if (typeof res === 'undefined') {\n        res = getStandardDiffusionBValueFromEMR(elements);\n      }\n    }\n  }\n\n  // cast to int\n  if (typeof res !== 'undefined') {\n    res = parseInt(res, 10);\n  }\n\n  return res;\n}\n\n/**\n * Get the tag time value for MR images.\n *\n * @param {Object<string, DataElement>} elements The DICOM tags.\n * @returns {number|undefined} The value, if present.\n */\nfunction getMRVolumeIdTagValue(elements) {\n  let res;\n\n  // filter by SOP class UID\n  const sopClassUID = safeGet(elements, TagKeys.SOPClassUID);\n  if (sopClassUID === SOPClassUIDs.MR ||\n    sopClassUID === SOPClassUIDs.EnhancedMR ||\n    sopClassUID === SOPClassUIDs.MRSpectroscopy ||\n    sopClassUID === SOPClassUIDs.EnhancedMRColorImage\n  ) {\n    // diffusion b-value\n    const bvalue = getDiffusionBValue(elements);\n    if (typeof bvalue !== 'undefined') {\n      res = bvalue;\n    }\n  }\n\n  return res;\n}\n\n/**\n * Get the volume id from a list of tags. Default\n * returns MR diffusion b-value.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {number|undefined} The id value if available.\n */\nexport function getVolumeIdTagValue(elements) {\n  let res;\n\n  if (typeof custom.getVolumeIdTagValue !== 'undefined') {\n    res = custom.getVolumeIdTagValue(elements);\n  } else {\n    // MR (and enhanced MR) volume id\n    const volumeId = getMRVolumeIdTagValue(elements);\n    if (typeof volumeId !== 'undefined') {\n      res = volumeId;\n    }\n  }\n\n  return res;\n}\n\n/**\n * Get the volume id from a list of tags parsed after the load finishes.\n * Default uses acquisition time.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {number|undefined} The id value if available.\n */\nexport function getPostLoadVolumeIdTagValue(elements) {\n  let res;\n\n  if (typeof custom.getPostLoadVolumeIdTagValue !== 'undefined') {\n    res = custom.getPostLoadVolumeIdTagValue(elements);\n  } else {\n    // constant acquisition time for volumes\n    const acqTime = safeGet(elements, TagKeys.AcquisitionTime);\n    if (typeof acqTime !== 'undefined') {\n      res = parseFloat(acqTime);\n    }\n  }\n\n  return res;\n}\n","import {DataElement} from './dataElement.js';\n\n/**\n * Date object.\n *\n * @typedef {object} DateObj\n * @property {number} year The year number.\n * @property {number} monthIndex The month index ([0, 11] range).\n * @property {number} day The day number.\n */\n\n/**\n * Time object.\n *\n * @typedef {object} TimeObj\n * @property {number} hours The hours number.\n * @property {number} minutes The minutes number.\n * @property {number} seconds The seconds number.\n * @property {number} milliseconds The milliseconds number.\n */\n\n/**\n * Get a 'date' object with {year, monthIndex, day} ready for the\n *   Date constructor from a DICOM element with vr=DA.\n *\n * @param {DataElement} element The DICOM element with date information.\n * @returns {DateObj|undefined} The 'date' object.\n */\nexport function getDateObj(element) {\n  if (typeof element === 'undefined') {\n    return undefined;\n  }\n  if (element.value.length !== 1) {\n    return undefined;\n  }\n  const daValue = element.value[0];\n  // Two possible formats:\n  // - standard 'YYYYMMDD'\n  // - non-standard 'YYYY.MM.DD' (previous ACR-NEMA)\n  let monthBeginIndex = 4;\n  let dayBeginIndex = 6;\n  if (daValue.length === 10) {\n    monthBeginIndex = 5;\n    dayBeginIndex = 8;\n  }\n  const daYears = parseInt(daValue.substring(0, 4), 10);\n  // 0-11 range\n  const daMonthIndex = daValue.length >= monthBeginIndex + 2\n    ? parseInt(daValue.substring(\n      monthBeginIndex, monthBeginIndex + 2), 10) - 1 : 0;\n  const daDay = daValue.length === dayBeginIndex + 2\n    ? parseInt(daValue.substring(\n      dayBeginIndex, dayBeginIndex + 2), 10) : 0;\n  return {\n    year: daYears,\n    monthIndex: daMonthIndex,\n    day: daDay\n  };\n}\n\n/**\n * Get a time object with {hours, minutes, seconds} ready for the\n *   Date constructor from a DICOM element with vr=TM.\n *\n * @param {DataElement} element The DICOM element with date information.\n * @returns {TimeObj|undefined} The time object.\n */\nexport function getTimeObj(element) {\n  if (typeof element === 'undefined') {\n    return undefined;\n  }\n  if (element.value.length !== 1) {\n    return undefined;\n  }\n  // format: HH[MMSS.FFFFFF]\n  const tmValue = element.value[0];\n  const tmHours = parseInt(tmValue.substring(0, 2), 10);\n  const tmMinutes = tmValue.length >= 4\n    ? parseInt(tmValue.substring(2, 4), 10) : 0;\n  const tmSeconds = tmValue.length >= 6\n    ? parseInt(tmValue.substring(4, 6), 10) : 0;\n  const tmFracSecondsStr = tmValue.length >= 8\n    ? tmValue.substring(7, 10) : 0;\n  const tmMilliSeconds = tmFracSecondsStr === 0 ? 0\n    : parseInt(tmFracSecondsStr, 10) *\n      Math.pow(10, 3 - tmFracSecondsStr.length);\n  return {\n    hours: tmHours,\n    minutes: tmMinutes,\n    seconds: tmSeconds,\n    milliseconds: tmMilliSeconds\n  };\n}\n\n/**\n * Get a javascript Date object from objects with date information.\n *\n * @param {DateObj} dateObj The date object.\n * @param {TimeObj} [timeObj] Optional time object.\n * @returns {Date|undefined} The full date.\n */\nexport function getDate(dateObj, timeObj) {\n  let res;\n  if (typeof dateObj !== 'undefined') {\n    let hours = 0;\n    let minutes = 0;\n    let seconds = 0;\n    let milliseconds = 0;\n    if (typeof timeObj !== 'undefined') {\n      if (typeof timeObj.hours !== 'undefined') {\n        hours = timeObj.hours;\n      }\n      if (typeof timeObj.minutes !== 'undefined') {\n        minutes = timeObj.minutes;\n      }\n      if (typeof timeObj.seconds !== 'undefined') {\n        seconds = timeObj.seconds;\n      }\n      if (typeof timeObj.milliseconds !== 'undefined') {\n        milliseconds = timeObj.milliseconds;\n      }\n    }\n    res = new Date(\n      dateObj.year,\n      dateObj.monthIndex,\n      dateObj.day,\n      hours,\n      minutes,\n      seconds,\n      milliseconds,\n    );\n  }\n  return res;\n}\n\n/**\n * Get a 'dateTime' object with {date, time} ready for the\n *   Date constructor from a DICOM element with vr=DT.\n *\n * @param {DataElement} element The DICOM element with date-time information.\n * @returns {{date: DateObj, time: TimeObj}|undefined} The time object.\n */\nexport function getDateTimeObj(element) {\n  if (typeof element === 'undefined') {\n    return undefined;\n  }\n  if (element.value.length !== 1) {\n    return undefined;\n  }\n  // format: YYYYMMDDHHMMSS.FFFFFF&ZZXX\n  const dtFullValue = element.value[0];\n  // remove offset (&ZZXX)\n  const dtValue = dtFullValue.split('&')[0];\n  const dateDataElement = new DataElement('DA');\n  dateDataElement.value = [dtValue.substring(0, 8)];\n  const dtDate = getDateObj(dateDataElement);\n  const timeDataElement = new DataElement('TM');\n  timeDataElement.value = [dtValue.substring(8)];\n  const dtTime = dtValue.length >= 9\n    ? getTimeObj(timeDataElement) : undefined;\n  return {\n    date: dtDate,\n    time: dtTime\n  };\n}\n\n/**\n * Extract date values from a Date object.\n *\n * @param {Date} date The input date.\n * @returns {DateObj|undefined} A 'date' object.\n */\nexport function dateToDateObj(date) {\n  let res;\n  if (typeof date !== 'undefined') {\n    res = {\n      year: date.getFullYear(),\n      monthIndex: date.getMonth(),\n      day: date.getDate()\n    };\n  }\n  return res;\n}\n\n/**\n * Extract time values from a Date object.\n *\n * @param {Date} date The input date.\n * @returns {TimeObj|undefined} A 'time' object.\n */\nexport function dateToTimeObj(date) {\n  let res;\n  if (typeof date !== 'undefined') {\n    res = {\n      hours: date.getHours(),\n      minutes: date.getMinutes(),\n      seconds: date.getSeconds(),\n      milliseconds: date.getMilliseconds()\n    };\n  }\n  return res;\n}\n\n/**\n * Get a DICOM formated date string 'YYYYMMDD'.\n *\n * @param {DateObj} dateObj The date to format.\n * @returns {string|undefined} The formated date.\n */\nexport function getDicomDate(dateObj) {\n  let res;\n  if (typeof dateObj !== 'undefined') {\n    // YYYYMMDD\n    res =\n      dateObj.year.toString() +\n      (dateObj.monthIndex + 1).toString().padStart(2, '0') +\n      dateObj.day.toString().padStart(2, '0')\n    ;\n  }\n  return res;\n}\n\n/**\n * Get a DICOM formated time string as 'HHMMSS'.\n *\n * @param {TimeObj} dateObj The date object to format.\n * @returns {string|undefined} The formated time.\n */\nexport function getDicomTime(dateObj) {\n  let res;\n  if (typeof dateObj !== 'undefined') {\n    // HHMMSS\n    res =\n      dateObj.hours.toString().padStart(2, '0') +\n      dateObj.minutes.toString().padStart(2, '0') +\n      dateObj.seconds.toString().padStart(2, '0')\n    ;\n  }\n  return res;\n}\n\n/**\n * Get a DICOM formated datetime string.\n *\n * @param {{date, time}} datetime The datetime to format.\n * @returns {string|undefined} The formated datetime.\n */\nexport function getDicomDateTime(datetime) {\n  let res;\n  if (typeof datetime !== 'undefined') {\n    if (typeof datetime.date !== 'undefined') {\n      res = getDicomDate(datetime.date);\n    }\n    if (typeof res !== 'undefined' &&\n      typeof datetime.time !== 'undefined'\n    ) {\n      res += getDicomTime(datetime.time);\n    }\n  }\n  return res;\n}\n","import {Size} from './size.js';\nimport {Spacing} from './spacing.js';\nimport {Geometry} from './geometry.js';\nimport {RescaleSlopeAndIntercept} from './rsi.js';\nimport {WindowLevel} from './windowLevel.js';\nimport {Image} from './image.js';\nimport {ColourMap} from './luts.js';\nimport {safeGet, safeGetAll} from '../dicom/dataElement.js';\nimport {\n  getImage2DSize,\n  getPixelSpacing,\n  getPixelAspectRatio,\n  getTagPixelUnit,\n  getOrientationMatrix,\n  getPhotometricInterpretation,\n  isMonochrome,\n  isSecondatyCapture\n} from '../dicom/dicomImage.js';\nimport {hasAnyPixelDataElement} from '../dicom/dicomTag.js';\nimport {getVolumeIdTagValue} from '../dicom/dicomVolume.js';\nimport {getSuvFactor} from '../dicom/dicomPet.js';\nimport {Point3D} from '../math/point.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from '../dicom/dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * @typedef {Object<string, DataElement>} DataElements\n */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  TransferSyntaxUID: '00020010',\n  SOPClassUID: '00080016',\n  SOPInstanceUID: '00080018',\n  Modality: '00080060',\n  NumberOfFrames: '00280008',\n  ImagePositionPatient: '00200032',\n  SamplesPerPixel: '00280002',\n  PlanarConfiguration: '00280006',\n  RescaleSlope: '00281053',\n  RescaleIntercept: '00281052',\n  VOILUTFunction: '00281056',\n  MediaStorageSOPClassUID: '00020002',\n  ImageType: '00080008',\n  PhotometricInterpretation: '00280004',\n  PixelRepresentation: '00280103',\n  BitsAllocated: '00280100',\n  BitsStored: '00280101',\n  HighBit: '00280102',\n  ImageOrientationPatient: '00200037',\n  WindowCenter: '00281050',\n  WindowLevel: '00281051',\n  WindowCenterWidthExplanation: '00281055',\n  RedPaletteColorLookupTableDescriptor: '00281101',\n  RedPaletteColorLookupTableData: '00281201',\n  GreenPaletteColorLookupTableData: '00281202',\n  BluePaletteColorLookupTableData: '00281203',\n  RecommendedDisplayFrameRate: '00082144'\n};\n\n/**\n * Meta tag keys.\n */\nconst MetaTagKeys = {\n  // patient\n  PatientName: '00100010',\n  PatientID: '00100020',\n  PatientBirthDate: '00100030',\n  PatientSex: '00100040',\n  // general study\n  StudyDate: '00080020',\n  StudyTime: '00080030',\n  StudyInstanceUID: '0020000D',\n  StudyID: '00200010',\n  StudyDescription: '00081030',\n  ReferringPhysicianName: '00080090',\n  // general series\n  SeriesDate: '00080021',\n  SeriesTime: '00080031',\n  SeriesInstanceUID: '0020000E',\n  SeriesNumber: '00200011',\n  // frame of reference\n  FrameOfReferenceUID: '00200052',\n  // general equipment\n  Manufacturer: '00080070',\n  ManufacturerModelName: '00081090',\n  DeviceSerialNumber: '00181000',\n  SoftwareVersions: '00181020',\n  // general image\n  LossyImageCompression: '00282110'\n};\n\n/**\n * Get the palette colour map.\n *\n * @param {Object<string, DataElement>} dataElements The data elements.\n * @returns {ColourMap|undefined} The palette colour map.\n */\nfunction getPaletteColourMap(dataElements) {\n  let colourMap;\n  // check red palette descriptor (should all be equal)\n  // Red Palette Color Lookup Table Descriptor\n  // 0: number of entries in the lookup table\n  // 1: first input value mapped\n  // 2: number of bits for each entry in the Lookup Table Data (8 or 16)\n  const descriptor =\n    safeGetAll(dataElements, TagKeys.RedPaletteColorLookupTableDescriptor);\n  if (typeof descriptor !== 'undefined' &&\n    descriptor.length === 3) {\n    let redLut;\n    let greenLut;\n    let blueLut;\n    // Red Palette Color Lookup Table Data\n    const redLutElement =\n      dataElements[TagKeys.RedPaletteColorLookupTableData];\n    // Green Palette Color Lookup Table Data\n    const greenLutElement =\n      dataElements[TagKeys.GreenPaletteColorLookupTableData];\n    // Blue Palette Color Lookup Table Data\n    const blueLutElement =\n      dataElements[TagKeys.BluePaletteColorLookupTableData];\n\n    if (descriptor[2] === 16) {\n      let doScale = false;\n      // (C.7.6.3.1.5 Palette Color Lookup Table Descriptor)\n      // Some implementations have encoded 8 bit entries with 16 bits\n      // allocated, padding the high bits;\n      let descSize = descriptor[0];\n      // (C.7.6.3.1.5 Palette Color Lookup Table Descriptor)\n      // The first Palette Color Lookup Table Descriptor value is the\n      // number of entries in the lookup table. When the number of table\n      // entries is equal to 216 then this value shall be 0.\n      if (descSize === 0) {\n        descSize = 65536;\n      }\n      // red palette VL\n      // TODO vl is undefined, find info elsewhere...\n      const vlSize = redLutElement.vl;\n      // check double size\n      if (vlSize !== 2 * descSize) {\n        doScale = true;\n        logger.info('16bits lut but size is not double. desc: ' +\n          descSize + ' vl: ' + vlSize);\n      }\n      // (C.7.6.3.1.6 Palette Color Lookup Table Data)\n      // Palette color values must always be scaled across the full\n      // range of available intensities\n      const bitsAllocated = parseInt(\n        safeGet(dataElements, TagKeys.BitsAllocated), 10);\n      if (bitsAllocated === 8) {\n        doScale = true;\n        logger.info(\n          'Scaling 16bits color lut since bits allocated is 8.');\n      }\n\n      if (doScale) {\n        const scaleTo8 = function (value) {\n          return value >> 8;\n        };\n\n        redLut = redLutElement.value.map(scaleTo8);\n        greenLut = greenLutElement.value.map(scaleTo8);\n        blueLut = blueLutElement.value.map(scaleTo8);\n      }\n    } else if (descriptor[2] === 8) {\n      // lut with vr=OW was read as Uint16, convert it to Uint8\n      logger.info(\n        'Scaling 16bits color lut since the lut descriptor is 8.');\n      let clone = redLutElement.value.slice(0);\n      // @ts-expect-error\n      redLut = Array.from(new Uint8Array(clone.buffer));\n      clone = greenLutElement.value.slice(0);\n      // @ts-expect-error\n      greenLut = Array.from(new Uint8Array(clone.buffer));\n      clone = blueLutElement.value.slice(0);\n      // @ts-expect-error\n      blueLut = Array.from(new Uint8Array(clone.buffer));\n    }\n    colourMap = new ColourMap(redLut, greenLut, blueLut);\n  }\n  // return\n  return colourMap;\n}\n\n/**\n * Get the window level presets.\n *\n * @param {Object<string, DataElement>} dataElements The data elements.\n * @param {number} intensityFactor The intensity factor.\n * @returns {object|undefined} The presets.\n */\nfunction getWindowPresets(dataElements, intensityFactor) {\n  let windowPresets;\n  const windowCenter = safeGetAll(dataElements, TagKeys.WindowCenter);\n  const windowWidth = safeGetAll(dataElements, TagKeys.WindowLevel);\n  if (typeof windowCenter !== 'undefined' &&\n    typeof windowWidth !== 'undefined') {\n    windowPresets = {};\n    const windowCWExplanation =\n      safeGetAll(dataElements, TagKeys.WindowCenterWidthExplanation);\n    let name;\n    for (let j = 0; j < windowCenter.length; ++j) {\n      const center = parseFloat(windowCenter[j]);\n      let width = parseFloat(windowWidth[j]);\n      if (center && width && width !== 0) {\n        name = '';\n        if (typeof windowCWExplanation !== 'undefined') {\n          name = windowCWExplanation[j];\n        }\n        if (name === '') {\n          name = 'Default' + j;\n        }\n        width *= intensityFactor;\n        if (width < 1) {\n          width = 1;\n        }\n        windowPresets[name] = {\n          wl: [new WindowLevel(\n            center * intensityFactor,\n            width\n          )],\n          name: name\n        };\n      }\n      if (width === 0) {\n        logger.warn('Zero window width found in DICOM.');\n      }\n    }\n  }\n  // return\n  return windowPresets;\n}\n\n/**\n * {@link Image} factory.\n */\nexport class ImageFactory {\n\n  /**\n   * Possible warning created by checkElements.\n   *\n   * @type {string|undefined}\n   */\n  #warning;\n\n  /**\n   * The PET SUV factor.\n   *\n   * @type {number|undefined}\n   */\n  #suvFactor;\n\n  /**\n   * Get a warning string if elements are not as expected.\n   * Created by checkElements.\n   *\n   * @returns {string|undefined} The warning.\n   */\n  getWarning() {\n    return this.#warning;\n  }\n\n  /**\n   * Check dicom elements.\n   *\n   * @param {DataElements} dataElements The DICOM data elements.\n   * @returns {string|undefined} A possible warning.\n   * @throws {Error} Error for missing or wrong data.\n   */\n  checkElements(dataElements) {\n    // reset\n    this.#warning = undefined;\n    // check image size\n    if (typeof getImage2DSize(dataElements) === 'undefined') {\n      throw new Error('No image rows or columns in DICOM file');\n    };\n    // check pixel data\n    if (!hasAnyPixelDataElement(dataElements)) {\n      throw new Error('No pixel data in DICOM file');\n    }\n    // check PET SUV\n    const modality = safeGet(dataElements, TagKeys.Modality);\n    if (typeof modality !== 'undefined' && modality === 'PT') {\n      const photometricInterpretation =\n        getPhotometricInterpretation(dataElements);\n      const SOPClassUID = safeGet(dataElements, TagKeys.SOPClassUID);\n      if (isSecondatyCapture(SOPClassUID) ||\n        !isMonochrome(photometricInterpretation)) {\n        return this.#warning;\n      }\n      const suvFactor = getSuvFactor(dataElements);\n      this.#suvFactor = suvFactor.value;\n      this.#warning = suvFactor.warning;\n    }\n\n    return this.#warning;\n  }\n\n  /**\n   * Get an {@link Image} object from the read DICOM file.\n   *\n   * @param {DataElements} dataElements The DICOM tags.\n   * @param {Uint8Array | Int8Array |\n   *   Uint16Array | Int16Array |\n   *   Uint32Array | Int32Array} pixelBuffer The pixel buffer.\n   * @param {number} numberOfFiles The input number of files.\n   * @returns {Image} A new Image.\n   * @throws {Error} Error for missing or wrong data.\n   */\n  create(dataElements, pixelBuffer, numberOfFiles) {\n    // safe get shortcuts\n    const safeGetLocal = function (key) {\n      return safeGet(dataElements, key);\n    };\n    const safeGetAllLocal = function (key) {\n      return safeGetAll(dataElements, key);\n    };\n\n    const size2D = getImage2DSize(dataElements);\n    const sizeValues = [size2D[0], size2D[1], 1];\n\n    // NumberOfFrames\n    const numberOfFrames = safeGetLocal(TagKeys.NumberOfFrames);\n    if (typeof numberOfFrames !== 'undefined') {\n      const number = parseInt(numberOfFrames, 10);\n      if (number > 1) {\n        sizeValues.push(number);\n      }\n    }\n\n    // image size\n    const size = new Size(sizeValues);\n\n    // image spacing\n    let spacingValues = [1, 1, 1];\n    const spacing2D = getPixelSpacing(dataElements);\n    if (typeof spacing2D !== 'undefined') {\n      spacingValues = [spacing2D[0], spacing2D[1], 1];\n    } else {\n      // try pixel aspect ratio\n      const ratio = getPixelAspectRatio(dataElements);\n      if (typeof ratio !== 'undefined') {\n        spacingValues = [ratio[0], ratio[1], 1];\n        logger.warn('Use pixel aspect ratio as spacing');\n      }\n    }\n    const spacing = new Spacing(spacingValues);\n\n    // ImagePositionPatient\n    const imagePositionPatient = safeGetAllLocal(TagKeys.ImagePositionPatient);\n    // slice position\n    let slicePosition = new Array(0, 0, 0);\n    if (typeof imagePositionPatient !== 'undefined') {\n      slicePosition = [\n        parseFloat(imagePositionPatient[0]),\n        parseFloat(imagePositionPatient[1]),\n        parseFloat(imagePositionPatient[2])\n      ];\n    }\n\n    // Image orientation patient\n    const orientationMatrix = getOrientationMatrix(dataElements);\n\n    // geometry\n    const origin = new Point3D(\n      slicePosition[0], slicePosition[1], slicePosition[2]);\n    const time = getVolumeIdTagValue(dataElements);\n    const geometry = new Geometry(\n      [origin], size, spacing, orientationMatrix, time);\n\n    // SOP Instance UID\n    const sopInstanceUid = safeGetLocal(TagKeys.SOPInstanceUID);\n\n    // Sample per pixels\n    let samplesPerPixel = safeGetLocal(TagKeys.SamplesPerPixel);\n    if (typeof samplesPerPixel === 'undefined') {\n      samplesPerPixel = 1;\n    }\n\n    // check buffer size\n    const bufferSize = size.getTotalSize() * samplesPerPixel;\n    if (bufferSize !== pixelBuffer.length) {\n      logger.warn('Badly sized pixel buffer: ' +\n        pixelBuffer.length + ' != ' + bufferSize);\n      if (bufferSize < pixelBuffer.length) {\n        pixelBuffer = pixelBuffer.slice(0, size.getTotalSize());\n      } else {\n        throw new Error('Underestimated buffer size, can\\'t fix it...');\n      }\n    }\n\n    // image\n    const image = new Image(geometry, pixelBuffer, [sopInstanceUid]);\n\n    // PhotometricInterpretation\n    const photo = getPhotometricInterpretation(dataElements);\n    if (typeof photo !== 'undefined') {\n      image.setPhotometricInterpretation(photo);\n    }\n    // PlanarConfiguration\n    const planarConfiguration =\n      safeGetLocal(TagKeys.PlanarConfiguration);\n    if (typeof planarConfiguration !== 'undefined') {\n      image.setPlanarConfiguration(planarConfiguration);\n    }\n\n    // rescale slope and intercept\n    let slope = 1;\n    // RescaleSlope\n    const rescaleSlope = safeGetLocal(TagKeys.RescaleSlope);\n    if (typeof rescaleSlope !== 'undefined') {\n      const value = parseFloat(rescaleSlope);\n      if (!isNaN(value)) {\n        slope = value;\n      }\n    }\n    let intercept = 0;\n    // RescaleIntercept\n    const rescaleIntercept = safeGetLocal(TagKeys.RescaleIntercept);\n    if (typeof rescaleIntercept !== 'undefined') {\n      const value = parseFloat(rescaleIntercept);\n      if (!isNaN(value)) {\n        intercept = value;\n      }\n    }\n\n    // PET SUV\n    let isPetWithSuv = false;\n    let intensityFactor = 1;\n    if (typeof this.#suvFactor !== 'undefined') {\n      isPetWithSuv = true;\n      intensityFactor = this.#suvFactor;\n      logger.info('Applying PET SUV calibration: ' + intensityFactor);\n      slope *= intensityFactor;\n      intercept *= intensityFactor;\n    }\n    const rsi = new RescaleSlopeAndIntercept(slope, intercept);\n    image.setRescaleSlopeAndIntercept(rsi);\n\n    // PALETTE COLOR lut\n    if (image.getPhotometricInterpretation() === 'PALETTE COLOR') {\n      const colourMap = getPaletteColourMap(dataElements);\n      if (typeof colourMap !== 'undefined') {\n        image.setPaletteColourMap(colourMap);\n      }\n    }\n\n    // meta information\n    const meta = {\n      numberOfFiles: numberOfFiles\n    };\n\n    // defaults\n    meta.TransferSyntaxUID = safeGetLocal(TagKeys.TransferSyntaxUID);\n    meta.MediaStorageSOPClassUID =\n      safeGetLocal(TagKeys.MediaStorageSOPClassUID);\n    meta.SOPClassUID = safeGetLocal(TagKeys.SOPClassUID);\n    meta.Modality = safeGetLocal(TagKeys.Modality);\n    meta.ImageType = safeGetLocal(TagKeys.ImageType);\n    meta.SamplesPerPixel = safeGetLocal(TagKeys.SamplesPerPixel);\n    meta.PhotometricInterpretation =\n      safeGetLocal(TagKeys.PhotometricInterpretation);\n    meta.PixelRepresentation = safeGetLocal(TagKeys.PixelRepresentation);\n    meta.BitsAllocated = safeGetLocal(TagKeys.BitsAllocated);\n\n    meta.BitsStored = safeGetLocal(TagKeys.BitsStored);\n    meta.HighBit = safeGetLocal(TagKeys.HighBit);\n\n    // meta tags\n    const metaKeys = Object.keys(MetaTagKeys);\n    for (const key of metaKeys) {\n      meta[key] = safeGetLocal(MetaTagKeys[key]);\n    }\n\n    // local pixel unit\n    if (isPetWithSuv) {\n      meta.pixelUnit = 'SUV';\n    } else {\n      const pixelUnit = getTagPixelUnit(dataElements);\n      if (typeof pixelUnit !== 'undefined') {\n        meta.pixelUnit = pixelUnit;\n      }\n    }\n\n    // length unit\n    if (typeof spacing2D === 'undefined') {\n      meta.lengthUnit = 'unit.pixel';\n    } else {\n      meta.lengthUnit = 'unit.mm';\n    }\n\n    // window level presets\n    const presets = getWindowPresets(dataElements, intensityFactor);\n    if (typeof presets !== 'undefined') {\n      meta.windowPresets = presets;\n    }\n    meta.VOILUTFunction = safeGetLocal(TagKeys.VOILUTFunction);\n\n    // store the meta data\n    image.setMeta(meta);\n\n    return image;\n  }\n\n}","import {\n  getDateObj,\n  getTimeObj,\n  getDate,\n  getDateTimeObj\n} from './dicomDate.js';\nimport {checkDataElement} from './dataElement.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  SeriesDate: '00080021',\n  AcquisitionDate: '00080022',\n  SeriesTime: '00080031',\n  AcquisitionTime: '00080032',\n  RadiopharmaceuticalInformationSequence: '00540016',\n  RadionuclideTotalDose: '00181074',\n  RadionuclideHalfLife: '00181075',\n  RadiopharmaceuticalStartDateTime: '00181078',\n  RadiopharmaceuticalStartTime: '00181072',\n  FrameReferenceTime: '00541300',\n  ActualFrameDuration: '00181242',\n  CorrectedImage: '00280051',\n  DecayCorrection: '00541102',\n  Units: '00541001',\n  PatientWeight: '00101030'\n};\n\n/**\n * Get the decayed dose (Bq).\n *\n * @param {Object<string, DataElement>} elements The DICOM elements to check.\n * @returns {object} The value and a warning if\n *   the elements are not as expected.\n */\nfunction getDecayedDose(elements) {\n  let warning = '';\n  let warn;\n\n  // SeriesDate (type1)\n  const seriesDateEl = elements[TagKeys.SeriesDate];\n  const seriesDateObj = getDateObj(seriesDateEl);\n\n  let totalDose;\n  let halfLife;\n  let radioStart;\n\n  const radioInfoSqStr = 'RadiopharmaceuticalInformationSequence (00540016)';\n  const radioInfoSq = elements[TagKeys.RadiopharmaceuticalInformationSequence];\n  warning += checkDataElement(radioInfoSq, radioInfoSqStr);\n  if (typeof radioInfoSq !== 'undefined') {\n    if (radioInfoSq.value.length !== 1) {\n      logger.warn(\n        'Found more than 1 istopes in RadiopharmaceuticalInformation Sequence.'\n      );\n    }\n\n    // RadionuclideTotalDose (type3, Bq)\n    const totalDoseStr = 'RadionuclideTotalDose (00181074)';\n    const totalDoseEl = radioInfoSq.value[0][TagKeys.RadionuclideTotalDose];\n    warn = checkDataElement(totalDoseEl, totalDoseStr);\n    if (warn.length === 0) {\n      const dose = parseFloat(totalDoseEl.value[0]);\n      if (!isNaN(dose)) {\n        totalDose = dose;\n      } else {\n        warning += ' TotalDose is not a number';\n      }\n    } else {\n      warning += warn;\n    }\n\n    // RadionuclideHalfLife (type3, seconds)\n    const halfLifeStr = 'RadionuclideHalfLife (00181075)';\n    const halfLifeEl = radioInfoSq.value[0][TagKeys.RadionuclideHalfLife];\n    warn = checkDataElement(halfLifeEl, halfLifeStr);\n    if (warn.length === 0) {\n      const hl = parseFloat(halfLifeEl.value[0]);\n      if (!isNaN(hl)) {\n        halfLife = hl;\n      } else {\n        warning += ' HalfLife is not a number';\n      }\n    } else {\n      warning += warn;\n    }\n\n    // RadiopharmaceuticalStartDateTime (type3)\n    const radioStartDateTimeEl =\n      radioInfoSq.value[0][TagKeys.RadiopharmaceuticalStartDateTime];\n    let radioStartDateObj;\n    let radioStartTimeObj;\n    if (typeof radioStartDateTimeEl === 'undefined') {\n      // use seriesDate as radioStartDate\n      radioStartDateObj = seriesDateObj;\n      // try RadiopharmaceuticalStartTime (type3)\n      const radioStartTimeEl =\n        radioInfoSq.value[0][TagKeys.RadiopharmaceuticalStartTime];\n      radioStartTimeObj = getTimeObj(radioStartTimeEl);\n    } else {\n      const radioStartDateTime = getDateTimeObj(radioStartDateTimeEl);\n      radioStartDateObj = radioStartDateTime.date;\n      radioStartTimeObj = radioStartDateTime.time;\n    }\n    radioStart = getDate(radioStartDateObj, radioStartTimeObj);\n  }\n\n  // SeriesTime (type1)\n  const seriesTimeEl = elements[TagKeys.SeriesTime];\n  const seriesTimeObj = getTimeObj(seriesTimeEl);\n  // Series date/time\n  let scanStart = getDate(seriesDateObj, seriesTimeObj);\n\n  // scanStart Date check\n  // AcquisitionDate (type3)\n  const acqDateEl = elements[TagKeys.AcquisitionDate];\n  // AcquisitionTime (type3)\n  const acqTimeEl = elements[TagKeys.AcquisitionTime];\n  if (typeof acqDateEl !== 'undefined' &&\n    typeof acqTimeEl !== 'undefined') {\n    const acqDateObj = getDateObj(acqDateEl);\n    const acqTimeObj = getTimeObj(acqTimeEl);\n    const acqDate = getDate(acqDateObj, acqTimeObj);\n\n    if (scanStart > acqDate) {\n      const diff = scanStart.getTime() - acqDate.getTime();\n      const warn = 'Series date/time is after Aquisition date/time (diff=' +\n        diff.toString() + 'ms) ';\n      logger.debug(warn);\n\n      // back compute from center (average count rate) of time window\n      // for bed position (frame) in series (reliable in all cases)\n\n      let frameRefTime = 0;\n      const frameRefTimeElStr = 'FrameReferenceTime (00541300)';\n      const frameRefTimeEl = elements[TagKeys.FrameReferenceTime];\n      warning += checkDataElement(frameRefTimeEl, frameRefTimeElStr);\n      if (typeof frameRefTimeEl !== 'undefined') {\n        frameRefTime = frameRefTimeEl.value[0];\n      }\n      let actualFrameDuration = 0;\n      const actualFrameDurationElStr = 'ActualFrameDuration (00181242)';\n      const actualFrameDurationEl = elements[TagKeys.ActualFrameDuration];\n      warning += checkDataElement(\n        actualFrameDurationEl, actualFrameDurationElStr);\n      if (typeof actualFrameDurationEl !== 'undefined') {\n        actualFrameDuration = actualFrameDurationEl.value[0];\n      }\n      if (frameRefTime > 0 && actualFrameDuration > 0) {\n        // convert to seconds\n        actualFrameDuration = actualFrameDuration / 1000;\n        frameRefTime = frameRefTime / 1000;\n        const decayConstant = Math.log(2) / halfLife;\n        const decayDuringFrame = decayConstant * actualFrameDuration;\n        const averageCountRateTimeWithinFrame =\n          1 /\n          decayConstant *\n          Math.log(decayDuringFrame / (1 - Math.exp(-decayDuringFrame)));\n        const offsetSeconds = averageCountRateTimeWithinFrame - frameRefTime;\n        scanStart = new Date(\n          acqDateObj.year,\n          acqDateObj.monthIndex,\n          acqDateObj.day,\n          acqTimeObj.hours,\n          acqTimeObj.minutes,\n          acqTimeObj.seconds + offsetSeconds,\n          acqTimeObj.milliseconds\n        );\n      }\n    }\n  }\n\n  // decayed dose (Bq)\n  let decayedDose;\n  if (typeof scanStart !== 'undefined' &&\n    typeof radioStart !== 'undefined' &&\n    typeof totalDose !== 'undefined' &&\n    typeof halfLife !== 'undefined') {\n    // decay time (s) (Date diff is in milliseconds)\n    const decayTime = (scanStart.getTime() - radioStart.getTime()) / 1000;\n    const decay = Math.pow(2, (-decayTime / halfLife));\n    decayedDose = totalDose * decay;\n  }\n\n  return {\n    value: decayedDose,\n    warning: warning\n  };\n}\n\n/**\n * Get the PET SUV factor.\n *\n * Ref:\n * - {@link https://qibawiki.rsna.org/index.php/Standardized_Uptake_Value_(SUV)#SUV_Calculation},\n * - {@link https://qibawiki.rsna.org/images/6/62/SUV_vendorneutral_pseudocode_happypathonly_20180626_DAC.pdf},\n * - {@link https://qibawiki.rsna.org/images/8/86/SUV_vendorneutral_pseudocode_20180626_DAC.pdf}.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {object} The value and a warning if\n *   the elements are not as expected.\n */\nexport function getSuvFactor(elements) {\n  let warning = '';\n  const result = {};\n\n\n  // CorrectedImage (type2): must contain ATTN and DECY\n  const corrImageTagStr = 'Corrected Image (00280051)';\n  const corrImageEl = elements[TagKeys.CorrectedImage];\n  warning += checkDataElement(corrImageEl, corrImageTagStr, ['ATTN', 'DECY']);\n  // DecayCorrection (type1): must be START\n  const decayCorrTagStr = 'Decay Correction (00541102)';\n  const decayCorrEl = elements[TagKeys.DecayCorrection];\n  warning += checkDataElement(decayCorrEl, decayCorrTagStr, ['START']);\n  // Units (type1): must be BQML\n  const unitTagStr = 'Units (00541001)';\n  const unitEl = elements[TagKeys.Units];\n  warning += checkDataElement(unitEl, unitTagStr, ['BQML']);\n\n  // PatientWeight (type3, kg)\n  let patWeight;\n  const patientWeightStr = ' PatientWeight (00101030)';\n  const patWeightEl = elements[TagKeys.PatientWeight];\n  const warn = checkDataElement(patWeightEl, patientWeightStr);\n  if (warn.length === 0) {\n    const weight = parseFloat(patWeightEl.value[0]);\n    if (!isNaN(weight)) {\n      patWeight = weight;\n    } else {\n      warning += ' PatientWeight is not a number';\n    }\n  } else {\n    warning += warn;\n  }\n\n  // Decayed dose (Bq)\n  const decayedDose = getDecayedDose(elements);\n  warning += decayedDose.warning;\n\n\n  if (warning.length !== 0) {\n    result.warning = 'Cannot calculate PET SUV:' + warning;\n  } else {\n    // SUV factor (grams/Bq)\n    result.value = (patWeight * 1000) / decayedDose.value;\n  }\n\n  return result;\n}\n","/**\n * Data writer.\n */\nexport class DataWriter {\n\n  /**\n   * Is the endianness Little Endian.\n   *\n   * @type {boolean}\n   */\n  #isLittleEndian = true;\n\n  /**\n   * The main data view.\n   *\n   * @type {DataView}\n   */\n  #view;\n\n  /**\n   * @param {ArrayBuffer} buffer The input array buffer.\n   * @param {boolean} [isLittleEndian] Flag to tell if the data is\n   *   little or big endian.\n   */\n  constructor(buffer, isLittleEndian) {\n    // Set endian flag if not defined.\n    if (typeof isLittleEndian !== 'undefined') {\n      this.#isLittleEndian = isLittleEndian;\n    }\n    this.#view = new DataView(buffer);\n  }\n\n  /**\n   * Write Uint8 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {number} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeUint8(byteOffset, value) {\n    this.#view.setUint8(byteOffset, value);\n    return byteOffset + Uint8Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write Int8 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {number} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeInt8(byteOffset, value) {\n    this.#view.setInt8(byteOffset, value);\n    return byteOffset + Int8Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write Uint16 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {number} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeUint16(byteOffset, value) {\n    this.#view.setUint16(byteOffset, value, this.#isLittleEndian);\n    return byteOffset + Uint16Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write Int16 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {number} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeInt16(byteOffset, value) {\n    this.#view.setInt16(byteOffset, value, this.#isLittleEndian);\n    return byteOffset + Int16Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write Uint32 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {number} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeUint32(byteOffset, value) {\n    this.#view.setUint32(byteOffset, value, this.#isLittleEndian);\n    return byteOffset + Uint32Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write Uint64 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {bigint} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeUint64(byteOffset, value) {\n    this.#view.setBigUint64(byteOffset, value, this.#isLittleEndian);\n    return byteOffset + BigUint64Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write Int32 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {number} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeInt32(byteOffset, value) {\n    this.#view.setInt32(byteOffset, value, this.#isLittleEndian);\n    return byteOffset + Int32Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write Int64 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {bigint} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeInt64(byteOffset, value) {\n    this.#view.setBigInt64(byteOffset, value, this.#isLittleEndian);\n    return byteOffset + BigInt64Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write Float32 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {number} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeFloat32(byteOffset, value) {\n    this.#view.setFloat32(byteOffset, value, this.#isLittleEndian);\n    return byteOffset + Float32Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write Float64 data.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {number} value The data to write.\n   * @returns {number} The new offset position.\n   */\n  writeFloat64(byteOffset, value) {\n    this.#view.setFloat64(byteOffset, value, this.#isLittleEndian);\n    return byteOffset + Float64Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write string data of length 4 as hexadecimal (no '0x' prefix).\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {string} str The hexadecimal string to write ('####').\n   * @returns {number} The new offset position.\n   */\n  writeHex(byteOffset, str) {\n    // remove first two chars and parse\n    const value = parseInt(str, 16);\n    this.#view.setUint16(byteOffset, value, this.#isLittleEndian);\n    return byteOffset + Uint16Array.BYTES_PER_ELEMENT;\n  }\n\n  /**\n   * Write a boolean array as bitpacked Uint8 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array|Uint8Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeBinaryArray(byteOffset, array) {\n    if (array.length % 8 !== 0) {\n      throw new Error('Cannot write boolean array as binary.');\n    }\n    let byte;\n    let val;\n    for (let i = 0, len = array.length; i < len; i += 8) {\n      byte = 0;\n      for (let j = 0; j < 8; ++j) {\n        val = array[i + j] === 0 ? 0 : 1;\n        byte += val << j;\n      }\n      byteOffset = this.writeUint8(byteOffset, byte);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Uint8 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array|Uint8Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeUint8Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeUint8(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Int8 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeInt8Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeInt8(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Uint16 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeUint16Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeUint16(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Int16 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeInt16Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeInt16(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Uint32 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeUint32Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeUint32(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Uint64 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeUint64Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeUint64(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Int32 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeInt32Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeInt32(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Int64 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeInt64Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeInt64(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Float32 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeFloat32Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeFloat32(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n  /**\n   * Write Float64 array.\n   *\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} array The array to write.\n   * @returns {number} The new offset position.\n   */\n  writeFloat64Array(byteOffset, array) {\n    for (let i = 0, len = array.length; i < len; ++i) {\n      byteOffset = this.writeFloat64(byteOffset, array[i]);\n    }\n    return byteOffset;\n  }\n\n} // class DataWriter\n","import {\n  is32bitVLVR,\n  isCharSetStringVR,\n  vrTypes\n} from './dictionary.js';\nimport {\n  Tag,\n  getTagFromDictionary,\n  getTagFromKey,\n  getItemTag,\n  getItemDelimitationItemTag,\n  getSequenceDelimitationItemTag,\n  getFileMetaInformationGroupLengthTag,\n  isAnyPixelDataTag,\n  isItemTag,\n  isItemDelimitationItemTag,\n  tagCompareFunction\n} from './dicomTag.js';\nimport {\n  getDwvUIDPrefix,\n  getImplementationClassUID,\n  getImplementationVersionName,\n  isImplicitTransferSyntax,\n  isBigEndianTransferSyntax,\n  getDataElementPrefixByteSize\n} from './dicomParser.js';\nimport {DataElement} from './dataElement.js';\nimport {DataWriter} from './dataWriter.js';\nimport {DataReader} from './dataReader.js';\nimport {logger} from '../utils/logger.js';\n\n// local generated uid counter\nlet _uidCount = 0;\n\n/**\n * Writer rule.\n */\nexport class WriterRule {\n  /**\n   * Rule action: `copy`, `remove`, `clear` or `replace`.\n   *\n   * @type {string}\n   */\n  action;\n  /**\n   * Optional value to use for replace action.\n   *\n   * @type {any|undefined}\n   */\n  value;\n\n  /**\n   * @param {string} action The rule action.\n   */\n  constructor(action) {\n    this.action = action;\n  }\n}\n\n/**\n * Possible writer actions.\n *\n * @type {Object<string, Function>}\n */\nconst writerActions = {\n  copy: function (item) {\n    return item;\n  },\n  remove: function () {\n    return null;\n  },\n  clear: function (item) {\n    item.value = [];\n    return item;\n  },\n  replace: function (item, value) {\n    item.value = [value];\n    return item;\n  }\n};\n\n/**\n * Get simple (non official) DICOM anonymisation rules.\n *\n * @returns {Object<string, WriterRule>} The rules.\n */\nexport function getDefaultAnonymisationRules() {\n  return {\n    default: {action: 'copy', value: null},\n    PatientName: {action: 'replace', value: 'Anonymized'}, // tag\n    'Meta Element': {action: 'copy', value: null}, // group '0002'\n    Acquisition: {action: 'copy', value: null}, // group '0018'\n    'Image Presentation': {action: 'copy', value: null}, // group '0028'\n    Procedure: {action: 'copy', value: null}, // group '0040'\n    'Pixel Data': {action: 'copy', value: null} // group '7fe0'\n  };\n}\n\n/**\n * Get a UID for a DICOM tag.\n *\n * Note: Use {@link https://github.com/uuidjs/uuid}?\n *\n * Ref:\n * - {@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/chapter_9.html},\n * - {@link http://dicomiseasy.blogspot.com/2011/12/chapter-4-dicom-objects-in-chapter-3.html},\n * - {@link https://stackoverflow.com/questions/46304306/how-to-generate-unique-dicom-uid}.\n *\n * @param {string} tagName The input tag.\n * @returns {string} The corresponding UID.\n */\nexport function getUID(tagName) {\n  const prefix = getDwvUIDPrefix() + '.';\n  // date (only numbers), do not keep milliseconds\n  const date = (new Date()).toISOString().replace(/\\D/g, '');\n  const datePart = '.' + date.substring(0, 14);\n  // count\n  _uidCount += 1;\n  const countPart = '.' + _uidCount;\n\n  // uid = prefix . tag . date . count\n  let uid = prefix;\n\n  // limit tag part to not exceed 64 length\n  const nonTagLength = prefix.length + countPart.length + datePart.length;\n  const leni = Math.min(tagName.length, 64 - nonTagLength);\n  if (leni > 1) {\n    let tagNumber = '';\n    for (let i = 0; i < leni; ++i) {\n      tagNumber += tagName.charCodeAt(i);\n    }\n    uid += tagNumber.substring(0, leni);\n  }\n\n  // finish\n  uid += datePart + countPart;\n\n  return uid;\n}\n\n/**\n * Return true if the input number is even.\n *\n * @param {number} number The number to check.\n * @returns {boolean} True is the number is even.\n */\nfunction isEven(number) {\n  return number % 2 === 0;\n}\n\n/**\n * Is the input VR a VR that stores data in a typed array.\n * TODO: include ox and xs?\n *\n * @param {string} vr The element VR.\n * @returns {boolean} True if the VR is a typed array one.\n */\nfunction isTypedArrayVr(vr) {\n  const vrType = vrTypes[vr];\n  return typeof vrType !== 'undefined' &&\n    vrType !== 'string';\n}\n\n/**\n * Is the input VR a string VR.\n *\n * @param {string} vr The element VR.\n * @returns {boolean} True if the VR is a string one.\n */\nfunction isStringVr(vr) {\n  const vrType = vrTypes[vr];\n  return typeof vrType !== 'undefined' &&\n    vrType === 'string';\n}\n\n/**\n * Is the input VR a VR that could need padding.\n *\n * See {@link http://dicom.nema.org/medical/dicom/2022a/output/chtml/part05/sect_6.2.html}.\n *\n * @param {string} vr The element VR.\n * @returns {boolean} True if the VR needs padding.\n */\nfunction isVrToPad(vr) {\n  return isStringVr(vr) || vr === 'OB';\n}\n\n/**\n * Get the VR specific padding value.\n *\n * @param {string} vr The element VR.\n * @returns {string} The value used to pad.\n */\nfunction getVrPad(vr) {\n  let pad = '';\n  if (isStringVr(vr)) {\n    if (vr === 'UI') {\n      pad = '\\0';\n    } else {\n      pad = ' ';\n    }\n  }\n  return pad;\n}\n\n/**\n * Push a value at the end of an input Uint8Array.\n *\n * @param {Array|Uint8Array} arr The input array.\n * @param {Array|Uint8Array} value The value to push.\n * @returns {Uint8Array} The new array.\n */\nfunction uint8ArrayPush(arr, value) {\n  const newArr = new Uint8Array(arr.length + value.length);\n  newArr.set(arr);\n  newArr.set(value, arr.length);\n  return newArr;\n}\n\n/**\n * Pad an input OB value.\n *\n * @param {Array|Uint8Array} value The input value.\n * @returns {Array|Uint8Array} The padded input.\n */\nfunction padOBValue(value) {\n  if (value !== null &&\n    typeof value !== 'undefined' &&\n    typeof value.length !== 'undefined') {\n    // calculate size and pad if needed\n    if (value.length !== 0 &&\n      typeof value[0].length !== 'undefined') {\n      // handle array of array\n      let size = 0;\n      for (const valueItem of value) {\n        size += valueItem.length;\n      }\n      if (!isEven(size)) {\n        value[value.length - 1] = uint8ArrayPush(\n          value[value.length - 1], [0]);\n      }\n    } else {\n      if (!isEven(value.length)) {\n        value = uint8ArrayPush(value, [0]);\n      }\n    }\n  } else {\n    throw new Error('Cannot pad undefined or null OB value.');\n  }\n  // uint8ArrayPush may create a new array so we\n  // need to return it\n  return value;\n}\n\n/**\n * Helper method to flatten an array of typed arrays to 2D typed array.\n *\n * @param {Array} initialArray Array of typed arrays.\n * @returns {object} A typed array containing all values.\n */\nfunction flattenArrayOfTypedArrays(initialArray) {\n  // if this is not a array of arrays, just return the initial one\n  if (typeof initialArray[0].length === 'undefined') {\n    return initialArray;\n  }\n  // calculate full length\n  let flattenendArrayLength = 0;\n  for (const subArray of initialArray) {\n    flattenendArrayLength += subArray.length;\n  }\n  // create flattened\n  const flattenedArray = new initialArray[0].constructor(flattenendArrayLength);\n  // fill it\n  let offset = 0;\n  for (const subArray of initialArray) {\n    flattenedArray.set(subArray, offset);\n    offset += subArray.length;\n  }\n\n  return flattenedArray;\n}\n\n/**\n * Default text encoder.\n */\nclass DefaultTextEncoder {\n  /**\n   * Encode an input string.\n   *\n   * @param {string} str The string to encode.\n   * @returns {Uint8Array} The encoded string.\n   */\n  encode(str) {\n    const result = new Uint8Array(str.length);\n    for (let i = 0, leni = str.length; i < leni; ++i) {\n      result[i] = str.charCodeAt(i);\n    }\n    return result;\n  }\n}\n\n/**\n * Small list of used tag keys.\n */\nconst TagKeys = {\n  TransferSyntax: '00020010',\n  SpecificCharacterSet: '00080005',\n  BitsAllocated: '00280100',\n};\n\n/**\n * DICOM writer.\n *\n * @example\n * import {DicomParser, DicomWriter} from '//esm.sh/dwv';\n * // add link to html\n * const link = document.createElement(\"a\");\n * link.appendChild(document.createTextNode(\"download\"));\n * const div = document.getElementById(\"dwv\");\n * div.appendChild(link);\n * // XMLHttpRequest onload callback\n * const onload = function (event) {\n *   const parser = new DicomParser();\n *   parser.parse(event.target.response);\n *   // create writer\n *   const writer = new DicomWriter();\n *   // get buffer using default rules\n *   const dicomBuffer = writer.getBuffer(parser.getDicomElements());\n *   // create blob\n *   const blob = new Blob([dicomBuffer], {type: 'application/dicom'});\n *   // add blob to download link\n *   link.href = URL.createObjectURL(blob);\n *   link.download = \"anonym.dcm\";\n * };\n * // DICOM file request\n * const request = new XMLHttpRequest();\n * const url = 'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm';\n * request.open('GET', url);\n * request.responseType = 'arraybuffer';\n * request.onload = onload;\n * request.send();\n */\nexport class DicomWriter {\n\n  /**\n   * Flag to use VR=UN for private sequences, default to false\n   * (mainly used in tests).\n   *\n   * @type {boolean}\n   */\n  #useUnVrForPrivateSq = false;\n\n  /**\n   * Flag to activate or not the vr=UN tag check and fix\n   * if present in the dictionary. Default to true.\n   *\n   * @type {boolean}\n   */\n  #fixUnknownVR = true;\n\n  /**\n   * Default rules: just copy.\n   *\n   * @type {Object<string, WriterRule>}\n   */\n  #defaultRules = {\n    default: {action: 'copy', value: null}\n  };\n\n  /**\n   * Writing rules.\n   *\n   * @type {Object<string, WriterRule>}\n   */\n  #rules = this.#defaultRules;\n\n  /**\n   * List of compulsory tags keys.\n   *\n   * @type {string[]}\n   */\n  #compulsoryTags = [];\n\n  /**\n   * Default text encoder.\n   *\n   * @type {DefaultTextEncoder}\n   */\n  #defaultTextEncoder = new DefaultTextEncoder();\n\n  /**\n   * Special text encoder.\n   *\n   * @type {DefaultTextEncoder|TextEncoder}\n   */\n  #textEncoder = this.#defaultTextEncoder;\n\n  /**\n   * Set the use UN VR for private sequence flag.\n   *\n   * @param {boolean} flag True to use UN VR.\n   */\n  setUseUnVrForPrivateSq(flag) {\n    this.#useUnVrForPrivateSq = flag;\n  }\n\n  /**\n   * Set the vr=UN check and fix flag.\n   *\n   * @param {boolean} flag True to activate the check and fix.\n   */\n  setFixUnknownVR(flag) {\n    this.#fixUnknownVR = flag;\n  }\n\n  /**\n   * Set the writing rules.\n   * List of writer rules indexed by either `default`,\n   *   tagKey, tagName or groupName.\n   * Each DICOM element will be checked to see if a rule is applicable.\n   * First checked by tagKey, tagName and then by groupName,\n   * if nothing is found the default rule is applied.\n   *\n   * @param {Object<string, WriterRule>} rules The input rules.\n   * @param {boolean} [addMissingTags] If true, explicit tags that\n   *   have replace rule and a value will be\n   *   added if missing. Defaults to false.\n   */\n  setRules(rules, addMissingTags) {\n    this.#rules = rules;\n\n    // default compulsory list is empty\n    this.#compulsoryTags = [];\n\n    // use replace rule tags as compulsory tags\n    if (addMissingTags) {\n      const keys = Object.keys(rules);\n      for (const key of keys) {\n        const rule = rules[key];\n        if (rule.action === 'replace' &&\n          typeof rule.value !== 'undefined' &&\n          rule.value !== null) {\n          // check if key really exists\n          let isKey = false;\n          if (key.length === 8) {\n            const tag = getTagFromKey(key);\n            isKey = typeof tag.getNameFromDictionary() !== 'undefined';\n          }\n          // get tag key, rules can use key or tag name\n          let tagKey;\n          if (isKey) {\n            tagKey = key;\n          } else {\n            // try tag name\n            const tag = getTagFromDictionary(key);\n            if (typeof tag !== 'undefined') {\n              tagKey = tag.getKey();\n            }\n          }\n          // add to list\n          if (typeof tagKey !== 'undefined') {\n            this.#compulsoryTags.push(tagKey);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Encode string data.\n   *\n   * @param {string} str The string to encode.\n   * @returns {Uint8Array} The encoded string.\n   */\n  #encodeString(str) {\n    return this.#defaultTextEncoder.encode(str);\n  }\n\n  /**\n   * Encode data as a UTF-8.\n   *\n   * @param {string} str The string to write.\n   * @returns {Uint8Array} The encoded string.\n   */\n  #encodeSpecialString(str) {\n    return this.#textEncoder.encode(str);\n  }\n\n  /**\n   * Use a TextEncoder instead of the default text decoder.\n   */\n  useSpecialTextEncoder() {\n    /**\n     * The text encoder.\n     *\n     * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder}.\n     *\n     * @external TextEncoder\n     */\n    this.#textEncoder = new TextEncoder();\n  }\n\n  /**\n   * Get the element to write according to the class rules.\n   * Priority order: tagName, groupName, default.\n   *\n   * @param {DataElement} element The element to check.\n   * @returns {DataElement|null} The element to write, can be null.\n   */\n  getElementToWrite(element) {\n    // get group and tag string name\n    const groupName = element.tag.getGroupName();\n    const tagName = element.tag.getNameFromDictionary();\n\n    // apply rules:\n    let rule;\n    if (typeof this.#rules[element.tag.getKey()] !== 'undefined') {\n      // 1. tag itself\n      rule = this.#rules[element.tag.getKey()];\n    } else if (typeof tagName !== 'undefined' &&\n      typeof this.#rules[tagName] !== 'undefined') {\n      // 2. tag name\n      rule = this.#rules[tagName];\n    } else if (typeof this.#rules[groupName] !== 'undefined') {\n      // 3. group name\n      rule = this.#rules[groupName];\n    } else {\n      // 4. default\n      rule = this.#rules['default'];\n    }\n    // apply action on element and return\n    return writerActions[rule.action](element, rule.value);\n  }\n\n  /**\n   * Write a list of items.\n   *\n   * @param {DataWriter} writer The raw data writer.\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} items The list of items to write.\n   * @param {boolean} isImplicit Is the DICOM VR implicit?\n   * @param {number} [bitsAllocated] Bits allocated used for pixel data.\n   * @returns {number} The new offset position.\n   */\n  #writeDataElementItems(\n    writer, byteOffset, items, isImplicit, bitsAllocated) {\n\n    const isItemTagWithNoVR = function (item) {\n      return isItemTag(item.tag) && item.vr === 'NONE';\n    };\n\n    for (const item of items) {\n      if (item.length === 0) {\n        continue;\n      }\n      // item element (create new to not modify original)\n      let undefinedLength = false;\n      const itemTag = item.find((subItem) => isItemTagWithNoVR(subItem));\n      if (typeof itemTag !== 'undefined' &&\n        typeof itemTag.undefinedLength !== 'undefined') {\n        undefinedLength = itemTag.undefinedLength;\n      }\n      const itemElement = new DataElement('NONE');\n      itemElement.vl = undefinedLength ? 0xffffffff : itemTag.vl,\n      itemElement.tag = getItemTag();\n      itemElement.value = [];\n      byteOffset = this.#writeDataElement(\n        writer, itemElement, byteOffset, isImplicit);\n      // write rest\n      for (const subItem of item) {\n        if (!isItemTagWithNoVR(subItem) &&\n          !isItemDelimitationItemTag(subItem.tag)) {\n          byteOffset = this.#writeDataElement(\n            writer, subItem, byteOffset, isImplicit, bitsAllocated);\n        }\n      }\n      // item delimitation\n      if (undefinedLength) {\n        const itemDelimElement = new DataElement('NONE');\n        itemDelimElement.vl = 0;\n        itemDelimElement.tag = getItemDelimitationItemTag();\n        itemDelimElement.value = [];\n        byteOffset = this.#writeDataElement(\n          writer, itemDelimElement, byteOffset, isImplicit);\n      }\n    }\n\n    // return new offset\n    return byteOffset;\n  }\n\n  /**\n   * Write data with a specific Value Representation (VR).\n   *\n   * @param {DataWriter} writer The raw data writer.\n   * @param {DataElement} element The element to write.\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array|Uint8Array} value The array to write.\n   * @param {boolean} isImplicit Is the DICOM VR implicit?\n   * @param {number} [bitsAllocated] Bits allocated used for pixel data.\n   * @returns {number} The new offset position.\n   */\n  #writeDataElementValue(\n    writer, element, byteOffset, value, isImplicit, bitsAllocated) {\n\n    const startOffset = byteOffset;\n\n    if (element.vr === 'NONE') {\n      // nothing to do!\n    } else if (value instanceof Uint8Array) {\n      // binary data\n      if (typeof bitsAllocated !== 'undefined' && bitsAllocated === 1) {\n        // padd if length is not a multiple of 8\n        if (value.length % 8 !== 0) {\n          logger.debug('Padding binary pixel data');\n          const newSize = Math.ceil(value.length / 8) * 8;\n          const padd = new Array(newSize - value.length);\n          padd.fill(0);\n          value = uint8ArrayPush(value, padd);\n        }\n        byteOffset = writer.writeBinaryArray(byteOffset, value);\n      } else {\n        byteOffset = writer.writeUint8Array(byteOffset, value);\n      }\n    } else if (value instanceof Int8Array) {\n      byteOffset = writer.writeInt8Array(byteOffset, value);\n    } else if (value instanceof Uint16Array) {\n      byteOffset = writer.writeUint16Array(byteOffset, value);\n    } else if (value instanceof Int16Array) {\n      byteOffset = writer.writeInt16Array(byteOffset, value);\n    } else if (value instanceof Uint32Array) {\n      byteOffset = writer.writeUint32Array(byteOffset, value);\n    } else if (value instanceof Int32Array) {\n      byteOffset = writer.writeInt32Array(byteOffset, value);\n    } else if (value instanceof BigUint64Array) {\n      byteOffset = writer.writeUint64Array(byteOffset, value);\n    } else if (value instanceof BigInt64Array) {\n      byteOffset = writer.writeInt64Array(byteOffset, value);\n    } else {\n      // switch according to VR if input type is undefined\n      const vrType = vrTypes[element.vr];\n      if (typeof vrType !== 'undefined') {\n        if (vrType === 'Uint8') {\n          byteOffset = writer.writeUint8Array(byteOffset, value);\n        } else if (vrType === 'Uint16') {\n          byteOffset = writer.writeUint16Array(byteOffset, value);\n        } else if (vrType === 'Int16') {\n          byteOffset = writer.writeInt16Array(byteOffset, value);\n        } else if (vrType === 'Uint32') {\n          byteOffset = writer.writeUint32Array(byteOffset, value);\n        } else if (vrType === 'Int32') {\n          byteOffset = writer.writeInt32Array(byteOffset, value);\n        } else if (vrType === 'Uint64') {\n          byteOffset = writer.writeUint64Array(byteOffset, value);\n        } else if (vrType === 'Int64') {\n          byteOffset = writer.writeInt64Array(byteOffset, value);\n        } else if (vrType === 'Float32') {\n          byteOffset = writer.writeFloat32Array(byteOffset, value);\n        } else if (vrType === 'Float64') {\n          byteOffset = writer.writeFloat64Array(byteOffset, value);\n        } else if (vrType === 'string') {\n          byteOffset = writer.writeUint8Array(byteOffset, value);\n        } else {\n          throw new Error('Unknown VR type: ' + vrType);\n        }\n      } else if (element.vr === 'SQ') {\n        byteOffset = this.#writeDataElementItems(\n          writer, byteOffset, value, isImplicit);\n      } else if (element.vr === 'AT') {\n        for (const valueItem of value) {\n          const hexString = valueItem + '';\n          const hexString1 = hexString.substring(1, 5);\n          const hexString2 = hexString.substring(6, 10);\n          const dec1 = parseInt(hexString1, 16);\n          const dec2 = parseInt(hexString2, 16);\n          const atValue = [dec1, dec2];\n          byteOffset = writer.writeUint16Array(byteOffset, atValue);\n        }\n      } else if (element.vr === 'xs') {\n        // TODO would be better to use pixelRepresentation in if\n        if (value instanceof Int16Array) {\n          byteOffset = writer.writeInt16Array(byteOffset, value);\n        } else {\n          byteOffset = writer.writeUint16Array(byteOffset, value);\n        }\n      } else {\n        logger.warn('Unknown VR: ' + element.vr);\n      }\n    }\n\n    if (element.vr !== 'SQ' && element.vr !== 'NONE') {\n      const diff = byteOffset - startOffset;\n      if (diff !== element.vl) {\n        let message = 'Offset difference and VL are not equal: ' +\n          diff + ' != ' + element.vl;\n        message += ' (';\n        if (typeof element.tag !== 'undefined') {\n          message += element.tag + ', ';\n        }\n        message += 'vr:' + element.vr + ')';\n        logger.warn(message);\n      }\n    }\n\n    // return new offset\n    return byteOffset;\n  }\n\n  /**\n   * Write a pixel data element.\n   *\n   * @param {DataWriter} writer The raw data writer.\n   * @param {DataElement} element The element to write.\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {Array} value The array to write.\n   * @param {boolean} isImplicit Is the DICOM VR implicit?\n   * @param {number} [bitsAllocated] Bits allocated used for pixel data.\n   * @returns {number} The new offset position.\n   */\n  #writePixelDataElementValue(\n    writer, element, byteOffset, value, isImplicit, bitsAllocated) {\n    // undefined length flag\n    let undefinedLength = false;\n    if (typeof element.undefinedLength !== 'undefined') {\n      undefinedLength = element.undefinedLength;\n    }\n    // explicit length\n    if (!undefinedLength) {\n      let finalValue = value[0];\n      // flatten multi frame\n      if (value.length > 1) {\n        finalValue = flattenArrayOfTypedArrays(value);\n      }\n      // write\n      byteOffset = this.#writeDataElementValue(\n        writer, element, byteOffset, finalValue, isImplicit, bitsAllocated);\n    } else {\n      // pixel data as sequence\n      const sqItem = [];\n      // first item: basic offset table\n      sqItem.push({\n        tag: getItemTag(),\n        vr: 'NONE',\n        vl: 0,\n        value: []\n      });\n      // data\n      for (const valueItem of value) {\n        sqItem.push({\n          tag: getItemTag(),\n          vr: element.vr,\n          vl: valueItem.length,\n          value: valueItem\n        });\n      }\n      // write\n      byteOffset = this.#writeDataElementItems(\n        writer, byteOffset, [sqItem], isImplicit, bitsAllocated);\n    }\n\n    // return new offset\n    return byteOffset;\n  }\n\n  /**\n   * Write a data element.\n   *\n   * @param {DataWriter} writer The raw data writer.\n   * @param {DataElement} element The DICOM data element to write.\n   * @param {number} byteOffset The offset to start writing from.\n   * @param {boolean} isImplicit Is the DICOM VR implicit?\n   * @param {number} [bitsAllocated] Bits allocated used for pixel data.\n   * @returns {number} The new offset position.\n   */\n  #writeDataElement(\n    writer, element, byteOffset, isImplicit, bitsAllocated) {\n    const isTagWithVR = element.tag.isWithVR();\n    const is32bitVL = (isImplicit || !isTagWithVR)\n      ? true : is32bitVLVR(element.vr);\n    // group\n    byteOffset = writer.writeHex(byteOffset, element.tag.getGroup());\n    // element\n    byteOffset = writer.writeHex(byteOffset, element.tag.getElement());\n    // VR\n    let vr = element.vr;\n    // use VR=UN for private sequence\n    if (this.#useUnVrForPrivateSq &&\n      element.tag.isPrivate() &&\n      vr === 'SQ') {\n      logger.warn('Write element using VR=UN for private sequence.');\n      vr = 'UN';\n    }\n    if (isTagWithVR && !isImplicit) {\n      byteOffset = writer.writeUint8Array(byteOffset, this.#encodeString(vr));\n      // reserved 2 bytes for 32bit VL\n      if (is32bitVL) {\n        byteOffset += 2;\n      }\n    }\n\n    let undefinedLengthSequence = false;\n    if (element.vr === 'SQ' ||\n      isAnyPixelDataTag(element.tag)) {\n      if (typeof element.undefinedLength !== 'undefined') {\n        undefinedLengthSequence = element.undefinedLength;\n      }\n    }\n    let undefinedLengthItem = false;\n    if (isItemTag(element.tag)) {\n      if (typeof element.undefinedLength !== 'undefined') {\n        undefinedLengthItem = element.undefinedLength;\n      }\n    }\n\n    // update vl for sequence or item with undefined length\n    let vl = element.vl;\n    if (undefinedLengthSequence || undefinedLengthItem) {\n      vl = 0xffffffff;\n    }\n    // VL\n    if (is32bitVL) {\n      byteOffset = writer.writeUint32(byteOffset, vl);\n    } else {\n      byteOffset = writer.writeUint16(byteOffset, vl);\n    }\n\n    // value\n    let value = element.value;\n    // check value\n    if (typeof value === 'undefined') {\n      value = [];\n    }\n    // write\n    if (isAnyPixelDataTag(element.tag)) {\n      byteOffset = this.#writePixelDataElementValue(\n        writer, element, byteOffset, value, isImplicit, bitsAllocated);\n    } else {\n      byteOffset = this.#writeDataElementValue(\n        writer, element, byteOffset, value, isImplicit);\n    }\n\n    // sequence delimitation item for sequence with undefined length\n    if (undefinedLengthSequence) {\n      const seqDelimElement = new DataElement('NONE');\n      seqDelimElement.vl = 0;\n      seqDelimElement.tag = getSequenceDelimitationItemTag();\n      seqDelimElement.value = [];\n      byteOffset = this.#writeDataElement(\n        writer, seqDelimElement, byteOffset, isImplicit);\n    }\n\n    // return new offset\n    return byteOffset;\n  }\n\n  /**\n   * Get the ArrayBuffer corresponding to input DICOM elements.\n   *\n   * @param {Object<string, DataElement>} dataElements The elements to write.\n   * @returns {ArrayBuffer} The elements as a buffer.\n   */\n  getBuffer(dataElements) {\n    // Transfer Syntax\n    const syntax = dataElements[TagKeys.TransferSyntax].value[0];\n    const isImplicit = isImplicitTransferSyntax(syntax);\n    const isBigEndian = isBigEndianTransferSyntax(syntax);\n    // Specific CharacterSet\n    if (typeof dataElements[TagKeys.SpecificCharacterSet] !== 'undefined') {\n      const oldscs = dataElements[TagKeys.SpecificCharacterSet].value[0];\n      // force UTF-8 if not default character set\n      if (typeof oldscs !== 'undefined' && oldscs !== 'ISO-IR 6') {\n        logger.debug('Change charset to UTF, was: ' + oldscs);\n        this.useSpecialTextEncoder();\n        dataElements[TagKeys.SpecificCharacterSet].value = ['ISO_IR 192'];\n      }\n    }\n    // Bits Allocated (for image data)\n    let bitsAllocated;\n    if (typeof dataElements[TagKeys.BitsAllocated] !== 'undefined') {\n      bitsAllocated = dataElements[TagKeys.BitsAllocated].value[0];\n    }\n\n    // calculate buffer size and split elements (meta and non meta)\n    let totalSize = 128 + 4; // DICM\n    let localSize = 0;\n    const metaElements = [];\n    const rawElements = [];\n    let element;\n    let groupName;\n    let metaLength = 0;\n    // FileMetaInformationGroupLength\n    const fmiglTag = getFileMetaInformationGroupLengthTag();\n    // FileMetaInformationVersion\n    const fmivTag = new Tag('0002', '0001');\n    // ImplementationClassUID\n    const icUIDTag = new Tag('0002', '0012');\n    // ImplementationVersionName\n    const ivnTag = new Tag('0002', '0013');\n\n    // missing tag list: start as a copy of compulsory\n    const missingTags = this.#compulsoryTags.slice();\n\n    // loop through elements to get the buffer size\n    const keys = Object.keys(dataElements);\n    for (const key of keys) {\n      const originalElement = dataElements[key];\n      originalElement.tag = getTagFromKey(key);\n      element = this.getElementToWrite(originalElement);\n      if (element !== null &&\n        !fmiglTag.equals(element.tag) &&\n        !fmivTag.equals(element.tag) &&\n        !icUIDTag.equals(element.tag) &&\n        !ivnTag.equals(element.tag)) {\n        localSize = 0;\n\n        // check if compulsory tag, if present remove from missing list\n        const index = missingTags.indexOf(element.tag.getKey());\n        if (index !== -1) {\n          missingTags.splice(index, 1);\n        }\n\n        // XB7 2020-04-17\n        // Check if UN can be converted to correct VR.\n        // This check must be done BEFORE calculating totalSize,\n        // otherwise there may be extra null bytes at the end of the file\n        // (dcmdump may crash because of these bytes)\n        if (this.#fixUnknownVR) {\n          checkAndFixUnknownVR(element, !isBigEndian);\n        }\n\n        // update value and vl\n        this.#setElementValue(\n          element, element.value, isImplicit, bitsAllocated);\n\n        // tag group name\n        groupName = element.tag.getGroupName();\n\n        // prefix\n        if (groupName === 'Meta Element') {\n          localSize += getDataElementPrefixByteSize(element.vr, false);\n        } else {\n          localSize += getDataElementPrefixByteSize(\n            element.vr, isImplicit);\n        }\n\n        // value\n        localSize += element.vl;\n\n        // sort elements\n        if (groupName === 'Meta Element') {\n          metaElements.push(element);\n          metaLength += localSize;\n        } else {\n          rawElements.push(element);\n        }\n\n        // add to total size\n        totalSize += localSize;\n      }\n    }\n\n    // add compulsory tags to output data if not present\n    for (const key of missingTags) {\n      const tag = getTagFromKey(key);\n      const dataElement = new DataElement(tag.getVrFromDictionary());\n      dataElement.tag = tag;\n      // rules are indexed by key or tag name\n      let value;\n      if (typeof this.#rules[key] !== 'undefined') {\n        value = this.#rules[key].value;\n      } else {\n        const name = tag.getNameFromDictionary();\n        value = this.#rules[name].value;\n      }\n      // add element\n      let size = getDataElementPrefixByteSize(dataElement.vr, isImplicit);\n      size += this.#setElementValue(dataElement, [value], isImplicit);\n      rawElements.push(dataElement);\n      totalSize += size;\n    }\n\n    // FileMetaInformationVersion\n    const fmiv = getDataElement('FileMetaInformationVersion');\n    let fmivSize = getDataElementPrefixByteSize(fmiv.vr, false);\n    fmivSize += this.#setElementValue(fmiv, [0, 1], false);\n    metaElements.push(fmiv);\n    metaLength += fmivSize;\n    totalSize += fmivSize;\n    // ImplementationClassUID\n    const icUID = getDataElement('ImplementationClassUID');\n    let icUIDSize = getDataElementPrefixByteSize(icUID.vr, false);\n    const icUIDValue = getImplementationClassUID();\n    icUIDSize += this.#setElementValue(icUID, [icUIDValue], false);\n    metaElements.push(icUID);\n    metaLength += icUIDSize;\n    totalSize += icUIDSize;\n    // ImplementationVersionName\n    const ivn = getDataElement('ImplementationVersionName');\n    let ivnSize = getDataElementPrefixByteSize(ivn.vr, false);\n    const ivnValue = getImplementationVersionName();\n    ivnSize += this.#setElementValue(ivn, [ivnValue], false);\n    metaElements.push(ivn);\n    metaLength += ivnSize;\n    totalSize += ivnSize;\n\n    // sort elements\n    const elemSortFunc = function (a, b) {\n      return tagCompareFunction(a.tag, b.tag);\n    };\n    metaElements.sort(elemSortFunc);\n    rawElements.sort(elemSortFunc);\n\n    // create the FileMetaInformationGroupLength element\n    const fmigl = getDataElement('FileMetaInformationGroupLength');\n    let fmiglSize = getDataElementPrefixByteSize(fmigl.vr, false);\n    fmiglSize += this.#setElementValue(\n      fmigl, new Uint32Array([metaLength]), false);\n    totalSize += fmiglSize;\n\n    // create buffer\n    const buffer = new ArrayBuffer(totalSize);\n    const metaWriter = new DataWriter(buffer);\n    const dataWriter = new DataWriter(buffer, !isBigEndian);\n\n    let offset = 128;\n    // DICM\n    offset = metaWriter.writeUint8Array(offset, this.#encodeString('DICM'));\n    // FileMetaInformationGroupLength\n    offset = this.#writeDataElement(metaWriter, fmigl, offset, false);\n    // write meta\n    for (const metaElement of metaElements) {\n      offset = this.#writeDataElement(\n        metaWriter, metaElement, offset, false);\n    }\n\n    // check meta position\n    const preambleSize = 128 + 4;\n    const metaOffset = preambleSize + fmiglSize + metaLength;\n    if (offset !== metaOffset) {\n      logger.warn('Bad size calculation... meta offset: ' + offset +\n        ', calculated size:' + metaOffset +\n        ' (diff:' + (offset - metaOffset) + ')');\n    }\n\n    // write non meta\n    for (const rawElement of rawElements) {\n      offset = this.#writeDataElement(\n        dataWriter, rawElement, offset, isImplicit, bitsAllocated);\n    }\n\n    // check final position\n    if (offset !== totalSize) {\n      logger.warn('Bad size calculation... final offset: ' + offset +\n        ', calculated size:' + totalSize +\n        ' (diff:' + (offset - totalSize) + ')');\n    }\n    // return\n    return buffer;\n  }\n\n  /**\n   * Set a DICOM element value according to its VR (Value Representation).\n   *\n   * @param {DataElement} element The DICOM element to set the value.\n   * @param {object} value The value to set.\n   * @param {boolean} isImplicit Does the data use implicit VR?\n   * @param {number} [bitsAllocated] Bits allocated used for pixel data.\n   * @returns {number} The total element size.\n   */\n  #setElementValue(\n    element, value, isImplicit, bitsAllocated) {\n    // byte size of the element\n    let size = 0;\n    // special sequence case\n    if (element.vr === 'SQ') {\n\n      if (value !== null && value !== 0) {\n        const newItems = [];\n\n        // explicit or undefined length sequence\n        let undefinedLength = false;\n        if (typeof element.undefinedLength !== 'undefined') {\n          undefinedLength = element.undefinedLength;\n          delete element.undefinedLength;\n        }\n\n        // items\n        for (const valueItem of value) {\n          const oldItemElements = valueItem;\n          const newItemElements = [];\n          let subSize = 0;\n\n          // check data\n          if (oldItemElements === null || oldItemElements === 0) {\n            continue;\n          }\n\n          // possible local bitsAllocated\n          let sqBitsAllocated = bitsAllocated;\n          const dataElement = oldItemElements[TagKeys.BitsAllocated];\n          if (typeof dataElement !== 'undefined' &&\n            typeof dataElement.value !== 'undefined') {\n            sqBitsAllocated = dataElement.value[0];\n          }\n\n          // elements\n          const itemKeys = Object.keys(oldItemElements);\n          for (const itemKey of itemKeys) {\n            const subElement = oldItemElements[itemKey];\n            subElement.tag = getTagFromKey(itemKey);\n\n            if (isItemTag(subElement.tag)) {\n              continue;\n            }\n            // set item value\n            subSize += this.#setElementValue(\n              subElement, subElement.value, isImplicit, sqBitsAllocated);\n            newItemElements.push(subElement);\n            // add prefix size\n            subSize += getDataElementPrefixByteSize(\n              subElement.vr, isImplicit);\n          }\n\n          // add item element (used to store its size)\n          const itemElement = {\n            tag: getItemTag(),\n            vr: 'NONE',\n            vl: subSize,\n            value: []\n          };\n          if (undefinedLength) {\n            itemElement.undefinedLength = undefinedLength;\n          }\n          newItemElements.push(itemElement);\n          subSize += getDataElementPrefixByteSize(\n            itemElement.vr, isImplicit);\n\n          // add item delimitation size\n          if (undefinedLength) {\n            subSize += getDataElementPrefixByteSize(\n              'NONE', isImplicit);\n          }\n\n          // sort\n          const elemSortFunc = function (a, b) {\n            return tagCompareFunction(a.tag, b.tag);\n          };\n          newItemElements.sort(elemSortFunc);\n\n          size += subSize;\n          newItems.push(newItemElements);\n        }\n\n        // add sequence delimitation size\n        if (undefinedLength) {\n          size += getDataElementPrefixByteSize('NONE', isImplicit);\n        }\n\n        // update sequence element\n        element.value = newItems;\n        element.vl = size;\n        if (undefinedLength) {\n          element.undefinedLength = undefinedLength;\n        }\n      }\n    } else {\n      // pad if necessary\n      if (isVrToPad(element.vr)) {\n        const padStr = getVrPad(element.vr);\n        // encode string\n        // TODO: not sure for UN...\n        if (isStringVr(element.vr)) {\n          let pad;\n          if (isCharSetStringVR(element.vr)) {\n            value = this.#encodeSpecialString(value.join('\\\\'));\n            pad = this.#encodeSpecialString(padStr);\n          } else {\n            value = this.#encodeString(value.join('\\\\'));\n            pad = this.#encodeString(padStr);\n          }\n          if (!isEven(value.length)) {\n            value = uint8ArrayPush(value, pad);\n          }\n        } else if (element.vr === 'OB') {\n          value = padOBValue(value);\n        }\n      }\n\n      // calculate byte size\n      size = 0;\n      if (element.vr === 'AT') {\n        size = 4 * value.length;\n      } else if (element.vr === 'xs') {\n        size = value.length * Uint16Array.BYTES_PER_ELEMENT;\n      } else if (isTypedArrayVr(element.vr) || element.vr === 'ox') {\n        if (isAnyPixelDataTag(element.tag) &&\n          Array.isArray(value)) {\n          size = 0;\n          for (const valueItem of value) {\n            size += valueItem.length;\n          }\n        } else {\n          size = value.length;\n        }\n\n        // convert size to bytes\n        const vrType = vrTypes[element.vr];\n        if (isAnyPixelDataTag(element.tag) || element.vr === 'ox') {\n          if (element.undefinedLength) {\n            const itemPrefixSize =\n              getDataElementPrefixByteSize('NONE', isImplicit);\n            // offset table\n            size += itemPrefixSize;\n            // pixel items\n            size += itemPrefixSize * value.length;\n            // add sequence delimitation size\n            size += itemPrefixSize;\n          } else {\n            // use bitsAllocated for pixel data\n            // no need to multiply for 8 bits\n            if (typeof bitsAllocated !== 'undefined') {\n              if (bitsAllocated === 1) {\n                // binary data\n                // (ceil to get integer)\n                size = Math.ceil(size / 8);\n              } else if (bitsAllocated === 16) {\n                size *= Uint16Array.BYTES_PER_ELEMENT;\n              }\n            }\n          }\n        } else if (typeof vrType !== 'undefined') {\n          const bpe = getBpeForVrType(vrType);\n          if (typeof bpe !== 'undefined') {\n            size *= bpe;\n          } else {\n            throw new Error('Unknown bytes per element for VR type: ' + vrType);\n          }\n        } else {\n          throw new Error('Unsupported element: ' + element.vr);\n        }\n      } else {\n        size = value.length;\n      }\n\n      element.value = value;\n      element.vl = size;\n    }\n\n    // return the size of that data\n    return size;\n  }\n\n} // class DicomWriter\n\n/**\n * Fix for broken DICOM elements: replace \"UN\" with correct VR if the\n * element exists in dictionary.\n *\n * @param {DataElement} element The DICOM element.\n * @param {boolean} [isLittleEndian] Flag to tell if the data is little\n *   or big endian (default: true).\n */\nfunction checkAndFixUnknownVR(element, isLittleEndian) {\n  if (element.vr === 'UN') {\n    const dictVr = element.tag.getVrFromDictionary();\n    if (typeof dictVr !== 'undefined' && element.vr !== dictVr) {\n      element.vr = dictVr;\n      // cast typed array value from Uint8 to vr type\n      const vrType = vrTypes[element.vr];\n      if (typeof vrType !== 'undefined' &&\n        vrType !== 'Uint8' &&\n        vrType !== 'string') {\n        const data = getUint8ToVrValue(\n          element.value, element.vr, isLittleEndian);\n        if (typeof data !== 'undefined') {\n          element.value = data;\n        }\n      }\n      logger.info('Element ' + element.tag.getGroup() +\n        ' ' + element.tag.getElement() +\n        ' VR changed from UN to ' + element.vr);\n    }\n  }\n}\n\n/**\n * Get the casted typed array value from Uint8 to vr type.\n *\n * @param {object} value The value to cast.\n * @param {string} vr The DICOM element VR.\n * @param {boolean} [isLittleEndian] Flag to tell if the data is little\n *   or big endian (default: true).\n * @returns {object} The element value casted to the vr type.\n */\nfunction getUint8ToVrValue(value, vr, isLittleEndian) {\n  let data;\n  if (typeof value.buffer === 'undefined') {\n    return data;\n  }\n  const reader = new DataReader(value.buffer, isLittleEndian);\n  const offset = value.byteOffset;\n  const vl = value.length; // size before cast\n  const vrType = vrTypes[vr];\n  if (vrType === 'Uint16') {\n    data = reader.readUint16Array(offset, vl);\n  } else if (vrType === 'Uint32') {\n    data = reader.readUint32Array(offset, vl);\n  } else if (vrType === 'Uint64') {\n    data = reader.readUint64Array(offset, vl);\n  } else if (vrType === 'Int16') {\n    data = Array.from(reader.readInt16Array(offset, vl));\n  } else if (vrType === 'Int32') {\n    data = Array.from(reader.readInt32Array(offset, vl));\n  } else if (vrType === 'Int64') {\n    data = reader.readInt64Array(offset, vl);\n  } else if (vrType === 'Float32') {\n    data = Array.from(reader.readFloat32Array(offset, vl));\n  } else if (vrType === 'Float64') {\n    data = Array.from(reader.readFloat64Array(offset, vl));\n  }\n  return data;\n}\n\n/**\n * Get a DICOM element from its tag name (value set separatly).\n *\n * @param {string} tagName The string tag name.\n * @returns {DataElement} The DICOM element.\n */\nfunction getDataElement(tagName) {\n  const tag = getTagFromDictionary(tagName);\n  const element = new DataElement(tag.getVrFromDictionary());\n  element.tag = tag;\n  return element;\n}\n\n/**\n * Get the number of bytes per element for a given VR type.\n *\n * @param {string} vrType The VR type as defined in the dictionary.\n * @returns {number} The bytes per element.\n */\nfunction getBpeForVrType(vrType) {\n  let bpe;\n  if (vrType === 'Uint8') {\n    bpe = Uint8Array.BYTES_PER_ELEMENT;\n  } else if (vrType === 'Uint16') {\n    bpe = Uint16Array.BYTES_PER_ELEMENT;\n  } else if (vrType === 'Int16') {\n    bpe = Int16Array.BYTES_PER_ELEMENT;\n  } else if (vrType === 'Uint32') {\n    bpe = Uint32Array.BYTES_PER_ELEMENT;\n  } else if (vrType === 'Int32') {\n    bpe = Int32Array.BYTES_PER_ELEMENT;\n  } else if (vrType === 'Float32') {\n    bpe = Float32Array.BYTES_PER_ELEMENT;\n  } else if (vrType === 'Float64') {\n    bpe = Float64Array.BYTES_PER_ELEMENT;\n  } else if (vrType === 'Uint64') {\n    bpe = BigUint64Array.BYTES_PER_ELEMENT;\n  } else if (vrType === 'Int64') {\n    bpe = BigInt64Array.BYTES_PER_ELEMENT;\n  }\n  return bpe;\n}\n\n/**\n * Get the DICOM elements from a 'simple' DICOM tags object.\n * The input object is a simplified version of the oficial DICOM json with\n * tag names instead of keys and direct values (no value property) for\n * simple tags. See synthetic test data (in tests/dicom) for examples.\n *\n * @param {Object<string, any>} simpleTags The 'simple' DICOM\n *   tags object.\n * @returns {Object<string, DataElement>} The DICOM elements.\n */\nexport function getElementsFromJSONTags(simpleTags) {\n  const keys = Object.keys(simpleTags);\n  const dataElements = {};\n  for (const key of keys) {\n    // get the DICOM element definition from its name\n    const tag = getTagFromDictionary(key);\n    if (typeof tag === 'undefined') {\n      continue;\n    }\n    const vr = tag.getVrFromDictionary();\n    // tag value\n    let value;\n    let undefinedLength = false;\n    const simpleTag = simpleTags[key];\n    if (vr === 'SQ') {\n      const items = [];\n      if (typeof simpleTag.undefinedLength !== 'undefined') {\n        undefinedLength = simpleTag.undefinedLength;\n      }\n      if (Array.isArray(simpleTag.value)) {\n        for (const item of simpleTag.value) {\n          items.push(getElementsFromJSONTags(item));\n        }\n      } else {\n        logger.debug('Non array simpleTag SQ value');\n      }\n      value = items;\n    } else {\n      if (Array.isArray(simpleTag)) {\n        value = simpleTag;\n      } else {\n        value = [simpleTag];\n      }\n    }\n    // create element\n    const dataElement = new DataElement(vr);\n    dataElement.tag = tag;\n    dataElement.value = value;\n    if (undefinedLength) {\n      dataElement.undefinedLength = undefinedLength;\n    }\n    // store\n    dataElements[tag.getKey()] = dataElement;\n  }\n  // return\n  // @ts-expect-error\n  return dataElements;\n}\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * DICOM code tag keys.\n */\nconst TagKeys = {\n  CodeValue: '00080100',\n  CodingSchemeDesignator: '00080102',\n  CodeMeaning: '00080104',\n  LongCodeValue: '00080119',\n  URNCodeValue: '00080120'\n};\n\n/**\n * DICOM code: item of a basic code sequence.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_8.8.html}.\n */\nexport class DicomCode {\n  /**\n   * Code meaning.\n   *\n   * @type {string}\n   */\n  meaning;\n  /**\n   * Code value.\n   *\n   * @type {string|undefined}\n   */\n  value;\n  /**\n   * Long code value.\n   *\n   * @type {string|undefined}\n   */\n  longValue;\n  /**\n   * URN code value.\n   *\n   * @type {string|undefined}\n   */\n  urnValue;\n  /**\n   * Coding scheme designator.\n   *\n   * @type {string|undefined}\n   */\n  schemeDesignator;\n\n  /**\n   * @param {string} meaning The code meaning.\n   */\n  constructor(meaning) {\n    this.meaning = meaning;\n  }\n\n  /**\n   * Get a string representation of this object.\n   *\n   * @returns {string} The code as string.\n   */\n  toString() {\n    return '(' + this.value + ', ' +\n      this.schemeDesignator + ', \\'' +\n      this.meaning + '\\')';\n  }\n}\n\n/**\n * Check if two code objects are equal: just checks\n * schemeDesignator and value.\n *\n * @param {DicomCode} code1 The first code.\n * @param {DicomCode} code2 The second code.\n * @returns {boolean} True if both codes are equal.\n */\nexport function isEqualCode(code1, code2) {\n  return typeof code1 !== 'undefined' &&\n    typeof code2 !== 'undefined' &&\n    code1.schemeDesignator === code2.schemeDesignator &&\n    code1.value === code2.value;\n}\n\n/**\n * Get a code object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {DicomCode} A code object.\n */\nexport function getCode(dataElements) {\n  // meaning -> CodeMeaning (type1)\n  const code = new DicomCode(dataElements[TagKeys.CodeMeaning].value[0]);\n  // value -> CodeValue (type1C)\n  // longValue -> LongCodeValue (type1C)\n  // urnValue -> URNCodeValue (type1C)\n  if (typeof dataElements[TagKeys.CodeValue] !== 'undefined') {\n    code.value = dataElements[TagKeys.CodeValue].value[0];\n  } else if (typeof dataElements[TagKeys.LongCodeValue] !== 'undefined') {\n    code.longValue = dataElements[TagKeys.LongCodeValue].value[0];\n  } else if (typeof dataElements[TagKeys.URNCodeValue] !== 'undefined') {\n    code.urnValue = dataElements[TagKeys.URNCodeValue].value[0];\n  } else {\n    throw new Error(\n      'Invalid code with no value, no long value and no urn value.');\n  }\n  // schemeDesignator -> CodingSchemeDesignator (type1C)\n  if (typeof code.value !== 'undefined' ||\n    typeof code.longValue !== 'undefined') {\n    if (typeof dataElements[TagKeys.CodingSchemeDesignator] !== 'undefined') {\n      code.schemeDesignator =\n        dataElements[TagKeys.CodingSchemeDesignator].value[0];\n    } else {\n      throw new Error(\n        'No coding sheme designator when code value or long value is present');\n    }\n  }\n  return code;\n}\n\n/**\n * Get a simple dicom element item from a code object.\n *\n * @param {DicomCode} code The code object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomCodeItem(code) {\n  // dicom item (tags are in group/element order)\n  const item = {};\n  // value\n  if (typeof code.value !== 'undefined') {\n    item.CodeValue = code.value;\n  } else if (typeof code.longValue !== 'undefined') {\n    item.LongCodeValue = code.longValue;\n  } else if (typeof code.urnValue !== 'undefined') {\n    item.URNCodeValue = code.urnValue;\n  }\n  // CodingSchemeDesignator\n  if (typeof code.schemeDesignator !== 'undefined') {\n    item.CodingSchemeDesignator = code.schemeDesignator;\n  }\n  // CodeMeaning\n  item.CodeMeaning = code.meaning;\n  // return\n  return item;\n}\n\n/**\n * DICOM codes.\n * List: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part16/chapter_d.html}.\n */\nexport const DcmCodes = {\n  CADProcessingAndFindingsSummary: {\n    value: '111017', meaning: 'CAD Processing and Findings Summary'\n  },\n  ImageRegion: {\n    value: '111030', meaning: 'Image Region'\n  },\n  SingleImageFinding: {\n    value: '111059', meaning: 'Single Image Finding'\n  },\n  SelectedRegion: {\n    value: '111099', meaning: 'Selected region'\n  },\n  AllAlgorithmsSucceededWithFindings: {\n    value: '111242', meaning: 'All algorithms succeeded; with findings'\n  },\n  ChestCADReport: {\n    value: '112000', meaning: 'Chest CAD Report'\n  },\n  ResponseEvaluation: {\n    value: '112020', meaning: 'Response Evaluation'\n  },\n  ResponseEvaluationMethod: {\n    value: '112021', meaning: 'Response Evaluation Method'\n  },\n  RECIST: {\n    value: '112022', meaning: 'RECIST'\n  },\n  TrackingIdentifier: {\n    value: '112039', meaning: 'Tracking Identifier'\n  },\n  MeasurementOfResponse: {\n    value: '112051', meaning: 'Measurement of Response'\n  },\n  TrackingUniqueIdentifier: {\n    value: '112040', meaning: 'Tracking Unique Identifier'\n  },\n  CurrentResponse: {\n    value: '112048', meaning: 'Current Response'\n  },\n  PixelByPixelMaximum: {\n    value: '113048', meaning: 'Pixel by pixel Maximum'\n  },\n  PixelByPixelMean: {\n    value: '113049', meaning: 'Pixel by pixel mean'\n  },\n  PixelByPixelMinimum: {\n    value: '113051', meaning: 'Pixel by pixel Minimum'\n  },\n  StandardDeviation: {\n    value: '113061', meaning: 'Standard Deviation'\n  },\n  Segmentation: {\n    value: '113076', meaning: 'Segmentation'\n  },\n  Path: {\n    value: '121055', meaning: 'Path'\n  },\n  Comment: {\n    value: '121106', meaning: 'Comment'\n  },\n  Height: {\n    value: '121207', meaning: 'Height'\n  },\n  SourceImageForImageProcessingOperation: {\n    value: '121322', meaning: 'Source image for image processing operation'\n  },\n  SourceImage: {\n    value: '121324', meaning: 'Source Image'\n  },\n  ReferencePoints: {\n    value: '122438', meaning: 'Reference Points'\n  },\n  MeasurementGroup: {\n    value: '125007', meaning: 'Measurement Group'\n  },\n  ShortLabel: {\n    value: '125309', meaning: 'Short Label'\n  },\n  ImagingMeasurementReport: {\n    value: '126000', meaning: 'Imaging Measurement Report'\n  },\n  ImagingMeasurements: {\n    value: '126010', meaning: 'Imaging Measurements'\n  },\n  ReferenceGeometry: {\n    value: '128773', meaning: 'Reference Geometry'\n  }\n};\n\n/**\n * SNOMED-CT codes.\n * List: {@link https://browser.ihtsdotools.org}.\n */\nconst SctCodes = {\n  1483009: 'Angle',\n  42798000: 'Area',\n  103355008: 'Width',\n  103339001: 'Long axis',\n  103340004: 'Short axis',\n  131190003: 'Radius',\n  261665006: 'Unknown',\n  410668003: 'Length',\n  718499004: 'Color'\n};\n\n/**\n * UCUM codes.\n * Definition: {@link https://unitsofmeasure.org/ucum}.\n * List: {@link https://ucum.nlm.nih.gov/ucum-lhc/demo.html}.\n */\nconst UcumCodes = {\n  1: 'No units',\n  mm: 'Millimeter',\n  deg: 'Degree - plane angle',\n  cm2: 'Square centimeter',\n  'cm2/ml': 'Square centimeter per milliliter',\n  '/cm': 'Per centimeter',\n  'g/ml': 'Gram per milliliter',\n  'g/ml{SUVbw}': 'Standardized Uptake Value body weight',\n  'mg/ml': 'Milligram per milliliter',\n  'umol/ml': 'Micromole per milliliter',\n  'Bq/ml': 'Becquerels per milliliter',\n  'mg/min/ml': 'Milligrams per minute per milliliter',\n  'umol/min/ml': 'Micromole per minute per milliliter',\n  'ml/min/g': 'Milliliter per minute per gram',\n  'ml/g': 'Milliliter per gram',\n  'ml/min/ml': 'Milliliter per minute per milliliter',\n  'ml/ml': 'Milliliter per milliliter',\n  '%': 'Percentage',\n  '[hnsf\\'U]': 'Hounsfield unit',\n  '10*23/ml': 'Electron density',\n  '{counts}': 'Counts',\n  '{counts}/s': 'Counts per second',\n  '{propcounts}': 'Proportional to counts',\n  '{propcounts}/s': 'Proportional to counts per second',\n};\n\n/**\n * Get a DICOM code from a value and meaning.\n *\n * @param {object} code The code value as {value, meaning}.\n * @returns {DicomCode} The DICOM code.\n */\nexport function getDcmDicomCode(code) {\n  const dcmCode = new DicomCode(code.meaning);\n  dcmCode.schemeDesignator = 'DCM';\n  dcmCode.value = code.value;\n  return dcmCode;\n}\n\n/**\n * Get a DICOM code from a value (~id).\n *\n * @param {string} value The code value.\n * @param {string} scheme The scheme designator.\n * @returns {DicomCode|undefined} The DICOM code.\n */\nfunction getDicomCode(value, scheme) {\n  let meaning;\n  if (scheme === 'SCT') {\n    meaning = SctCodes[value];\n  } else if (scheme === 'UCUM') {\n    meaning = UcumCodes[value];\n  }\n  let code;\n  if (typeof meaning !== 'undefined') {\n    code = new DicomCode(meaning);\n    code.schemeDesignator = scheme;\n    code.value = value;\n  }\n  return code;\n}\n/**\n * Get a segmentation DICOM code.\n *\n * @returns {DicomCode} The code.\n */\nexport function getSegmentationCode() {\n  return getDcmDicomCode(DcmCodes.Segmentation);\n}\n\n/**\n * Get a colour DICOM code.\n *\n * @returns {DicomCode} The code.\n */\nexport function getColourCode() {\n  return getDicomCode('718499004', 'SCT');\n}\n\n/**\n * Quantification name to dictionary item.\n */\nconst QuantificationName2DictItem = {\n  angle: {key: '1483009', scheme: 'SCT'},\n  length: {key: '410668003', scheme: 'SCT'},\n  surface: {key: '42798000', scheme: 'SCT'},\n  height: {key: '121207', scheme: 'DCM'},\n  width: {key: '103355008', scheme: 'SCT'},\n  radius: {key: '131190003', scheme: 'SCT'},\n  a: {key: '103339001', scheme: 'SCT'},\n  b: {key: '103340004', scheme: 'SCT'},\n  min: {key: '113051', scheme: 'DCM'},\n  max: {key: '113048', scheme: 'DCM'},\n  mean: {key: '113049', scheme: 'DCM'},\n  stddev: {key: '113061', scheme: 'DCM'},\n  // median\n  // 25th percentile\n  // 75th percentile\n};\n\n/**\n * Get a concept name DICOM code.\n *\n * @param {string} name The measurment name as defined\n *   in a quantification object.\n * @returns {DicomCode|undefined} The code.\n */\nexport function getConceptNameCode(name) {\n  const item = QuantificationName2DictItem[name];\n  let code;\n  if (typeof item !== 'undefined') {\n    if (item.scheme === 'DCM') {\n      code = getDcmDicomCode({\n        meaning: name,\n        value: item.key\n      });\n    } else {\n      code = getDicomCode(item.key, item.scheme);\n    }\n  }\n  return code;\n}\n\n/**\n * Get the DICOM code for a quantification name.\n *\n * @param {DicomCode} code The Dicom code.\n * @returns {string|undefined} The quantification name.\n */\nexport function getQuantificationName(code) {\n  let name;\n  for (const propKey in QuantificationName2DictItem) {\n    const item = QuantificationName2DictItem[propKey];\n    if (item.scheme === code.schemeDesignator &&\n      item.key === code.value) {\n      name = propKey;\n      break;\n    }\n  }\n  return name;\n}\n\n/**\n * Quantification unit to UCUM key. Associated tags:\n * - Rescale type {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.11.html#sect_C.11.1.1.2},\n * - Units {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.8.9.html#sect_C.8.9.1.1.3}.\n * - SUV {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part16/sect_CID_85.html}.\n */\nconst QuantificationUnit2UcumKey = {\n  'unit.mm': 'mm',\n  'unit.cm2': 'cm2',\n  'unit.degree': 'deg',\n  // OD optical density\n  HU: '[hnsf\\'U]',\n  // US: '1', // duplicates 'NONE'\n  MGML: 'mg/ml',\n  // Z_EFF Effective Atomic Number (i.e., Effective-Z)\n  ED: '10*23/ml',\n  // EDW Electron density normalized\n  // HU_MOD Modified Hounsfield Unit\n  PCT: '%',\n  CNTS: '{counts}',\n  NONE: '1',\n  CM2: 'cm2',\n  CM2ML: 'cm2/ml',\n  PCNT: '%',\n  CPS: '{counts}/s',\n  BQML: 'Bq/ml',\n  MGMINML: 'mg/min/ml',\n  UMOLMINML: 'umol/min/ml',\n  MLMING: 'ml/min/g',\n  MLG: 'ml/g',\n  '1CM': '/cm',\n  UMOLML: 'umol/ml',\n  PROPCNTS: '{propcounts}',\n  PROPCPS: '{propcounts}/s',\n  MLMINML: 'ml/min/ml',\n  MLML: 'ml/ml',\n  GML: 'g/ml',\n  //STDDEV\n  SUV: 'g/ml{SUVbw}',\n};\n\n/**\n * Get a measurement units DICOM code.\n *\n * @param {string} name The unit name as defined in a quantification object.\n * @returns {DicomCode|undefined} The code.\n */\nexport function getMeasurementUnitsCode(name) {\n  const key = QuantificationUnit2UcumKey[name];\n  let code;\n  if (typeof key !== 'undefined') {\n    code = getDicomCode(key, 'UCUM');\n  } else if (typeof key === 'undefined') {\n    // no unit\n    code = getDicomCode('1', 'UCUM');\n  }\n  return code;\n}\n\n/**\n * Get a quantification unit name.\n *\n * @param {DicomCode} code The code to get the unit from.\n * @returns {string} The quantification unit.\n */\nexport function getQuantificationUnit(code) {\n  let unit;\n  for (const propKey in QuantificationUnit2UcumKey) {\n    const ucumKey = QuantificationUnit2UcumKey[propKey];\n    if (code.schemeDesignator === 'UCUM' &&\n      ucumKey === code.value) {\n      unit = propKey;\n      break;\n    }\n  }\n  return unit;\n}\n","import {\n  isEqualRgb,\n  cielabToSrgb,\n  uintLabToLab,\n  labToUintLab,\n  srgbToCielab\n} from '../utils/colour.js';\nimport {\n  getCode,\n  getDicomCodeItem\n} from './dicomCode.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {RGB} from '../utils/colour.js';\nimport {DataElement} from './dataElement.js';\nimport {DicomCode} from './dicomCode.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  SegmentNumber: '00620004',\n  SegmentLabel: '00620005',\n  SegmentAlgorithmType: '00620008',\n  SegmentAlgorithmName: '00620009',\n  RecommendedDisplayGrayscaleValue: '0062000C',\n  RecommendedDisplayCIELabValue: '0062000D',\n  SegmentedPropertyCategoryCodeSequence: '00620003',\n  SegmentedPropertyTypeCodeSequence: '0062000F',\n  TrackingID: '00620020',\n  TrackingUID: '00620021'\n};\n\n/**\n * Get a default RGB colour for a segment.\n *\n * @param {number} segmentNumber The segment number.\n * @returns {RGB} A colour.\n */\nfunction getDefaultColour(segmentNumber) {\n  // ITK snap colours\n  const colours = [\n    new RGB(0, 0, 0),\n    new RGB(255, 0, 0),\n    new RGB(0, 255, 0),\n    new RGB(0, 0, 255),\n    new RGB(255, 255, 0),\n    new RGB(0, 255, 255),\n    new RGB(255, 0, 255),\n    new RGB(255, 239, 213),\n    new RGB(0, 0, 205),\n    new RGB(205, 133, 63),\n    new RGB(210, 180, 140),\n    new RGB(102, 205, 170),\n    new RGB(0, 0, 128),\n    new RGB(0, 139, 139),\n    new RGB(46, 139, 87),\n    new RGB(255, 228, 225)\n  ];\n  let colour;\n  if (segmentNumber < colours.length) {\n    colour = colours[segmentNumber];\n  } else {\n    colour = new RGB(\n      Math.random() * 255,\n      Math.random() * 255,\n      Math.random() * 255\n    );\n  }\n  return colour;\n};\n\n/**\n * DICOM (mask) segment: item of a SegmentSequence (0062,0002).\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.8.20.4.html}.\n */\nexport class MaskSegment {\n  /**\n   * Segment number (0062,0004).\n   *\n   * @type {number}\n   */\n  number;\n  /**\n   * Segment label (0062,0005).\n   *\n   * @type {string}\n   */\n  label;\n  /**\n   * Segment algorithm type (0062,0008).\n   *\n   * @type {string}\n   */\n  algorithmType;\n  /**\n   * Segment algorithm name (0062,0009).\n   *\n   * @type {string|undefined}\n   */\n  algorithmName;\n  /**\n   * Segment display value as simple value.\n   *\n   * @type {number|undefined}\n   */\n  displayValue;\n  /**\n   * Segment display value as RGB colour ({r,g,b}).\n   *\n   * @type {RGB|undefined}\n   */\n  displayRGBValue;\n  /**\n   * Segment property code: specific property\n   * the segment represents (0062,000F).\n   *\n   * @type {DicomCode|undefined}\n   */\n  propertyTypeCode;\n  /**\n   * Segment property category code: general category\n   * of the property the segment represents (0062,0003).\n   *\n   * @type {DicomCode|undefined}\n   */\n  propertyCategoryCode;\n  /**\n   * Segment tracking UID (0062,0021).\n   *\n   * @type {string|undefined}\n   */\n  trackingUid;\n  /**\n   * Segment tracking id: text label for the UID (0062,0020).\n   *\n   * @type {string|undefined}\n   */\n  trackingId;\n\n  /**\n   * @param {number} number The segment number.\n   * @param {string} label The segment label.\n   * @param {string} algorithmType The segment number.\n   */\n  constructor(number, label, algorithmType) {\n    this.number = number;\n    this.label = label;\n    this.algorithmType = algorithmType;\n  }\n}\n\n/**\n * Get a segment object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {MaskSegment} A segment object.\n */\nexport function getSegment(dataElements) {\n  // number -> SegmentNumber (type1)\n  // label -> SegmentLabel (type1)\n  // algorithmType -> SegmentAlgorithmType (type1)\n  const segment = new MaskSegment(\n    dataElements[TagKeys.SegmentNumber].value[0],\n    dataElements[TagKeys.SegmentLabel]\n      ? dataElements[TagKeys.SegmentLabel].value[0] : 'n/a',\n    dataElements[TagKeys.SegmentAlgorithmType].value[0]\n  );\n  // algorithmName -> SegmentAlgorithmName (type1C)\n  if (typeof dataElements[TagKeys.SegmentAlgorithmName] !== 'undefined') {\n    segment.algorithmName = dataElements[TagKeys.SegmentAlgorithmName].value[0];\n  }\n  // // required if type is not MANUAL\n  // if (segment.algorithmType !== 'MANUAL' &&\n  //   (typeof segment.algorithmName === 'undefined' ||\n  //   segment.algorithmName.length === 0)) {\n  //   throw new Error('Empty algorithm name for non MANUAL algorithm type.');\n  // }\n  // displayValue ->\n  // - RecommendedDisplayGrayscaleValue\n  // - RecommendedDisplayCIELabValue converted to RGB\n  if (typeof dataElements[TagKeys.RecommendedDisplayGrayscaleValue] !==\n    'undefined') {\n    segment.displayValue =\n      dataElements[TagKeys.RecommendedDisplayGrayscaleValue].value[0];\n  } else if (typeof dataElements[TagKeys.RecommendedDisplayCIELabValue] !==\n    'undefined') {\n    const cielabElement =\n      dataElements[TagKeys.RecommendedDisplayCIELabValue].value;\n    const rgb = cielabToSrgb(uintLabToLab({\n      l: cielabElement[0],\n      a: cielabElement[1],\n      b: cielabElement[2]\n    }));\n    segment.displayRGBValue = rgb;\n  } else {\n    logger.warn('No recommended colour for segment, using default');\n    segment.displayRGBValue = getDefaultColour(segment.number);\n  }\n  // Segmented Property Category Code Sequence (type1, only one)\n  if (typeof dataElements[TagKeys.SegmentedPropertyCategoryCodeSequence] !==\n    'undefined') {\n    segment.propertyCategoryCode =\n      getCode(\n        dataElements[TagKeys.SegmentedPropertyCategoryCodeSequence].value[0]\n      );\n  } else {\n    throw new Error('Missing Segmented Property Category Code Sequence.');\n  }\n  // Segmented Property Type Code Sequence (type1)\n  if (typeof dataElements[TagKeys.SegmentedPropertyTypeCodeSequence] !==\n    'undefined') {\n    segment.propertyTypeCode =\n      getCode(dataElements[TagKeys.SegmentedPropertyTypeCodeSequence].value[0]);\n  } else {\n    throw new Error('Missing Segmented Property Type Code Sequence.');\n  }\n  // tracking Id and UID (type1C)\n  if (typeof dataElements[TagKeys.TrackingID] !== 'undefined') {\n    segment.trackingId = dataElements[TagKeys.TrackingID].value[0];\n    segment.trackingUid = dataElements[TagKeys.TrackingUID].value[0];\n  }\n\n  return segment;\n}\n\n/**\n * Check if two segment objects are equal.\n *\n * @param {MaskSegment} seg1 The first segment.\n * @param {MaskSegment} seg2 The second segment.\n * @returns {boolean} True if both segment are equal.\n */\nexport function isEqualSegment(seg1, seg2) {\n  // basics\n  if (typeof seg1 === 'undefined' ||\n    typeof seg2 === 'undefined' ||\n    seg1 === null ||\n    seg2 === null) {\n    return false;\n  }\n  let isEqual = seg1.number === seg2.number &&\n    seg1.label === seg2.label &&\n    seg1.algorithmType === seg2.algorithmType;\n  // display value\n  if (typeof seg1.displayRGBValue !== 'undefined' &&\n    typeof seg2.displayRGBValue !== 'undefined') {\n    isEqual = isEqual &&\n      isEqualRgb(seg1.displayRGBValue, seg2.displayRGBValue);\n  } else if (typeof seg1.displayValue !== 'undefined' &&\n    typeof seg2.displayValue !== 'undefined') {\n    isEqual = isEqual &&\n      seg1.displayValue === seg2.displayValue;\n  } else {\n    isEqual = false;\n  }\n  // algorithmName\n  if (typeof seg1.algorithmName !== 'undefined') {\n    if (typeof seg2.algorithmName === 'undefined') {\n      isEqual = false;\n    } else {\n      isEqual = isEqual &&\n        seg1.algorithmName === seg2.algorithmName;\n    }\n  }\n\n  return isEqual;\n}\n\n/**\n * Check if two segment objects are similar: either the\n * number or the displayValue are equal.\n *\n * @param {MaskSegment} seg1 The first segment.\n * @param {MaskSegment} seg2 The second segment.\n * @returns {boolean} True if both segment are similar.\n */\nexport function isSimilarSegment(seg1, seg2) {\n  // basics\n  if (typeof seg1 === 'undefined' ||\n    typeof seg2 === 'undefined' ||\n    seg1 === null ||\n    seg2 === null) {\n    return false;\n  }\n  let isSimilar = seg1.number === seg2.number;\n  // display value\n  if (typeof seg1.displayRGBValue !== 'undefined' &&\n    typeof seg2.displayRGBValue !== 'undefined') {\n    isSimilar = isSimilar ||\n      isEqualRgb(seg1.displayRGBValue, seg2.displayRGBValue);\n  } else if (typeof seg1.displayValue !== 'undefined' &&\n    typeof seg2.displayValue !== 'undefined') {\n    isSimilar = isSimilar ||\n      seg1.displayValue === seg2.displayValue;\n  } else {\n    isSimilar = false;\n  }\n\n  return isSimilar;\n}\n\n/**\n * Get a dicom simple tag from a segment object.\n *\n * @param {MaskSegment} segment The segment object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomSegmentItem(segment) {\n  let algoType = segment.algorithmType;\n  if (algoType === undefined) {\n    algoType = 'MANUAL';\n  }\n  // dicom item (tags are in group/element order)\n  const segmentItem = {\n    SegmentNumber: segment.number,\n    SegmentLabel: segment.label,\n    SegmentAlgorithmType: algoType\n  };\n  // SegmentAlgorithmName\n  if (algoType !== 'MANUAL' && segment.algorithmName !== undefined) {\n    segmentItem.SegmentAlgorithmName = segment.algorithmName;\n  }\n  // RecommendedDisplay value\n  if (segment.displayRGBValue) {\n    const cieLab = labToUintLab(srgbToCielab(segment.displayRGBValue));\n    segmentItem.RecommendedDisplayCIELabValue = [\n      Math.round(cieLab.l),\n      Math.round(cieLab.a),\n      Math.round(cieLab.b)\n    ];\n  } else {\n    segmentItem.RecommendedDisplayGrayscaleValue = segment.displayValue;\n  }\n  // SegmentedPropertyCategoryCodeSequence\n  if (segment.propertyCategoryCode) {\n    segmentItem.SegmentedPropertyCategoryCodeSequence = {\n      value: [getDicomCodeItem(segment.propertyCategoryCode)]\n    };\n  }\n  // SegmentedPropertyTypeCodeSequence\n  if (segment.propertyTypeCode) {\n    segmentItem.SegmentedPropertyTypeCodeSequence = {\n      value: [getDicomCodeItem(segment.propertyTypeCode)]\n    };\n  }\n  // tracking\n  if (segment.trackingId) {\n    segmentItem.TrackingID = segment.trackingId;\n    segmentItem.TrackingUID = segment.trackingUid;\n  }\n  // return\n  return segmentItem;\n}\n","import {getSpacingFromMeasure} from './dicomImage.js';\nimport {logger} from '../utils/logger.js';\nimport {arrayEquals} from '../utils/array.js';\nimport {\n  getDicomCodeItem,\n  DcmCodes,\n  getDcmDicomCode\n} from './dicomCode.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\nimport {Spacing} from '../image/spacing.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  DerivationImageSequence: '00089124',\n  SourceImageSequence: '00082112',\n  ReferencedSOPClassUID: '00081150',\n  ReferencedSOPInstanceUID: '00081155',\n  FrameContentSequence: '00209111',\n  DimensionIndexValue: '00209157',\n  SegmentIdentificationSequence: '0062000A',\n  ReferencedSegmentNumber: '0062000B',\n  PlanePositionSequence: '00209113',\n  ImagePosition: '00200032',\n  PlaneOrientationSequence: '00209116',\n  ImageOrientation: '00200037',\n  PixelMeasuresSequence: '00289110'\n};\n\n/**\n * Check the dimension organization from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The root dicom element.\n * @returns {object} The dimension organizations and indices.\n */\nexport function getDimensionOrganization(dataElements) {\n  // Dimension Organization Sequence (required)\n  const orgSq = dataElements['00209221'];\n  if (typeof orgSq === 'undefined' || orgSq.value.length !== 1) {\n    throw new Error('Unsupported dimension organization sequence length');\n  }\n  // Dimension Organization UID\n  const orgUID = orgSq.value[0]['00209164'].value[0];\n\n  // Dimension Index Sequence (conditionally required)\n  const indices = [];\n  const indexSqElem = dataElements['00209222'];\n  if (typeof indexSqElem !== 'undefined') {\n    const indexSq = indexSqElem.value;\n    // expecting 2D index\n    if (indexSq.length !== 2) {\n      throw new Error('Unsupported dimension index sequence length');\n    }\n    let indexPointer;\n    for (let i = 0; i < indexSq.length; ++i) {\n      // Dimension Organization UID (required)\n      const indexOrg = indexSq[i]['00209164'].value[0];\n      if (indexOrg !== orgUID) {\n        throw new Error(\n          'Dimension Index Sequence contains a unknown Dimension Organization');\n      }\n      // Dimension Index Pointer (required)\n      indexPointer = indexSq[i]['00209165'].value[0];\n\n      const index = {\n        DimensionOrganizationUID: indexOrg,\n        DimensionIndexPointer: indexPointer\n      };\n      // Dimension Description Label (optional)\n      if (typeof indexSq[i]['00209421'] !== 'undefined') {\n        index.DimensionDescriptionLabel = indexSq[i]['00209421'].value[0];\n      }\n      // store\n      indices.push(index);\n    }\n    // expecting Image Position at last position\n    if (indexPointer !== '(0020,0032)') {\n      throw new Error('Unsupported non image position as last index');\n    }\n  }\n\n  return {\n    organizations: {\n      value: [\n        {\n          DimensionOrganizationUID: orgUID\n        }\n      ]\n    },\n    indices: {\n      value: indices\n    }\n  };\n}\n\n/**\n * DICOM segment frame info: item of a\n *  PerframeFunctionalGroupsSequence (5200,9230).\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.7.6.16.html}.\n */\nexport class DicomSegmentFrameInfo {\n  /**\n   * The dimension index.\n   *\n   * @type {number[]}\n   */\n  dimIndex;\n  /**\n   * The frame image position patient.\n   *\n   * @type {number[]}\n   */\n  imagePosPat;\n  /**\n   * List of derivation images.\n   *\n   * @type {Array}\n   */\n  derivationImages;\n  /**\n   * The reference segment number.\n   *\n   * @type {number}\n   */\n  refSegmentNumber;\n\n  /**\n   * The frame image orientation.\n   *\n   * @type {number[]|undefined}\n   */\n  imageOrientationPatient;\n  /**\n   * The frame spacing.\n   *\n   * @type {Spacing|undefined}\n   */\n  spacing;\n\n  /**\n   * @param {number[]} dimIndex The dimension index.\n   * @param {number[]} imagePosPat The frame image position patient.\n   * @param {Array} derivationImages List of derivation images.\n   * @param {number} refSegmentNumber The reference segment number.\n   */\n  constructor(dimIndex, imagePosPat, derivationImages, refSegmentNumber) {\n    this.dimIndex = dimIndex;\n    this.imagePosPat = imagePosPat;\n    this.derivationImages = derivationImages;\n    this.refSegmentNumber = refSegmentNumber;\n  }\n}\n\n/**\n * Get a frame information object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {DicomSegmentFrameInfo} A frame information object.\n */\nexport function getSegmentFrameInfo(dataElements) {\n  // Derivation Image Sequence\n  const derivationImages = [];\n  if (typeof dataElements[TagKeys.DerivationImageSequence] !== 'undefined') {\n    const derivationImageSq =\n      dataElements[TagKeys.DerivationImageSequence].value;\n    // Source Image Sequence\n    for (let i = 0; i < derivationImageSq.length; ++i) {\n      const sourceImages = [];\n      if (typeof derivationImageSq[i][TagKeys.SourceImageSequence] !==\n        'undefined') {\n        const sourceImageSq =\n          derivationImageSq[i][TagKeys.SourceImageSequence].value;\n        for (let j = 0; j < sourceImageSq.length; ++j) {\n          const sourceImage = {};\n          // Referenced SOP Class UID\n          if (typeof sourceImageSq[j][TagKeys.ReferencedSOPClassUID] !==\n            'undefined') {\n            sourceImage.referencedSOPClassUID =\n              sourceImageSq[j][TagKeys.ReferencedSOPClassUID].value[0];\n          }\n          // Referenced SOP Instance UID\n          if (typeof sourceImageSq[j][TagKeys.ReferencedSOPInstanceUID] !==\n            'undefined') {\n            sourceImage.referencedSOPInstanceUID =\n              sourceImageSq[j][TagKeys.ReferencedSOPInstanceUID].value[0];\n          }\n          sourceImages.push(sourceImage);\n        }\n      }\n      derivationImages.push({\n        sourceImages: sourceImages\n      });\n    }\n  }\n  // Frame Content Sequence (required, only one)\n  const frameContentSq = dataElements[TagKeys.FrameContentSequence].value;\n  // Dimension Index Value\n  const dimIndex = frameContentSq[0][TagKeys.DimensionIndexValue].value;\n  // Segment Identification Sequence (required, only one)\n  const segmentIdSq = dataElements[TagKeys.SegmentIdentificationSequence].value;\n  // Referenced Segment Number\n  const refSegmentNumber =\n    parseInt(segmentIdSq[0][TagKeys.ReferencedSegmentNumber].value[0], 0);\n  // Plane Position Sequence (required, only one)\n  const planePosSq = dataElements[TagKeys.PlanePositionSequence].value;\n  // Image Position (Patient) (conditionally required)\n  const imagePosPat = planePosSq[0][TagKeys.ImagePosition].value;\n  for (let p = 0; p < imagePosPat.length; ++p) {\n    imagePosPat[p] = parseFloat(imagePosPat[p]);\n  }\n  const frameInfo = new DicomSegmentFrameInfo(\n    dimIndex,\n    imagePosPat,\n    derivationImages,\n    refSegmentNumber\n  );\n  // Plane Orientation Sequence\n  if (typeof dataElements[TagKeys.PlaneOrientationSequence] !== 'undefined') {\n    const framePlaneOrientationSeq =\n      dataElements[TagKeys.PlaneOrientationSequence];\n    if (framePlaneOrientationSeq.value.length !== 0) {\n      // should only be one Image Orientation (Patient)\n      const frameImageOrientation =\n        framePlaneOrientationSeq.value[0][TagKeys.ImageOrientation].value;\n      if (typeof frameImageOrientation !== 'undefined') {\n        frameInfo.imageOrientationPatient = frameImageOrientation;\n      }\n    }\n  }\n  // Pixel Measures Sequence\n  if (typeof dataElements[TagKeys.PixelMeasuresSequence] !== 'undefined') {\n    const framePixelMeasuresSeq = dataElements[TagKeys.PixelMeasuresSequence];\n    if (framePixelMeasuresSeq.value.length !== 0) {\n      // should only be one\n      const frameSpacing =\n        getSpacingFromMeasure(framePixelMeasuresSeq.value[0]);\n      if (typeof frameSpacing !== 'undefined') {\n        frameInfo.spacing = frameSpacing;\n      }\n    } else {\n      logger.warn(\n        'No shared functional group pixel measure sequence items.');\n    }\n  }\n\n  return frameInfo;\n}\n\n/**\n * Check if two frame info objects are equal.\n *\n * @param {DicomSegmentFrameInfo} dsfi1 The first frame info.\n * @param {DicomSegmentFrameInfo} dsfi2 The second frame info.\n * @returns {boolean} True if both frame info are equal.\n */\nexport function isEqualSegmentFrameInfo(dsfi1, dsfi2) {\n  // basics\n  if (typeof dsfi1 === 'undefined' ||\n    typeof dsfi2 === 'undefined' ||\n    dsfi1 === null ||\n    dsfi2 === null) {\n    return false;\n  }\n  let isEqual =\n    arrayEquals(dsfi1.dimIndex, dsfi2.dimIndex) &&\n    arrayEquals(dsfi1.imagePosPat, dsfi2.imagePosPat) &&\n    dsfi1.refSegmentNumber === dsfi2.refSegmentNumber;\n\n  isEqual = isEqual &&\n    dsfi1.derivationImages.length === dsfi2.derivationImages.length;\n  for (let i = 0; i < dsfi1.derivationImages.length; ++i) {\n    const derivationImage1 = dsfi1.derivationImages[i];\n    const derivationImage2 = dsfi2.derivationImages[i];\n    isEqual = isEqual &&\n      derivationImage1.sourceImages.length ===\n      derivationImage2.sourceImages.length;\n    for (let j = 0; j < derivationImage1.length; ++j) {\n      const sourceImage1 = derivationImage1.sourceImages[j];\n      const sourceImage2 = derivationImage2.sourceImages[j];\n      isEqual = isEqual &&\n        sourceImage1.referencedSOPClassUID ===\n        sourceImage2.referencedSOPClassUID &&\n        sourceImage1.referencedSOPInstanceUID ===\n        sourceImage2.referencedSOPInstanceUID;\n    }\n  }\n\n  return isEqual;\n}\n\n/**\n * Get a dicom item from a frame information object.\n *\n * @param {object} frameInfo The frame information object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomSegmentFrameInfoItem(frameInfo) {\n  const item = {\n    FrameContentSequence: {\n      value: [\n        {\n          DimensionIndexValues: frameInfo.dimIndex\n        }\n      ]\n    },\n    PlanePositionSequence: {\n      value: [\n        {\n          ImagePositionPatient: frameInfo.imagePosPat\n        }\n      ]\n    },\n    SegmentIdentificationSequence: {\n      value: [\n        {\n          ReferencedSegmentNumber: frameInfo.refSegmentNumber\n        }\n      ]\n    }\n  };\n  // optional DerivationImageSequence\n  if (frameInfo.derivationImages !== undefined) {\n    const sourceImgPurposeOfReferenceCode =\n      getDicomCodeItem(\n        getDcmDicomCode(DcmCodes.SourceImageForImageProcessingOperation)\n      );\n    const segDerivationCode =\n      getDicomCodeItem(getDcmDicomCode(DcmCodes.Segmentation));\n\n    const derivationImageItems = [];\n    for (const derivationImage of frameInfo.derivationImages) {\n      const sourceImages = [];\n      for (const sourceImage of derivationImage.sourceImages) {\n        sourceImages.push({\n          PurposeOfReferenceCodeSequence: {\n            value: [sourceImgPurposeOfReferenceCode]\n          },\n          ReferencedSOPClassUID: sourceImage.referencedSOPClassUID,\n          ReferencedSOPInstanceUID: sourceImage.referencedSOPInstanceUID\n        });\n      }\n\n      derivationImageItems.push({\n        DerivationCodeSequence: {\n          value: [segDerivationCode]\n        },\n        SourceImageSequence: {\n          value: sourceImages\n        }\n      });\n    }\n\n    item.DerivationImageSequence = {\n      value: derivationImageItems\n    };\n  }\n\n  return item;\n}\n","import {\n  dateToDateObj,\n  getDicomDate,\n  dateToTimeObj,\n  getDicomTime,\n} from '../dicom/dicomDate.js';\nimport {\n  safeGet,\n  safeGetAll\n} from '../dicom/dataElement.js';\nimport {\n  getImage2DSize,\n  getSpacingFromMeasure,\n  getDicomMeasureItem,\n  getDicomPlaneOrientationItem\n} from '../dicom/dicomImage.js';\nimport {Tag} from '../dicom/dicomTag.js';\nimport {getElementsFromJSONTags} from '../dicom/dicomWriter.js';\nimport {\n  getSegment,\n  getDicomSegmentItem,\n} from '../dicom/dicomSegment.js';\nimport {\n  getSegmentFrameInfo,\n  getDicomSegmentFrameInfoItem,\n  getDimensionOrganization,\n} from '../dicom/dicomSegmentFrameInfo.js';\nimport {transferSyntaxKeywords} from '../dicom/dictionary.js';\nimport {Image} from '../image/image.js';\nimport {Geometry} from '../image/geometry.js';\nimport {getOrientationFromCosines} from '../math/orientation.js';\nimport {Point, Point3D} from '../math/point.js';\nimport {Index} from '../math/index.js';\nimport {REAL_WORLD_EPSILON} from '../math/matrix.js';\nimport {logger} from '../utils/logger.js';\nimport {arraySortEquals} from '../utils/array.js';\nimport {Size} from './size.js';\nimport {ColourMap} from './luts.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Matrix33} from '../math/matrix.js';\nimport {Spacing} from '../image/spacing.js';\nimport {DataElement} from '../dicom/dataElement.js';\nimport {MaskSegment} from '../dicom/dicomSegment.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * @typedef {Object<string, DataElement>} DataElements\n */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  SOPInstanceUID: '00080018',\n  NumberOfFrames: '00280008',\n  SegmentSequence: '00620002',\n  SharedFunctionalGroupsSequence: '52009229',\n  PlaneOrientationSequence: '00209116',\n  ImageOrientationPatient: '00200037',\n  PixelMeasuresSequence: '00289110',\n  PerFrameFunctionalGroupsSequence: '52009230'\n};\n\n/**\n * Meta tag keys.\n */\nconst MetaTagKeys = {\n  // patient\n  PatientName: '00100010',\n  PatientID: '00100020',\n  PatientBirthDate: '00100030',\n  PatientSex: '00100040',\n  // general study\n  StudyDate: '00080020',\n  StudyTime: '00080030',\n  StudyInstanceUID: '0020000D',\n  StudyID: '00200010',\n  ReferringPhysicianName: '00080090',\n  // general series\n  SeriesDate: '00080021',\n  SeriesTime: '00080031',\n  SeriesInstanceUID: '0020000E',\n  SeriesNumber: '00200011',\n  // frame of reference\n  FrameOfReferenceUID: '00200052',\n  // general equipment\n  Manufacturer: '00080070',\n  ManufacturerModelName: '00081090',\n  DeviceSerialNumber: '00181000',\n  SoftwareVersions: '00181020',\n  // general image\n  LossyImageCompression: '00282110'\n};\n\n/**\n * Check two position patients for equality.\n *\n * @param {*} pos1 The first position patient.\n * @param {*} pos2 The second position patient.\n * @returns {boolean} True is equal.\n */\nfunction equalPosPat(pos1, pos2) {\n  return JSON.stringify(pos1) === JSON.stringify(pos2);\n}\n\n/**\n * @callback compareFn\n * @param {object} a The first object.\n * @param {object} b The first object.\n * @returns {number} >0 to sort a after b, <0 to sort a before b,\n *   0 to not change order.\n */\n\n/**\n * Get a position patient compare function accroding to an\n * input orientation.\n *\n * @param {Matrix33} orientation The orientation matrix.\n * @returns {compareFn} The position compare function.\n */\nfunction getComparePosPat(orientation) {\n  const invOrientation = orientation.getInverse();\n  return function (pos1, pos2) {\n    const p1 = invOrientation.multiplyArray3D(pos1);\n    const p2 = invOrientation.multiplyArray3D(pos2);\n    return p1[2] - p2[2];\n  };\n}\n\n/**\n * Merge two tag lists.\n *\n * @param {object} tags1 Base list, will be modified.\n * @param {object} tags2 List to merge.\n */\nfunction mergeTags(tags1, tags2) {\n  const keys2 = Object.keys(tags2);\n  for (const tagName2 of keys2) {\n    if (tags1[tagName2] !== undefined) {\n      logger.debug('Overwritting tag: ' + tagName2);\n    }\n    tags1[tagName2] = tags2[tagName2];\n  }\n}\n\n/**\n * Check that a DICOM tag definition is present in a parsed element.\n *\n * @param {DataElements} dataElements The root dicom element.\n * @param {object} tagDefinition The tag definition as {name, tag, type, enum}.\n */\nfunction checkTag(dataElements, tagDefinition) {\n  const element = dataElements[tagDefinition.tag];\n  // check null and undefined\n  if (tagDefinition.type === 1 || tagDefinition.type === 2) {\n    if (typeof element === 'undefined') {\n      throw new Error('Missing or empty ' + tagDefinition.name);\n    }\n  } else {\n    if (typeof element === 'undefined') {\n      // non mandatory value, exit\n      return;\n    }\n  }\n  let includes = false;\n  let tagValue;\n  if (element.value.length === 1) {\n    tagValue = element.value[0];\n  } else {\n    tagValue = element.value;\n  }\n  if (Array.isArray(tagValue)) {\n    for (let i = 0; i < tagDefinition.enum.length; ++i) {\n      if (!Array.isArray(tagDefinition.enum[i])) {\n        throw new Error('Cannot compare array and non array tag value.');\n      }\n      if (arraySortEquals(tagDefinition.enum[i], tagValue)) {\n        includes = true;\n        break;\n      }\n    }\n  } else {\n    includes = tagDefinition.enum.includes(tagValue);\n  }\n  if (!includes) {\n    throw new Error(\n      'Unsupported ' + tagDefinition.name + ' value: ' + tagValue);\n  }\n}\n\n/**\n * Create ROI slice buffers.\n *\n * @param {Image} image The mask image.\n * @param {MaskSegment[]} segments The mask segments.\n * @param {number} sliceOffset The slice offset.\n * @returns {object} The ROI slice image buffers.\n */\nfunction createRoiSliceBuffers(\n  image,\n  segments,\n  sliceOffset\n) {\n  // create binary mask buffers\n  const geometry = image.getGeometry();\n  const size = geometry.getSize();\n  const sliceSize = size.getDimSize(2);\n  const buffers = {};\n  for (let o = 0; o < sliceSize; ++o) {\n    const inputOffset = sliceOffset + o;\n    const pixelValue = image.getValueAtOffset(inputOffset);\n    for (const segment of segments) {\n      const segmentIndex = segment.number - 1;\n      if (pixelValue === segment.number) {\n        if (buffers[segmentIndex] === undefined) {\n          buffers[segmentIndex] = new Uint8Array(sliceSize);\n        }\n        buffers[segmentIndex][o] = 1;\n      }\n    }\n  }\n  return buffers;\n}\n\n/**\n * Create ROI buffers.\n *\n * @param {Image} image The mask image.\n * @param {MaskSegment[]} segments The mask segments.\n * @returns {object} The ROI buffers.\n */\nfunction createRoiBuffers(image, segments) {\n  const geometry = image.getGeometry();\n  const size = geometry.getSize();\n\n  // image buffer to multi frame\n  const sliceSize = size.getDimSize(2);\n  const roiBuffers = {};\n  for (let k = 0; k < size.get(2); ++k) {\n    const sliceOffset = k * sliceSize;\n    // create slice buffers\n    const buffers = createRoiSliceBuffers(image, segments, sliceOffset);\n    // store slice buffers\n    const keys0 = Object.keys(buffers);\n    for (const key0 of keys0) {\n      if (roiBuffers[key0] === undefined) {\n        roiBuffers[key0] = {};\n      }\n      // ordering by slice index (follows posPat)\n      roiBuffers[key0][k] = buffers[key0];\n    }\n  }\n  return roiBuffers;\n}\n\n/**\n * List of DICOM Seg required tags.\n */\nconst RequiredDicomTags = [\n  {\n    name: 'TransferSyntaxUID',\n    tag: '00020010',\n    type: '1',\n    enum: [\n      transferSyntaxKeywords.ImplicitVRLittleEndian,\n      transferSyntaxKeywords.ExplicitVRLittleEndian,\n      transferSyntaxKeywords.ExplicitVRBigEndian\n    ]\n  },\n  {\n    name: 'MediaStorageSOPClassUID',\n    tag: '00020002',\n    type: '1',\n    enum: ['1.2.840.10008.5.1.4.1.1.66.4']\n  },\n  {\n    name: 'SOPClassUID',\n    tag: '00020002',\n    type: '1',\n    enum: ['1.2.840.10008.5.1.4.1.1.66.4']\n  },\n  {\n    name: 'Modality',\n    tag: '00080060',\n    type: '1',\n    enum: ['SEG']\n  },\n  {\n    name: 'SegmentationType',\n    tag: '00620001',\n    type: '1',\n    enum: ['BINARY']\n  },\n  {\n    name: 'DimensionOrganizationType',\n    tag: '00209311',\n    type: '3',\n    enum: ['3D']\n  },\n  {\n    name: 'ImageType',\n    tag: '00080008',\n    type: '1',\n    enum: [['DERIVED', 'PRIMARY']]\n  },\n  {\n    name: 'SamplesPerPixel',\n    tag: '00280002',\n    type: '1',\n    enum: [1]\n  },\n  {\n    name: 'PhotometricInterpretation',\n    tag: '00280004',\n    type: '1',\n    enum: ['MONOCHROME2']\n  },\n  {\n    name: 'PixelRepresentation',\n    tag: '00280103',\n    type: '1',\n    enum: [0]\n  },\n  {\n    name: 'BitsAllocated',\n    tag: '00280100',\n    type: '1',\n    enum: [1]\n  },\n  {\n    name: 'BitsStored',\n    tag: '00280101',\n    type: '1',\n    enum: [1]\n  },\n  {\n    name: 'HighBit',\n    tag: '00280102',\n    type: '1',\n    enum: [0]\n  },\n];\n\n/**\n * Get the default DICOM seg tags as an object.\n *\n * @returns {object} The default tags.\n */\nexport function getDefaultDicomSegJson() {\n  const tags = {};\n  for (const tag of RequiredDicomTags) {\n    tags[tag.name] = tag.enum[0];\n  }\n  return tags;\n}\n\n/**\n * Mask {@link Image} factory.\n */\nexport class MaskFactory {\n\n  /**\n   * Possible warning created by checkElements.\n   *\n   * @type {string|undefined}\n   */\n  #warning;\n\n  /**\n   * Get a warning string if elements are not as expected.\n   * Created by checkElements.\n   *\n   * @returns {string|undefined} The warning.\n   */\n  getWarning() {\n    return this.#warning;\n  }\n\n  /**\n   * Check dicom elements.\n   *\n   * @param {Object<string, DataElement>} _dicomElements The DICOM tags.\n   * @returns {string|undefined} A possible warning.\n   */\n  checkElements(_dicomElements) {\n    // does nothing\n    return;\n  }\n\n  /**\n   * Get an {@link Image} object from the read DICOM file.\n   *\n   * @param {Object<string, DataElement>} dataElements The DICOM tags.\n   * @param {Uint8Array | Int8Array |\n   *   Uint16Array | Int16Array |\n   *   Uint32Array | Int32Array} pixelBuffer The pixel buffer.\n   * @param {Image} [refImage] Reference image, code will use its\n   *   origins if present (best) or try to calculate them.\n   * @returns {Image} A new Image.\n   * @throws {Error} Error for missing or wrong data.\n   */\n  create(dataElements, pixelBuffer, refImage) {\n    // safe get shortcuts\n    const safeGetLocal = function (key) {\n      return safeGet(dataElements, key);\n    };\n    const safeGetAllLocal = function (key) {\n      return safeGetAll(dataElements, key);\n    };\n\n    // check required and supported tags\n    for (const tag of RequiredDicomTags) {\n      checkTag(dataElements, tag);\n    }\n\n    // image size\n    const size2D = getImage2DSize(dataElements);\n    const size = new Size([size2D[0], size2D[1], 1]);\n\n    const sliceSize = size.getTotalSize();\n\n    // NumberOfFrames\n    let numberOfFrames = safeGetLocal(TagKeys.NumberOfFrames);\n    if (typeof numberOfFrames !== 'undefined') {\n      numberOfFrames = parseInt(numberOfFrames, 10);\n    } else {\n      numberOfFrames = 1;\n    }\n\n    if (numberOfFrames !== pixelBuffer.length / sliceSize) {\n      throw new Error(\n        'Buffer and numberOfFrames meta are not equal ' +\n        numberOfFrames + ' ' + pixelBuffer.length / sliceSize);\n    }\n\n    // Dimension Organization and Index\n    const dimension = getDimensionOrganization(dataElements);\n\n    // Segment Sequence\n    const segSequence = safeGetAllLocal(TagKeys.SegmentSequence);\n    if (typeof segSequence === 'undefined') {\n      throw new Error('Missing or empty segmentation sequence');\n    }\n    const segments = [];\n    // segment number is unique and starts at 1, use 0 as background\n    const redLut = [0];\n    const greenLut = [0];\n    const blueLut = [0];\n    for (let i = 0; i < segSequence.length; ++i) {\n      const segment = getSegment(segSequence[i]);\n      if (typeof segment.displayRGBValue !== 'undefined') {\n        // add palette colour\n        redLut[segment.number] = segment.displayRGBValue.r;\n        greenLut[segment.number] = segment.displayRGBValue.g;\n        blueLut[segment.number] = segment.displayRGBValue.b;\n      }\n      // store\n      segments.push(segment);\n    }\n\n    let hasDisplayRGBValue = false;\n    let paletteColourMap;\n    if (redLut.length > 1) {\n      hasDisplayRGBValue = true;\n      paletteColourMap = new ColourMap(redLut, greenLut, blueLut);\n    }\n\n    // Shared Functional Groups Sequence\n    let spacing;\n    let imageOrientationPatient;\n    const sharedFunctionalGroupsSeq =\n      safeGetAllLocal(TagKeys.SharedFunctionalGroupsSequence);\n    if (typeof sharedFunctionalGroupsSeq !== 'undefined') {\n      // should be only one\n      const funcGroup0 = sharedFunctionalGroupsSeq[0];\n      // Plane Orientation Sequence\n      if (typeof funcGroup0[TagKeys.PlaneOrientationSequence] !== 'undefined') {\n        const planeOrientationSeq =\n          funcGroup0[TagKeys.PlaneOrientationSequence];\n        if (planeOrientationSeq.value.length !== 0) {\n          // should be only one\n          imageOrientationPatient =\n            planeOrientationSeq.value[0][TagKeys.ImageOrientationPatient].value;\n        } else {\n          logger.warn(\n            'No shared functional group plane orientation sequence items.');\n        }\n      }\n      // Pixel Measures Sequence\n      if (typeof funcGroup0[TagKeys.PixelMeasuresSequence] !== 'undefined') {\n        const pixelMeasuresSeq = funcGroup0[TagKeys.PixelMeasuresSequence];\n        if (pixelMeasuresSeq.value.length !== 0) {\n          // should be only one\n          spacing = getSpacingFromMeasure(pixelMeasuresSeq.value[0]);\n        } else {\n          logger.warn(\n            'No shared functional group pixel measure sequence items.');\n        }\n      }\n    }\n\n    const includesPosPat = function (arr, val) {\n      return arr.some(function (arrVal) {\n        return equalPosPat(val, arrVal);\n      });\n    };\n\n    const findPointIndex = function (arr, val) {\n      return arr.findIndex(function (arrVal) {\n        return val.equals(arrVal);\n      });\n    };\n\n    // Per-frame Functional Groups Sequence\n    const perFrameFuncGroupSequence =\n      safeGetAllLocal(TagKeys.PerFrameFunctionalGroupsSequence);\n    if (typeof perFrameFuncGroupSequence === 'undefined') {\n      throw new Error('Missing or empty per frame functional sequence');\n    }\n    if (numberOfFrames !== perFrameFuncGroupSequence.length) {\n      throw new Error(\n        'perFrameFuncGroupSequence meta and numberOfFrames are not equal.');\n    }\n    // create frame info object from per frame func\n    const frameInfos = [];\n    for (let j = 0; j < perFrameFuncGroupSequence.length; ++j) {\n      frameInfos.push(\n        getSegmentFrameInfo(perFrameFuncGroupSequence[j]));\n    }\n\n    // check frame infos\n    const framePosPats = [];\n    for (let ii = 0; ii < frameInfos.length; ++ii) {\n      if (!includesPosPat(framePosPats, frameInfos[ii].imagePosPat)) {\n        framePosPats.push(frameInfos[ii].imagePosPat);\n      }\n      // store orientation if needed, avoid multi\n      if (typeof frameInfos[ii].imageOrientationPatient !== 'undefined') {\n        if (typeof imageOrientationPatient === 'undefined') {\n          imageOrientationPatient = frameInfos[ii].imageOrientationPatient;\n        } else {\n          if (!arraySortEquals(\n            imageOrientationPatient, frameInfos[ii].imageOrientationPatient)) {\n            throw new Error('Unsupported multi orientation dicom seg.');\n          }\n        }\n      }\n      // store spacing if needed, avoid multi\n      if (typeof frameInfos[ii].spacing !== 'undefined') {\n        if (typeof spacing === 'undefined') {\n          spacing = frameInfos[ii].spacing;\n        } else {\n          if (!spacing.equals(frameInfos[ii].spacing)) {\n            throw new Error('Unsupported multi resolution dicom seg.');\n          }\n        }\n      }\n    }\n\n    // check spacing and orientation\n    if (typeof spacing === 'undefined') {\n      throw new Error('No spacing found for DICOM SEG');\n    }\n    if (spacing.length() !== 3) {\n      throw new Error('Incomplete spacing found for DICOM SEG');\n    }\n    if (typeof imageOrientationPatient === 'undefined') {\n      throw new Error('No imageOrientationPatient found for DICOM SEG');\n    }\n    // orientation\n    const orientationMatrix = getOrientationFromCosines(\n      imageOrientationPatient.map((item) => parseFloat(item))\n    );\n    if (typeof orientationMatrix === 'undefined') {\n      throw new Error('Invalid imageOrientationPatient found for DICOM SEG');\n    }\n\n    // sort positions patient\n    framePosPats.sort(getComparePosPat(orientationMatrix));\n\n    const point3DFromArray = function (arr) {\n      return new Point3D(arr[0], arr[1], arr[2]);\n    };\n\n    // frame origins\n    const frameOrigins = [];\n    for (const framePosPat of framePosPats) {\n      frameOrigins.push(point3DFromArray(framePosPat));\n    }\n\n    let geometry;\n    if (typeof refImage !== 'undefined') {\n      geometry = this.#getGeometryFromReference(\n        frameOrigins,\n        size,\n        spacing,\n        orientationMatrix,\n        refImage.getGeometry().getOrigins()\n      );\n    } else {\n      geometry = this.#calculateGeometry(\n        frameOrigins,\n        size,\n        spacing,\n        orientationMatrix\n      );\n    }\n\n    const numberOfSlices = geometry.getSize().get(2);\n\n    const getFindSegmentFunc = function (number) {\n      return function (item) {\n        return item.number === number;\n      };\n    };\n\n    // create output buffer\n    const buffer =\n      // @ts-ignore\n      new pixelBuffer.constructor(sliceSize * numberOfSlices);\n    buffer.fill(0);\n\n    // merge frame buffers\n    const maskOrigins = geometry.getOrigins();\n    let sliceIndex;\n    let frameOffset;\n    let sliceOffset;\n    for (let f = 0; f < frameInfos.length; ++f) {\n      // get the slice index from the position in the mask origins array\n      const frameOrigin = point3DFromArray(frameInfos[f].imagePosPat);\n      sliceIndex = findPointIndex(maskOrigins, frameOrigin);\n      // should not be possible but just in case...\n      if (sliceIndex === -1) {\n        throw new Error('Cannot find frame origin in mask origins');\n      }\n      frameOffset = sliceSize * f;\n      sliceOffset = sliceSize * sliceIndex;\n      // get the frame display value\n      const frameSegment = segments.find(\n        getFindSegmentFunc(frameInfos[f].refSegmentNumber)\n      );\n      for (let l = 0; l < sliceSize; ++l) {\n        if (pixelBuffer[frameOffset + l] !== 0) {\n          const offset = sliceOffset + l;\n          if (hasDisplayRGBValue) {\n            buffer[offset] = frameSegment.number;\n          } else {\n            buffer[offset] = frameSegment.displayValue;\n          }\n        }\n      }\n    }\n\n    // simple uids\n    const uids = [];\n    for (let m = 0; m < numberOfSlices; ++m) {\n      uids.push(m.toString());\n    }\n\n    // create image\n    const image = new Image(geometry, buffer, uids);\n    if (hasDisplayRGBValue) {\n      image.setPhotometricInterpretation('PALETTE COLOR');\n      image.setPaletteColourMap(paletteColourMap);\n    }\n    // meta information\n    const meta = getDefaultDicomSegJson();\n\n    // meta tags\n    const metaKeys = Object.keys(MetaTagKeys);\n    for (const key of metaKeys) {\n      meta[key] = safeGetLocal(MetaTagKeys[key]);\n    }\n\n    // dicom seg dimension\n    meta.DimensionOrganizationSequence = dimension.organizations;\n    meta.DimensionIndexSequence = dimension.indices;\n    // custom\n    meta.custom = {\n      segments: segments,\n      frameInfos: frameInfos,\n      SOPInstanceUID: safeGetLocal(TagKeys.SOPInstanceUID)\n    };\n\n    // get length unit from ref image\n    meta.lengthUnit = refImage.getMeta().lengthUnit;\n\n    // number of files: in this case equal to number slices,\n    //   used to calculate buffer size\n    meta.numberOfFiles = numberOfSlices;\n\n    image.setMeta(meta);\n\n    return image;\n  }\n\n  /**\n   * Get the mask geometry from reference image.\n   *\n   * @param {Point3D[]} frameOrigins The frame origins.\n   * @param {Size} size The mask temporary size.\n   * @param {Spacing} spacing The mask spcing.\n   * @param {Matrix33} orientationMatrix The mask orientation.\n   * @param {Point3D[]} refOrigins The reference image origins.\n   * @returns {Geometry} The final mask geometry.\n   */\n  #getGeometryFromReference(\n    frameOrigins, size, spacing, orientationMatrix, refOrigins) {\n    const findPointIndex = function (arr, val) {\n      return arr.findIndex(function (arrVal) {\n        return val.isSimilar(arrVal, 1e-4);\n      });\n    };\n\n    const maskOrigins = [];\n    maskOrigins.push(frameOrigins[0]);\n    let previousIndex = findPointIndex(refOrigins, frameOrigins[0]);\n    if (previousIndex === -1) {\n      throw new Error('No index for first frame origin');\n    }\n    for (let i = 1; i < frameOrigins.length; ++i) {\n      const frameOrigin = frameOrigins[i];\n      const currentIndex = findPointIndex(refOrigins, frameOrigin);\n      if (currentIndex === -1) {\n        throw new Error('No index for frame origin ' + i);\n      }\n      if (currentIndex !== previousIndex + 1) {\n        for (let j = previousIndex + 1; j < currentIndex; ++j) {\n          maskOrigins.push(refOrigins[j]);\n        }\n      }\n      maskOrigins.push(frameOrigin);\n      previousIndex = currentIndex;\n    }\n\n    // final geometry\n    const geometry = new Geometry(\n      [frameOrigins[0]], size, spacing, orientationMatrix);\n    // append origins\n    for (let m = 1; m < maskOrigins.length; ++m) {\n      geometry.appendOrigin(maskOrigins[m], m);\n    }\n\n    return geometry;\n  }\n\n  /**\n   * Calculate the mask geometry from frame origins.\n   *\n   * @param {Point3D[]} frameOrigins The frame origins.\n   * @param {Size} size The mask temporary size.\n   * @param {Spacing} spacing The mask spcing.\n   * @param {Matrix33} orientationMatrix The mask orientation.\n   * @returns {Geometry} The final mask geometry.\n   */\n  #calculateGeometry(frameOrigins, size, spacing, orientationMatrix) {\n    logger.warn('Guessing image geometry for DICOM SEG');\n\n    // tmp geometry with correct spacing but only one slice\n    const tmpGeometry = new Geometry(\n      [frameOrigins[0]], size, spacing, orientationMatrix);\n\n    // origin distance test\n    // TODO: maybe use sliceSpacing / 10\n    const isAboveEpsilon = function (value) {\n      let res = value > REAL_WORLD_EPSILON;\n      if (res) {\n        // try larger epsilon\n        res = value > REAL_WORLD_EPSILON * 10;\n        if (!res) {\n          // warn if epsilon < value < epsilon * 10\n          logger.warn(\n            'Using larger real world epsilon in SEG pos pat adding'\n          );\n        } else {\n          res = value > REAL_WORLD_EPSILON * 100;\n          if (!res) {\n            // warn if epsilon < value < epsilon * 100\n            logger.warn(\n              'Using larger+ real world epsilon in SEG pos pat adding'\n            );\n          }\n        }\n      }\n      return res;\n    };\n\n    // add possibly missing origins\n    const maskOrigins = [];\n    maskOrigins.push(frameOrigins[0]);\n    let sliceIndex = 0;\n    for (let g = 1; g < frameOrigins.length; ++g) {\n      ++sliceIndex;\n      let index = new Index([0, 0, sliceIndex]);\n      let point = tmpGeometry.indexToWorld(index).get3D();\n      const frameOrigin = frameOrigins[g];\n      // check if more pos pats are needed\n      let dist = frameOrigin.getDistance(point);\n      const distPrevious = dist;\n      // TODO: good threshold?\n      while (isAboveEpsilon(dist)) {\n        logger.debug('Adding intermediate pos pats for DICOM seg at ' +\n          point.toString());\n        maskOrigins.push(point);\n        ++sliceIndex;\n        index = new Index([0, 0, sliceIndex]);\n        point = tmpGeometry.indexToWorld(index).get3D();\n        dist = frameOrigin.getDistance(point);\n        if (dist > distPrevious) {\n          throw new Error(\n            'Test distance is increasing when adding intermediate pos pats');\n        }\n      }\n      // add frame pos pat\n      maskOrigins.push(frameOrigin);\n    }\n\n    // final geometry\n    const geometry = new Geometry(\n      [frameOrigins[0]], size, spacing, orientationMatrix);\n    // append origins\n    for (let m = 1; m < maskOrigins.length; ++m) {\n      geometry.appendOrigin(maskOrigins[m], m);\n    }\n\n    return geometry;\n  }\n\n  /**\n   * Convert a mask image into a DICOM segmentation object.\n   *\n   * @param {Image} image The mask image.\n   * @param {MaskSegment[]} segments The mask segments.\n   * @param {Image} sourceImage The source image.\n   * @param {Object<string, any>} [extraTags] Optional list of extra tags.\n   * @returns {Object<string, DataElement>} A list of dicom elements.\n   */\n  toDicom(\n    image,\n    segments,\n    sourceImage,\n    extraTags\n  ) {\n    // original image tags\n    const tags = image.getMeta();\n\n    // use image segments if not provided as input\n    if (segments === undefined) {\n      segments = tags.segments;\n    }\n\n    const geometry = image.getGeometry();\n    const size = geometry.getSize();\n\n    // (not in meta)\n    tags.Rows = size.get(1);\n    tags.Columns = size.get(0);\n    // update content tags\n    const now = new Date();\n    tags.ContentDate = getDicomDate(dateToDateObj(now));\n    tags.ContentTime = getDicomTime(dateToTimeObj(now));\n\n    // keep source image StudyInstanceUID\n    if (sourceImage !== undefined) {\n      tags.StudyInstanceUID = (sourceImage.getMeta()).StudyInstanceUID;\n    }\n\n    // segments\n    const segmentItems = [];\n    for (const segment of segments) {\n      segmentItems.push(getDicomSegmentItem(segment));\n    }\n    tags.SegmentSequence = {\n      value: segmentItems\n    };\n\n    // Shared Functional Groups Sequence\n    tags.SharedFunctionalGroupsSequence = {\n      value: [\n        {\n          PlaneOrientationSequence: {\n            value: [getDicomPlaneOrientationItem(geometry.getOrientation())]\n          },\n          PixelMeasuresSequence: {\n            value: [getDicomMeasureItem(geometry.getSpacing())]\n          }\n        }\n      ]\n    };\n\n    // image buffer to multi frame\n    const roiBuffers = createRoiBuffers(image, segments);\n\n    const frameInfos = [];\n\n    // flatten buffer array\n    const finalBuffers = [];\n    const referencedSOPs = [];\n    for (const segment of segments) {\n      const number40 = segment.number;\n      const number4 = number40 - 1;\n      // check if buffer has values\n      if (roiBuffers[number4] === undefined) {\n        continue;\n      }\n      const keys1 = Object.keys(roiBuffers[number4]);\n      // revert slice order\n      for (let k1 = keys1.length - 1; k1 >= 0; --k1) {\n        const key1 = Number.parseInt(keys1[k1], 10);\n        finalBuffers.push(roiBuffers[number4][key1]);\n        // frame info\n        const posPat = image.getGeometry().getOrigins()[key1];\n        const posPatArray = [posPat.getX(), posPat.getY(), posPat.getZ()];\n        const frameInfo = {\n          dimIndex: [number40, keys1.length - k1],\n          imagePosPat: posPatArray,\n          refSegmentNumber: number40\n        };\n        // derivation image info\n        if (sourceImage !== undefined) {\n          const sourceGeometry = sourceImage.getGeometry();\n          const sourceIndex = sourceGeometry.worldToIndex(\n            new Point([posPat.getX(), posPat.getY(), posPat.getZ()])\n          );\n          frameInfo.derivationImages = [\n            {\n              sourceImages: [\n                {\n                  referencedSOPInstanceUID:\n                    sourceImage.getImageUid(sourceIndex),\n                  referencedSOPClassUID:\n                    (sourceImage.getMeta()).SOPClassUID\n                }\n              ]\n            }\n          ];\n          // store as tag\n          referencedSOPs.push({\n            ReferencedSOPInstanceUID:\n              sourceImage.getImageUid(sourceIndex),\n            ReferencedSOPClassUID:\n              (sourceImage.getMeta()).SOPClassUID\n          });\n        }\n        frameInfos.push(frameInfo);\n      }\n    }\n\n    tags.NumberOfFrames = finalBuffers.length.toString();\n\n    // frame infos\n    const frameInfosTag = [];\n    for (const frameInfo of frameInfos) {\n      frameInfosTag.push(getDicomSegmentFrameInfoItem(frameInfo));\n    }\n    tags.PerFrameFunctionalGroupsSequence = {\n      value: frameInfosTag\n    };\n\n    // also store referenced SOPs in ReferencedSeriesSequence\n    if (sourceImage !== undefined) {\n      const refSeriesTag = [];\n      refSeriesTag.push({\n        ReferencedInstanceSequence: {\n          value: referencedSOPs\n        },\n        SeriesInstanceUID: (sourceImage.getMeta()).SeriesInstanceUID\n      });\n      tags.ReferencedSeriesSequence = {\n        value: refSeriesTag\n      };\n    }\n\n    // merge extra tags if provided\n    if (extraTags !== undefined) {\n      mergeTags(tags, extraTags);\n    }\n\n    // convert JSON to DICOM element object\n    const dicomElements = getElementsFromJSONTags(tags);\n\n    // pixel value length: divide by 8 to trigger binary write\n    const sliceSize = size.getDimSize(2);\n    const pixVl = (finalBuffers.length * sliceSize) / 8;\n    const de = new DataElement('OB');\n    de.tag = new Tag('7FE0', '0010');\n    de.vl = pixVl;\n    de.value = finalBuffers;\n    dicomElements['7FE00010'] = de;\n\n    return dicomElements;\n  }\n\n} // class MaskFactory\n","/**\n * Thread Pool.\n *\n * Highly inspired from {@link http://www.smartjava.org/content/html5-easily-parallelize-jobs-using-web-workers-and-threadpool}.\n */\nexport class ThreadPool {\n\n  /**\n   * @type {number}\n   */\n  poolSize;\n  /**\n   * @type {WorkerTask[]}\n   */\n  taskQueue;\n  /**\n   * @type {WorkerThread[]}\n   */\n  freeThreads;\n  /**\n   * @type {WorkerThread[]}\n   */\n  runningThreads;\n\n  /**\n   * @param {number} poolSize The size of the pool.\n   */\n  constructor(poolSize) {\n    this.poolSize = poolSize;\n    // task queue\n    this.taskQueue = [];\n    // lsit of available threads\n    this.freeThreads = [];\n    // create 'poolSize' number of worker threads\n    for (let i = 0; i < poolSize; ++i) {\n      this.freeThreads.push(new WorkerThread(this));\n    }\n    // list of running threads (unsed in abort)\n    this.runningThreads = [];\n  }\n\n  /**\n   * Add a worker task to the queue.\n   * Will be run when a thread is made available.\n   *\n   * @param {WorkerTask} workerTask The task to add to the queue.\n   */\n  addWorkerTask(workerTask) {\n    // send work start if first task\n    if (this.freeThreads.length === this.poolSize) {\n      this.onworkstart({type: 'work-start'});\n    }\n    // launch task or queue\n    if (this.freeThreads.length > 0) {\n      // get the first free worker thread\n      const workerThread = this.freeThreads.shift();\n      // add the thread to the runnning list\n      this.runningThreads.push(workerThread);\n      // run the input task\n      workerThread.run(workerTask);\n    } else {\n      // no free thread, add task to queue\n      this.taskQueue.push(workerTask);\n    }\n  }\n\n  /**\n   * Abort all threads.\n   */\n  abort() {\n    // stop all threads\n    this.#stop();\n    // callback\n    this.onabort({type: 'work-abort'});\n    this.onworkend({type: 'work-end'});\n  }\n\n  /**\n   * Handle a task end.\n   *\n   * @param {WorkerThread} workerThread The thread to free.\n   */\n  onTaskEnd(workerThread) {\n    // launch next task in queue or finish\n    if (this.taskQueue.length > 0) {\n      // get waiting task\n      const workerTask = this.taskQueue.shift();\n      // use input thread to run the waiting task\n      workerThread.run(workerTask);\n    } else {\n      // stop the worker\n      workerThread.stop();\n      // no task to run, add to free list\n      this.freeThreads.push(workerThread);\n      // remove from running list\n      for (let i = 0; i < this.runningThreads.length; ++i) {\n        if (this.runningThreads[i].getId() === workerThread.getId()) {\n          this.runningThreads.splice(i, 1);\n        }\n      }\n      // the work is done when the queue is back to its initial size\n      if (this.freeThreads.length === this.poolSize) {\n        this.onwork({type: 'work'});\n        this.onworkend({type: 'work-end'});\n      }\n    }\n  }\n\n  /**\n   * Handle an error message from a worker.\n   *\n   * @param {object} event The error event.\n   */\n  handleWorkerError = (event) => {\n    // stop all threads\n    this.#stop();\n    // callback\n    this.onerror({error: event});\n    this.onworkend({type: 'work-end'});\n  };\n\n  // private ----------------------------------------------------------------\n\n  /**\n   * Stop the pool: stop all running threads.\n   *\n   */\n  #stop() {\n    // clear tasks\n    this.taskQueue = [];\n    // cancel running workers\n    for (let i = 0; i < this.runningThreads.length; ++i) {\n      this.runningThreads[i].stop();\n    }\n    this.runningThreads = [];\n  }\n\n\n  /**\n   * Handle a work start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The work start event.\n   */\n  onworkstart(_event) {}\n\n  /**\n   * Handle a work item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The work item event fired\n   *   when a work item ended successfully.\n   */\n  onworkitem(_event) {}\n\n  /**\n   * Handle a work event.\n   * Default does nothing.\n   *\n   * @param {object} _event The work event fired\n   *   when a work ended successfully.\n   */\n  onwork(_event) {}\n\n  /**\n   * Handle a work end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The work end event fired\n   *  when a work has completed, successfully or not.\n   */\n  onworkend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // ThreadPool\n\n/**\n * Worker background task.\n *\n * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/API/Worker}.\n *\n * @external Worker\n */\n\n/**\n * Worker thread.\n */\nclass WorkerThread {\n  /**\n   * @type {ThreadPool}\n   */\n  parentPool;\n  /**\n   * @type {string}\n   */\n  id;\n  /**\n   * @type {WorkerTask}\n   */\n  runningTask;\n  /**\n   * @type {Worker}\n   */\n  worker;\n\n  /**\n   * @param {ThreadPool} parentPool The parent pool.\n   */\n  constructor(parentPool) {\n    this.parentPool = parentPool;\n    // thread ID\n    this.id = Math.random().toString(36).substring(2, 15);\n  }\n\n  /**\n   * Get the thread ID.\n   *\n   * @returns {string} The thread ID (alphanumeric).\n   */\n  getId() {\n    return this.id;\n  }\n\n  /**\n   * Run a worker task.\n   *\n   * @param {WorkerTask} workerTask The task to run.\n   */\n  run(workerTask) {\n    // store task\n    this.runningTask = workerTask;\n    // create a new web worker if not done yet\n    if (typeof this.worker === 'undefined') {\n      this.worker = this.runningTask.getWorker();\n      // set callbacks\n      this.worker.onmessage = this.onmessage;\n      this.worker.onerror = this.onerror;\n    }\n    // launch the worker\n    this.worker.postMessage(this.runningTask.startMessage);\n  }\n\n  /**\n   * Finish a task and tell the parent.\n   */\n  stop() {\n    // stop the worker\n    if (typeof this.worker !== 'undefined') {\n      this.worker.terminate();\n      // force create at next run\n      this.worker = undefined;\n    }\n  }\n\n  /**\n   * Message event handler.\n   * For now assume we only get a single callback from a worker\n   * which also indicates the end of this worker.\n   *\n   * @param {object} event The message event.\n   */\n  onmessage = (event) => {\n    // augment event\n    event.itemNumber = this.runningTask.info.itemNumber;\n    event.numberOfItems = this.runningTask.info.numberOfItems;\n    event.index = this.runningTask.info.index;\n    event.indexOrigin = this.runningTask.info.indexOrigin;\n    // send event\n    this.parentPool.onworkitem(event);\n    // tell the parent pool the task is done\n    this.parentPool.onTaskEnd(this);\n  };\n\n  /**\n   * Error event handler.\n   *\n   * @param {object} event The error event.\n   */\n  onerror = (event) => {\n    // augment event\n    event.itemNumber = this.runningTask.info.itemNumber;\n    event.numberOfItems = this.runningTask.info.numberOfItems;\n    event.index = this.runningTask.info.index;\n    event.indexOrigin = this.runningTask.info.indexOrigin;\n    // pass to parent\n    this.parentPool.handleWorkerError(event);\n    // stop the worker and free the thread\n    this.stop();\n  };\n} // class WorkerThread\n\n/**\n * Worker task.\n */\nexport class WorkerTask {\n  /**\n   * @param {object} message The data to pass to the worker.\n   * @param {object} info Information object about the input data.\n   */\n  constructor(message, info) {\n    // worker start message\n    this.startMessage = message;\n    // information about the work data\n    this.info = info;\n  }\n\n  /**\n   * Get the task web worker.\n   * Defaults returns undefined.\n   *\n   * @returns {Worker|undefined} The task worker.\n   */\n  getWorker() {\n    return undefined;\n  }\n}\n","import {ThreadPool, WorkerTask} from '../utils/thread.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Geometry} from './geometry.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * List of compatible typed arrays.\n *\n * @typedef {(\n *   Uint8Array | Int8Array |\n *   Uint16Array | Int16Array |\n *   Uint32Array | Int32Array\n * )} TypedArray\n */\n\n/**\n * Generate a worker message to send to the labeling worker.\n *\n * @param {TypedArray} imageBuffer The buffer to label.\n * @param {Geometry} imageGeometry The image geometry.\n *\n * @returns {object} The message to send to the worker.\n */\nexport function generateWorkerMessage(imageBuffer, imageGeometry) {\n  const imageSize = imageGeometry.getSize();\n  const imageSpacing = imageGeometry.getSpacing();\n\n  // We can't pass these metadata objects directly, so we will just\n  // pull out what we need and pass that.\n  const ndims = imageSize.length();\n\n  // Cache the unit vector offsets to make a couple calculations faster.\n  const unitVectors = Array(ndims).fill(0);\n  for (let d = 0; d < ndims; d++) {\n    unitVectors[d] = imageSize.getDimSize(d);\n  }\n\n  const sizes = Array(ndims).fill(0);\n  for (let d = 0; d < ndims; d++) {\n    sizes[d] = imageSize.get(d);\n  }\n\n  const totalSize = imageSize.getTotalSize();\n\n  return {\n    imageBuffer: imageBuffer,\n    unitVectors: unitVectors,\n    sizes: sizes,\n    spacing: imageSpacing.getValues(),\n    totalSize: totalSize\n  };\n}\n\n/**\n * Labeling worker task.\n */\nclass LabelingWorkerTask extends WorkerTask {\n  constructor(message, info) {\n    super(message, info);\n  }\n  getWorker() {\n    return new Worker(\n      new URL('./labeling.worker.js', import.meta.url),\n      {\n        name: 'labeling.worker'\n      }\n    );\n  }\n}\n\n/**\n * Labeling thread.\n */\nexport class LabelingThread {\n  /**\n   * The thread pool.\n   *\n   * @type {ThreadPool}\n   */\n  #threadPool = new ThreadPool(1);\n\n  constructor() {\n    this.#threadPool.onerror = ((e) => {\n      console.error('Labeling failed!', e.error);\n    });\n  }\n\n  /**\n   * Trigger a labels recalculation.\n   *\n   * @param {TypedArray} imageBuffer The buffer to label.\n   * @param {Geometry} geometry The image geometry.\n   */\n  run(imageBuffer, geometry) {\n    // We can't just pass in an Image or we would get a circular dependency\n\n    this.#threadPool.onworkitem = this.ondone;\n\n    const workerTask = new LabelingWorkerTask(\n      generateWorkerMessage(imageBuffer, geometry),\n      {}\n    );\n\n    // add it the queue and run it\n    this.#threadPool.addWorkerTask(workerTask);\n  }\n\n  /**\n   * Handle a completed labeling. Default behavior is do nothing,\n   * this is meant to be overridden.\n   *\n   * @param {object} _event The work item event fired when a labeling\n   *   calculation is completed. Event.data should contain a 'labels' item.\n   */\n  ondone(_event) {}\n}","import {ThreadPool, WorkerTask} from '../utils/thread.js';\nimport {Point3D} from '../math/point.js';\nimport {Geometry} from './geometry.js';\nimport {Size} from './size.js';\nimport {getTypedArray} from '../dicom/dicomParser.js';\nimport {Spacing} from './spacing.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Matrix33} from '../math/matrix.js';\nimport {Point} from '../math/point.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * List of compatible typed arrays.\n *\n * @typedef {(\n *   Uint8Array | Int8Array |\n *   Uint16Array | Int16Array |\n *   Uint32Array | Int32Array\n * )} TypedArray\n */\n\n/**\n * Resampling worker task.\n */\nclass ResamplingWorkerTask extends WorkerTask {\n  constructor(message, info) {\n    super(message, info);\n  }\n  getWorker() {\n    return new Worker(\n      new URL('./resampling.worker.js', import.meta.url),\n      {\n        name: 'resampling.worker'\n      }\n    );\n  }\n}\n\n/**\n * Generate a worker message to send to the resampling worker.\n *\n * @param {TypedArray} sourceImageBuffer The buffer to resample.\n * @param {Geometry} sourceImageGeometry The current image geometry.\n * @param {Geometry} targetImageGeometry The geometry to resample to.\n * @param {number} pixelRepresentation The pixel representation of the\n *  source image.\n * @param {boolean} interpolated If true use bilinear\n *  sampling, otherwise use nearest neighbor.\n * @param {string} jobId Unique resampling job id.\n *\n * @returns {object[]} The message to send to the worker.\n */\nexport function generateWorkerMessages(\n  sourceImageBuffer,\n  sourceImageGeometry,\n  targetImageGeometry,\n  pixelRepresentation,\n  interpolated,\n  jobId\n) {\n  // We can't pass these metadata objects directly, so we will just\n  // pull out what we need and pass that.\n\n  const sourceSize = sourceImageGeometry.getSize();\n  const sourceNDims = sourceSize.length();\n  const targetSize = targetImageGeometry.getSize();\n  const targetNDims = targetSize.length();\n\n  // Cache the unit vector offsets to make a couple calculations faster.\n  const sourceUnitVectors = Array(sourceNDims).fill(0);\n  for (let d = 0; d < sourceNDims; d++) {\n    sourceUnitVectors[d] = sourceSize.getDimSize(d);\n  }\n\n  const targetUnitVectors = Array(targetNDims).fill(0);\n  for (let d = 0; d < targetNDims; d++) {\n    targetUnitVectors[d] = targetSize.getDimSize(d);\n  }\n\n  const sourceTotalSize = sourceSize.getTotalSize();\n  const targetTotalSize = targetSize.getTotalSize();\n\n  const generateMessage = (sourceStartOffset, targetStartOffset, frame) => {\n    return {\n      sourceImageBuffer: sourceImageBuffer,\n      sourceOrigin: sourceImageGeometry.getOrigin().getValues(),\n      sourceSize: sourceImageGeometry.getSize().getValues(),\n      sourceSpacing: sourceImageGeometry.getSpacing().getValues(),\n      sourceOrientation: sourceImageGeometry.getOrientation().getValues(),\n      sourceUnitVectors: sourceUnitVectors,\n      sourceTotalSize: sourceTotalSize,\n\n      // targetImageBuffer: targetImageBuffer,\n      targetOrigin: targetImageGeometry.getOrigin().getValues(),\n      targetSize: targetImageGeometry.getSize().getValues(),\n      targetSpacing: targetImageGeometry.getSpacing().getValues(),\n      targetOrientation: targetImageGeometry.getOrientation().getValues(),\n      targetUnitVectors: targetUnitVectors,\n      targetTotalSize: targetTotalSize,\n\n      pixelRepresentation: pixelRepresentation,\n      interpolate: interpolated,\n      sourceStartOffset: sourceStartOffset,\n      targetStartOffset: targetStartOffset,\n\n      jobId: jobId,\n      frame: frame\n    };\n  };\n\n  if (targetNDims <= 3) {\n    return [generateMessage(0, 0, 0)];\n  } else {\n    const frames = targetSize.get(3);\n    const sourceFrameSize = sourceSize.getDimSize(3);\n    const targetFrameSize = targetSize.getDimSize(3);\n\n    const messages = [];\n    for (let f = 0; f < frames; f++) {\n      const sourceOffset = sourceFrameSize * f;\n      const targetOffset = targetFrameSize * f;\n      messages.push(generateMessage(sourceOffset, targetOffset, f));\n    }\n\n    return messages;\n  }\n}\n\n/**\n * Generate the geometry of the resampled image.\n *\n * @param {Geometry} sourceImageGeometry The current image geometry.\n * @param {Matrix33} targetOrientation The target image orientation.\n * @param {Point|undefined} centerOfRotation World space center of rotation.\n *\n * @returns {Geometry} The new geometry.\n */\nexport function generateResampledGeometry(\n  sourceImageGeometry,\n  targetOrientation,\n  centerOfRotation = undefined\n) {\n  const sourceOrientation = sourceImageGeometry.getOrientation();\n  const invTargetOrientation = targetOrientation.getInverse();\n  const relativeMatrix = invTargetOrientation.multiply(sourceOrientation);\n\n  const sourceSize = sourceImageGeometry.getSize();\n  const sourceSpacing = sourceImageGeometry.getSpacing();\n\n  // Calculate updated spacing\n  //---------------------------------\n  const sourceSpacingArr = sourceSpacing.getValues();\n\n  // Calculate the bounds of the rotated pixel volume\n  const maxSpacingBounds = [0.0, 0.0, 0.0];\n  const minSpacingBounds = [0.0, 0.0, 0.0];\n  for (let x = 0; x <= 1; x++) {\n    for (let y = 0; y <= 1; y++) {\n      for (let z = 0; z <= 1; z++) {\n        const boundPoint = new Point3D(\n          sourceSpacingArr[0] * x,\n          sourceSpacingArr[1] * y,\n          sourceSpacingArr[2] * z,\n        );\n\n        const orientedBoundPoint =\n          relativeMatrix.multiplyPoint3D(boundPoint);\n\n        maxSpacingBounds[0] =\n          Math.max(maxSpacingBounds[0], orientedBoundPoint.getX());\n        maxSpacingBounds[1] =\n          Math.max(maxSpacingBounds[1], orientedBoundPoint.getY());\n        maxSpacingBounds[2] =\n          Math.max(maxSpacingBounds[2], orientedBoundPoint.getZ());\n        minSpacingBounds[0] =\n          Math.min(minSpacingBounds[0], orientedBoundPoint.getX());\n        minSpacingBounds[1] =\n          Math.min(minSpacingBounds[1], orientedBoundPoint.getY());\n        minSpacingBounds[2] =\n          Math.min(minSpacingBounds[2], orientedBoundPoint.getZ());\n      }\n    }\n  }\n\n  const targetSpacingArrMax = [\n    Math.abs(maxSpacingBounds[0] - minSpacingBounds[0]),\n    Math.abs(maxSpacingBounds[1] - minSpacingBounds[1]),\n    Math.abs(maxSpacingBounds[2] - minSpacingBounds[2])\n  ];\n\n  // Maintain the ratio of the new bounds, but the\n  // per pixel volume of the original.\n  const targetSpacingMaxVolume =\n    targetSpacingArrMax[0] *\n    targetSpacingArrMax[1] *\n    targetSpacingArrMax[2];\n\n  const sourceSpacingVolume =\n    sourceSpacingArr[0] *\n    sourceSpacingArr[1] *\n    sourceSpacingArr[2];\n\n  const volumeRatio = Math.cbrt(sourceSpacingVolume / targetSpacingMaxVolume);\n\n  const targetSpacingArr = [\n    targetSpacingArrMax[0] * volumeRatio,\n    targetSpacingArrMax[1] * volumeRatio,\n    targetSpacingArrMax[2] * volumeRatio\n  ];\n\n  const sourceSpacingNDims = sourceSpacing.length();\n  for (let d = 3; d < sourceSpacingNDims; d++) {\n    targetSpacingArr.push(sourceSpacing.get(d));\n  }\n\n  const targetSpacing = new Spacing(targetSpacingArr);\n\n  // Calculate updated size\n  //---------------------------------\n  // The index coords of the bound if the center was at 0,0\n  const boundIndex = [\n    (sourceSize.get(0) / 2.0) * sourceSpacing.get(0),\n    (sourceSize.get(1) / 2.0) * sourceSpacing.get(1),\n    (sourceSize.get(2) / 2.0) * sourceSpacing.get(2),\n  ];\n\n  let firstValue = true;\n  const maxBounds = [0.0, 0.0, 0.0];\n  const minBounds = [0.0, 0.0, 0.0];\n  for (let x = -1; x <= 1; x += 2) {\n    for (let y = -1; y <= 1; y += 2) {\n      for (let z = -1; z <= 1; z += 2) {\n        const boundPoint = new Point3D(\n          boundIndex[0] * x,\n          boundIndex[1] * y,\n          boundIndex[2] * z,\n        );\n\n        const orientedBoundPoint =\n          relativeMatrix.multiplyPoint3D(boundPoint);\n\n        if (firstValue) {\n          maxBounds[0] = orientedBoundPoint.getX();\n          maxBounds[1] = orientedBoundPoint.getY();\n          maxBounds[2] = orientedBoundPoint.getZ();\n          minBounds[0] = orientedBoundPoint.getX();\n          minBounds[1] = orientedBoundPoint.getY();\n          minBounds[2] = orientedBoundPoint.getZ();\n          firstValue = false;\n        } else {\n          maxBounds[0] = Math.max(maxBounds[0], orientedBoundPoint.getX());\n          maxBounds[1] = Math.max(maxBounds[1], orientedBoundPoint.getY());\n          maxBounds[2] = Math.max(maxBounds[2], orientedBoundPoint.getZ());\n          minBounds[0] = Math.min(minBounds[0], orientedBoundPoint.getX());\n          minBounds[1] = Math.min(minBounds[1], orientedBoundPoint.getY());\n          minBounds[2] = Math.min(minBounds[2], orientedBoundPoint.getZ());\n        }\n      }\n    }\n  }\n\n  const sizeArr = [\n    Math.round(\n      Math.abs((maxBounds[0] - minBounds[0]) / targetSpacing.get(0))\n    ),\n    Math.round(\n      Math.abs((maxBounds[1] - minBounds[1]) / targetSpacing.get(1))\n    ),\n    Math.round(\n      Math.abs((maxBounds[2] - minBounds[2]) / targetSpacing.get(2))\n    )\n  ];\n\n  const sourceSizeNDims = sourceSize.length();\n  for (let d = 3; d < sourceSizeNDims; d++) {\n    sizeArr.push(sourceSize.get(d));\n  }\n\n  const targetSize = new Size(sizeArr);\n\n  // Calculate updated origin\n  //---------------------------------\n  // Basic version of the calculation:\n  // (centerTarget*scaleTarget)*orientationTarget + originTarget =\n  //  (centerSource*scaleSource)*orientationSource + originSource\n  // so\n  // oT = (cS*sS)*RS + oS - (cT*sT)*RT\n\n  const sourceCenterIndex =\n    typeof centerOfRotation === 'undefined'\n      ? new Point3D(\n        sourceSize.get(0) / 2.0,\n        sourceSize.get(1) / 2.0,\n        sourceSize.get(2) / 2.0\n      )\n      : sourceImageGeometry.worldToPoint(centerOfRotation);\n\n  const targetCenterIndexArr = [0, 0, 0];\n  if (typeof centerOfRotation === 'undefined') {\n    // Center of rotation === Center of source\n    // Math is much simpler\n    targetCenterIndexArr[0] = targetSize.get(0) / 2.0;\n    targetCenterIndexArr[1] = targetSize.get(1) / 2.0;\n    targetCenterIndexArr[2] = targetSize.get(2) / 2.0;\n\n  } else {\n    const relativeSourceCenterOffsetArr = [\n      (sourceCenterIndex.getX() - (sourceSize.get(0) / 2.0)) *\n      sourceSpacing.get(0),\n      (sourceCenterIndex.getY() - (sourceSize.get(1) / 2.0)) *\n      sourceSpacing.get(1),\n      (sourceCenterIndex.getZ() - (sourceSize.get(2) / 2.0)) *\n      sourceSpacing.get(2)\n    ];\n\n    const relativeTargetCenterOffsetArr =\n      relativeMatrix.multiplyArray3D(relativeSourceCenterOffsetArr);\n\n    targetCenterIndexArr[0] =\n      (relativeTargetCenterOffsetArr[0] / targetSpacing.get(0)) +\n      (targetSize.get(0) / 2.0);\n    targetCenterIndexArr[1] =\n      (relativeTargetCenterOffsetArr[1] / targetSpacing.get(1)) +\n      (targetSize.get(1) / 2.0);\n    targetCenterIndexArr[2] =\n      (relativeTargetCenterOffsetArr[2] / targetSpacing.get(2)) +\n      (targetSize.get(2) / 2.0);\n  }\n\n  const targetCenterIndexSpaced = new Point3D(\n    targetCenterIndexArr[0] * targetSpacing.get(0),\n    targetCenterIndexArr[1] * targetSpacing.get(1),\n    targetCenterIndexArr[2] * targetSpacing.get(2)\n  );\n  const targetCenterPointLocal =\n    targetOrientation.multiplyPoint3D(targetCenterIndexSpaced);\n\n  const sourceCenterPoint =\n    sourceImageGeometry.pointToWorld(sourceCenterIndex);\n\n  const targetOrigin = new Point3D(\n    sourceCenterPoint.getX() - targetCenterPointLocal.getX(),\n    sourceCenterPoint.getY() - targetCenterPointLocal.getY(),\n    sourceCenterPoint.getZ() - targetCenterPointLocal.getZ()\n  );\n\n  const unitVector = [0, 0, targetSpacing.get(2)];\n  const targetUnit = targetOrientation.multiplyArray3D(unitVector);\n\n  const targetOrigins = [];\n  for (let z = 0; z < targetSize.get(2); z++) {\n    targetOrigins.push(new Point3D(\n      targetOrigin.getX() + (targetUnit[0] * z),\n      targetOrigin.getY() + (targetUnit[1] * z),\n      targetOrigin.getZ() + (targetUnit[2] * z)\n    ));\n  }\n\n  return new Geometry(\n    targetOrigins,\n    targetSize,\n    targetSpacing,\n    targetOrientation,\n  );\n}\n\n/**\n * Generate the buffer for the resampled image.\n *\n * @param {TypedArray} sourceImageBuffer The current image buffer.\n * @param {number} pixelRepresentation The source image pixel representation.\n * @param {Size} targetSize The size of the target.\n *\n * @returns {TypedArray} The new buffer.\n */\nexport function generateBuffer(\n  sourceImageBuffer,\n  pixelRepresentation,\n  targetSize\n) {\n  const targetImageBuffer = getTypedArray(\n    sourceImageBuffer.BYTES_PER_ELEMENT * 8,\n    pixelRepresentation,\n    targetSize.getTotalSize()\n  );\n\n  if (targetImageBuffer === null) {\n    throw new Error('Cannot reallocate data for image resampling.');\n  }\n\n  targetImageBuffer.fill(0);\n\n  return targetImageBuffer;\n}\n\n/**\n * Resampling thread.\n */\nexport class ResamplingThread {\n  /**\n   * The thread pool.\n   *\n   * @type {ThreadPool}\n   */\n  #threadPool = new ThreadPool(5);\n\n  constructor() {\n    this.#threadPool.onerror = ((e) => {\n      console.error('Resampling failed!', e.error);\n    });\n  }\n\n  /**\n   * Trigger a resampling.\n   *\n   * @param {TypedArray} sourceImageBuffer The buffer to resample.\n   * @param {Geometry} sourceImageGeometry The current image geometry.\n   * @param {number} pixelRepresentation The pixel representation\n   *  of the original image.\n   * @param {Matrix33} targetOrientation The orientation to resample to.\n   * @param {boolean} interpolated If true use bilinear\n   *  sampling, otherwise use nearest neighbor.\n   * @param {Point|undefined} centerOfRotation World space center of rotation.\n   *\n   * @returns {object} Updated buffer and geometry.\n   */\n  run(\n    sourceImageBuffer,\n    sourceImageGeometry,\n    pixelRepresentation,\n    targetOrientation,\n    interpolated,\n    centerOfRotation = undefined\n  ) {\n    // We can't just pass in an Image or we would get a circular dependency\n\n    // Just needs to be resonably unique\n    const jobId = Date.now() + '' + Math.random();\n\n    const targetImageGeometry =\n      generateResampledGeometry(\n        sourceImageGeometry,\n        targetOrientation,\n        centerOfRotation\n      );\n\n    const targetImageBuffer =\n      generateBuffer(\n        sourceImageBuffer,\n        pixelRepresentation,\n        targetImageGeometry.getSize()\n      );\n\n    const workerMessages =\n      generateWorkerMessages(\n        sourceImageBuffer,\n        sourceImageGeometry,\n        targetImageGeometry,\n        pixelRepresentation,\n        interpolated,\n        jobId\n      );\n\n    this.#threadPool.onworkitem = this.ondoneframe;\n    this.#threadPool.onworkend = this.ondone;\n\n    workerMessages.forEach((workerMessage) => {\n      const workerTask = new ResamplingWorkerTask(workerMessage, {});\n      // add it the queue and run it\n      this.#threadPool.addWorkerTask(workerTask);\n    });\n\n    return {\n      buffer: targetImageBuffer,\n      geometry: targetImageGeometry,\n      jobId: jobId\n    };\n  }\n\n  /**\n   * Handle a completed resampling of a 3D frame. Default behavior is do\n   * nothing, this is meant to be overridden.\n   *\n   * @param {object} _event The work item event fired when a resampling\n   *   calculation is completed.\n   */\n  ondoneframe(_event) {}\n\n  /**\n   * Handle a completed resampling. Default behavior is do nothing,\n   * this is meant to be overridden.\n   *\n   * @param {object} _event The work item event fired when a resampling\n   *   calculation is completed.\n   */\n  ondone(_event) {}\n}","import {Index} from '../math/index.js';\nimport {Point3D} from '../math/point.js';\nimport {logger} from '../utils/logger.js';\nimport {arrayContains} from '../utils/array.js';\nimport {getTypedArray} from '../dicom/dicomParser.js';\nimport {ListenerHandler} from '../utils/listen.js';\nimport {valueRange} from './iterator.js';\nimport {RescaleSlopeAndIntercept} from './rsi.js';\nimport {ImageFactory} from './imageFactory.js';\nimport {MaskFactory} from './maskFactory.js';\nimport {isMonochrome} from '../dicom/dicomImage.js';\nimport {LabelingThread} from './labelingThread.js';\nimport {ResamplingThread} from './resamplingThread.js';\nimport {MAX_CONTOUR_SIZE} from './view.js';\nimport {BooleanResult} from '../utils/result.js';\nimport {equalWl} from './windowLevel.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Geometry} from './geometry.js';\nimport {Matrix33, REAL_WORLD_EPSILON} from '../math/matrix.js';\nimport {NumberRange} from '../math/stats.js';\nimport {DataElement} from '../dicom/dataElement.js';\nimport {RGB} from '../utils/colour.js';\nimport {ColourMap} from './luts.js';\nimport {Point} from '../math/point.js';\nimport {Label} from './label.js';\n/* eslint-enable no-unused-vars */\n\nconst ML_PER_MM = 0.001; // ml/mm^3\n\n\n/**\n * List of image event names.\n *\n * @type {string[]}\n */\nexport const imageEventNames = [\n  'imagecontentchange',\n  'imagegeometrychange',\n  'imageresamplingstart',\n  'imageresamplingcomplete',\n  'imageresampled',\n  'labelingstart',\n  'labelschanged'\n];\n\n/**\n * Get the slice index of an input slice into a volume geometry.\n *\n * @param {Geometry} volumeGeometry The volume geometry.\n * @param {Geometry} sliceGeometry The slice geometry.\n * @returns {Index} The index of the slice in the volume geomtry.\n */\nfunction getSliceIndex(volumeGeometry, sliceGeometry) {\n  // possible time\n  const timeId = sliceGeometry.getInitialTime();\n  // index values\n  const values = [];\n  // x, y\n  values.push(0);\n  values.push(0);\n  // z\n  values.push(volumeGeometry.getSliceIndex(sliceGeometry.getOrigin(), timeId));\n  // time\n  if (typeof timeId !== 'undefined') {\n    values.push(timeId);\n  }\n  // return index\n  return new Index(values);\n}\n\n/**\n * Create an Image from DICOM elements.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {Image} The Image object.\n */\nexport function createImage(elements) {\n  const factory = new ImageFactory();\n  return factory.create(\n    elements,\n    elements['7FE00010'].value[0],\n    1\n  );\n}\n\n/**\n * Create a mask Image from DICOM elements.\n *\n * @param {Object<string, DataElement>} elements The DICOM elements.\n * @returns {Image} The mask Image object.\n */\nexport function createMaskImage(elements) {\n  const factory = new MaskFactory();\n  return factory.create(\n    elements,\n    elements['7FE00010'].value[0]\n  );\n}\n\n/**\n * Image class.\n * Usable once created, optional are:\n * - rescale slope and intercept (default 1:0),\n * - photometric interpretation (default MONOCHROME2),\n * - planar configuration (default RGBRGB...).\n *\n * @example\n * import {DicomParser, createImage} from '//esm.sh/dwv';\n * // XMLHttpRequest onload callback\n * const onload = function (event) {\n *   // parse the dicom buffer\n *   const dicomParser = new DicomParser();\n *   dicomParser.parse(event.target.response);\n *   // create the image object\n *   const image = createImage(dicomParser.getDicomElements());\n *   // result div\n *   const div = document.getElementById('dwv');\n *   // display the image size\n *   const size = image.getGeometry().getSize();\n *   div.appendChild(document.createTextNode(\n *     'Size: ' + size.toString() +\n *     ' (should be 256,256,1)'));\n *   // break line\n *   div.appendChild(document.createElement('br'));\n *   // display a pixel value\n *   div.appendChild(document.createTextNode(\n *     'Pixel @ [128,40,0]: ' +\n *     image.getRescaledValue(128,40,0) +\n *     ' (should be 101)'));\n * };\n * // DICOM file request\n * const request = new XMLHttpRequest();\n * const url = 'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm';\n * request.open('GET', url);\n * request.responseType = 'arraybuffer';\n * request.onload = onload;\n * request.send();\n */\nexport class Image {\n\n  /**\n   * Data geometry.\n   *\n   * @type {Geometry}\n   */\n  #geometry;\n\n  /**\n   * List of compatible typed arrays.\n   *\n   * @typedef {(\n   *   Uint8Array | Int8Array |\n   *   Uint16Array | Int16Array |\n   *   Uint32Array | Int32Array\n   * )} TypedArray\n   */\n\n  /**\n   * Data buffer.\n   *\n   * @type {TypedArray}\n   */\n  #buffer;\n\n  /**\n   * Data contour buffer.\n   * If there is no data contour this is null.\n   *\n   * @type {Uint8Array?}\n   */\n  #contourBuffer;\n\n  /**\n   * Whether the image has been resampled or not.\n   *\n   * @type {boolean}\n   */\n  #resampled;\n\n  /**\n   * The ID of the current resampling job.\n   *\n   * @type {string}\n   */\n  #resamplingJobId;\n\n  /**\n   * Data geometry, unmodified if image is resampled, null otherwise.\n   *\n   * @type {Geometry}\n   */\n  #rawGeometry;\n\n  /**\n   * Data buffer, unmodified if image is resampled, null otherwise.\n   *\n   * @type {TypedArray}\n   */\n  #rawBuffer;\n\n  /**\n   * Image UIDs.\n   *\n   * @type {string[]}\n   */\n  #imageUids;\n\n  /**\n   * Constant rescale slope and intercept (default).\n   *\n   * @type {RescaleSlopeAndIntercept}\n   */\n  #rsi = new RescaleSlopeAndIntercept(1, 0);\n\n  /**\n   * Varying rescale slope and intercept.\n   *\n   * @type {RescaleSlopeAndIntercept[]}\n   */\n  #rsis = null;\n\n  /**\n   * Flag to know if the RSIs are all identity (1,0).\n   *\n   * @type {boolean}\n   */\n  #isIdentityRSI = true;\n\n  /**\n   * Flag to know if the RSIs are all equals.\n   *\n   * @type {boolean}\n   */\n  #isConstantRSI = true;\n\n  /**\n   * Photometric interpretation (MONOCHROME, RGB...).\n   *\n   * @type {string}\n   */\n  #photometricInterpretation = 'MONOCHROME2';\n\n  /**\n   * Palette colour map.\n   *\n   * @type {ColourMap}\n   */\n  #paletteColourMap;\n\n  /**\n   * Planar configuration for RGB data (`0:RGBRGBRGBRGB...` or\n   *   `1:RRR...GGG...BBB...`).\n   *\n   * @type {number}\n   */\n  #planarConfiguration = 0;\n\n  /**\n   * Number of components.\n   *\n   * @type {number}\n   */\n  #numberOfComponents;\n\n  /**\n   * Meta information.\n   *\n   * @type {Object<string, any>}\n   */\n  #meta = {};\n\n  /**\n   * Data range.\n   *\n   * @type {NumberRange}\n   */\n  #dataRange = null;\n\n  /**\n   * Rescaled data range.\n   *\n   * @type {NumberRange}\n   */\n  #rescaledDataRange = null;\n\n  /**\n   * Histogram.\n   *\n   * @type {Array}\n   */\n  #histogram = null;\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * The labeling thread.\n   *\n   * @type {LabelingThread}\n   */\n  #labelingThread;\n\n  /**\n   * The resampling thread.\n   *\n   * @type {ResamplingThread}\n   */\n  #resamplingThread;\n\n  /**\n   * Image complete flag, default to false.\n   *\n   * @type {boolean}\n   */\n  #complete = false;\n\n  /**\n   * @param {Geometry} geometry The geometry of the image.\n   * @param {TypedArray} buffer The image data as a one dimensional buffer.\n   * @param {string[]} [imageUids] An array of Uids indexed to slice number.\n   */\n  constructor(geometry, buffer, imageUids) {\n    this.#geometry = geometry;\n    this.#buffer = buffer;\n    this.#resampled = false;\n    this.#resamplingJobId = '0';\n    this.#rawGeometry = null;\n    this.#rawBuffer = null;\n    this.#contourBuffer = null;\n    this.#imageUids = imageUids;\n    this.#labelingThread = null;\n    this.#resamplingThread = null;\n\n    this.#numberOfComponents = this.#buffer.length / (\n      this.#geometry.getSize().getTotalSize());\n  }\n\n  /**\n   * Set the image complete flag.\n   *\n   * @param {boolean} flag True if the data is complete.\n   */\n  setComplete(flag) {\n    this.#complete = flag;\n    if (flag) {\n      this.#geometry.updateSliceSpacing();\n    }\n  }\n\n  /**\n   * Get the image complete flag.\n   *\n   * @returns {boolean} True if the data is complete.\n   */\n  getComplete() {\n    return this.#complete;\n  }\n\n  /**\n   * Get the image UID at a given index.\n   *\n   * @param {Index} [index] The index at which to get the id.\n   * @returns {string} The UID.\n   */\n  getImageUid(index) {\n    let uid = this.#imageUids[0];\n    if (this.#imageUids.length !== 1 && typeof index !== 'undefined') {\n      uid = this.#imageUids[this.getSecondaryOffset(index)];\n    }\n    return uid;\n  }\n\n  /**\n   * Get the image origin for a image UID.\n   *\n   * @param {string} uid The UID.\n   * @returns {Point3D|undefined} The origin.\n   */\n  getOriginForImageUid(uid) {\n    let origin;\n    const uidIndex = this.#imageUids.indexOf(uid);\n    if (uidIndex !== -1) {\n      const origins = this.getGeometry().getOrigins();\n      origin = origins[uidIndex];\n    }\n    return origin;\n  }\n\n  /**\n   * Check if the image includes an UID.\n   *\n   * @param {string} uid The UID.\n   * @returns {boolean} True if present.\n   */\n  includesImageUid(uid) {\n    return this.#imageUids.includes(uid);\n  }\n\n  /**\n   * Check if this image includes the input uids.\n   *\n   * @param {string[]} uids UIDs to test for presence.\n   * @returns {boolean} True if all uids are in this image uids.\n   */\n  containsImageUids(uids) {\n    return arrayContains(this.#imageUids, uids);\n  }\n\n  /**\n   * Get the geometry of the image.\n   *\n   * @returns {Geometry} The geometry.\n   */\n  getGeometry() {\n    return this.#geometry;\n  }\n\n  /**\n   * Get the data buffer of the image.\n   *\n   * @todo Dangerous...\n   * @returns {TypedArray} The data buffer of the image.\n   */\n  getBuffer() {\n    return this.#buffer;\n  }\n\n  /**\n   * Can the image values be quantified?\n   *\n   * @returns {boolean} True if only one component.\n   */\n  canQuantify() {\n    return this.getNumberOfComponents() === 1;\n  }\n\n  /**\n   * Can window and level be applied to the data?\n   *\n   * @returns {boolean} True if the data is monochrome.\n   * @deprecated Since v0.33, please use isMonochrome instead.\n   */\n  canWindowLevel() {\n    return this.isMonochrome();\n  }\n\n  /**\n   * Is the data monochrome.\n   *\n   * @returns {boolean} True if the data is monochrome.\n   */\n  isMonochrome() {\n    return isMonochrome(this.getPhotometricInterpretation());\n  }\n\n  /**\n   * Can the data be scrolled?\n   *\n   * @param {Matrix33} viewOrientation The view orientation.\n   * @returns {boolean} True if the data has a third dimension greater than one\n   *   after applying the view orientation.\n   */\n  canScroll(viewOrientation) {\n    const size = this.getGeometry().getSize();\n    // also check the numberOfFiles in case we are in the middle of a load\n    let nFiles = 1;\n    if (typeof this.#meta.numberOfFiles !== 'undefined') {\n      nFiles = this.#meta.numberOfFiles;\n    }\n    return size.canScroll(viewOrientation) || nFiles !== 1;\n  }\n\n  /**\n   * Get the secondary offset max.\n   *\n   * @returns {number} The maximum offset.\n   */\n  #getSecondaryOffsetMax() {\n    return this.#geometry.getSize().getTotalSize(2);\n  }\n\n  /**\n   * Get the secondary offset: an offset that takes into account\n   *   the slice and above dimension numbers.\n   *\n   * @param {Index} index The index.\n   * @returns {number} The offset.\n   */\n  getSecondaryOffset(index) {\n    return this.#geometry.getSize().indexToOffset(index, 2);\n  }\n\n  /**\n   * Get the rescale slope and intercept.\n   *\n   * @param {Index} [index] The index (only needed for non constant rsi).\n   * @returns {RescaleSlopeAndIntercept} The rescale slope and intercept.\n   */\n  getRescaleSlopeAndIntercept(index) {\n    let res = this.#rsi;\n    if (!this.isConstantRSI()) {\n      if (typeof index === 'undefined') {\n        throw new Error('Cannot get non constant RSI with empty slice index.');\n      }\n      const offset = this.getSecondaryOffset(index);\n      if (typeof this.#rsis[offset] !== 'undefined') {\n        res = this.#rsis[offset];\n      } else {\n        logger.warn('undefined non constant rsi at ' + offset);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Get the rsi at a specified (secondary) offset.\n   *\n   * @param {number} offset The desired (secondary) offset.\n   * @returns {RescaleSlopeAndIntercept} The coresponding rsi.\n   */\n  #getRescaleSlopeAndInterceptAtOffset(offset) {\n    return this.#rsis[offset];\n  }\n\n  /**\n   * Set the rescale slope and intercept.\n   *\n   * @param {RescaleSlopeAndIntercept} inRsi The input rescale\n   *   slope and intercept.\n   * @param {number} [offset] The rsi offset (only needed for non constant rsi).\n   */\n  setRescaleSlopeAndIntercept(inRsi, offset) {\n    // update identity flag\n    this.#isIdentityRSI = this.#isIdentityRSI && inRsi.isID();\n    // update constant flag\n    if (!this.#isConstantRSI) {\n      if (typeof offset === 'undefined') {\n        throw new Error(\n          'Cannot store non constant RSI with empty slice index.');\n      }\n      this.#rsis.splice(offset, 0, inRsi);\n    } else {\n      if (!this.#rsi.equals(inRsi)) {\n        if (typeof offset === 'undefined') {\n          // no slice index, replace existing\n          this.#rsi = inRsi;\n        } else {\n          // first non constant rsi\n          this.#isConstantRSI = false;\n          // switch to non constant mode\n          this.#rsis = [];\n          // initialise RSIs\n          for (let i = 0, leni = this.#getSecondaryOffsetMax(); i < leni; ++i) {\n            this.#rsis.push(this.#rsi);\n          }\n          // store\n          this.#rsi = null;\n          this.#rsis.splice(offset, 0, inRsi);\n        }\n      }\n    }\n  }\n\n  /**\n   * Are all the RSIs identity (1,0).\n   *\n   * @returns {boolean} True if they are.\n   */\n  isIdentityRSI() {\n    return this.#isIdentityRSI;\n  }\n\n  /**\n   * Are all the RSIs equal.\n   *\n   * @returns {boolean} True if they are.\n   */\n  isConstantRSI() {\n    return this.#isConstantRSI;\n  }\n\n  /**\n   * Get the photometricInterpretation of the image.\n   *\n   * @returns {string} The photometricInterpretation of the image.\n   */\n  getPhotometricInterpretation() {\n    return this.#photometricInterpretation;\n  }\n\n  /**\n   * Set the photometricInterpretation of the image.\n   *\n   * @param {string} interp The photometricInterpretation of the image.\n   */\n  setPhotometricInterpretation(interp) {\n    this.#photometricInterpretation = interp;\n  }\n\n  /**\n   * Set the palette colour map.\n   *\n   * @param {ColourMap} map The colour map.\n   */\n  setPaletteColourMap(map) {\n    this.#paletteColourMap = map;\n    // fire imagecontentchange\n    this.#fireEvent({type: 'imagecontentchange'});\n  }\n\n  /**\n   * Get the palette colour map.\n   *\n   * @returns {ColourMap} The colour map.\n   */\n  getPaletteColourMap() {\n    return this.#paletteColourMap;\n  }\n\n  /**\n   * Update the palette colour map.\n   *\n   * @param {number} index The index to change the colour of.\n   * @param {RGB} colour The colour to use at index.\n   */\n  updatePaletteColourMap(index, colour) {\n    this.#paletteColourMap.red[index] = colour.r;\n    this.#paletteColourMap.green[index] = colour.g;\n    this.#paletteColourMap.blue[index] = colour.b;\n    // fire imagecontentchange\n    this.#fireEvent({type: 'imagecontentchange'});\n  }\n\n  /**\n   * Get the planarConfiguration of the image.\n   *\n   * @returns {number} The planarConfiguration of the image.\n   */\n  getPlanarConfiguration() {\n    return this.#planarConfiguration;\n  }\n\n  /**\n   * Set the planarConfiguration of the image.\n   *\n   * @param {number} config The planarConfiguration of the image.\n   */\n  setPlanarConfiguration(config) {\n    this.#planarConfiguration = config;\n  }\n\n  /**\n   * Get the numberOfComponents of the image.\n   *\n   * @returns {number} The numberOfComponents of the image.\n   */\n  getNumberOfComponents() {\n    return this.#numberOfComponents;\n  }\n\n  /**\n   * Get the meta information of the image.\n   *\n   * @returns {Object<string, any>} The meta information of the image.\n   */\n  getMeta() {\n    return this.#meta;\n  }\n\n  /**\n   * Set the meta information of the image.\n   *\n   * @param {Object<string, any>} rhs The meta information of the image.\n   */\n  setMeta(rhs) {\n    this.#meta = rhs;\n  }\n\n  /**\n   * Get value at offset. Warning: No size check...\n   *\n   * @param {number} offset The desired offset.\n   * @returns {number} The value at offset.\n   */\n  getValueAtOffset(offset) {\n    return this.#buffer[offset];\n  }\n\n  /**\n   * Get the offsets where the buffer equals the input value.\n   * Loops through the whole volume, can get long for big data...\n   *\n   * @param {number|RGB} value The value to check.\n   * @returns {number[]} The list of offsets.\n   */\n  getOffsets(value) {\n    // value to array\n    let bufferValue;\n    if (typeof value === 'number') {\n      if (this.#numberOfComponents !== 1) {\n        throw new Error(\n          'Number of components is not 1 for getting single value.');\n      }\n      bufferValue = [value];\n    } else if (typeof value.r !== 'undefined' &&\n      typeof value.g !== 'undefined' &&\n      typeof value.b !== 'undefined') {\n      if (this.#numberOfComponents !== 3) {\n        throw new Error(\n          'Number of components is not 3 for getting RGB value.');\n      }\n      bufferValue = [value.r, value.g, value.b];\n    }\n\n    // main loop\n    const offsets = [];\n    let equal;\n    for (let i = 0; i < this.#buffer.length; i = i + this.#numberOfComponents) {\n      equal = true;\n      for (let j = 0; j < this.#numberOfComponents; ++j) {\n        if (this.#buffer[i + j] !== bufferValue[j]) {\n          equal = false;\n          break;\n        }\n      }\n      if (equal) {\n        offsets.push(i);\n      }\n    }\n    return offsets;\n  }\n\n  /**\n   * Check if the input values are in the buffer.\n   * Could loop through the whole volume, can get long for big data...\n   *\n   * @param {Array} values The values to check.\n   * @returns {boolean[]} A list of booleans for each input value,\n   *   set to true if the value is present in the buffer.\n   */\n  hasValues(values) {\n    // check input\n    if (typeof values === 'undefined' ||\n      values.length === 0) {\n      return [];\n    }\n    // final array value\n    const finalValues = [];\n    for (let v1 = 0; v1 < values.length; ++v1) {\n      if (this.#numberOfComponents === 1) {\n        finalValues.push([values[v1]]);\n      } else if (this.#numberOfComponents === 3) {\n        finalValues.push([\n          values[v1].r,\n          values[v1].g,\n          values[v1].b\n        ]);\n      }\n    }\n    // find callback\n    let equalFunc;\n    if (this.#numberOfComponents === 1) {\n      equalFunc = function (a, b) {\n        return a[0] === b[0];\n      };\n    } else if (this.#numberOfComponents === 3) {\n      equalFunc = function (a, b) {\n        return a[0] === b[0] &&\n          a[1] === b[1] &&\n          a[2] === b[2];\n      };\n    }\n    const getEqualCallback = function (value) {\n      return function (item) {\n        return equalFunc(item, value);\n      };\n    };\n    // main loop\n    const res = new Array(values.length);\n    res.fill(false);\n    const valuesToFind = finalValues.slice();\n    let equal;\n    let indicesToRemove;\n    for (let i = 0, leni = this.#buffer.length;\n      i < leni; i = i + this.#numberOfComponents) {\n      indicesToRemove = [];\n      for (let v = 0; v < valuesToFind.length; ++v) {\n        equal = true;\n        // check value(s)\n        for (let j = 0; j < this.#numberOfComponents; ++j) {\n          if (this.#buffer[i + j] !== valuesToFind[v][j]) {\n            equal = false;\n            break;\n          }\n        }\n        // if found, store answer and add to indices to remove\n        if (equal) {\n          const valIndex = finalValues.findIndex(\n            getEqualCallback(valuesToFind[v]));\n          res[valIndex] = true;\n          indicesToRemove.push(v);\n        }\n      }\n      // remove found values\n      for (let r = 0; r < indicesToRemove.length; ++r) {\n        valuesToFind.splice(indicesToRemove[r], 1);\n      }\n      // exit if no values to find\n      if (valuesToFind.length === 0) {\n        break;\n      }\n    }\n    // return\n    return res;\n  }\n\n  /**\n   * Clone the image.\n   *\n   * @returns {Image} A clone of this image.\n   */\n  clone() {\n    // clone the image buffer\n    const clonedBuffer = this.#buffer.slice(0);\n    // create the image copy\n    const copy = new Image(\n      this.getGeometry().clone(), clonedBuffer, this.#imageUids);\n    // copy the RSI(s)\n    if (this.isConstantRSI()) {\n      copy.setRescaleSlopeAndIntercept(this.getRescaleSlopeAndIntercept());\n    } else {\n      for (let i = 0; i < this.#getSecondaryOffsetMax(); ++i) {\n        copy.setRescaleSlopeAndIntercept(\n          this.#getRescaleSlopeAndInterceptAtOffset(i), i);\n      }\n    }\n    // copy extras\n    copy.setPhotometricInterpretation(this.getPhotometricInterpretation());\n    copy.setPlanarConfiguration(this.getPlanarConfiguration());\n    copy.setPaletteColourMap(structuredClone(this.#paletteColourMap));\n    copy.setMeta(structuredClone(this.getMeta()));\n    // return\n    return copy;\n  }\n\n  /**\n   * Re-allocate buffer memory to an input size.\n   *\n   * @param {number} size The new size.\n   */\n  #realloc(size) {\n    // save buffer\n    let tmpBuffer = this.#buffer;\n    // create new\n    this.#buffer = getTypedArray(\n      this.#buffer.BYTES_PER_ELEMENT * 8,\n      this.#meta.PixelRepresentation,\n      size);\n    if (this.#buffer === null) {\n      throw new Error('Cannot reallocate data for image.');\n    }\n    // put old in new\n    this.#buffer.set(tmpBuffer);\n\n    // clean\n    tmpBuffer = null;\n  }\n\n  /**\n   * Re-allocate buffer memory to an input size.\n   *\n   * @param {number} size The new size.\n   */\n  #reallocContour(size) {\n    let tmpBuffer = this.#contourBuffer;\n    this.#contourBuffer = new Uint8Array(size);\n    this.#contourBuffer.set(tmpBuffer);\n    tmpBuffer = null;\n  }\n\n  /**\n   * Check if another image can be appended to this one.\n   *\n   * @param {Image} rhs The image to check.\n   * @returns {BooleanResult} Result with success set to true if\n   *   the image can be appended.\n   */\n  canAppend(rhs) {\n    // check input\n    if (rhs === null) {\n      return {\n        success: false,\n        message: 'Cannot append null slice'\n      };\n    }\n\n    // check geometry\n    const geoCanAppend = this.#geometry.canAppend(rhs.getGeometry());\n    if (!geoCanAppend.success) {\n      return geoCanAppend;\n    }\n\n    if (this.#photometricInterpretation !==\n      rhs.getPhotometricInterpretation()) {\n      return {\n        success: false,\n        message:\n          'Cannot append a slice with different photometric interpretation'\n      };\n    }\n    // all meta should be equal\n    for (const key in this.#meta) {\n      if (\n        key === 'windowPresets' ||\n        key === 'numberOfFiles' ||\n        key === 'custom'\n      ) {\n        continue;\n      }\n\n      if (this.#meta[key] !== rhs.getMeta()[key]) {\n        const message = 'Cannot append a slice with different ' + key +\n          ': ' + this.#meta[key] + ' != ' + rhs.getMeta()[key];\n        return {\n          success: false,\n          message\n        };\n      }\n    }\n\n    return new BooleanResult(true);\n  }\n\n  /**\n   * Append a slice to the image.\n   *\n   * @param {Image} rhs The slice to append.\n   * @fires Image#imagegeometrychange\n   */\n  appendSlice(rhs) {\n    // check if possible\n    const canAppend = this.canAppend(rhs);\n    if (!canAppend.success) {\n      throw new Error(canAppend.message);\n    }\n\n    // update ranges\n    const rhsRange = rhs.getDataRange();\n    const range = this.getDataRange();\n    this.#dataRange = {\n      min: Math.min(rhsRange.min, range.min),\n      max: Math.max(rhsRange.max, range.max),\n    };\n    const rhsResRange = rhs.getRescaledDataRange();\n    const resRange = this.getRescaledDataRange();\n    this.#rescaledDataRange = {\n      min: Math.min(rhsResRange.min, resRange.min),\n      max: Math.max(rhsResRange.max, resRange.max),\n    };\n\n    let size = this.getGeometry().getSize();\n\n    // possible time\n    const timeId = rhs.getGeometry().getInitialTime();\n\n    // append frame if needed\n    let isNewFrame = false;\n    if (typeof timeId !== 'undefined' &&\n      !this.#geometry.hasSlicesAtTime(timeId)) {\n      // update grometry\n      this.appendFrame(timeId, rhs.getGeometry().getOrigin());\n      // update size\n      size = this.#geometry.getSize();\n      // update flag\n      isNewFrame = true;\n    }\n\n    // get slice index\n    const index = getSliceIndex(this.#geometry, rhs.getGeometry());\n\n    // calculate slice size\n    const sliceSize = this.#numberOfComponents * size.getDimSize(2);\n\n    // create full buffer if not done yet\n    if (typeof this.#meta.numberOfFiles === 'undefined') {\n      throw new Error('Missing number of files for buffer manipulation.');\n    }\n    const fullBufferSize = sliceSize * this.#meta.numberOfFiles;\n    if (this.#buffer.length !== fullBufferSize) {\n      this.#realloc(fullBufferSize);\n\n      if (this.#contourBuffer !== null) {\n        const contourSize = size.getDimSize(2) * 3 * this.#meta.numberOfFiles;\n        this.#reallocContour(contourSize);\n      }\n    }\n\n    // slice index\n    const sliceIndex = index.get(2);\n\n    // slice index including possible 4D\n    let fullSliceIndex = sliceIndex;\n    if (typeof timeId !== 'undefined') {\n      fullSliceIndex +=\n        this.#geometry.getCurrentNumberOfSlicesBeforeTime(timeId);\n    }\n    // offset of the input slice\n    const indexOffset = fullSliceIndex * sliceSize;\n    const totalSlices = this.#geometry.getCurrentTotalNumberOfSlices();\n    const maxOffset = totalSlices * sliceSize;\n    // move content if needed\n    if (indexOffset < maxOffset) {\n      this.#buffer.set(\n        this.#buffer.subarray(indexOffset, maxOffset),\n        indexOffset + sliceSize\n      );\n\n      if (this.#contourBuffer !== null) {\n        const contourSliceSize = size.getDimSize(2) * 3;\n        const contourIndexOffset = fullSliceIndex * contourSliceSize;\n        const contourMaxOffset = totalSlices * contourSliceSize;\n        this.#contourBuffer.set(\n          this.#contourBuffer.subarray(contourIndexOffset, contourMaxOffset),\n          contourIndexOffset + contourSliceSize\n        );\n      }\n    }\n    // add new slice content\n    this.#buffer.set(rhs.getBuffer(), indexOffset);\n\n    // update geometry\n    if (!isNewFrame) {\n      this.#geometry.appendOrigin(\n        rhs.getGeometry().getOrigin(), sliceIndex, timeId);\n    }\n    // update rsi\n    // (rhs should just have one rsi)\n    this.setRescaleSlopeAndIntercept(\n      rhs.getRescaleSlopeAndIntercept(), fullSliceIndex);\n\n    // current number of images\n    const numberOfImages = this.#imageUids.length;\n\n    // insert sop instance UIDs\n    this.#imageUids.splice(fullSliceIndex, 0, rhs.getImageUid());\n\n    // update window presets\n    if (typeof this.#meta.windowPresets !== 'undefined') {\n      const windowPresets = this.#meta.windowPresets;\n      const rhsPresets = rhs.getMeta().windowPresets;\n      const keys = Object.keys(rhsPresets);\n      let pkey = null;\n      for (let i = 0; i < keys.length; ++i) {\n        pkey = keys[i];\n        const rhsPreset = rhsPresets[pkey];\n        const windowPreset = windowPresets[pkey];\n        if (typeof windowPreset !== 'undefined') {\n          // if not set or false, check perslice\n          if (typeof windowPreset.perslice === 'undefined' ||\n            windowPreset.perslice === false) {\n            // if different preset.wl, mark it as perslice\n            if (!equalWl(windowPreset.wl[0], rhsPreset.wl[0])) {\n              windowPreset.perslice = true;\n              // fill wl array with copy of wl[0]\n              // (loop on number of images minus the existing one)\n              for (let j = 0; j < numberOfImages - 1; ++j) {\n                windowPreset.wl.push(windowPreset.wl[0]);\n              }\n            }\n          }\n          // store (first) rhs preset.wl if needed\n          if (typeof windowPreset.perslice !== 'undefined' &&\n            windowPreset.perslice === true) {\n            windowPresets[pkey].wl.splice(\n              fullSliceIndex, 0, rhsPreset.wl[0]);\n          }\n        } else {\n          // if not defined (it should be), store all\n          windowPresets[pkey] = rhsPresets[pkey];\n        }\n      }\n    }\n    /**\n     * Image geometry change event.\n     *\n     * @event Image#imagegeometrychange\n     * @type {object}\n     * @property {string} type The event type.\n     */\n    this.#fireEvent({\n      type: 'imagegeometrychange'\n    });\n  }\n\n  /**\n   * Append a frame buffer to the image.\n   *\n   * @param {object} frameBuffer The frame buffer to append.\n   * @param {number} frameIndex The frame index.\n   */\n  appendFrameBuffer(frameBuffer, frameIndex) {\n    // create full buffer if not done yet\n    const size = this.#geometry.getSize();\n    const frameSize = this.#numberOfComponents * size.getDimSize(2);\n    if (typeof this.#meta.numberOfFiles === 'undefined') {\n      throw new Error('Missing number of files for frame buffer manipulation.');\n    }\n    const fullBufferSize = frameSize * this.#meta.numberOfFiles;\n    if (this.#buffer.length !== fullBufferSize) {\n      this.#realloc(fullBufferSize);\n\n      if (this.#contourBuffer !== null) {\n        const contourSize = size.getDimSize(2) * 3 * this.#meta.numberOfFiles;\n        this.#reallocContour(contourSize);\n      }\n    }\n    // check index\n    if (frameIndex >= this.#meta.numberOfFiles) {\n      logger.warn('Ignoring frame at index ' + frameIndex +\n        ' (size: ' + this.#meta.numberOfFiles + ')');\n      return;\n    }\n    // append\n    this.#buffer.set(frameBuffer, frameSize * frameIndex);\n    // update geometry\n    this.appendFrame(frameIndex, new Point3D(0, 0, 0));\n  }\n\n  /**\n   * Append a frame to the image.\n   *\n   * @param {number} time The frame time value.\n   * @param {Point3D} origin The origin of the frame.\n   */\n  appendFrame(time, origin) {\n    this.#geometry.appendFrame(origin, time);\n    /**\n     * Append frame event.\n     *\n     * @event Image#appendframe\n     * @type {object}\n     * @property {string} type The event type.\n     */\n    this.#fireEvent({\n      type: 'appendframe'\n    });\n    // memory will be updated at the first appendSlice or appendFrameBuffer\n  }\n\n  /**\n   * Get the data range.\n   *\n   * @returns {NumberRange} The data range.\n   */\n  getDataRange() {\n    if (!this.#dataRange) {\n      this.#dataRange = this.calculateDataRange();\n    }\n    return this.#dataRange;\n  }\n\n  /**\n   * Get the rescaled data range.\n   *\n   * @returns {NumberRange} The rescaled data range.\n   */\n  getRescaledDataRange() {\n    if (!this.#rescaledDataRange) {\n      this.#rescaledDataRange = this.calculateRescaledDataRange();\n    }\n    return this.#rescaledDataRange;\n  }\n\n  /**\n   * Get the histogram.\n   *\n   * @returns {Array} The histogram.\n   */\n  getHistogram() {\n    if (!this.#histogram) {\n      const res = this.calculateHistogram();\n      this.#dataRange = res.dataRange;\n      this.#rescaledDataRange = res.rescaledDataRange;\n      this.#histogram = res.histogram;\n    }\n    return this.#histogram;\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    this.#listenerHandler.fireEvent(event);\n  };\n\n  // ****************************************\n  // image data modifiers... carefull...\n  // ****************************************\n\n  /**\n   * Set the inner buffer values at given offsets.\n   *\n   * @param {number[]} offsets List of offsets where to set the data.\n   * @param {number|RGB} value The value to set at the given offsets.\n   * @fires Image#imagecontentchange\n   */\n  setAtOffsets(offsets, value) {\n    // value to array\n    let bufferValue;\n    if (typeof value === 'number') {\n      if (this.#numberOfComponents !== 1) {\n        throw new Error(\n          'Number of components is not 1 for setting single value.');\n      }\n      bufferValue = [value];\n    } else if (typeof value.r !== 'undefined' &&\n      typeof value.g !== 'undefined' &&\n      typeof value.b !== 'undefined') {\n      if (this.#numberOfComponents !== 3) {\n        throw new Error(\n          'Number of components is not 3 for setting RGB value.');\n      }\n      bufferValue = [value.r, value.g, value.b];\n    }\n\n    let offset;\n    for (let i = 0, leni = offsets.length; i < leni; ++i) {\n      offset = offsets[i];\n      for (let j = 0; j < this.#numberOfComponents; ++j) {\n        this.#buffer[offset + j] = bufferValue[j];\n      }\n    }\n    // fire imagecontentchange\n    this.#fireEvent({type: 'imagecontentchange'});\n  }\n\n  /**\n   * Reset the contour buffer for the values at an offset.\n   *\n   * @param {number} offset The offset to reset.\n   */\n  #resetContourAtOffset(offset) {\n    if (this.#contourBuffer !== null) {\n      this.#contourBuffer[offset * 3] = 0;\n      this.#contourBuffer[(offset * 3) + 1] = 0;\n      this.#contourBuffer[(offset * 3) + 2] = 0;\n    }\n  }\n\n  /**\n   * Reset the contour buffer for the values around an offset.\n   * Prevents certain artifacts, especially at small brush sizes\n   * and when erasing.\n   *\n   * @param {number} offset The offset to reset.\n   */\n  #resetContourAroundOffset(offset) {\n    this.#resetContourAtOffset(offset);\n\n    const size = this.#geometry.getSize();\n    const xOffset = size.getDimSize(0);\n    const yOffset = size.getDimSize(1);\n    const zOffset = size.getDimSize(2);\n\n    const max = MAX_CONTOUR_SIZE / 2;\n    const min = -max;\n    for (let x = min; x < max; x++) {\n      for (let y = min; y < max; y++) {\n        for (let z = min; z < max; z++) {\n          const p =\n            offset +\n            (xOffset * x) +\n            (yOffset * y) +\n            (zOffset * z);\n          if (p >= 0 && p < this.#buffer.length) {\n            this.#resetContourAtOffset(p);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Set the inner buffer values at given offsets.\n   *\n   * @param {number[][]} offsetsLists List of offset lists where\n   *   to set the data.\n   * @param {number} value The value to set at the given offsets.\n   * @returns {Array} A list of objects representing the original values before\n   *  replacing them.\n   * @fires Image#imagecontentchange\n   */\n  setAtOffsetsAndGetOriginals(offsetsLists, value) {\n    const originalValuesLists = [];\n\n    // update and store\n    for (let j = 0; j < offsetsLists.length; ++j) {\n      const offsets = offsetsLists[j];\n      // first value\n      let offset = offsets[0];\n      let previousValue = this.#buffer[offset];\n      // original value storage\n      const originalValues = [];\n      originalValues.push({\n        index: 0,\n        value: previousValue\n      });\n      for (let i = 0; i < offsets.length; ++i) {\n        offset = offsets[i];\n        const currentValue = this.#buffer[offset];\n        // check if new value\n        if (previousValue !== currentValue) {\n          // store new value\n          originalValues.push({\n            index: i,\n            value: currentValue\n          });\n          previousValue = currentValue;\n        }\n        // write update value\n        this.#buffer[offset] = value;\n        this.#resetContourAroundOffset(offset);\n      }\n      originalValuesLists.push(originalValues);\n    }\n    // fire imagecontentchange\n    this.#fireEvent({type: 'imagecontentchange'});\n    return originalValuesLists;\n  }\n\n  /**\n   * Set the inner buffer values at given offsets.\n   *\n   * @param {number[][]} offsetsLists List of offset lists\n   *   where to set the data.\n   * @param {number|Array} value The value to set at the given offsets.\n   * @fires Image#imagecontentchange\n   */\n  setAtOffsetsWithIterator(offsetsLists, value) {\n    const isValueArray = Array.isArray(value);\n\n    for (let j = 0; j < offsetsLists.length; ++j) {\n      const offsets = offsetsLists[j];\n      let iterator;\n      if (isValueArray) {\n        // input value is a list of iterators\n        // created by setAtOffsetsAndGetOriginals\n        iterator = valueRange(\n          value[j], offsets.length);\n      } else {\n        // input value is a simple color\n        iterator = valueRange(\n          [{index: 0, value: value}], offsets.length);\n      }\n\n      // set values\n      let ival = iterator.next();\n      while (!ival.done) {\n        const offset = offsets[ival.index];\n        this.#buffer[offset] = ival.value;\n        this.#resetContourAroundOffset(offset);\n        ival = iterator.next();\n      }\n    }\n    /**\n     * Image content change event.\n     *\n     * @event Image#imagecontentchange\n     * @type {object}\n     * @property {string} type The event type.\n     */\n    this.#fireEvent({type: 'imagecontentchange'});\n  }\n\n  /**\n   * Get the value of the image at a specific coordinate.\n   *\n   * @param {number} i The X index.\n   * @param {number} j The Y index.\n   * @param {number} k The Z index.\n   * @param {number} [f] Optional frame number.\n   * @returns {number} The value at the desired position.\n   * Warning: No size check...\n   */\n  getValue(i, j, k, f) {\n    const values = [i, j, k];\n    if (typeof f !== 'undefined') {\n      values.push(f);\n    }\n    const index = new Index(values);\n    return this.getValueAtOffset(\n      this.getGeometry().getSize().indexToOffset(index));\n  }\n\n  /**\n   * Get the value of the image at a specific index.\n   *\n   * @param {Index} index The index.\n   * @returns {number} The value at the desired position.\n   * Warning: No size check...\n   */\n  getValueAtIndex(index) {\n    return this.getValueAtOffset(\n      this.getGeometry().getSize().indexToOffset(index));\n  }\n\n  /**\n   * Get the rescaled value of the image at a specific position.\n   *\n   * @param {number} i The X index.\n   * @param {number} j The Y index.\n   * @param {number} k The Z index.\n   * @param {number} [f] Optional frame number.\n   * @returns {number} The rescaled value at the desired position.\n   * Warning: No size check...\n   */\n  getRescaledValue(i, j, k, f) {\n    let val = this.getValue(i, j, k, f);\n    if (!this.isIdentityRSI()) {\n      if (this.isConstantRSI()) {\n        val = this.getRescaleSlopeAndIntercept().apply(val);\n      } else {\n        const values = [i, j, k];\n        if (typeof f !== 'undefined') {\n          values.push(f);\n        }\n        const index = new Index(values);\n        val = this.getRescaleSlopeAndIntercept(index).apply(val);\n      }\n    }\n    return val;\n  }\n\n  /**\n   * Get the rescaled value of the image at a specific index.\n   *\n   * @param {Index} index The index.\n   * @returns {number} The rescaled value at the desired position.\n   * Warning: No size check...\n   */\n  getRescaledValueAtIndex(index) {\n    return this.getRescaledValueAtOffset(\n      this.getGeometry().getSize().indexToOffset(index)\n    );\n  }\n\n  /**\n   * Get the rescaled value of the image at a specific offset.\n   *\n   * @param {number} offset The desired offset.\n   * @returns {number} The rescaled value at the desired offset.\n   * Warning: No size check...\n   */\n  getRescaledValueAtOffset(offset) {\n    let val = this.getValueAtOffset(offset);\n    if (!this.isIdentityRSI()) {\n      if (this.isConstantRSI()) {\n        val = this.getRescaleSlopeAndIntercept().apply(val);\n      } else {\n        const index = this.getGeometry().getSize().offsetToIndex(offset);\n        val = this.getRescaleSlopeAndIntercept(index).apply(val);\n      }\n    }\n    return val;\n  }\n\n  /**\n   * Calculate the data range of the image.\n   * WARNING: for speed reasons, only calculated on the first frame...\n   *\n   * @returns {object} The range {min, max}.\n   */\n  calculateDataRange() {\n    let min = this.getValueAtOffset(0);\n    let max = min;\n    let value = 0;\n    const size = this.getGeometry().getSize();\n    let leni = size.getTotalSize();\n    // max to 3D\n    if (size.length() >= 3) {\n      leni = size.getDimSize(3);\n    }\n    for (let i = 0; i < leni; ++i) {\n      value = this.getValueAtOffset(i);\n      if (value > max) {\n        max = value;\n      }\n      if (value < min) {\n        min = value;\n      }\n    }\n    // return\n    return {min: min, max: max};\n  }\n\n  /**\n   * Calculate the rescaled data range of the image.\n   * WARNING: for speed reasons, only calculated on the first frame...\n   *\n   * @returns {object} The range {min, max}.\n   */\n  calculateRescaledDataRange() {\n    if (this.isIdentityRSI()) {\n      return this.getDataRange();\n    } else if (this.isConstantRSI()) {\n      const range = this.getDataRange();\n      const resmin = this.getRescaleSlopeAndIntercept().apply(range.min);\n      const resmax = this.getRescaleSlopeAndIntercept().apply(range.max);\n      return {\n        min: ((resmin < resmax) ? resmin : resmax),\n        max: ((resmin > resmax) ? resmin : resmax)\n      };\n    } else {\n      let rmin = this.getRescaledValueAtOffset(0);\n      let rmax = rmin;\n      let rvalue = 0;\n      const size = this.getGeometry().getSize();\n      let leni = size.getTotalSize();\n      // max to 3D\n      if (size.length() === 3) {\n        leni = size.getDimSize(3);\n      }\n      for (let i = 0; i < leni; ++i) {\n        rvalue = this.getRescaledValueAtOffset(i);\n        if (rvalue > rmax) {\n          rmax = rvalue;\n        }\n        if (rvalue < rmin) {\n          rmin = rvalue;\n        }\n      }\n      // return\n      return {min: rmin, max: rmax};\n    }\n  }\n\n  /**\n   * Calculate the histogram of the image.\n   *\n   * @returns {object} The histogram, data range and rescaled data range.\n   */\n  calculateHistogram() {\n    const size = this.getGeometry().getSize();\n    const histo = [];\n    let min = this.getValueAtOffset(0);\n    let max = min;\n    let value = 0;\n    let rmin = this.getRescaledValueAtOffset(0);\n    let rmax = rmin;\n    let rvalue = 0;\n    for (let i = 0, leni = size.getTotalSize(); i < leni; ++i) {\n      value = this.getValueAtOffset(i);\n      if (value > max) {\n        max = value;\n      }\n      if (value < min) {\n        min = value;\n      }\n      rvalue = this.getRescaledValueAtOffset(i);\n      if (rvalue > rmax) {\n        rmax = rvalue;\n      }\n      if (rvalue < rmin) {\n        rmin = rvalue;\n      }\n      histo[rvalue] = (histo[rvalue] || 0) + 1;\n    }\n    // set data range\n    const dataRange = {min: min, max: max};\n    const rescaledDataRange = {min: rmin, max: rmax};\n    // generate data for plotting\n    const histogram = [];\n    for (let b = rmin; b <= rmax; ++b) {\n      histogram.push([b, (histo[b] || 0)]);\n    }\n    // return\n    return {\n      dataRange: dataRange,\n      rescaledDataRange: rescaledDataRange,\n      histogram: histogram\n    };\n  }\n\n  /**\n   * Convolute the image with a given 2D kernel.\n   *\n   * Note: Uses raw buffer values.\n   *\n   * @param {number[]} weights The weights of the 2D kernel as a 3x3 matrix.\n   * @returns {Image} The convoluted image.\n   */\n  convolute2D(weights) {\n    if (weights.length !== 9) {\n      throw new Error(\n        'The convolution matrix does not have a length of 9; it has ' +\n        weights.length);\n    }\n\n    const newImage = this.clone();\n    const newBuffer = newImage.getBuffer();\n\n    const imgSize = this.getGeometry().getSize();\n    const dimOffset = imgSize.getDimSize(2) * this.getNumberOfComponents();\n    for (let k = 0; k < imgSize.get(2); ++k) {\n      this.convoluteBuffer(weights, newBuffer, k * dimOffset);\n    }\n\n    return newImage;\n  }\n\n  /**\n   * Convolute an image buffer with a given 2D kernel.\n   *\n   * Note: Uses raw buffer values.\n   *\n   * @param {number[]} weights The weights of the 2D kernel as a 3x3 matrix.\n   * @param {TypedArray} buffer The buffer to convolute.\n   * @param {number} startOffset The index to start at.\n   */\n  convoluteBuffer(\n    weights, buffer, startOffset) {\n    const imgSize = this.getGeometry().getSize();\n    const ncols = imgSize.get(0);\n    const nrows = imgSize.get(1);\n    const ncomp = this.getNumberOfComponents();\n\n    // number of component and planar configuration vars\n    let factor = 1;\n    let componentOffset = 1;\n    if (ncomp === 3) {\n      if (this.getPlanarConfiguration() === 0) {\n        factor = 3;\n      } else {\n        componentOffset = imgSize.getDimSize(2);\n      }\n    }\n\n    // default weight offset matrix\n    const wOff = [];\n    wOff[0] = (-ncols - 1) * factor;\n    wOff[1] = (-ncols) * factor;\n    wOff[2] = (-ncols + 1) * factor;\n    wOff[3] = -factor;\n    wOff[4] = 0;\n    wOff[5] = 1 * factor;\n    wOff[6] = (ncols - 1) * factor;\n    wOff[7] = (ncols) * factor;\n    wOff[8] = (ncols + 1) * factor;\n\n    // border weight offset matrices\n    // borders are extended (see http://en.wikipedia.org/wiki/Kernel_%28image_processing%29)\n\n    /* eslint-disable @stylistic/js/max-statements-per-line */\n\n    // i=0, j=0\n    const wOff00 = [];\n    wOff00[0] = wOff[4]; wOff00[1] = wOff[4]; wOff00[2] = wOff[5];\n    wOff00[3] = wOff[4]; wOff00[4] = wOff[4]; wOff00[5] = wOff[5];\n    wOff00[6] = wOff[7]; wOff00[7] = wOff[7]; wOff00[8] = wOff[8];\n    // i=0, j=*\n    const wOff0x = [];\n    wOff0x[0] = wOff[1]; wOff0x[1] = wOff[1]; wOff0x[2] = wOff[2];\n    wOff0x[3] = wOff[4]; wOff0x[4] = wOff[4]; wOff0x[5] = wOff[5];\n    wOff0x[6] = wOff[7]; wOff0x[7] = wOff[7]; wOff0x[8] = wOff[8];\n    // i=0, j=nrows\n    const wOff0n = [];\n    wOff0n[0] = wOff[1]; wOff0n[1] = wOff[1]; wOff0n[2] = wOff[2];\n    wOff0n[3] = wOff[4]; wOff0n[4] = wOff[4]; wOff0n[5] = wOff[5];\n    wOff0n[6] = wOff[4]; wOff0n[7] = wOff[4]; wOff0n[8] = wOff[5];\n\n    // i=*, j=0\n    const wOffx0 = [];\n    wOffx0[0] = wOff[3]; wOffx0[1] = wOff[4]; wOffx0[2] = wOff[5];\n    wOffx0[3] = wOff[3]; wOffx0[4] = wOff[4]; wOffx0[5] = wOff[5];\n    wOffx0[6] = wOff[6]; wOffx0[7] = wOff[7]; wOffx0[8] = wOff[8];\n    // i=*, j=* -> wOff\n    // i=*, j=nrows\n    const wOffxn = [];\n    wOffxn[0] = wOff[0]; wOffxn[1] = wOff[1]; wOffxn[2] = wOff[2];\n    wOffxn[3] = wOff[3]; wOffxn[4] = wOff[4]; wOffxn[5] = wOff[5];\n    wOffxn[6] = wOff[3]; wOffxn[7] = wOff[4]; wOffxn[8] = wOff[5];\n\n    // i=ncols, j=0\n    const wOffn0 = [];\n    wOffn0[0] = wOff[3]; wOffn0[1] = wOff[4]; wOffn0[2] = wOff[4];\n    wOffn0[3] = wOff[3]; wOffn0[4] = wOff[4]; wOffn0[5] = wOff[4];\n    wOffn0[6] = wOff[6]; wOffn0[7] = wOff[7]; wOffn0[8] = wOff[7];\n    // i=ncols, j=*\n    const wOffnx = [];\n    wOffnx[0] = wOff[0]; wOffnx[1] = wOff[1]; wOffnx[2] = wOff[1];\n    wOffnx[3] = wOff[3]; wOffnx[4] = wOff[4]; wOffnx[5] = wOff[4];\n    wOffnx[6] = wOff[6]; wOffnx[7] = wOff[7]; wOffnx[8] = wOff[7];\n    // i=ncols, j=nrows\n    const wOffnn = [];\n    wOffnn[0] = wOff[0]; wOffnn[1] = wOff[1]; wOffnn[2] = wOff[1];\n    wOffnn[3] = wOff[3]; wOffnn[4] = wOff[4]; wOffnn[5] = wOff[4];\n    wOffnn[6] = wOff[3]; wOffnn[7] = wOff[4]; wOffnn[8] = wOff[4];\n\n    /* eslint-enable @stylistic/js/max-statements-per-line */\n\n    // loop vars\n    let pixelOffset = startOffset;\n    let newValue = 0;\n    let wOffFinal = [];\n    for (let c = 0; c < ncomp; ++c) {\n      // component offset\n      pixelOffset += c * componentOffset;\n      for (let j = 0; j < nrows; ++j) {\n        for (let i = 0; i < ncols; ++i) {\n          wOffFinal = wOff;\n          // special border cases\n          if (i === 0 && j === 0) {\n            wOffFinal = wOff00;\n          } else if (i === 0 && j === (nrows - 1)) {\n            wOffFinal = wOff0n;\n          } else if (i === (ncols - 1) && j === 0) {\n            wOffFinal = wOffn0;\n          } else if (i === (ncols - 1) && j === (nrows - 1)) {\n            wOffFinal = wOffnn;\n          } else if (i === 0 && j !== (nrows - 1) && j !== 0) {\n            wOffFinal = wOff0x;\n          } else if (i === (ncols - 1) && j !== (nrows - 1) && j !== 0) {\n            wOffFinal = wOffnx;\n          } else if (i !== 0 && i !== (ncols - 1) && j === 0) {\n            wOffFinal = wOffx0;\n          } else if (i !== 0 && i !== (ncols - 1) && j === (nrows - 1)) {\n            wOffFinal = wOffxn;\n          }\n          // calculate the weighed sum of the source image pixels that\n          // fall under the convolution matrix\n          newValue = 0;\n          for (let wi = 0; wi < 9; ++wi) {\n            newValue += this.getValueAtOffset(\n              pixelOffset + wOffFinal[wi]) * weights[wi];\n          }\n          buffer[pixelOffset] = newValue;\n          // increment pixel offset\n          pixelOffset += factor;\n        }\n      }\n    }\n  }\n\n  /**\n   * Transform an image using a specific operator.\n   * WARNING: no size check!\n   *\n   * @param {Function} operator The operator to use when transforming.\n   * @returns {Image} The transformed image.\n   * Note: Uses the raw buffer values.\n   */\n  transform(operator) {\n    const newImage = this.clone();\n    const newBuffer = newImage.getBuffer();\n    for (let i = 0, leni = newBuffer.length; i < leni; ++i) {\n      newBuffer[i] = operator(newImage.getValueAtOffset(i));\n    }\n    return newImage;\n  }\n\n  /**\n   * Compose this image with another one and using a specific operator.\n   * WARNING: no size check!\n   *\n   * @param {Image} rhs The image to compose with.\n   * @param {Function} operator The operator to use when composing.\n   * @returns {Image} The composed image.\n   * Note: Uses the raw buffer values.\n   */\n  compose(rhs, operator) {\n    const newImage = this.clone();\n    const newBuffer = newImage.getBuffer();\n    for (let i = 0, leni = newBuffer.length; i < leni; ++i) {\n      // using the operator on the local buffer, i.e. the\n      // latest (not original) data\n      newBuffer[i] = Math.floor(\n        operator(this.getValueAtOffset(i), rhs.getValueAtOffset(i))\n      );\n    }\n    return newImage;\n  }\n\n  /**\n   * Initialize the contour buffer.\n   * Should be called on every segmentation image, or any image where\n   * contour rendering needs to be supported.\n   */\n  initializeContour() {\n    this.#contourBuffer = new Uint8Array(this.#buffer.length * 3);\n  }\n\n  /**\n   * Get whether or not the contour buffer has been initialized.\n   *\n   * @returns {boolean} True if buffer has been initialized.\n   */\n  countourIsInitialized() {\n    return this.#contourBuffer !== null;\n  }\n\n  /**\n   * Move cursor a step in the X direction to check for border pixels.\n   *\n   * @param {number} distance Accumulated distance travelled.\n   * @param {number} index Current cursor index before moving.\n   * @param {number} direction Offset to move cursor.\n   * @param {number} dim The index of the current dimension.\n   * @param {number} checkValue Initial pixel value.\n   * @param {Function[]} queue Ordered queue of locations to check.\n   * @returns {Function} A function that returns the distance to the nearest\n   *  border pixel or 0.\n   */\n  #recursiveDistanceCheckX(distance, index, direction, dim, checkValue, queue) {\n    return () => {\n      const newIndex = index + direction;\n      const newDistance = distance + 1;\n\n      const size = this.#geometry.getSize();\n      const borderCheck = size.offsetToIndex(newIndex);\n\n      if (\n        newIndex >= this.#buffer.length ||\n        newIndex < 0 ||\n        borderCheck.get(dim) === 0 ||\n        borderCheck.get(dim) === size.get(dim) - 1 ||\n        newDistance === 255\n      ) {\n        return newDistance;\n      }\n\n      if (newDistance > MAX_CONTOUR_SIZE) {\n        return 255;\n      }\n\n      if (this.#buffer[newIndex] !== checkValue) {\n        return newDistance;\n      } else {\n        queue.push(this.#recursiveDistanceCheckX(\n          newDistance,\n          newIndex,\n          direction,\n          dim,\n          checkValue,\n          queue\n        ));\n\n        return 0;\n      }\n    };\n  }\n\n  /**\n   * Move cursor a step in the Y direction to check for border pixels.\n   * Also spawns two new cursors checking in the X directions to either side.\n   *\n   * @param {number} distance Accumulated distance travelled.\n   * @param {number} index Current cursor index before moving.\n   * @param {number} yDirection Offset to move cursor.\n   * @param {number} xDirection Offset to move cursor.\n   * @param {number} yDim The index of the y dimension.\n   * @param {number} xDim The index of the x dimension.\n   * @param {number} checkValue Initial pixel value.\n   * @param {Function[]} queue Ordered queue of locations to check.\n   * @returns {Function} A function that returns the distance to the nearest\n   *  border pixel or 0.\n   */\n  #recursiveDistanceCheckY(\n    distance,\n    index,\n    yDirection,\n    xDirection,\n    yDim,\n    xDim,\n    checkValue,\n    queue\n  ) {\n    return () => {\n      const newIndex = index + yDirection;\n      const newDistance = distance + 1;\n\n      const size = this.#geometry.getSize();\n      const borderCheck = size.offsetToIndex(newIndex);\n\n      if (\n        newIndex >= this.#buffer.length ||\n        newIndex < 0 ||\n        borderCheck.get(yDim) === 0 ||\n        borderCheck.get(yDim) === size.get(yDim) - 1 ||\n        newDistance === 255\n      ) {\n        return newDistance;\n      }\n\n      if (newDistance > MAX_CONTOUR_SIZE) {\n        return 255;\n      }\n\n      if (this.#buffer[newIndex] !== checkValue) {\n        return newDistance;\n      } else {\n        queue.push(this.#recursiveDistanceCheckX(\n          newDistance,\n          newIndex,\n          xDirection,\n          xDim,\n          checkValue,\n          queue\n        ));\n\n        queue.push(this.#recursiveDistanceCheckX(\n          newDistance,\n          newIndex,\n          -xDirection,\n          xDim,\n          checkValue,\n          queue\n        ));\n\n        queue.push(this.#recursiveDistanceCheckY(\n          newDistance,\n          newIndex,\n          yDirection,\n          xDirection,\n          yDim,\n          xDim,\n          checkValue,\n          queue\n        ));\n\n        return 0;\n      }\n    };\n  }\n\n  /**\n   * Calculate the distance to the nearest border pixel.\n   * (or return the cached distance).\n   *\n   * @param {number} index Index/offset of the pixel to check.\n   * @param {Matrix33} viewOrientation The orientation of the view.\n   * @returns {number} The distance to the nearest border pixel or 0.\n   */\n  getContourDistance(index, viewOrientation) {\n    if (this.#contourBuffer === null) {\n      // Contour not enabled\n      return 0;\n    }\n\n    const orientationIndex = viewOrientation.getThirdColMajorDirection();\n\n    const xDim = (orientationIndex + 1) % 3;\n    const yDim = (orientationIndex + 2) % 3;\n\n    const contourIndex = index * 3 + orientationIndex;\n\n    const bufferedDistance = this.#contourBuffer[contourIndex];\n    if (bufferedDistance > 0) {\n      return bufferedDistance;\n    }\n\n    const checkValue = this.#buffer[index];\n    const operationQueue = [];\n\n    const size = this.#geometry.getSize();\n    const yDimSize = size.getDimSize(yDim);\n    const xDimSize = size.getDimSize(xDim);\n\n    operationQueue.push(this.#recursiveDistanceCheckY(\n      0,\n      index,\n      yDimSize,\n      xDimSize,\n      yDim,\n      xDim,\n      checkValue,\n      operationQueue\n    ));\n\n    operationQueue.push(this.#recursiveDistanceCheckX(\n      0,\n      index,\n      xDimSize,\n      xDim,\n      checkValue,\n      operationQueue\n    ));\n\n    operationQueue.push(this.#recursiveDistanceCheckX(\n      0,\n      index,\n      -xDimSize,\n      xDim,\n      checkValue,\n      operationQueue\n    ));\n\n    operationQueue.push(this.#recursiveDistanceCheckY(\n      0,\n      index,\n      -yDimSize,\n      xDimSize,\n      yDim,\n      xDim,\n      checkValue,\n      operationQueue\n    ));\n\n    let opCount = 0;\n    // Enough to check every square up to MAX_CONTOUR_SIZE\n    const maxOps = Math.pow(MAX_CONTOUR_SIZE, 2);\n    while (operationQueue.length > 0) {\n      opCount++;\n      if (opCount > maxOps) {\n        this.#contourBuffer[contourIndex] = 255;\n        return 255;\n      }\n\n      const operation = operationQueue.shift();\n      const distanceCheck = operation();\n\n      if (distanceCheck > 0) {\n        // Return the first valid distance we find\n        this.#contourBuffer[contourIndex] = distanceCheck;\n        return distanceCheck;\n      }\n    }\n\n    // Something has gone wrong\n    return Infinity;\n  }\n\n  /**\n   * Recalculate labels.\n   */\n  recalculateLabels() {\n    if (this.#labelingThread === null) {\n      this.#labelingThread = new LabelingThread();\n\n      const spacing = this.#geometry.getSpacing();\n      const lengthUnit = this.getMeta().lengthUnit;\n      let pixelVolume = 1;\n      let volumeUnit = 'unit.pixel';\n      if (lengthUnit === 'unit.mm') {\n        pixelVolume =\n          spacing.get(0) *\n          spacing.get(1) *\n          spacing.get(2) *\n          ML_PER_MM;\n        volumeUnit = 'unit.ml';\n      }\n\n      this.#labelingThread.ondone = (event) => {\n        const labels = event.data.labels;\n        // add centroid point and volume\n        for (const label of labels) {\n          label.centroid = this.#geometry.indexToWorld(\n            new Index(label.centroidIndex));\n          label.volume = {\n            value: label.count * pixelVolume,\n            unit: volumeUnit\n          };\n          // diameters should be already in the correct units\n          let majorDiameter;\n          let minorDiameter;\n          if (typeof label.diameters !== 'undefined') {\n            if (typeof label.diameters.major !== 'undefined') {\n              majorDiameter = label.diameters.major.diameter;\n            }\n            if (typeof label.diameters.minor !== 'undefined') {\n              minorDiameter = label.diameters.minor.diameter;\n            }\n          }\n          label.diameters = {\n            major: {\n              diameter: {\n                value: majorDiameter,\n                unit: lengthUnit\n              }\n            },\n            minor: {\n              diameter: {\n                value: minorDiameter,\n                unit: lengthUnit\n              }\n            }\n          };\n          label.height = {\n            value: label.height,\n            unit: lengthUnit\n          };\n        }\n        // sort\n        /** @type {Label[]} */\n        const labelsSorted =\n          labels.sort((v1, v2) => {\n            return v2.volume.value - v1.volume.value;\n          }).sort((v1, v2) => {\n            return v1.id - v2.id;\n          });\n\n        this.#fireEvent({\n          type: 'labelschanged',\n          labels: labelsSorted\n        });\n\n        //TODO: This is temporary until a proper method of displaying\n        // diameters is implmented.\n        // ------\n        if (event.data.buffer) {\n          this.#buffer = event.data.buffer;\n          this.#fireEvent({type: 'imagecontentchange'});\n        }\n        // ------\n      };\n    }\n\n    this.#fireEvent({type: 'labelingstart'});\n\n    this.#labelingThread.run(this.#buffer, this.#geometry);\n  }\n\n  /**\n   * Return if this image has been resampled.\n   *\n   * @returns {boolean} If the image has been resampled.\n   */\n  isResampled() {\n    return this.#resampled;\n  }\n\n  /**\n   * Resample this image to a new orientation.\n   *\n   * @param {Matrix33} orientation The orientation to resample to.\n   * @param {boolean|undefined} interpolated Default true, if true use bilinear\n   *  sampling, otherwise use nearest neighbor.\n   * @param {Point|undefined} centerOfRotation World space center of rotation.\n   */\n  resample(\n    orientation,\n    interpolated = undefined,\n    centerOfRotation = undefined\n  ) {\n    if (this.#resamplingThread === null) {\n      this.#resamplingThread = new ResamplingThread();\n\n      this.#resamplingThread.ondoneframe = (event) => {\n        const data = event.data;\n\n        // In case multiple resampled jobs are running at the same time,\n        // we only care about the most recent one.\n        if (this.#resamplingJobId === data.jobId) {\n          this.#buffer.set(data.targetImageBuffer, data.startOffset);\n          this.#fireEvent({type: 'imageresampled', frame: data.frame});\n        }\n      };\n\n      this.#resamplingThread.ondone = (_) => {\n        this.#fireEvent({type: 'imageresamplingcomplete'});\n      };\n    }\n\n    // If we were already resampled then resample again from the\n    // original to not degrade the data\n\n    const source = this.#resampled && this.#rawBuffer && this.#rawGeometry\n      ? {buffer: this.#rawBuffer, geometry: this.#rawGeometry}\n      : {buffer: this.#buffer, geometry: this.#geometry};\n\n    this.#fireEvent({type: 'imageresamplingstart'});\n\n    const resampled = this.#resamplingThread.run(\n      source.buffer,\n      source.geometry,\n      this.#meta.PixelRepresentation,\n      orientation,\n      typeof interpolated === 'undefined' || interpolated,\n      centerOfRotation\n    );\n\n    // if the image is already resampled we don't want to override the raw\n    if (!this.#resampled) {\n      this.#resampled = true;\n      this.#rawBuffer = this.#buffer;\n      this.#rawGeometry = this.#geometry;\n    }\n\n    this.#buffer = resampled.buffer;\n    this.#geometry = resampled.geometry;\n    this.#resamplingJobId = resampled.jobId;\n\n    this.#fireEvent({type: 'imagecontentchange'});\n    this.#fireEvent({type: 'imagegeometrychange'});\n  }\n\n  /**\n   * Revert a resampled image to its original state.\n   */\n  revert() {\n    if (!this.#resampled) {\n      return;\n    }\n\n    this.#fireEvent({type: 'imageresamplingstart'});\n\n    this.#resampled = false;\n    this.#buffer = this.#rawBuffer;\n    this.#geometry = this.#rawGeometry;\n    this.#rawBuffer = null;\n    this.#rawGeometry = null;\n\n    this.#fireEvent({type: 'imagecontentchange'});\n    this.#fireEvent({type: 'imagegeometrychange'});\n    this.#fireEvent({type: 'imageresampled'});\n  }\n\n} // class Image\n","import {logger} from '../utils/logger.js';\nimport {ListenerHandler} from '../utils/listen.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Annotation} from './annotation.js';\nimport {ViewController} from '../app/viewController.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * List of annotation group event names.\n *\n * @type {string[]}\n */\nexport const annotationGroupEventNames = [\n  'annotationgroupeditablechange',\n  'annotationadd',\n  'annotationupdate',\n  'annotationremove'\n];\n\n/**\n * Annotation group.\n */\nexport class AnnotationGroup {\n  /**\n   * @type {Annotation[]}\n   */\n  #list;\n\n  /**\n   * Annotation meta data.\n   *\n   * @type {Object<string, any>}\n   */\n  #meta = {};\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Editable flag.\n   *\n   * @type {boolean}\n   */\n  #editable;\n\n  /**\n   * Group colour as hex string. If defined, it will be used as\n   *   default colour for new annotations in draw tool.\n   *\n   * @type {string|undefined}\n   */\n  #colour;\n\n  /**\n   * @param {Annotation[]} [list] Optional list, will\n   *   create new if not provided.\n   */\n  constructor(list) {\n    if (typeof list !== 'undefined') {\n      this.#list = list;\n    } else {\n      this.#list = [];\n    }\n    this.#editable = true;\n  }\n\n  /**\n   * Get the annotation group as an array.\n   *\n   * @returns {Annotation[]} The array.\n   */\n  getList() {\n    return this.#list;\n  }\n\n  /**\n   * Get the number of annotations of this list.\n   *\n   * @returns {number} The number of annotations.\n   */\n  getLength() {\n    return this.#list.length;\n  }\n\n  /**\n   * Check if the annotation group is editable.\n   *\n   * @returns {boolean} True if editable.\n   */\n  isEditable() {\n    return this.#editable;\n  }\n\n  /**\n   * Set the annotation group editability.\n   *\n   * @param {boolean} flag True to make the annotation group editable.\n   */\n  setEditable(flag) {\n    this.#editable = flag;\n    /**\n     * Annotation group editable flag change event.\n     *\n     * @event AnnotationGroup#annotationgroupeditablechange\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {boolean} data The value of the editable flag.\n     */\n    this.#fireEvent({\n      type: 'annotationgroupeditablechange',\n      data: flag\n    });\n  }\n\n  /**\n   * Get the group colour.\n   *\n   * @returns {string} The colour as hex string.\n   */\n  getColour() {\n    return this.#colour;\n  }\n\n  /**\n   * Set the group colour.\n   *\n   * @param {string} colour The colour as hex string.\n   */\n  setColour(colour) {\n    this.#colour = colour;\n  }\n\n  /**\n   * Add a new annotation.\n   *\n   * @param {Annotation} annotation The annotation to add.\n   * @param {boolean} [propagate] Whether the event propagates\n   *   outside of dwv or not, defaults to true.\n   */\n  add(annotation, propagate) {\n    this.#list.push(annotation);\n    /**\n     * Annotation add event.\n     *\n     * @event AnnotationGroup#annotationadd\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {Annotation} data The added annnotation.\n     */\n    this.#fireEvent({\n      type: 'annotationadd',\n      data: annotation,\n      propagate: propagate\n    });\n  }\n\n  /**\n   * Update an existing annotation.\n   *\n   * @param {Annotation} annotation The annotation to update.\n   * @param {string[]} [propKeys] Optional properties that got updated.\n   * @param {boolean} [propagate] Whether the event propagates\n   *   outside of dwv or not, defaults to true.\n   */\n  update(annotation, propKeys, propagate) {\n    const index = this.#list.findIndex(\n      (item) => item.trackingUid === annotation.trackingUid);\n    if (index !== -1) {\n      // update quantification if needed\n      if (propKeys.includes('mathShape') ||\n        propKeys.includes('textExpr')) {\n        annotation.updateQuantification();\n      }\n      // update list\n      this.#list[index] = annotation;\n      /**\n       * Annotation update event.\n       *\n       * @event AnnotationGroup#annotationupdate\n       * @type {object}\n       * @property {string} type The event type.\n       * @property {Annotation} data The added annnotation.\n       * @property {string[]} keys The properties that were updated.\n       */\n      this.#fireEvent({\n        type: 'annotationupdate',\n        data: annotation,\n        keys: propKeys,\n        propagate: propagate\n      });\n    } else {\n      logger.warn('Cannot find annotation to update');\n    }\n  }\n\n  /**\n   * Remove an annotation.\n   *\n   * @param {string} uid The UID of the annotation to remove.\n   * @param {boolean} [propagate] Whether the event propagates\n   *   outside of dwv or not, defaults to true.\n   */\n  remove(uid, propagate) {\n    const index = this.#list.findIndex(\n      (item) => item.trackingUid === uid);\n    if (index !== -1) {\n      const annotation = this.#list.splice(index, 1)[0];\n      /**\n       * Annotation update event.\n       *\n       * @event AnnotationGroup#annotationremove\n       * @type {object}\n       * @property {string} type The event type.\n       * @property {Annotation} data The added annnotation.\n       * @property {string[]} keys The properties that were updated.\n       */\n      this.#fireEvent({\n        type: 'annotationremove',\n        data: annotation,\n        propagate: propagate\n      });\n    } else {\n      logger.warn('Cannot find annotation to remove');\n    }\n  }\n\n  /**\n   * Set the associated view controller.\n   *\n   * @param {ViewController} viewController The associated view controller.\n   */\n  setViewController(viewController) {\n    for (const item of this.#list) {\n      item.setViewController(viewController);\n      item.updateQuantification();\n    }\n  }\n\n  /**\n   * Find an annotation.\n   *\n   * @param {string} uid The UID of the annotation to find.\n   * @returns {Annotation|undefined} The found annotation.\n   */\n  find(uid) {\n    return this.#list.find((item) => item.trackingUid === uid);\n  }\n\n  /**\n   * Get the meta data.\n   *\n   * @returns {Object<string, any>} The meta data.\n   */\n  getMeta() {\n    return this.#meta;\n  }\n\n  /**\n   * Check if this list contains a meta data value.\n   *\n   * @param {string} key The key to check.\n   * @returns {boolean} True if the meta data is present.\n   */\n  hasMeta(key) {\n    return typeof this.#meta[key] !== 'undefined';\n  }\n\n  /**\n   * Get a meta data value.\n   *\n   * @param {string} key The meta data key.\n   * @returns {string|object|undefined} The meta data value.\n   */\n  getMetaValue(key) {\n    return this.#meta[key];\n  }\n\n  /**\n   * Set a meta data.\n   *\n   * @param {string} key The meta data key.\n   * @param {string|object} value The value of the meta data.\n   */\n  setMetaValue(key, value) {\n    this.#meta[key] = value;\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    this.#listenerHandler.fireEvent(event);\n  };\n}\n","import {\n  getCode,\n  getDicomCodeItem\n} from './dicomCode.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\nimport {DicomCode} from './dicomCode.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  NumericValue: '0040A30A',\n  FloatingPointValue: '0040A161',\n  RationalNumeratorValue: '0040A162',\n  RationalDenominatorValue: '0040A163',\n  MeasurementUnitsCodeSequence: '004008EA'\n};\n\n/**\n * DICOM measured value: property of a numeric measurement.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.18.html#table_C.18.1-1}.\n */\nexport class MeasuredValue {\n  /**\n   * @type {number}\n   */\n  numericValue;\n\n  /**\n   * @type {number}\n   */\n  floatingPointValue;\n\n  /**\n   * @type {number}\n   */\n  rationalNumeratorValue;\n\n  /**\n   * @type {number}\n   */\n  rationalDenominatorValue;\n\n  /**\n   * @type {DicomCode}\n   */\n  measurementUnitsCode;\n\n  /**\n   * Get a string representation of this object.\n   *\n   * @returns {string} The object as string.\n   */\n  toString() {\n    return this.numericValue + ' ' +\n      this.measurementUnitsCode.toString();\n  };\n\n};\n\n/**\n * Get a measured value object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {MeasuredValue} A measured value object.\n */\nexport function getMeasuredValue(dataElements) {\n  const value = new MeasuredValue();\n\n  if (typeof dataElements[TagKeys.NumericValue] !== 'undefined') {\n    value.numericValue =\n      parseFloat(dataElements[TagKeys.NumericValue].value[0]);\n  }\n  if (typeof dataElements[TagKeys.FloatingPointValue] !== 'undefined') {\n    value.floatingPointValue =\n      parseFloat(dataElements[TagKeys.FloatingPointValue].value[0]);\n  }\n  if (typeof dataElements[TagKeys.RationalNumeratorValue] !== 'undefined') {\n    value.rationalNumeratorValue =\n      parseInt(dataElements[TagKeys.RationalNumeratorValue].value[0], 10);\n  }\n  if (typeof dataElements[TagKeys.RationalDenominatorValue] !== 'undefined') {\n    value.rationalDenominatorValue =\n      parseInt(dataElements[TagKeys.RationalDenominatorValue].value[0], 10);\n  }\n  if (typeof dataElements[TagKeys.MeasurementUnitsCodeSequence] !==\n    'undefined') {\n    value.measurementUnitsCode = getCode(\n      dataElements[TagKeys.MeasurementUnitsCodeSequence].value[0]);\n  }\n\n  return value;\n};\n\n/**\n * Get a simple dicom element item from a measured value object.\n *\n * @param {MeasuredValue} value The measured value object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomMeasuredValueItem(value) {\n  // dicom item (tags are in group/element order)\n  const item = {};\n\n  if (typeof value.measurementUnitsCode !== 'undefined') {\n    item.MeasurementUnitsCodeSequence = {\n      value: [getDicomCodeItem(value.measurementUnitsCode)]\n    };\n  }\n  if (typeof value.floatingPointValue !== 'undefined') {\n    item.FloatingPointValue = value.floatingPointValue;\n  }\n  if (typeof value.rationalNumeratorValue !== 'undefined') {\n    item.RationalNumeratorValue = value.rationalNumeratorValue;\n  }\n  if (typeof value.rationalDenominatorValue !== 'undefined') {\n    item.RationalDenominatorValue = value.rationalDenominatorValue;\n  }\n  if (typeof value.numericValue !== 'undefined') {\n    item.NumericValue = value.numericValue;\n  }\n\n  // return\n  return item;\n}\n","import {\n  getCode,\n  getDicomCodeItem\n} from './dicomCode.js';\nimport {\n  getMeasuredValue,\n  getDicomMeasuredValueItem\n} from './dicomMeasuredValue.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\nimport {MeasuredValue} from './dicomMeasuredValue.js';\nimport {DicomCode} from './dicomCode.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  MeasuredValueSequence: '0040A300',\n  NumericValueQualifierCodeSequence: '0040A301'\n};\n\n/**\n * DICOM numeric measurement: item of a SR content sequence.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.18.html#table_C.18.1-1}.\n */\nexport class NumericMeasurement {\n  /**\n   * @type {MeasuredValue|undefined}\n   */\n  measuredValue;\n\n  /**\n   * @type {DicomCode|undefined}\n   */\n  numericValueQualifierCode;\n\n  /**\n   * Get a string representation of this object.\n   *\n   * @returns {string} The object as string.\n   */\n  toString() {\n    let res = '';\n    if (typeof this.measuredValue !== 'undefined') {\n      res += this.measuredValue.toString();\n    }\n    if (typeof this.numericValueQualifierCode !== 'undefined') {\n      res += ' ' + this.numericValueQualifierCode.toString();\n    }\n    return res;\n  }\n};\n\n/**\n * Get a measurement object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {NumericMeasurement} A measurement object.\n */\nexport function getNumericMeasurement(dataElements) {\n  const measurement = new NumericMeasurement();\n\n  if (typeof dataElements[TagKeys.MeasuredValueSequence] !== 'undefined') {\n    measurement.measuredValue = getMeasuredValue(\n      dataElements[TagKeys.MeasuredValueSequence].value[0]);\n  }\n  if (typeof dataElements[TagKeys.NumericValueQualifierCodeSequence] !==\n    'undefined') {\n    measurement.numericValueQualifierCode = getCode(\n      dataElements[TagKeys.NumericValueQualifierCodeSequence].value[0]);\n  }\n\n  return measurement;\n};\n\n/**\n * Get a simple dicom element item from a measurement object.\n *\n * @param {NumericMeasurement} measurement The measurement object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomNumericMeasurementItem(measurement) {\n  // dicom item (tags are in group/element order)\n  const item = {};\n\n  if (typeof measurement.measuredValue !== 'undefined') {\n    item.MeasuredValueSequence = {\n      value: [getDicomMeasuredValueItem(measurement.measuredValue)]\n    };\n  }\n  if (typeof measurement.numericValueQualifierCode !== 'undefined') {\n    item.NumericValueQualifierCodeSequence = {\n      value: [getDicomCodeItem(measurement.numericValueQualifierCode)]\n    };\n  }\n\n  // return\n  return item;\n}\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  ReferencedSOPClassUID: '00081150',\n  ReferencedSOPInstanceUID: '00081155'\n};\n\n/**\n * DICOM sop instance reference.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_10.8.html#table_10-11}.\n */\nexport class SopInstanceReference {\n  /**\n   * @type {string}\n   */\n  referencedSOPClassUID;\n\n  /**\n   * @type {string}\n   */\n  referencedSOPInstanceUID;\n\n  /**\n   * Get a string representation of this object.\n   *\n   * @returns {string} The object as string.\n   */\n  toString() {\n    return this.referencedSOPInstanceUID + ' (class: ' +\n      this.referencedSOPClassUID + ')';\n  };\n};\n\n/**\n * Get a SOP reference object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {SopInstanceReference} A SOP reference object.\n */\nexport function getSopInstanceReference(dataElements) {\n  const ref = new SopInstanceReference();\n\n  if (typeof dataElements[TagKeys.ReferencedSOPClassUID] !== 'undefined') {\n    ref.referencedSOPClassUID =\n      dataElements[TagKeys.ReferencedSOPClassUID].value[0];\n  }\n  if (typeof dataElements[TagKeys.ReferencedSOPInstanceUID] !== 'undefined') {\n    ref.referencedSOPInstanceUID =\n      dataElements[TagKeys.ReferencedSOPInstanceUID].value[0];\n  }\n\n  return ref;\n};\n\n/**\n * Get a simple dicom element item from a SOP reference object.\n *\n * @param {SopInstanceReference} ref The SOP reference object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomSopInstanceReferenceItem(ref) {\n  // dicom item (tags are in group/element order)\n  const item = {};\n\n  if (typeof ref.referencedSOPClassUID !== 'undefined') {\n    item.ReferencedSOPClassUID = ref.referencedSOPClassUID;\n  }\n  if (typeof ref.referencedSOPInstanceUID !== 'undefined') {\n    item.ReferencedSOPInstanceUID = ref.referencedSOPInstanceUID;\n  }\n\n  // return\n  return item;\n}\n","import {\n  getSopInstanceReference,\n  getDicomSopInstanceReferenceItem\n} from './dicomSopInstanceReference.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\nimport {SopInstanceReference} from './dicomSopInstanceReference.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  ReferencedFrameNumber: '00081160',\n  ReferencedSOPSequence: '00081199',\n  ReferencedSegmentNumber: '0062000B'\n};\n\n/**\n * DICOM image reference: item of a SR content sequence.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.18.4.html#table_C.18.4-1}.\n */\nexport class ImageReference {\n  /**\n   * @type {SopInstanceReference}\n   */\n  referencedSOPSequence;\n\n  /**\n   * @type {string}\n   */\n  referencedFrameNumber;\n\n  /**\n   * @type {string}\n   */\n  referencedSegmentNumber;\n\n  /**\n   * Get a string representation of this object.\n   *\n   * @returns {string} The object as string.\n   */\n  toString() {\n    let res = this.referencedSOPSequence.toString();\n    if (typeof this.referencedFrameNumber !== 'undefined') {\n      res += ', frame: ' + this.referencedFrameNumber;\n    }\n    return res;\n  };\n};\n\n/**\n * Get a reference object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {ImageReference} A reference object.\n */\nexport function getImageReference(dataElements) {\n  const ref = new ImageReference();\n\n  if (typeof dataElements[TagKeys.ReferencedFrameNumber] !== 'undefined') {\n    ref.referencedFrameNumber =\n      dataElements[TagKeys.ReferencedFrameNumber].value[0];\n  }\n  if (typeof dataElements[TagKeys.ReferencedSOPSequence] !== 'undefined') {\n    ref.referencedSOPSequence = getSopInstanceReference(\n      dataElements[TagKeys.ReferencedSOPSequence].value[0]);\n  }\n  if (typeof dataElements[TagKeys.ReferencedSegmentNumber] !== 'undefined') {\n    ref.referencedSegmentNumber =\n      dataElements[TagKeys.ReferencedSegmentNumber].value[0];\n  }\n\n  return ref;\n};\n\n/**\n * Get a simple dicom element item from a reference object.\n *\n * @param {ImageReference} ref The reference object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomImageReferenceItem(ref) {\n  // dicom item (tags are in group/element order)\n  const item = {};\n\n  if (typeof ref.referencedFrameNumber !== 'undefined') {\n    item.ReferencedFrameNumber = ref.referencedFrameNumber;\n  }\n  if (typeof ref.referencedSOPSequence !== 'undefined') {\n    item.ReferencedSOPSequence = {\n      value: [getDicomSopInstanceReferenceItem(ref.referencedSOPSequence)]\n    };\n  }\n  if (typeof ref.referencedSegmentNumber !== 'undefined') {\n    item.ReferencedSegmentNumber =\n      ref.referencedSegmentNumber;\n  }\n\n  // return\n  return item;\n}\n","import {Point2D} from './point.js';\nimport {\n  isSimilar,\n  REAL_WORLD_EPSILON,\n} from './matrix.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {ViewController} from '../app/viewController.js';\nimport {Scalar2D} from './scalar.js';\nimport {Value} from './value.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Line shape.\n */\nexport class Line {\n\n  /**\n   * Line begin point.\n   *\n   * @type {Point2D}\n   */\n  #begin;\n\n  /**\n   * Line end point.\n   *\n   * @type {Point2D}\n   */\n  #end;\n\n  /**\n   * @param {Point2D} begin A Point2D representing the beginning\n   *   of the line.\n   * @param {Point2D} end A Point2D representing the end of the line.\n   */\n  constructor(begin, end) {\n    this.#begin = begin;\n    this.#end = end;\n  }\n\n  /**\n   * Get the begin point of the line.\n   *\n   * @returns {Point2D} The beginning point of the line.\n   */\n  getBegin() {\n    return this.#begin;\n  }\n\n  /**\n   * Get the end point of the line.\n   *\n   * @returns {Point2D} The ending point of the line.\n   */\n  getEnd() {\n    return this.#end;\n  }\n\n  /**\n   * Check for equality.\n   *\n   * @param {Line} rhs The object to compare to.\n   * @returns {boolean} True if both objects are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      this.getBegin().equals(rhs.getBegin()) &&\n      this.getEnd().equals(rhs.getEnd());\n  }\n\n  /**\n   * Get the line delta in the X direction.\n   *\n   * @returns {number} The delta in the X direction.\n   */\n  getDeltaX() {\n    return this.getEnd().getX() - this.getBegin().getX();\n  }\n\n  /**\n   * Get the line delta in the Y direction.\n   *\n   * @returns {number} The delta in the Y direction.\n   */\n  getDeltaY() {\n    return this.getEnd().getY() - this.getBegin().getY();\n  }\n\n  /**\n   * Get the length of the line.\n   *\n   * @returns {number} The length of the line.\n   */\n  getLength() {\n    return Math.sqrt(\n      this.getDeltaX() * this.getDeltaX() +\n      this.getDeltaY() * this.getDeltaY()\n    );\n  }\n\n  /**\n   * Get the length of the line according to a  spacing.\n   *\n   * @param {Scalar2D} spacing2D The 2D spacing.\n   * @returns {number} The length of the line with spacing\n   *  or null for null spacings.\n   */\n  getWorldLength(spacing2D) {\n    let wlen = null;\n    if (spacing2D !== null) {\n      const dxs = this.getDeltaX() * spacing2D.x;\n      const dys = this.getDeltaY() * spacing2D.y;\n      wlen = Math.sqrt(dxs * dxs + dys * dys);\n    }\n    return wlen;\n  }\n\n  /**\n   * Get the mid point of the line.\n   *\n   * @returns {Point2D} The mid point of the line.\n   * @deprecated Since v0.36, please use getCentroid instead.\n   */\n  getMidpoint() {\n    return this.getCentroid();\n  }\n\n  /**\n   * Get the centroid of the line.\n   *\n   * @returns {Point2D} THe centroid point.\n   */\n  getCentroid() {\n    return new Point2D(\n      (this.getBegin().getX() + this.getEnd().getX()) / 2,\n      (this.getBegin().getY() + this.getEnd().getY()) / 2\n    );\n  }\n\n  /**\n   * Get the slope of the line.\n   *\n   * @returns {number} The slope of the line.\n   */\n  getSlope() {\n    return this.getDeltaY() / this.getDeltaX();\n  }\n\n  /**\n   * Get the intercept of the line.\n   *\n   * @returns {number} The slope of the line.\n   */\n  getIntercept() {\n    return (\n      this.getEnd().getX() * this.getBegin().getY() -\n      this.getBegin().getX() * this.getEnd().getY()\n    ) / this.getDeltaX();\n  }\n\n  /**\n   * Get the inclination of the line.\n   *\n   * @returns {number} The inclination of the line.\n   */\n  getInclination() {\n    // tan(theta) = slope\n    const angle =\n      Math.atan2(this.getDeltaY(), this.getDeltaX()) * 180 / Math.PI;\n    // shift?\n    return 180 - angle;\n  }\n\n  /**\n   * Get a new line with the start and end flipped.\n   *\n   * @returns {Line} The new flipped line.\n   */\n  getFlipped() {\n    return new Line(this.#end, this.#begin);\n  }\n\n  /**\n   * Quantify a line according to view information.\n   *\n   * @param {ViewController} viewController The associated view controller.\n   * @returns {Object<string, Value>} A quantification object.\n   */\n  quantify(viewController) {\n    // length\n    const spacing2D = viewController.get2DSpacing();\n    const worldLength = this.getWorldLength(spacing2D);\n    let length;\n    if (worldLength !== null) {\n      length = {\n        value: worldLength,\n        unit: viewController.getLengthUnit()\n      };\n    }\n    // return\n    return {length};\n  }\n\n} // Line class\n\n/**\n * Get the angle between two lines in degree.\n *\n * @param {Line} line0 The first line.\n * @param {Line} line1 The second line.\n * @returns {number} The angle.\n */\nexport function getAngle(line0, line1) {\n  const dx0 = line0.getDeltaX();\n  const dy0 = line0.getDeltaY();\n  const dx1 = line1.getDeltaX();\n  const dy1 = line1.getDeltaY();\n  // dot = ||a||*||b||*cos(theta)\n  const dot = dx0 * dx1 + dy0 * dy1;\n  // cross = ||a||*||b||*sin(theta)\n  const det = dx0 * dy1 - dy0 * dx1;\n  // tan = sin / cos\n  const angle = Math.atan2(det, dot) * 180 / Math.PI;\n  // complementary angle\n  // shift?\n  return 360 - (180 - angle);\n}\n\n/**\n * Check if two lines are orthogonal.\n *\n * @param {Line} line0 The first line.\n * @param {Line} line1 The second line.\n * @returns {boolean} True if both lines are orthogonal.\n */\nexport function areOrthogonal(line0, line1) {\n  const dx0 = line0.getDeltaX();\n  const dy0 = line0.getDeltaY();\n  const dx1 = line1.getDeltaX();\n  const dy1 = line1.getDeltaY();\n  // dot = ||a||*||b||*cos(theta)\n  return (dx0 * dx1 + dy0 * dy1) === 0;\n}\n\n/**\n * Check if a point is in a line coordinate range.\n *\n * @param {Point2D} point The input point.\n * @param {Line} line The input line.\n * @returns {boolean} True if the input point is in the line coordinate range.\n */\nexport function isPointInLineRange(point, line) {\n  const minX = Math.min(line.getBegin().getX(), line.getEnd().getX());\n  const maxX = Math.max(line.getBegin().getX(), line.getEnd().getX());\n  const minY = Math.min(line.getBegin().getY(), line.getEnd().getY());\n  const maxY = Math.max(line.getBegin().getY(), line.getEnd().getY());\n  return point.getX() >= minX &&\n    point.getX() <= maxX &&\n    point.getY() >= minY &&\n    point.getY() <= maxY;\n}\n\n/**\n * Get a perpendicular line to an input one at a given point.\n *\n * @param {Line} line The line to be perpendicular to.\n * @param {Point2D} point The middle point of the perpendicular line.\n * @param {number} length The length of the perpendicular line.\n * @param {Scalar2D} [spacing] Optional image spacing, default to [1,1].\n * @returns {Line} The perpendicular line.\n */\nexport function getPerpendicularLine(line, point, length, spacing) {\n  if (typeof spacing === 'undefined') {\n    spacing = {x: 1, y: 1};\n  }\n  const sx2 = spacing.x * spacing.x;\n  const sy2 = spacing.y * spacing.y;\n  // a0 * a1 = -1 (in square space)\n  const perpSlope = -sx2 / (sy2 * line.getSlope());\n  // y0 = a1*x0 + b1 -> b1 = y0 - a1*x0\n  const prepIntercept = point.getY() - perpSlope * point.getX();\n  // return\n  return getLineFromEquation(perpSlope, prepIntercept, point, length, spacing);\n}\n\n/**\n * Get a perpendicular line to an input one at a given distance\n *   of its begin point.\n *\n * @param {Line} line The line to be perpendicular to.\n * @param {number} distance The distance to the input line begin point.\n * @param {number} length The length of the perpendicular line.\n * @param {Scalar2D} [spacing] Optional image spacing, default to [1,1].\n * @returns {Line} The perpendicular line.\n */\nexport function getPerpendicularLineAtDistance(\n  line, distance, length, spacing) {\n  // get a line along the input one and centered on begin point\n  const lineFromEq = getLineFromEquation(\n    line.getSlope(),\n    line.getIntercept(),\n    line.getBegin(),\n    distance,\n    spacing\n  );\n  // select the point on the input line\n  let startPoint;\n  if (isPointInLineRange(lineFromEq.getBegin(), line)) {\n    startPoint = lineFromEq.getBegin();\n  } else {\n    startPoint = lineFromEq.getEnd();\n  }\n  // use it as base for a perpendicular line\n  return getPerpendicularLine(line, startPoint, length, spacing);\n}\n\n/**\n * Get a line from an equation, a middle point and a length.\n *\n * @param {number} slope The line slope.\n * @param {number} intercept The line intercept.\n * @param {Point2D} point The middle point of the line.\n * @param {number} length The line length.\n * @param {Scalar2D} [spacing] Optional image spacing, default to [1,1].\n * @returns {Line} The resulting line.\n */\nexport function getLineFromEquation(slope, intercept, point, length, spacing) {\n  if (typeof spacing === 'undefined') {\n    spacing = {x: 1, y: 1};\n  }\n  // begin point\n  let beginX = 0;\n  let beginY = 0;\n  // end point\n  let endX = 0;\n  let endY = 0;\n\n  if (isSimilar(slope, 0, REAL_WORLD_EPSILON)) {\n    // slope = ~0 -> horizontal input line\n    beginX = point.getX() - length / (2 * spacing.x);\n    beginY = point.getY();\n    endX = point.getX() + length / (2 * spacing.x);\n    endY = point.getY();\n  } else if (Math.abs(slope) > 1e6) {\n    // slope = ~(+/-)Infinity -> vertical input line\n    beginX = point.getX();\n    beginY = point.getY() - length / (2 * spacing.y);\n    endX = point.getX();\n    endY = point.getY() + length / (2 * spacing.y);\n  } else {\n    const sx2 = spacing.x * spacing.x;\n    const sy2 = spacing.y * spacing.y;\n\n    // 1. [length] sx^2 * (x - x0)^2 + sy^2 * (y - y0)^2 = d^2\n    // 2. [slope] a = (y - y0) / (x - x0) -> y - y0 = a*(x - x0)\n    // ->  sx^2 * (x - x0)^2 + sy^2 * a^2 * (x - x0)^2 = d^2\n    // ->  (x - x0)^2 = d^2 / (sx^2 + sy^2 * a^2)\n    // -> x = x0 +- d / sqrt(sx^2 + sy^2 * a^2)\n\n    // length is the distance between begin and end,\n    // point is half way between both -> d = length / 2\n    const dx = length / (2 * Math.sqrt(sx2 + sy2 * slope * slope));\n\n    // begin point\n    beginX = point.getX() - dx;\n    beginY = slope * beginX + intercept;\n    // end point\n    endX = point.getX() + dx;\n    endY = slope * endX + intercept;\n  }\n  return new Line(\n    new Point2D(beginX, beginY),\n    new Point2D(endX, endY));\n}\n","import {Line, getAngle} from './line.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point2D} from '../math/point.js';\nimport {Value} from './value.js';\nimport {ViewController} from '../app/viewController.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Protractor shape: 3 points from which to calculate an angle.\n */\nexport class Protractor {\n\n  /**\n   * List of points.\n   *\n   * @type {Point2D[]}\n   */\n  #points;\n\n  /**\n   * @param {Point2D[]} points The list of Point2D that make\n   *   the protractor.\n   */\n  constructor(points) {\n    if (points.length > 3) {\n      throw new Error('Too many points for a protractor');\n    }\n    this.#points = points.slice(0, 3);\n  }\n\n  /**\n   * Get a point of the list.\n   *\n   * @param {number} index The index of the point\n   *   to get (beware, no size check).\n   * @returns {Point2D|undefined} The Point2D at the given index.\n   */\n  getPoint(index) {\n    return this.#points[index];\n  }\n\n  /**\n   * Get the length of the path (should be 3).\n   *\n   * @returns {number} The length of the path.\n   */\n  getLength() {\n    return this.#points.length;\n  }\n\n  /**\n   * Get the centroid of the protractor.\n   *\n   * @returns {Point2D} THe centroid point.\n   */\n  getCentroid() {\n    return this.#points[1];\n  }\n\n  /**\n   * Quantify a path according to view information.\n   *\n   * @param {ViewController} _viewController The associated view controller.\n   * @param {string[]} _flags A list of stat values to calculate.\n   * @returns {Object<string, Value>} A quantification object.\n   */\n  quantify(_viewController, _flags) {\n    let angle;\n    if (this.#points.length === 3) {\n      const line0 = new Line(this.#points[0], this.#points[1]);\n      const line1 = new Line(this.#points[1], this.#points[2]);\n      let angleNumber = getAngle(line0, line1);\n      if (angleNumber > 180) {\n        angleNumber = 360 - angleNumber;\n      }\n      angle = {\n        value: angleNumber,\n        unit: 'unit.degree'\n      };\n    }\n    return {angle};\n  }\n\n} // Protractor class\n","import {Point2D} from '../math/point.js';\n\n/**\n * Region Of Interest shape.\n * Note: should be a closed path.\n */\nexport class ROI {\n\n  /**\n   * List of points.\n   *\n   * @type {Point2D[]}\n   */\n  #points = [];\n\n  /**\n   * @param {Point2D[]} [points] Optional initial point list.\n   */\n  constructor(points) {\n    if (typeof points !== 'undefined') {\n      this.#points = points;\n    }\n  }\n\n  /**\n   * Get a point of the list at a given index.\n   *\n   * @param {number} index The index of the point to get\n   *   (beware, no size check).\n   * @returns {Point2D|undefined} The Point2D at the given index.\n   */\n  getPoint(index) {\n    return this.#points[index];\n  }\n\n  /**\n   * Get the point list.\n   *\n   * @returns {Point2D[]} The list.\n   */\n  getPoints() {\n    return this.#points;\n  }\n\n  /**\n   * Get the length of the point list.\n   *\n   * @returns {number} The length of the point list.\n   */\n  getLength() {\n    return this.#points.length;\n  }\n\n  /**\n   * Add a point to the ROI.\n   *\n   * @param {Point2D} point The Point2D to add.\n   */\n  addPoint(point) {\n    this.#points.push(point);\n  }\n\n  /**\n   * Add points to the ROI.\n   *\n   * @param {Point2D[]} rhs The array of POints2D to add.\n   */\n  addPoints(rhs) {\n    this.#points = this.#points.concat(rhs);\n  }\n\n  /**\n   * Get the centroid of the roi. Only valid for\n   * a non-self-intersecting closed polygon.\n   * Ref: {@link https://en.wikipedia.org/wiki/Centroid#Of_a_polygon}.\n   *\n   * @returns {Point2D|undefined} The centroid point.\n   */\n  getCentroid() {\n    let a = 0;\n    let cx = 0;\n    let cy = 0;\n    for (let i = 0; i < this.#points.length; ++i) {\n      const pi = this.#points[i];\n      let pi1;\n      if (i === this.#points.length - 1) {\n        pi1 = this.#points[0];\n      } else {\n        pi1 = this.#points[i + 1];\n      }\n      const ai = pi.getX() * pi1.getY() - pi1.getX() * pi.getY();\n      a += ai;\n      cx += (pi.getX() + pi1.getX()) * ai;\n      cy += (pi.getY() + pi1.getY()) * ai;\n    }\n\n    let res;\n    if (a !== 0) {\n      const a1 = 1 / (3 * a);\n      res = new Point2D(a1 * cx, a1 * cy);\n    }\n    return res;\n  }\n\n} // ROI class\n","import {getStats} from './stats.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Index} from './index.js';\nimport {Point2D} from '../math/point.js';\nimport {Value} from './value.js';\nimport {ViewController} from '../app/viewController.js';\nimport {Scalar2D} from './scalar.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Mulitply the three inputs if the last two are not null.\n *\n * @param {number} a The first input.\n * @param {number} b The second input.\n * @param {number} c The third input.\n * @returns {number} The multiplication of the three inputs or\n *  null if one of the last two is null.\n */\nfunction mulABC(a, b, c) {\n  let res = null;\n  if (b !== null && c !== null) {\n    res = a * b * c;\n  }\n  return res;\n}\n\n/**\n * Circle shape.\n */\nexport class Circle {\n\n  /**\n   * Circle centre.\n   *\n   * @type {Point2D}\n   */\n  #centre;\n\n  /**\n   * Circle radius.\n   *\n   * @type {number}\n   */\n  #radius;\n\n  /**\n   * @param {Point2D} centre A Point2D representing the centre\n   *   of the circle.\n   * @param {number} radius The radius of the circle.\n   */\n  constructor(centre, radius) {\n    this.#centre = centre;\n    this.#radius = radius;\n  }\n\n  /**\n   * Get the centre (point) of the circle.\n   *\n   * @returns {Point2D} The center (point) of the circle.\n   */\n  getCenter() {\n    return this.#centre;\n  }\n\n  /**\n   * Get the centroid of the circle.\n   *\n   * @returns {Point2D} The centroid point.\n   */\n  getCentroid() {\n    return this.#centre;\n  }\n\n  /**\n   * Get the radius of the circle.\n   *\n   * @returns {number} The radius of the circle.\n   */\n  getRadius() {\n    return this.#radius;\n  }\n\n\n  /**\n   * Check for equality.\n   *\n   * @param {Circle} rhs The object to compare to.\n   * @returns {boolean} True if both objects are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      this.getCenter().equals(rhs.getCenter()) &&\n      this.getRadius() === rhs.getRadius();\n  }\n\n  /**\n   * Get the surface of the circle.\n   *\n   * @returns {number} The surface of the circle.\n   */\n  getSurface() {\n    return Math.PI * this.getRadius() * this.getRadius();\n  }\n\n  /**\n   * Get the surface of the circle according to a spacing.\n   *\n   * @param {Scalar2D} spacing2D The 2D spacing.\n   * @returns {number} The surface of the circle multiplied by the given\n   *  spacing or null for null spacings.\n   */\n  getWorldSurface(spacing2D) {\n    return mulABC(this.getSurface(), spacing2D.x, spacing2D.y);\n  }\n\n  /**\n   * Get the rounded limits of the circle.\n   *\n   * See: {@link https://en.wikipedia.org/wiki/Circle#Equations}.\n   *\n   * Circle formula: `x*x + y*y = r*r`.\n   *\n   * Implies: `y = (+-) sqrt(r*r - x*x)`.\n   *\n   * @returns {number[][][]} The rounded limits:\n   *  list of [x, y] pairs (min, max).\n   */\n  getRound() {\n    const centerX = this.getCenter().getX();\n    const centerY = this.getCenter().getY();\n    const radius = this.getRadius();\n    const rSquare = Math.pow(radius, 2);\n    // Y bounds\n    const minY = centerY - radius;\n    const maxY = centerY + radius;\n    const regions = [];\n    // loop through lines and store limits\n    for (let y = minY; y < maxY; ++y) {\n      const diff = rSquare - Math.pow(y - centerY, 2);\n      // remove small values (possibly negative)\n      if (Math.abs(diff) < 1e-7) {\n        continue;\n      }\n      const transX = Math.sqrt(diff);\n      // remove small values\n      if (transX < 0.5) {\n        continue;\n      }\n      regions.push([\n        [Math.round(centerX - transX), Math.round(y)],\n        [Math.round(centerX + transX), Math.round(y)]\n      ]);\n    }\n    return regions;\n  }\n\n  /**\n   * Quantify an circle according to view information.\n   *\n   * @param {ViewController} viewController The associated view controller.\n   * @param {Index} index The index at which to get the\n   *   image values.\n   * @param {string[]} flags A list of stat values to calculate.\n   * @returns {Object<string, Value>} A quantification object.\n   */\n  quantify(viewController, index, flags) {\n    // shape quantification\n    const spacing2D = viewController.get2DSpacing();\n    const lengthUnit = viewController.getLengthUnit();\n    const radius = {\n      value: this.getRadius() * spacing2D.x,\n      unit: lengthUnit\n    };\n    const worldSurface = this.getWorldSurface(spacing2D);\n    let surface;\n    if (worldSurface !== null) {\n      if (lengthUnit === 'unit.mm') {\n        surface = {\n          value: worldSurface / 100,\n          unit: 'unit.cm2'\n        };\n      } else {\n        surface = {\n          value: worldSurface,\n          unit: lengthUnit\n        };\n      }\n    }\n\n    // shape quantification\n    const quant = {radius, surface};\n\n    // pixel values quantification\n    if (viewController.canQuantifyImage()) {\n      const regions = this.getRound();\n      if (regions.length !== 0) {\n        const values = viewController.getImageVariableRegionValues(\n          regions, index);\n        const unit = viewController.getPixelUnit();\n        const quantif = getStats(values, flags);\n        quant.min = {value: quantif.min, unit: unit};\n        quant.max = {value: quantif.max, unit: unit};\n        quant.mean = {value: quantif.mean, unit: unit};\n        quant.stdDev = {value: quantif.stdDev, unit: unit};\n        if (typeof quantif.median !== 'undefined') {\n          quant.median = {value: quantif.median, unit: unit};\n        }\n        if (typeof quantif.p25 !== 'undefined') {\n          quant.p25 = {value: quantif.p25, unit: unit};\n        }\n        if (typeof quantif.p75 !== 'undefined') {\n          quant.p75 = {value: quantif.p75, unit: unit};\n        }\n      }\n    }\n\n    // return\n    return quant;\n  }\n\n} // Circle class\n","import {getStats} from './stats.js';\nimport {Index} from './index.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point2D} from '../math/point.js';\nimport {Value} from './value.js';\nimport {ViewController} from '../app/viewController.js';\nimport {Scalar2D} from './scalar.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Mulitply the three inputs if the last two are not null.\n *\n * @param {number} a The first input.\n * @param {number} b The second input.\n * @param {number} c The third input.\n * @returns {number} The multiplication of the three inputs or\n *  null if one of the last two is null.\n */\nfunction mulABC(a, b, c) {\n  let res = null;\n  if (b !== null && c !== null) {\n    res = a * b * c;\n  }\n  return res;\n}\n\n/**\n * Ellipse shape.\n */\nexport class Ellipse {\n\n  /**\n   * Ellipse centre.\n   *\n   * @type {Point2D}\n   */\n  #centre;\n\n  /**\n   * Ellipse horizontal radius.\n   *\n   * @type {number}\n   */\n  #a;\n\n  /**\n   * Ellipse vertical radius.\n   *\n   * @type {number}\n   */\n  #b;\n\n  /**\n   * @param {Point2D} centre A Point2D representing the centre\n   *   of the ellipse.\n   * @param {number} a The radius of the ellipse on the horizontal axe.\n   * @param {number} b The radius of the ellipse on the vertical axe.\n   */\n  constructor(centre, a, b) {\n    this.#centre = centre;\n    this.#a = a;\n    this.#b = b;\n  }\n\n  /**\n   * Get the centre (point) of the ellipse.\n   *\n   * @returns {Point2D} The center (point) of the ellipse.\n   */\n  getCenter() {\n    return this.#centre;\n  }\n\n  /**\n   * Get the centroid of the ellipse.\n   *\n   * @returns {Point2D} The centroid point.\n   */\n  getCentroid() {\n    return this.#centre;\n  }\n\n  /**\n   * Get the radius of the ellipse on the horizontal axe.\n   *\n   * @returns {number} The radius of the ellipse on the horizontal axe.\n   */\n  getA() {\n    return this.#a;\n  }\n\n  /**\n   * Get the radius of the ellipse on the vertical axe.\n   *\n   * @returns {number} The radius of the ellipse on the vertical axe.\n   */\n  getB() {\n    return this.#b;\n  }\n\n  /**\n   * Check for equality.\n   *\n   * @param {Ellipse} rhs The object to compare to.\n   * @returns {boolean} True if both objects are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      this.getCenter().equals(rhs.getCenter()) &&\n      this.getA() === rhs.getA() &&\n      this.getB() === rhs.getB();\n  }\n\n  /**\n   * Get the surface of the ellipse.\n   *\n   * @returns {number} The surface of the ellipse.\n   */\n  getSurface() {\n    return Math.PI * this.getA() * this.getB();\n  }\n\n  /**\n   * Get the surface of the ellipse according to a spacing.\n   *\n   * @param {Scalar2D} spacing2D The 2D spacing.\n   * @returns {number} The surface of the ellipse multiplied by the given\n   *  spacing or null for null spacings.\n   */\n  getWorldSurface(spacing2D) {\n    return mulABC(this.getSurface(), spacing2D.x, spacing2D.y);\n  }\n\n  /**\n   * Get the rounded limits of the ellipse.\n   *\n   * See: {@link https://en.wikipedia.org/wiki/Ellipse#Standard_equation}.\n   *\n   * Ellipse formula: `x*x / a*a + y*y / b*b = 1`.\n   *\n   * Implies: `y = (+-)(b/a) * sqrt(a*a - x*x)`.\n   *\n   * @returns {number[][][]} The rounded limits:\n   *  list of [x, y] pairs (min, max).\n   */\n  getRound() {\n    const centerX = this.getCenter().getX();\n    const centerY = this.getCenter().getY();\n    const radiusX = this.getA();\n    const radiusY = this.getB();\n    const radiusRatio = radiusX / radiusY;\n    const rySquare = Math.pow(radiusY, 2);\n    // Y bounds\n    const minY = centerY - radiusY;\n    const maxY = centerY + radiusY;\n    const regions = [];\n    // loop through lines and store limits\n    for (let y = minY; y < maxY; ++y) {\n      const diff = rySquare - Math.pow(y - centerY, 2);\n      // remove small values (possibly negative)\n      if (Math.abs(diff) < 1e-7) {\n        continue;\n      }\n      const transX = radiusRatio * Math.sqrt(diff);\n      // remove small values\n      if (transX < 0.5) {\n        continue;\n      }\n      regions.push([\n        [Math.round(centerX - transX), Math.round(y)],\n        [Math.round(centerX + transX), Math.round(y)]\n      ]);\n    }\n    return regions;\n  }\n\n  /**\n   * Quantify an ellipse according to view information.\n   *\n   * @param {ViewController} viewController The associated view controller.\n   * @param {Index} index The index at which to get the\n   *   image values.\n   * @param {string[]} flags A list of stat values to calculate.\n   * @returns {Object<string, Value>} A quantification object.\n   */\n  quantify(viewController, index, flags) {\n    // shape quantification\n    const spacing2D = viewController.get2DSpacing();\n    const lengthUnit = viewController.getLengthUnit();\n    const a = {\n      value: this.getA() * spacing2D.x,\n      unit: lengthUnit\n    };\n    const b = {\n      value: this.getB() * spacing2D.y,\n      unit: lengthUnit\n    };\n    const worldSurface = this.getWorldSurface(spacing2D);\n    let surface;\n    if (worldSurface !== null) {\n      if (lengthUnit === 'unit.mm') {\n        surface = {\n          value: worldSurface / 100,\n          unit: 'unit.cm2'\n        };\n      } else {\n        surface = {\n          value: worldSurface,\n          unit: lengthUnit\n        };\n      }\n    }\n\n    // shape quantification\n    const quant = {a, b, surface};\n\n    // pixel values quantification\n    if (viewController.canQuantifyImage()) {\n      const regions = this.getRound();\n      if (regions.length !== 0) {\n        const values = viewController.getImageVariableRegionValues(\n          regions, index);\n        const unit = viewController.getPixelUnit();\n        const quantif = getStats(values, flags);\n        quant.min = {value: quantif.min, unit: unit};\n        quant.max = {value: quantif.max, unit: unit};\n        quant.mean = {value: quantif.mean, unit: unit};\n        quant.stdDev = {value: quantif.stdDev, unit: unit};\n        if (typeof quantif.median !== 'undefined') {\n          quant.median = {value: quantif.median, unit: unit};\n        }\n        if (typeof quantif.p25 !== 'undefined') {\n          quant.p25 = {value: quantif.p25, unit: unit};\n        }\n        if (typeof quantif.p75 !== 'undefined') {\n          quant.p75 = {value: quantif.p75, unit: unit};\n        }\n      }\n    }\n\n    // return\n    return quant;\n  }\n\n} // Ellipse class\n\n/**\n * Get the indices that form a ellpise.\n *\n * @param {Index} center The ellipse center.\n * @param {number[]} radius The 2 ellipse radiuses.\n * @param {number[]} dir The 2 ellipse directions.\n * @returns {Index[]} The indices of the ellipse.\n */\nexport function getEllipseIndices(center, radius, dir) {\n  const centerValues = center.getValues();\n  // keep all values for possible extra dimensions\n  const values = centerValues.slice();\n  const indices = [];\n  const radiusI = radius[0];\n  const radiusJ = radius[1];\n  const radiusRatio = radiusI / radiusJ;\n  const radiusJ2 = Math.pow(radiusJ, 2);\n  const di = dir[0];\n  const dj = dir[1];\n  // deduce 4 positions from top right\n  for (let j = 0; j < radiusJ; ++j) {\n    // right triangle formed by radiuses, j and len\n    // ellipse: i*i / a*a + j*j / b*b = 1\n    // -> i = a/b * sqrt(b*b - j*j)\n    const len = Math.round(\n      radiusRatio * Math.sqrt(radiusJ2 - Math.pow(j, 2)));\n    const jmax = centerValues[dj] + j;\n    const jmin = centerValues[dj] - j;\n    for (let i = 0; i < len; ++i) {\n      const imax = centerValues[di] + i;\n      const imin = centerValues[di] - i;\n\n      // right\n      values[di] = imax;\n      // right - top\n      values[dj] = jmax;\n      indices.push(new Index(values.slice()));\n      // right - bottom\n      if (jmin !== jmax) {\n        values[dj] = jmin;\n        indices.push(new Index(values.slice()));\n      }\n\n      // left\n      if (imin !== imax) {\n        values[di] = imin;\n        // left - top\n        values[dj] = jmax;\n        indices.push(new Index(values.slice()));\n        // left - bottom\n        if (jmin !== jmax) {\n          values[dj] = jmin;\n          indices.push(new Index(values.slice()));\n        }\n      }\n    }\n  }\n  return indices;\n}\n","import {Point2D} from './point.js';\nimport {getStats} from './stats.js';\nimport {Index} from './index.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {ViewController} from '../app/viewController.js';\nimport {Scalar2D} from './scalar.js';\nimport {Value} from './value.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Mulitply the three inputs if the last two are not null.\n *\n * @param {number} a The first input.\n * @param {number} b The second input.\n * @param {number} c The third input.\n * @returns {number} The multiplication of the three inputs or\n *  null if one of the last two is null.\n */\nfunction mulABC(a, b, c) {\n  let res = null;\n  if (b !== null && c !== null) {\n    res = a * b * c;\n  }\n  return res;\n}\n\n/**\n * Rectangle shape.\n */\nexport class Rectangle {\n\n  /**\n   * Rectangle begin point.\n   *\n   * @type {Point2D}\n   */\n  #begin;\n\n  /**\n   * Rectangle end point.\n   *\n   * @type {Point2D}\n   */\n  #end;\n\n  /**\n   * @param {Point2D} begin A Point2D representing the beginning\n   *   of the rectangle.\n   * @param {Point2D} end A Point2D representing the end\n   *   of the rectangle.\n   */\n  constructor(begin, end) {\n    this.#begin = new Point2D(\n      Math.min(begin.getX(), end.getX()),\n      Math.min(begin.getY(), end.getY())\n    );\n    this.#end = new Point2D(\n      Math.max(begin.getX(), end.getX()),\n      Math.max(begin.getY(), end.getY())\n    );\n  }\n\n  /**\n   * Get the begin point of the rectangle.\n   *\n   * @returns {Point2D} The begin point of the rectangle.\n   */\n  getBegin() {\n    return this.#begin;\n  }\n\n  /**\n   * Get the end point of the rectangle.\n   *\n   * @returns {Point2D} The end point of the rectangle.\n   */\n  getEnd() {\n    return this.#end;\n  }\n\n  /**\n   * Check for equality.\n   *\n   * @param {Rectangle} rhs The object to compare to.\n   * @returns {boolean} True if both objects are equal.\n   */\n  equals(rhs) {\n    return rhs !== null &&\n      this.getBegin().equals(rhs.getBegin()) &&\n      this.getEnd().equals(rhs.getEnd());\n  }\n\n  /**\n   * Get the surface of the rectangle.\n   *\n   * @returns {number} The surface of the rectangle.\n   */\n  getSurface() {\n    const begin = this.getBegin();\n    const end = this.getEnd();\n    return Math.abs(end.getX() - begin.getX()) *\n      Math.abs(end.getY() - begin.getY());\n  }\n\n  /**\n   * Get the surface of the rectangle according to a spacing.\n   *\n   * @param {Scalar2D} spacing2D The 2D spacing.\n   * @returns {number} The surface of the rectangle multiplied by the given\n   *  spacing or null for null spacings.\n   */\n  getWorldSurface(spacing2D) {\n    return mulABC(this.getSurface(), spacing2D.x, spacing2D.y);\n  }\n\n  /**\n   * Get the real width of the rectangle.\n   *\n   * @returns {number} The real width of the rectangle.\n   */\n  getRealWidth() {\n    return this.getEnd().getX() - this.getBegin().getX();\n  }\n\n  /**\n   * Get the real height of the rectangle.\n   *\n   * @returns {number} The real height of the rectangle.\n   */\n  getRealHeight() {\n    return this.getEnd().getY() - this.getBegin().getY();\n  }\n\n  /**\n   * Get the width of the rectangle.\n   *\n   * @returns {number} The width of the rectangle.\n   */\n  getWidth() {\n    return Math.abs(this.getRealWidth());\n  }\n\n  /**\n   * Get the height of the rectangle.\n   *\n   * @returns {number} The height of the rectangle.\n   */\n  getHeight() {\n    return Math.abs(this.getRealHeight());\n  }\n\n  /**\n   * Get the rounded limits of the rectangle.\n   *\n   * @returns {object} The rounded limits as {min, max} (Point2D).\n   */\n  getRound() {\n    const roundBegin = new Point2D(\n      Math.round(this.getBegin().getX()),\n      Math.round(this.getBegin().getY())\n    );\n    const roundEnd = new Point2D(\n      Math.round(this.getEnd().getX()),\n      Math.round(this.getEnd().getY())\n    );\n    return {\n      min: roundBegin,\n      max: roundEnd\n    };\n  }\n\n  /**\n   * Get the centroid of the rectangle.\n   *\n   * @returns {Point2D} The centroid point.\n   */\n  getCentroid() {\n    return new Point2D(\n      this.getBegin().getX() + this.getWidth() / 2,\n      this.getBegin().getY() + this.getHeight() / 2\n    );\n  }\n\n  /**\n   * Quantify a rectangle according to view information.\n   *\n   * @param {ViewController} viewController The associated view controller.\n   * @param {Index} index The index at which to get the\n   *   image values.\n   * @param {string[]} flags A list of stat values to calculate.\n   * @returns {Object<string, Value>} A quantification object.\n   */\n  quantify(viewController, index, flags) {\n    const spacing2D = viewController.get2DSpacing();\n    const lengthUnit = viewController.getLengthUnit();\n    const width = {\n      value: this.getWidth() * spacing2D.x,\n      unit: lengthUnit\n    };\n    const height = {\n      value: this.getHeight() * spacing2D.y,\n      unit: lengthUnit\n    };\n    const worldSurface = this.getWorldSurface(spacing2D);\n    let surface;\n    if (worldSurface !== null) {\n      if (lengthUnit === 'unit.mm') {\n        surface = {\n          value: worldSurface / 100,\n          unit: 'unit.cm2'\n        };\n      } else {\n        surface = {\n          value: worldSurface,\n          unit: lengthUnit\n        };\n      }\n    }\n\n    // shape quantification\n    const quant = {width, height, surface};\n\n    // pixel values quantification\n    if (viewController.canQuantifyImage()) {\n      const round = this.getRound();\n      const values = viewController.getImageRegionValues(\n        round.min, round.max, index);\n      const unit = viewController.getPixelUnit();\n      const quantif = getStats(values, flags);\n      quant.min = {value: quantif.min, unit: unit};\n      quant.max = {value: quantif.max, unit: unit};\n      quant.mean = {value: quantif.mean, unit: unit};\n      quant.stdDev = {value: quantif.stdDev, unit: unit};\n      if (typeof quantif.median !== 'undefined') {\n        quant.median = {value: quantif.median, unit: unit};\n      }\n      if (typeof quantif.p25 !== 'undefined') {\n        quant.p25 = {value: quantif.p25, unit: unit};\n      }\n      if (typeof quantif.p75 !== 'undefined') {\n        quant.p75 = {value: quantif.p75, unit: unit};\n      }\n    }\n\n    // return\n    return quant;\n  }\n\n} // Rectangle class\n\n/**\n * Get the indices that form a rectangle.\n *\n * @param {Index} center The rectangle center.\n * @param {number[]} size The 2 rectangle sizes.\n * @param {number[]} dir The 2 rectangle directions.\n * @returns {Index[]} The indices of the rectangle.\n */\nexport function getRectangleIndices(center, size, dir) {\n  const centerValues = center.getValues();\n  // keep all values for possible extra dimensions\n  const values = centerValues.slice();\n  const indices = [];\n  const sizeI = size[0];\n  const halfSizeI = Math.floor(sizeI / 2);\n  const sizeJ = size[1];\n  const halfSizeJ = Math.floor(sizeJ / 2);\n  const di = dir[0];\n  const dj = dir[1];\n  for (let j = 0; j < sizeJ; ++j) {\n    values[dj] = centerValues[dj] - halfSizeJ + j;\n    for (let i = 0; i < sizeI; ++i) {\n      values[di] = centerValues[di] - halfSizeI + i;\n      indices.push(new Index(values.slice()));\n    }\n  }\n  return indices;\n}\n","import {Point2D} from '../math/point.js';\nimport {Line, areOrthogonal} from '../math/line.js';\nimport {Protractor} from '../math/protractor.js';\nimport {ROI} from '../math/roi.js';\nimport {Circle} from '../math/circle.js';\nimport {Ellipse} from '../math/ellipse.js';\nimport {Rectangle} from '../math/rectangle.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  PixelOriginInterpretation: '00480301',\n  GraphicData: '00700022',\n  GraphicType: '00700023',\n  FiducialUID: '0070031A'\n};\n\n/**\n * DICOM graphic types.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.18.6.html#sect_C.18.6.1.2}.\n */\nexport const GraphicTypes = {\n  point: 'POINT',\n  multipoint: 'MULTIPOINT',\n  polyline: 'POLYLINE',\n  circle: 'CIRCLE',\n  ellipse: 'ELLIPSE'\n};\n\n/**\n * DICOM spatial coordinate (SCOORD): item of a SR content sequence.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.18.6.html#table_C.18.6-1}.\n */\nexport class SpatialCoordinate {\n  /**\n   * @type {string[]}\n   */\n  graphicData;\n\n  /**\n   * @type {string}\n   */\n  graphicType;\n\n  /**\n   * @type {string}\n   */\n  pixelOriginInterpretation;\n\n  /**\n   * @type {string}\n   */\n  fiducialUID;\n\n  /**\n   * Get a string representation of this object.\n   *\n   * @returns {string} The object as string.\n   */\n  toString() {\n    return this.graphicType +\n      ' {' + this.graphicData + '}';\n  };\n};\n\n/**\n * Get a scoord object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {SpatialCoordinate} A scoord object.\n */\nexport function getSpatialCoordinate(dataElements) {\n  const scoord = new SpatialCoordinate();\n\n  if (typeof dataElements[TagKeys.GraphicData] !== 'undefined') {\n    scoord.graphicData = dataElements[TagKeys.GraphicData].value;\n  }\n  if (typeof dataElements[TagKeys.GraphicType] !== 'undefined') {\n    scoord.graphicType = dataElements[TagKeys.GraphicType].value[0];\n  }\n  if (typeof dataElements[TagKeys.PixelOriginInterpretation] !== 'undefined') {\n    scoord.pixelOriginInterpretation =\n      dataElements[TagKeys.PixelOriginInterpretation].value[0];\n  }\n  if (typeof dataElements[TagKeys.FiducialUID] !== 'undefined') {\n    scoord.fiducialUID = dataElements[TagKeys.FiducialUID].value[0];\n  }\n  return scoord;\n};\n\n/**\n * Get a simple dicom element item from a scoord object.\n *\n * @param {SpatialCoordinate} scoord The scoord object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomSpatialCoordinateItem(scoord) {\n  // dicom item (tags are in group/element order)\n  const item = {};\n\n  if (typeof scoord.pixelOriginInterpretation !== 'undefined') {\n    item.PixelOriginInterpretation = scoord.pixelOriginInterpretation;\n  }\n  if (typeof scoord.graphicData !== 'undefined') {\n    item.GraphicData = scoord.graphicData;\n  }\n  if (typeof scoord.graphicType !== 'undefined') {\n    item.GraphicType = scoord.graphicType;\n  }\n  if (typeof scoord.fiducialUID !== 'undefined') {\n    item.FiducialUID = scoord.fiducialUID;\n  }\n\n  // return\n  return item;\n}\n\n/**\n * Get a DICOM spatial coordinate (SCOORD) from a mathematical shape.\n *\n * @param {Point2D|Line|Protractor|ROI|Circle|Ellipse|Rectangle} shape\n *   The math shape.\n * @returns {SpatialCoordinate} The DICOM scoord.\n */\nexport function getScoordFromShape(shape) {\n  const scoord = new SpatialCoordinate();\n\n  if (shape instanceof Point2D) {\n    scoord.graphicData = [\n      shape.getX().toString(),\n      shape.getY().toString(),\n    ];\n    scoord.graphicType = GraphicTypes.point;\n  } else if (shape instanceof Line) {\n    scoord.graphicData = [\n      shape.getBegin().getX().toString(),\n      shape.getBegin().getY().toString(),\n      shape.getEnd().getX().toString(),\n      shape.getEnd().getY().toString(),\n    ];\n    scoord.graphicType = GraphicTypes.polyline;\n  } else if (shape instanceof Protractor) {\n    scoord.graphicData = [];\n    for (let i = 0; i < 3; ++i) {\n      scoord.graphicData.push(shape.getPoint(i).getX().toString());\n      scoord.graphicData.push(shape.getPoint(i).getY().toString());\n    }\n    scoord.graphicType = GraphicTypes.polyline;\n  } else if (shape instanceof ROI) {\n    scoord.graphicData = [];\n    for (let i = 0; i < shape.getLength(); ++i) {\n      scoord.graphicData.push(shape.getPoint(i).getX().toString());\n      scoord.graphicData.push(shape.getPoint(i).getY().toString());\n    }\n    // repeat first point to close shape\n    const firstPoint = shape.getPoint(0);\n    scoord.graphicData.push(firstPoint.getX().toString());\n    scoord.graphicData.push(firstPoint.getY().toString());\n\n    scoord.graphicType = GraphicTypes.polyline;\n  } else if (shape instanceof Circle) {\n    const center = shape.getCenter();\n    const pointPerimeter = new Point2D(\n      center.getX() + shape.getRadius(), center.getY()\n    );\n    scoord.graphicData = [\n      center.getX().toString(),\n      center.getY().toString(),\n      pointPerimeter.getX().toString(),\n      pointPerimeter.getY().toString(),\n    ];\n    scoord.graphicType = GraphicTypes.circle;\n  } else if (shape instanceof Ellipse) {\n    const center = shape.getCenter();\n    const radiusX = shape.getA();\n    const radiusY = shape.getB();\n    scoord.graphicData = [\n      (center.getX() - radiusX).toString(),\n      center.getY().toString(),\n      (center.getX() + radiusX).toString(),\n      center.getY().toString(),\n      center.getX().toString(),\n      (center.getY() - radiusY).toString(),\n      center.getX().toString(),\n      (center.getY() + radiusY).toString()\n    ];\n    scoord.graphicType = GraphicTypes.ellipse;\n  } else if (shape instanceof Rectangle) {\n    const begin = shape.getBegin();\n    const end = shape.getEnd();\n    // begin as first and last point to close shape\n    scoord.graphicData = [\n      begin.getX().toString(),\n      begin.getY().toString(),\n      begin.getX().toString(),\n      end.getY().toString(),\n      end.getX().toString(),\n      end.getY().toString(),\n      end.getX().toString(),\n      begin.getY().toString(),\n      begin.getX().toString(),\n      begin.getY().toString()\n    ];\n    scoord.graphicType = GraphicTypes.polyline;\n  }\n\n  return scoord;\n};\n\n/**\n * Get a mathematical shape from a DICOM spatial coordinate (SCOORD).\n *\n * @param {SpatialCoordinate} scoord The DICOM scoord.\n * @returns {Point2D|Line|Protractor|ROI|Circle|Ellipse|Rectangle|undefined}\n *   The math shape.\n */\nexport function getShapeFromScoord(scoord) {\n  // no shape if no graphic data\n  if (typeof scoord.graphicData === 'undefined') {\n    return;\n  }\n  // extract points\n  const dataLength = scoord.graphicData.length;\n  if (dataLength === 0) {\n    throw new Error('No coordinates in scoord data');\n  }\n  if (dataLength % 2 !== 0) {\n    throw new Error('Expecting even number of coordinates in scoord data');\n  }\n  const points = [];\n  for (let i = 0; i < dataLength; i += 2) {\n    points.push(new Point2D(\n      parseFloat(scoord.graphicData[i]),\n      parseFloat(scoord.graphicData[i + 1])\n    ));\n  }\n  let isClosed = false;\n  const numberOfPoints = points.length;\n  if (numberOfPoints > 2) {\n    const firstPoint = points[0];\n    const lastPoint = points[numberOfPoints - 1];\n    isClosed = firstPoint.equals(lastPoint);\n  }\n\n  // create math shape\n  let shape;\n  if (scoord.graphicType === GraphicTypes.point) {\n    if (points.length > 1) {\n      logger.warn('Expecting 1 point for point, got ' + numberOfPoints);\n    }\n    shape = points[0];\n  } else if (scoord.graphicType === GraphicTypes.circle) {\n    if (points.length < 2) {\n      throw new Error('Expecting 2 points for circles, got ' + numberOfPoints);\n    }\n    if (points.length > 2) {\n      logger.warn('Expecting 2 points for circles, got ' + numberOfPoints);\n    }\n    const center = points[0];\n    const pointPerimeter = points[1];\n    const radius = pointPerimeter.getDistance(center);\n    shape = new Circle(center, radius);\n  } else if (scoord.graphicType === GraphicTypes.ellipse) {\n    if (points.length < 4) {\n      throw new Error('Expecting 4 points for ellipses, got ' + numberOfPoints);\n    }\n    if (points.length > 4) {\n      logger.warn('Expecting 4 points for ellipses, got ' + numberOfPoints);\n    }\n    // TODO: make more generic\n    const radiusX = points[0].getDistance(points[1]) / 2;\n    const radiusY = points[2].getDistance(points[3]) / 2;\n    const center = new Point2D(\n      points[0].getX() + radiusX,\n      points[0].getY()\n    );\n    shape = new Ellipse(center, radiusX, radiusY);\n  } else if (scoord.graphicType === GraphicTypes.polyline) {\n    if (!isClosed) {\n      if (points.length === 2) {\n        shape = new Line(points[0], points[1]);\n      } else if (points.length === 3) {\n        shape = new Protractor([points[0], points[1], points[2]]);\n      }\n    } else {\n      if (points.length === 5) {\n        const line0 = new Line(points[0], points[1]);\n        const line1 = new Line(points[1], points[2]);\n        const line2 = new Line(points[2], points[3]);\n        const line3 = new Line(points[3], points[4]);\n        if (areOrthogonal(line0, line1) &&\n          areOrthogonal(line1, line2) &&\n          areOrthogonal(line2, line3)) {\n          shape = new Rectangle(points[0], points[2]);\n        } else {\n          // remove last=first point for closed shape\n          shape = new ROI(points.slice(0, -1));\n        }\n      } else {\n        // remove last=first point for closed shape\n        shape = new ROI(points.slice(0, -1));\n      }\n    }\n  }\n\n  return shape;\n};","// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  GraphicData: '00700022',\n  GraphicType: '00700023',\n  ReferencedFrameofReferenceUID: '30060024',\n  FiducialUID: '0070031A'\n};\n\n/**\n * DICOM spatial coordinate 3D (SCOORD3D): item of a SR content sequence.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.18.9.html#table_C.18.9-1}.\n */\nexport class SpatialCoordinate3D {\n  /**\n   * @type {string[]}\n   */\n  graphicData;\n\n  /**\n   * @type {string}\n   */\n  graphicType;\n\n  /**\n   * @type {string}\n   */\n  referencedFrameofReferenceUID;\n\n  /**\n   * @type {string}\n   */\n  fiducialUID;\n\n  /**\n   * Get a string representation of this object.\n   *\n   * @returns {string} The object as string.\n   */\n  toString() {\n    return this.graphicType +\n      ' {' + this.graphicData + '}';\n  };\n};\n\n/**\n * Get a scoord3d object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {SpatialCoordinate3D} A scoord3d object.\n */\nexport function getSpatialCoordinate3D(dataElements) {\n  const scoord = new SpatialCoordinate3D();\n\n  if (typeof dataElements[TagKeys.GraphicData] !== 'undefined') {\n    scoord.graphicData = dataElements[TagKeys.GraphicData].value;\n  }\n  if (typeof dataElements[TagKeys.GraphicType] !== 'undefined') {\n    scoord.graphicType = dataElements[TagKeys.GraphicType].value[0];\n  }\n  if (typeof dataElements[TagKeys.ReferencedFrameofReferenceUID] !==\n    'undefined') {\n    scoord.referencedFrameofReferenceUID =\n      dataElements[TagKeys.ReferencedFrameofReferenceUID].value[0];\n  }\n  if (typeof dataElements[TagKeys.FiducialUID] !== 'undefined') {\n    scoord.fiducialUID = dataElements[TagKeys.FiducialUID].value[0];\n  }\n  return scoord;\n};\n\n/**\n * Get a simple dicom element item from a scoord3d object.\n *\n * @param {SpatialCoordinate3D} scoord The scoord3d object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomSpatialCoordinate3DItem(scoord) {\n  // dicom item (tags are in group/element order)\n  const item = {};\n\n  if (typeof scoord.graphicData !== 'undefined') {\n    item.GraphicData = scoord.graphicData;\n  }\n  if (typeof scoord.graphicType !== 'undefined') {\n    item.GraphicType = scoord.graphicType;\n  }\n  if (typeof scoord.referencedFrameofReferenceUID !== 'undefined') {\n    item.ReferencedFrameofReferenceUID =\n      scoord.referencedFrameofReferenceUID;\n  }\n  if (typeof scoord.fiducialUID !== 'undefined') {\n    item.FiducialUID = scoord.fiducialUID;\n  }\n\n  // return\n  return item;\n}","import {\n  NumericMeasurement,\n  getNumericMeasurement,\n  getDicomNumericMeasurementItem\n} from './dicomNumericMeasurement.js';\nimport {\n  isEqualCode,\n  getCode,\n  getDicomCodeItem,\n  getConceptNameCode,\n  getMeasurementUnitsCode\n} from './dicomCode.js';\nimport {\n  getImageReference,\n  getDicomImageReferenceItem\n} from './dicomImageReference.js';\nimport {\n  getSopInstanceReference,\n  getDicomSopInstanceReferenceItem\n} from './dicomSopInstanceReference.js';\nimport {\n  getSpatialCoordinate,\n  getDicomSpatialCoordinateItem\n} from './dicomSpatialCoordinate.js';\nimport {\n  getSpatialCoordinate3D,\n  getDicomSpatialCoordinate3DItem\n} from './dicomSpatialCoordinate3D.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {\n  safeGet,\n  safeGetAll,\n  DataElement\n} from './dataElement.js';\nimport {DicomCode} from './dicomCode.js';\nimport {MeasuredValue} from './dicomMeasuredValue.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  ReferencedSOPSequence: '00081199',\n  RelationshipType: '0040A010',\n  ValueType: '0040A040',\n  ConceptNameCodeSequence: '0040A043',\n  ConceptCodeSequence: '0040A168',\n  ContentSequence: '0040A730',\n  DateTime: '0040A120',\n  Date: '0040A121',\n  Time: '0040A122',\n  UID: '0040A124',\n  PersonName: '0040A123',\n  TextValue: '0040A160',\n  ContinuityOfContent: '0040A050',\n  ContentTemplateSequence: '0040A504',\n  MappingResource: '00080105',\n  TemplateIdentifier: '0040DB00'\n};\n\n/**\n * DICOM relationship types.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.17.3.2.4.html#sect_C.17.3.2.4}.\n */\nexport const RelationshipTypes = {\n  contains: 'CONTAINS',\n  hasProperties: 'HAS PROPERTIES',\n  hasObsContext: 'HAS OBS CONTEXT',\n  hasAcqContext: 'HAS ACQ CONTEXT',\n  inferredFrom: 'INFERRED FROM',\n  selectedFrom: 'SELECTED FROM',\n  hasConceptMod: 'HAS CONCEPT MOD'\n};\n\n/**\n * DICOM value types.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.17.3.2.html#sect_C.17.3.2.1}.\n */\nexport const ValueTypes = {\n  text: 'TEXT',\n  num: 'NUM',\n  code: 'CODE',\n  date: 'DATE',\n  time: 'TIME',\n  datetime: 'DATETIME',\n  uidref: 'UIDREF',\n  pname: 'PNAME',\n  composite: 'COMPOSITE',\n  image: 'IMAGE',\n  waveform: 'WAVEFORM',\n  scoord: 'SCOORD',\n  scoord3d: 'SCOORD3D',\n  tcoord: 'TCOORD',\n  container: 'CONTAINER',\n  table: 'TABLE',\n};\n\n/**\n * DICOM Continuity Of Contents.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.18.8.html#table_C.18.8-1}.\n */\nexport const ContinuityOfContents = {\n  separate: 'SEPARATE',\n  continuous: 'CONTINUOUS'\n};\n\n/**\n * DICOM value type to associated tag name.\n */\nexport const ValueTypeValueTagName = {\n  TEXT: 'TextValue',\n  DATE: 'Date',\n  TIME: 'Time',\n  DATETIME: 'DateTime',\n  UIDREF: 'UID',\n  PNAME: 'PersonName',\n  CONTAINER: 'ContinuityOfContent',\n};\n\n/**\n * Get the content template value.\n *\n * @param {Object<string, DataElement>} dataElements The dicom elements.\n * @returns {string|undefined} The template as\n *   'MappingResource'-'TemplateIdentifier'.\n */\nexport function getContentTemplate(dataElements) {\n  let template;\n  // should only be one item\n  const templateItem =\n    safeGet(dataElements, TagKeys.ContentTemplateSequence);\n  if (typeof templateItem !== 'undefined') {\n    const mappingResource = safeGet(templateItem, TagKeys.MappingResource);\n    const templateId = safeGet(templateItem, TagKeys.TemplateIdentifier);\n    if (typeof mappingResource !== 'undefined' &&\n      typeof templateId !== 'undefined') {\n      template = mappingResource + '-' + templateId;\n    }\n  }\n  return template;\n}\n\n/**\n * DICOM SR content: item of a SR content sequence.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_C.17.3.html}.\n */\nexport class DicomSRContent {\n  /**\n   * Value type.\n   *\n   * @type {string}\n   */\n  valueType;\n  /**\n   * Concept name code.\n   *\n   * @type {DicomCode|undefined}\n   */\n  conceptNameCode;\n  /**\n   * Relationship Type.\n   *\n   * @type {string}\n   */\n  relationshipType;\n\n  /**\n   * Content sequence.\n   *\n   * @type {DicomSRContent[]}\n   */\n  contentSequence = [];\n\n  /**\n   * Value.\n   *\n   * @type {object}\n   */\n  value;\n\n  /**\n   * @param {string} valueType The content item value type.\n   */\n  constructor(valueType) {\n    this.valueType = valueType;\n  }\n\n  /**\n   * Get a string representation of this object.\n   *\n   * @param {string} [prefix] An optional prefix for recursive content.\n   * @returns {string} The object as string.\n   */\n  toString(prefix) {\n    if (typeof prefix === 'undefined') {\n      prefix = '';\n    }\n\n    let res = '';\n\n    if (typeof this.relationshipType !== 'undefined') {\n      res += '(' + this.relationshipType + ') ';\n    }\n\n    res += this.valueType + ': ';\n\n    if (typeof this.conceptNameCode !== 'undefined') {\n      res += this.conceptNameCode.toString();\n    }\n\n    res += ' = ' + this.value.toString();\n\n    for (const item of this.contentSequence) {\n      res += '\\n' + prefix + '- ' + item.toString(prefix + '  ');\n    }\n\n    return res;\n  }\n\n  /**\n   * Check if this content has input header values.\n   *\n   * @param {string} valueType The value type.\n   * @param {DicomCode} conceptNameCode The concept name code.\n   * @param {string} relationshipType The relationship type.\n   * @returns {boolean} True if equal.\n   */\n  hasHeader(valueType, conceptNameCode, relationshipType) {\n    return this.valueType === valueType &&\n      isEqualCode(this.conceptNameCode, conceptNameCode) &&\n      this.relationshipType === relationshipType;\n  }\n}\n\n/**\n * Check if two content item objects are equal.\n *\n * @param {DicomSRContent} item1 The first content item.\n * @param {DicomSRContent} item2 The second content item.\n * @returns {boolean} True if both content items are equal.\n */\nexport function isEqualContentItem(item1, item2) {\n  return Object.keys(item1).length === Object.keys(item2).length &&\n    Object.keys(item1).every(key =>\n      Object.prototype.hasOwnProperty.call(item2, key) &&\n      item1[key] === item2[key]\n    );\n}\n\n/**\n * Get a content item object from a dicom element.\n *\n * @param {Object<string, DataElement>} dataElements The dicom element.\n * @returns {DicomSRContent} A content item object.\n */\nexport function getSRContent(dataElements) {\n  // valueType -> ValueType (type1)\n  let valueType = safeGet(dataElements, TagKeys.ValueType);\n  if (typeof valueType === 'undefined') {\n    valueType = '';\n  }\n\n  const content = new DicomSRContent(valueType);\n\n  // relationshipType -> RelationType (type1)\n  content.relationshipType =\n    safeGet(dataElements, TagKeys.RelationshipType);\n\n  const conceptNameCode =\n    safeGet(dataElements, TagKeys.ConceptNameCodeSequence);\n  if (typeof conceptNameCode !== 'undefined') {\n    content.conceptNameCode = getCode(conceptNameCode);\n  }\n\n  // set value acording to valueType\n  // (date and time are stored as string)\n  if (valueType === ValueTypes.code) {\n    content.value = getCode(\n      safeGet(dataElements, TagKeys.ConceptCodeSequence)\n    );\n  } else if (valueType === ValueTypes.num) {\n    content.value = getNumericMeasurement(dataElements);\n  } else if (valueType === ValueTypes.image) {\n    content.value = getImageReference(dataElements);\n  } else if (valueType === ValueTypes.composite) {\n    content.value = getSopInstanceReference(\n      safeGet(dataElements, TagKeys.ReferencedSOPSequence)\n    );\n  } else if (valueType === ValueTypes.scoord) {\n    content.value = getSpatialCoordinate(dataElements);\n  } else if (valueType === ValueTypes.scoord3d) {\n    content.value = getSpatialCoordinate3D(dataElements);\n  } else {\n    const valueTagName = ValueTypeValueTagName[valueType];\n    if (typeof valueTagName !== 'undefined') {\n      content.value =\n        safeGet(dataElements, TagKeys[valueTagName]);\n    } else {\n      console.warn('Unsupported input ValueType: ' + valueType);\n    }\n  }\n\n  const contentSq = safeGetAll(dataElements, TagKeys.ContentSequence);\n  if (typeof contentSq !== 'undefined') {\n    for (const item of contentSq) {\n      content.contentSequence.push(getSRContent(item));\n    }\n  }\n\n  return content;\n}\n\n/**\n * Get a simple dicom element item from a content item object.\n *\n * @param {DicomSRContent} content The content item object.\n * @returns {Object<string, any>} The item as a list of (key, value) pairs.\n */\nexport function getDicomSRContentItem(content) {\n  // dicom item (tags are in ~group/element order)\n  let contentItem = {};\n\n  if (typeof content.relationshipType !== 'undefined') {\n    contentItem.RelationshipType = content.relationshipType;\n  }\n  if (typeof content.valueType !== 'undefined') {\n    contentItem.ValueType = content.valueType;\n  }\n  if (typeof content.conceptNameCode !== 'undefined') {\n    contentItem.ConceptNameCodeSequence = {\n      value: [getDicomCodeItem(content.conceptNameCode)]\n    };\n  }\n\n  // set appropriate value tag (data and time are stored as string)\n  if (content.valueType === 'CODE') {\n    contentItem.ConceptCodeSequence = {\n      value: [getDicomCodeItem(content.value)]\n    };\n  } else if (content.valueType === ValueTypes.num) {\n    contentItem = {\n      ...contentItem,\n      ...getDicomNumericMeasurementItem(content.value)\n    };\n  } else if (content.valueType === ValueTypes.image) {\n    contentItem = {\n      ...contentItem,\n      ...getDicomImageReferenceItem(content.value)\n    };\n  } else if (content.valueType === ValueTypes.composite) {\n    contentItem = {\n      ...contentItem,\n      ...getDicomSopInstanceReferenceItem(content.value)\n    };\n  } else if (content.valueType === ValueTypes.scoord) {\n    contentItem = {\n      ...contentItem,\n      ...getDicomSpatialCoordinateItem(content.value)\n    };\n  } else if (content.valueType === ValueTypes.scoord3d) {\n    contentItem = {\n      ...contentItem,\n      ...getDicomSpatialCoordinate3DItem(content.value)\n    };\n  } else {\n    const valueTagName = ValueTypeValueTagName[content.valueType];\n    if (typeof valueTagName !== 'undefined') {\n      contentItem[valueTagName] = content.value;\n    } else {\n      console.warn('Unsupported output ValueType: ' + content.valueType);\n    }\n  }\n\n  if (content.contentSequence.length !== 0) {\n    contentItem.ContentSequence = {\n      value: []\n    };\n    for (const item of content.contentSequence) {\n      contentItem.ContentSequence.value.push(getDicomSRContentItem(item));\n    }\n  }\n\n  return contentItem;\n}\n\n/**\n * Get a DicomSRContent from a value.\n *\n * @param {string} name The value name.\n * @param {object} value The value.\n * @param {string} unit The values' unit.\n * @param {string} [relation] Optional content relationhip.\n * @returns {DicomSRContent|undefined} The SR content.\n */\nexport function getSRContentFromValue(\n  name, value, unit, relation) {\n  const conceptNameCode = getConceptNameCode(name);\n\n  if (typeof conceptNameCode === 'undefined') {\n    return undefined;\n  }\n\n  let relationShip = RelationshipTypes.contains;\n  if (typeof relation !== 'undefined') {\n    relationShip = relation;\n  }\n\n  const content = new DicomSRContent(ValueTypes.num);\n  content.relationshipType = relationShip;\n  content.conceptNameCode = conceptNameCode;\n\n  const measure = new MeasuredValue();\n  measure.numericValue = value;\n  measure.measurementUnitsCode = getMeasurementUnitsCode(unit);\n  const numMeasure = new NumericMeasurement();\n  numMeasure.measuredValue = measure;\n\n  content.value = numMeasure;\n\n  return content;\n}","import {Vector3D} from '../math/vector.js';\nimport {Point3D, Point2D} from '../math/point.js';\nimport {isIdentityMat33} from '../math/matrix.js';\nimport {\n  getCosinesFromOrientation,\n  getTargetOrientation\n} from '../math/orientation.js';\nimport {getOrientedArray3D, getDeOrientedArray3D} from './geometry.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point} from '../math/point.js';\nimport {Index} from '../math/index.js';\nimport {Geometry} from '../image/geometry.js';\nimport {Matrix33} from '../math/matrix.js';\nimport {Spacing} from './spacing.js';\nimport {Scalar2D, Scalar3D} from '../math/scalar.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Plane geometry helper.\n */\nexport class PlaneHelper {\n\n  /**\n   * The image geometry.\n   *\n   * @type {Geometry}\n   */\n  #imageGeometry;\n\n  /**\n   * The associated spacing.\n   *\n   * @type {Spacing}\n   */\n  #spacing;\n\n  /**\n   * The image orientation.\n   *\n   * @type {Matrix33}\n   */\n  #imageOrientation;\n\n  /**\n   * The viewe orientation.\n   *\n   * @type {Matrix33}\n   */\n  #viewOrientation;\n\n  /**\n   * The target orientation.\n   *\n   * @type {Matrix33}\n   */\n  #targetOrientation;\n\n  /**\n   * @param {Geometry} imageGeometry The image geometry.\n   * @param {Matrix33} viewOrientation The view orientation.\n   */\n  constructor(imageGeometry, viewOrientation) {\n    this.#imageGeometry = imageGeometry;\n    this.#spacing = imageGeometry.getRealSpacing();\n    this.#imageOrientation = imageGeometry.getOrientation();\n    this.#viewOrientation = viewOrientation;\n\n    this.#targetOrientation = getTargetOrientation(\n      this.#imageOrientation, viewOrientation);\n  }\n\n  /**\n   * Get the view orientation.\n   *\n   * @returns {Matrix33} The orientation matrix.\n   */\n  getViewOrientation() {\n    return this.#viewOrientation;\n  }\n\n  /**\n   * Get the target orientation.\n   *\n   * @returns {Matrix33} The orientation matrix.\n   */\n  getTargetOrientation() {\n    return this.#targetOrientation;\n  }\n\n  /**\n   * Get a 3D offset from a plane one.\n   *\n   * @param {Scalar2D} offset2D The plane offset as {x,y}.\n   * @returns {Vector3D} The 3D world offset.\n   */\n  getOffset3DFromPlaneOffset(offset2D) {\n    // make 3D\n    const planeOffset = new Vector3D(\n      offset2D.x, offset2D.y, 0);\n    // de-orient\n    const pixelOffset = this.getTargetDeOrientedVector3D(planeOffset);\n    // ~indexToWorld\n    return new Vector3D(\n      pixelOffset.getX() * this.#spacing.get(0),\n      pixelOffset.getY() * this.#spacing.get(1),\n      pixelOffset.getZ() * this.#spacing.get(2));\n  }\n\n  /**\n   * Get a plane offset from a 3D one.\n   *\n   * @param {Scalar3D} offset3D The 3D offset as {x,y,z}.\n   * @returns {Scalar2D} The plane offset as {x,y}.\n   */\n  getPlaneOffsetFromOffset3D(offset3D) {\n    // ~worldToIndex\n    const pixelOffset = new Vector3D(\n      offset3D.x / this.#spacing.get(0),\n      offset3D.y / this.#spacing.get(1),\n      offset3D.z / this.#spacing.get(2));\n    // orient\n    const planeOffset = this.getTargetOrientedVector3D(pixelOffset);\n    // make 2D\n    return {\n      x: planeOffset.getX(),\n      y: planeOffset.getY()\n    };\n  }\n\n  /**\n   * Orient an input vector from real to target space.\n   *\n   * @param {Vector3D} vector The input vector.\n   * @returns {Vector3D} The oriented vector.\n   */\n  getTargetOrientedVector3D(vector) {\n    let planeVector = vector;\n    if (typeof this.#targetOrientation !== 'undefined') {\n      planeVector =\n        this.#targetOrientation.getInverse().multiplyVector3D(vector);\n    }\n    return planeVector;\n  }\n\n  /**\n   * De-orient an input vector from target to real space.\n   *\n   * @param {Vector3D} planeVector The input vector.\n   * @returns {Vector3D} The de-orienteded vector.\n   */\n  getTargetDeOrientedVector3D(planeVector) {\n    let vector = planeVector;\n    if (typeof this.#targetOrientation !== 'undefined') {\n      vector = this.#targetOrientation.multiplyVector3D(planeVector);\n    }\n    return vector;\n  }\n\n  /**\n   * De-orient an input point from target to real space.\n   *\n   * @param {Point3D} planePoint The input point.\n   * @returns {Point3D} The de-orienteded point.\n   */\n  getTargetDeOrientedPoint3D(planePoint) {\n    let point = planePoint;\n    if (typeof this.#targetOrientation !== 'undefined') {\n      point = this.#targetOrientation.multiplyPoint3D(planePoint);\n    }\n    return point;\n  }\n\n  /**\n   * Orient an input vector from target to image space.\n   *\n   * @param {Vector3D} planeVector The input vector.\n   * @returns {Vector3D} The orienteded vector.\n   */\n  getImageOrientedVector3D(planeVector) {\n    let vector = planeVector;\n    if (typeof this.#viewOrientation !== 'undefined') {\n      // image oriented => view de-oriented\n      const values = getDeOrientedArray3D(\n        [\n          planeVector.getX(),\n          planeVector.getY(),\n          planeVector.getZ()\n        ],\n        this.#viewOrientation);\n      vector = new Vector3D(\n        values[0],\n        values[1],\n        values[2]\n      );\n    }\n    return vector;\n  }\n\n  /**\n   * Orient an input point from target to image space.\n   *\n   * @param {Point3D} planePoint The input vector.\n   * @returns {Point3D} The orienteded vector.\n   */\n  getImageOrientedPoint3D(planePoint) {\n    let point = planePoint;\n    if (typeof this.#viewOrientation !== 'undefined') {\n      // image oriented => view de-oriented\n      const values = getDeOrientedArray3D(\n        [\n          planePoint.getX(),\n          planePoint.getY(),\n          planePoint.getZ()\n        ],\n        this.#viewOrientation);\n      point = new Point3D(\n        values[0],\n        values[1],\n        values[2]\n      );\n    }\n    return point;\n  }\n\n  /**\n   * De-orient an input vector from image to target space.\n   *\n   * @param {Vector3D} vector The input vector.\n   * @returns {Vector3D} The de-orienteded vector.\n   */\n  getImageDeOrientedVector3D(vector) {\n    let planeVector = vector;\n    if (typeof this.#viewOrientation !== 'undefined') {\n      // image de-oriented => view oriented\n      const orientedValues = getOrientedArray3D(\n        [\n          vector.getX(),\n          vector.getY(),\n          vector.getZ()\n        ],\n        this.#viewOrientation);\n      planeVector = new Vector3D(\n        orientedValues[0],\n        orientedValues[1],\n        orientedValues[2]\n      );\n    }\n    return planeVector;\n  }\n\n  /**\n   * De-orient an input point from image to target space.\n   *\n   * @param {Point3D} point The input point.\n   * @returns {Point3D} The de-orienteded point.\n   */\n  getImageDeOrientedPoint3D(point) {\n    let planePoint = point;\n    if (typeof this.#viewOrientation !== 'undefined') {\n      // image de-oriented => view oriented\n      const orientedValues = getOrientedArray3D(\n        [\n          point.getX(),\n          point.getY(),\n          point.getZ()\n        ],\n        this.#viewOrientation);\n      planePoint = new Point3D(\n        orientedValues[0],\n        orientedValues[1],\n        orientedValues[2]\n      );\n    }\n    return planePoint;\n  }\n\n  /**\n   * Get a world position from a 2D plane position.\n   *\n   * @param {Point2D} point2D The plane point.\n   * @param {number} k The slice index.\n   * @returns {Point3D} The world position.\n   */\n  getPositionFromPlanePoint(point2D, k) {\n    const planePoint = new Point3D(point2D.getX(), point2D.getY(), k);\n    // de-orient\n    const point = this.getImageOrientedPoint3D(planePoint);\n    // ~indexToWorld to not loose precision\n    return this.#imageGeometry.pointToWorld(point);\n  }\n\n  /**\n   * Get a 2D plane position from a world position.\n   *\n   * @param {Point} point The world position.\n   * @returns {Point3D} The plane point.\n   */\n  getPlanePointFromPosition(point) {\n    const point3D = this.#imageGeometry.worldToPoint(point);\n    return this.getImageDeOrientedPoint3D(point3D);\n  }\n\n  /**\n   * Get the cosines of this plane.\n   *\n   * @returns {number[]} The 2 cosines vectors (3D).\n   */\n  getCosines() {\n    return getCosinesFromOrientation(this.#targetOrientation);\n  }\n\n  /**\n   * Get a list of points that define the plane at input position,\n   *   given this classes orientation.\n   *\n   * @param {Point} position The position.\n   * @returns {Point3D[]} An origin and 2 cosines vectors.\n   */\n  getPlanePoints(position) {\n    // snap to grid\n    const index = this.worldToIndex(position);\n    const snapPosition = this.indexToWorld(index);\n    // get plane point\n    const planePoint = this.getPlanePointFromPosition(snapPosition);\n    // get origin\n    const planeOrigin = this.getPositionFromPlanePoint(\n      new Point2D(0, 0), planePoint.getZ());\n    // find image origin\n    const origins = this.#imageGeometry.getOrigins();\n    const closestOriginIndex = planeOrigin.getClosest(origins);\n    const imageOrigin = origins[closestOriginIndex];\n\n    // use image origin for scroll to cope with\n    // possible irregular slice spacing\n    const pValues = planeOrigin.getValues();\n    const iValues = imageOrigin.getValues();\n    const scrollDimIndex = this.getNativeScrollDimIndex();\n    pValues[scrollDimIndex] = iValues[scrollDimIndex];\n\n    // plane cosines\n    const cosines = this.getCosines();\n\n    return [\n      new Point3D(pValues[0], pValues[1], pValues[2]),\n      new Point3D(cosines[0], cosines[1], cosines[2]),\n      new Point3D(cosines[3], cosines[4], cosines[5])\n    ];\n  }\n\n  /**\n   * Image world to index.\n   *\n   * @param {Point} point The input point.\n   * @returns {Index} The corresponding index.\n   */\n  worldToIndex(point) {\n    return this.#imageGeometry.worldToIndex(point);\n  }\n\n  /**\n   * Image index to world.\n   *\n   * @param {Index} index The input index.\n   * @returns {Point} The corresponding point.\n   */\n  indexToWorld(index) {\n    return this.#imageGeometry.indexToWorld(index);\n  }\n\n  /**\n   * Is this view in the same orientation as the image aquisition.\n   *\n   * @returns {boolean} True if in aquisition plane.\n   */\n  isAquisitionOrientation() {\n    return isIdentityMat33(this.#viewOrientation);\n  }\n\n  /**\n   * Reorder values to follow target orientation.\n   *\n   * @param {Scalar3D} values Values as {x,y,z}.\n   * @returns {Scalar3D} Reoriented values as {x,y,z}.\n   */\n  getTargetOrientedPositiveXYZ(values) {\n    const orientedValues = getOrientedArray3D(\n      [\n        values.x,\n        values.y,\n        values.z\n      ],\n      this.#targetOrientation);\n    return {\n      x: orientedValues[0],\n      y: orientedValues[1],\n      z: orientedValues[2]\n    };\n  }\n\n  /**\n   * Get the (view) scroll dimension index.\n   *\n   * @returns {number} The index.\n   */\n  getScrollDimIndex() {\n    let index = null;\n    if (typeof this.#viewOrientation !== 'undefined') {\n      index = this.#viewOrientation.getThirdColMajorDirection();\n    } else {\n      index = 2;\n    }\n    return index;\n  }\n\n  /**\n   * Get the native (image) scroll dimension index.\n   *\n   * @returns {number} The index.\n   */\n  getNativeScrollDimIndex() {\n    let index = null;\n    if (typeof this.#imageOrientation !== 'undefined') {\n      index = this.#imageOrientation.getThirdColMajorDirection();\n    } else {\n      index = 2;\n    }\n    return index;\n  }\n\n} // class PlaneHelper\n","import {mergeGeometries} from './geometry.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point} from '../math/point.js';\nimport {Index} from '../math/index.js';\nimport {View} from './view.js';\nimport {Geometry} from './geometry.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * View position accessor class.\n */\nclass ViewPositionAccessor {\n  /**\n   * @type {View}\n   */\n  #view;\n  /**\n   * @param {View} view The view.\n   */\n  constructor(view) {\n    this.#view = view;\n  }\n  /**\n   * Get the current position.\n   *\n   * @returns {Point} The position.\n   */\n  getCurrentPosition() {\n    return this.#view.getCurrentPosition();\n  }\n  /**\n   * Set the current position.\n   *\n   * @param {Point} position The position.\n   * @param {boolean} [silent] Flag to fire event or not.\n   * @returns {boolean} True if possible and in bounds.\n   */\n  setCurrentPosition(position, silent) {\n    let res = false;\n    if (typeof position !== 'undefined') {\n      res = this.#view.setCurrentPosition(position, silent);\n    }\n    return res;\n  }\n}\n\n/**\n * Position helper.\n */\nexport class PositionHelper {\n\n  /**\n   * @type {ViewPositionAccessor}\n   */\n  #positionAccessor;\n\n  /**\n   * @type {Geometry}\n   */\n  #geometry;\n\n  /**\n   * @type {Point}\n   */\n  #currentPosition;\n\n  /**\n   * @type {number}\n   */\n  #scrollDimIndex;\n\n  /**\n   * @param {View} view The associated view.\n   */\n  constructor(view) {\n    this.#positionAccessor = new ViewPositionAccessor(view);\n    this.#geometry = view.getImage().getGeometry();\n    this.#currentPosition = view.getCurrentPosition();\n    this.#scrollDimIndex = view.getScrollDimIndex();\n  }\n\n  /**\n   * Get the geometry.\n   *\n   * @returns {Geometry} The geometry.\n   */\n  getGeometry() {\n    return this.#geometry;\n  }\n\n  /**\n   * Get the scroll index.\n   *\n   * @returns {number} The scroll index.\n   */\n  getScrollDimIndex() {\n    return this.#scrollDimIndex;\n  }\n\n  /**\n   * Get the maximum dimension value.\n   *\n   * @param {number} dim The dimension.\n   * @returns {number} The maximum value.\n   */\n  getMaximumDimValue(dim) {\n    return this.#geometry.getSize().get(dim) - 1;\n  }\n\n  /**\n   * Get the maximum scroll value.\n   *\n   * @returns {number} The maximum value.\n   */\n  getMaximumScrollValue() {\n    return this.getMaximumDimValue(this.#scrollDimIndex);\n  }\n\n  /**\n   * Get the current position.\n   *\n   * @returns {Point} The current position.\n   */\n  getCurrentPosition() {\n    return this.#geometry.getSize().normalisePoint(\n      this.#positionAccessor.getCurrentPosition(),\n      this.#currentPosition\n    );\n  }\n\n  /**\n   * Get the value at dimension index for the current position.\n   *\n   * @param {number} dim The dimension.\n   * @returns {number} The value.\n   */\n  getCurrentPositionDimValue(dim) {\n    return this.getCurrentIndex().get(dim);\n  }\n\n  /**\n   * Get the value at scroll index for the current position.\n   *\n   * @returns {number} The value.\n   */\n  getCurrentPositionScrollValue() {\n    return this.getCurrentPositionDimValue(this.#scrollDimIndex);\n  }\n\n  /**\n   * Get the current position updated at the provided dimension index\n   *   with the input value.\n   *\n   * @param {number} dim The dimension.\n   * @param {number} value The value to use at dimension index.\n   * @returns {Point} The position.\n   */\n  getCurrentPositionAtDimValue(dim, value) {\n    const values = this.getCurrentIndex().getValues();\n    values[dim] = value;\n    return this.#geometry.indexToWorld(new Index(values));\n  }\n\n  /**\n   * Get the current position updated at scroll index with the input value.\n   *\n   * @param {number} value The value to use at scroll index.\n   * @returns {Point} The position.\n   */\n  getCurrentPositionAtScrollValue(value) {\n    return this.getCurrentPositionAtDimValue(this.#scrollDimIndex, value);\n  }\n\n  /**\n   * Get the current index.\n   *\n   * @returns {Index} The current index.\n   */\n  getCurrentIndex() {\n    return this.#geometry.worldToIndex(this.getCurrentPosition());\n  }\n\n  /**\n   * Set the current position.\n   *\n   * @param {Point} position The position.\n   * @param {boolean} [silent] Flag to fire event or not.\n   * @returns {boolean} True if possible and in bounds.\n   */\n  setCurrentPosition(position, silent) {\n    let res = false;\n    if (typeof position !== 'undefined') {\n      // save locally\n      this.#currentPosition = this.#geometry.getSize().normalisePoint(\n        position, this.#currentPosition);\n      // pass on to accessor\n      res = this.#positionAccessor.setCurrentPosition(position, silent);\n    }\n    return res;\n  }\n\n  /**\n   * Set the current position only if it is in the geometry bounds.\n   *\n   * @param {Point} position The position.\n   * @param {boolean} [silent] Flag to fire event or not.\n   * @returns {boolean} True if possible and in bounds.\n   */\n  setCurrentPositionSafe(position, silent) {\n    let res = false;\n    if (this.isPositionInBounds(position)) {\n      res = this.setCurrentPosition(position, silent);\n    }\n    return res;\n  }\n\n  /**\n   * Merge with another helper.\n   *\n   * @param {PositionHelper} rhs The helper to merge with this one.\n   */\n  merge(rhs) {\n    // check compatibility\n    if (this.#scrollDimIndex !== rhs.getScrollDimIndex()) {\n      throw new Error(\n        'Cannot merge helper of a view with different orientation'\n      );\n    }\n\n    // merge geometries\n    this.#geometry = mergeGeometries(this.#geometry, rhs.getGeometry());\n\n    // merge pos\n    this.#currentPosition = this.#geometry.getSize().normalisePoint(\n      this.#currentPosition, rhs.getCurrentPosition()\n    );\n  }\n\n  /**\n   * Check if the current position (default) or\n   * the provided position is in bounds.\n   *\n   * @param {Point} position Optional position.\n   * @returns {boolean} True is the position is in bounds.\n   */\n  isPositionInBounds(position) {\n    const index = this.#geometry.worldToIndex(position);\n    const dirs = [this.#scrollDimIndex];\n    if (index.length() === 4) {\n      dirs.push(3);\n    }\n    return this.#geometry.isIndexInBounds(index, dirs);\n  }\n\n  /**\n   * Get the current position incremented in the input direction.\n   *\n   * @param {number} dim The direction in which to increment.\n   * @returns {Point} The resulting point.\n   */\n  getIncrementPosition(dim) {\n    const nextIndex = this.getCurrentIndex().next(dim);\n    return this.#geometry.indexToWorld(nextIndex);\n  }\n\n  /**\n   * Get the current position decremented in the input direction.\n   *\n   * @param {number} dim The direction in which to decrement.\n   * @returns {Point} The resulting point.\n   */\n  getDecrementPosition(dim) {\n    const previousIndex = this.getCurrentIndex().previous(dim);\n    return this.#geometry.indexToWorld(previousIndex);\n  }\n\n  /**\n   * Increment the current position along the provided dim.\n   *\n   * @param {number} dim The direction in which to increment.\n   * @returns {boolean} True if possible and in bounds.\n   */\n  incrementPosition(dim) {\n    return this.setCurrentPositionSafe(this.getIncrementPosition(dim));\n  }\n\n  /**\n   * Decrement the current position along the provided dim.\n   *\n   * @param {number} dim The direction in which to decrement.\n   * @returns {boolean} True if possible and in bounds.\n   */\n  decrementPosition(dim) {\n    return this.setCurrentPositionSafe(this.getDecrementPosition(dim));\n  }\n\n  /**\n   * Increment the current position along the scroll dimension.\n   *\n   * @returns {boolean} True if possible and in bounds.\n   */\n  incrementPositionAlongScroll() {\n    return this.incrementPosition(this.#scrollDimIndex);\n  }\n\n  /**\n   * Decrement the current position along the scroll dimension.\n   *\n   * @returns {boolean} True if possible and in bounds.\n   */\n  decrementPositionAlongScroll() {\n    return this.decrementPosition(this.#scrollDimIndex);\n  }\n\n}","import {Index} from '../math/index.js';\nimport {Vector3D} from '../math/vector.js';\nimport {Point3D} from '../math/point.js';\nimport {isIdentityMat33} from '../math/matrix.js';\nimport {Size} from '../image/size.js';\nimport {Spacing} from '../image/spacing.js';\nimport {Image} from '../image/image.js';\nimport {Geometry} from '../image/geometry.js';\nimport {PlaneHelper} from '../image/planeHelper.js';\nimport {\n  getSliceIterator,\n  getIteratorValues,\n  getRegionSliceIterator,\n  getVariableRegionSliceIterator\n} from '../image/iterator.js';\nimport {PositionHelper} from '../image/positionHelper.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {View} from '../image/view.js';\nimport {WindowLevel} from '../image/windowLevel.js';\nimport {Point, Point2D} from '../math/point.js';\nimport {Scalar2D} from '../math/scalar.js';\nimport {Matrix33} from '../math/matrix.js';\nimport {ViewLayer} from '../gui/viewLayer.js';\nimport {MaskSegmentViewHelper} from '../image/maskSegmentViewHelper.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * View controller.\n */\nexport class ViewController {\n\n  /**\n   * Associated View.\n   *\n   * @type {View}\n   */\n  #view;\n\n  /**\n   * Plane helper.\n   *\n   * @type {PlaneHelper}\n   */\n  #planeHelper;\n\n  /**\n   * Third dimension player ID (created by setInterval).\n   *\n   * @type {number|undefined}\n   */\n  #playerID;\n\n  /**\n   * @param {View} view The associated view.\n   */\n  constructor(view) {\n    // check view\n    if (typeof view.getImage() === 'undefined') {\n      throw new Error('View does not have an image, cannot setup controller');\n    }\n\n    this.#view = view;\n\n    // setup the plane helper\n    this.#planeHelper = new PlaneHelper(\n      view.getImage().getGeometry(),\n      view.getOrientation()\n    );\n  }\n\n  /**\n   * Get the plane helper.\n   *\n   * @returns {PlaneHelper} The helper.\n   */\n  getPlaneHelper() {\n    return this.#planeHelper;\n  }\n\n  /**\n   * Update the plane helper if there is a change in the image geometry.\n   */\n  updatePlaneHelper() {\n    this.#planeHelper = new PlaneHelper(\n      this.#view.getImage().getGeometry(),\n      this.#view.getOrientation()\n    );\n  }\n\n  /**\n   * Check is the associated image is a mask.\n   *\n   * @returns {boolean} True if the associated image is a mask.\n   */\n  isMask() {\n    return this.#view.isMask();\n  }\n\n  /**\n   * Initialise the controller.\n   */\n  initialise() {\n    // set window/level to first preset\n    this.resetWindowLevel();\n    // default position\n    this.resetPosition();\n  }\n\n  /**\n   * Reset the window level.\n   */\n  resetWindowLevel() {\n    // set window/level to first preset\n    this.setWindowLevelPresetById(0);\n  }\n\n  /**\n   * Reset the position.\n   */\n  resetPosition() {\n    // default position\n    this.setCurrentPosition(this.getPositionFromPlanePoint(\n      new Point2D(0, 0)\n    ));\n  }\n\n  /**\n   * Get the image modality.\n   *\n   * @returns {string} The modality.\n   */\n  getModality() {\n    return this.#view.getImage().getMeta().Modality;\n  }\n\n  /**\n   * Get the image SOP class UID.\n   *\n   * @returns {string|undefined} The uid.\n   */\n  getSopClassUid() {\n    return this.#view.getImage().getMeta().SOPClassUID;\n  }\n\n  /**\n   * Get the window/level presets names.\n   *\n   * @returns {string[]} The presets names.\n   */\n  getWindowLevelPresetsNames() {\n    return this.#view.getWindowPresetsNames();\n  }\n\n  /**\n   * Add window/level presets to the view.\n   *\n   * @param {object} presets A preset object.\n   * @returns {object} The list of presets.\n   */\n  addWindowLevelPresets(presets) {\n    return this.#view.addWindowPresets(presets);\n  }\n\n  /**\n   * Set the window level to the preset with the input name.\n   *\n   * @param {string} name The name of the preset to activate.\n   */\n  setWindowLevelPreset(name) {\n    this.#view.setWindowLevelPreset(name);\n  }\n\n  /**\n   * Set the window level to the preset with the input id.\n   *\n   * @param {number} id The id of the preset to activate.\n   */\n  setWindowLevelPresetById(id) {\n    this.#view.setWindowLevelPresetById(id);\n  }\n\n  /**\n   * Check if the controller is playing.\n   *\n   * @returns {boolean} True if the controler is playing.\n   */\n  isPlaying() {\n    return (typeof this.#playerID !== 'undefined');\n  }\n\n  /**\n   * Get a position helper: returns a new helper\n   * based on the current view.\n   *\n   * @returns {PositionHelper} The helper.\n   */\n  getPositionHelper() {\n    return new PositionHelper(this.#view);\n  }\n\n  /**\n   * Get the current position.\n   *\n   * @returns {Point} The position.\n   */\n  getCurrentPosition() {\n    return this.#view.getCurrentPosition();\n  }\n\n  /**\n   * Get the current index.\n   *\n   * @returns {Index} The current index.\n   */\n  getCurrentIndex() {\n    return this.#view.getCurrentIndex();\n  }\n\n  /**\n   * Get the SOP image UID of the current image.\n   *\n   * @returns {string} The UID.\n   */\n  getCurrentImageUid() {\n    return this.#view.getCurrentImageUid();\n  }\n\n  /**\n   * Get the image origin for a image UID.\n   *\n   * @param {string} uid The UID.\n   * @returns {Point3D|undefined} The origin.\n   */\n  getOriginForImageUid(uid) {\n    return this.#view.getOriginForImageUid(uid);\n  }\n\n  /**\n   * Check if the image includes an UID.\n   *\n   * @param {string} uid The UID.\n   * @returns {boolean} True if present.\n   */\n  includesImageUid(uid) {\n    return this.#view.includesImageUid(uid);\n  }\n\n  /**\n   * Get the current oriented index.\n   *\n   * @returns {Index} The index.\n   */\n  getCurrentOrientedIndex() {\n    let res = this.getCurrentIndex();\n    if (typeof this.#view.getOrientation() !== 'undefined') {\n      // view oriented => image de-oriented\n      const vector = this.#planeHelper.getImageDeOrientedVector3D(\n        new Vector3D(res.get(0), res.get(1), res.get(2))\n      );\n      res = new Index([\n        vector.getX(), vector.getY(), vector.getZ()\n      ]);\n    }\n    return res;\n  }\n\n  /**\n   * Get the scroll dimension index.\n   *\n   * @returns {number} The index.\n   */\n  getScrollDimIndex() {\n    return this.#view.getScrollDimIndex();\n  }\n\n  /**\n   * Get the current index scroll value.\n   *\n   * @returns {number} The value.\n   */\n  getCurrentIndexScrollValue() {\n    return this.getCurrentIndex().get(this.#view.getScrollDimIndex());\n  }\n\n  /**\n   * Get the first origin or at a given position.\n   *\n   * @param {Point} [position] Optional position.\n   * @returns {Point3D} The origin.\n   */\n  getOrigin(position) {\n    return this.#view.getOrigin(position);\n  }\n\n  /**\n   * Is this view in the same orientation as the image aquisition.\n   *\n   * @returns {boolean} True if in aquisition plane.\n   */\n  isAquisitionOrientation() {\n    return this.#view.isAquisitionOrientation();\n  }\n\n  /**\n   * Get a list of points that define the plane at input position,\n   *   given this classes orientation.\n   *\n   * @param {Point} position The position.\n   * @returns {Point3D[]} An origin and 2 cosines vectors.\n   */\n  getPlanePoints(position) {\n    return this.#planeHelper.getPlanePoints(position);\n  }\n\n  /**\n   * Get the current scroll position value.\n   *\n   * @returns {number} The value.\n   */\n  getCurrentScrollPosition() {\n    const scrollDimIndex = this.#view.getScrollDimIndex();\n    return this.#view.getCurrentPosition().get(scrollDimIndex);\n  }\n\n  /**\n   * Generate display image data to be given to a canvas.\n   *\n   * @param {ImageData} array The array to fill in.\n   * @param {Index} [index] Optional index at which to generate,\n   *   otherwise generates at current index.\n   */\n  generateImageData(array, index) {\n    this.#view.generateImageData(array, index);\n  }\n\n  /**\n   * Set the associated image.\n   *\n   * @param {Image} img The associated image.\n   */\n  setImage(img) {\n    // geometries to check\n    const geometry0 = this.#view.getImage().getGeometry();\n    const geometry1 = img.getGeometry();\n\n    this.#view.setImage(img);\n\n    // update if geometry changes\n    if (!geometry0.equals(geometry1)) {\n      // update helpers\n      this.updatePlaneHelper();\n    }\n  }\n\n  /**\n   * Get the current view (2D) spacing.\n   *\n   * @returns {Scalar2D} The spacing as a 2D array.\n   */\n  get2DSpacing() {\n    const spacing = this.#view.getImage().getGeometry().getSpacing(\n      this.#view.getOrientation());\n    return spacing.get2D();\n  }\n\n  /**\n   * Get the image rescaled value at the input position.\n   *\n   * @param {Point} position The input position.\n   * @returns {number|undefined} The image value or undefined if out of bounds\n   *   or no quantifiable (for ex RGB).\n   */\n  getRescaledImageValue(position) {\n    const image = this.#view.getImage();\n    if (!image.canQuantify()) {\n      return;\n    }\n    const geometry = image.getGeometry();\n    const index = geometry.worldToIndex(position);\n    let value;\n    if (geometry.isIndexInBounds(index)) {\n      value = image.getRescaledValueAtIndex(index);\n    }\n    return value;\n  }\n\n  /**\n   * Get the image pixel unit.\n   *\n   * @returns {string} The unit.\n   */\n  getPixelUnit() {\n    return this.#view.getImage().getMeta().pixelUnit;\n  }\n\n  /**\n   * Get the image length unit.\n   *\n   * @returns {string} The unit.\n   */\n  getLengthUnit() {\n    return this.#view.getImage().getMeta().lengthUnit;\n  }\n\n  /**\n   * Extract a slice from an image at the given index and orientation.\n   *\n   * @param {Image} image The image to parse.\n   * @param {Index} index The index at which to get the\n   *   image values.\n   * @param {boolean} isRescaled Flag for rescaled values (default false).\n   * @param {Matrix33} orientation The desired orientation.\n   * @returns {Image} The extracted slice.\n   */\n  #getSlice(image, index, isRescaled, orientation) {\n    // generate slice values\n    const sliceIter = getSliceIterator(\n      image,\n      index,\n      isRescaled,\n      orientation\n    );\n    const sliceValues = getIteratorValues(sliceIter);\n    // oriented geometry\n    const orientedSize = image.getGeometry().getSize(orientation);\n    const sizeValues = orientedSize.getValues();\n    sizeValues[2] = 1;\n    const sliceSize = new Size(sizeValues);\n    const orientedSpacing = image.getGeometry().getSpacing(orientation);\n    const spacingValues = orientedSpacing.getValues();\n    spacingValues[2] = 1;\n    const sliceSpacing = new Spacing(spacingValues);\n    const sliceOrigin = new Point3D(0, 0, 0);\n    const sliceGeometry =\n      new Geometry([sliceOrigin], sliceSize, sliceSpacing);\n    // slice image\n    // @ts-ignore\n    return new Image(sliceGeometry, sliceValues);\n  }\n\n  /**\n   * Get some values from the associated image in a region.\n   *\n   * @param {Point2D} min Minimum point.\n   * @param {Point2D} max Maximum point.\n   * @param {Index} index The index at which to get the\n   *   image values (combined with min/max).\n   * @returns {Array} A list of values.\n   */\n  getImageRegionValues(min, max, index) {\n    let image = this.#view.getImage();\n    const orientation = this.#view.getOrientation();\n    let imageIndex = index;\n    let rescaled = true;\n\n    // create oriented slice if needed\n    if (!isIdentityMat33(orientation)) {\n      image = this.#getSlice(image, imageIndex, rescaled, orientation);\n      // update position\n      imageIndex = new Index([0, 0, 0]);\n      rescaled = false;\n    }\n\n    // get region values\n    const iter = getRegionSliceIterator(\n      image, imageIndex, rescaled, min, max);\n    let values = [];\n    if (iter) {\n      values = getIteratorValues(iter);\n    }\n    return values;\n  }\n\n  /**\n   * Get some values from the associated image in variable regions.\n   *\n   * @param {number[][][]} regions A list of [x, y] pairs (min, max).\n   * @param {Index} index The index at which to get the\n   *   image values (combined with regions min/max).\n   * @returns {Array} A list of values.\n   */\n  getImageVariableRegionValues(regions, index) {\n    let image = this.#view.getImage();\n    const orientation = this.#view.getOrientation();\n    let imageIndex = index;\n    let rescaled = true;\n\n    // create oriented slice if needed\n    if (!isIdentityMat33(orientation)) {\n      image = this.#getSlice(image, imageIndex, rescaled, orientation);\n      // update position\n      imageIndex = new Index([0, 0, 0]);\n      rescaled = false;\n    }\n\n    // get region values\n    const iter = getVariableRegionSliceIterator(\n      image, imageIndex, rescaled, regions);\n    let values = [];\n    if (iter) {\n      values = getIteratorValues(iter);\n    }\n    return values;\n  }\n\n  /**\n   * Can the image values be quantified?\n   *\n   * @returns {boolean} True if possible.\n   */\n  canQuantifyImage() {\n    return this.#view.getImage().canQuantify();\n  }\n\n  /**\n   * Can window and level be applied to the data?\n   *\n   * @returns {boolean} True if possible.\n   * @deprecated Since v0.33, please use isMonochrome instead.\n   */\n  canWindowLevel() {\n    return this.isMonochrome();\n  }\n\n  /**\n   * Is the data monochrome.\n   *\n   * @returns {boolean} True if the data is monochrome.\n   */\n  isMonochrome() {\n    return this.#view.getImage().isMonochrome();\n  }\n\n  /**\n   * Can the data be scrolled?\n   *\n   * @returns {boolean} True if the data has either the third dimension\n   * or above greater than one.\n   */\n  canScroll() {\n    return this.#view.getImage().canScroll(this.#view.getOrientation());\n  }\n\n  /**\n   * Get the oriented image size.\n   *\n   * @returns {Size} The size.\n   */\n  getImageSize() {\n    return this.#view.getImage().getGeometry().getSize(\n      this.#view.getOrientation());\n  }\n\n  /**\n   * Get the oriented image spacing.\n   *\n   * @returns {Spacing} The spacing.\n   */\n  getImageSpacing() {\n    return this.#view.getImage().getGeometry().getSpacing(\n      this.#view.getOrientation());\n  }\n\n  /**\n   * Is the data size larger than one in the given dimension?\n   *\n   * @param {number} dim The dimension.\n   * @returns {boolean} True if the image size is larger than one\n   *   in the given dimension.\n   */\n  moreThanOne(dim) {\n    return this.getImageSize().moreThanOne(dim);\n  }\n\n  /**\n   * Get the image world (mm) 2D size.\n   *\n   * @returns {Scalar2D} The 2D size as {x,y}.\n   */\n  getImageWorldSize() {\n    const geometry = this.#view.getImage().getGeometry();\n    const size = geometry.getSize(this.#view.getOrientation()).get2D();\n    const spacing = geometry.getSpacing(this.#view.getOrientation()).get2D();\n    return {\n      x: size.x * spacing.x,\n      y: size.y * spacing.y\n    };\n  }\n\n  /**\n   * Get the image rescaled data range.\n   *\n   * @returns {object} The range as {min, max}.\n   */\n  getImageRescaledDataRange() {\n    return this.#view.getImage().getRescaledDataRange();\n  }\n\n  /**\n   * Compare the input meta data to the associated image one.\n   *\n   * @param {object} meta The meta data.\n   * @returns {boolean} True if the associated image has equal meta data.\n   */\n  equalImageMeta(meta) {\n    const imageMeta = this.#view.getImage().getMeta();\n    // loop through input meta keys\n    const metaKeys = Object.keys(meta);\n    for (let i = 0; i < metaKeys.length; ++i) {\n      const metaKey = metaKeys[i];\n      if (typeof imageMeta[metaKey] === 'undefined') {\n        return false;\n      }\n      if (imageMeta[metaKey] !== meta[metaKey]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Check if the current position (default) or\n   * the provided position is in bounds.\n   *\n   * @param {Point} [position] Optional position.\n   * @returns {boolean} True is the position is in bounds.\n   */\n  isPositionInBounds(position) {\n    return this.#view.isPositionInBounds(position);\n  }\n\n  /**\n   * Set the current position.\n   *\n   * @param {Point} pos The position.\n   * @param {boolean} [silent] If true, does not fire a\n   *   positionchange event.\n   * @returns {boolean} False if not in bounds.\n   */\n  setCurrentPosition(pos, silent) {\n    return this.#view.setCurrentPosition(pos, silent);\n  }\n\n  /**\n   * Get a world position from a 2D plane position.\n   *\n   * @param {Point2D} point2D The input point.\n   * @param {number} [k] Optional slice index,\n   *   if undefined, uses the current one.\n   * @returns {Point} The associated position.\n   */\n  getPositionFromPlanePoint(point2D, k) {\n    // keep third direction\n    if (typeof k === 'undefined') {\n      k = this.getCurrentIndexScrollValue();\n    }\n    const planePoint = new Point3D(point2D.getX(), point2D.getY(), k);\n    // de-orient\n    const point = this.#planeHelper.getImageOrientedPoint3D(planePoint);\n    // ~indexToWorld to not loose precision\n    const geometry = this.#view.getImage().getGeometry();\n    const point3D = geometry.pointToWorld(point);\n    // merge with current position to keep extra dimensions\n    return this.getCurrentPosition().mergeWith3D(point3D);\n  }\n\n  /**\n   * Check if an input plane point is in the geometrys' bounds.\n   *\n   * @param {Point2D} point2D The point to check.\n   * @returns {boolean} True if in bounds.\n   */\n  validatePlanePoint(point2D) {\n    const pos = this.getPositionFromPlanePoint(point2D);\n    const geometry = this.#view.getImage().getGeometry();\n    return geometry.isInBounds(pos);\n  }\n\n  /**\n   * Get a 2D plane position from a world position.\n   *\n   * @param {Point} point The 3D position.\n   * @returns {Point2D} The 2D position.\n   */\n  getPlanePositionFromPosition(point) {\n    // orient\n    const geometry = this.#view.getImage().getGeometry();\n    // ~worldToIndex to not loose precision\n    const point3D = geometry.worldToPoint(point);\n    const planePoint = this.#planeHelper.getImageDeOrientedPoint3D(point3D);\n    // return\n    return new Point2D(\n      planePoint.getX(),\n      planePoint.getY(),\n    );\n  }\n\n  /**\n   * Get the index of a world position.\n   *\n   * @param {Point} point The 3D position.\n   * @returns {Index} The index.\n   */\n  getIndexFromPosition(point) {\n    // orient\n    const geometry = this.#view.getImage().getGeometry();\n    // ~worldToIndex to not loose precision\n    return geometry.worldToIndex(point);\n  }\n\n  /**\n   * Set the current index.\n   *\n   * @param {Index} index The index.\n   * @param {boolean} [silent] If true, does not fire a positionchange event.\n   * @returns {boolean} False if not in bounds.\n   */\n  setCurrentIndex(index, silent) {\n    return this.#view.setCurrentIndex(index, silent);\n  }\n\n  /**\n   * Get a plane 3D position from a plane 2D position: does not compensate\n   *   for the image origin. Needed for setting the scale center...\n   *\n   * @param {Point2D} point2D The 2D position.\n   * @returns {Point3D} The 3D point.\n   */\n  getPlanePositionFromPlanePoint(point2D) {\n    // keep third direction\n    const k = this.getCurrentIndexScrollValue();\n    const planePoint = new Point3D(point2D.getX(), point2D.getY(), k);\n    // de-orient\n    const point = this.#planeHelper.getTargetDeOrientedPoint3D(planePoint);\n    // ~indexToWorld to not loose precision\n    const geometry = this.#view.getImage().getGeometry();\n    const spacing = geometry.getRealSpacing();\n    return new Point3D(\n      point.getX() * spacing.get(0),\n      point.getY() * spacing.get(1),\n      point.getZ() * spacing.get(2));\n  }\n\n  /**\n   * Get a 3D offset from a plane one.\n   *\n   * @param {Scalar2D} offset2D The plane offset as {x,y}.\n   * @returns {Vector3D} The 3D world offset.\n   */\n  getOffset3DFromPlaneOffset(offset2D) {\n    return this.#planeHelper.getOffset3DFromPlaneOffset(offset2D);\n  }\n\n  /**\n   * Scroll play: loop through all slices.\n   */\n  play() {\n    // ensure data is scrollable: dim >= 3\n    if (!this.canScroll()) {\n      return;\n    }\n    if (typeof this.#playerID === 'undefined') {\n      const image = this.#view.getImage();\n      const recommendedDisplayFrameRate =\n        image.getMeta().RecommendedDisplayFrameRate;\n      const milliseconds = this.#view.getPlaybackMilliseconds(\n        recommendedDisplayFrameRate);\n      const size = image.getGeometry().getSize();\n      const canScroll3D = size.canScroll3D();\n      const helper = this.getPositionHelper();\n\n      this.#playerID = window.setInterval(() => {\n        let canDoMore = false;\n        if (canScroll3D) {\n          canDoMore = helper.incrementPositionAlongScroll();\n        } else {\n          canDoMore = helper.incrementPosition(3);\n        }\n        // end of scroll, loop back\n        if (!canDoMore) {\n          const pos1 = this.getCurrentIndex();\n          const values = pos1.getValues();\n          const orientation = this.#view.getOrientation();\n          if (canScroll3D) {\n            values[orientation.getThirdColMajorDirection()] = 0;\n          } else {\n            values[3] = 0;\n          }\n          const index = new Index(values);\n          const geometry = this.#view.getImage().getGeometry();\n          this.setCurrentPosition(geometry.indexToWorld(index));\n        }\n      }, milliseconds);\n    } else {\n      this.stop();\n    }\n  }\n\n  /**\n   * Stop scroll playing.\n   */\n  stop() {\n    if (typeof this.#playerID !== 'undefined') {\n      clearInterval(this.#playerID);\n      this.#playerID = undefined;\n    }\n  }\n\n  /**\n   * Get the window/level.\n   *\n   * @returns {WindowLevel} The window and level.\n   */\n  getWindowLevel() {\n    return this.#view.getWindowLevel();\n  }\n\n  /**\n   * Get the current window level preset name.\n   *\n   * @returns {string} The preset name.\n   */\n  getCurrentWindowPresetName() {\n    return this.#view.getCurrentWindowPresetName();\n  }\n\n  /**\n   * Set the window and level.\n   *\n   * @param {WindowLevel} wl The window and level.\n   */\n  setWindowLevel(wl) {\n    this.#view.setWindowLevel(wl);\n  }\n\n  /**\n   * Get the colour map.\n   *\n   * @returns {string} The colour map name.\n   */\n  getColourMap() {\n    return this.#view.getColourMap();\n  }\n\n  /**\n   * Set the colour map.\n   *\n   * @param {string} name The colour map name.\n   */\n  setColourMap(name) {\n    this.#view.setColourMap(name);\n  }\n\n  /**\n   * @callback alphaFn\n   * @param {number[]|number} value The pixel value.\n   * @param {number} index The values' index.\n   * @returns {number} The opacity of the input value.\n   */\n\n  /**\n   * Set the view per value alpha function.\n   *\n   * @param {alphaFn} func The function.\n   */\n  setViewAlphaFunction(func) {\n    this.#view.setAlphaFunction(func);\n  }\n\n  /**\n   * Set the mask segment view helper to handle\n   *   hidden segments.\n   *\n   * @param {MaskSegmentViewHelper} helper The helper.\n   */\n  setMaskViewHelper(helper) {\n    this.#view.setMaskViewHelper(helper);\n  }\n\n  /**\n   * Get the fill opacity relative to the global opacity.\n   *\n   * @returns {number} The fill opacity (between 0 and 1).\n   */\n  getFillOpacity() {\n    return this.#view.getFillOpacity();\n  }\n\n  /**\n   * Set the fill opacity relative to the global opacity.\n   * This only has an effect on segmentation views, or any other alpha\n   * function that makes use of it.\n   *\n   * @param {number} opacity The fill opacity (between 0 and 1).\n   */\n  setFillOpacity(opacity) {\n    this.#view.setFillOpacity(opacity);\n  }\n\n  /**\n   * Get the thickness of the contour in pixels.\n   *\n   * @returns {number} The contour thickness (integer >= 1).\n   */\n  getContourThickness() {\n    return this.#view.getContourThickness();\n  }\n\n  /**\n   * Set the thickness of the contour in pixels.\n   * This only has an effect on segmentation views, or any other alpha\n   * function that makes use of it.\n   *\n   * @param {number} thickness The contour thickness (integer >= 1).\n   */\n  setContourThickness(thickness) {\n    this.#view.setContourThickness(thickness);\n  }\n\n  /**\n   * Bind the view image to the provided layer.\n   *\n   * @param {ViewLayer} viewLayer The layer to bind.\n   */\n  bindImageAndLayer(viewLayer) {\n    const image = this.#view.getImage();\n    image.addEventListener('imagecontentchange',\n      viewLayer.onimagecontentchange\n    );\n    image.addEventListener('imagegeometrychange',\n      viewLayer.onimagegeometrychange\n    );\n    image.addEventListener('imageresampled',\n      viewLayer.onimageresampled\n    );\n  }\n\n  /**\n   * Unbind the view image to the provided layer.\n   *\n   * @param {ViewLayer} viewLayer The layer to bind.\n   */\n  unbindImageAndLayer(viewLayer) {\n    const image = this.#view.getImage();\n    image.removeEventListener('imagecontentchange',\n      viewLayer.onimagecontentchange\n    );\n    image.removeEventListener('imagegeometrychange',\n      viewLayer.onimagegeometrychange\n    );\n    image.removeEventListener('imageresampled',\n      viewLayer.onimageresampled\n    );\n  }\n\n} // class ViewController\n","import {logger} from '../utils/logger.js';\nimport {Point2D} from '../math/point.js';\n\n/**\n * List of interaction event names.\n */\nexport const InteractionEventNames = [\n  'mousedown',\n  'mousemove',\n  'mouseup',\n  'mouseout',\n  'wheel',\n  'dblclick',\n  'touchstart',\n  'touchmove',\n  'touchend'\n];\n\n/**\n * Get the positions (without the parent offset) of a list of touch events.\n *\n * @param {Array} touches The list of touch events.\n * @returns {Point2D[]} The list of positions of the touch events.\n */\nfunction getTouchesPositions(touches) {\n  // get the touch offset from all its parents\n  let offsetLeft = 0;\n  let offsetTop = 0;\n  if (touches.length !== 0 &&\n    typeof touches[0].target !== 'undefined') {\n    let offsetParent = touches[0].target.offsetParent;\n    while (offsetParent) {\n      if (!isNaN(offsetParent.offsetLeft)) {\n        offsetLeft += offsetParent.offsetLeft;\n      }\n      if (!isNaN(offsetParent.offsetTop)) {\n        offsetTop += offsetParent.offsetTop;\n      }\n      offsetParent = offsetParent.offsetParent;\n    }\n  } else {\n    logger.debug('No touch target offset parent.');\n  }\n  // set its position\n  const positions = [];\n  for (let i = 0; i < touches.length; ++i) {\n    positions.push(new Point2D(\n      touches[i].pageX - offsetLeft,\n      touches[i].pageY - offsetTop\n    ));\n  }\n  return positions;\n}\n\n/**\n * Get the offsets of an input touch event.\n *\n * @param {object} event The event to get the offset from.\n * @returns {Point2D[]} The array of points.\n */\nexport function getTouchPoints(event) {\n  let positions = [];\n  if (typeof event.targetTouches !== 'undefined' &&\n    event.targetTouches.length !== 0) {\n    // see https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent/targetTouches\n    positions = getTouchesPositions(event.targetTouches);\n  } else if (typeof event.changedTouches !== 'undefined' &&\n    event.changedTouches.length !== 0) {\n    // see https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent/changedTouches\n    positions = getTouchesPositions(event.changedTouches);\n  }\n  return positions;\n}\n\n/**\n * Get the offset of an input mouse event.\n *\n * @param {object} event The event to get the offset from.\n * @returns {Point2D} The 2D point.\n */\nexport function getMousePoint(event) {\n  // offsetX/Y: the offset in the X coordinate of the mouse pointer\n  // between that event and the padding edge of the target node\n  // https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/offsetX\n  // https://caniuse.com/mdn-api_mouseevent_offsetx\n  return new Point2D(\n    event.offsetX,\n    event.offsetY\n  );\n}\n\n/**\n * Test if a canvas with the input size can be created.\n *\n * Ref:\n * - {@link https://github.com/ivmartel/dwv/issues/902},\n * - {@link https://github.com/jhildenbiddle/canvas-size/blob/v1.2.4/src/canvas-test.js}.\n *\n * @param {number} width The canvas width.\n * @param {number} height The canvas height.\n * @returns {boolean} True is the canvas can be created.\n */\nexport function canCreateCanvas(width, height) {\n  // test canvas with input size\n  const testCvs = document.createElement('canvas');\n  testCvs.width = width;\n  testCvs.height = height;\n  // crop canvas to speed up test\n  const cropCvs = document.createElement('canvas');\n  cropCvs.width = 1;\n  cropCvs.height = 1;\n  // contexts\n  const testCtx = testCvs.getContext('2d');\n  const cropCtx = cropCvs.getContext('2d');\n  // set data\n  if (testCtx) {\n    testCtx.fillRect(width - 1, height - 1, 1, 1);\n    // Render the test pixel in the bottom-right corner of the\n    // test canvas in the top-left of the 1x1 crop canvas. This\n    // dramatically reducing the time for getImageData to complete.\n    cropCtx.drawImage(testCvs, width - 1, height - 1, 1, 1, 0, 0, 1, 1);\n  }\n  // Verify image data (alpha component, Pass = 255, Fail = 0)\n  return cropCtx && cropCtx.getImageData(0, 0, 1, 1).data[3] !== 0;\n}\n","import {Index} from '../math/index.js';\nimport {ListenerHandler} from '../utils/listen.js';\nimport {viewEventNames} from '../image/view.js';\nimport {ViewController} from '../app/viewController.js';\nimport {Point2D} from '../math/point.js';\nimport {\n  canCreateCanvas,\n  InteractionEventNames\n} from './generic.js';\nimport {getScaledOffset} from './layerGroup.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Vector3D} from '../math/vector.js';\nimport {Point, Point3D} from '../math/point.js';\nimport {Scalar2D, Scalar3D} from '../math/scalar.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * View layer.\n */\nexport class ViewLayer {\n\n  /**\n   * Container div.\n   *\n   * @type {HTMLElement}\n   */\n  #containerDiv;\n\n  /**\n   * The view controller.\n   *\n   * @type {ViewController}\n   */\n  #viewController = null;\n\n  /**\n   * The main display canvas.\n   *\n   * @type {object}\n   */\n  #canvas = null;\n\n  /**\n   * The offscreen canvas: used to store the raw, unscaled pixel data.\n   *\n   * @type {object}\n   */\n  #offscreenCanvas = null;\n\n  /**\n   * The associated CanvasRenderingContext2D.\n   *\n   * @type {object}\n   */\n  #context = null;\n\n  /**\n   * Flag to know if the current position is valid.\n   *\n   * @type {boolean}\n   */\n  #isValidPosition = true;\n\n  /**\n   * The image data array.\n   *\n   * @type {ImageData}\n   */\n  #imageData = null;\n\n  /**\n   * The layer base size as {x,y}.\n   *\n   * @type {Scalar2D}\n   */\n  #baseSize;\n\n  /**\n   * The layer base spacing as {x,y}.\n   *\n   * @type {Scalar2D}\n   */\n  #baseSpacing;\n\n  /**\n   * The layer opacity.\n   *\n   * @type {number}\n   */\n  #opacity = 1;\n\n  /**\n   * The layer scale.\n   *\n   * @type {Scalar2D}\n   */\n  #scale = {x: 1, y: 1};\n\n  /**\n   * The layer fit scale.\n   *\n   * @type {Scalar2D}\n   */\n  #fitScale = {x: 1, y: 1};\n\n  /**\n   * The layer flip scale.\n   *\n   * @type {Scalar3D}\n   */\n  #flipScale = {x: 1, y: 1, z: 1};\n\n  /**\n   * The fit size as {x,y}.\n   *\n   * @type {Scalar2D}\n   */\n  #containerSize = {x: 1, y: 1};\n\n  /**\n   * The div to world size ratio.\n   *\n   * @type {number}\n   */\n  #divToWorldSizeRatio = 1;\n\n  /**\n   * The fit offset as {x,y}.\n   *\n   * @type {Scalar2D}\n   */\n  #fitOffset = {x: 1, y: 1};\n\n  /**\n   * The full layer offset: sum of all other offsets.\n   *\n   * @type {Scalar2D}\n   */\n  #offset = {x: 0, y: 0};\n\n  /**\n   * The base layer offset.\n   *\n   * @type {Scalar2D}\n   */\n  #baseOffset = {x: 0, y: 0};\n\n  /**\n   * The view offset.\n   *\n   * @type {Scalar2D}\n   */\n  #viewOffset = {x: 0, y: 0};\n\n  /**\n   * The zoom offset.\n   *\n   * @type {Scalar2D}\n   */\n  #zoomOffset = {x: 0, y: 0};\n\n  /**\n   * The pan offset.\n   *\n   * @type {Scalar2D}\n   */\n  #panOffset = {x: 0, y: 0};\n\n  /**\n   * The flip offset.\n   *\n   * @type {Scalar2D}\n   */\n  #flipOffset = {x: 0, y: 0};\n\n  /**\n   * Data update flag.\n   *\n   * @type {boolean}\n   */\n  #needsDataUpdate = null;\n\n  /**\n   * The associated data id.\n   *\n   * @type {string}\n   */\n  #dataId;\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Image smoothing flag.\n   *\n   * See: {@link https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/imageSmoothingEnabled}.\n   *\n   * @type {boolean}\n   */\n  #imageSmoothing = false;\n\n  /**\n   * Layer group origin.\n   *\n   * @type {Point3D}\n   */\n  #layerGroupOrigin;\n\n  /**\n   * Layer group first origin.\n   *\n   * @type {Point3D}\n   */\n  #layerGroupOrigin0;\n\n  /**\n   * @param {HTMLElement} containerDiv The layer div, its id will be used\n   *   as this layer id.\n   */\n  constructor(containerDiv) {\n    this.#containerDiv = containerDiv;\n    // specific css class name\n    this.#containerDiv.className += ' viewLayer';\n  }\n\n  /**\n   * Get the associated data id.\n   *\n   * @returns {string} The data id.\n   */\n  getDataId() {\n    return this.#dataId;\n  }\n\n  /**\n   * Get the layer scale.\n   *\n   * @returns {Scalar2D} The scale as {x,y}.\n   */\n  getScale() {\n    return this.#scale;\n  }\n\n  /**\n   * Get the layer zoom offset without the fit scale.\n   *\n   * @returns {Scalar2D} The offset as {x,y}.\n   */\n  getAbsoluteZoomOffset() {\n    return {\n      x: this.#zoomOffset.x * this.#fitScale.x,\n      y: this.#zoomOffset.y * this.#fitScale.y\n    };\n  }\n\n  /**\n   * Set the imageSmoothing flag value.\n   *\n   * @param {boolean} flag True to enable smoothing.\n   */\n  setImageSmoothing(flag) {\n    this.#imageSmoothing = flag;\n  }\n\n  /**\n   * Set the associated view.\n   *\n   * @param {object} view The view.\n   * @param {string} dataId The associated data id.\n   */\n  setView(view, dataId) {\n    this.#dataId = dataId;\n    // local listeners\n    view.addEventListener('wlchange', this.#onWLChange);\n    view.addEventListener('colourmapchange', this.#onColourMapChange);\n    view.addEventListener('positionchange', this.#onPositionChange);\n    view.addEventListener('alphafuncchange', this.#onAlphaFuncChange);\n    view.addEventListener('maskviewchange', this.#onMaskViewChange);\n    // propagate view events\n    for (const eventName of viewEventNames) {\n      view.addEventListener(eventName, this.#fireEvent);\n    }\n    // create view controller\n    this.#viewController = new ViewController(view);\n    // bind layer and image\n    this.bindImage();\n  }\n\n  /**\n   * Get the view controller.\n   *\n   * @returns {ViewController} The controller.\n   */\n  getViewController() {\n    return this.#viewController;\n  }\n\n  /**\n   * Get the canvas image data.\n   *\n   * @returns {object} The image data.\n   */\n  getImageData() {\n    return this.#imageData;\n  }\n\n  /**\n   * Handle an image set event.\n   *\n   * @param {object} event The event.\n   * @function\n   */\n  onimageset = (event) => {\n    // event.value = [index, image]\n    if (this.#dataId === event.dataid) {\n      this.#viewController.setImage(event.value[0]);\n      this.#setBaseSize(this.#viewController.getImageSize().get2D());\n      this.#needsDataUpdate = true;\n    }\n  };\n\n  /**\n   * Bind this layer to the view image.\n   */\n  bindImage() {\n    if (this.#viewController) {\n      this.#viewController.bindImageAndLayer(this);\n    }\n  }\n\n  /**\n   * Unbind this layer to the view image.\n   */\n  unbindImage() {\n    if (this.#viewController) {\n      this.#viewController.unbindImageAndLayer(this);\n    }\n  }\n\n  /**\n   * Handle an image content change event.\n   *\n   * @param {object} event The event.\n   * @function\n   */\n  onimagecontentchange = (event) => {\n    // event.value = [index]\n    if (this.#dataId === event.dataid) {\n      this.#isValidPosition = this.#viewController.isPositionInBounds();\n      // flag update and draw\n      this.#needsDataUpdate = true;\n      this.draw();\n    }\n  };\n\n  /**\n   * Handle an image change event.\n   *\n   * @param {object} event The event.\n   * @function\n   */\n  onimagegeometrychange = (event) => {\n    // event.value = [index]\n    if (this.#dataId === event.dataid) {\n      const vcSize = this.#viewController.getImageSize().get2D();\n      const vcSpacing = this.#viewController.getImageSpacing().get2D();\n\n      const sizeChanged =\n        this.#baseSize.x !== vcSize.x ||\n        this.#baseSize.y !== vcSize.y;\n\n      const spacingChanged =\n        this.#baseSpacing.x !== vcSpacing.x ||\n        this.#baseSpacing.y !== vcSpacing.y;\n\n      if (spacingChanged) {\n        this.#viewController.updatePlaneHelper();\n        // update base spacing\n        this.#setBaseSpacing(vcSpacing);\n      }\n\n      if (sizeChanged) {\n        // size/spacing changed, recalculate base offset\n        // in case origin changed\n        if (typeof this.#layerGroupOrigin !== 'undefined' &&\n          typeof this.#layerGroupOrigin0 !== 'undefined') {\n          const origin0 = this.#viewController.getOrigin();\n          const scrollOffset = this.#layerGroupOrigin0.minus(origin0);\n          const origin = this.#viewController.getOrigin(\n            this.#viewController.getCurrentPosition()\n          );\n          if (typeof origin !== 'undefined') {\n            const planeOffset = this.#layerGroupOrigin.minus(origin);\n            this.setBaseOffset(scrollOffset, planeOffset);\n          }\n        }\n        // update base size\n        this.#setBaseSize(vcSize);\n      }\n\n      if (spacingChanged || sizeChanged) {\n        // flag update and draw\n        this.#needsDataUpdate = true;\n        this.draw();\n      }\n    }\n  };\n\n  /**\n   * Handle an image resampled event.\n   *\n   * @param {object} event The event.\n   * @function\n   */\n  onimageresampled = (event) => {\n    const maybeTimeIndex = this.#viewController.getCurrentIndex().get(3);\n    const matchingTimeIndex =\n      typeof maybeTimeIndex === 'undefined' ||\n      maybeTimeIndex === event.frame;\n\n    if (this.#dataId === event.dataid && matchingTimeIndex) {\n      this.#needsDataUpdate = true;\n      this.draw();\n    }\n  };\n\n  // common layer methods [start] ---------------\n\n  /**\n   * Get the id of the layer.\n   *\n   * @returns {string} The string id.\n   */\n  getId() {\n    return this.#containerDiv.id;\n  }\n\n  /**\n   * Remove the HTML element from the DOM.\n   */\n  removeFromDOM() {\n    this.#containerDiv.remove();\n  }\n\n  /**\n   * Get the layer base size (without scale).\n   *\n   * @returns {Scalar2D} The size as {x,y}.\n   */\n  getBaseSize() {\n    return this.#baseSize;\n  }\n\n  /**\n   * Get the image world (mm) 2D size.\n   *\n   * @returns {Scalar2D} The 2D size as {x,y}.\n   */\n  getImageWorldSize() {\n    return this.#viewController.getImageWorldSize();\n  }\n\n  /**\n   * Get the layer opacity.\n   *\n   * @returns {number} The opacity ([0:1] range).\n   */\n  getOpacity() {\n    return this.#opacity;\n  }\n\n  /**\n   * Set the layer opacity.\n   *\n   * @param {number} alpha The opacity ([0:1] range).\n   */\n  setOpacity(alpha) {\n    if (alpha === this.#opacity) {\n      return;\n    }\n\n    this.#opacity = Math.min(Math.max(alpha, 0), 1);\n\n    /**\n     * Opacity change event.\n     *\n     * @event App#opacitychange\n     * @type {object}\n     * @property {string} type The event type.\n     */\n    const event = {\n      type: 'opacitychange',\n      value: [this.#opacity]\n    };\n    this.#fireEvent(event);\n  }\n\n  /**\n   * Get the fill opacity relative to the global opacity.\n   *\n   * @returns {number} The fill opacity (between 0 and 1).\n   */\n  getFillOpacity() {\n    return this.#viewController.getFillOpacity();\n  }\n\n  /**\n   * Set the fill opacity relative to the global opacity.\n   * This only has an effect on segmentation views, or any other alpha\n   * function that makes use of it.\n   *\n   * @param {number} opacity The fill opacity (between 0 and 1).\n   */\n  setFillOpacity(opacity) {\n    this.#viewController.setFillOpacity(opacity);\n  }\n\n  /**\n   * Get the thickness of the contour in pixels.\n   *\n   * @returns {number} The contour thickness (integer >= 1).\n   */\n  getContourThickness() {\n    return this.#viewController.getContourThickness();\n  }\n\n  /**\n   * Set the thickness of the contour in pixels.\n   * This only has an effect on segmentation views, or any other alpha\n   * function that makes use of it.\n   *\n   * @param {number} thickness The contour thickness (integer >= 1).\n   */\n  setContourThickness(thickness) {\n    this.#viewController.setContourThickness(thickness);\n  }\n\n  /**\n   * Add a flip offset along the layer X axis.\n   */\n  addFlipOffsetX() {\n    this.#flipOffset.x += this.#canvas.width / this.#scale.x;\n    this.#offset.x += this.#flipOffset.x;\n  }\n\n  /**\n   * Add a flip offset along the layer Y axis.\n   */\n  addFlipOffsetY() {\n    this.#flipOffset.y += this.#canvas.height / this.#scale.y;\n    this.#offset.y += this.#flipOffset.y;\n  }\n\n  /**\n   * Flip the scale along the layer X axis.\n   */\n  flipScaleX() {\n    this.#flipScale.x *= -1;\n  }\n\n  /**\n   * Flip the scale along the layer Y axis.\n   */\n  flipScaleY() {\n    this.#flipScale.y *= -1;\n  }\n\n  /**\n   * Flip the scale along the layer Z axis.\n   */\n  flipScaleZ() {\n    this.#flipScale.z *= -1;\n  }\n\n  /**\n   * Set the layer scale.\n   *\n   * @param {Scalar3D} newScale The scale as {x,y,z}.\n   * @param {Point3D} [center] The scale center.\n   */\n  setScale(newScale, center) {\n    const helper = this.#viewController.getPlaneHelper();\n    const orientedNewScale = helper.getTargetOrientedPositiveXYZ({\n      x: newScale.x * this.#flipScale.x,\n      y: newScale.y * this.#flipScale.y,\n      z: newScale.z * this.#flipScale.z,\n    });\n    const finalNewScale = {\n      x: this.#fitScale.x * orientedNewScale.x,\n      y: this.#fitScale.y * orientedNewScale.y\n    };\n\n    if (Math.abs(newScale.x) === 1 &&\n      Math.abs(newScale.y) === 1 &&\n      Math.abs(newScale.z) === 1) {\n      // reset zoom offset for scale=1\n      const resetOffset = {\n        x: this.#offset.x - this.#zoomOffset.x,\n        y: this.#offset.y - this.#zoomOffset.y\n      };\n      // store new offset\n      this.#zoomOffset = {x: 0, y: 0};\n      this.#offset = resetOffset;\n    } else {\n      if (typeof center !== 'undefined') {\n        let worldCenter = helper.getPlaneOffsetFromOffset3D({\n          x: center.getX(),\n          y: center.getY(),\n          z: center.getZ()\n        });\n        // center was obtained with viewLayer.displayToMainPlanePos\n        // compensated for baseOffset\n        // TODO: justify...\n        worldCenter = {\n          x: worldCenter.x + this.#baseOffset.x,\n          y: worldCenter.y + this.#baseOffset.y\n        };\n\n        const newOffset = getScaledOffset(\n          this.#offset, this.#scale, finalNewScale, worldCenter);\n\n        const newZoomOffset = {\n          x: this.#zoomOffset.x + newOffset.x - this.#offset.x,\n          y: this.#zoomOffset.y + newOffset.y - this.#offset.y\n        };\n        // store new offset\n        this.#zoomOffset = newZoomOffset;\n        this.#offset = newOffset;\n      }\n    }\n\n    // store new scale\n    this.#scale = finalNewScale;\n  }\n\n  /**\n   * Initialise the layer scale.\n   *\n   * @param {Scalar3D} newScale The scale as {x,y,z}.\n   * @param {Scalar2D} absoluteZoomOffset The zoom offset as {x,y}\n   *   without the fit scale (as provided by getAbsoluteZoomOffset).\n   */\n  initScale(newScale, absoluteZoomOffset) {\n    const helper = this.#viewController.getPlaneHelper();\n    const orientedNewScale = helper.getTargetOrientedPositiveXYZ({\n      x: newScale.x * this.#flipScale.x,\n      y: newScale.y * this.#flipScale.y,\n      z: newScale.z * this.#flipScale.z,\n    });\n    const finalNewScale = {\n      x: this.#fitScale.x * orientedNewScale.x,\n      y: this.#fitScale.y * orientedNewScale.y\n    };\n    this.#scale = finalNewScale;\n\n    this.#zoomOffset = {\n      x: absoluteZoomOffset.x / this.#fitScale.x,\n      y: absoluteZoomOffset.y / this.#fitScale.y\n    };\n    this.#offset = {\n      x: this.#offset.x + this.#zoomOffset.x,\n      y: this.#offset.y + this.#zoomOffset.y\n    };\n  }\n\n  /**\n   * Set the base layer offset. Updates the layer offset.\n   *\n   * @param {Vector3D} scrollOffset The scroll offset vector.\n   * @param {Vector3D} planeOffset The plane offset vector.\n   * @param {Point3D} [layerGroupOrigin] The layer group origin.\n   * @param {Point3D} [layerGroupOrigin0] The layer group first origin.\n   * @returns {boolean} True if the offset was updated.\n   */\n  setBaseOffset(\n    scrollOffset, planeOffset,\n    layerGroupOrigin, layerGroupOrigin0) {\n    const helper = this.#viewController.getPlaneHelper();\n    const scrollDimIndex = helper.getNativeScrollDimIndex();\n    const newOffset = helper.getPlaneOffsetFromOffset3D({\n      x: scrollDimIndex === 0 ? scrollOffset.getX() : planeOffset.getX(),\n      y: scrollDimIndex === 1 ? scrollOffset.getY() : planeOffset.getY(),\n      z: scrollDimIndex === 2 ? scrollOffset.getZ() : planeOffset.getZ(),\n    });\n    const needsUpdate = this.#baseOffset.x !== newOffset.x ||\n      this.#baseOffset.y !== newOffset.y;\n    // store layer group origins\n    if (typeof layerGroupOrigin !== 'undefined' &&\n      typeof layerGroupOrigin0 !== 'undefined') {\n      this.#layerGroupOrigin = layerGroupOrigin;\n      this.#layerGroupOrigin0 = layerGroupOrigin0;\n    }\n    // reset offset if needed\n    if (needsUpdate) {\n      this.#offset = {\n        x: this.#offset.x - this.#baseOffset.x + newOffset.x,\n        y: this.#offset.y - this.#baseOffset.y + newOffset.y\n      };\n      this.#baseOffset = newOffset;\n    }\n    return needsUpdate;\n  }\n\n  /**\n   * Set the layer offset.\n   *\n   * @param {Scalar3D} newOffset The offset as {x,y,z}.\n   */\n  setOffset(newOffset) {\n    const helper = this.#viewController.getPlaneHelper();\n    const newPanOffset = helper.getPlaneOffsetFromOffset3D(newOffset);\n    this.#offset = {\n      x: this.#offset.x - this.#panOffset.x + newPanOffset.x,\n      y: this.#offset.y - this.#panOffset.y + newPanOffset.y\n    };\n    this.#panOffset = newPanOffset;\n  }\n\n  /**\n   * Transform a display position to a 2D index.\n   *\n   * @param {Point2D} point2D The input point.\n   * @returns {Index} The equivalent 2D index.\n   */\n  displayToPlaneIndex(point2D) {\n    const planePos = this.displayToPlanePos(point2D);\n    return new Index([\n      Math.floor(planePos.getX()),\n      Math.floor(planePos.getY())\n    ]);\n  }\n\n  /**\n   * Remove scale from a display position.\n   *\n   * @param {Point2D} point2D The input point.\n   * @returns {Point2D} The de-scaled point.\n   */\n  displayToPlaneScale(point2D) {\n    return new Point2D(\n      point2D.getX() / this.#scale.x,\n      point2D.getY() / this.#scale.y\n    );\n  }\n\n  /**\n   * Get a plane position from a display position.\n   *\n   * @param {Point2D} point2D The input point.\n   * @returns {Point2D} The plane position.\n   */\n  displayToPlanePos(point2D) {\n    const deScaled = this.displayToPlaneScale(point2D);\n    return new Point2D(\n      deScaled.getX() + this.#offset.x,\n      deScaled.getY() + this.#offset.y\n    );\n  }\n\n  /**\n   * Get a display position from a plane position.\n   *\n   * @param {Point2D} point2D The input point.\n   * @returns {Point2D} The display position, can be individually\n   *   undefined if out of bounds.\n   */\n  planePosToDisplay(point2D) {\n    let posX =\n      (point2D.getX() - this.#offset.x + this.#baseOffset.x) * this.#scale.x;\n    let posY =\n      (point2D.getY() - this.#offset.y + this.#baseOffset.y) * this.#scale.y;\n    // check if in bounds\n    if (posX < 0 || posX >= this.#canvas.width) {\n      posX = undefined;\n    }\n    if (posY < 0 || posY >= this.#canvas.height) {\n      posY = undefined;\n    }\n    return new Point2D(posX, posY);\n  }\n\n  /**\n   * Get a main plane position from a display position.\n   *\n   * @param {Point2D} point2D The input point.\n   * @returns {Point2D} The main plane position.\n   */\n  displayToMainPlanePos(point2D) {\n    const planePos = this.displayToPlanePos(point2D);\n    return new Point2D(\n      planePos.getX() - this.#baseOffset.x,\n      planePos.getY() - this.#baseOffset.y\n    );\n  }\n\n  /**\n   * Display the layer.\n   *\n   * @param {boolean} flag Whether to display the layer or not.\n   */\n  display(flag) {\n    this.#containerDiv.style.display = flag ? '' : 'none';\n  }\n\n  /**\n   * Check if the layer is visible.\n   *\n   * @returns {boolean} True if the layer is visible.\n   */\n  isVisible() {\n    return this.#containerDiv.style.display === '';\n  }\n\n  /**\n   * Draw the content (imageData) of the layer.\n   * The imageData variable needs to be set.\n   *\n   * @fires App#renderstart\n   * @fires App#renderend\n   */\n  draw() {\n    // skip for non valid position\n    if (!this.#isValidPosition) {\n      return;\n    }\n\n    /**\n     * Render start event.\n     *\n     * @event App#renderstart\n     * @type {object}\n     * @property {string} type The event type.\n     */\n    let event = {\n      type: 'renderstart',\n      layerid: this.getId(),\n      dataid: this.getDataId()\n    };\n    this.#fireEvent(event);\n\n    // update data if needed\n    if (this.#needsDataUpdate) {\n      this.#updateImageData();\n    }\n\n    // context opacity\n    this.#context.globalAlpha = this.#opacity;\n\n    // clear context\n    this.clear();\n\n    // draw the cached canvas on the context\n    // transform takes as input a, b, c, d, e, f to create\n    // the transform matrix (column-major order):\n    // [ a c e ]\n    // [ b d f ]\n    // [ 0 0 1 ]\n    this.#context.setTransform(\n      this.#scale.x,\n      0,\n      0,\n      this.#scale.y,\n      -1 * this.#offset.x * this.#scale.x,\n      -1 * this.#offset.y * this.#scale.y\n    );\n\n    // disable smoothing (set just before draw, could be reset by resize)\n    this.#context.imageSmoothingEnabled = this.#imageSmoothing;\n    // draw image\n    this.#context.drawImage(this.#offscreenCanvas, 0, 0);\n\n    /**\n     * Render end event.\n     *\n     * @event App#renderend\n     * @type {object}\n     * @property {string} type The event type.\n     */\n    event = {\n      type: 'renderend',\n      layerid: this.getId(),\n      dataid: this.getDataId()\n    };\n    this.#fireEvent(event);\n  }\n\n  /**\n   * Initialise the layer: set the canvas and context.\n   *\n   * @param {Scalar2D} size The image size as {x,y}.\n   * @param {Scalar2D} spacing The image spacing as {x,y}.\n   * @param {number} alpha The initial data opacity.\n   */\n  initialise(size, spacing, alpha) {\n    // set locals\n    this.#baseSpacing = spacing;\n    this.#opacity = Math.min(Math.max(alpha, 0), 1);\n\n    // create canvas\n    // (canvas size is set in fitToContainer)\n    this.#canvas = document.createElement('canvas');\n    this.#containerDiv.appendChild(this.#canvas);\n\n    // check that the getContext method exists\n    if (!this.#canvas.getContext) {\n      alert('Error: no canvas.getContext method.');\n      return;\n    }\n    // get the 2D context\n    this.#context = this.#canvas.getContext('2d');\n    if (!this.#context) {\n      alert('Error: failed to get the 2D context.');\n      return;\n    }\n\n    // off screen canvas\n    this.#offscreenCanvas = document.createElement('canvas');\n\n    // set base size: needs an existing context and off screen canvas\n    this.#setBaseSize(size);\n\n    // update data on first draw\n    this.#needsDataUpdate = true;\n  }\n\n  /**\n   * Set the base size of the layer.\n   *\n   * @param {Scalar2D} size The size as {x,y}.\n   */\n  #setBaseSize(size) {\n    // check canvas creation\n    if (!canCreateCanvas(size.x, size.y)) {\n      throw new Error('Cannot create canvas with size ' +\n        size.x + ', ' + size.y);\n    }\n\n    // set local\n    this.#baseSize = size;\n\n    // off screen canvas\n    this.#offscreenCanvas.width = this.#baseSize.x;\n    this.#offscreenCanvas.height = this.#baseSize.y;\n    // original empty image data array\n    this.#context.clearRect(0, 0, this.#baseSize.x, this.#baseSize.y);\n    this.#imageData = this.#context.createImageData(\n      this.#baseSize.x, this.#baseSize.y);\n  }\n\n  /**\n   * Set the base spacing of the layer.\n   *\n   * @param {Scalar2D} spacing The spacing as {x,y}.\n   */\n  #setBaseSpacing(spacing) {\n    this.#baseSpacing = spacing;\n    this.fitToContainer(\n      this.#containerSize,\n      this.#divToWorldSizeRatio,\n      this.#fitOffset\n    );\n  }\n\n  /**\n   * Fit the layer to its parent container.\n   *\n   * @param {Scalar2D} containerSize The fit size as {x,y}.\n   * @param {number} divToWorldSizeRatio The div to world size ratio.\n   * @param {Scalar2D} fitOffset The fit offset as {x,y}.\n   */\n  fitToContainer(containerSize, divToWorldSizeRatio, fitOffset) {\n    let needsDraw = false;\n\n    // fit scale\n    const newFitScale = {\n      x: divToWorldSizeRatio * this.#baseSpacing.x,\n      y: divToWorldSizeRatio * this.#baseSpacing.y\n    };\n    const fitRatio = {\n      x: newFitScale.x / this.#fitScale.x,\n      y: newFitScale.y / this.#fitScale.y\n    };\n\n    // size ratio (calculated before update)\n    const sizeRatio = {\n      x: containerSize.x / (this.#canvas.width * fitRatio.x),\n      y: containerSize.y / (this.#canvas.height * fitRatio.y)\n    };\n\n    // set canvas size if different from previous\n    if (this.#canvas.width !== containerSize.x ||\n      this.#canvas.height !== containerSize.y) {\n      if (!canCreateCanvas(containerSize.x, containerSize.y)) {\n        throw new Error('Cannot resize canvas ' +\n          containerSize.x + ', ' + containerSize.y);\n      }\n      // canvas size change triggers canvas reset\n      this.#canvas.width = containerSize.x;\n      this.#canvas.height = containerSize.y;\n      // update draw flag\n      needsDraw = true;\n    }\n\n    // #scale = inputScale * fitScale * flipScale\n    // flipScale does not change here, we can omit it\n    // newScale = (#scale / fitScale) * newFitScale\n    const newScale = {\n      x: this.#scale.x * fitRatio.x,\n      y: this.#scale.y * fitRatio.y\n    };\n\n    // set scales if different from previous\n    if (this.#scale.x !== newScale.x ||\n      this.#scale.y !== newScale.y) {\n      this.#fitScale = newFitScale;\n      this.#scale = newScale;\n      // update draw flag\n      needsDraw = true;\n    }\n\n    // view offset\n    const newViewOffset = {\n      x: fitOffset.x / newFitScale.x,\n      y: fitOffset.y / newFitScale.y\n    };\n    // flip offset\n    const scaledImageSize = {\n      x: containerSize.x / newFitScale.x,\n      y: containerSize.y / newFitScale.y\n    };\n    const newFlipOffset = {\n      x: this.#flipOffset.x !== 0 ? scaledImageSize.x : 0,\n      y: this.#flipOffset.y !== 0 ? scaledImageSize.y : 0,\n    };\n\n    // set offsets if different from previous\n    if (this.#viewOffset.x !== newViewOffset.x ||\n      this.#viewOffset.y !== newViewOffset.y ||\n      this.#flipOffset.x !== newFlipOffset.x ||\n      this.#flipOffset.y !== newFlipOffset.y) {\n      const newZoomOffset = {\n        x: this.#zoomOffset.x * sizeRatio.x,\n        y: this.#zoomOffset.y * sizeRatio.y\n      };\n      // update global offset\n      this.#offset = {\n        x: this.#offset.x +\n          newViewOffset.x - this.#viewOffset.x +\n          newFlipOffset.x - this.#flipOffset.x +\n          newZoomOffset.x - this.#zoomOffset.x,\n        y: this.#offset.y +\n          newViewOffset.y - this.#viewOffset.y +\n          newFlipOffset.y - this.#flipOffset.y +\n          newZoomOffset.y - this.#zoomOffset.y\n      };\n      // update private local offsets\n      this.#flipOffset = newFlipOffset;\n      this.#viewOffset = newViewOffset;\n      this.#zoomOffset = newZoomOffset;\n      // update draw flag\n      needsDraw = true;\n    }\n\n    this.#containerSize = containerSize;\n    this.#divToWorldSizeRatio = divToWorldSizeRatio;\n    this.#fitOffset = fitOffset;\n\n    // draw if needed\n    if (needsDraw) {\n      this.draw();\n    }\n  }\n\n  /**\n   * Enable and listen to container interaction events.\n   */\n  bindInteraction() {\n    // allow pointer events\n    this.#containerDiv.style.pointerEvents = 'auto';\n    // interaction events\n    const names = InteractionEventNames;\n    for (let i = 0; i < names.length; ++i) {\n      const eventName = names[i];\n      const passive = eventName !== 'wheel';\n      this.#containerDiv.addEventListener(\n        eventName, this.#fireEvent, {passive: passive});\n    }\n  }\n\n  /**\n   * Disable and stop listening to container interaction events.\n   */\n  unbindInteraction() {\n    // disable pointer events\n    this.#containerDiv.style.pointerEvents = 'none';\n    // interaction events\n    const names = InteractionEventNames;\n    for (let i = 0; i < names.length; ++i) {\n      this.#containerDiv.removeEventListener(names[i], this.#fireEvent);\n    }\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    event.srclayerid = this.getId();\n    event.dataid = this.#dataId;\n    this.#listenerHandler.fireEvent(event);\n  };\n\n  // common layer methods [end] ---------------\n\n  /**\n   * Update the canvas image data.\n   */\n  #updateImageData() {\n    // generate image data\n    this.#viewController.generateImageData(this.#imageData);\n    // pass the data to the off screen canvas\n    this.#offscreenCanvas.getContext('2d').putImageData(this.#imageData, 0, 0);\n    // update data flag\n    this.#needsDataUpdate = false;\n  }\n\n  /**\n   * Handle window/level change.\n   *\n   * @param {object} event The event fired when changing the window/level.\n   */\n  #onWLChange = (event) => {\n    // generate and draw if no skip flag\n    const skip = typeof event.skipGenerate !== 'undefined' &&\n      event.skipGenerate === true;\n    if (!skip) {\n      this.#needsDataUpdate = true;\n      this.draw();\n    }\n  };\n\n  /**\n   * Handle colour map change.\n   *\n   * @param {object} event The event fired when changing the colour map.\n   */\n  #onColourMapChange = (event) => {\n    const skip = typeof event.skipGenerate !== 'undefined' &&\n      event.skipGenerate === true;\n    if (!skip) {\n      this.#needsDataUpdate = true;\n      this.draw();\n    }\n  };\n\n  /**\n   * Handle position change.\n   *\n   * @param {object} event The event fired when changing the position.\n   */\n  #onPositionChange = (event) => {\n    const skip = typeof event.skipGenerate !== 'undefined' &&\n      event.skipGenerate === true;\n    if (!skip) {\n      let valid = true;\n      if (typeof event.valid !== 'undefined') {\n        valid = event.valid;\n      }\n      // clear for non valid events\n      if (!valid) {\n        // clear only once\n        if (this.#isValidPosition) {\n          this.#isValidPosition = false;\n          this.clear();\n        }\n      } else {\n        // 3D dimensions\n        const dims3D = [0, 1, 2];\n        // remove scroll index\n        const indexScrollDimIndex =\n          dims3D.indexOf(this.#viewController.getScrollDimIndex());\n        dims3D.splice(indexScrollDimIndex, 1);\n        // remove non scroll index from diff dims\n        const diffDims = event.diffDims.filter(function (item) {\n          return dims3D.indexOf(item) === -1;\n        });\n        // update if we have something left\n        if (diffDims.length !== 0 || !this.#isValidPosition) {\n          // reset valid flag\n          this.#isValidPosition = true;\n          // reset update flag\n          this.#needsDataUpdate = true;\n          this.draw();\n        }\n      }\n    }\n  };\n\n  /**\n   * Check if the position is valid.\n   *\n   * @returns {boolean} True if the position is valid.\n   */\n  isValidPosition() {\n    return this.#isValidPosition;\n  }\n\n  /**\n   * Handle alpha function change.\n   *\n   * @param {object} event The event fired when changing the function.\n   */\n  #onAlphaFuncChange = (event) => {\n    const skip = typeof event.skipGenerate !== 'undefined' &&\n      event.skipGenerate === true;\n    if (!skip) {\n      this.#needsDataUpdate = true;\n      this.draw();\n    }\n  };\n\n  /**\n   * Handle mask view change.\n   *\n   * @param {object} event The event fired when changing the function.\n   */\n  #onMaskViewChange = (event) => {\n    const skip = typeof event.skipGenerate !== 'undefined' &&\n      event.skipGenerate === true;\n    if (!skip) {\n      this.#needsDataUpdate = true;\n      this.draw();\n    }\n  };\n\n  /**\n   * Set the current position.\n   *\n   * @param {Point} position The new position.\n   * @param {Index} [_index] The new index (not used).\n   * @returns {boolean} True if the position was updated.\n   */\n  setCurrentPosition(position, _index) {\n    return this.#viewController.setCurrentPosition(position);\n  }\n\n  /**\n   * Clear the context.\n   */\n  clear() {\n    // clear the context: reset the transform first\n    // store the current transformation matrix\n    this.#context.save();\n    // use the identity matrix while clearing the canvas\n    this.#context.setTransform(1, 0, 0, 1, 0, 0);\n    this.#context.clearRect(0, 0, this.#canvas.width, this.#canvas.height);\n    // restore the transform\n    this.#context.restore();\n  }\n\n} // ViewLayer class\n","/**\n * Command interface.\n */\nexport class Command {\n  /**\n   * Get the command name.\n   *\n   * @returns {string} The command name.\n   */\n  getName() {\n    return '';\n  }\n  /**\n   * Execute the command.\n   */\n  execute() {}\n  /**\n   * Undo the command.\n   */\n  undo() {}\n}\n\n/**\n * UndoStack class.\n */\nexport class UndoStack extends EventTarget {\n  /**\n   * Array of commands.\n   *\n   * @type {Command[]}\n   */\n  #stack = [];\n\n  /**\n   * Current command index.\n   * Warning: 1 based.\n   *\n   * @type {number}\n   */\n  #curCmdIndex = 0;\n\n  /**\n   * Get the stack size.\n   *\n   * @returns {number} The size of the stack.\n   */\n  getStackSize() {\n    return this.#stack.length;\n  }\n\n  /**\n   * Get the current stack index.\n   * Warning: 1 based.\n   *\n   * @returns {number} The stack index.\n   */\n  getCurrentStackIndex() {\n    return this.#curCmdIndex;\n  }\n\n  /**\n   * Get the current command.\n   *\n   * @returns {Command} The command.\n   */\n  getCurrentCommand() {\n    return this.#stack[this.#curCmdIndex - 1];\n  }\n\n  /**\n   * Add a command to the stack.\n   *\n   * @param {Command} cmd The command to add.\n   * @fires UndoStack#undoadd\n   */\n  add(cmd) {\n    // clear commands after current index\n    this.#stack = this.#stack.slice(0, this.#curCmdIndex);\n    // store command\n    this.#stack.push(cmd);\n    // increment index\n    ++this.#curCmdIndex;\n    /**\n     * Add command to undo stack event.\n     * `event.target.getCurrentCommand()` will return the added command.\n     *\n     * @event UndoStack#undoadd\n     * @type {Event}\n     */\n    this.dispatchEvent(new Event('undoadd'));\n  }\n\n  /**\n   * Remove a command from the stack.\n   *\n   * @param {string} name The name of the command to remove.\n   * @returns {boolean} True if the command was found and removed.\n   * @fires UndoStack#undoremove\n   */\n  remove(name) {\n    let res = false;\n    const hasInputName = function (element) {\n      return element.getName() === name;\n    };\n    const index = this.#stack.findIndex(hasInputName);\n    if (index !== -1) {\n      // result\n      res = true;\n      /**\n       * Remove command from undo stack event.\n       * Get the removed command name from the `event.detail`.\n       *\n       * @event UndoStack#undoremove\n       * @type {CustomEvent}\n       */\n      this.dispatchEvent(new CustomEvent('undoremove', {\n        detail: {commandName: name}\n      }));\n      // remove command\n      this.#stack.splice(index, 1);\n      // decrement index\n      --this.#curCmdIndex;\n    }\n    return res;\n  }\n\n  /**\n   * Undo the last command.\n   *\n   * @fires UndoStack#undo\n   */\n  undo() {\n    if (this.#curCmdIndex > 0) {\n      /**\n       * Command undo event.\n       * `event.target.getCurrentCommand()` will return the undone command.\n       *\n       * @event UndoStack#undo\n       * @type {Event}\n       */\n      this.dispatchEvent(new Event('undo'));\n      // decrement command index\n      --this.#curCmdIndex;\n      // undo last command\n      this.#stack[this.#curCmdIndex].undo();\n    }\n  }\n\n  /**\n   * Redo the last command.\n   *\n   * @fires UndoStack#redo\n   */\n  redo() {\n    if (this.#curCmdIndex < this.#stack.length) {\n      // run last command\n      this.#stack[this.#curCmdIndex].execute();\n      // increment command index\n      ++this.#curCmdIndex;\n      /**\n       * Command redo event.\n       * `event.target.getCurrentCommand()` will return the re-done command.\n       *\n       * @event UndoStack#redo\n       * @type {Event}\n       */\n      this.dispatchEvent(new Event('redo'));\n    }\n  }\n\n} // UndoStack class\n","import {Command} from '../utils/undoStack.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Annotation} from '../image/annotation.js';\nimport {DrawController} from '../app/drawController.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Get the display name of the input shape.\n *\n * @param {Konva.Shape} shape The Konva shape.\n * @returns {string} The display name.\n */\nexport function getShapeDisplayName(shape) {\n  let displayName = 'shape';\n  if (shape instanceof Konva.Line) {\n    if (shape.points().length === 4) {\n      displayName = 'line';\n    } else if (shape.points().length === 6) {\n      displayName = 'protractor';\n    } else {\n      displayName = 'roi';\n    }\n  } else if (shape instanceof Konva.Rect) {\n    displayName = 'rectangle';\n  } else if (shape instanceof Konva.Ellipse) {\n    displayName = 'ellipse';\n  }\n  // return\n  return displayName;\n}\n\n/**\n * Add annotation command.\n */\nexport class AddAnnotationCommand extends Command {\n  /**\n   * @type {Annotation}\n   */\n  #annotation;\n\n  /**\n   * @type {DrawController}\n   */\n  #drawController;\n\n  /**\n   * @param {Annotation} annotation The annotation to add.\n   * @param {DrawController} drawController The associated draw controller.\n   */\n  constructor(annotation, drawController) {\n    super();\n    this.#annotation = annotation;\n    this.#drawController = drawController;\n  }\n\n  /**\n   * Get the command name.\n   *\n   * @returns {string} The command name.\n   */\n  getName() {\n    return 'AddAnnotation-' + this.#annotation.trackingUid;\n  }\n\n  /**\n   * Execute the command.\n   */\n  execute() {\n    this.#drawController.addAnnotation(this.#annotation);\n  }\n\n  /**\n   * Undo the command.\n   */\n  undo() {\n    this.#drawController.removeAnnotation(this.#annotation.trackingUid);\n  }\n}\n\n/**\n * Remove annotation command.\n */\nexport class RemoveAnnotationCommand extends Command {\n  /**\n   * @type {Annotation}\n   */\n  #annotation;\n\n  /**\n   * @type {DrawController}\n   */\n  #drawController;\n\n  /**\n   * @param {Annotation} annotation The annotation to remove.\n   * @param {DrawController} drawController The associated draw controller.\n   */\n  constructor(annotation, drawController) {\n    super();\n    this.#annotation = annotation;\n    this.#drawController = drawController;\n  }\n\n  /**\n   * Get the command name.\n   *\n   * @returns {string} The command name.\n   */\n  getName() {\n    return 'RemoveAnnotation-' + this.#annotation.trackingUid;\n  }\n\n  /**\n   * Execute the command.\n   */\n  execute() {\n    this.#drawController.removeAnnotation(this.#annotation.trackingUid);\n  }\n\n  /**\n   * Undo the command.\n   */\n  undo() {\n    this.#drawController.addAnnotation(this.#annotation);\n  }\n}\n\n/**\n * Update annotation command.\n */\nexport class UpdateAnnotationCommand extends Command {\n  /**\n   * @type {Annotation}\n   */\n  #annotation;\n\n  /**\n   * @type {DrawController}\n   */\n  #drawController;\n\n  /**\n   * Original annotation properties.\n   *\n   * @type {object}\n   */\n  #originalProps;\n\n  /**\n   * New annotation properties.\n   *\n   * @type {object}\n   */\n  #newProps;\n\n  /**\n   * @param {Annotation} annotation The annotation to update.\n   * @param {object} originaProps The original annotation properties.\n   * @param {object} newProps The new annotation properties.\n   * @param {DrawController} drawController The associated draw controller.\n   */\n  constructor(annotation, originaProps, newProps, drawController) {\n    super();\n    this.#annotation = annotation;\n    this.#drawController = drawController;\n    this.#originalProps = originaProps;\n    this.#newProps = newProps;\n  }\n\n  /**\n   * Get the command name.\n   *\n   * @returns {string} The command name.\n   */\n  getName() {\n    return 'UpdateAnnotation-' + this.#annotation.trackingUid;\n  }\n\n  /**\n   * Execute the command.\n   */\n  execute() {\n    const keys = Object.keys(this.#newProps);\n    for (const key of keys) {\n      this.#annotation[key] = this.#newProps[key];\n    }\n    this.#drawController.updateAnnotation(this.#annotation, keys);\n  }\n\n  /**\n   * Undo the command.\n   */\n  undo() {\n    const keys = Object.keys(this.#originalProps);\n    for (const key of keys) {\n      this.#annotation[key] = this.#originalProps[key];\n    }\n    this.#drawController.updateAnnotation(this.#annotation, keys);\n  }\n}\n","import {AnnotationGroup} from '../image/annotationGroup.js';\nimport {\n  RemoveAnnotationCommand,\n  UpdateAnnotationCommand\n} from '../tools/drawCommands.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Draw controller.\n */\nexport class DrawController {\n\n  /**\n   * The annotation group.\n   *\n   * @type {AnnotationGroup}\n   */\n  #annotationGroup;\n\n  /**\n   * Get an annotation.\n   *\n   * @param {string} uid The annotation UID.\n   * @returns {Annotation|undefined} The annotation.\n   */\n  getAnnotation(uid) {\n    return this.#annotationGroup.find(uid);\n  }\n\n  /**\n   * Get the annotation group.\n   *\n   * @returns {AnnotationGroup} The list.\n   */\n  getAnnotationGroup() {\n    return this.#annotationGroup;\n  }\n\n  /**\n   * Check if the annotation group is editable.\n   *\n   * @returns {boolean} True if editable.\n   */\n  isAnnotationGroupEditable() {\n    return this.#annotationGroup.isEditable();\n  }\n\n  /**\n   * Set the annotation group editability.\n   *\n   * @param {boolean} flag True to make the annotation group editable.\n   */\n  setAnnotationGroupEditable(flag) {\n    this.#annotationGroup.setEditable(flag);\n  }\n\n  /**\n   * Add an annotation.\n   *\n   * @param {Annotation} annotation The annotation to add.\n   */\n  addAnnotation(annotation) {\n    this.#annotationGroup.add(annotation);\n  }\n\n  /**\n   * Update an anotation from the list.\n   *\n   * @param {Annotation} annotation The annotation to update.\n   * @param {string[]} [propKeys] Optional properties that got updated.\n   * @param {boolean} [propagate] Whether the update event propagates\n   *   outside of dwv or not, defaults to true.\n   */\n  updateAnnotation(annotation, propKeys, propagate) {\n    this.#annotationGroup.update(annotation, propKeys, propagate);\n  }\n\n  /**\n   * Remove an anotation for the list.\n   *\n   * @param {string} uid The UID of the annotation to remove.\n   */\n  removeAnnotation(uid) {\n    this.#annotationGroup.remove(uid);\n  }\n\n  /**\n   * Remove an annotation via a remove command (triggers draw actions).\n   *\n   * @param {string} uid The annotation UID.\n   * @param {Function} exeCallback The undo stack callback.\n   */\n  removeAnnotationWithCommand(uid, exeCallback) {\n    const annotation = this.getAnnotation(uid);\n    if (typeof annotation === 'undefined') {\n      logger.warn(\n        'Cannot create remove command for undefined annotation: ' + uid);\n      return;\n    }\n    // create remove annotation command\n    const command = new RemoveAnnotationCommand(annotation, this);\n    // add command to undo stack\n    exeCallback(command);\n    // execute command: triggers draw remove\n    command.execute();\n  }\n\n  /**\n   * Update an annotation via an update command (triggers draw actions).\n   *\n   * @param {string} uid The annotation UID.\n   * @param {object} originalProps The original annotation properties\n   *   that will be updated.\n   * @param {object} newProps The new annotation properties\n   *   that will replace the original ones.\n   * @param {Function} exeCallback The undo stack callback.\n   */\n  updateAnnotationWithCommand(uid, originalProps, newProps, exeCallback) {\n    const annotation = this.getAnnotation(uid);\n    if (typeof annotation === 'undefined') {\n      logger.warn(\n        'Cannot create update command for undefined annotation: ' + uid);\n      return;\n    }\n    // create remove annotation command\n    const command = new UpdateAnnotationCommand(\n      annotation, originalProps, newProps, this);\n    // add command to undo stack\n    exeCallback(command);\n    // execute command: triggers draw remove\n    command.execute();\n  }\n\n  /**\n   * Remove all annotations via remove commands (triggers draw actions).\n   *\n   * @param {Function} exeCallback The undo stack callback.\n   */\n  removeAllAnnotationsWithCommand(exeCallback) {\n    for (const annotation of this.#annotationGroup.getList()) {\n      this.removeAnnotationWithCommand(annotation.trackingUid, exeCallback);\n    }\n  }\n\n  /**\n   * @param {AnnotationGroup} [group] Optional annotation group.\n   */\n  constructor(group) {\n    if (typeof group !== 'undefined') {\n      this.#annotationGroup = group;\n    } else {\n      this.#annotationGroup = new AnnotationGroup();\n    }\n  }\n\n  /**\n   * Check if the annotation group contains a meta data value.\n   *\n   * @param {string} key The key to check.\n   * @returns {boolean} True if the meta data is present.\n   */\n  hasAnnotationMeta(key) {\n    return this.#annotationGroup.hasMeta(key);\n  }\n\n  /**\n   * Set an annotation meta data.\n   *\n   * @param {string} key The meta data to set.\n   * @param {string} value The value of the meta data.\n   */\n  setAnnotationMeta(key, value) {\n    this.#annotationGroup.setMetaValue(key, value);\n  }\n\n} // class DrawController\n","import {Point2D} from '../math/point.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Scalar2D} from '../math/scalar.js';\nimport {Style} from '../gui/style.js';\n// external\nimport Konva from 'konva';\n/* eslint-enable no-unused-vars */\n\n/**\n * List of default label texts.\n *\n * @type {Object.<string, Object.<string, string>>}\n */\nexport const defaultLabelTexts = {\n  arrow: {\n    '*': ''\n  },\n  circle: {\n    '*': '{surface}'\n  },\n  ellipse: {\n    '*': '{surface}'\n  },\n  protractor: {\n    '*': '{angle}'\n  },\n  rectangle: {\n    '*': '{surface}'\n  },\n  roi: {\n    '*': ''\n  },\n  ruler: {\n    '*': '{length}'\n  }\n};\n\n/**\n * Is an input node's name 'label'.\n *\n * @param {Konva.Node} node A Konva node.\n * @returns {boolean} True if the node's name is 'label'.\n */\nexport function isNodeNameLabel(node) {\n  return node.name() === 'label';\n}\n\n/**\n * Is an input node's name 'shape'.\n *\n * @param {Konva.Node} node A Konva node.\n * @returns {boolean} True if the node's name is 'shape'.\n */\nexport function isNodeNameShape(node) {\n  return node.name() === 'shape';\n}\n\n/**\n * Is an input node a position node.\n *\n * @param {Konva.Node} node A Konva node.\n * @returns {boolean} True if the node's name is 'position-group'.\n */\nexport function isPositionNode(node) {\n  return node.name() === 'position-group';\n}\n\n/**\n * Get a Konva.Line shape from a group.\n *\n * @param {Konva.Group} group The group to look into.\n * @returns {Konva.Line|undefined} The shape.\n */\nexport function getLineShape(group) {\n  const kshape = group.getChildren(isNodeNameShape)[0];\n  if (!(kshape instanceof Konva.Line)) {\n    return;\n  }\n  return kshape;\n}\n\n/**\n * Get a Konva.Ellipse anchor shape from a group.\n *\n * @param {Konva.Group} group The group to look into.\n * @param {number} index The anchor index.\n * @returns {Konva.Ellipse|undefined} The anchor shape.\n */\nexport function getAnchorShape(group, index) {\n  const kshape = group.getChildren(function (node) {\n    return node.id() === 'anchor' + index;\n  })[0];\n  if (!(kshape instanceof Konva.Ellipse)) {\n    return;\n  }\n  return kshape;\n}\n\n/**\n * @callback testFn\n * @param {Konva.Node} node The node.\n * @returns {boolean} True if the node passes the test.\n */\n\n/**\n * Get a lambda to check a node's id.\n *\n * @param {string} id The id to check.\n * @returns {testFn} A function to check a node's id.\n */\nexport function isNodeWithId(id) {\n  return function (node) {\n    return node.id() === id;\n  };\n}\n\n/**\n * Draw Debug flag.\n */\nexport const DRAW_DEBUG = false;\n\n/**\n * Get the default anchor shape.\n *\n * @param {number} x The X position.\n * @param {number} y The Y position.\n * @param {string} id The shape id.\n * @param {Style} style The application style.\n * @returns {Konva.Ellipse} The default anchor shape.\n */\nexport function getDefaultAnchor(x, y, id, style) {\n  const radius = style.applyZoomScale(6);\n  const absRadius = {\n    x: Math.abs(radius.x),\n    y: Math.abs(radius.y)\n  };\n  return new Konva.Ellipse({\n    x: x,\n    y: y,\n    stroke: '#999',\n    fill: 'rgba(100,100,100,0.7',\n    strokeWidth: style.getStrokeWidth(),\n    strokeScaleEnabled: false,\n    radius: absRadius,\n    radiusX: absRadius.x,\n    radiusY: absRadius.y,\n    name: 'anchor',\n    id: id.toString(),\n    dragOnTop: false,\n    draggable: true,\n    visible: false\n  });\n}\n\n/**\n * Get an anchor index from its id.\n *\n * @param {string} id The anchor id as 'anchor#'.\n * @returns {number} The anchor index.\n */\nexport function getAnchorIndex(id) {\n  // 'anchor'.length = 6\n  return parseInt(id.substring(6), 10);\n}\n\n/**\n * Bound a node position.\n *\n * @param {Konva.Node} node The node to bound the position.\n * @param {Point2D} min The minimum position.\n * @param {Point2D} max The maximum position.\n * @returns {boolean} True if the position was corrected.\n */\nfunction boundNodePosition(node, min, max) {\n  let changed = false;\n  if (node.x() < min.getX()) {\n    node.x(min.getX());\n    changed = true;\n  } else if (node.x() > max.getX()) {\n    node.x(max.getX());\n    changed = true;\n  }\n  if (node.y() < min.getY()) {\n    node.y(min.getY());\n    changed = true;\n  } else if (node.y() > max.getY()) {\n    node.y(max.getY());\n    changed = true;\n  }\n  return changed;\n}\n\n/**\n * Get a shape top left position range.\n *\n * @param {Scalar2D} stageSize The stage size as {x,y}.\n * @param {Konva.Shape} shape The shape to evaluate.\n * @returns {object} The range as {min, max}.\n */\nexport function getShapePositionRange(stageSize, shape) {\n  const min = new Point2D(0, 0);\n  const max = new Point2D(\n    stageSize.x - Math.abs(shape.width()),\n    stageSize.y - Math.abs(shape.height())\n  );\n\n  return {min: min, max: max};\n}\n\n/**\n * Is an input shape top left position in the input range.\n *\n * @param {Konva.Shape} shape The shape to evaluate.\n * @param {Point2D} min The minimum top left position.\n * @param {Point2D} max The maximum top left position.\n * @returns {boolean} True if in range.\n */\nexport function isShapeInRange(shape, min, max) {\n  // use client rect to get the shape's top left position\n  const boundRect = shape.getClientRect({relativeTo: shape.getParent()});\n  return boundRect.x > min.getX() &&\n    boundRect.x < max.getX() &&\n    boundRect.y > min.getY() &&\n    boundRect.y < max.getY();\n}\n\n/**\n * Validate an anchor position.\n *\n * @param {Scalar2D} stageSize The stage size {x,y}.\n * @param {Konva.Shape} anchor The anchor to evaluate.\n * @returns {boolean} True if the position was corrected.\n */\nexport function validateAnchorPosition(stageSize, anchor) {\n  const group = anchor.getParent();\n\n  const min = new Point2D(\n    -group.x(),\n    -group.y()\n  );\n  const max = new Point2D(\n    stageSize.x - group.x(),\n    stageSize.y - group.y()\n  );\n\n  return boundNodePosition(anchor, min, max);\n}\n","import {getShadowColour} from '../utils/colour.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Scalar2D} from '../math/scalar.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Style class.\n */\nexport class Style {\n  /**\n   * Font size.\n   *\n   * @type {number}\n   */\n  #fontSize = 10;\n\n  /**\n   * Font family.\n   *\n   * @type {string}\n   */\n  #fontFamily = 'Verdana';\n\n  /**\n   * Text colour.\n   *\n   * @type {string}\n   */\n  #textColour = '#fff';\n\n  /**\n   * Line colour.\n   *\n   * @type {string}\n   */\n  #lineColour = '#ffff80';\n\n  /**\n   * Base scale.\n   *\n   * @type {Scalar2D}\n   */\n  #baseScale = {x: 1, y: 1};\n\n  /**\n   * Zoom scale.\n   *\n   * @type {Scalar2D}\n   */\n  #zoomScale = {x: 1, y: 1};\n\n  /**\n   * Stroke width.\n   *\n   * @type {number}\n   */\n  #strokeWidth = 2;\n\n  /**\n   * Shadow offset.\n   *\n   * @type {Scalar2D}\n   */\n  #shadowOffset = {x: 0.25, y: 0.25};\n\n  /**\n   * Tag opacity.\n   *\n   * @type {number}\n   */\n  #tagOpacity = 0.2;\n\n  /**\n   * Text padding.\n   *\n   * @type {number}\n   */\n  #textPadding = 3;\n\n  /**\n   * Get the font family.\n   *\n   * @returns {string} The font family.\n   */\n  getFontFamily() {\n    return this.#fontFamily;\n  }\n\n  /**\n   * Get the font size.\n   *\n   * @returns {number} The font size.\n   */\n  getFontSize() {\n    return this.#fontSize;\n  }\n\n  /**\n   * Get the stroke width.\n   *\n   * @returns {number} The stroke width.\n   */\n  getStrokeWidth() {\n    return this.#strokeWidth;\n  }\n\n  /**\n   * Get the text colour.\n   *\n   * @returns {string} The text colour.\n   */\n  getTextColour() {\n    return this.#textColour;\n  }\n\n  /**\n   * Get the line colour.\n   *\n   * @returns {string} The line colour.\n   */\n  getLineColour() {\n    return this.#lineColour;\n  }\n\n  /**\n   * Set the line colour.\n   *\n   * @param {string} colour The line colour.\n   */\n  setLineColour(colour) {\n    this.#lineColour = colour;\n  }\n\n  /**\n   * Set the base scale.\n   *\n   * @param {Scalar2D} scale The scale as {x,y}.\n   */\n  setBaseScale(scale) {\n    this.#baseScale = scale;\n  }\n\n  /**\n   * Set the zoom scale.\n   *\n   * @param {Scalar2D} scale The scale as {x,y}.\n   */\n  setZoomScale(scale) {\n    this.#zoomScale = scale;\n  }\n\n  /**\n   * Get the base scale.\n   *\n   * @returns {Scalar2D} The scale as {x,y}.\n   */\n  getBaseScale() {\n    return this.#baseScale;\n  }\n\n  /**\n   * Get the zoom scale.\n   *\n   * @returns {Scalar2D} The scale as {x,y}.\n   */\n  getZoomScale() {\n    return this.#zoomScale;\n  }\n\n  /**\n   * Scale an input value using the base scale.\n   *\n   * @param {number} value The value to scale.\n   * @returns {number} The scaled value.\n   */\n  scale(value) {\n    // TODO: 2D?\n    return value / this.#baseScale.x;\n  }\n\n  /**\n   * Apply zoom scale on an input value.\n   *\n   * @param {number} value The value to scale.\n   * @returns {Scalar2D} The scaled value as {x,y}.\n   */\n  applyZoomScale(value) {\n    return {\n      x: value / this.#zoomScale.x,\n      y: value / this.#zoomScale.y\n    };\n  }\n\n  /**\n   * Multiply an input value by the zoom ratio (zx/zy).\n   *\n   * @param {number} value The value to scale.\n   * @returns {number} The scaled value.\n   */\n  applyZoomRatio(value) {\n    return value * this.#zoomScale.x / this.#zoomScale.y;\n  }\n\n  /**\n   * Get the shadow offset.\n   *\n   * @returns {Scalar2D} The offset as {x,y}.\n   */\n  getShadowOffset() {\n    return this.#shadowOffset;\n  }\n\n  /**\n   * Get the tag opacity.\n   *\n   * @returns {number} The opacity.\n   */\n  getTagOpacity() {\n    return this.#tagOpacity;\n  }\n\n  /**\n   * Get the text padding.\n   *\n   * @returns {number} The padding.\n   */\n  getTextPadding() {\n    return this.#textPadding;\n  }\n\n  /**\n   * Get the font definition string.\n   *\n   * @returns {string} The font definition string.\n   */\n  getFontStr() {\n    return ('normal ' + this.getFontSize() + 'px sans-serif');\n  }\n\n  /**\n   * Get the line height.\n   *\n   * @returns {number} The line height.\n   */\n  getLineHeight() {\n    return (this.getFontSize() + this.getFontSize() / 5);\n  }\n\n  /**\n   * Get the font size scaled to the display.\n   *\n   * @returns {number} The scaled font size.\n   */\n  getScaledFontSize() {\n    return this.scale(this.getFontSize());\n  }\n\n  /**\n   * Get the stroke width scaled to the display.\n   *\n   * @returns {number} The scaled stroke width.\n   */\n  getScaledStrokeWidth() {\n    return this.scale(this.getStrokeWidth());\n  }\n\n  /**\n   * Get the shadow line colour.\n   *\n   * @returns {string} The shadow line colour.\n   */\n  getShadowLineColour() {\n    return getShadowColour(this.getLineColour());\n  }\n\n} // class Style\n","import {ListenerHandler} from '../utils/listen.js';\nimport {DrawController} from '../app/drawController.js';\nimport {getScaledOffset} from './layerGroup.js';\nimport {InteractionEventNames} from './generic.js';\nimport {logger} from '../utils/logger.js';\nimport {toStringId} from '../utils/array.js';\nimport {precisionRound} from '../utils/string.js';\nimport {AddAnnotationCommand} from '../tools/drawCommands.js';\nimport {\n  isNodeWithId,\n  isPositionNode,\n  isNodeNameShape,\n  isNodeNameLabel\n} from '../tools/drawBounds.js';\nimport {Style} from '../gui/style.js';\nimport {Line} from '../math/line.js';\nimport {Rectangle} from '../math/rectangle.js';\nimport {ROI} from '../math/roi.js';\nimport {Protractor} from '../math/protractor.js';\nimport {Ellipse} from '../math/ellipse.js';\nimport {Circle} from '../math/circle.js';\nimport {Point2D} from '../math/point.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point, Point3D} from '../math/point.js';\nimport {Index} from '../math/index.js';\nimport {Vector3D} from '../math/vector.js';\nimport {Scalar2D, Scalar3D} from '../math/scalar.js';\nimport {Image} from '../image/image.js';\nimport {PlaneHelper} from '../image/planeHelper.js';\nimport {Annotation} from '../image/annotation.js';\nimport {AnnotationGroup} from '../image/annotationGroup.js';\nimport {DrawShapeHandler} from '../tools/drawShapeHandler.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Debug function to output the layer hierarchy as text.\n *\n * @param {object} layer The Konva layer.\n * @param {string} prefix A display prefix (used in recursion).\n * @returns {string} A text representation of the hierarchy.\n */\n// function getHierarchyLog(layer, prefix) {\n//   if (typeof prefix === 'undefined') {\n//     prefix = '';\n//   }\n//   const kids = layer.getChildren();\n//   let log = prefix + '|__ ' + layer.name() + ': ' + layer.id() + '\\n';\n//   for (let i = 0; i < kids.length; ++i) {\n//     log += getHierarchyLog(kids[i], prefix + '    ');\n//   }\n//   return log;\n// }\n\n/**\n * Draw layer.\n */\nexport class DrawLayer {\n\n  /**\n   * The container div.\n   *\n   * @type {HTMLDivElement}\n   */\n  #containerDiv;\n\n  /**\n   * Konva stage.\n   *\n   * @type {Konva.Stage}\n   */\n  #konvaStage = null;\n\n  /**\n   * The layer base size as {x,y}.\n   *\n   * @type {Scalar2D}\n   */\n  #baseSize;\n\n  /**\n   * The layer base spacing as {x,y}.\n   *\n   * @type {Scalar2D}\n   */\n  #baseSpacing;\n\n  /**\n   * The layer fit scale.\n   *\n   * @type {Scalar2D}\n   */\n  #fitScale = {x: 1, y: 1};\n\n  /**\n   * The layer flip scale.\n   *\n   * @type {Scalar3D}\n   */\n  #flipScale = {x: 1, y: 1, z: 1};\n\n  /**\n   * The base layer offset.\n   *\n   * @type {Scalar2D}\n   */\n  #baseOffset = {x: 0, y: 0};\n\n  /**\n   * The view offset.\n   *\n   * @type {Scalar2D}\n   */\n  #viewOffset = {x: 0, y: 0};\n\n  /**\n   * The zoom offset.\n   *\n   * @type {Scalar2D}\n   */\n  #zoomOffset = {x: 0, y: 0};\n\n  /**\n   * The pan offset.\n   *\n   * @type {Scalar2D}\n   */\n  #panOffset = {x: 0, y: 0};\n\n  /**\n   * The flip offset.\n   *\n   * @type {Scalar2D}\n   */\n  #flipOffset = {x: 0, y: 0};\n\n  /**\n   * The draw controller.\n   *\n   * @type {DrawController}\n   */\n  #drawController;\n\n  /**\n   * The plane helper.\n   *\n   * @type {PlaneHelper}\n   */\n  #planeHelper;\n\n  /**\n   * The associated data id.\n   *\n   * @type {string}\n   */\n  #dataId;\n\n  /**\n   * The reference layer id.\n   *\n   * @type {string}\n   */\n  #referenceLayerId;\n\n  /**\n   * Current position group id.\n   *\n   * @type {string|undefined}\n   */\n  #currentPosGroupId;\n\n  /**\n   * Draw shape handler.\n   *\n   * @type {DrawShapeHandler|undefined}\n   */\n  #shapeHandler;\n\n  /**\n   * Visible labels flag.\n   *\n   * @type {boolean}\n   */\n  #visibleLabels = true;\n\n  /**\n   * @param {HTMLDivElement} containerDiv The layer div, its id will be used\n   *   as this layer id.\n   */\n  constructor(containerDiv) {\n    this.#containerDiv = containerDiv;\n    // specific css class name\n    this.#containerDiv.className += ' drawLayer';\n  }\n\n  /**\n   * Set the draw shape handler.\n   *\n   * @param {DrawShapeHandler|undefined} handler The shape handler.\n   */\n  setShapeHandler(handler) {\n    this.#shapeHandler = handler;\n  }\n\n  /**\n   * Get the associated data id.\n   *\n   * @returns {string} The id.\n   */\n  getDataId() {\n    return this.#dataId;\n  }\n\n  /**\n   * Get the reference layer id.\n   *\n   * @returns {string} The id.\n   */\n  getReferenceLayerId() {\n    return this.#referenceLayerId;\n  }\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Get the Konva stage.\n   *\n   * @returns {Konva.Stage} The stage.\n   */\n  getKonvaStage() {\n    return this.#konvaStage;\n  }\n\n  /**\n   * Get the Konva layer.\n   *\n   * @returns {Konva.Layer} The layer.\n   */\n  getKonvaLayer() {\n    // there should only be one layer\n    return this.#konvaStage.getLayers()[0];\n  }\n\n  /**\n   * Get the draw controller.\n   *\n   * @returns {DrawController} The controller.\n   */\n  getDrawController() {\n    return this.#drawController;\n  }\n\n  /**\n   * Set the plane helper.\n   *\n   * @param {PlaneHelper} helper The helper.\n   */\n  setPlaneHelper(helper) {\n    this.#planeHelper = helper;\n  }\n\n  // common layer methods [start] ---------------\n\n  /**\n   * Get the id of the layer.\n   *\n   * @returns {string} The string id.\n   */\n  getId() {\n    return this.#containerDiv.id;\n  }\n\n  /**\n   * Remove the HTML element from the DOM.\n   */\n  removeFromDOM() {\n    this.#containerDiv.remove();\n  }\n\n  /**\n   * Get the layer base size (without scale).\n   *\n   * @returns {Scalar2D} The size as {x,y}.\n   */\n  getBaseSize() {\n    return this.#baseSize;\n  }\n\n  /**\n   * Get the layer opacity.\n   *\n   * @returns {number} The opacity ([0:1] range).\n   */\n  getOpacity() {\n    return this.#konvaStage.opacity();\n  }\n\n  /**\n   * Set the layer opacity.\n   *\n   * @param {number} alpha The opacity ([0:1] range).\n   */\n  setOpacity(alpha) {\n    this.#konvaStage.opacity(Math.min(Math.max(alpha, 0), 1));\n  }\n\n  /**\n   * Add a flip offset along the layer X axis.\n   */\n  addFlipOffsetX() {\n    // flip offset\n    const scale = this.#konvaStage.scale();\n    const size = this.#konvaStage.size();\n    this.#flipOffset.x += size.width / scale.x;\n    // apply\n    const offset = this.#konvaStage.offset();\n    offset.x += this.#flipOffset.x;\n    this.#konvaStage.offset(offset);\n  }\n\n  /**\n   * Add a flip offset along the layer Y axis.\n   */\n  addFlipOffsetY() {\n    // flip offset\n    const scale = this.#konvaStage.scale();\n    const size = this.#konvaStage.size();\n    this.#flipOffset.y += size.height / scale.y;\n    // apply\n    const offset = this.#konvaStage.offset();\n    offset.y += this.#flipOffset.y;\n    this.#konvaStage.offset(offset);\n  }\n\n  /**\n   * Flip the scale along the layer X axis.\n   */\n  flipScaleX() {\n    this.#flipScale.x *= -1;\n  }\n\n  /**\n   * Flip the scale along the layer Y axis.\n   */\n  flipScaleY() {\n    this.#flipScale.y *= -1;\n  }\n\n  /**\n   * Flip the scale along the layer Z axis.\n   */\n  flipScaleZ() {\n    this.#flipScale.z *= -1;\n  }\n\n  /**\n   * Set the layer scale.\n   *\n   * @param {Scalar3D} newScale The scale as {x,y,z}.\n   * @param {Point3D} [center] The scale center.\n   */\n  setScale(newScale, center) {\n    const orientedNewScale =\n      this.#planeHelper.getTargetOrientedPositiveXYZ({\n        x: newScale.x * this.#flipScale.x,\n        y: newScale.y * this.#flipScale.y,\n        z: newScale.z * this.#flipScale.z,\n      });\n    const finalNewScale = {\n      x: this.#fitScale.x * orientedNewScale.x,\n      y: this.#fitScale.y * orientedNewScale.y\n    };\n\n    const offset = this.#konvaStage.offset();\n\n    if (Math.abs(newScale.x) === 1 &&\n      Math.abs(newScale.y) === 1 &&\n      Math.abs(newScale.z) === 1) {\n      // reset zoom offset for scale=1\n      const resetOffset = {\n        x: offset.x - this.#zoomOffset.x,\n        y: offset.y - this.#zoomOffset.y\n      };\n      // store new offset\n      this.#zoomOffset = {x: 0, y: 0};\n      this.#konvaStage.offset(resetOffset);\n    } else {\n      if (typeof center !== 'undefined') {\n        let worldCenter = this.#planeHelper.getPlaneOffsetFromOffset3D({\n          x: center.getX(),\n          y: center.getY(),\n          z: center.getZ()\n        });\n        // center was obtained with viewLayer.displayToMainPlanePos\n        // compensated for baseOffset\n        // TODO: justify...\n        worldCenter = {\n          x: worldCenter.x + this.#baseOffset.x,\n          y: worldCenter.y + this.#baseOffset.y\n        };\n\n        const newOffset = getScaledOffset(\n          offset, this.#konvaStage.scale(), finalNewScale, worldCenter);\n\n        const newZoomOffset = {\n          x: this.#zoomOffset.x + newOffset.x - offset.x,\n          y: this.#zoomOffset.y + newOffset.y - offset.y\n        };\n        // store new offset\n        this.#zoomOffset = newZoomOffset;\n        this.#konvaStage.offset(newOffset);\n      }\n    }\n\n    this.#konvaStage.scale(finalNewScale);\n    // update labels\n    this.#updateLabelScale(finalNewScale);\n  }\n\n  /**\n   * Initialise the layer scale.\n   *\n   * @param {Scalar3D} newScale The scale as {x,y,z}.\n   * @param {Scalar2D} absoluteZoomOffset The zoom offset as {x,y}\n   *   without the fit scale (as provided by getAbsoluteZoomOffset).\n   */\n  initScale(newScale, absoluteZoomOffset) {\n    const orientedNewScale = this.#planeHelper.getTargetOrientedPositiveXYZ({\n      x: newScale.x * this.#flipScale.x,\n      y: newScale.y * this.#flipScale.y,\n      z: newScale.z * this.#flipScale.z,\n    });\n    const finalNewScale = {\n      x: this.#fitScale.x * orientedNewScale.x,\n      y: this.#fitScale.y * orientedNewScale.y\n    };\n    this.#konvaStage.scale(finalNewScale);\n\n    this.#zoomOffset = {\n      x: absoluteZoomOffset.x / this.#fitScale.x,\n      y: absoluteZoomOffset.y / this.#fitScale.y\n    };\n    const offset = this.#konvaStage.offset();\n    this.#konvaStage.offset({\n      x: offset.x + this.#zoomOffset.x,\n      y: offset.y + this.#zoomOffset.y\n    });\n  }\n\n  /**\n   * Set the layer offset.\n   *\n   * @param {Scalar3D} newOffset The offset as {x,y,z}.\n   */\n  setOffset(newOffset) {\n    const newPanOffset =\n      this.#planeHelper.getPlaneOffsetFromOffset3D(newOffset);\n    const offset = this.#konvaStage.offset();\n    this.#konvaStage.offset({\n      x: offset.x - this.#panOffset.x + newPanOffset.x,\n      y: offset.y - this.#panOffset.y + newPanOffset.y\n    });\n    this.#panOffset = newPanOffset;\n  }\n\n  /**\n   * Set the base layer offset. Updates the layer offset.\n   *\n   * @param {Vector3D} scrollOffset The scroll offset vector.\n   * @param {Vector3D} planeOffset The plane offset vector.\n   * @returns {boolean} True if the offset was updated.\n   */\n  setBaseOffset(scrollOffset, planeOffset) {\n    const scrollDimIndex = this.#planeHelper.getNativeScrollDimIndex();\n    const newOffset = this.#planeHelper.getPlaneOffsetFromOffset3D({\n      x: scrollDimIndex === 0 ? scrollOffset.getX() : planeOffset.getX(),\n      y: scrollDimIndex === 1 ? scrollOffset.getY() : planeOffset.getY(),\n      z: scrollDimIndex === 2 ? scrollOffset.getZ() : planeOffset.getZ(),\n    });\n    const needsUpdate = this.#baseOffset.x !== newOffset.x ||\n      this.#baseOffset.y !== newOffset.y;\n    // reset offset if needed\n    if (needsUpdate) {\n      const offset = this.#konvaStage.offset();\n      this.#konvaStage.offset({\n        x: offset.x - this.#baseOffset.x + newOffset.x,\n        y: offset.y - this.#baseOffset.y + newOffset.y\n      });\n      this.#baseOffset = newOffset;\n    }\n    return needsUpdate;\n  }\n\n  /**\n   * Display the layer.\n   *\n   * @param {boolean} flag Whether to display the layer or not.\n   */\n  display(flag) {\n    this.#containerDiv.style.display = flag ? '' : 'none';\n  }\n\n  /**\n   * Check if the layer is visible.\n   *\n   * @returns {boolean} True if the layer is visible.\n   */\n  isVisible() {\n    return this.#containerDiv.style.display === '';\n  }\n\n  /**\n   * Draw the content (imageData) of the layer.\n   * The imageData variable needs to be set.\n   */\n  draw() {\n    this.#konvaStage.draw();\n  }\n\n  /**\n   * Initialise the layer: set the canvas and context.\n   *\n   * @param {Scalar2D} size The image size as {x,y}.\n   * @param {Scalar2D} spacing The image spacing as {x,y}.\n   * @param {string} refLayerId The reference image dataId.\n   */\n  initialise(size, spacing, refLayerId) {\n    // set locals\n    this.#baseSize = size;\n    this.#baseSpacing = spacing;\n    this.#referenceLayerId = refLayerId;\n\n    // create stage\n    this.#konvaStage = new Konva.Stage({\n      container: this.#containerDiv,\n      width: this.#baseSize.x,\n      height: this.#baseSize.y,\n      listening: false\n    });\n    // reset style\n    // (avoids a not needed vertical scrollbar)\n    this.#konvaStage.getContent().setAttribute('style', '');\n\n    // create layer\n    const konvaLayer = new Konva.Layer({\n      listening: false,\n      visible: true\n    });\n    this.#konvaStage.add(konvaLayer);\n  }\n\n  /**\n   * Set the annotation group.\n   *\n   * @param {AnnotationGroup} annotationGroup The annotation group.\n   * @param {string} dataId The associated data id.\n   * @param {object} exeCallback The undo stack callback.\n   */\n  setAnnotationGroup(annotationGroup, dataId, exeCallback) {\n    this.#dataId = dataId;\n    // local listeners\n    annotationGroup.addEventListener('annotationadd', (event) => {\n      // draw annotation\n      this.#addAnnotationDraw(event.data, true);\n      this.getKonvaLayer().draw();\n    });\n    annotationGroup.addEventListener('annotationupdate', (event) => {\n      // update annotation draw\n      this.#updateAnnotationDraw(event.data);\n      this.getKonvaLayer().draw();\n    });\n    annotationGroup.addEventListener('annotationremove', (event) => {\n      // remove annotation draw\n      this.#removeAnnotationDraw(event.data);\n      this.getKonvaLayer().draw();\n    });\n    annotationGroup.addEventListener(\n      'annotationgroupeditablechange',\n      (event) => {\n        this.activateCurrentPositionShapes(event.data);\n      }\n    );\n\n    // create draw controller\n    this.#drawController = new DrawController(annotationGroup);\n\n    // annotations are allready in the annotation list,\n    // -> no need to add them, just draw and save command\n    if (annotationGroup.getLength() !== 0) {\n      for (const annotation of annotationGroup.getList()) {\n        // draw annotation\n        this.#addAnnotationDraw(annotation, false);\n        // create the draw command\n        const command = new AddAnnotationCommand(\n          annotation, this.getDrawController());\n        // add command to undo stack\n        exeCallback(command);\n      }\n    }\n  }\n\n  /**\n   * Activate shapes at current position.\n   *\n   * @param {boolean} flag The flag to activate or not.\n   */\n  activateCurrentPositionShapes(flag) {\n    const konvaLayer = this.getKonvaLayer();\n\n    // stop stage listening\n    this.#konvaStage.listening(false);\n\n    if (typeof this.#shapeHandler !== 'undefined') {\n      // reset shape editor (remove anchors)\n      this.#shapeHandler.disableAndResetEditor();\n      // remove listeners for all position groups\n      const allPosGroups = konvaLayer.getChildren();\n      for (const posGroup of allPosGroups) {\n        if (posGroup instanceof Konva.Group) {\n          posGroup.getChildren().forEach((group) => {\n            if (group instanceof Konva.Group) {\n              this.#shapeHandler.removeShapeListeners(group);\n            }\n          });\n        }\n      }\n    }\n\n    // activate shape listeners if possible\n    const drawController = this.getDrawController();\n    if (flag &&\n      drawController.getAnnotationGroup().isEditable()) {\n      // start stage listening\n      this.#konvaStage.listening(true);\n      // shape groups at the current position\n      const shapeGroups =\n        this.#getCurrentPosGroup().getChildren();\n      // listen if we have shapes\n      if (shapeGroups.length !== 0) {\n        konvaLayer.listening(true);\n      }\n      // add listeners for position group\n      if (typeof this.#shapeHandler !== 'undefined') {\n        shapeGroups.forEach((group) => {\n          if (group instanceof Konva.Group) {\n            const annotation = drawController.getAnnotation(group.id());\n            this.#shapeHandler.addShapeGroupListeners(group, annotation, this);\n          }\n        });\n      }\n    }\n\n    konvaLayer.draw();\n  }\n\n  /**\n   * Get the position group id for an annotation.\n   *\n   * @param {Annotation} annotation The target annotation.\n   * @returns {string|undefined} The group id.\n   */\n  #getAnnotationPosGroupId(annotation) {\n    let points;\n    // annotation planePoints are only present\n    // for non aquisition plane\n    if (typeof annotation.planePoints !== 'undefined') {\n      // use plane points\n      points = annotation.planePoints;\n    } else if (typeof annotation.planeOrigin !== 'undefined') {\n      // just use plane origin\n      points = [annotation.planeOrigin];\n    }\n    let posId;\n    if (typeof points !== 'undefined') {\n      posId = this.#getPositionId(points, annotation.referencedFrameNumber);\n    }\n    return posId;\n  }\n\n  /**\n   * Get a string id from input plane points.\n   *\n   * @param {Point3D[]} points A list of points that defined a plane.\n   * @param {number} [frameNumber] Optional frame number.\n   * @returns {string} The string id.\n   */\n  #getPositionId(points, frameNumber) {\n    let res = '';\n    for (const point of points) {\n      if (res.length !== 0) {\n        res += '-';\n      }\n      const posValues = [\n        precisionRound(point.getX(), 2),\n        precisionRound(point.getY(), 2),\n        precisionRound(point.getZ(), 2),\n      ];\n      res += toStringId(posValues);\n    }\n    if (typeof frameNumber !== 'undefined') {\n      res += '-' + frameNumber;\n    }\n    return res;\n  }\n\n  /**\n   * Find the shape group associated to an annotation.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @returns {Konva.Group|undefined} The shape group.\n   */\n  #findShapeGroup(annotation) {\n    let res;\n\n    const posGroupId = this.#getAnnotationPosGroupId(annotation);\n    const layerChildren = this.getKonvaLayer().getChildren(\n      isNodeWithId(posGroupId));\n    if (layerChildren.length !== 0) {\n      const posGroup = layerChildren[0];\n      if (!(posGroup instanceof Konva.Group)) {\n        return;\n      }\n      const posChildren = posGroup.getChildren(\n        isNodeWithId(annotation.trackingUid));\n      if (posChildren.length !== 0 &&\n        posChildren[0] instanceof Konva.Group) {\n        res = posChildren[0];\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Draw an annotation: create the shape group and add it to\n   *   the Konva layer.\n   *\n   * @param {Annotation} annotation The annotation to draw.\n   * @param {boolean} visible The position group visibility.\n   */\n  #addAnnotationDraw(annotation, visible) {\n    // check for compatible view\n    if (!annotation.canView() ||\n      !annotation.isCompatibleView(this.#planeHelper)) {\n      return;\n    }\n    const posGroupId = this.#getAnnotationPosGroupId(annotation);\n    // Get or create position-group if it does not exist and\n    // append it to konvaLayer\n    let posGroup = this.getKonvaLayer().getChildren(\n      isNodeWithId(posGroupId))[0];\n    if (typeof posGroup === 'undefined') {\n      posGroup = new Konva.Group({\n        id: posGroupId,\n        name: 'position-group',\n        visible: visible\n      });\n      this.getKonvaLayer().add(posGroup);\n    }\n    if (!(posGroup instanceof Konva.Group)) {\n      return;\n    };\n\n    const style = new Style();\n    const stage = this.getKonvaStage();\n    style.setZoomScale(stage.scale());\n\n    // shape group (use first one since it will be removed from\n    // the group when we change it)\n    const factory = annotation.getFactory();\n    if (typeof factory === 'undefined') {\n      throw new Error('Cannot add an annotation draw without factory');\n    }\n    const shapeGroup = factory.createShapeGroup(annotation, style);\n    // add group to posGroup (switches its parent)\n    posGroup.add(shapeGroup);\n\n    // activate shape if possible\n    if (visible &&\n      typeof this.#shapeHandler !== 'undefined'\n    ) {\n      this.#shapeHandler.addShapeGroupListeners(shapeGroup, annotation, this);\n    }\n    // set label visibility\n    this.setLabelVisibility(shapeGroup);\n  }\n\n  /**\n   * Remove an annotation draw.\n   *\n   * @param {Annotation} annotation The annotation to remove.\n   * @returns {boolean} True if the shape group has been found and removed.\n   */\n  #removeAnnotationDraw(annotation) {\n    const shapeGroup = this.#findShapeGroup(annotation);\n    if (!(shapeGroup instanceof Konva.Group)) {\n      logger.debug('No shape group to remove');\n      return false;\n    };\n    shapeGroup.remove();\n    return true;\n  }\n\n  /**\n   * Update an annotation draw.\n   *\n   * @param {Annotation} annotation The annotation to update.\n   */\n  #updateAnnotationDraw(annotation) {\n    if (this.#removeAnnotationDraw(annotation)) {\n      this.#addAnnotationDraw(annotation, true);\n    }\n  }\n\n  /**\n   * Fit the layer to its parent container.\n   *\n   * @param {Scalar2D} containerSize The container size as {x,y}.\n   * @param {number} divToWorldSizeRatio The div to world size ratio.\n   * @param {Scalar2D} fitOffset The fit offset as {x,y}.\n   */\n  fitToContainer(containerSize, divToWorldSizeRatio, fitOffset) {\n    // fit scale\n    const newFitScale = {\n      x: divToWorldSizeRatio * this.#baseSpacing.x,\n      y: divToWorldSizeRatio * this.#baseSpacing.y\n    };\n    const fitRatio = {\n      x: newFitScale.x / this.#fitScale.x,\n      y: newFitScale.y / this.#fitScale.y\n    };\n\n    // size ratio (calculated before update)\n    const sizeRatio = {\n      x: containerSize.x / (this.#konvaStage.width() * fitRatio.x),\n      y: containerSize.y / (this.#konvaStage.height() * fitRatio.y)\n    };\n\n    // set canvas size if different from previous\n    if (this.#konvaStage.width() !== containerSize.x ||\n      this.#konvaStage.height() !== containerSize.y) {\n      this.#konvaStage.width(containerSize.x);\n      this.#konvaStage.height(containerSize.y);\n    }\n\n    // #scale = inputScale * fitScale * flipScale\n    // flipScale does not change here, we can omit it\n    // newScale = (#scale / fitScale) * newFitScale\n    const newScale = {\n      x: this.#konvaStage.scale().x * fitRatio.x,\n      y: this.#konvaStage.scale().y * fitRatio.y\n    };\n\n    // set scales if different from previous\n    if (this.#konvaStage.scale().x !== newScale.x ||\n      this.#konvaStage.scale().y !== newScale.y) {\n      this.#fitScale = newFitScale;\n      this.#konvaStage.scale(newScale);\n      this.#updateLabelScale(newScale);\n    }\n\n    // view offset\n    const newViewOffset = {\n      x: fitOffset.x / newFitScale.x,\n      y: fitOffset.y / newFitScale.y\n    };\n    // flip offset\n    const scaledImageSize = {\n      x: containerSize.x / newFitScale.x,\n      y: containerSize.y / newFitScale.y\n    };\n    const newFlipOffset = {\n      x: this.#flipOffset.x !== 0 ? scaledImageSize.x : 0,\n      y: this.#flipOffset.y !== 0 ? scaledImageSize.y : 0,\n    };\n\n    // set offsets if different from previous\n    if (this.#viewOffset.x !== newViewOffset.x ||\n      this.#viewOffset.y !== newViewOffset.y ||\n      this.#flipOffset.x !== newFlipOffset.x ||\n      this.#flipOffset.y !== newFlipOffset.y) {\n      const newZoomOffset = {\n        x: this.#zoomOffset.x * sizeRatio.x,\n        y: this.#zoomOffset.y * sizeRatio.y\n      };\n      // update global offset\n      this.#konvaStage.offset({\n        x: this.#konvaStage.offset().x +\n          newViewOffset.x - this.#viewOffset.x +\n          newFlipOffset.x - this.#flipOffset.x +\n          newZoomOffset.x - this.#zoomOffset.x,\n        y: this.#konvaStage.offset().y +\n          newViewOffset.y - this.#viewOffset.y +\n          newFlipOffset.y - this.#flipOffset.y +\n          newZoomOffset.y - this.#zoomOffset.y\n      });\n      // update private local offsets\n      this.#flipOffset = newFlipOffset;\n      this.#viewOffset = newViewOffset;\n      this.#zoomOffset = newZoomOffset;\n    }\n  }\n\n  /**\n   * Check the visibility of an annotation.\n   *\n   * @param {string} id The id of the annotation.\n   * @returns {boolean} True if the annotation is visible.\n   */\n  isAnnotationVisible(id) {\n    // get the group (annotation and group have same id)\n    const group = this.#getGroup(id);\n    if (typeof group === 'undefined') {\n      return false;\n    }\n    // get visibility\n    return group.isVisible();\n  }\n\n  /**\n   * Set the visibility of an annotation.\n   *\n   * @param {string} id The id of the annotation.\n   * @param {boolean} [visible] True to set to visible,\n   *   will toggle visibility if not defined.\n   * @returns {boolean} False if the annotation shape cannot be found.\n   */\n  setAnnotationVisibility(id, visible) {\n    // get the group (annotation and group have same id)\n    const group = this.#getGroup(id);\n    if (typeof group === 'undefined') {\n      return false;\n    }\n    // if not set, toggle visibility\n    if (typeof visible === 'undefined') {\n      visible = !group.isVisible();\n    }\n    group.visible(visible);\n\n    // udpate\n    this.draw();\n\n    return true;\n  }\n\n  /**\n   * Set the visibility of all labels.\n   *\n   * @param {boolean} [visible] True to set to visible,\n   *   will toggle visibility if not defined.\n   */\n  setLabelsVisibility(visible) {\n    this.#visibleLabels = visible;\n\n    const posGroups = this.getKonvaLayer().getChildren();\n    for (const posGroup of posGroups) {\n      if (posGroup instanceof Konva.Group) {\n        const shapeGroups = posGroup.getChildren();\n        for (const shapeGroup of shapeGroups) {\n          if (shapeGroup instanceof Konva.Group) {\n            this.#setLabelVisibility(shapeGroup, visible);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Set a shape group label visibility.\n   *\n   * @param {Konva.Group} shapeGroup The shape group.\n   * @param {boolean} [visible] True to set to visible,\n   *   will toggle visibility if not defined.\n   */\n  #setLabelVisibility(shapeGroup, visible) {\n    const label = shapeGroup.getChildren(isNodeNameLabel)[0];\n    if (!(label instanceof Konva.Label)) {\n      return;\n    }\n    // if not set, toggle visibility\n    if (typeof visible === 'undefined') {\n      visible = !label.isVisible();\n    }\n    // set visible only for non empty text\n    if (typeof label.getText() !== 'undefined' &&\n      label.getText().text().length !== 0) {\n      label.visible(visible);\n      const connector = shapeGroup.getChildren(node =>\n        (node.className === 'Line') && node.name() === 'connector')[0];\n      if (connector) {\n        connector.visible(visible);\n      }\n    }\n  }\n\n  /**\n   * Set a shape group label visibility according to\n   *  this layer setting.\n   *\n   * @param {Konva.Group} shapeGroup The shape group.\n   */\n  setLabelVisibility(shapeGroup) {\n    this.#setLabelVisibility(shapeGroup, this.#visibleLabels);\n  }\n\n  /**\n   * Delete a Draw from the stage.\n   *\n   * @deprecated Since v0.34, please switch to `annotationGroup.remove`.\n   * @param {string} _id The id of the group to delete.\n   * @param {Function} _exeCallback The callback to call once the\n   *  DeleteCommand has been executed.\n   */\n  deleteDraw(_id, _exeCallback) {\n    // does nothing\n  }\n\n  /**\n   * Delete all Draws from the stage.\n   *\n   * @deprecated Since v0.34, please switch to `annotationGroup.remove`.\n   * @param {Function} _exeCallback The callback to call once the\n   *  DeleteCommand has been executed.\n   */\n  deleteDraws(_exeCallback) {\n    // does nothing\n  }\n\n  /**\n   * Get the total number of draws of this layer\n   * (at all positions).\n   *\n   * @returns {number|undefined} The total number of draws.\n   */\n  getNumberOfDraws() {\n    const posGroups = this.getKonvaLayer().getChildren();\n    let count = 0;\n    for (const posGroup of posGroups) {\n      if (posGroup instanceof Konva.Group) {\n        count += posGroup.getChildren().length;\n      }\n    }\n    return count;\n  }\n\n  /**\n   * Enable and listen to container interaction events.\n   */\n  bindInteraction() {\n    this.#konvaStage.listening(true);\n    // allow pointer events\n    this.#containerDiv.style.pointerEvents = 'auto';\n    // interaction events\n    const names = InteractionEventNames;\n    for (let i = 0; i < names.length; ++i) {\n      this.#containerDiv.addEventListener(names[i], this.#fireEvent);\n    }\n  }\n\n  /**\n   * Disable and stop listening to container interaction events.\n   */\n  unbindInteraction() {\n    this.#konvaStage.listening(false);\n    // disable pointer events\n    this.#containerDiv.style.pointerEvents = 'none';\n    // interaction events\n    const names = InteractionEventNames;\n    for (let i = 0; i < names.length; ++i) {\n      this.#containerDiv.removeEventListener(names[i], this.#fireEvent);\n    }\n  }\n\n  /**\n   * Set the current position.\n   *\n   * @param {Point} position The new position.\n   * @param {Index} [index] Optional coresponding index.\n   * @returns {boolean} True if the position was updated.\n   */\n  setCurrentPosition(position, index) {\n    if (typeof index === 'undefined') {\n      index = this.#planeHelper.worldToIndex(position);\n    }\n    const planePoints = this.#planeHelper.getPlanePoints(position);\n    let points;\n    if (this.#planeHelper.isAquisitionOrientation()) {\n      // just use plane origin\n      points = [planePoints[0]];\n    } else {\n      // use plane points\n      points = planePoints;\n    }\n    let frameNumber;\n    if (position.length() > 3) {\n      frameNumber = position.get(3);\n    }\n    const posGroupId = this.#getPositionId(points, frameNumber);\n\n    this.#activateDrawLayer(posGroupId);\n    // TODO: add check\n    this.#fireEvent({\n      type: 'positionchange',\n      value: [\n        index.getValues(),\n        position.getValues(),\n      ],\n      valid: true\n    });\n\n    return true;\n  }\n\n  /**\n   * Activate the current draw layer.\n   *\n   * @param {string} posGroupId The position group ID.\n   */\n  #activateDrawLayer(posGroupId) {\n    this.#currentPosGroupId = posGroupId;\n\n    // get all position groups\n    const posGroups = this.getKonvaLayer().getChildren(isPositionNode);\n    // reset or set the visible property\n    let visible;\n    for (let i = 0, leni = posGroups.length; i < leni; ++i) {\n      visible = false;\n      if (typeof posGroupId !== 'undefined' &&\n        posGroups[i].id() === posGroupId) {\n        visible = true;\n      }\n      // group members inherit the visible property\n      posGroups[i].visible(visible);\n    }\n\n    // show current draw layer\n    this.getKonvaLayer().draw();\n  }\n\n  /**\n   * Get the current position group.\n   *\n   * @returns {Konva.Group|undefined} The Konva group.\n   */\n  #getCurrentPosGroup() {\n    if (typeof this.#currentPosGroupId === 'undefined') {\n      return;\n    }\n    // get position groups\n    const posGroups = this.getKonvaLayer().getChildren((node) => {\n      return node.id() === this.#currentPosGroupId;\n    });\n    // if one group, use it\n    // if no group, create one\n    let posGroup;\n    if (posGroups.length === 1) {\n      if (posGroups[0] instanceof Konva.Group) {\n        posGroup = posGroups[0];\n      }\n    } else if (posGroups.length === 0) {\n      posGroup = new Konva.Group();\n      posGroup.name('position-group');\n      posGroup.id(this.#currentPosGroupId);\n      posGroup.visible(true); // dont inherit\n      // add new group to layer\n      this.getKonvaLayer().add(posGroup);\n    } else {\n      logger.warn('Unexpected number of draw position groups');\n    }\n    // return\n    return posGroup;\n  }\n\n  /**\n   * Get a Konva group using its id.\n   *\n   * @param {string} id The group id.\n   * @returns {Konva.Group|undefined} The Konva group.\n   */\n  #getGroup(id) {\n    return this.getKonvaLayer().findOne('#' + id);\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    event.srclayerid = this.getId();\n    event.dataid = this.#dataId;\n    this.#listenerHandler.fireEvent(event);\n  };\n\n  // common layer methods [end] ---------------\n\n  /**\n   * Update label scale: compensate for it so\n   *   that label size stays visually the same.\n   *\n   * @param {Scalar2D} scale The scale to compensate for as {x,y}.\n   */\n  #updateLabelScale(scale) {\n    // same formula as in labelFactory::create\n    // compensate for scale and times 2 so that font 10 looks like a 10\n    const ratioX = 2 / scale.x;\n    const ratioY = 2 / scale.y;\n    // compensate scale for labels\n    const labels = this.#konvaStage.find('Label');\n    for (let i = 0; i < labels.length; ++i) {\n      labels[i].scale({x: ratioX, y: ratioY});\n    }\n  }\n\n} // DrawLayer class\n\n// *************************\n// legacy code to allow to convert old state into annotation\n// *************************\n\n/**\n * Draw meta data.\n */\nexport class DrawMeta {\n  /**\n   * Draw quantification.\n   *\n   * @type {object}\n   */\n  quantification;\n\n  /**\n   * Draw text expression. Can contain variables surrounded with '{}' that will\n   * be extracted from the quantification object.\n   *\n   * @type {string}\n   */\n  textExpr;\n}\n\n/**\n * Draw details.\n */\nexport class DrawDetails {\n  /**\n   * The draw ID.\n   *\n   * @type {number}\n   */\n  id;\n\n  /**\n   * The draw position: an Index converted to string.\n   *\n   * @type {string}\n   */\n  position;\n\n  /**\n   * The draw type.\n   *\n   * @type {string}\n   */\n  type;\n\n  /**\n   * The draw color: for example 'green', '#00ff00' or 'rgb(0,255,0)'.\n   *\n   * @type {string}\n   */\n  color;\n\n  /**\n   * The draw meta.\n   *\n   * @type {DrawMeta}\n   */\n  meta;\n}\n\n/**\n * Convert a posGroup id (for ex '#2-0') into index values.\n *\n * @param {string} id The posGroup id.\n * @returns {number[]} The index values.\n */\nfunction posGroupIdToArray(id) {\n  const res = [0, 0, 0];\n\n  const splitHashes = id.split('#');\n  for (const splitHash of splitHashes) {\n    const split = splitHash.split('-');\n    res[split[0]] = split[1];\n  }\n\n  return res;\n}\n\n/**\n * Convert a KonvaLayer object to a list of annotations.\n *\n * @param {Array} drawings An array of drawings stored\n *   with 'KonvaLayer().toObject()'.\n * @param {DrawDetails[]} drawingsDetails An array of drawings details.\n * @param {Image} refImage The reference image.\n * @returns {Annotation[]} The associated list of annotations.\n */\nexport function konvaToAnnotation(drawings, drawingsDetails, refImage) {\n  const annotations = [];\n\n  // regular Konva deserialize\n  const stateLayer = Konva.Node.create(drawings);\n\n  // get all position groups\n  const statePosGroups = stateLayer.getChildren(isPositionNode);\n\n  for (let i = 0, leni = statePosGroups.length; i < leni; ++i) {\n    const statePosGroup = statePosGroups[i];\n    const statePosKids = statePosGroup.getChildren();\n    for (let j = 0, lenj = statePosKids.length; j < lenj; ++j) {\n      const annotation = new Annotation();\n      // use posGroup id as origin\n      const posGroupIndex = new Index(posGroupIdToArray(statePosGroup.id()));\n      // find ref SOP UID\n      // WARN: getImageUid returns first UID is the index is not found...\n      annotation.referencedSopInstanceUID = refImage.getImageUid(posGroupIndex);\n\n      // shape group (use first one since it will be removed from\n      // the group when we change it)\n      const stateGroup = statePosKids[0];\n      // annotation id\n      annotation.trackingId = stateGroup.id();\n      annotation.trackingUid = stateGroup.id();\n\n      // shape\n      const shape = stateGroup.getChildren(isNodeNameShape)[0];\n      // annotation colour\n      annotation.colour = shape.stroke();\n\n      if (stateGroup.name() === 'line-group') {\n        const points = shape.points();\n        annotation.mathShape = new Point2D(points[0], points[1]);\n        annotation.referencePoints = [\n          new Point2D(points[2], points[3])\n        ];\n      } else if (stateGroup.name() === 'ruler-group') {\n        const points = shape.points();\n        annotation.mathShape = new Line(\n          new Point2D(points[0], points[1]),\n          new Point2D(points[2], points[3])\n        );\n      } else if (stateGroup.name() === 'rectangle-group') {\n        annotation.mathShape = new Rectangle(\n          new Point2D(shape.x(), shape.y()),\n          new Point2D(shape.x() + shape.width(), shape.y() + shape.height())\n        );\n      } else if (stateGroup.name() === 'roi-group') {\n        const points = shape.points();\n        const pointsArray = [];\n        for (let i = 0; i < points.length; i = i + 2) {\n          pointsArray.push(new Point2D(points[i], points[i + 1]));\n        }\n        annotation.mathShape = new ROI(pointsArray);\n      } else if (stateGroup.name() === 'freeHand-group') {\n        logger.warn('Converting freehand into ROI shape');\n        const points = shape.points();\n        const pointsArray = [];\n        for (let i = 0; i < points.length; i = i + 2) {\n          pointsArray.push(new Point2D(points[i], points[i + 1]));\n        }\n        annotation.mathShape = new ROI(pointsArray);\n      } else if (stateGroup.name() === 'protractor-group') {\n        const points = shape.points();\n        annotation.mathShape = new Protractor([\n          new Point2D(points[0], points[1]),\n          new Point2D(points[2], points[3]),\n          new Point2D(points[4], points[5])\n        ]);\n      } else if (stateGroup.name() === 'ellipse-group') {\n        const absPosition = shape.absolutePosition();\n        annotation.mathShape = new Ellipse(\n          new Point2D(absPosition.x, absPosition.y),\n          shape.radiusX(),\n          shape.radiusY()\n        );\n      } else if (stateGroup.name() === 'circle-group') {\n        const absPosition = shape.absolutePosition();\n        annotation.mathShape = new Circle(\n          new Point2D(absPosition.x, absPosition.y),\n          shape.radius()\n        );\n      }\n\n      // details\n      if (drawingsDetails) {\n        const details = drawingsDetails[stateGroup.id()];\n        annotation.textExpr = details.meta.textExpr;\n        annotation.quantification = details.meta.quantification;\n      }\n\n      annotations.push(annotation);\n    }\n  }\n\n  return annotations;\n}\n","import {\n  getLayerDetailsFromLayerDivId,\n  getLayerDetailsFromInfoLayerDivId\n} from './layerGroup.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {InfoDataItem} from './infoData.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Get the HTML div id of a position element.\n *\n * @param {string} pos The position indicator.\n * @returns {string} The div id.\n */\nfunction getPosDivId(pos) {\n  return 'info-' + pos;\n}\n\n/**\n * Get the HTML li id for a data.\n *\n * @param {InfoDataItem} data The associated data.\n * @returns {string} The ID.\n */\nfunction getLiId(data) {\n  let type = '';\n  if (typeof data.tags !== 'undefined') {\n    type = data.tags.join('');\n  } else {\n    type = data.event;\n  }\n  let format = encodeURIComponent(data.format.toLowerCase());\n  format = format.replace(/%[0-9A-F]{2}/gi, '');\n\n  return getPosDivId(data.pos) + '-' + type + '-' + format;\n}\n\n/**\n * Meta info layer.\n */\nexport class InfoLayer {\n  /**\n   * HTML creation flag.\n   *\n   * @type {boolean}\n   */\n  #created = false;\n\n  /**\n   * Associated HTML div.\n   *\n   * @type {HTMLDivElement}\n   */\n  #containerDiv;\n\n  /**\n   * @param {HTMLDivElement} div The associated HTML div.\n   */\n  constructor(div) {\n    this.#containerDiv = div;\n  }\n\n  /**\n   * Handle info data change.\n   *\n   * @param {object} event The value change event.\n   */\n  onDataChange = (event) => {\n    if (typeof event.data === 'undefined') {\n      return;\n    }\n    // avoid events from other layers\n    if (typeof event.srclayerid !== 'undefined') {\n      const srcDetails = getLayerDetailsFromLayerDivId(event.srclayerid);\n      const details =\n        getLayerDetailsFromInfoLayerDivId(this.#containerDiv.id);\n      if (srcDetails.groupDivId !== details.groupDivId) {\n        return;\n      }\n    }\n    if (!this.#created) {\n      this.#create(event.data);\n    }\n    this.#update(event.data);\n  };\n\n  /**\n   * Create the info layer HTML.\n   *\n   * @param {InfoDataItem[]} data The info data array.\n   */\n  #create(data) {\n    // possible info pos\n    const posList = [];\n    for (const item of data) {\n      const dataPos = item.pos;\n      if (!posList.includes(dataPos)) {\n        posList.push(dataPos);\n      }\n    }\n\n    for (const pos of posList) {\n      // create list element\n      const ul = document.createElement('ul');\n      // list items\n      for (const item of data) {\n        if (item.pos === pos) {\n          const li = document.createElement('li');\n          li.id = getLiId(item);\n          // fill in tags\n          if (typeof item.tags !== 'undefined') {\n            li.appendChild(document.createTextNode(item.value));\n          }\n          // append to list\n          ul.appendChild(li);\n        }\n      }\n      // position element\n      const posElement = document.createElement('div');\n      posElement.id = getPosDivId(pos);\n      posElement.className = 'info-' + pos + ' info';\n      posElement.appendChild(ul);\n      // append to main div\n      this.#containerDiv.appendChild(posElement);\n    }\n\n    // update flag\n    this.#created = true;\n  };\n\n  /**\n   * Update the info layer HTML.\n   *\n   * @param {InfoDataItem[]} data The info data array.\n   */\n  #update(data) {\n    // updates all the data\n    for (const item of data) {\n      const id = '#' + getLiId(item);\n      const li = this.#containerDiv.querySelector(id);\n      const text = item.value;\n      if (text && li) {\n        // update li\n        li.replaceChildren(document.createTextNode(text));\n      }\n    }\n  };\n\n}; // class InfoLayer","import {Index} from '../math/index.js';\nimport {Point} from '../math/point.js';\nimport {Vector3D} from '../math/vector.js';\nimport {viewEventNames} from '../image/view.js';\nimport {ListenerHandler} from '../utils/listen.js';\nimport {logger} from '../utils/logger.js';\nimport {precisionRound} from '../utils/string.js';\nimport {ViewLayer} from './viewLayer.js';\nimport {DrawLayer} from './drawLayer.js';\nimport {SOPClassUIDs} from '../dicom/dictionary.js';\nimport {InfoLayer} from './infoLayer.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point2D, Point3D} from '../math/point.js';\nimport {Scalar2D, Scalar3D} from '../math/scalar.js';\nimport {PositionHelper} from '../image/positionHelper.js';\nimport {InfoData} from './infoData.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Get the layer div id.\n * For example: 'layerGroup0-layer-0'.\n *\n * @param {string} groupDivId The layer group div id.\n * @param {number} layerIndex The layer index.\n * @returns {string} A string id.\n */\nexport function getLayerDivId(groupDivId, layerIndex) {\n  return groupDivId + '-layer-' + layerIndex;\n}\n\n/**\n * Get the layer details from a div id\n * created by getLayerDivId.\n *\n * @param {string} idString The layer div id.\n * @returns {object} The layer details as {groupDivId, layerIndex, layerId}.\n */\nexport function getLayerDetailsFromLayerDivId(idString) {\n  const split = idString.split('-layer-');\n  if (split.length !== 2) {\n    logger.warn('Not the expected layer div id format...');\n  }\n  return {\n    groupDivId: split[0],\n    layerIndex: split[1],\n    layerId: idString,\n  };\n}\n\n/**\n * Get the info layer div id.\n * For example: 'layerGroup0-infoLayer'.\n *\n * @param {string} groupDivId The layer group div id.\n * @returns {string} A string id.\n */\nexport function getInfoLayerDivId(groupDivId) {\n  return groupDivId + '-infolayer';\n}\n\n/**\n * Get the layer details from an info layer div id\n * created by getInfoLayerDivId.\n *\n * @param {string} idString The layer div id.\n * @returns {object} The layer details as {groupDivId}.\n */\nexport function getLayerDetailsFromInfoLayerDivId(idString) {\n  const groupDivId = idString.substring(0, idString.length - 10);\n  return {groupDivId};\n}\n\n/**\n * Get the layer details from a mouse event.\n *\n * @param {object} event The event to get the layer div id from. Expecting\n * an event origininating from a canvas inside a layer HTML div\n * with the 'layer' class and id generated with `getLayerDivId`.\n * @returns {object} The layer details as {groupDivId, layerIndex, layerId}.\n */\nexport function getLayerDetailsFromEvent(event) {\n  let res = null;\n  // get the closest element from the event target and with the 'layer' class\n  const layerDiv = event.target.closest('.layer');\n  if (layerDiv && typeof layerDiv.id !== 'undefined') {\n    res = getLayerDetailsFromLayerDivId(layerDiv.id);\n  }\n  return res;\n}\n\n/**\n * Get a scaled offset to adapt to new scale and such as the input center\n * stays at the same position.\n *\n * @param {Scalar2D} offset The previous offset as {x,y}.\n * @param {Scalar2D} scale The previous scale as {x,y}.\n * @param {Scalar2D} newScale The new scale as {x,y}.\n * @param {Scalar2D} center The scale center as {x,y}.\n * @returns {Scalar2D} The scaled offset as {x,y}.\n */\nexport function getScaledOffset(offset, scale, newScale, center) {\n  // worldPoint = indexPoint / scale + offset\n  //=> indexPoint = (worldPoint - offset ) * scale\n\n  // plane center should stay the same:\n  // indexCenter / newScale + newOffset =\n  //   indexCenter / oldScale + oldOffset\n  //=> newOffset = indexCenter / oldScale + oldOffset -\n  //     indexCenter / newScale\n  //=> newOffset = worldCenter - indexCenter / newScale\n  const indexCenter = {\n    x: (center.x - offset.x) * scale.x,\n    y: (center.y - offset.y) * scale.y\n  };\n  return {\n    x: center.x - (indexCenter.x / newScale.x),\n    y: center.y - (indexCenter.y / newScale.y)\n  };\n}\n\n/**\n * Layer group.\n *\n * - Display position: {x,y},\n * - Plane position: Index (access: get(i)),\n * - (world) Position: Point3D (access: getX, getY, getZ).\n *\n * Display -> World:\n * - planePos = viewLayer.displayToPlanePos(displayPos)\n *   -> compensate for layer scale and offset,\n * - pos = viewController.getPositionFromPlanePoint(planePos).\n *\n * World -> Display:\n * - planePos = viewController.getOffset3DFromPlaneOffset(pos)\n *   no need yet for a planePos to displayPos...\n */\nexport class LayerGroup {\n\n  /**\n   * The container div.\n   *\n   * @type {HTMLElement}\n   */\n  #containerDiv;\n\n  // jsdoc does not like\n  // @type {(ViewLayer|DrawLayer)[]}\n\n  /**\n   * List of layers.\n   *\n   * @type {Array<ViewLayer|DrawLayer>}\n   */\n  #layers = [];\n\n  /**\n   * The layer scale as {x,y,z}.\n   *\n   * @type {Scalar3D}\n   */\n  #scale = {x: 1, y: 1, z: 1};\n\n  /**\n   * The base scale as {x,y,z}: all posterior scale will be on top of this one.\n   *\n   * @type {Scalar3D}\n   */\n  #baseScale = {x: 1, y: 1, z: 1};\n\n  /**\n   * The layer offset as {x,y,z}.\n   *\n   * @type {Scalar3D}\n   */\n  #offset = {x: 0, y: 0, z: 0};\n\n  /**\n   * Active layer index.\n   *\n   * @type {number}\n   */\n  #activeLayerIndex = undefined;\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Flag to activate crosshair or not.\n   *\n   * @type {boolean}\n   */\n  #showCrosshair = false;\n\n  /**\n   * Crosshair HTML elements.\n   *\n   * @type {HTMLElement[]}\n   */\n  #crosshairHtmlElements = [];\n\n  /**\n   * Tooltip HTML element.\n   *\n   * @type {HTMLElement}\n   */\n  #tooltipHtmlElement;\n\n  /**\n   * Image smoothing flag.\n   *\n   * @type {boolean}\n   */\n  #imageSmoothing = false;\n\n  /**\n   * Position helper.\n   *\n   * @type {PositionHelper}\n   */\n  #positionHelper;\n\n  /**\n   * Info layer.\n   *\n   * @type {InfoLayer}\n   */\n  #infoLayer;\n\n  /**\n   * List of info data.\n   *\n   * @type {InfoData[]}\n   */\n  #infoDatas = [];\n\n  /**\n   * Dataid of the info source data.\n   *\n   * @type {string}\n   */\n  #infoDataId;\n\n  /**\n   * Get the position helper.\n   *\n   * @returns {PositionHelper|undefined} The position helper or\n   * undefined if no layers.\n   */\n  getPositionHelper() {\n    if (typeof this.#positionHelper === 'undefined') {\n      for (const layer of this.#layers) {\n        if (layer instanceof ViewLayer) {\n          const controller = layer.getViewController();\n          const helper = controller.getPositionHelper();\n          if (typeof this.#positionHelper === 'undefined') {\n            this.#positionHelper = helper;\n          } else {\n            this.#positionHelper.merge(helper);\n          }\n        }\n      }\n    }\n    return this.#positionHelper;\n  }\n\n  /**\n   * @param {HTMLElement} containerDiv The associated HTML div.\n   * @param {boolean} [withInfoLayer] Optional with info layer flag,\n   * default to false.\n   */\n  constructor(containerDiv, withInfoLayer) {\n    this.#containerDiv = containerDiv;\n\n    if (typeof withInfoLayer !== 'undefined' &&\n      withInfoLayer === true\n    ) {\n      const layerDiv = document.createElement('div');\n      layerDiv.id = getInfoLayerDivId(containerDiv.id);\n      layerDiv.className = 'infoLayer';\n      containerDiv.appendChild(layerDiv);\n      this.#infoLayer = new InfoLayer(layerDiv);\n    }\n  }\n\n  /**\n   * Get the showCrosshair flag.\n   *\n   * @returns {boolean} True to display the crosshair.\n   */\n  getShowCrosshair() {\n    return this.#showCrosshair;\n  }\n\n  /**\n   * Set the showCrosshair flag.\n   *\n   * @param {boolean} flag True to display the crosshair.\n   */\n  setShowCrosshair(flag) {\n    this.#showCrosshair = flag;\n    if (flag) {\n      // listen to offset and zoom change\n      this.addEventListener('offsetchange', this.#updateCrosshairOnChange);\n      this.addEventListener('zoomchange', this.#updateCrosshairOnChange);\n      // show crosshair div\n      this.#showCrosshairDiv();\n    } else {\n      // listen to offset and zoom change\n      this.removeEventListener('offsetchange', this.#updateCrosshairOnChange);\n      this.removeEventListener('zoomchange', this.#updateCrosshairOnChange);\n      // remove crosshair div\n      this.#removeCrosshairDiv();\n    }\n  }\n\n  /**\n   * Set the imageSmoothing flag value.\n   *\n   * @param {boolean} flag True to enable smoothing.\n   */\n  setImageSmoothing(flag) {\n    this.#imageSmoothing = flag;\n    // set for existing layers\n    for (const layer of this.#layers) {\n      if (layer instanceof ViewLayer) {\n        layer.setImageSmoothing(flag);\n      }\n    }\n  }\n\n  /**\n   * Update crosshair on offset or zoom change.\n   *\n   * @param {object} _event The change event.\n   */\n  #updateCrosshairOnChange = (_event) => {\n    this.#showCrosshairDiv();\n  };\n\n  /**\n   * Get the Id of the container div.\n   *\n   * @returns {string|undefined} The id of the div.\n   */\n  getDivId() {\n    let divId;\n    // could be null if html changed\n    if (this.#containerDiv !== null) {\n      divId = this.#containerDiv.id;\n    }\n    return divId;\n  }\n\n  /**\n   * Get the layer scale.\n   *\n   * @returns {Scalar3D} The scale as {x,y,z}.\n   */\n  getScale() {\n    return this.#scale;\n  }\n\n  /**\n   * Get the base scale.\n   *\n   * @returns {Scalar3D} The scale as {x,y,z}.\n   */\n  getBaseScale() {\n    return this.#baseScale;\n  }\n\n\n  /**\n   * Get the added scale: the scale added to the base scale.\n   *\n   * @returns {Scalar3D} The scale as {x,y,z}.\n   */\n  getAddedScale() {\n    return {\n      x: this.#scale.x / this.#baseScale.x,\n      y: this.#scale.y / this.#baseScale.y,\n      z: this.#scale.z / this.#baseScale.z\n    };\n  }\n\n  /**\n   * Get the layer offset.\n   *\n   * @returns {Scalar3D} The offset as {x,y,z}.\n   */\n  getOffset() {\n    return this.#offset;\n  }\n\n  /**\n   * Get the number of layers handled by this class.\n   *\n   * @returns {number} The number of layers.\n   */\n  getNumberOfLayers() {\n    let count = 0;\n    this.#layers.forEach(item => {\n      if (typeof item !== 'undefined') {\n        count++;\n      }\n    });\n    return count;\n  }\n\n  /**\n   * Check if this layerGroup contains a layer with the input id.\n   *\n   * @param {string} id The layer id to look for.\n   * @returns {boolean} True if this group contains\n   *   a layer with the input id.\n   */\n  includes(id) {\n    if (typeof id === 'undefined') {\n      return false;\n    }\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined' &&\n        layer.getId() === id) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Get the view layers that satisfy the input callback function.\n   *\n   * @param {Function} [callbackFn] A function that takes\n   *   a ViewLayer as input and returns a boolean. If undefined,\n   *   returns all view layers.\n   * @returns {ViewLayer[]} The layers that\n   *   satisfy the callbackFn.\n   */\n  getViewLayers(callbackFn) {\n    if (typeof callbackFn === 'undefined') {\n      callbackFn = function () {\n        return true;\n      };\n    }\n    const res = [];\n    for (const layer of this.#layers) {\n      if (layer instanceof ViewLayer &&\n        callbackFn(layer)) {\n        res.push(layer);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Get the view layers that satisfy the input callback function\n   * starting from the active layer.\n   *\n   * @param {Function} [callbackFn] A function that takes\n   *   a ViewLayer as input and returns a boolean. If undefined,\n   *   returns all view layers.\n   * @returns {ViewLayer[]} The layers that\n   *   satisfy the callbackFn.\n   */\n  getViewLayersFromActive(callbackFn) {\n    if (typeof callbackFn === 'undefined') {\n      callbackFn = function () {\n        return true;\n      };\n    }\n\n    let activeIndex = 0;\n    if (typeof this.#activeLayerIndex !== 'undefined') {\n      activeIndex = this.#activeLayerIndex;\n    }\n\n    const indices = [];\n    // from active index to 0\n    for (let i = activeIndex; i >= 0; i--) {\n      indices.push(i);\n    }\n    // from number of layers to active\n    for (let i = this.#layers.length - 1; i > activeIndex; i--) {\n      indices.push(i);\n    }\n\n    const res = [];\n\n    for (const index of indices) {\n      const layer = this.#layers[index];\n      if (layer instanceof ViewLayer && callbackFn(layer)) {\n        res.push(layer);\n      }\n    }\n\n    return res;\n  }\n\n  /**\n   * Test if one of the view layers satisfies an input callbackFn.\n   *\n   * @param {Function} callbackFn A function that takes\n   *   a ViewLayer as input and returns a boolean.\n   * @returns {boolean} True if one of the ViewLayers\n   *   satisfies the callbackFn.\n   */\n  someViewLayer(callbackFn) {\n    let hasOne = false;\n    for (const layer of this.#layers) {\n      if (layer instanceof ViewLayer &&\n        callbackFn(layer)) {\n        hasOne = true;\n        break;\n      }\n    }\n    return hasOne;\n  }\n\n  /**\n   * Get a list of draw layers according to an input callback function.\n   *\n   * @param {Function} [callbackFn] A function that takes\n   *   a DrawLayer as input and returns a boolean. If undefined,\n   *   returns all draw layers.\n   * @returns {DrawLayer[]} The layers that\n   *   satisfy the callbackFn.\n   */\n  getDrawLayers(callbackFn) {\n    if (typeof callbackFn === 'undefined') {\n      callbackFn = function () {\n        return true;\n      };\n    }\n    const res = [];\n    for (const layer of this.#layers) {\n      if (layer instanceof DrawLayer &&\n        callbackFn(layer)) {\n        res.push(layer);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Get the number of view layers handled by this class.\n   *\n   * @returns {number} The number of layers.\n   */\n  getNumberOfViewLayers() {\n    let count = 0;\n    this.#layers.forEach(item => {\n      if (typeof item !== 'undefined' &&\n        item instanceof ViewLayer) {\n        count++;\n      }\n    });\n    return count;\n  }\n\n  /**\n   * Get the active image layer.\n   *\n   * @returns {ViewLayer|DrawLayer|undefined} The layer.\n   */\n  getActiveLayer() {\n    let layer;\n    if (typeof this.#activeLayerIndex !== 'undefined') {\n      layer = this.#layers[this.#activeLayerIndex];\n    }\n    return layer;\n  }\n\n  /**\n   * Get the active image layer.\n   *\n   * @returns {ViewLayer|undefined} The layer.\n   */\n  getActiveViewLayer() {\n    let layer;\n    const activeLayer = this.getActiveLayer();\n    if (typeof activeLayer !== 'undefined' &&\n      activeLayer instanceof ViewLayer) {\n      layer = activeLayer;\n    }\n    return layer;\n  }\n\n  /**\n   * Get the base view layer.\n   *\n   * @returns {ViewLayer|undefined} The layer.\n   */\n  getBaseViewLayer() {\n    // use first layer as base for calculating position and\n    // line sizes\n    let baseLayer;\n    for (const layer of this.#layers) {\n      if (layer instanceof ViewLayer) {\n        baseLayer = layer;\n        break;\n      }\n    }\n    return baseLayer;\n  }\n\n  /**\n   * Get a view layer associated to a data id.\n   *\n   * @param {string} id The layer id.\n   * @returns {ViewLayer|undefined} The layer.\n   */\n  getViewLayerById(id) {\n    const callbackFn = function (layer) {\n      return layer.getId() === id;\n    };\n    const layers = this.getViewLayers(callbackFn);\n    let layer;\n    if (layers.length === 1) {\n      layer = layers[0];\n    }\n    return layer;\n  }\n\n  /**\n   * Get the view layers associated to a data id.\n   *\n   * @param {string} dataId The data id.\n   * @returns {ViewLayer[]} The layers.\n   */\n  getViewLayersByDataId(dataId) {\n    const callbackFn = function (layer) {\n      return layer.getDataId() === dataId;\n    };\n    return this.getViewLayers(callbackFn);\n  }\n\n  /**\n   * Search view layers for equal image meta data.\n   *\n   * @param {object} meta The meta data to find.\n   * @returns {ViewLayer[]} The list of view layers that contain matched data.\n   */\n  searchViewLayers(meta) {\n    const metaClone = structuredClone(meta);\n    // extract sop instance\n    let sopInstanceUid;\n    if (typeof metaClone.SOPInstanceUID !== 'undefined') {\n      sopInstanceUid = metaClone.SOPInstanceUID;\n      delete metaClone.SOPInstanceUID;\n    }\n    const hasSopInstance = typeof sopInstanceUid !== 'undefined';\n    const hasMeta = Object.keys(metaClone).length !== 0;\n\n    const res = [];\n    for (const layer of this.#layers) {\n      if (layer instanceof ViewLayer) {\n        let equalMeta = false;\n        if (hasMeta) {\n          equalMeta = layer.getViewController().equalImageMeta(metaClone);\n        }\n        let includesSopInstance = false;\n        if (hasSopInstance) {\n          includesSopInstance =\n            layer.getViewController().includesImageUid(sopInstanceUid);\n        }\n\n        let check = false;\n        if (hasMeta && hasSopInstance) {\n          check = equalMeta && includesSopInstance;\n        } else if (hasMeta) {\n          check = equalMeta;\n        } else if (hasSopInstance) {\n          check = includesSopInstance;\n        }\n\n        if (check) {\n          res.push(layer);\n        }\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Get the view layers data indices.\n   *\n   * @returns {string[]} The list of indices.\n   */\n  getViewDataIndices() {\n    const res = [];\n    for (const layer of this.#layers) {\n      if (layer instanceof ViewLayer) {\n        res.push(layer.getDataId());\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Get the active draw layer.\n   *\n   * @returns {DrawLayer|undefined} The layer.\n   */\n  getActiveDrawLayer() {\n    let layer;\n    const activeLayer = this.getActiveLayer();\n    if (typeof activeLayer !== 'undefined' &&\n      activeLayer instanceof DrawLayer) {\n      layer = activeLayer;\n    }\n    return layer;\n  }\n\n  /**\n   * Get a draw layer associated to a data id.\n   *\n   * @param {string} id The layer id.\n   * @returns {DrawLayer|undefined} The layer.\n   */\n  getDrawLayerById(id) {\n    const callbackFn = function (layer) {\n      return layer.getId() === id;\n    };\n    const layers = this.getDrawLayers(callbackFn);\n    let layer;\n    if (layers.length === 1) {\n      layer = layers[0];\n    }\n    return layer;\n  }\n\n  /**\n   * Get the draw layers associated to a data id.\n   *\n   * @param {string} dataId The data id.\n   * @returns {DrawLayer[]} The layers.\n   */\n  getDrawLayersByDataId(dataId) {\n    const callbackFn = function (layer) {\n      return layer.getDataId() === dataId;\n    };\n    return this.getDrawLayers(callbackFn);\n  }\n\n  /**\n   * Set the active layer.\n   *\n   * @param {number} index The index of the layer to set as active.\n   */\n  setActiveLayer(index) {\n    this.#activeLayerIndex = index;\n\n    const layer = this.#layers[index];\n    if (typeof this.#infoLayer !== 'undefined') {\n      this.unbindInfoData();\n      const dataId = layer.getDataId();\n      this.bindInfoData(dataId);\n    }\n\n    /**\n     * Active layer change event.\n     *\n     * @event LayerGroup#activelayerchange\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {Array} value The changed value.\n     */\n    this.#fireEvent({\n      type: 'activelayerchange',\n      value: [this.#layers[index]]\n    });\n  }\n\n  /**\n   * Set the active layer with a layer id.\n   *\n   * @param {string} id The layer id.\n   */\n  setActiveLayerById(id) {\n    let index;\n    for (let i = 0; i < this.#layers.length; ++i) {\n      if (typeof this.#layers[i] !== 'undefined' &&\n        this.#layers[i].getId() === id) {\n        // stop at first one\n        index = i;\n        break;\n      }\n    }\n    if (typeof index !== 'undefined') {\n      this.setActiveLayer(index);\n    } else {\n      logger.warn('No layer to set as active with id: ' +\n        id);\n    }\n  }\n\n  /**\n   * Set the active layer with a data id.\n   *\n   * @param {string} dataId The data id.\n   */\n  setActiveLayerByDataId(dataId) {\n    let index;\n    for (let i = 0; i < this.#layers.length; ++i) {\n      if (typeof this.#layers[i] !== 'undefined' &&\n        this.#layers[i].getDataId() === dataId) {\n        // stop at first one\n        index = i;\n        break;\n      }\n    }\n    if (typeof index !== 'undefined') {\n      this.setActiveLayer(index);\n    } else {\n      logger.warn('No layer to set as active with dataId: ' +\n        dataId);\n    }\n  }\n\n  /**\n   * Add a view layer.\n   *\n   * The new layer will be marked as the active view layer.\n   *\n   * @returns {ViewLayer} The created layer.\n   */\n  addViewLayer() {\n    // layer index\n    const viewLayerIndex = this.#layers.length;\n    // create div\n    const div = this.#getNextLayerDiv();\n    // prepend to container\n    this.#containerDiv.append(div);\n    // view layer\n    const layer = new ViewLayer(div);\n    layer.setImageSmoothing(this.#imageSmoothing);\n    // add layer\n    this.#layers.push(layer);\n    // mark it as active\n    this.setActiveLayer(viewLayerIndex);\n    // bind view layer events\n    this.#bindViewLayer(layer);\n\n    // force helper update\n    this.#positionHelper = undefined;\n\n    // return\n    return layer;\n  }\n\n  /**\n   * Add a draw layer.\n   *\n   * The new layer will be marked as the active draw layer.\n   *\n   * @returns {DrawLayer} The created layer.\n   */\n  addDrawLayer() {\n    // store active index\n    this.#activeLayerIndex = this.#layers.length;\n    // create div\n    const div = this.#getNextLayerDiv();\n    // prepend to container\n    this.#containerDiv.append(div);\n    // draw layer\n    const layer = new DrawLayer(div);\n    // add layer\n    this.#layers.push(layer);\n    // bind draw layer events\n    this.#bindDrawLayer(layer);\n    // return\n    return layer;\n  }\n\n  /**\n   * Bind view layer events to this.\n   *\n   * @param {ViewLayer} viewLayer The view layer to bind.\n   */\n  #bindViewLayer(viewLayer) {\n    // listen to position change to update other group layers\n    viewLayer.addEventListener(\n      'positionchange', this.updateLayersToPositionChange);\n    // propagate view viewLayer-layer events\n    for (const eventName of viewEventNames) {\n      viewLayer.addEventListener(eventName, this.#fireEvent);\n    }\n    // propagate viewLayer events\n    viewLayer.addEventListener('renderstart', this.#fireEvent);\n    viewLayer.addEventListener('renderend', this.#fireEvent);\n  }\n\n  /**\n   * Un-bind a view layer events to this.\n   *\n   * @param {ViewLayer} viewLayer The view layer to unbind.\n   */\n  #unbindViewLayer(viewLayer) {\n    // stop listening to position change to update other group layers\n    viewLayer.removeEventListener(\n      'positionchange', this.updateLayersToPositionChange);\n    // stop propagating view viewLayer-layer events\n    for (const eventName of viewEventNames) {\n      viewLayer.removeEventListener(eventName, this.#fireEvent);\n    }\n    // stop propagating viewLayer events\n    viewLayer.removeEventListener('renderstart', this.#fireEvent);\n    viewLayer.removeEventListener('renderend', this.#fireEvent);\n\n    // stop view layer - image binding\n    // (binding is done in layer.setView)\n    viewLayer.unbindImage();\n  }\n\n  /**\n   * Bind draw layer events to this.\n   *\n   * @param {DrawLayer} drawLayer The draw layer to bind.\n   */\n  #bindDrawLayer(drawLayer) {\n    // listen to position change to update other group layers\n    drawLayer.addEventListener(\n      'positionchange', this.updateLayersToPositionChange);\n    drawLayer.addEventListener(\n      'positionchange', this.#fireEvent);\n  }\n\n  /**\n   * Un-bind a draw layer events to this.\n   *\n   * @param {DrawLayer} drawLayer The draw layer to unbind.\n   */\n  #unbindDrawLayer(drawLayer) {\n    // stop listening to position change to update other group layers\n    drawLayer.removeEventListener(\n      'positionchange', this.updateLayersToPositionChange);\n    drawLayer.removeEventListener(\n      'positionchange', this.#fireEvent);\n  }\n\n  /**\n   * Add info data.\n   *\n   * @param {InfoData} data The data to add.\n   * @param {string} dataId The associated data ID.\n   */\n  addInfoData(data, dataId) {\n    this.#infoDatas[dataId] = data;\n  }\n\n  /**\n   * Bind info data.\n   *\n   * @param {string} dataId The associated data ID.\n   */\n  bindInfoData(dataId) {\n    // just bind one data id\n    if (typeof this.#infoDataId !== 'undefined') {\n      return;\n    }\n    const infoData = this.#infoDatas[dataId];\n    if (typeof infoData !== 'undefined') {\n      infoData.addEventListener('valuechange',\n        this.#infoLayer.onDataChange);\n    }\n    this.#infoDataId = dataId;\n  }\n\n  /**\n   * Unbind info data.\n   */\n  unbindInfoData() {\n    const infoData = this.#infoDatas[this.#infoDataId];\n    if (typeof infoData !== 'undefined') {\n      infoData.removeEventListener('valuechange',\n        this.#infoLayer.onDataChange);\n    }\n    this.#infoDataId = undefined;\n  }\n\n  /**\n   * Get the next layer DOM div.\n   *\n   * @returns {HTMLDivElement} A DOM div.\n   */\n  #getNextLayerDiv() {\n    const div = document.createElement('div');\n    div.id = getLayerDivId(this.getDivId(), this.#layers.length);\n    div.className = 'layer';\n    div.style.pointerEvents = 'none';\n    return div;\n  }\n\n  /**\n   * Empty the layer list.\n   */\n  empty() {\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined') {\n        this.removeLayer(layer);\n      }\n    }\n    this.#layers = [];\n    // remove possible crosshair\n    this.#removeCrosshairDiv();\n  }\n\n  /**\n   * Remove all layers for a specific data.\n   *\n   * @param {string} dataId The data to remove its layers.\n   */\n  removeLayersByDataId(dataId) {\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined' &&\n        layer.getDataId() === dataId) {\n        this.removeLayer(layer);\n      }\n    }\n  }\n\n  /**\n   * Remove a layer from this layer group.\n   * Warning: if current active layer, the index will\n   *   be set to `undefined`. Call one of the setActive\n   *   methods to define the active index.\n   *\n   * @param {ViewLayer | DrawLayer} layer The layer to remove.\n   * @fires LayerGroup#removelayer\n   */\n  removeLayer(layer) {\n    // find layer\n    const index = this.#layers.findIndex((item) => item === layer);\n    if (index === -1) {\n      throw new Error('Cannot find layer to remove');\n    }\n    // update active index\n    if (this.#activeLayerIndex === index) {\n      this.#activeLayerIndex = undefined;\n    }\n    // unbind and update active index\n    if (layer instanceof ViewLayer) {\n      this.#unbindViewLayer(layer);\n    } else {\n      this.#unbindDrawLayer(layer);\n    }\n    // reset in storage\n    this.#layers[index] = undefined;\n    // force helper update\n    this.#positionHelper = undefined;\n    // update html\n    layer.removeFromDOM();\n\n    /**\n     * Remove layer event.\n     *\n     * @event LayerGroup#removelayer\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {string} layerid The layer id.\n     * @property {string} layergroupid The layer group id.\n     */\n    this.#fireEvent({\n      type: 'layerremove',\n      layerid: layer.getId(),\n      layergroupid: this.getDivId()\n    });\n  }\n\n  /**\n   * Show a crosshair at the current position.\n   */\n  #showCrosshairDiv() {\n    // remove previous\n    this.#removeCrosshairDiv();\n\n    // use first layer as base for calculating position and\n    // line sizes\n    let baseLayer;\n    for (const layer of this.#layers) {\n      if (layer instanceof ViewLayer) {\n        baseLayer = layer;\n        break;\n      }\n    }\n    if (typeof baseLayer === 'undefined') {\n      logger.warn('No layer to show crosshair');\n      return;\n    }\n\n    // no crosshair for secondary capture\n    if (this.#isViewLayerSecondaryCapture(baseLayer)) {\n      logger.warn('Not enabling crosshair for secondary capture');\n      return;\n    }\n\n    const vc = baseLayer.getViewController();\n    const position = vc.getCurrentPosition();\n    const planePos = vc.getPlanePositionFromPosition(position);\n    const displayPos = baseLayer.planePosToDisplay(planePos);\n\n    // horizontal line\n    if (typeof displayPos.getY() !== 'undefined') {\n      const lineH = document.createElement('hr');\n      lineH.id = this.getDivId() + '-scroll-crosshair-horizontal';\n      lineH.className = 'horizontal';\n      lineH.style.width = this.#containerDiv.offsetWidth + 'px';\n      lineH.style.left = '0px';\n      lineH.style.top = displayPos.getY() + 'px';\n      // add to local array\n      this.#crosshairHtmlElements.push(lineH);\n      // add to html\n      this.#containerDiv.appendChild(lineH);\n    }\n\n    // vertical line\n    if (typeof displayPos.getX() !== 'undefined') {\n      const lineV = document.createElement('hr');\n      lineV.id = this.getDivId() + '-scroll-crosshair-vertical';\n      lineV.className = 'vertical';\n      lineV.style.width = this.#containerDiv.offsetHeight + 'px';\n      lineV.style.left = (displayPos.getX()) + 'px';\n      lineV.style.top = '0px';\n      // add to local array\n      this.#crosshairHtmlElements.push(lineV);\n      // add to html\n      this.#containerDiv.appendChild(lineV);\n    }\n  }\n\n  /**\n   * Remove crosshair divs.\n   */\n  #removeCrosshairDiv() {\n    for (const element of this.#crosshairHtmlElements) {\n      element.remove();\n    }\n    this.#crosshairHtmlElements = [];\n  }\n\n  /**\n   * Displays a tooltip in a temporary `span`.\n   * Works with css to hide/show the span only on mouse hover.\n   *\n   * @param {Point2D} point The update point.\n   */\n  showTooltip(point) {\n    // remove previous div\n    this.removeTooltipDiv();\n\n    const viewLayer = this.getBaseViewLayer();\n    const viewController = viewLayer.getViewController();\n    const planePos = viewLayer.displayToPlanePos(point);\n    const position = viewController.getPositionFromPlanePoint(planePos);\n    const value = viewController.getRescaledImageValue(position);\n\n    // create\n    if (typeof value !== 'undefined') {\n      const span = document.createElement('span');\n      span.id = 'scroll-tooltip';\n      // tooltip position\n      span.style.left = (point.getX() + 10) + 'px';\n      span.style.top = (point.getY() + 10) + 'px';\n      let text = precisionRound(value, 3).toString();\n      if (typeof viewController.getPixelUnit() !== 'undefined') {\n        text += ' ' + viewController.getPixelUnit();\n      }\n      span.appendChild(document.createTextNode(text));\n      // add to local var\n      this.#tooltipHtmlElement = span;\n      // add to html\n      this.#containerDiv.appendChild(span);\n    }\n  }\n\n  /**\n   * Remove the tooltip html div.\n   */\n  removeTooltipDiv() {\n    if (typeof this.#tooltipHtmlElement !== 'undefined') {\n      this.#tooltipHtmlElement.remove();\n      this.#tooltipHtmlElement = undefined;\n    }\n  }\n\n  /**\n   * Can the input position be set on one of the view layers.\n   *\n   * @param {Point} position The input position.\n   * @returns {boolean} True if one view layer accepts the input position.\n   */\n  isPositionInBounds(position) {\n    return this.someViewLayer(function (layer) {\n      return layer.getViewController().isPositionInBounds(position);\n    });\n  }\n\n  /**\n   * Can one of the view layers be scrolled.\n   *\n   * @returns {boolean} True if one view layer can be scrolled.\n   */\n  canScroll() {\n    return this.someViewLayer(function (layer) {\n      return layer.getViewController().canScroll();\n    });\n  }\n\n  /**\n   * Check if the SOP class UID of the data of a view layer is\n   * secondary capture.\n   *\n   * @param {ViewLayer} layer The layer to check.\n   * @returns {boolean} True if secondary capture.\n   */\n  #isViewLayerSecondaryCapture(layer) {\n    let res = false;\n    const sopClassUID = layer.getViewController().getSopClassUid();\n    if (typeof sopClassUID !== 'undefined') {\n      res = sopClassUID.startsWith(SOPClassUIDs.SecondaryCapture);\n    }\n    return res;\n  }\n\n  /**\n   * Returns whether or not a layer group should have its zoom/pan/etc\n   * synced to other views. Used for things like Secondary Capture where\n   * there is no meaningful real-world scale.\n   *\n   * @returns {boolean} Whether to sync the zoom/pan.\n   */\n  shouldBind() {\n    const baseLayer = this.getBaseViewLayer();\n    if (typeof baseLayer === 'undefined') {\n      return false;\n    }\n    const isSC = this.#isViewLayerSecondaryCapture(baseLayer);\n    return !isSC;\n  }\n\n  /**\n   * Does one of the view layer have more than one slice in the\n   *   given dimension.\n   *\n   * @param {number} dim The input dimension.\n   * @returns {boolean} True if one view layer has more than one slice.\n   */\n  moreThanOne(dim) {\n    return this.someViewLayer(function (layer) {\n      return layer.getViewController().moreThanOne(dim);\n    });\n  }\n\n  /**\n   * Check if any layer has a valid position.\n   *\n   * @returns {boolean} True if any layer has a valid position.\n   */\n  hasAnyLayerWithValidPosition() {\n    return this.someViewLayer(function (layer) {\n      return layer.isValidPosition();\n    });\n  }\n\n  /**\n   * Update info data on position change.\n   *\n   * @param {object} event The position change event.\n   */\n  #updateInfoData = (event) => {\n    const infoData = this.#infoDatas[event.dataid];\n    if (typeof infoData !== 'undefined') {\n      infoData.onSliceChange(event);\n    }\n  };\n\n  /**\n   * Update layers (but not the event source layer) to a position change.\n   *\n   * @param {object} event The position change event.\n   * @function\n   */\n  updateLayersToPositionChange = (event) => {\n    // pause positionchange listeners\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined') {\n        layer.removeEventListener(\n          'positionchange', this.updateLayersToPositionChange);\n        layer.removeEventListener('positionchange', this.#fireEvent);\n\n        layer.addEventListener('positionchange', this.#updateInfoData);\n      }\n    }\n\n    const index = new Index(event.value[0]);\n    const position = new Point(event.value[1]);\n\n    // origin of the first view layer\n    const viewLayerOffsets = {};\n    let baseViewLayerOrigin0;\n    let baseViewLayerOrigin;\n    // update position for all layers except the source one\n    for (const layer of this.#layers) {\n      if (typeof layer === 'undefined') {\n        continue;\n      }\n      let hasSetOffset = false;\n\n      // view layer case: define and set offsets\n      if (layer instanceof ViewLayer) {\n        const vc = layer.getViewController();\n        // origin0 should always be there\n        const origin0 = vc.getOrigin();\n        // depending on position, origin could be undefined\n        const origin = vc.getOrigin(position);\n\n        let scrollOffset;\n        let planeOffset;\n\n        if (typeof baseViewLayerOrigin === 'undefined') {\n          // first view layer, store origins\n          baseViewLayerOrigin0 = origin0;\n          baseViewLayerOrigin = origin;\n          // no offset\n          scrollOffset = new Vector3D(0, 0, 0);\n          planeOffset = new Vector3D(0, 0, 0);\n        } else {\n          if (vc.isPositionInBounds(position) &&\n            typeof origin !== 'undefined') {\n            // TODO: compensate for possible different orientation between views\n            const scrollDiff = baseViewLayerOrigin0.minus(origin0);\n            scrollOffset = new Vector3D(\n              scrollDiff.getX(), scrollDiff.getY(), scrollDiff.getZ());\n            const planeDiff = baseViewLayerOrigin.minus(origin);\n            planeOffset = new Vector3D(\n              planeDiff.getX(), planeDiff.getY(), planeDiff.getZ());\n          }\n        }\n\n        // set and store offsets\n        if (typeof scrollOffset !== 'undefined' &&\n          typeof planeOffset !== 'undefined') {\n          hasSetOffset =\n            layer.setBaseOffset(\n              scrollOffset, planeOffset,\n              baseViewLayerOrigin, baseViewLayerOrigin0\n            );\n          // store\n          viewLayerOffsets[layer.getId()] = {\n            scroll: scrollOffset,\n            plane: planeOffset\n          };\n        }\n      }\n\n      // draw layer case: use associated view layer offsets\n      if (layer instanceof DrawLayer) {\n        const refOffsets = viewLayerOffsets[layer.getReferenceLayerId()];\n        if (typeof refOffsets !== 'undefined') {\n          hasSetOffset =\n            layer.setBaseOffset(refOffsets.scroll, refOffsets.plane);\n        }\n      }\n\n      // update position (triggers redraw)\n      let hasSetPos = false;\n      if (layer.getId() !== event.srclayerid) {\n        hasSetPos = layer.setCurrentPosition(position, index);\n      }\n\n      // force redraw if needed\n      if (!hasSetPos && hasSetOffset) {\n        layer.draw();\n      }\n    }\n\n    const hasValidPosition = this.hasAnyLayerWithValidPosition();\n    this.#fireEvent({\n      type: 'outofrange',\n      layergroupid: this.getDivId(),\n      value: [!hasValidPosition]\n    });\n\n    // show crosshair after position update\n    if (this.#showCrosshair) {\n      this.#showCrosshairDiv();\n    }\n\n    // re-start positionchange listeners\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined') {\n        layer.addEventListener(\n          'positionchange', this.updateLayersToPositionChange);\n        layer.addEventListener('positionchange', this.#fireEvent);\n\n        layer.removeEventListener('positionchange', this.#updateInfoData);\n      }\n    }\n  };\n\n  /**\n   * Calculate the div to world size ratio needed to fit\n   *   the largest data.\n   *\n   * @returns {number|undefined} The ratio.\n   */\n  getDivToWorldSizeRatio() {\n    // check container\n    if (this.#containerDiv.offsetWidth === 0 &&\n      this.#containerDiv.offsetHeight === 0) {\n      throw new Error('Cannot fit to zero sized container with id \\'' +\n        this.#containerDiv.id + '\\'.'\n      );\n    }\n    // get max world size\n    const maxWorldSize = this.getMaxWorldSize();\n    if (typeof maxWorldSize === 'undefined') {\n      return undefined;\n    }\n    // if the container has a width but no height,\n    // resize it to follow the same ratio to completely\n    // fill the div with the image\n    if (this.#containerDiv.offsetHeight === 0) {\n      const ratioX = this.#containerDiv.offsetWidth / maxWorldSize.x;\n      const height = maxWorldSize.y * ratioX;\n      this.#containerDiv.style.height = height + 'px';\n    }\n    // return best fit\n    return Math.min(\n      this.#containerDiv.offsetWidth / maxWorldSize.x,\n      this.#containerDiv.offsetHeight / maxWorldSize.y\n    );\n  }\n\n  /**\n   * Fit to container: set the layers div to world size ratio.\n   *\n   * @param {number} divToWorldSizeRatio The ratio.\n   */\n  fitToContainer(divToWorldSizeRatio) {\n    // get maximum world size\n    const maxWorldSize = this.getMaxWorldSize();\n    // exit if none\n    if (typeof maxWorldSize === 'undefined') {\n      return;\n    }\n\n    const containerSize = {\n      x: this.#containerDiv.offsetWidth,\n      y: this.#containerDiv.offsetHeight\n    };\n    // offset to keep data centered\n    const fitOffset = {\n      x: -0.5 *\n        (containerSize.x - Math.floor(maxWorldSize.x * divToWorldSizeRatio)),\n      y: -0.5 *\n        (containerSize.y - Math.floor(maxWorldSize.y * divToWorldSizeRatio))\n    };\n\n    // apply to layers\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined') {\n        layer.fitToContainer(containerSize, divToWorldSizeRatio, fitOffset);\n      }\n    }\n\n    // update crosshair\n    if (this.#showCrosshair) {\n      this.#showCrosshairDiv();\n    }\n  }\n\n  /**\n   * Get the largest data world (mm) size.\n   *\n   * @returns {Scalar2D|undefined} The largest size as {x,y}.\n   */\n  getMaxWorldSize() {\n    let maxSize = {x: 0, y: 0};\n    for (const layer of this.#layers) {\n      if (layer instanceof ViewLayer) {\n        const size = layer.getImageWorldSize();\n        if (size.x > maxSize.x) {\n          maxSize.x = size.x;\n        }\n        if (size.y > maxSize.y) {\n          maxSize.y = size.y;\n        }\n      }\n    }\n    if (maxSize.x === 0 && maxSize.y === 0) {\n      maxSize = undefined;\n    }\n    return maxSize;\n  }\n\n  /**\n   * Flip all layers along the Z axis without offset compensation.\n   */\n  flipScaleZ() {\n    this.#baseScale.z *= -1;\n    this.setScale(this.#baseScale);\n  }\n\n  /**\n   * Add scale to the layers. Scale cannot go lower than 0.1.\n   *\n   * @param {number} scaleStep The scale to add.\n   * @param {Point3D} center The scale center Point3D.\n   */\n  addScale(scaleStep, center) {\n    const newScale = {\n      x: this.#scale.x * (1 + scaleStep),\n      y: this.#scale.y * (1 + scaleStep),\n      z: this.#scale.z * (1 + scaleStep)\n    };\n    this.setScale(newScale, center);\n  }\n\n  /**\n   * Set the layers' scale.\n   *\n   * @param {Scalar3D} newScale The scale to apply as {x,y,z}.\n   * @param {Point3D} [center] The scale center Point3D.\n   * @fires LayerGroup#zoomchange\n   */\n  setScale(newScale, center) {\n    this.#scale = newScale;\n    // apply to layers\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined') {\n        layer.setScale(this.#scale, center);\n      }\n    }\n\n    // event value\n    const value = [\n      newScale.x,\n      newScale.y,\n      newScale.z\n    ];\n    if (typeof center !== 'undefined') {\n      value.push(center.getX());\n      value.push(center.getY());\n      value.push(center.getZ());\n    }\n\n    /**\n     * Zoom change event.\n     *\n     * @event LayerGroup#zoomchange\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {Array} value The changed value.\n     */\n    this.#fireEvent({\n      type: 'zoomchange',\n      value: value\n    });\n  }\n\n  /**\n   * Add translation to the layers.\n   *\n   * @param {Scalar3D} translation The translation as {x,y,z}.\n   */\n  addTranslation(translation) {\n    this.setOffset({\n      x: this.#offset.x - translation.x,\n      y: this.#offset.y - translation.y,\n      z: this.#offset.z - translation.z\n    });\n  }\n\n  /**\n   * Set the layers' offset.\n   *\n   * @param {Scalar3D} newOffset The offset as {x,y,z}.\n   * @fires LayerGroup#offsetchange\n   */\n  setOffset(newOffset) {\n    // store\n    this.#offset = newOffset;\n    // apply to layers\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined') {\n        layer.setOffset(this.#offset);\n      }\n    }\n\n    /**\n     * Offset change event.\n     *\n     * @event LayerGroup#offsetchange\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {Array} value The changed value.\n     */\n    this.#fireEvent({\n      type: 'offsetchange',\n      value: [\n        this.#offset.x,\n        this.#offset.y,\n        this.#offset.z\n      ]\n    });\n  }\n\n  /**\n   * Reset the stage to its initial scale and no offset.\n   *\n   * @deprecated Since v0.35, prefer resetZoomPan.\n   */\n  reset() {\n    this.setScale(this.#baseScale);\n    this.setOffset({x: 0, y: 0, z: 0});\n  }\n\n  /**\n   * Reset the zoom and pan of all layers.\n   */\n  resetZoomPan() {\n    this.setScale(this.#baseScale);\n    this.setOffset({x: 0, y: 0, z: 0});\n  }\n\n  /**\n   * Reset the position and window level of all view layers.\n   */\n  resetViews() {\n    let isFirstViewLayer = true;\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined' &&\n        layer instanceof ViewLayer\n      ) {\n        const vc = layer.getViewController();\n        if (isFirstViewLayer) {\n          // will be propagated to all layers\n          vc.resetPosition();\n          isFirstViewLayer = false;\n        }\n        vc.resetWindowLevel();\n      }\n    }\n  }\n\n  /**\n   * Draw the layer.\n   */\n  draw() {\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined') {\n        layer.draw();\n      }\n    }\n  }\n\n  /**\n   * Display the layer.\n   *\n   * @param {boolean} flag Whether to display the layer or not.\n   */\n  display(flag) {\n    for (const layer of this.#layers) {\n      if (typeof layer !== 'undefined') {\n        layer.display(flag);\n      }\n    }\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    this.#listenerHandler.fireEvent(event);\n  };\n\n} // LayerGroup class\n","import {getLayerDetailsFromEvent} from '../gui/layerGroup.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Get a normalised spin speed in the Y direction to try to support\n * trackpads (small and large deltaY) and mouse wheel (large deltaY).\n * Should return 1 or -1 for a single mouse wheel tick.\n *\n * @param {object} event The wheel event.\n * @returns {number} The normalised spin Y.\n */\nfunction getSpinY(event) {\n  // (notes of 03/2024)\n\n  // firefox seems to change the value of deltaY\n  // if you ask for deltaMode before (?????)\n\n  // deltaY (for a single mouse wheel tick):\n  // - chrome: [linux] 120, [mac]: 4\n  // - firefox: [linux] 132, [mac]: 16\n\n  // wheelDelta (for a single mouse wheel tick):\n  // - chrome: [linux] 120, [mac]: 240\n  // - firefox: [linux] 120, [mac]: 48\n\n  // -> using wheelDelta for mouse wheel detection as\n  //    it is consistently larger than trackpad scroll\n\n  // wheelDeltaY and deltaY do not go in the same direction,\n  // using -deltaY so that they do...\n\n  if (typeof event.wheelDeltaY === 'undefined') {\n    //logger.warn('No wheel delta, scroll could be tricky...);\n    return -event.deltaY;\n  } else {\n    const threshold = 45;\n    if (event.wheelDeltaY > threshold) {\n      return 1;\n    } else if (event.wheelDeltaY < -threshold) {\n      return -1;\n    } else {\n      return -event.deltaY / 60;\n    }\n  }\n}\n\n/**\n * Class to sum wheel events and know if that sum\n * corresponds to a 'tick'.\n */\nclass ScrollSum {\n  /**\n   * The scroll sum.\n   *\n   * @type {number}\n   */\n  #sum = 0;\n\n  /**\n   * Get the scroll sum.\n   *\n   * @returns {number} The scroll sum.\n   */\n  getSum() {\n    return this.#sum;\n  }\n\n  /**\n   * Add scroll.\n   *\n   * @param {object} event The wheel event.\n   */\n  add(event) {\n    this.#sum += getSpinY(event);\n  }\n\n  /**\n   * Clear the scroll sum.\n   */\n  clear() {\n    this.#sum = 0;\n  }\n\n  /**\n   * Does the accumulated scroll correspond to a 'tick'.\n   *\n   * @returns {boolean} True if the sum corresponds to a 'tick'.\n   */\n  isTick() {\n    return Math.abs(this.#sum) >= 1;\n  }\n}\n\n/**\n * Scroll wheel class: provides a wheel event handler\n *   that scroll the corresponding data.\n */\nexport class ScrollWheel {\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * Accumulated scroll.\n   *\n   * @type {ScrollSum}\n   */\n  #scrollSum = new ScrollSum();\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n  }\n\n  /**\n   * Handle mouse wheel event.\n   *\n   * @param {WheelEvent} event The mouse wheel event.\n   */\n  wheel(event) {\n    this.#scrollSum.add(event);\n    const up = this.#scrollSum.getSum() >= 0;\n\n    // exit if no tick\n    if (!this.#scrollSum.isTick()) {\n      return;\n    } else {\n      this.#scrollSum.clear();\n    }\n\n    // prevent default page scroll\n    event.preventDefault();\n\n    const layerDetails = getLayerDetailsFromEvent(event);\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\n    const positionHelper = layerGroup.getPositionHelper();\n\n    if (layerGroup.canScroll()) {\n      if (up) {\n        positionHelper.incrementPositionAlongScroll();\n      } else {\n        positionHelper.decrementPositionAlongScroll();\n      }\n    } else if (layerGroup.moreThanOne(3)) {\n      if (up) {\n        positionHelper.incrementPosition(3);\n      } else {\n        positionHelper.decrementPosition(3);\n      }\n    }\n  }\n\n} // ScrollWheel class\n","import {logger} from '../utils/logger.js';\nimport {UpdateAnnotationCommand} from './drawCommands.js';\nimport {validateAnchorPosition} from './drawBounds.js';\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\nimport {DrawLayer} from '../gui/drawLayer.js';\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Draw shape editor.\n */\nexport class DrawShapeEditor {\n\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * Event callback.\n   *\n   * @type {Function}\n   */\n  #eventCallback;\n\n  /**\n   * @param {App} app The associated application.\n   * @param {Function} eventCallback Event callback.\n   */\n  constructor(app, eventCallback) {\n    this.#app = app;\n    this.#eventCallback = eventCallback;\n  }\n\n  /**\n   * Current shape factory.\n   *\n   * @type {object}\n   */\n  #currentFactory = null;\n\n  /**\n   * Edited shape.\n   *\n   * @type {Konva.Shape}\n   */\n  #shape = null;\n\n  /**\n   * Associated draw layer. Used to bound anchor move.\n   *\n   * @type {DrawLayer}\n   */\n  #drawLayer;\n\n  /**\n   * The associated annotation.\n   *\n   * @type {Annotation}\n   */\n  #annotation;\n\n  /**\n   * Active flag.\n   *\n   * @type {boolean}\n   */\n  #isActive = false;\n\n  /**\n   * @callback eventFn\n   * @param {object} event The event.\n   */\n\n  /**\n   * Set the shape to edit.\n   *\n   * @param {Konva.Shape} inshape The shape to edit.\n   * @param {DrawLayer} drawLayer The associated draw layer.\n   * @param {Annotation} annotation The associated annotation.\n   */\n  setShape(inshape, drawLayer, annotation) {\n    this.#shape = inshape;\n    this.#drawLayer = drawLayer;\n    this.#annotation = annotation;\n\n    if (this.#shape) {\n      // remove old anchors\n      this.#removeAnchors();\n\n      this.#currentFactory = annotation.getFactory();\n      if (typeof this.#currentFactory === 'undefined') {\n        throw new Error('Could not find a factory to update shape.');\n      }\n\n      // add new anchors\n      this.#addAnchors();\n    }\n  }\n\n  /**\n   * Get the edited shape.\n   *\n   * @returns {Konva.Shape} The edited shape.\n   */\n  getShape() {\n    return this.#shape;\n  }\n\n  /**\n   * Get the edited annotation.\n   *\n   * @returns {Annotation} The annotation.\n   */\n  getAnnotation() {\n    return this.#annotation;\n  }\n\n  /**\n   * Get the active flag.\n   *\n   * @returns {boolean} The active flag.\n   */\n  isActive() {\n    return this.#isActive;\n  }\n\n  /**\n   * Enable the editor. Redraws the layer.\n   */\n  enable() {\n    this.#isActive = true;\n    if (this.#shape) {\n      this.#setAnchorsVisible(true);\n      if (this.#shape.getLayer()) {\n        this.#shape.getLayer().draw();\n      }\n    }\n  }\n\n  /**\n   * Disable the editor. Redraws the layer.\n   */\n  disable() {\n    this.#isActive = false;\n    if (this.#shape) {\n      this.#setAnchorsVisible(false);\n      if (this.#shape.getLayer()) {\n        this.#shape.getLayer().draw();\n      }\n    }\n  }\n\n  /**\n   * Reset the editor.\n   */\n  reset() {\n    this.#shape = undefined;\n    this.#drawLayer = undefined;\n    this.#annotation = undefined;\n  }\n\n  /**\n   * Reset the anchors.\n   */\n  resetAnchors() {\n    // remove previous controls\n    this.#removeAnchors();\n    // add anchors\n    this.#addAnchors();\n    // set them visible\n    this.#setAnchorsVisible(true);\n  }\n\n  /**\n   * Apply a function on all anchors.\n   *\n   * @param {object} func A f(shape) function.\n   */\n  #applyFuncToAnchors(func) {\n    if (this.#shape && this.#shape.getParent()) {\n      const anchors = this.#shape.getParent().find('.anchor');\n      anchors.forEach(func);\n    }\n  }\n\n  /**\n   * Set anchors visibility.\n   *\n   * @param {boolean} flag The visible flag.\n   */\n  #setAnchorsVisible(flag) {\n    this.#applyFuncToAnchors(function (anchor) {\n      anchor.visible(flag);\n    });\n  }\n\n  /**\n   * Set anchors active.\n   *\n   * @param {boolean} flag The active (on/off) flag.\n   */\n  setAnchorsActive(flag) {\n    let func = null;\n    if (flag) {\n      func = (anchor) => {\n        this.#setAnchorOn(anchor);\n      };\n    } else {\n      func = (anchor) => {\n        this.#setAnchorOff(anchor);\n      };\n    }\n    this.#applyFuncToAnchors(func);\n  }\n\n  /**\n   * Remove anchors.\n   */\n  #removeAnchors() {\n    this.#applyFuncToAnchors(function (anchor) {\n      anchor.remove();\n    });\n  }\n\n  /**\n   * Add the shape anchors.\n   */\n  #addAnchors() {\n    // exit if no shape or no layer\n    if (!this.#shape || !this.#shape.getLayer()) {\n      return;\n    }\n    // get shape group\n    const group = this.#shape.getParent();\n\n    // activate and add anchors to group\n    const anchors =\n      this.#currentFactory.getAnchors(this.#shape, this.#app.getStyle());\n    for (let i = 0; i < anchors.length; ++i) {\n      // set anchor on\n      this.#setAnchorOn(anchors[i]);\n      // add the anchor to the group\n      group.add(anchors[i]);\n    }\n  }\n\n  /**\n   * Set the anchor on listeners.\n   *\n   * @param {Konva.Ellipse} anchor The anchor to set on.\n   */\n  #setAnchorOn(anchor) {\n    let originalProps;\n\n    // drag start listener\n    anchor.on('dragstart.edit', (event) => {\n      // prevent bubbling upwards\n      event.cancelBubble = true;\n      // store original properties\n      originalProps = {\n        mathShape: this.#annotation.mathShape,\n        referencePoints: this.#annotation.referencePoints\n      };\n    });\n    // drag move listener\n    anchor.on('dragmove.edit', (event) => {\n      const anchor = event.target;\n      if (!(anchor instanceof Konva.Shape)) {\n        return;\n      }\n      // validate the anchor position\n      validateAnchorPosition(this.#drawLayer.getBaseSize(), anchor);\n      if (typeof this.#currentFactory.constrainAnchorMove !== 'undefined') {\n        this.#currentFactory.constrainAnchorMove(anchor);\n      }\n\n      // udpate annotation\n      this.#currentFactory.updateAnnotationOnAnchorMove(\n        this.#annotation, anchor);\n      // udpate shape\n      this.#currentFactory.updateShapeGroupOnAnchorMove(\n        this.#annotation, anchor, this.#app.getStyle());\n\n      // redraw\n      if (anchor.getLayer()) {\n        anchor.getLayer().draw();\n      } else {\n        logger.warn('No layer to draw the anchor!');\n      }\n      // prevent bubbling upwards\n      event.cancelBubble = true;\n    });\n    // drag end listener\n    anchor.on('dragend.edit', (event) => {\n      // update annotation command\n      const newProps = {\n        mathShape: this.#annotation.mathShape,\n        referencePoints: this.#annotation.referencePoints\n      };\n      const command = new UpdateAnnotationCommand(\n        this.#annotation,\n        originalProps,\n        newProps,\n        this.#drawLayer.getDrawController()\n      );\n      // add command to undo stack\n      this.#app.addToUndoStack(command);\n      // fire event manually since command is not executed\n      this.#eventCallback({\n        type: 'annotationupdate',\n        data: this.#annotation,\n        dataid: this.#drawLayer.getDataId(),\n        keys: Object.keys(newProps)\n      });\n      // update original properties\n      originalProps = {\n        mathShape: newProps.mathShape,\n        referencePoints: newProps.referencePoints\n      };\n\n      // prevent bubbling upwards\n      event.cancelBubble = true;\n    });\n    // mouse down listener\n    anchor.on('mousedown touchstart', (event) => {\n      const anchor = event.target;\n      anchor.moveToTop();\n    });\n    // mouse over styling\n    anchor.on('mouseover.edit', (event) => {\n      const anchor = event.target;\n      if (!(anchor instanceof Konva.Shape)) {\n        return;\n      }\n      // style is handled by the group\n      anchor.stroke('#ddd');\n      if (anchor.getLayer()) {\n        anchor.getLayer().draw();\n      } else {\n        logger.warn('No layer to draw the anchor!');\n      }\n    });\n    // mouse out styling\n    anchor.on('mouseout.edit', (event) => {\n      const anchor = event.target;\n      if (!(anchor instanceof Konva.Shape)) {\n        return;\n      }\n      // style is handled by the group\n      anchor.stroke('#999');\n      if (anchor.getLayer()) {\n        anchor.getLayer().draw();\n      } else {\n        logger.warn('No layer to draw the anchor!');\n      }\n    });\n  }\n\n  /**\n   * Set the anchor off listeners.\n   *\n   * @param {Konva.Ellipse} anchor The anchor to set off.\n   */\n  #setAnchorOff(anchor) {\n    anchor.off('dragstart.edit');\n    anchor.off('dragmove.edit');\n    anchor.off('dragend.edit');\n    anchor.off('mousedown touchstart');\n    anchor.off('mouseover.edit');\n    anchor.off('mouseout.edit');\n  }\n\n} // class Editor\n","import Konva from 'konva';\n\n/* eslint-disable no-unused-vars */\nimport {Scalar2D} from '../math/scalar.js';\nimport {DrawLayer} from '../gui/drawLayer.js';\n/* eslint-enable no-unused-vars */\n\nexport class DrawTrash {\n  /**\n   * Trash draw: a cross.\n   *\n   * @type {Konva.Group}\n   */\n  #trash;\n\n  constructor() {\n    this.createTrashIcon();\n\n  }\n\n  /**\n   * Creates the trash icon o positionates it.\n   */\n  createTrashIcon() {\n    this.#trash = new Konva.Group();\n    // first line of the cross\n    const trashLine1 = new Konva.Line({\n      points: [-10, -10, 10, 10],\n      stroke: 'red'\n    });\n    // second line of the cross\n    const trashLine2 = new Konva.Line({\n      points: [10, -10, -10, 10],\n      stroke: 'red'\n    });\n    this.#trash.width(20);\n    this.#trash.height(20);\n    this.#trash.add(trashLine1);\n    this.#trash.add(trashLine2);\n  }\n\n  /**\n   *\n   * Activates the trash, by showing the icon into the layer draw layer.\n   *\n   * @param {DrawLayer} drawLayer The draw layer where to draw.\n   */\n  activate(drawLayer) {\n    const stage = drawLayer.getKonvaStage();\n    const scale = stage.scale();\n    const konvaLayer = drawLayer.getKonvaLayer();\n    const invscale = {x: 1 / scale.x, y: 1 / scale.y};\n    this.#trash.x(stage.offset().x + (stage.width() / (2 * scale.x)));\n    this.#trash.y(stage.offset().y + (stage.height() / (15 * scale.y)));\n    this.#trash.scale(invscale);\n    konvaLayer.add(this.#trash);\n    // draw\n    konvaLayer.draw();\n  }\n\n  /**\n   *\n   * Change colour on trash over.\n   *\n   * @param {Scalar2D} eventPosition The event drag move position.\n   * @param {Konva.Group} shapeGroup The shape group whose colour\n   *   must be change.\n   * @param {string} originalShapeColour The original shape colour.\n   */\n  changeChildrenColourOnTrashHover(eventPosition,\n    shapeGroup, originalShapeColour) {\n    if (this.isOverTrash(eventPosition)) {\n      this.changeGroupChildrenColour(this.#trash, 'orange');\n      this.changeGroupChildrenColour(shapeGroup, 'red');\n      return;\n\n    }\n    this.changeGroupChildrenColour(this.#trash, 'red');\n    this.changeGroupChildrenColour(shapeGroup, originalShapeColour);\n  }\n\n  /**\n   * Change colour on trash out.\n   *\n   * @param {Konva.Group} group The group whose colour must be change.\n   * @param {string} colour The new colour to be set.\n   */\n  changeGroupChildrenColour(group, colour) {\n    group.getChildren().forEach(function (tshape) {\n      if (tshape instanceof Konva.Shape &&\n        typeof tshape.stroke !== 'undefined') {\n        tshape.stroke(colour);\n      }\n    });\n  }\n\n  /**\n   * Removes the trash from the draw layer.\n   */\n  remove() {\n    this.#trash.remove();\n  }\n\n  /**\n   * Determines if the event is over trash.\n   *\n   * @param {Scalar2D} eventPosition The event position.\n   * @returns {boolean} True if the event is over trash.\n   */\n  isOverTrash(eventPosition) {\n    const trashHalfWidth =\n      this.#trash.width() * Math.abs(this.#trash.scaleX()) / 2;\n    const trashHalfHeight =\n      this.#trash.height() * Math.abs(this.#trash.scaleY()) / 2;\n    return Math.abs(eventPosition.x - this.#trash.x()) < trashHalfWidth &&\n      Math.abs(eventPosition.y - this.#trash.y()) < trashHalfHeight;\n  }\n\n}","import {custom} from '../app/custom.js';\nimport {\n  getMousePoint,\n} from '../gui/generic.js';\nimport {\n  RemoveAnnotationCommand,\n  UpdateAnnotationCommand\n} from './drawCommands.js';\nimport {\n  isNodeNameShape,\n  isNodeNameLabel,\n  getShapePositionRange,\n  isShapeInRange\n} from './drawBounds.js';\nimport {DrawShapeEditor} from './drawShapeEditor.js';\nimport {DrawTrash} from './drawTrash.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\nimport {Scalar2D} from '../math/scalar.js';\nimport {DrawLayer} from '../gui/drawLayer.js';\nimport {Annotation} from '../image/annotation.js';\nimport {Point2D} from '../math/point.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Open a dialogue to edit roi data. Defaults to window.prompt.\n *\n * @param {Annotation} annotation The roi data.\n * @param {Function} callback The callback to launch on dialogue exit.\n */\nfunction defaultOpenRoiDialog(annotation, callback) {\n  const textExpr = prompt('Label', annotation.textExpr);\n  if (textExpr !== null) {\n    annotation.textExpr = textExpr;\n    callback(annotation);\n  }\n}\n\n/**\n * Draw shape handler: handle action on existing shapes.\n */\nexport class DrawShapeHandler {\n\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * Shape editor.\n   *\n   * @type {DrawShapeEditor}\n   */\n  #shapeEditor;\n\n  /**\n   * Trash draw: a cross.\n   *\n   * @type {DrawTrash}\n   */\n  #trash;\n\n  /**\n   * Mouse cursor.\n   *\n   * @type {string}\n   */\n  #mouseOverCursor = 'pointer';\n\n  /**\n   * Original mouse cursor.\n   *\n   * @type {string}\n   */\n  #originalCursor;\n\n  /**\n   * Shape with mouse over.\n   *\n   * @type {Konva.Group}\n   */\n  #mouseOverShapeGroup;\n\n  /**\n   * Event callback.\n   *\n   * @type {Function}\n   */\n  #eventCallback;\n\n  /**\n   * @callback eventFn\n   * @param {object} event The event.\n   */\n\n  /**\n   * @param {App} app The associated application.\n   * @param {Function} eventCallback Event callback.\n   */\n  constructor(app, eventCallback) {\n    this.#app = app;\n    this.#eventCallback = eventCallback;\n    this.#shapeEditor = new DrawShapeEditor(app, eventCallback);\n    this.#trash = new DrawTrash();\n  }\n\n  /**\n   * Set the draw editor shape.\n   *\n   * @param {Konva.Shape} shape The shape to edit.\n   * @param {DrawLayer} drawLayer The layer the shape belongs to.\n   */\n  setEditorShape(shape, drawLayer) {\n    const drawController = drawLayer.getDrawController();\n    if (shape &&\n      shape instanceof Konva.Shape &&\n      shape !== this.#shapeEditor.getShape() &&\n      drawController.isAnnotationGroupEditable()) {\n      // disable\n      this.#shapeEditor.disable();\n      // set shape\n      this.#shapeEditor.setShape(\n        shape,\n        drawLayer,\n        drawLayer.getDrawController().getAnnotation(shape.getParent().id()));\n      // enable\n      this.#shapeEditor.enable();\n    }\n  }\n\n  /**\n   * Get the currently edited shape group.\n   *\n   * @returns {Konva.Group|undefined} The edited group.\n   */\n  getEditorShapeGroup() {\n    let res;\n    if (this.#shapeEditor.isActive()) {\n      res = this.#shapeEditor.getShape().getParent();\n      if (!(res instanceof Konva.Group)) {\n        return;\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Get the currently edited annotation.\n   *\n   * @returns {Annotation|undefined} The edited annotation.\n   */\n  getEditorAnnotation() {\n    let res;\n    if (this.#shapeEditor.isActive()) {\n      res = this.#shapeEditor.getAnnotation();\n    }\n    return res;\n  }\n\n  /**\n   * Disable and reset the shape editor.\n   */\n  disableAndResetEditor() {\n    this.#shapeEditor.disable();\n    this.#shapeEditor.reset();\n  }\n\n  /**\n   * Get the real position from an event.\n   * TODO: use layer method?\n   *\n   * @param {Scalar2D} index The input index as {x,y}.\n   * @param {DrawLayer} drawLayer The origin draw layer.\n   * @returns {Scalar2D} The real position in the image as {x,y}.\n   */\n  #getRealPosition(index, drawLayer) {\n    const stage = drawLayer.getKonvaStage();\n    return {\n      x: stage.offset().x + index.x / stage.scale().x,\n      y: stage.offset().y + index.y / stage.scale().y\n    };\n  }\n\n  /**\n   * Store specific mouse over cursor.\n   *\n   * @param {string} cursor The cursor name.\n   */\n  storeMouseOverCursor(cursor) {\n    this.#mouseOverCursor = cursor;\n  }\n\n  /**\n   * Handle shape group mouseover.\n   */\n  #onMouseOverShapeGroup() {\n    // mouse cursor\n    this.#originalCursor = document.body.style.cursor;\n    document.body.style.cursor = this.#mouseOverCursor;\n    // shape opacity\n    this.#mouseOverShapeGroup.opacity(0.75);\n  }\n\n  /**\n   * Handle shape group mouseout.\n   */\n  onMouseOutShapeGroup() {\n    // mouse cursor\n    if (typeof this.#originalCursor !== 'undefined') {\n      document.body.style.cursor = this.#originalCursor;\n      this.#originalCursor = undefined;\n    }\n    // shape opacity\n    if (typeof this.#mouseOverShapeGroup !== 'undefined') {\n      this.#mouseOverShapeGroup.opacity(1);\n    }\n  }\n\n  /**\n   * Add shape group mouse over and out listeners: updates\n   *   shape group opacity and cursor.\n   *\n   * @param {Konva.Group} shapeGroup The shape group.\n   */\n  #addShapeOverListeners(shapeGroup) {\n    // handle mouse over\n    shapeGroup.on('mouseover', () => {\n      this.#mouseOverShapeGroup = shapeGroup;\n      this.#onMouseOverShapeGroup();\n    });\n\n    // handle mouse out\n    shapeGroup.on('mouseout', () => {\n      this.onMouseOutShapeGroup();\n      this.#mouseOverShapeGroup = undefined;\n    });\n  }\n\n  /**\n   * Remove shape group mouse over and out listeners.\n   *\n   * @param {Konva.Group} shapeGroup The shape group.\n   */\n  #removeShapeOverListeners(shapeGroup) {\n    shapeGroup.off('mouseover');\n    shapeGroup.off('mouseout');\n  }\n\n  /**\n   * Add shape group listeners.\n   *\n   * @param {Konva.Group} shapeGroup The shape group to set on.\n   * @param {Annotation} annotation The associated annotation.\n   * @param {DrawLayer} drawLayer The origin draw layer.\n   */\n  addShapeGroupListeners(shapeGroup, annotation, drawLayer) {\n    // shape mouse over\n    this.#addShapeOverListeners(shapeGroup);\n\n    // make shape draggable\n    this.#addShapeListeners(shapeGroup, annotation, drawLayer);\n\n    // make label draggable\n    this.#addLabelListeners(shapeGroup, annotation, drawLayer);\n\n    // double click handling: update annotation text\n    shapeGroup.on('dblclick', () => {\n      // original text expr\n      const originalTextExpr = annotation.textExpr;\n\n      const onSaveCallback = (annotation) => {\n        // new text expr\n        const newTextExpr = annotation.textExpr;\n        // create annotation update command\n        const command = new UpdateAnnotationCommand(\n          annotation,\n          {textExpr: originalTextExpr},\n          {textExpr: newTextExpr},\n          drawLayer.getDrawController()\n        );\n        // add command to undo stack\n        this.#app.addToUndoStack(command);\n        // execute command\n        command.execute();\n      };\n\n      // call roi dialog\n      if (typeof custom.openRoiDialog !== 'undefined') {\n        custom.openRoiDialog(annotation, onSaveCallback);\n      } else {\n        defaultOpenRoiDialog(annotation, onSaveCallback);\n      }\n    });\n  }\n\n  /**\n   * Add shape listeners.\n   *\n   * @param {Konva.Group} shapeGroup The shape group to get the shape from.\n   * @param {Annotation} annotation The associated annotation.\n   * @param {DrawLayer} drawLayer The origin draw layer.\n   */\n  #addShapeListeners(shapeGroup, annotation, drawLayer) {\n    const konvaLayer = drawLayer.getKonvaLayer();\n\n    const shape = shapeGroup.getChildren(isNodeNameShape)[0];\n    if (!(shape instanceof Konva.Shape)) {\n      return;\n    }\n    shape.draggable(true);\n\n    // cache vars\n    let dragStartPos;\n    let previousPos;\n    let originalProps;\n    let colour;\n\n    // drag start event handling\n    shape.on('dragstart.draw', (event) => {\n      // store colour\n      colour = shape.stroke();\n      // store pos\n      dragStartPos = {\n        x: shape.x(),\n        y: shape.y()\n      };\n      previousPos = {\n        x: event.target.x(),\n        y: event.target.y()\n      };\n      // store original properties\n      originalProps = {\n        mathShape: annotation.mathShape,\n        referencePoints: annotation.referencePoints\n      };\n\n      // display trash\n      this.#trash.activate(drawLayer);\n      // deactivate anchors to avoid events on null shape\n      this.#shapeEditor.setAnchorsActive(false);\n      // draw\n      konvaLayer.draw();\n    });\n\n    // drag move event handling\n    shape.on('dragmove.draw', (event) => {\n      // if out of range, reset shape position and exit\n      const range = getShapePositionRange(drawLayer.getBaseSize(), shape);\n      if (range && !isShapeInRange(shape, range.min, range.max)) {\n        shape.x(previousPos.x);\n        shape.y(previousPos.y);\n        return;\n      }\n\n      // move associated shapes (but not label)\n      const diff = {\n        x: event.target.x() - previousPos.x,\n        y: event.target.y() - previousPos.y\n      };\n      const children = shapeGroup.getChildren();\n      const labelWithDefaultPosition =\n        typeof annotation.labelPosition === 'undefined';\n      for (const child of children) {\n        // skip shape and label with defined position\n        if (child === event.target ||\n          (child.name() === 'label' && !labelWithDefaultPosition) ||\n          child.name() === 'connector'\n        ) {\n          continue;\n        }\n        // move other nodes\n        child.move(diff);\n      }\n\n      // store pos\n      previousPos = {\n        x: event.target.x(),\n        y: event.target.y()\n      };\n\n      // get appropriate factory\n      const factory = annotation.getFactory();\n      if (typeof factory === 'undefined') {\n        throw new Error('Cannot follow drag move without factory');\n      }\n      // update annotation\n      factory.updateAnnotationOnTranslation(annotation, diff);\n      // update label\n      factory.updateLabelContent(annotation, shapeGroup, this.#app.getStyle());\n      // update connector\n      factory.updateConnector(shapeGroup);\n      // highlight trash when on it\n      const mousePoint = getMousePoint(event.evt);\n      const offset = {\n        x: mousePoint.getX(),\n        y: mousePoint.getY()\n      };\n      const eventPos = this.#getRealPosition(offset, drawLayer);\n      this.#trash.changeChildrenColourOnTrashHover(eventPos,\n        shapeGroup, colour);\n      // draw\n      konvaLayer.draw();\n    });\n\n    // drag end event handling\n    shape.on('dragend.draw', (event) => {\n      // remove trash\n      this.#trash.remove();\n      // activate(false) will also trigger a dragend.draw\n      if (typeof event === 'undefined' ||\n        typeof event.evt === 'undefined') {\n        return;\n      }\n      const pos = {x: shape.x(), y: shape.y()};\n      // delete case\n      const mousePoint = getMousePoint(event.evt);\n      const offset = {\n        x: mousePoint.getX(),\n        y: mousePoint.getY()\n      };\n      const eventPos = this.#getRealPosition(offset, drawLayer);\n      if (this.#trash.isOverTrash(eventPos)) {\n        // compensate for the drag translation\n        shapeGroup.x(dragStartPos.x);\n        shapeGroup.y(dragStartPos.y);\n        // disable editor\n        this.#shapeEditor.disable();\n        this.#shapeEditor.reset();\n        this.#trash.changeGroupChildrenColour(shapeGroup, colour);\n        // reset math shape (for undo)\n        annotation.mathShape = originalProps.mathShape;\n        annotation.referencePoints = originalProps.referencePoints;\n\n        // create remove annotation command\n        const command = new RemoveAnnotationCommand(\n          annotation,\n          drawLayer.getDrawController()\n        );\n        // add command to undo stack\n        this.#app.addToUndoStack(command);\n        // execute command: triggers draw remove\n        command.execute();\n\n        // reset cursor\n        this.onMouseOutShapeGroup();\n      } else {\n        const translation = {\n          x: pos.x - dragStartPos.x,\n          y: pos.y - dragStartPos.y\n        };\n        if (translation.x !== 0 || translation.y !== 0) {\n          // update annotation command\n          const newProps = {\n            mathShape: annotation.mathShape,\n            referencePoints: annotation.referencePoints\n          };\n          const command = new UpdateAnnotationCommand(\n            annotation,\n            originalProps,\n            newProps,\n            drawLayer.getDrawController()\n          );\n          // add command to undo stack\n          this.#app.addToUndoStack(command);\n          // fire event manually since command is not executed\n          this.#eventCallback({\n            type: 'annotationupdate',\n            data: annotation,\n            dataid: drawLayer.getDataId(),\n            keys: Object.keys(newProps)\n          });\n          // update original shape\n          originalProps = {\n            mathShape: newProps.mathShape,\n            referencePoints: newProps.referencePoints\n          };\n        }\n        // reset anchors\n        this.#shapeEditor.setAnchorsActive(true);\n        this.#shapeEditor.resetAnchors();\n      }\n      // draw\n      konvaLayer.draw();\n      // reset start position\n      dragStartPos = {\n        x: shape.x(),\n        y: shape.y()\n      };\n    });\n  }\n\n  /**\n   * Add label listeners.\n   *\n   * @param {Konva.Group} shapeGroup The shape group to get the label from.\n   * @param {Annotation} annotation The associated annotation.\n   * @param {DrawLayer} drawLayer The origin draw layer.\n   */\n  #addLabelListeners(shapeGroup, annotation, drawLayer) {\n    const label = shapeGroup.getChildren(isNodeNameLabel)[0];\n    if (!(label instanceof Konva.Label)) {\n      return;\n    }\n    label.draggable(true);\n\n    // cache vars\n    let dragStartPos;\n    let originalLabelPosition;\n\n    // drag start event handling\n    label.on('dragstart.draw', (/*event*/) => {\n      // store pos\n      dragStartPos = {\n        x: label.x(),\n        y: label.y()\n      };\n      // store original position\n      originalLabelPosition = annotation.labelPosition;\n    });\n\n    // drag move event handling\n    label.on('dragmove.draw', (/*event*/) => {\n      // get factory\n      const factory = annotation.getFactory();\n      if (typeof factory === 'undefined') {\n        throw new Error('Cannot udpate connector without factory');\n      }\n      // update label\n      factory.updateConnector(shapeGroup);\n    });\n\n    // drag end event handling\n    label.on('dragend.draw', (/*event*/) => {\n      const translation = {\n        x: label.x() - dragStartPos.x,\n        y: label.y() - dragStartPos.y\n      };\n      if (translation.x !== 0 || translation.y !== 0) {\n        const newLabelPosition = new Point2D(label.x(), label.y());\n        // set label position\n        annotation.labelPosition = newLabelPosition;\n        // update annotation command\n        const command = new UpdateAnnotationCommand(\n          annotation,\n          {labelPosition: originalLabelPosition},\n          {labelPosition: newLabelPosition},\n          drawLayer.getDrawController()\n        );\n        // add command to undo stack\n        this.#app.addToUndoStack(command);\n        // fire event manually since command is not executed\n        this.#eventCallback({\n          type: 'annotationupdate',\n          data: annotation,\n          dataid: drawLayer.getDataId(),\n          keys: ['labelPosition']\n        });\n        // update original position\n        originalLabelPosition = newLabelPosition;\n      }\n      dragStartPos = {x: label.x(), y: label.y()};\n    });\n  }\n\n  /**\n   * Remove shape group listeners.\n   *\n   * @param {Konva.Group} shapeGroup The shape group to set off.\n   */\n  removeShapeListeners(shapeGroup) {\n    // mouse over\n    this.#removeShapeOverListeners(shapeGroup);\n    // double click\n    shapeGroup.off('dblclick');\n    // remove listeners from shape\n    const shape = shapeGroup.getChildren(isNodeNameShape)[0];\n    if (shape instanceof Konva.Shape) {\n      shape.draggable(false);\n      shape.off('dragstart.draw');\n      shape.off('dragmove.draw');\n      shape.off('dragend.draw');\n    }\n    // remove listeners from label\n    const label = shapeGroup.getChildren(isNodeNameLabel)[0];\n    if (label instanceof Konva.Label) {\n      label.draggable(false);\n      label.off('dragstart.draw');\n      label.off('dragend.draw');\n    }\n  }\n} // DrawShapeHandler class","\nimport {logger} from '../utils/logger.js';\nimport {Point2D} from '../math/point.js';\nimport {Index} from '../math/index.js';\nimport {getEllipseIndices} from '../math/ellipse.js';\nimport {Image} from '../image/image.js';\nimport {Size} from '../image/size.js';\nimport {Geometry} from '../image/geometry.js';\nimport {ColourMap} from '../image/luts.js';\nimport {getDefaultDicomSegJson} from '../image/maskFactory.js';\nimport {getDwvUIDPrefix} from '../dicom/dicomParser.js';\nimport {getElementsFromJSONTags} from '../dicom/dicomWriter.js';\nimport {DicomData} from '../app/dataController.js';\nimport {ViewConfig} from '../app/application.js';\nimport {getLayerDetailsFromEvent} from '../gui/layerGroup.js';\nimport {ScrollWheel} from './scrollWheel.js';\nimport {Command} from '../utils/undoStack.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point, Point3D} from '../math/point.js';\nimport {App} from '../app/application.js';\nimport {LayerGroup} from '../gui/layerGroup.js';\nimport {ViewLayer} from '../gui/viewLayer.js';\n/* eslint-enable no-unused-vars */\n\nconst ERROR_MESSAGES = {\n  brush: {\n    noSourceDataId: 'No source data ID defined',\n    noSourceDataIdAdd: 'No source data ID defined when adding mask slices',\n    noSourceImage: 'No source image to get origins, ID: {0}',\n    noSourceImageCreateMask: 'No source image to create mask',\n    noSourceImageGetOffset: 'No source image to get offsets, ID: {0}',\n    noBrushOrigins: 'No brush origins',\n    noBrushColour: 'No brush colour',\n    noMaskDefined: 'No mask defined when adding mask slices',\n    noCreatedMaskImage: 'No created mask image',\n    noMaskImage: 'No mask image for temporary draw command, ID: {0}',\n    noMaskImageGetOffset: 'No mask image to get offsets from',\n    noMaskImageDraw: 'No mask image for draw command, ID: {0}',\n    noMaskId: 'No mask ID to apply mask index',\n    noMaskImageForApply: 'No mask image for apply index, ID: {0}',\n    noSegments: 'No segments have been set for a new mask',\n    noMaskViewLayers: 'No mask view layers',\n    noSelectedSegmentNumber: 'No selected segment number',\n    tooManyMaskLayers: 'Too many mask view layers: {0}',\n    moreMaskLayers: 'More mask layers than expected',\n    cannotCreateMask: 'Cannot create mask with no source ID',\n    cannotDisplayMask: 'Cannot display mask with no mask ID',\n    cannotDrawNoMaskId: 'Cannot draw with no mask data ID',\n    cannotDrawNoOffset: 'Cannot draw with no offsets',\n    cannotDrawNoSegment: 'Cannot draw with no selected segment',\n    cannotDrawNoColourList: 'Cannot draw with no colour list',\n    cannotGetMaskLayers: 'Cannot get mask layers with no mask ID',\n    cannotGetMaskVCNoMaskId: 'Cannot get mask view controller: no mask ID',\n    cannotGetMaskVCNoMaskLayers:\n      'Cannot get mask view controller: no mask layers',\n    cannotSaveNoSourceId: 'Cannot save with no source data ID',\n    cannotSaveNoMask: 'Cannot save with no mask',\n    cannotFindSourceData:\n      'Cannot find source data for an existing mask, ID: {0}',\n    cannotFindSegment: 'Cannot find a segment for the selected number: {0}',\n    unsupportedScrollIndex: 'Unsupported scroll index: {0}'\n  }\n};\n\n/**\n * Format string.\n *\n * @param {*} template The template where to add values.\n * @param  {...any} values The values to add to the template.\n * @returns {string} The formated string.\n */\nfunction formatString(template, ...values) {\n  return template.replace(/{(\\d+)}/g, (_match, index) => values[index] || '');\n};\n\n/**\n * Retrieves the unique div ids in the current data view configs.\n *\n * @param {object} dataViewConfigs The data view configs.\n * @returns {string[]} Array of unique div ids.\n */\nfunction getUniqueDataViewConfigsDivIds(dataViewConfigs) {\n  let allDivIds = [];\n  if (!dataViewConfigs) {\n    return [];\n  }\n  for (const key in dataViewConfigs) {\n    if (dataViewConfigs[key]) {\n      const viewConfigs = dataViewConfigs[key];\n      if (Array.isArray(viewConfigs)) {\n        const divIds = viewConfigs.map(function (config) {\n          return config.divId;\n        });\n        allDivIds = [...allDivIds, ...divIds];\n      }\n    }\n  }\n  return [...new Set(allDivIds)];\n};\n\n// -----------------------------------------------------------------------------\n// -----------------------------------------------------------------------------\n\nconst _MouseEventButtons = {\n  left: 0,\n  middle: 1,\n  right: 2\n};\n\nconst _BrushMode = {\n  Del: 'del',\n  Add: 'add'\n};\n\n/**\n * Get an array sort callback:\n * - f(a,b) > 0 -> b,a,\n * - f(a,b) < 0 -> a,b,\n * - f(a,b) = 0 -> original order.\n *\n * @param {number} direction The direction to use to compare indices.\n * @returns {object} A function that compares two Index.\n */\nfunction getIndexCompareFunction(direction) {\n  return function (a, b) {\n    let result = 0;\n    const va = a.get(direction);\n    const vb = b.get(direction);\n    if (typeof va !== 'undefined' && typeof vb !== 'undefined') {\n      result = va - vb;\n    }\n    return result;\n  };\n}\n\n/**\n * Get a dimension organisation used to index a DICOM seg.\n *\n * @returns {object} The indices and organisations.\n */\nfunction getDimensionOrganization() {\n  // 681051091011101: first 15 of charCode('DimensionOrganizationUID')\n  const organizationUID = getDwvUIDPrefix() + '681051091011101.1';\n  return {\n    indices: {\n      value: [\n        {\n          DimensionOrganizationUID: organizationUID,\n          DimensionDescriptionLabel: 'ReferencedSegmentNumber',\n          DimensionIndexPointer: '(0062,000B)',\n          FunctionalGroupPointer: '(0062,000A)'\n        },\n        {\n          DimensionOrganizationUID: organizationUID,\n          DimensionDescriptionLabel: 'ImagePositionPatient',\n          DimensionIndexPointer: '(0020,0032)',\n          FunctionalGroupPointer: '(0020,9113)'\n        }\n      ]\n    },\n    organizations: {\n      value: [\n        {\n          DimensionOrganizationUID: organizationUID\n        }\n      ]\n    }\n  };\n}\n\n/**\n * Get the indices that form a circle.\n * Can be an ellipse to adapt to view.\n *\n * @param {Geometry} geometry The geometry.\n * @param {Point} position The circle center.\n * @param {number[]} radiuses The circle radiuses.\n * @param {number[]} dims The 2 dimensions.\n * @returns {Index[]} The indices of the circle.\n */\nfunction getCircleIndices(\n  geometry,\n  position,\n  radiuses,\n  dims\n) {\n  const centerIndex = geometry.worldToIndex(position);\n  return getEllipseIndices(centerIndex, radiuses, dims);\n}\n\n/**\n * Get the range of origin indices that correspond to input new\n * mask indices.\n *\n * @param {Geometry} geometry The geometry.\n * @param {Index[]} indices An array of indices.\n * @returns {number[]} Range of indices in the input origins.\n */\nfunction getOriginIndexRangeFromMaskIndices(geometry, indices) {\n  // sort indices according to Z\n  const sorted = indices.sort(getIndexCompareFunction(2));\n\n  // lowest origin\n  const z0 = sorted[0].get(2);\n  if (typeof z0 === 'undefined') {\n    return [];\n  }\n  const index0 = new Index([0, 0, z0]);\n  const origin0 = geometry.indexToWorld(index0);\n\n  // highest origin\n  const z1 = sorted.at(-1).get(2);\n  if (typeof z1 === 'undefined') {\n    return [];\n  }\n  const index1 = new Index([0, 0, z1]);\n  const origin1 = geometry.indexToWorld(index1);\n\n  const origins = geometry.getOrigins();\n  // threshold for distance warning\n  const spacing = geometry.getSpacing().get(2);\n  const threshold = 0.1 * spacing;\n\n  // index of origin closest to lowest point\n  const indexStart = origin0.get3D().getClosest(origins);\n  const originStart = origins[indexStart];\n  const d0 = origin0.get3D().getDistance(originStart);\n  if (d0 > threshold) {\n    logger.warn(\n      'Large distance between origin and origin for first index: ' + d0);\n  }\n\n  // index of origin closest to highest point\n  const indexEnd = origin1.get3D().getClosest(origins);\n  const originEnd = origins[indexEnd];\n  const d1 = origin1.get3D().getDistance(originEnd);\n  if (d1 > threshold) {\n    logger.warn(\n      'Large distance between origin and origin for last index: ' + d1);\n  }\n\n  return [indexStart, indexEnd];\n}\n\n/**\n * Get the data offsets that correspond to input indices.\n *\n * @param {Geometry} geometry The geometry.\n * @param {Index[]} indices An array of indices.\n * @returns {number[]} An array of offsets.\n */\nfunction getOffsetsFromIndices(geometry, indices) {\n  const imageSize = geometry.getSize();\n  const offsets = [];\n  for (const index of indices) {\n    const offset = imageSize.indexToOffset(index);\n    if (offset >= 0) {\n      offsets.push(offset);\n    }\n  }\n  return offsets.sort(function compareNumbers(a, b) {\n    return a - b;\n  });\n}\n\nclass DrawBrushCommandProperties {\n  mask;\n  dataId;\n  offsetsLists;\n  mode;\n  segmentNumber;\n  srclayerid;\n  originalValuesLists;\n  isSilent;\n}\n/**\n * Draw brush command.\n */\nclass DrawBrushCommand extends Command {\n  #mask;\n  #dataId;\n  #offsetsLists;\n  #mode;\n  #segmentNumber;\n  #srclayerid;\n  #originalValuesLists;\n  #isSilent;\n\n  #exeType;\n  #undoType;\n\n  /**\n   * @param {DrawBrushCommandProperties} properties The command properties.\n   */\n  constructor(properties) {\n    super();\n    this.#mask = properties.mask;\n    this.#dataId = properties.dataId;\n    this.#offsetsLists = properties.offsetsLists;\n    this.#mode = properties.mode;\n    this.#segmentNumber = properties.segmentNumber;\n    this.#srclayerid = properties.srclayerid;\n\n    if (typeof properties.originalValuesLists !== 'undefined') {\n      this.#originalValuesLists = properties.originalValuesLists;\n    }\n    this.#isSilent = properties.isSilent ?? false;\n    // event types\n    this.#exeType = this.#mode === _BrushMode.Del ? 'brushremove' : 'brushdraw';\n    this.#undoType =\n      this.#exeType === 'brushdraw' ? 'brushremove' : 'brushdraw';\n  }\n\n  /**\n   * Get the original values before applying brush.\n   *\n   * @returns {Array|undefined} Lists of original value iterators,\n   *   undefined when erasing.\n   */\n  getOriginalValuesLists() {\n    return this.#originalValuesLists;\n  }\n\n  /**\n   * Get the execute event.\n   *\n   * @returns {CustomEvent} The event.\n   */\n  getExecuteEvent() {\n    const segNumber =\n      this.#exeType === 'brushdraw' ? this.#segmentNumber : undefined;\n    return new CustomEvent(this.#exeType, {\n      detail: {\n        segmentnumber: segNumber,\n        dataid: this.#dataId,\n        srclayerid: this.#srclayerid\n      }\n    });\n  }\n\n  /**\n   * Get the command name.\n   *\n   * @returns {string} The command name.\n   */\n  getName() {\n    return 'Draw-brush';\n  }\n\n  /**\n   * Execute the command.\n   *\n   * @fires DrawBrushCommand#brushdraw\n   */\n  execute() {\n    if (typeof this.#segmentNumber === 'undefined') {\n      return;\n    }\n\n    let segNumber = this.#segmentNumber;\n    if (this.#exeType === 'brushremove') {\n      segNumber = 0;\n    }\n\n    // draw\n    if (typeof this.#originalValuesLists === 'undefined') {\n      this.#originalValuesLists = this.#mask.setAtOffsetsAndGetOriginals(\n        this.#offsetsLists,\n        segNumber\n      );\n    } else {\n      this.#mask.setAtOffsetsWithIterator(this.#offsetsLists, segNumber);\n    }\n\n    // callback\n    if (!this.#isSilent) {\n      /**\n       * Draw create event.\n       *\n       * @event DrawBrushCommand#brushdraw\n       * @type {object}\n       * @property {number} id The id of the created brush.\n       */\n      this.onExecute(this.getExecuteEvent());\n    }\n  }\n\n  /**\n   * Undo the command.\n   *\n   * @fires DrawBrushCommand#brushremove\n   */\n  undo() {\n    if (typeof this.#originalValuesLists === 'undefined') {\n      this.#originalValuesLists = this.#mask.setAtOffsetsAndGetOriginals(\n        this.#offsetsLists,\n        0\n      );\n    } else {\n      this.#mask.setAtOffsetsWithIterator(\n        this.#offsetsLists, this.#originalValuesLists);\n    }\n\n    // callback\n    const number =\n      this.#undoType === 'brushdraw' ? this.#segmentNumber : undefined;\n    const undoEvent = new CustomEvent(this.#undoType, {\n      detail: {\n        segmentnumber: number,\n        dataid: this.#dataId,\n        srclayerid: this.#srclayerid\n      }\n    });\n    this.onUndo(undoEvent);\n  }\n\n  /**\n   * Handle an execute event.\n   *\n   * @param {CustomEvent} _event The execute event with type and id.\n   */\n  onExecute(_event) {\n    // default does nothing.\n  }\n\n  /**\n   * Handle an undo event.\n   *\n   * @param {CustomEvent} _event The undo event with type and id.\n   */\n  onUndo(_event) {\n    // default does nothing.\n  }\n} // DrawBrushCommand class\n\n/**\n * Brush class.\n */\nexport class Brush extends EventTarget {\n  #app;\n\n  /**\n   * Scroll wheel handler.\n   *\n   * @type {ScrollWheel}\n   */\n  #scrollWhell;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    super();\n    this.#app = app;\n    this.#scrollWhell = new ScrollWheel(app);\n  }\n\n  /**\n   * Interaction start flag.\n   *\n   * @type {boolean}\n   */\n  #started = false;\n\n  /**\n   * Mask image.\n   *\n   * @type {Image}\n   */\n  #mask;\n\n  /**\n   * Mask data index.\n   *\n   * @type {string}\n   */\n  #maskDataId;\n\n  /**\n   * The brush size.\n   *\n   * @type {number}\n   */\n  #brushSize = 10;\n\n  /**\n   * The brush size range.\n   *\n   * @type {object}\n   */\n  #brushSizeRange = {min: 1, max: 20};\n\n  /**\n   * The brush mode: 'add' or 'del'.\n   *\n   * @type {string}\n   */\n  #brushMode = _BrushMode.Del;\n\n  /**\n   * The selected segment number.\n   *\n   * @type {number}\n   */\n  #selectedSegmentNumber;\n\n  /**\n   * UID counter.\n   *\n   * @type {number}\n   */\n  #uid = 0;\n\n  /**\n   * Current layer group.\n   *\n   * @type {LayerGroup}\n   */\n  #currentLayerGroup;\n\n  /**\n   * Interaction start point.\n   *\n   * @type {Point2D}\n   */\n  #startPoint;\n\n  // temporary variables\n  #tmpOffsetsLists;\n  #tmpOriginalValuesLists;\n\n  /**\n   * Black list: series instance uid list\n   * for which brush segmentation creation\n   * is forbidden.\n   *\n   * @type {string[]}\n   */\n  #blacklist = [];\n\n  /**\n   * Get a mask slice.\n   *\n   * @param {Geometry} geometry The mask geometry.\n   * @param {Point3D} origin The slice origin.\n   * @param {object} meta The mask meta.\n   * @returns {Image} The slice.\n   */\n  #createMaskImage(geometry, origin, meta) {\n    // create data\n    const sizeValues = geometry.getSize().getValues();\n    sizeValues[2] = 1;\n    const maskSize = new Size(sizeValues);\n    const maskGeometry = new Geometry(\n      [origin],\n      maskSize,\n      geometry.getSpacing(),\n      geometry.getOrientation()\n    );\n    const values = new Uint8Array(maskSize.getDimSize(2));\n    values.fill(0);\n    ++this.#uid;\n    const uids = [this.#uid.toString()];\n    const maskSlice = new Image(maskGeometry, values, uids);\n    maskSlice.setMeta(meta);\n    maskSlice.setPhotometricInterpretation('PALETTE COLOR');\n    maskSlice.setPaletteColourMap(new ColourMap([0], [0], [0]));\n\n    return maskSlice;\n  }\n\n  /**\n   * Add slices to mask if needed.\n   *\n   * @param {Geometry} sourceGeometry The source geometry.\n   * @param {Geometry} maskGeometry The mask geometry.\n   * @param {Point} position The circle center.\n   * @param {number[]} circleDims The circle dimensions.\n   * @param {number[]} radiuses The circle radiuses.\n   * @param {object} sliceMeta The slice meta.\n   */\n  #addMaskSlices(\n    sourceGeometry,\n    maskGeometry,\n    position,\n    circleDims,\n    radiuses,\n    sliceMeta\n  ) {\n    // circle indices in the image geometry\n    const circleIndices = getCircleIndices(\n      sourceGeometry,\n      position,\n      radiuses,\n      circleDims\n    );\n    // origin index range represented by the circle indicies\n    const newOrigIndexRange = getOriginIndexRangeFromMaskIndices(\n      sourceGeometry,\n      circleIndices\n    );\n    if (typeof newOrigIndexRange === 'undefined' ||\n      newOrigIndexRange.length === 0) {\n      throw new Error(ERROR_MESSAGES.brush.noBrushOrigins);\n    }\n\n    const sourceOrigins = sourceGeometry.getOrigins();\n    const maskOrigins = maskGeometry.getOrigins();\n\n    // min and max mask origin closest source origin indices\n    const maskOrigIndexStart = maskOrigins[0].getClosest(sourceOrigins);\n    const maskOrigIndexEnd = maskOrigins.at(-1).getClosest(sourceOrigins);\n\n    // index in source origin array of slices to add\n    const indicesToAdd = [];\n\n    // first index compare\n    // (go from closest to mask to avoid variable spacing warning\n    //  when appending image slices)\n    if (newOrigIndexRange[0] < maskOrigIndexStart) {\n      for (\n        let index = maskOrigIndexStart - 1;\n        index >= newOrigIndexRange[0];\n        --index\n      ) {\n        indicesToAdd.push(index);\n      }\n    }\n    // last index compare\n    if (newOrigIndexRange[1] > maskOrigIndexEnd) {\n      for (\n        let index = maskOrigIndexEnd + 1;\n        index <= newOrigIndexRange[1];\n        ++index\n      ) {\n        indicesToAdd.push(index);\n      }\n    }\n\n    // convert index to origin\n    const originsToAdd = [];\n    for (const index of indicesToAdd) {\n      originsToAdd.push(sourceOrigins[index]);\n    }\n\n    // append slices\n    if (typeof this.#mask === 'undefined') {\n      throw new Error(ERROR_MESSAGES.brush.noMaskDefined);\n    }\n    const tags = this.#mask.getMeta();\n    for (const element of originsToAdd) {\n      tags.numberOfFiles += 1;\n      this.#mask.appendSlice(\n        this.#createMaskImage(maskGeometry, element, sliceMeta));\n    }\n  }\n\n  /**\n   * Paint the mask at the given offsets.\n   *\n   * @param {Array} offsets The mask offsets.\n   */\n  #paintMaskAtOffsets(offsets) {\n    const maskVl = this.#getMaskViewLayer();\n    const srclayerid = maskVl.getId();\n\n    // get mask image\n    if (typeof this.#maskDataId === 'undefined') {\n      throw new Error(ERROR_MESSAGES.brush.noMaskId);\n    }\n    const maskData = this.#app.getData(this.#maskDataId);\n    if (!maskData) {\n      throw new Error(\n        formatString(ERROR_MESSAGES.brush.noMaskImage, this.#maskDataId));\n    }\n\n    // temporary command\n    const props = new DrawBrushCommandProperties();\n    props.mask = maskData.image;\n    props.dataId = this.#maskDataId;\n    props.offsetsLists = [offsets];\n    props.mode = this.#brushMode;\n    props.segmentNumber = this.#selectedSegmentNumber;\n    props.srclayerid = srclayerid;\n    const command = new DrawBrushCommand(props);\n    command.execute();\n\n    // store offsets and colours for final command\n    this.#tmpOffsetsLists.push(offsets);\n    // only one element in original colours\n    const originalValues = command.getOriginalValuesLists();\n    if (typeof originalValues !== 'undefined') {\n      this.#tmpOriginalValuesLists.push(originalValues[0]);\n    }\n  }\n\n  /**\n   * Create the mask.\n   *\n   * @param {Point} position The first slice position.\n   * @param {Image} sourceImage The source image.\n   * @returns {string} The mask data id.\n   */\n  #createMask(position, sourceImage) {\n    // check souce image\n    if (!sourceImage) {\n      throw new Error(\n        formatString(ERROR_MESSAGES.brush.noSourceImageCreateMask));\n    }\n    const sourceGeometry = sourceImage.getGeometry();\n\n    const imgK = sourceGeometry.worldToIndex(position).get(2);\n    if (typeof imgK === 'undefined') {\n      throw new Error('Z position is undefined');\n    }\n    const index = new Index([0, 0, imgK]);\n    const imagePosPat = sourceGeometry.getOrigins()[imgK];\n\n    // default tags\n    const firstSliceMeta = getDefaultDicomSegJson();\n    // dicom seg dimension\n    const dimension = getDimensionOrganization();\n    firstSliceMeta.DimensionOrganizationSequence = dimension.organizations;\n    firstSliceMeta.DimensionIndexSequence = dimension.indices;\n    // local\n    firstSliceMeta.PixelRepresentation = 0;\n    firstSliceMeta.numberOfFiles = 1;\n\n    const tags = sourceImage.getMeta();\n\n    firstSliceMeta.PatientID = tags.PatientID;\n    firstSliceMeta.StudyInstanceUID = tags.StudyInstanceUID;\n    firstSliceMeta.SeriesInstanceUID = tags.SeriesInstanceUID;\n    const referencedSOPs = [\n      {\n        referencedSOPClassUID: tags.SOPClassUID,\n        referencedSOPInstanceUID: sourceImage.getImageUid(index)\n      }\n    ];\n    const referenceSeriesTag = [];\n    referenceSeriesTag.push({\n      ReferencedInstanceSequence: {\n        value: referencedSOPs\n      },\n      SeriesInstanceUID: tags.SeriesInstanceUID\n    });\n    firstSliceMeta.ReferencedSeriesSequence = {\n      value: referenceSeriesTag\n    };\n    firstSliceMeta.custom = {\n      frameInfos: [\n        {\n          dimIndex: [1, 1],\n          refSegmentNumber: 1,\n          imagePosPat: imagePosPat.getValues(),\n          derivationImages: [\n            {\n              sourceImages: referencedSOPs\n            }\n          ]\n        }\n      ]\n    };\n\n    // get length unit from ref image\n    firstSliceMeta.lengthUnit = sourceImage.getMeta().lengthUnit;\n\n    this.#mask = this.#createMaskImage(\n      sourceGeometry,\n      imagePosPat,\n      firstSliceMeta\n    );\n\n    // fires load events and renders data\n    // (will create viewLayer for it)\n    const elements = getElementsFromJSONTags(firstSliceMeta);\n    const data = new DicomData(elements);\n    data.image = this.#mask;\n    const dataId = this.#app.getNextDataId();\n    const added = this.#app.addData(dataId, data);\n    if (!added) {\n      throw new Error('Cannot add mask data');\n    }\n    return dataId;\n  }\n\n  /**\n   * Get the orientation of the first data view config of the input\n   * divId.\n   *\n   * @param {string} divId The divId.\n   * @returns {string} The orientation.\n   */\n  #getDataViewConfigOrientation(divId) {\n    const dataConfigs = this.#app.getDataViewConfigs();\n    let orient;\n    for (const key in dataConfigs) {\n      const config = dataConfigs[key].find(function (item) {\n        return item.divId === divId;\n      });\n      if (typeof config !== 'undefined') {\n        orient = config.orientation;\n        break;\n      }\n    }\n    return orient;\n  }\n\n  /**\n   * Display a newly created mask.\n   *\n   * @param {string} divId The div id where to display the mask.\n   */\n  #displayMask(divId) {\n    // check mask data id\n    if (typeof this.#maskDataId === 'undefined') {\n      throw new Error(ERROR_MESSAGES.brush.cannotDisplayMask);\n    }\n    const viewConfig = new ViewConfig(divId);\n    viewConfig.orientation = this.#getDataViewConfigOrientation(divId);\n    this.#app.addDataViewConfig(this.#maskDataId, viewConfig);\n    this.#app.render(this.#maskDataId);\n  }\n\n  /**\n   * Get the first referenced UID of a mask image.\n   *\n   * @param {object} meta The mask image meta.\n   * @returns {string|undefined} The UID.\n   */\n  #getReferenceDataUID(meta) {\n    let dataUid;\n    const customMeta = meta.custom;\n    const frameInfos = customMeta.frameInfos;\n    if (frameInfos.length === 0) {\n      return dataUid;\n    }\n    // DerivationImageSequence (0008,9124)\n    const derivationImages = frameInfos[0].derivationImages;\n    if (typeof derivationImages === 'undefined') {\n      return dataUid;\n    }\n    if (derivationImages.length === 0) {\n      return dataUid;\n    }\n    // SourceImageSequence (0008,2112)\n    const sourceImages = derivationImages[0].sourceImages;\n    if (typeof sourceImages === 'undefined') {\n      return dataUid;\n    }\n    if (sourceImages.length === 0) {\n      return;\n    }\n    // ReferencedSOPInstanceUID (0008,1155)\n    return sourceImages[0].referencedSOPInstanceUID;\n  }\n\n  /**\n   * Get the source data id from the mask image meta.\n   *\n   * @param {Image} mask The mask image.\n   * @returns {string} The source data id.\n   */\n  #getSourceDataIdFromMask(mask) {\n    // get source id from mask meta\n    const meta = mask.getMeta();\n    const sourceDataUID = this.#getReferenceDataUID(meta);\n    // search app for the data ID of this SOPInstanceUID...\n    let ids = [];\n    if (sourceDataUID !== 'undefined') {\n      ids = this.#app.getDataIdsFromSopUids([sourceDataUID]);\n    }\n    let sourceDataId = '0';\n    if (ids.length > 0) {\n      sourceDataId = ids[0];\n    } else {\n      // mask with no source data...\n      logger.warn(\n        formatString(ERROR_MESSAGES.brush.cannotFindSourceData, sourceDataUID));\n    }\n    return sourceDataId;\n  }\n\n  /**\n   * Get the mask view layer.\n   *\n   * @param {LayerGroup} layerGroup The layer group to search.\n   * @returns {ViewLayer} The view layer.\n   */\n  #getLayerGroupMaskViewLayer(layerGroup) {\n    // check mask data id\n    if (typeof this.#maskDataId === 'undefined') {\n      throw new Error(ERROR_MESSAGES.brush.cannotGetMaskLayers);\n    }\n\n    const maskViewLayers = layerGroup.getViewLayersByDataId(\n      this.#maskDataId\n    );\n    if (maskViewLayers.length === 0) {\n      throw new Error(ERROR_MESSAGES.brush.noMaskViewLayers);\n    }\n    if (maskViewLayers.length !== 1) {\n      logger.warn(\n        formatString(\n          ERROR_MESSAGES.brush.tooManyMaskLayers, maskViewLayers.length)\n      );\n    }\n    return maskViewLayers[0];\n  }\n\n  /**\n   * Get the mask image.\n   *\n   * @param {string} maskDataId The mask data id.\n   * @returns {Image} The image.\n   */\n  #getMaskImage(maskDataId) {\n    if (typeof maskDataId === 'undefined') {\n      throw new Error(ERROR_MESSAGES.brush.noMaskId);\n    }\n    const maskData = this.#app.getData(maskDataId);\n    if (typeof maskData === 'undefined') {\n      throw new Error(ERROR_MESSAGES.brush.noMaskImageGetOffset);\n    }\n    return maskData.image;\n  }\n\n  /**\n   * Get the mask offset for an event.\n   *\n   * @param {object} event The event containing the mask position.\n   * @returns {number[]} The array of offset to paint.\n   */\n  #getMaskOffsets(event) {\n    const layerDetails = getLayerDetailsFromEvent(event);\n    const mousePoint = new Point2D(event.offsetX, event.offsetY);\n    const layerGroup = this.#app.getLayerGroupByDivId(\n      layerDetails.groupDivId\n    );\n    if (typeof layerGroup === 'undefined') {\n      throw new Error('No layergroup to get mask offsets');\n    }\n    this.#currentLayerGroup = layerGroup;\n\n    let viewLayer;\n    if (typeof this.#maskDataId === 'undefined') {\n      viewLayer = layerGroup.getBaseViewLayer();\n    } else {\n      viewLayer = layerGroup.getViewLayersByDataId(this.#maskDataId)[0];\n    }\n    if (typeof viewLayer === 'undefined') {\n      return [];\n    }\n    const viewController = viewLayer.getViewController();\n    const savedPosition = viewController.getCurrentPosition();\n\n    const searchMaskMeta = {\n      Modality: 'SEG'\n    };\n\n    // update existing mask from current vl or create a new one\n    let maskVl;\n    let maskVc;\n    let sourcePosition;\n    let sourceImage;\n    if (viewController.equalImageMeta(searchMaskMeta)) {\n      this.#mask = this.#getMaskImage(this.#maskDataId);\n      // get source image\n      const sourceDataId = this.#getSourceDataIdFromMask(this.#mask);\n      const sourceData = this.#app.getData(sourceDataId);\n      if (!sourceData) {\n        throw new Error(formatString(\n          ERROR_MESSAGES.brush.noSourceImageGetOffset, sourceDataId\n        ));\n      }\n      sourceImage = sourceData.image;\n      // exit if reference image is resampled\n      if (sourceImage.isResampled()) {\n        logger.warn('Cannot update mask with resampled reference image.');\n        return [];\n      }\n      // get source position\n      // any layer from the app (could be other layer group)\n      const sourceVl = this.#app.getViewLayersByDataId(sourceDataId)[0];\n      const sourceViewController = sourceVl.getViewController();\n      const planePos = sourceVl.displayToPlanePos(mousePoint);\n      sourcePosition = sourceViewController.getPositionFromPlanePoint(planePos);\n      // update locals\n      maskVl = viewLayer;\n      maskVc = viewController;\n    } else {\n      // view layer is source\n      const sourceDataId = viewLayer.getDataId();\n      const sourceData = this.#app.getData(sourceDataId);\n      if (!sourceData) {\n        throw new Error(formatString(\n          ERROR_MESSAGES.brush.noSourceImageGetOffset, sourceDataId\n        ));\n      }\n      sourceImage = sourceData.image;\n      // exit if reference image is resampled\n      if (sourceImage.isResampled()) {\n        logger.warn('Cannot create mask on resampled image.');\n        return [];\n      }\n      // get source position\n      const planePos = viewLayer.displayToPlanePos(mousePoint);\n      sourcePosition = viewController.getPositionFromPlanePoint(planePos);\n      // create mask (sets this.#mask)\n      this.#maskDataId = this.#createMask(savedPosition, sourceImage);\n      // check\n      if (typeof this.#mask === 'undefined') {\n        throw new Error(ERROR_MESSAGES.brush.noCreatedMaskImage);\n      }\n      // display mask\n      const divId = layerGroup.getDivId();\n      const layerGroupHasDiv = typeof divId !== 'undefined';\n      if (layerGroupHasDiv) {\n        this.#displayMask(divId);\n      }\n      // newly create mask case: find the SEG view layer\n      maskVl = this.#getLayerGroupMaskViewLayer(layerGroup);\n      maskVc = maskVl.getViewController();\n\n      if (layerGroupHasDiv) {\n        // this.#displayMask causes the position to get reset,\n        // so we have to restore it or we may not be drawing on\n        // the correct slice.\n        maskVc.setCurrentPosition(savedPosition);\n      }\n    }\n\n    const sourceGeometry = sourceImage.getGeometry();\n    const sliceMeta = this.#mask.getMeta();\n    const maskGeometry = this.#mask.getGeometry();\n\n    const spacing2D = viewController.get2DSpacing();\n    const rx = Math.round(this.#brushSize / spacing2D.x);\n    const ry = Math.round(this.#brushSize / spacing2D.y);\n    const radiuses = [rx, ry];\n\n    let circleDims;\n    const scrollIndex = viewController.getScrollDimIndex();\n    switch (scrollIndex) {\n      case 0: {\n        circleDims = [1, 2];\n        break;\n      }\n      case 1: {\n        circleDims = [0, 2];\n        break;\n      }\n      case 2: {\n        circleDims = [0, 1];\n        break;\n      }\n      default: {\n        throw new Error(\n          formatString(ERROR_MESSAGES.brush.unsupportedScrollIndex, scrollIndex)\n        );\n      }\n    }\n\n    this.#addMaskSlices(\n      sourceGeometry,\n      maskGeometry,\n      sourcePosition,\n      circleDims,\n      radiuses,\n      sliceMeta\n    );\n\n    // circle indices in the mask geometry\n    const maskPlanePos = maskVl.displayToPlanePos(mousePoint);\n    const maskPosition = maskVc.getPositionFromPlanePoint(maskPlanePos);\n    const maskCircleIndices = getCircleIndices(\n      maskGeometry,\n      maskPosition,\n      radiuses,\n      circleDims\n    );\n\n    return getOffsetsFromIndices(maskGeometry, maskCircleIndices);\n  }\n\n  /**\n   * Determines if the event is over a series inside the blacklist.\n   *\n   * @param {MouseEvent} event The mouse down event.\n   * @returns {boolean} True if in black list.\n   */\n  #isInBlackList(event) {\n    const layerDetails = getLayerDetailsFromEvent(event);\n    const layerGroup = this.#app.getLayerGroupByDivId(\n      layerDetails.groupDivId\n    );\n    if (typeof layerGroup === 'undefined') {\n      throw new Error('No layergroup to check black list');\n    }\n    const drawLayer = layerGroup.getActiveDrawLayer();\n\n    if (typeof drawLayer === 'undefined') {\n      const viewLayer = layerGroup.getActiveViewLayer();\n      const referenceDataId = viewLayer.getDataId();\n      const referenceData = this.#app.getData(referenceDataId);\n      const referenceMeta = referenceData.image.getMeta();\n      const seriesInstanceUID = referenceMeta.SeriesInstanceUID;\n      // check black list\n      if (this.#blacklist.includes(seriesInstanceUID)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Determines if the active layer is a View layer.\n   *\n   * @param {MouseEvent} event The mouse down event.\n   * @returns {boolean} True if the active layer is a View layer.\n   */\n  #activeLayerIsViewLayer(event) {\n    const layerDetails = getLayerDetailsFromEvent(event);\n    const layerGroup = this.#app.getLayerGroupByDivId(\n      layerDetails.groupDivId\n    );\n    if (typeof layerGroup === 'undefined') {\n      throw new Error('No layergroup to check for view layer');\n    }\n    const layer = layerGroup.getActiveLayer();\n    if (layer instanceof ViewLayer) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Handle mouse down event.\n   *\n   * @param {MouseEvent} event The mouse down event.\n   */\n  mousedown = (event) => {\n    if (!this.#activeLayerIsViewLayer(event) ||\n      this.#isInBlackList(event)) {\n      return;\n    }\n    if (typeof this.#selectedSegmentNumber === 'undefined') {\n      logger.warn(ERROR_MESSAGES.brush.noSelectedSegmentNumber);\n      return;\n    }\n\n    // start flag\n    this.#started = true;\n    // first position\n    this.#startPoint = new Point2D(event.offsetX, event.offsetY);\n\n    // reset tmp vars\n    this.#tmpOffsetsLists = [];\n    this.#tmpOriginalValuesLists = [];\n\n    // check right button\n    this.#setEraserOnRightMousedown(event);\n    // paint\n    const offsets = this.#getMaskOffsets(event);\n    if (offsets.length > 0) {\n      this.#paintMaskAtOffsets(offsets);\n    } else {\n      // reset flag\n      this.#started = false;\n      this.#removeEraserOnRightMousedown(event);\n    }\n  };\n\n  /**\n   * Checks if the mouse down event has been done with right click\n   * and if true, set erasing mode to the brush color.\n   *\n   * @param {MouseEvent} event The mouse event.\n   */\n  #setEraserOnRightMousedown(event) {\n    if (event.button === _MouseEventButtons.right) {\n      this.#brushMode = _BrushMode.Del;\n      const activateErasingEvent = new CustomEvent('erasingactivated');\n      this.dispatchEvent(activateErasingEvent);\n    }\n  }\n\n  /**\n   * Checks if the mouse down event has been done with right click\n   * and if true, removes erasing mode from the brush color.\n   *\n   * @param {MouseEvent} event The mouse event.\n   */\n  #removeEraserOnRightMousedown(event) {\n    if (event.button === _MouseEventButtons.right) {\n      this.#brushMode = _BrushMode.Add;\n      const deactivateErasingEvent = new CustomEvent('erasingdeactivated');\n      this.dispatchEvent(deactivateErasingEvent);\n    }\n  }\n\n  /**\n   * Handle mouse move event.\n   *\n   * @param {object} event The mouse move event.\n   */\n  mousemove = (event) => {\n    if (!this.#started) {\n      return;\n    }\n    if (typeof this.#startPoint === 'undefined') {\n      return;\n    }\n    const mousePoint = new Point2D(event.offsetX, event.offsetY);\n    const diffX = Math.abs(mousePoint.getX() - this.#startPoint.getX());\n    const diffY = Math.abs(mousePoint.getY() - this.#startPoint.getY());\n    if (diffX > this.#brushSize / 2 || diffY > this.#brushSize / 2) {\n      const offsets = this.#getMaskOffsets(event);\n      if (offsets.length > 0) {\n        this.#paintMaskAtOffsets(offsets);\n      }\n      this.#startPoint = mousePoint;\n    }\n  };\n\n  /**\n   * Handle mouse up event.\n   *\n   * @param {MouseEvent} _event The mouse up event.\n   */\n  mouseup = (_event) => {\n    if (this.#started) {\n      this.#started = false;\n      this.#removeEraserOnRightMousedown(_event);\n\n      if (typeof this.#maskDataId === 'undefined') {\n        throw new Error(ERROR_MESSAGES.brush.cannotDrawNoMaskId);\n      }\n      if (typeof this.#tmpOffsetsLists === 'undefined') {\n        throw new Error(ERROR_MESSAGES.brush.cannotDrawNoOffset);\n      }\n      if (typeof this.#tmpOriginalValuesLists === 'undefined') {\n        throw new Error(ERROR_MESSAGES.brush.cannotDrawNoColourList);\n      }\n\n      // reverse lists for command to respect original colours\n      this.#tmpOffsetsLists.reverse();\n      this.#tmpOriginalValuesLists.reverse();\n      const maskVl = this.#getMaskViewLayer();\n      const srclayerid = maskVl.getId();\n\n      // full draw from mouse down to up\n      const maskData = this.#app.getData(this.#maskDataId);\n      if (!maskData) {\n        throw new Error(\n          formatString(ERROR_MESSAGES.brush.noMaskImageDraw, this.#maskDataId)\n        );\n      }\n      const props = new DrawBrushCommandProperties();\n      props.mask = maskData.image;\n      props.dataId = this.#maskDataId;\n      props.offsetsLists = this.#tmpOffsetsLists;\n      props.mode = this.#brushMode;\n      props.segmentNumber = this.#selectedSegmentNumber;\n      props.srclayerid = srclayerid;\n      props.originalValuesLists = this.#tmpOriginalValuesLists;\n      const command = new DrawBrushCommand(props);\n      command.onExecute = (event) => {\n        this.dispatchEvent(event);\n      };\n      command.onUndo = (event) => {\n        this.dispatchEvent(event);\n        this.#mask.recalculateLabels();\n      };\n\n      // save command in undo stack\n      this.#app.addToUndoStack(command);\n      // fire event\n      this.dispatchEvent(command.getExecuteEvent());\n      this.#mask.recalculateLabels();\n    }\n  };\n\n  /**\n   * Handle mouse out event.\n   *\n   * @param {object} event The mouse out event.\n   */\n  mouseout = (event) => {\n    this.mouseup(event);\n  };\n\n  /**\n   * Handle touch start event.\n   *\n   * @param {object} event The touch start event.\n   */\n  touchstart = (event) => {\n    // call mouse equivalent\n    this.mousedown(event);\n  };\n\n  /**\n   * Handle touch move event.\n   *\n   * @param {object} event The touch move event.\n   */\n  touchmove = (event) => {\n    // call mouse equivalent\n    this.mousemove(event);\n  };\n\n  /**\n   * Handle touch end event.\n   *\n   * @param {object} event The touch end event.\n   */\n  touchend = (event) => {\n    // call mouse equivalent\n    this.mouseup(event);\n  };\n\n  /**\n   * Handle mouse wheel event.\n   *\n   * @param {WheelEvent} event The mouse wheel event.\n   */\n  wheel = (event) => {\n    this.#scrollWhell.wheel(event);\n  };\n\n  /**\n   * Get the mask view layer.\n   *\n   * @returns {ViewLayer} The mask view layer.\n   */\n  #getMaskViewLayer() {\n    if (typeof this.#maskDataId === 'undefined') {\n      throw new Error(ERROR_MESSAGES.brush.cannotGetMaskVCNoMaskId);\n    }\n    if (typeof this.#currentLayerGroup === 'undefined') {\n      throw new Error('No current layer group');\n    }\n\n    const maskLayers = this.#currentLayerGroup.getViewLayersByDataId(\n      this.#maskDataId\n    );\n    if (maskLayers.length === 0) {\n      throw new Error(ERROR_MESSAGES.brush.cannotGetMaskVCNoMaskLayers);\n    }\n    if (maskLayers.length !== 1) {\n      logger.warn(ERROR_MESSAGES.brush.moreMaskLayers);\n    }\n    return maskLayers[0];\n  }\n\n  /**\n   * Handle key down event.\n   *\n   * @param {object} event The key down event.\n   */\n  keydown = (event) => {\n    event.context = 'Brush';\n    this.#app.onKeydown(event);\n\n    const ctrlOrAlt = event.ctrlKey || event.altKey;\n\n    if (\n      !ctrlOrAlt &&\n      event.key === '+' &&\n      this.#brushSize + 1 < this.#brushSizeRange.max\n    ) {\n      this.#brushSize += 1;\n      const sizeEvent = new CustomEvent('brushsizechange', {\n        detail: {\n          value: this.#brushSize\n        }\n      });\n      this.dispatchEvent(sizeEvent);\n    } else if (\n      !ctrlOrAlt &&\n      event.key === '-' &&\n      this.#brushSize - 1 >= this.#brushSizeRange.min\n    ) {\n      this.#brushSize -= 1;\n      const sizeEvent = new CustomEvent('brushsizechange', {\n        detail: {\n          value: this.#brushSize\n        }\n      });\n      this.dispatchEvent(sizeEvent);\n    } else if (!ctrlOrAlt && !Number.isNaN(Number.parseInt(event.key, 10))) {\n      this.#brushMode = _BrushMode.Add;\n      //const number = Number.parseInt(event.key, 10);\n      //this.#setSelectedSegment2(number);\n    } else if (!ctrlOrAlt && event.key === 'a') {\n      this.#brushMode = _BrushMode.Add;\n      logger.debug('Brush mode: ' + this.#brushMode);\n    } else if (!ctrlOrAlt && event.key === 'd') {\n      this.#brushMode = _BrushMode.Del;\n      logger.debug('Brush mode: ' + this.#brushMode);\n    }\n  };\n\n  /**\n   * Activate the tool and activates/deactivates\n   * the context menu of all dwv div ids.\n   *\n   * @param {boolean} bool The flag to activate or not.\n   */\n  activate(bool) {\n    const viewConfigs = this.#app.getDataViewConfigs();\n    const allDivIds = getUniqueDataViewConfigsDivIds(viewConfigs);\n    if (bool) {\n      this.#deactivateDivIdsContextMenu(allDivIds);\n      return;\n    }\n    this.#reactivateDivIdsContextMenu(allDivIds);\n  }\n\n  /**\n   * Deactivates the context menu on all dwv div ids.\n   *\n   * @param {string[]} divIds The div ids whose context menu\n   *   should be deactivated.\n   */\n  #deactivateDivIdsContextMenu(divIds) {\n    for (const divId of divIds) {\n      const element = document.querySelector('#' + divId);\n      if (!element) {\n        return;\n      }\n      element.addEventListener('contextmenu', (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n      });\n    }\n  }\n\n  /**\n   * Reactivates the context menu on all dwv div ids.\n   *\n   * @param {string[]} divIds The div ids whose context menu\n   *   should be reactivated.\n   */\n  #reactivateDivIdsContextMenu(divIds) {\n    for (const divId of divIds) {\n      const element = document.querySelector('#' + divId);\n      if (!element) {\n        return;\n      }\n      element.addEventListener('contextmenu', (_event) => {\n        // Intentionally empty\n      });\n    }\n  }\n\n  /**\n   * Set the tool live features.\n   * See the documentation of the class members for details.\n   *\n   * @param {object} features The list of features.\n   */\n  setFeatures(features) {\n    if (typeof features.brushSizeRange !== 'undefined') {\n      this.#brushSizeRange = features.brushSizeRange;\n    }\n    if (\n      typeof features.brushSize !== 'undefined' &&\n      features.brushSize >= this.#brushSizeRange.min &&\n      features.brushSize < this.#brushSizeRange.max\n    ) {\n      this.#brushSize = features.brushSize;\n    }\n\n    if (typeof features.brushMode !== 'undefined') {\n      this.#brushMode = features.brushMode;\n    }\n\n    // createMask is needed since not all properties are always needed,\n    // maskDataId could be undefined for example when\n    // just changing the brushSize\n    if (features.createMask) {\n      this.#maskDataId = undefined;\n    } else if (typeof features.maskDataId !== 'undefined') {\n      this.#maskDataId = features.maskDataId;\n    }\n\n    // used in draw events\n    if (typeof features.selectedSegmentNumber !== 'undefined') {\n      this.#selectedSegmentNumber = features.selectedSegmentNumber;\n    }\n\n    if (typeof features.blacklist !== 'undefined') {\n      this.#blacklist = features.blacklist;\n    }\n  }\n\n  /**\n   * Initialise the tool.\n   */\n  init() {\n    // does nothing\n  }\n\n  /**\n   * Get the list of event names that this tool can fire.\n   *\n   * @returns {Array} The list of event names.\n   */\n  getEventNames() {\n    return [\n      'brushdraw',\n      'brushremove',\n      'brushsizechange',\n      'erasingactivated',\n      'erasingdeactivated'\n    ];\n  }\n\n  /**\n   * Help for this tool.\n   *\n   * @returns {object} The help content.\n   */\n  getHelpKeys() {\n    return {\n      title: 'tool.Brush.name',\n      brief: 'tool.Brush.brief',\n      mouse: {\n        mouse_click: 'tool.Brush.mouse_click'\n      },\n      touch: {\n        touch_click: 'tool.Brush.touch_click'\n      }\n    };\n  }\n} // Brush class\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point2D} from '../math/point.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Path shape.\n */\nexport class Path {\n\n  /**\n   * @param {Point2D[]} [inputPointArray] The list of Point2D that make\n   *   the path (optional).\n   * @param {number[]} [inputControlPointIndexArray] The list of control\n   *  point of path, as indexes (optional).\n   * Note: first and last point do not need to be equal.\n   */\n  constructor(inputPointArray, inputControlPointIndexArray) {\n    /**\n     * List of points.\n     *\n     * @type {Point2D[]}\n     */\n    this.pointArray = inputPointArray ? inputPointArray.slice() : [];\n    /**\n     * List of control points.\n     *\n     * @type {number[]}\n     */\n    this.controlPointIndexArray = inputControlPointIndexArray\n      ? inputControlPointIndexArray.slice() : [];\n  }\n\n  /**\n   * Get a point of the list.\n   *\n   * @param {number} index The index of the point\n   *   to get (beware, no size check).\n   * @returns {Point2D} The Point2D at the given index.\n   */\n  getPoint(index) {\n    return this.pointArray[index];\n  }\n\n  /**\n   * Is the given point a control point.\n   *\n   * @param {Point2D} point The Point2D to check.\n   * @returns {boolean} True if a control point.\n   */\n  isControlPoint(point) {\n    const index = this.pointArray.indexOf(point);\n    if (index !== -1) {\n      return this.controlPointIndexArray.indexOf(index) !== -1;\n    } else {\n      throw new Error('Error: isControlPoint called with not in list point.');\n    }\n  }\n\n  /**\n   * Get the length of the path.\n   *\n   * @returns {number} The length of the path.\n   */\n  getLength() {\n    return this.pointArray.length;\n  }\n\n  /**\n   * Add a point to the path.\n   *\n   * @param {Point2D} point The Point2D to add.\n   */\n  addPoint(point) {\n    this.pointArray.push(point);\n  }\n\n  /**\n   * Add a control point to the path.\n   *\n   * @param {Point2D} point The Point2D to make a control point.\n   */\n  addControlPoint(point) {\n    const index = this.pointArray.indexOf(point);\n    if (index !== -1) {\n      this.controlPointIndexArray.push(index);\n    } else {\n      throw new Error(\n        'Cannot mark a non registered point as control point.');\n    }\n  }\n\n  /**\n   * Add points to the path.\n   *\n   * @param {Point2D[]} newPointArray The list of Point2D to add.\n   */\n  addPoints(newPointArray) {\n    this.pointArray = this.pointArray.concat(newPointArray);\n  }\n\n  /**\n   * Append a Path to this one.\n   *\n   * @param {Path} other The Path to append.\n   */\n  appenPath(other) {\n    const oldSize = this.pointArray.length;\n    this.pointArray = this.pointArray.concat(other.pointArray);\n    const indexArray = [];\n    for (let i = 0; i < other.controlPointIndexArray.length; ++i) {\n      indexArray[i] = other.controlPointIndexArray[i] + oldSize;\n    }\n    this.controlPointIndexArray =\n      this.controlPointIndexArray.concat(indexArray);\n  }\n\n} // Path class\n","/**\n * Circular Bucket Queue.\n *\n * Returns input'd points in sorted order. All operations run in roughly O(1)\n * time (for input with small cost values), but it has a strict requirement:\n *\n * If the most recent point had a cost of c, any points added should have a cost\n * c' in the range c <= c' <= c + (capacity - 1).\n */\nexport class BucketQueue {\n\n  /**\n   * @param {number} bits Number of bits.\n   * @param {Function} cost_functor The cost functor.\n   */\n  constructor(bits, cost_functor) {\n    this.bucketCount = 1 << bits; // # of buckets = 2^bits\n    this.mask = this.bucketCount - 1; // 2^bits - 1 = index mask\n    this.size = 0;\n\n    this.loc = 0; // Current index in bucket list\n    // Cost defaults to item value\n    this.cost = (typeof (cost_functor) !== 'undefined')\n      ? cost_functor : function (item) {\n        return item;\n      };\n    this.buckets = this.buildArray(this.bucketCount);\n  }\n\n  push(item) {\n    // Prepend item to the list in the appropriate bucket\n    const bucket = this.getBucket(item);\n    item.next = this.buckets[bucket];\n    this.buckets[bucket] = item;\n\n    this.size++;\n  }\n\n  pop() {\n    if (this.size === 0) {\n      throw new Error('Cannot pop, bucketQueue is empty.');\n    }\n\n    // Find first empty bucket\n    while (this.buckets[this.loc] === null) {\n      this.loc = (this.loc + 1) % this.bucketCount;\n    }\n\n    // All items in bucket have same cost, return the first one\n    const ret = this.buckets[this.loc];\n    this.buckets[this.loc] = ret.next;\n    ret.next = null;\n\n    this.size--;\n    return ret;\n  }\n\n  // TODO: needs at least two items...\n  remove(item) {\n    // Tries to remove item from queue. Returns true on success, false otherwise\n    if (!item) {\n      return false;\n    }\n\n    // To find node, go to bucket and search through unsorted list.\n    const bucket = this.getBucket(item);\n    let node = this.buckets[bucket];\n\n    while (node !== null &&\n      !(node.next !== null &&\n        item.x === node.next.x &&\n        item.y === node.next.y)) {\n      node = node.next;\n    }\n\n    if (node === null) {\n      // Item not in list, ergo item not in queue\n      return false;\n    } else {\n      // Found item, do standard list node deletion\n      node.next = node.next.next;\n\n      this.size--;\n      return true;\n    }\n  }\n\n  isEmpty() {\n    return this.size === 0;\n  }\n\n  getBucket(item) {\n    // Bucket index is the masked cost\n    return this.cost(item) & this.mask;\n  }\n\n  buildArray(newSize) {\n    // Create array and initialze pointers to null\n    const buckets = new Array(newSize);\n\n    for (let i = 0; i < buckets.length; i++) {\n      buckets[i] = null;\n    }\n\n    return buckets;\n  }\n\n} // class BucketQueue\n","import {BucketQueue} from '../math/bucketQueue.js';\n\n// Pre-created to reduce allocation in inner loops\nconst __twothirdpi = (2 / (3 * Math.PI));\n\n/**\n * Compute grey scale.\n *\n * @param {Array} data The input data.\n * @param {number} width The width of the output.\n * @param {number} height The height of the output.\n * @returns {object} A greyscale object.\n */\nfunction computeGreyscale(data, width, height) {\n  // Returns 2D augmented array containing greyscale data\n  // Greyscale values found by averaging colour channels\n  // Input should be in a flat RGBA array, with values between 0 and 255\n  const greyscale = {\n    data: []\n  };\n\n  // Compute actual values\n  for (let y = 0; y < height; y++) {\n    greyscale.data[y] = [];\n\n    for (let x = 0; x < width; x++) {\n      const p = (y * width + x) * 4;\n      greyscale.data[y][x] = (data[p] + data[p + 1] + data[p + 2]) / (3 * 255);\n    }\n  }\n\n  // Augment with convenience functions\n  greyscale.dx = function (x, y) {\n    if (x + 1 === this.data[y].length) {\n      // If we're at the end, back up one\n      x--;\n    }\n    return this.data[y][x + 1] - this.data[y][x];\n  };\n\n  greyscale.dy = function (x, y) {\n    if (y + 1 === this.data.length) {\n      // If we're at the end, back up one\n      y--;\n    }\n    return this.data[y][x] - this.data[y + 1][x];\n  };\n\n  greyscale.gradMagnitude = function (x, y) {\n    const dx = this.dx(x, y);\n    const dy = this.dy(x, y);\n    return Math.sqrt(dx * dx + dy * dy);\n  };\n\n  greyscale.laplace = function (x, y) {\n    // Laplacian of Gaussian\n    let lap = -16 * this.data[y][x];\n    lap += this.data[y - 2][x];\n    lap += this.data[y - 1][x - 1] +\n      2 * this.data[y - 1][x] +\n      this.data[y - 1][x + 1];\n    lap += this.data[y][x - 2] +\n      2 * this.data[y][x - 1] +\n      2 * this.data[y][x + 1] +\n      this.data[y][x + 2];\n    lap += this.data[y + 1][x - 1] +\n      2 * this.data[y + 1][x] +\n      this.data[y + 1][x + 1];\n    lap += this.data[y + 2][x];\n\n    return lap;\n  };\n\n  return greyscale;\n}\n\n/**\n * Compute gradient.\n *\n * @param {object} greyscale The input greyscale.\n * @returns {object} A gradient object.\n */\nfunction computeGradient(greyscale) {\n  // Returns a 2D array of gradient magnitude values for greyscale. The values\n  // are scaled between 0 and 1, and then flipped, so that it works as a cost\n  // function.\n  const gradient = [];\n\n  let max = 0; // Maximum gradient found, for scaling purposes\n\n  let x = 0;\n  let y = 0;\n\n  for (y = 0; y < greyscale.data.length - 1; y++) {\n    gradient[y] = [];\n\n    for (x = 0; x < greyscale.data[y].length - 1; x++) {\n      gradient[y][x] = greyscale.gradMagnitude(x, y);\n      max = Math.max(gradient[y][x], max);\n    }\n\n    gradient[y][greyscale.data[y].length - 1] =\n      gradient[y][greyscale.data.length - 2];\n  }\n\n  gradient[greyscale.data.length - 1] = [];\n  for (let i = 0; i < gradient[0].length; i++) {\n    gradient[greyscale.data.length - 1][i] =\n      gradient[greyscale.data.length - 2][i];\n  }\n\n  // Flip and scale.\n  for (y = 0; y < gradient.length; y++) {\n    for (x = 0; x < gradient[y].length; x++) {\n      // @ts-ignore\n      gradient[y][x] = 1 - (gradient[y][x] / max);\n    }\n  }\n\n  return gradient;\n}\n\n/**\n * @param {object} greyscale The input greyscale.\n * @returns {object} A laplace object.\n */\nfunction computeLaplace(greyscale) {\n  // Returns a 2D array of Laplacian of Gaussian values\n  const laplace = [];\n\n  // Make the edges low cost here.\n\n  laplace[0] = [];\n  laplace[1] = [];\n  for (let i = 1; i < greyscale.data.length; i++) {\n    // Pad top, since we can't compute Laplacian\n    laplace[0][i] = 1;\n    laplace[1][i] = 1;\n  }\n\n  for (let y = 2; y < greyscale.data.length - 2; y++) {\n    laplace[y] = [];\n    // Pad left, ditto\n    laplace[y][0] = 1;\n    laplace[y][1] = 1;\n\n    for (let x = 2; x < greyscale.data[y].length - 2; x++) {\n      // Threshold needed to get rid of clutter.\n      laplace[y][x] = (greyscale.laplace(x, y) > 0.33) ? 0 : 1;\n    }\n\n    // Pad right, ditto\n    laplace[y][greyscale.data[y].length - 2] = 1;\n    laplace[y][greyscale.data[y].length - 1] = 1;\n  }\n\n  laplace[greyscale.data.length - 2] = [];\n  laplace[greyscale.data.length - 1] = [];\n  for (let j = 1; j < greyscale.data.length; j++) {\n    // Pad bottom, ditto\n    laplace[greyscale.data.length - 2][j] = 1;\n    laplace[greyscale.data.length - 1][j] = 1;\n  }\n\n  return laplace;\n}\n\n/**\n * Compute the X gradient.\n *\n * @param {object} greyscale The values.\n * @returns {Array} The gradient.\n */\nfunction computeGradX(greyscale) {\n  // Returns 2D array of x-gradient values for greyscale\n  const gradX = [];\n\n  for (let y = 0; y < greyscale.data.length; y++) {\n    gradX[y] = [];\n\n    for (let x = 0; x < greyscale.data[y].length - 1; x++) {\n      gradX[y][x] = greyscale.dx(x, y);\n    }\n\n    gradX[y][greyscale.data[y].length - 1] =\n      gradX[y][greyscale.data[y].length - 2];\n  }\n\n  return gradX;\n}\n\n/**\n * Compute the Y gradient.\n *\n * @param {object} greyscale The values.\n * @returns {Array} The gradient.\n */\nfunction computeGradY(greyscale) {\n  // Returns 2D array of y-gradient values for greyscale\n  const gradY = [];\n\n  for (let y = 0; y < greyscale.data.length - 1; y++) {\n    gradY[y] = [];\n\n    for (let x = 0; x < greyscale.data[y].length; x++) {\n      gradY[y][x] = greyscale.dy(x, y);\n    }\n  }\n\n  gradY[greyscale.data.length - 1] = [];\n  for (let i = 0; i < greyscale.data[0].length; i++) {\n    gradY[greyscale.data.length - 1][i] = gradY[greyscale.data.length - 2][i];\n  }\n\n  return gradY;\n}\n\n/**\n * Compute the gradient unit vector.\n *\n * @param {Array} gradX The X gradient.\n * @param {Array} gradY The Y gradient.\n * @param {number} px The point X.\n * @param {number} py The point Y.\n * @param {object} out The result.\n */\nfunction gradUnitVector(gradX, gradY, px, py, out) {\n  // Returns the gradient vector at (px,py), scaled to a magnitude of 1\n  const ox = gradX[py][px];\n  const oy = gradY[py][px];\n\n  let gvm = Math.sqrt(ox * ox + oy * oy);\n  gvm = Math.max(gvm, 1e-100); // To avoid possible divide-by-0 errors\n\n  out.x = ox / gvm;\n  out.y = oy / gvm;\n}\n\n/**\n * Compute the gradient direction.\n *\n * @param {Array} gradX The X gradient.\n * @param {Array} gradY The Y gradient.\n * @param {number} px The point X.\n * @param {number} py The point Y.\n * @param {number} qx The q X.\n * @param {number} qy The q Y.\n * @returns {number} The direction.\n */\nfunction gradDirection(gradX, gradY, px, py, qx, qy) {\n  const __dgpuv = {x: -1, y: -1};\n  const __gdquv = {x: -1, y: -1};\n  // Compute the gradiant direction, in radians, between to points\n  gradUnitVector(gradX, gradY, px, py, __dgpuv);\n  gradUnitVector(gradX, gradY, qx, qy, __gdquv);\n\n  let dp = __dgpuv.y * (qx - px) - __dgpuv.x * (qy - py);\n  let dq = __gdquv.y * (qx - px) - __gdquv.x * (qy - py);\n\n  // Make sure dp is positive, to keep things consistant\n  if (dp < 0) {\n    dp = -dp;\n    dq = -dq;\n  }\n\n  if (px !== qx && py !== qy) {\n    // We're going diagonally between pixels\n    dp *= Math.SQRT1_2;\n    dq *= Math.SQRT1_2;\n  }\n\n  return __twothirdpi * (Math.acos(dp) + Math.acos(dq));\n}\n\n/**\n * Compute the sides.\n *\n * @param {number} dist The distance.\n * @param {Array} gradX The X gradient.\n * @param {Array} gradY The Y gradient.\n * @param {object} greyscale The value.\n * @returns {object} The sides.\n */\nfunction computeSides(dist, gradX, gradY, greyscale) {\n  // Returns 2 2D arrays, containing inside and outside greyscale values.\n  // These greyscale values are the intensity just a little bit along the\n  // gradient vector, in either direction, from the supplied point. These\n  // values are used when using active-learning Intelligent Scissors\n\n  const sides = {};\n  sides.inside = [];\n  sides.outside = [];\n\n  const guv = {x: -1, y: -1}; // Current gradient unit vector\n\n  for (let y = 0; y < gradX.length; y++) {\n    sides.inside[y] = [];\n    sides.outside[y] = [];\n\n    for (let x = 0; x < gradX[y].length; x++) {\n      gradUnitVector(gradX, gradY, x, y, guv);\n\n      //(x, y) rotated 90 = (y, -x)\n\n      let ix = Math.round(x + dist * guv.y);\n      let iy = Math.round(y - dist * guv.x);\n      let ox = Math.round(x - dist * guv.y);\n      let oy = Math.round(y + dist * guv.x);\n\n      ix = Math.max(Math.min(ix, gradX[y].length - 1), 0);\n      ox = Math.max(Math.min(ox, gradX[y].length - 1), 0);\n      iy = Math.max(Math.min(iy, gradX.length - 1), 0);\n      oy = Math.max(Math.min(oy, gradX.length - 1), 0);\n\n      sides.inside[y][x] = greyscale.data[iy][ix];\n      sides.outside[y][x] = greyscale.data[oy][ox];\n    }\n  }\n\n  return sides;\n}\n\n/**\n * Gaussian blur an input buffer.\n *\n * @param {Array} buffer The input buffer.\n * @param {Array} out The result.\n */\nfunction gaussianBlur(buffer, out) {\n  // Smooth values over to fill in gaps in the mapping\n  out[0] = 0.4 * buffer[0] + 0.5 * buffer[1] + 0.1 * buffer[1];\n  out[1] = 0.25 * buffer[0] + 0.4 * buffer[1] + 0.25 * buffer[2] +\n    0.1 * buffer[3];\n\n  for (let i = 2; i < buffer.length - 2; i++) {\n    out[i] = 0.05 * buffer[i - 2] + 0.25 * buffer[i - 1] +\n      0.4 * buffer[i] + 0.25 * buffer[i + 1] + 0.05 * buffer[i + 2];\n  }\n\n  const len = buffer.length;\n  out[len - 2] = 0.25 * buffer[len - 1] + 0.4 * buffer[len - 2] +\n    0.25 * buffer[len - 3] + 0.1 * buffer[len - 4];\n  out[len - 1] = 0.4 * buffer[len - 1] + 0.5 * buffer[len - 2] +\n    0.1 * buffer[len - 3];\n}\n\n/**\n * Scissors.\n *\n * Ref: Eric N. Mortensen, William A. Barrett, Interactive Segmentation with\n *   Intelligent Scissors, Graphical Models and Image Processing, Volume 60,\n *   Issue 5, September 1998, Pages 349-384, ISSN 1077-3169,\n *   DOI: 10.1006/gmip.1998.0480.\n *\n * See: {@link http://www.sciencedirect.com/science/article/B6WG4-45JB8WN-9/2/6fe59d8089fd1892c2bfb82283065579}.\n *\n * Highly inspired from: {@link http://code.google.com/p/livewire-javascript/}.\n */\nexport class Scissors {\n\n  constructor() {\n    this.width = -1;\n    this.height = -1;\n\n    this.curPoint = null; // Corrent point we're searching on.\n    this.searchGranBits = 8; // Bits of resolution for BucketQueue.\n    this.searchGran = 1 << this.searchGranBits; //bits.\n    this.pointsPerPost = 500;\n\n    // Precomputed image data. All in ranges 0 >= x >= 1 and\n    //   all inverted (1 - x).\n    this.greyscale = null; // Greyscale of image\n    this.laplace = null; // Laplace zero-crossings (either 0 or 1).\n    this.gradient = null; // Gradient magnitudes.\n    this.gradX = null; // X-differences.\n    this.gradY = null; // Y-differences.\n\n    // Matrix mapping point => parent along shortest-path to root.\n    this.parents = null;\n\n    this.working = false; // Currently computing shortest paths?\n\n    // Begin Training:\n    this.trained = false;\n    this.trainingPoints = null;\n\n    this.edgeWidth = 2;\n    this.trainingLength = 32;\n\n    this.edgeGran = 256;\n    this.edgeTraining = null;\n\n    this.gradPointsNeeded = 32;\n    this.gradGran = 1024;\n    this.gradTraining = null;\n\n    this.insideGran = 256;\n    this.insideTraining = null;\n\n    this.outsideGran = 256;\n    this.outsideTraining = null;\n  }\n  // End Training\n\n\n  // Begin training methods //\n  getTrainingIdx(granularity, value) {\n    return Math.round((granularity - 1) * value);\n  }\n\n  getTrainedEdge(edge) {\n    return this.edgeTraining[this.getTrainingIdx(this.edgeGran, edge)];\n  }\n\n  getTrainedGrad(grad) {\n    return this.gradTraining[this.getTrainingIdx(this.gradGran, grad)];\n  }\n\n  getTrainedInside(inside) {\n    return this.insideTraining[this.getTrainingIdx(this.insideGran, inside)];\n  }\n\n  getTrainedOutside(outside) {\n    return this.outsideTraining[this.getTrainingIdx(this.outsideGran, outside)];\n  }\n  // End training methods //\n\n  setWorking(working) {\n    // Sets working flag\n    this.working = working;\n  }\n\n  setDimensions(width, height) {\n    this.width = width;\n    this.height = height;\n  }\n\n  setData(data) {\n    if (this.width === -1 || this.height === -1) {\n      // The width and height should have already been set\n      throw new Error('Dimensions have not been set.');\n    }\n\n    this.greyscale = computeGreyscale(data, this.width, this.height);\n    this.laplace = computeLaplace(this.greyscale);\n    this.gradient = computeGradient(this.greyscale);\n    this.gradX = computeGradX(this.greyscale);\n    this.gradY = computeGradY(this.greyscale);\n\n    const sides = computeSides(\n      this.edgeWidth, this.gradX, this.gradY, this.greyscale);\n    this.inside = sides.inside;\n    this.outside = sides.outside;\n    this.edgeTraining = [];\n    this.gradTraining = [];\n    this.insideTraining = [];\n    this.outsideTraining = [];\n  }\n\n  findTrainingPoints(p) {\n    // Grab the last handful of points for training\n    const points = [];\n\n    if (this.parents !== null) {\n      for (let i = 0; i < this.trainingLength && p; i++) {\n        points.push(p);\n        p = this.parents[p.y][p.x];\n      }\n    }\n\n    return points;\n  }\n\n  resetTraining() {\n    this.trained = false; // Training is ignored with this flag set\n  }\n\n  doTraining(p) {\n    // Compute training weights and measures\n    this.trainingPoints = this.findTrainingPoints(p);\n\n    if (this.trainingPoints.length < 8) {\n      return; // Not enough points, I think. It might crash if length = 0.\n    }\n\n    const buffer = [];\n    this.calculateTraining(\n      buffer, this.edgeGran, this.greyscale, this.edgeTraining);\n    this.calculateTraining(\n      buffer, this.gradGran, this.gradient, this.gradTraining);\n    this.calculateTraining(\n      buffer, this.insideGran, this.inside, this.insideTraining);\n    this.calculateTraining(\n      buffer, this.outsideGran, this.outside, this.outsideTraining);\n\n    if (this.trainingPoints.length < this.gradPointsNeeded) {\n      // If we have two few training points, the gradient weight map might not\n      // be smooth enough, so average with normal weights.\n      this.addInStaticGrad(this.trainingPoints.length, this.gradPointsNeeded);\n    }\n\n    this.trained = true;\n  }\n\n  calculateTraining(\n    buffer, granularity, input, output) {\n    let i = 0;\n    // Build a map of raw-weights to trained-weights by favoring input values\n    buffer.length = granularity;\n    for (i = 0; i < granularity; i++) {\n      buffer[i] = 0;\n    }\n\n    let maxVal = 1;\n    for (i = 0; i < this.trainingPoints.length; i++) {\n      const p = this.trainingPoints[i];\n      const idx = this.getTrainingIdx(granularity, input[p.y][p.x]);\n      buffer[idx] += 1;\n\n      maxVal = Math.max(maxVal, buffer[idx]);\n    }\n\n    // Invert and scale.\n    for (i = 0; i < granularity; i++) {\n      buffer[i] = 1 - buffer[i] / maxVal;\n    }\n\n    // Blur it, as suggested. Gets rid of static.\n    gaussianBlur(buffer, output);\n  }\n\n  addInStaticGrad(have, need) {\n    // Average gradient raw-weights to trained-weights map with standard weight\n    // map so that we don't end up with something to spiky\n    for (let i = 0; i < this.gradGran; i++) {\n      this.gradTraining[i] = Math.min(\n        this.gradTraining[i],\n        1 - i * (need - have) / (need * this.gradGran)\n      );\n    }\n  }\n\n  gradDirection(px, py, qx, qy) {\n    return gradDirection(this.gradX, this.gradY, px, py, qx, qy);\n  }\n\n  dist(px, py, qx, qy) {\n    // The grand culmunation of most of the code: the weighted distance function\n    let grad = this.gradient[qy][qx];\n\n    if (px === qx || py === qy) {\n      // The distance is Euclidean-ish; non-diagonal edges should be shorter\n      grad *= Math.SQRT1_2;\n    }\n\n    const lap = this.laplace[qy][qx];\n    const dir = this.gradDirection(px, py, qx, qy);\n\n    if (this.trained) {\n      // Apply training magic\n      const gradT = this.getTrainedGrad(grad);\n      const edgeT = this.getTrainedEdge(this.greyscale.data[py][px]);\n      const insideT = this.getTrainedInside(this.inside[py][px]);\n      const outsideT = this.getTrainedOutside(this.outside[py][px]);\n\n      return 0.3 * gradT + 0.3 * lap + 0.1 * (dir + edgeT + insideT + outsideT);\n    } else {\n      // Normal weights\n      return 0.43 * grad + 0.43 * lap + 0.11 * dir;\n    }\n  }\n\n  adj(p) {\n    const list = [];\n\n    const sx = Math.max(p.x - 1, 0);\n    const sy = Math.max(p.y - 1, 0);\n    const ex = Math.min(p.x + 1, this.greyscale.data[0].length - 1);\n    const ey = Math.min(p.y + 1, this.greyscale.data.length - 1);\n\n    let idx = 0;\n    for (let y = sy; y <= ey; y++) {\n      for (let x = sx; x <= ex; x++) {\n        if (x !== p.x || y !== p.y) {\n          list[idx++] = {x: x, y: y};\n        }\n      }\n    }\n\n    return list;\n  }\n\n  #costFunction = (p) => {\n    return Math.round(this.searchGran * this.cost[p.y][p.x]);\n  };\n\n  setPoint(sp) {\n    this.setWorking(true);\n\n    this.curPoint = sp;\n\n    let x = 0;\n    let y = 0;\n\n    this.visited = [];\n    for (y = 0; y < this.height; y++) {\n      this.visited[y] = [];\n      for (x = 0; x < this.width; x++) {\n        this.visited[y][x] = false;\n      }\n    }\n\n    this.parents = [];\n    for (y = 0; y < this.height; y++) {\n      this.parents[y] = [];\n    }\n\n    this.cost = [];\n    for (y = 0; y < this.height; y++) {\n      this.cost[y] = [];\n      for (x = 0; x < this.width; x++) {\n        this.cost[y][x] = Number.MAX_VALUE;\n      }\n    }\n    this.cost[sp.y][sp.x] = 0;\n\n    this.pq = new BucketQueue(this.searchGranBits, this.#costFunction);\n    this.pq.push(sp);\n  }\n\n  doWork() {\n    if (!this.working) {\n      return;\n    }\n\n    this.timeout = null;\n\n    let pointCount = 0;\n    const newPoints = [];\n    while (!this.pq.isEmpty() && pointCount < this.pointsPerPost) {\n      const p = this.pq.pop();\n      newPoints.push(p);\n      newPoints.push(this.parents[p.y][p.x]);\n\n      this.visited[p.y][p.x] = true;\n\n      const adjList = this.adj(p);\n      for (let i = 0; i < adjList.length; i++) {\n        const q = adjList[i];\n\n        const pqCost = this.cost[p.y][p.x] + this.dist(p.x, p.y, q.x, q.y);\n\n        if (pqCost < this.cost[q.y][q.x]) {\n          if (this.cost[q.y][q.x] !== Number.MAX_VALUE) {\n            // Already in PQ, must remove it so we can re-add it.\n            this.pq.remove(q);\n          }\n\n          this.cost[q.y][q.x] = pqCost;\n          this.parents[q.y][q.x] = p;\n          this.pq.push(q);\n        }\n      }\n\n      pointCount++;\n    }\n\n    return newPoints;\n  }\n\n} // Scissors class\n","// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point2D} from '../math/point.js';\nimport {Style} from '../gui/style.js';\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Label factory to create and update shape label.\n */\nexport class LabelFactory {\n\n  /**\n   * Default position getter.\n   *\n   * @type {Function}\n   */\n  #defaultPositionGetter;\n\n  /**\n   * @param {Function} positionGetter Default position getter.\n   */\n  constructor(positionGetter) {\n    this.#defaultPositionGetter = positionGetter;\n  }\n\n  /**\n   * Get the annotation label position.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @returns {Point2D} The position.\n   */\n  getPosition(annotation) {\n    let position = annotation.labelPosition;\n    if (typeof position === 'undefined') {\n      position = this.#defaultPositionGetter(annotation);\n    }\n    return position;\n  }\n\n  /**\n   * Creates the konva label.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Label} The Konva label.\n   */\n  create(annotation, style) {\n    // konva text\n    const ktext = new Konva.Text({\n      fontSize: style.getFontSize(),\n      fontFamily: style.getFontFamily(),\n      fill: annotation.colour,\n      padding: style.getTextPadding(),\n      shadowColor: style.getShadowLineColour(),\n      shadowOffset: style.getShadowOffset(),\n      name: 'text'\n    });\n    const labelText = annotation.getText();\n    ktext.setText(labelText);\n\n    // times 2 so that the font size 10 looks like a 10...\n    // (same logic as in the DrawController::updateLabelScale)\n    const zoomScale = style.applyZoomScale(1);\n    const labelScale = {\n      x: 2 * zoomScale.x,\n      y: 2 * zoomScale.y\n    };\n\n    // konva label\n    const labelPosition = this.getPosition(annotation);\n    const klabel = new Konva.Label({\n      x: labelPosition.getX(),\n      y: labelPosition.getY(),\n      scale: labelScale,\n      visible: labelText.length !== 0,\n      name: 'label'\n    });\n    klabel.add(ktext);\n    klabel.add(new Konva.Tag({\n      fill: annotation.colour,\n      opacity: style.getTagOpacity()\n    }));\n\n    return klabel;\n  }\n\n  /**\n   * Update the shape label position.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Group} group The shape group.\n   */\n  updatePosition(annotation, group) {\n    // associated label\n    const klabel = group.getChildren(function (node) {\n      return node.name() === 'label';\n    })[0];\n    if (!(klabel instanceof Konva.Label)) {\n      return;\n    }\n    // update position\n    const labelPosition = this.getPosition(annotation);\n    klabel.position({\n      x: labelPosition.getX(),\n      y: labelPosition.getY()\n    });\n  }\n\n  /**\n   * Get the anchors positions for the label.\n   *\n   * @param {Konva.Label} label The label.\n   * @returns {Point2D[]} The connectors positions.\n   */\n  getLabelAnchorsPosition(label) {\n    const lx = label.x();\n    const ly = label.y();\n    const dx = label.width() * label.scale().x;\n    const dy = label.height() * label.scale().y;\n    return [\n      new Point2D(lx + dx / 2, ly),\n      new Point2D(lx, ly + dy / 2),\n      new Point2D(lx + dx / 2, ly + dy),\n      new Point2D(lx + dx, ly + dy / 2),\n    ];\n  }\n\n  /**\n   * Get the two closest points of two points lists.\n   *\n   * @param {Point2D[]} points1 The first point list.\n   * @param {Point2D[]} points2 The second point list.\n   * @returns {Point2D[]} The closests points.\n   */\n  getClosestPoints(points1, points2) {\n    let minDist = points1[0].getDistance(points2[0]);\n    let p1 = points1[0];\n    let p2 = points2[0];\n    for (const point1 of points1) {\n      for (const point2 of points2) {\n        const dist = point1.getDistance(point2);\n        if (dist < minDist) {\n          minDist = dist;\n          p1 = point1;\n          p2 = point2;\n        }\n      }\n    }\n    return [p1, p2];\n  }\n\n  /**\n   * Get the connector between this label and its shape.\n   *\n   * @param {Point2D[]} connectorsPos The shape connectors positions.\n   * @param {Konva.Label} label The label.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Line} The connector.\n   */\n  getConnector(connectorsPos, label, style) {\n    const labelAnchorsPos = this.getLabelAnchorsPosition(label);\n    const anchorPoints = this.getClosestPoints(\n      connectorsPos, labelAnchorsPos);\n    return new Konva.Line({\n      points: [\n        anchorPoints[0].getX(),\n        anchorPoints[0].getY(),\n        anchorPoints[1].getX(),\n        anchorPoints[1].getY()\n      ],\n      stroke: label.getText().fill(),\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      visible: label.visible(),\n      dash: [10, 7],\n      name: 'connector'\n    });\n  }\n\n  /**\n   * Update the connector between a label and its shape.\n   *\n   * @param {Konva.Group} group The associated shape group.\n   * @param {Point2D[]} connectorsPos The shape connectors positions.\n   */\n  updateConnector(group, connectorsPos) {\n    // associated label\n    const klabel = group.getChildren(function (node) {\n      return node.name() === 'label';\n    })[0];\n    if (!(klabel instanceof Konva.Label)) {\n      return;\n    }\n\n    const labelAnchorsPos = this.getLabelAnchorsPosition(klabel);\n\n    const anchors = this.getClosestPoints(connectorsPos, labelAnchorsPos);\n\n    const kconnect = group.getChildren(function (node) {\n      return node.name() === 'connector';\n    })[0];\n    if (!(kconnect instanceof Konva.Line)) {\n      return;\n    }\n\n    kconnect.points([\n      anchors[0].getX(),\n      anchors[0].getY(),\n      anchors[1].getX(),\n      anchors[1].getY()\n    ]);\n  }\n\n  /**\n   * Update the shape label.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Group} group The shape group.\n   */\n  updateContent(annotation, group) {\n    // associated label\n    const klabel = group.getChildren(function (node) {\n      return node.name() === 'label';\n    })[0];\n    if (!(klabel instanceof Konva.Label)) {\n      return;\n    }\n    // update text\n    const text = annotation.getText();\n    const ktext = klabel.getText();\n    ktext.setText(text);\n    // hide if visible and empty\n    if (klabel.visible()) {\n      klabel.visible(text.length !== 0);\n    }\n  }\n\n} // LabelFactory","// doc imports\n/* eslint-disable no-unused-vars */\nimport {Image} from './image.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Threshold an image between an input minimum and maximum.\n */\nexport class ThresholdFilter {\n  /**\n   * Threshold minimum.\n   *\n   * @type {number}\n   */\n  #min = 0;\n\n  /**\n   * Threshold maximum.\n   *\n   * @type {number}\n   */\n  #max = 0;\n\n  /**\n   * Get the threshold minimum.\n   *\n   * @returns {number} The threshold minimum.\n   */\n  getMin() {\n    return this.#min;\n  }\n\n  /**\n   * Set the threshold minimum.\n   *\n   * @param {number} val The threshold minimum.\n   */\n  setMin(val) {\n    this.#min = val;\n  }\n\n  /**\n   * Get the threshold maximum.\n   *\n   * @returns {number} The threshold maximum.\n   */\n  getMax() {\n    return this.#max;\n  }\n\n  /**\n   * Set the threshold maximum.\n   *\n   * @param {number} val The threshold maximum.\n   */\n  setMax(val) {\n    this.#max = val;\n  }\n\n  /**\n   * Get the name of the filter.\n   *\n   * @returns {string} The name of the filter.\n   */\n  getName() {\n    return 'Threshold';\n  }\n\n  /**\n   * Original image.\n   *\n   * @type {Image}\n   */\n  #originalImage = null;\n\n  /**\n   * Set the original image.\n   *\n   * @param {Image} image The original image.\n   */\n  setOriginalImage(image) {\n    this.#originalImage = image;\n  }\n\n  /**\n   * Get the original image.\n   *\n   * @returns {Image} The original image.\n   */\n  getOriginalImage() {\n    return this.#originalImage;\n  }\n\n  /**\n   * Transform the main image using this filter.\n   *\n   * @returns {Image} The transformed image.\n   */\n  update() {\n    const image = this.getOriginalImage();\n    const imageMin = image.getDataRange().min;\n    const threshFunction = (value) => {\n      if (value < this.getMin() || value > this.getMax()) {\n        return imageMin;\n      } else {\n        return value;\n      }\n    };\n    return image.transform(threshFunction);\n  }\n\n} // class Threshold\n\n/**\n * Sharpen an image using a sharpen convolution matrix.\n */\nexport class SharpenFilter {\n  /**\n   * Get the name of the filter.\n   *\n   * @returns {string} The name of the filter.\n   */\n  getName() {\n    return 'Sharpen';\n  }\n\n  /**\n   * Original image.\n   *\n   * @type {Image}\n   */\n  #originalImage = null;\n\n  /**\n   * Set the original image.\n   *\n   * @param {Image} image The original image.\n   */\n  setOriginalImage(image) {\n    this.#originalImage = image;\n  }\n\n  /**\n   * Get the original image.\n   *\n   * @returns {Image} The original image.\n   */\n  getOriginalImage() {\n    return this.#originalImage;\n  }\n\n  /**\n   * Transform the main image using this filter.\n   *\n   * @returns {Image} The transformed image.\n   */\n  update() {\n    const image = this.getOriginalImage();\n    /* eslint-disable @stylistic/js/array-element-newline */\n    return image.convolute2D([\n      0, -1, 0,\n      -1, 5, -1,\n      0, -1, 0\n    ]);\n    /* eslint-enable @stylistic/js/array-element-newline */\n  }\n\n} // class Sharpen\n\n/**\n * Apply a Sobel filter to an image.\n */\nexport class SobelFilter {\n  /**\n   * Get the name of the filter.\n   *\n   * @returns {string} The name of the filter.\n   */\n  getName() {\n    return 'Sobel';\n  }\n\n  /**\n   * Original image.\n   *\n   * @type {Image}\n   */\n  #originalImage = null;\n\n  /**\n   * Set the original image.\n   *\n   * @param {Image} image The original image.\n   */\n  setOriginalImage(image) {\n    this.#originalImage = image;\n  }\n\n  /**\n   * Get the original image.\n   *\n   * @returns {Image} The original image.\n   */\n  getOriginalImage() {\n    return this.#originalImage;\n  }\n\n  /**\n   * Transform the main image using this filter.\n   *\n   * @returns {Image} The transformed image.\n   */\n  update() {\n    const image = this.getOriginalImage();\n    /* eslint-disable @stylistic/js/array-element-newline */\n    const gradX = image.convolute2D([\n      1, 0, -1,\n      2, 0, -2,\n      1, 0, -1\n    ]);\n    const gradY = image.convolute2D([\n      1, 2, 1,\n      0, 0, 0,\n      -1, -2, -1\n    ]);\n    /* eslint-enable @stylistic/js/array-element-newline */\n    return gradX.compose(gradY, function (x, y) {\n      return Math.sqrt(x * x + y * y);\n    });\n  }\n\n} // class Sobel\n","import {ListenerHandler} from '../utils/listen.js';\nimport {\n  ThresholdFilter,\n  SobelFilter,\n  SharpenFilter\n} from '../image/filter.js';\nimport {Command} from '../utils/undoStack.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Filter tool.\n */\nexport class Filter {\n\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n  }\n\n  /**\n   * Filter list.\n   *\n   * @type {object}\n   */\n  #filterList = null;\n\n  /**\n   * Selected filter.\n   *\n   * @type {object}\n   */\n  #selectedFilter = 0;\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Activate the tool.\n   *\n   * @param {boolean} bool Flag to activate or not.\n   */\n  activate(bool) {\n    // setup event listening\n    for (const key in this.#filterList) {\n      if (bool) {\n        this.#filterList[key].addEventListener('filterrun', this.#fireEvent);\n        this.#filterList[key].addEventListener('filterundo', this.#fireEvent);\n      } else {\n        this.#filterList[key].removeEventListener(\n          'filterrun', this.#fireEvent);\n        this.#filterList[key].removeEventListener(\n          'filterundo', this.#fireEvent);\n      }\n    }\n  }\n\n  /**\n   * Set the tool options.\n   *\n   * @param {object} options The list of filter names amd classes.\n   */\n  setOptions(options) {\n    this.#filterList = {};\n    // try to instanciate filters from the options\n    for (const key in options) {\n      this.#filterList[key] = new options[key](this.#app);\n    }\n  }\n\n  /**\n   * Get the type of tool options: here 'instance' since the filter\n   * list contains instances of each possible filter.\n   *\n   * @returns {string} The type.\n   */\n  getOptionsType() {\n    return 'instance';\n  }\n\n  /**\n   * Initialise the filter. Called once the image is loaded.\n   */\n  init() {\n    // setup event listening\n    for (const key in this.#filterList) {\n      this.#filterList[key].init();\n    }\n  }\n\n  /**\n   * Handle keydown event.\n   *\n   * @param {object} event The keydown event.\n   */\n  keydown = (event) => {\n    event.context = 'Filter';\n    this.#app.onKeydown(event);\n  };\n\n  /**\n   * Get the list of event names that this tool can fire.\n   *\n   * @returns {string[]} The list of event names.\n   */\n  getEventNames() {\n    return ['filterrun', 'filterundo'];\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    this.#listenerHandler.fireEvent(event);\n  };\n\n  /**\n   * Get the selected filter.\n   *\n   * @returns {object} The selected filter.\n   */\n  getSelectedFilter() {\n    return this.#selectedFilter;\n  }\n\n  /**\n   * Set the tool live features: filter name.\n   *\n   * @param {object} features The list of features.\n   */\n  setFeatures(features) {\n    if (typeof features.filterName !== 'undefined') {\n      // check if we have it\n      if (!this.hasFilter(features.filterName)) {\n        throw new Error('Unknown filter: \\'' + features.filterName + '\\'');\n      }\n      // de-activate last selected\n      if (this.#selectedFilter) {\n        this.#selectedFilter.activate(false);\n      }\n      // enable new one\n      this.#selectedFilter = this.#filterList[features.filterName];\n      // activate the selected filter\n      this.#selectedFilter.activate(true);\n    }\n    if (typeof features.run !== 'undefined' && features.run) {\n      let args = {};\n      if (typeof features.runArgs !== 'undefined') {\n        args = features.runArgs;\n      }\n      this.getSelectedFilter().run(args);\n    }\n  }\n\n  /**\n   * Get the list of filters.\n   *\n   * @returns {Array} The list of filter objects.\n   */\n  getFilterList() {\n    return this.#filterList;\n  }\n\n  /**\n   * Check if a filter is in the filter list.\n   *\n   * @param {string} name The name to check.\n   * @returns {string} The filter list element for the given name.\n   */\n  hasFilter(name) {\n    return this.#filterList[name];\n  }\n\n} // class Filter\n\n/**\n * Threshold filter tool.\n */\nexport class Threshold {\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n  }\n\n  /**\n   * Associated filter.\n   *\n   * @type {object}\n   */\n  #filter = new ThresholdFilter();\n\n  /**\n   * Flag to know wether to reset the image or not.\n   *\n   * @type {boolean}\n   */\n  #resetImage = true;\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Activate the filter.\n   *\n   * @param {boolean} bool Flag to activate or not.\n   */\n  activate(bool) {\n    // reset the image when the tool is activated\n    if (bool) {\n      this.#resetImage = true;\n    }\n  }\n\n  /**\n   * Initialise the filter. Called once the image is loaded.\n   */\n  init() {\n    // does nothing\n  }\n\n  /**\n   * Run the filter.\n   *\n   * @param {*} args The filter arguments.\n   */\n  run(args) {\n    if (typeof args.dataId === 'undefined') {\n      throw new Error('No dataId to run threshod filter on.');\n    }\n    this.#filter.setMin(args.min);\n    this.#filter.setMax(args.max);\n    // reset the image if asked\n    if (this.#resetImage) {\n      const image = this.#app.getData(args.dataId).image;\n      this.#filter.setOriginalImage(image);\n      this.#resetImage = false;\n    }\n    const command = new RunFilterCommand(this.#filter, args.dataId, this.#app);\n    command.onExecute = this.#fireEvent;\n    command.onUndo = this.#fireEvent;\n    command.execute();\n    // save command in undo stack\n    this.#app.addToUndoStack(command);\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *  event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    this.#listenerHandler.fireEvent(event);\n  };\n\n} // class Threshold\n\n/**\n * Sharpen filter tool.\n */\nexport class Sharpen {\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n  }\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Activate the filter.\n   *\n   * @param {boolean} _bool Flag to activate or not.\n   */\n  activate(_bool) {\n    // does nothing\n  }\n\n  /**\n   * Initialise the filter. Called once the image is loaded.\n   */\n  init() {\n    // does nothing\n  }\n\n  /**\n   * Run the filter.\n   *\n   * @param {*} args The filter arguments.\n   */\n  run(args) {\n    if (typeof args.dataId === 'undefined') {\n      throw new Error('No dataId to run sharpen filter on.');\n    }\n    const filter = new SharpenFilter();\n    const image = this.#app.getData(args.dataId).image;\n    filter.setOriginalImage(image);\n    const command = new RunFilterCommand(filter, args.dataId, this.#app);\n    command.onExecute = this.#fireEvent;\n    command.onUndo = this.#fireEvent;\n    command.execute();\n    // save command in undo stack\n    this.#app.addToUndoStack(command);\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *    event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    this.#listenerHandler.fireEvent(event);\n  };\n\n} // filter.Sharpen\n\n/**\n * Sobel filter tool.\n */\nexport class Sobel {\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n  }\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Activate the filter.\n   *\n   * @param {boolean} _bool Flag to activate or not.\n   */\n  activate(_bool) {\n    // does nothing\n  }\n\n  /**\n   * Initialise the filter. Called once the image is loaded.\n   */\n  init() {\n    // does nothing\n  }\n\n  /**\n   * Run the filter.\n   *\n   * @param {*} args The filter arguments.\n   */\n  run(args) {\n    if (typeof args.dataId === 'undefined') {\n      throw new Error('No dataId to run sobel filter on.');\n    }\n    const filter = new SobelFilter();\n    const image = this.#app.getData(args.dataId).image;\n    filter.setOriginalImage(image);\n    const command = new RunFilterCommand(filter, args.dataId, this.#app);\n    command.onExecute = this.#fireEvent;\n    command.onUndo = this.#fireEvent;\n    command.execute();\n    // save command in undo stack\n    this.#app.addToUndoStack(command);\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *  event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    this.#listenerHandler.fireEvent(event);\n  };\n\n} // class filter.Sobel\n\n/**\n * Run filter command.\n */\nexport class RunFilterCommand extends Command {\n\n  /**\n   * The filter to run.\n   *\n   * @type {object}\n   */\n  #filter;\n\n  /**\n   * Data id.\n   *\n   * @type {string}\n   */\n  #dataId;\n\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * @param {object} filter The filter to run.\n   * @param {string} dataId The data to filter.\n   * @param {App} app The associated application.\n   */\n  constructor(filter, dataId, app) {\n    super();\n    this.#filter = filter;\n    this.#dataId = dataId;\n    this.#app = app;\n  }\n\n  /**\n   * Get the command name.\n   *\n   * @returns {string} The command name.\n   */\n  getName() {\n    return 'Filter-' + this.#filter.getName();\n  }\n\n  /**\n   * Execute the command.\n   *\n   * @fires RunFilterCommand#filterrun\n   */\n  execute() {\n    // run filter and set app image\n    this.#app.setImage(this.#dataId, this.#filter.update());\n    // update display\n    this.#app.render(this.#dataId);\n    /**\n     * Filter run event.\n     *\n     * @event RunFilterCommand#filterrun\n     * @type {object}\n     * @property {string} type The event type: filterrun.\n     * @property {number} id The id of the run command.\n     */\n    const event = {\n      type: 'filterrun',\n      id: this.getName(),\n      dataId: this.#dataId\n    };\n    // callback\n    this.onExecute(event);\n  }\n\n  /**\n   * Undo the command.\n   *\n   * @fires RunFilterCommand#filterundo\n   */\n  undo() {\n    // reset the image\n    this.#app.setImage(this.#dataId, this.#filter.getOriginalImage());\n    // update display\n    this.#app.render(this.#dataId);\n    /**\n     * Filter undo event.\n     *\n     * @event RunFilterCommand#filterundo\n     * @type {object}\n     * @property {string} type The event type: filterundo.\n     * @property {number} id The id of the undone run command.\n     */\n    const event = {\n      type: 'filterundo',\n      id: this.getName(),\n      dataid: this.#dataId\n    }; // callback\n    this.onUndo(event);\n  }\n\n  /**\n   * Handle an execute event.\n   *\n   * @param {object} _event The execute event with type and id.\n   */\n  onExecute(_event) {\n    // default does nothing.\n  }\n\n  /**\n   * Handle an undo event.\n   *\n   * @param {object} _event The undo event with type and id.\n   */\n  onUndo(_event) {\n    // default does nothing.\n  }\n\n} // RunFilterCommand class\n","import {WindowLevel} from './windowLevel.js';\nimport {Scroll} from './scroll.js';\nimport {ZoomAndPan} from './zoomPan.js';\nimport {Opacity} from './opacity.js';\nimport {Draw} from './draw.js';\nimport {Brush} from './brush.js';\nimport {Floodfill} from './floodfill.js';\nimport {Livewire} from './livewire.js';\n\nimport {ArrowFactory} from './arrow.js';\nimport {CircleFactory} from './circle.js';\nimport {EllipseFactory} from './ellipse.js';\nimport {ProtractorFactory} from './protractor.js';\nimport {RectangleFactory} from './rectangle.js';\nimport {RoiFactory} from './roi.js';\nimport {RulerFactory} from './ruler.js';\n\nimport {Filter, Threshold, Sobel, Sharpen} from './filter.js';\n\nimport {ScrollWheel} from './scrollWheel.js';\nimport {DrawShapeHandler} from './drawShapeHandler.js';\n\nexport {\n  DrawShapeHandler,\n  ScrollWheel,\n};\n\n/**\n * List of client provided tools to be added to\n * the default ones.\n *\n * @example\n * import {App, AppOptions, ViewConfig, toolList} from '//esm.sh/dwv';\n * // custom tool\n * class AlertTool {\n *   mousedown() {alert('AlertTool mousedown');}\n *   init() {}\n *   activate() {}\n * }\n * // pass it to dwv tool list\n * toolList['Alert'] = AlertTool;\n * // create the dwv app\n * const app = new App();\n * // initialise\n * const viewConfig0 = new ViewConfig('layerGroup0');\n * const viewConfigs = {'*': [viewConfig0]};\n * const options = new AppOptions(viewConfigs);\n * options.tools = {Alert: {}};\n * app.init(options);\n * // activate tool\n * app.addEventListener('load', function () {\n *   app.setTool('Alert');\n * });\n * // load dicom data\n * app.loadURLs([\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\n * ]);\n *\n * @type {Object<string, any>}\n */\nexport const toolList = {};\n\n/**\n * List of client provided tool options to be added to\n * the default ones.\n *\n * @example\n * import {App, AppOptions, ViewConfig, toolOptions, ROI, Point2D}\n *   from '//esm.sh/dwv';\n * // custom factory\n * class LoveFactory {\n *   getName() {return 'love';}\n *   static supports(mathShape) {return mathShape instanceof ROI;}\n *   getNPoints() {return 1;}\n *   getTimeout() {return 0;}\n *   setAnnotationMathShape(annotation, points) {\n *     const px = points[0].getX();\n *     const py = points[0].getY();\n *     annotation.mathShape = new ROI([\n *       new Point2D(px+15,py), new Point2D(px+10,py-10),\n *       new Point2D(px,py), new Point2D(px-10,py-10),\n *       new Point2D(px-15,py), new Point2D(px,py+20)\n *     ]);\n *     annotation.getFactory = function () {return new LoveFactory();}\n *   }\n *   createShapeGroup(annotation, style) {\n *     const roi = annotation.mathShape;\n *     // konva line\n *     const arr = [];\n *     for (let i = 0; i < roi.getLength(); ++i) {\n *       arr.push(roi.getPoint(i).getX());\n *       arr.push(roi.getPoint(i).getY());\n *     }\n *     const shape = new Konva.Line({\n *       name: 'shape', points: arr,\n *       stroke: 'red', strokeWidth: 2,\n *       closed: true\n *     });\n *     // konva group\n *     const group = new Konva.Group();\n *     group.name('love-group');\n *     group.visible(true);\n *     group.id(annotation.trackingUid);\n *     group.add(shape);\n *     return group;\n *   }\n * }\n * // pass it to dwv option list\n * toolOptions['draw'] = {LoveFactory};\n * // create the dwv app\n * const app = new App();\n * // initialise\n * const viewConfig0 = new ViewConfig('layerGroup0');\n * const viewConfigs = {'*': [viewConfig0]};\n * const options = new AppOptions(viewConfigs);\n * options.tools = {Draw: {options: ['Love']}};\n * app.init(options);\n * // activate tool\n * app.addEventListener('load', function () {\n *   app.setTool('Draw');\n *   app.setToolFeatures({shapeName: 'Love'});\n * });\n * // load dicom data\n * app.loadURLs([\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\n * ]);\n *\n * @type {Object<string, Object<string, any>>}\n */\nexport const toolOptions = {};\n\n/**\n * Default tool list.\n *\n * @type {Object<string, any>}\n */\nexport const defaultToolList = {\n  WindowLevel,\n  Scroll,\n  ZoomAndPan,\n  Opacity,\n  Draw,\n  Brush,\n  Filter,\n  Floodfill,\n  Livewire\n};\n\n/**\n * Default tool options.\n *\n * @type {Object<string, Object<string, any>>}\n */\nexport const defaultToolOptions = {\n  draw: {\n    ArrowFactory,\n    CircleFactory,\n    EllipseFactory,\n    ProtractorFactory,\n    RectangleFactory,\n    RoiFactory,\n    RulerFactory\n  },\n  filter: {\n    Threshold,\n    Sobel,\n    Sharpen\n  }\n};","import {ScrollWheel} from './scrollWheel.js';\nimport {\n  getMousePoint,\n  getTouchPoints\n} from '../gui/generic.js';\nimport {getLayerDetailsFromEvent} from '../gui/layerGroup.js';\nimport {\n  WindowLevel as WindowLevelValues\n} from '../image/windowLevel.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\nimport {Point2D} from '../math/point.js';\nimport {LayerGroup} from '../gui/layerGroup.js';\nimport {ViewLayer} from '../gui/viewLayer.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * WindowLevel tool: handle window/level related events.\n *\n * @example\n * import {App, AppOptions, ViewConfig, ToolConfig} from '//esm.sh/dwv';\n * // create the dwv app\n * const app = new App();\n * // initialise\n * const viewConfig0 = new ViewConfig('layerGroup0');\n * const viewConfigs = {'*': [viewConfig0]};\n * const options = new AppOptions(viewConfigs);\n * options.tools = {WindowLevel: new ToolConfig()};\n * app.init(options);\n * // activate tool\n * app.addEventListener('load', function () {\n *   app.setTool('WindowLevel');\n * });\n * // load dicom data\n * app.loadURLs([\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\n * ]);\n */\nexport class WindowLevel {\n\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * Interaction start flag.\n   *\n   * @type {boolean}\n   */\n  #started = false;\n\n  /**\n   * Start point.\n   *\n   * @type {Point2D}\n   */\n  #startPoint;\n\n  /**\n   * Scroll wheel handler.\n   *\n   * @type {ScrollWheel}\n   */\n  #scrollWhell;\n\n  /**\n   * Strict view layer flag: if true, use the active layer\n   * (that could be undefined, ie bail) or, if false,\n   * try to find the active view layer (active layer if view layer or\n   * closest).\n   *\n   * @type {boolean}\n   */\n  #strictViewLayer = true;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n    this.#scrollWhell = new ScrollWheel(app);\n  }\n\n  /**\n   * Get the active view layer. Uses the strictViewLayer flag:\n   * if true, use the active layer (that could be undefined,\n   * ie bail) or, if false, try to find the active view layer.\n   *\n   * @param {LayerGroup} layerGroup The layer group of the view layer.\n   * @returns {ViewLayer|undefined} The layer.\n   */\n  #getActiveViewLayer(layerGroup) {\n    let layer;\n    if (this.#strictViewLayer) {\n      layer = layerGroup.getActiveViewLayer();\n    } else {\n      const callbackFn = function (layer) {\n        return layer.getViewController().isMonochrome();\n      };\n      layer = layerGroup.getViewLayersFromActive(callbackFn)[0];\n    }\n    return layer;\n  }\n\n  /**\n   * Start tool interaction.\n   *\n   * @param {Point2D} point The start point.\n   * @param {string} divId The layer group divId.\n   */\n  #start(point, divId) {\n    // check if possible\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const viewLayer = this.#getActiveViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      return;\n    }\n    const viewController = viewLayer.getViewController();\n    if (!viewController.isMonochrome()) {\n      return;\n    }\n\n    this.#started = true;\n    this.#startPoint = point;\n  }\n\n  /**\n   * Update tool interaction.\n   *\n   * @param {Point2D} point The update point.\n   * @param {string} divId The layer group divId.\n   */\n  #update(point, divId) {\n    // check start flag\n    if (!this.#started) {\n      return;\n    }\n\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const viewLayer = this.#getActiveViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      return;\n    }\n    const viewController = viewLayer.getViewController();\n\n    // difference to last position\n    const diffX = point.getX() - this.#startPoint.getX();\n    const diffY = this.#startPoint.getY() - point.getY();\n    // data range\n    const range = viewController.getImageRescaledDataRange();\n    // 1/1000 to match existing solutions\n    const pixelToIntensity = (range.max - range.min) * 0.001;\n\n    // calculate new window level\n    const center = viewController.getWindowLevel().center;\n    const width = viewController.getWindowLevel().width;\n    const windowCenter = center + (diffY * pixelToIntensity);\n    const windowWidth = width + (diffX * pixelToIntensity);\n\n    // set (will validate values)\n    const wl = new WindowLevelValues(windowCenter, windowWidth);\n    viewController.setWindowLevel(wl);\n\n    // store position\n    this.#startPoint = point;\n  }\n\n  /**\n   * Finish tool interaction.\n   */\n  #finish() {\n    if (this.#started) {\n      this.#started = false;\n    }\n  }\n\n  /**\n   * Handle mouse down event.\n   *\n   * @param {object} event The mouse down event.\n   */\n  mousedown = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#start(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse move event.\n   *\n   * @param {object} event The mouse move event.\n   */\n  mousemove = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse up event.\n   *\n   * @param {object} _event The mouse up event.\n   */\n  mouseup = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle mouse out event.\n   *\n   * @param {object} _event The mouse out event.\n   */\n  mouseout = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle touch start event.\n   *\n   * @param {object} event The touch start event.\n   */\n  touchstart = (event) => {\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#start(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch move event.\n   *\n   * @param {object} event The touch move event.\n   */\n  touchmove = (event) => {\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch end event.\n   *\n   * @param {object} _event The touch end event.\n   */\n  touchend = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle double click event.\n   *\n   * @param {object} event The double click event.\n   */\n  dblclick = (event) => {\n    const layerDetails = getLayerDetailsFromEvent(event);\n    const mousePoint = getMousePoint(event);\n\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\n    const viewLayer = this.#getActiveViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      return;\n    }\n    const index = viewLayer.displayToPlaneIndex(mousePoint);\n    const viewController = viewLayer.getViewController();\n    // exit if not possible\n    if (!viewController.isMonochrome()) {\n      return;\n    }\n\n    // update view controller\n    const image = this.#app.getData(viewLayer.getDataId()).image;\n    const wl = new WindowLevelValues(\n      image.getRescaledValueAtIndex(\n        viewController.getCurrentIndex().getWithNew2D(\n          index.get(0),\n          index.get(1)\n        )\n      ),\n      viewController.getWindowLevel().width\n    );\n    viewController.setWindowLevel(wl);\n  };\n\n  /**\n   * Handle mouse wheel event.\n   *\n   * @param {WheelEvent} event The mouse wheel event.\n   */\n  wheel = (event) => {\n    this.#scrollWhell.wheel(event);\n  };\n\n  /**\n   * Handle key down event.\n   *\n   * @param {object} event The key down event.\n   */\n  keydown = (event) => {\n    event.context = 'WindowLevel';\n    this.#app.onKeydown(event);\n  };\n\n  /**\n   * Activate the tool.\n   *\n   * @param {boolean} _bool The flag to activate or not.\n   */\n  activate(_bool) {\n    // does nothing\n  }\n\n  /**\n   * Initialise the tool.\n   */\n  init() {\n    // does nothing\n  }\n\n  /**\n   * Set the tool live features.\n   *\n   * @param {object} features The list of features.\n   */\n  setFeatures(features) {\n    if (typeof features.strictViewLayer !== 'undefined') {\n      this.#strictViewLayer = features.strictViewLayer;\n    }\n  }\n\n} // WindowLevel class\n","import {getLayerDetailsFromEvent} from '../gui/layerGroup.js';\nimport {\n  getMousePoint,\n  getTouchPoints\n} from '../gui/generic.js';\nimport {ScrollWheel} from './scrollWheel.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\nimport {Point2D} from '../math/point.js';\nimport {LayerGroup} from '../gui/layerGroup.js';\nimport {ViewLayer} from '../gui/viewLayer.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Scroll class.\n *\n * @example\n * import {App, AppOptions, ViewConfig, ToolConfig} from '//esm.sh/dwv';\n * // create the dwv app\n * const app = new App();\n * // initialise\n * const viewConfig0 = new ViewConfig('layerGroup0');\n * const viewConfigs = {'*': [viewConfig0]};\n * const options = new AppOptions(viewConfigs);\n * options.tools = {Scroll: new ToolConfig()};\n * app.init(options);\n * // activate tool\n * app.addEventListener('load', function () {\n *   app.setTool('Scroll');\n * });\n * // load dicom data\n * app.loadURLs([\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm',\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323707.dcm',\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323563.dcm'\n * ]);\n * @example <caption>Example with slider</caption>\n * import {App, AppOptions, ViewConfig, ToolConfig, Index} from '//esm.sh/dwv';\n * // create the dwv app\n * const app = new App();\n * // initialise\n * const viewConfig0 = new ViewConfig('layerGroup0');\n * const viewConfigs = {'*': [viewConfig0]};\n * const options = new AppOptions(viewConfigs);\n * options.tools = {Scroll: new ToolConfig()};\n * app.init(options);\n * // create range\n * const range = document.createElement('input');\n * range.type = 'range';\n * range.min = 0;\n * range.id = 'sliceRange';\n * document.body.appendChild(range);\n * // update app on slider change\n * range.oninput = function () {\n *   const lg = app.getLayerGroupByDivId('layerGroup0');\n *   const vl = lg.getBaseViewLayer();\n *   const vc = vl.getViewController();\n *   const index = vc.getCurrentIndex();\n *   const values = index.getValues();\n *   values[2] = this.value;\n *   vc.setCurrentIndex(new Index(values));\n * }\n * // activate tool and update range max on load\n * app.addEventListener('load', function () {\n *   app.setTool('Scroll');\n *   const size = app.getData(0).image.getGeometry().getSize();\n *   range.max = size.get(2) - 1;\n * });\n * // update slider on slice change (for ex via mouse wheel)\n * app.addEventListener('positionchange', function () {\n *   const lg = app.getLayerGroupByDivId('layerGroup0');\n *   const vl = lg.getBaseViewLayer();\n *   const vc = vl.getViewController();\n *   range.value = vc.getCurrentIndex().get(2);\n * });\n * // load dicom data\n * app.loadURLs([\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm',\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323707.dcm',\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323563.dcm'\n * ]);\n */\nexport class Scroll {\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * Interaction start flag.\n   *\n   * @type {boolean}\n   */\n  #started = false;\n\n  /**\n   * Start point.\n   *\n   * @type {Point2D}\n   */\n  #startPoint;\n\n  /**\n   * Scroll wheel handler.\n   *\n   * @type {ScrollWheel}\n   */\n  #scrollWhell;\n\n  /**\n   * Touch timer ID (created by setTimeout).\n   *\n   * @type {number}\n   */\n  #touchTimerID;\n\n  /**\n   * Option to show or not a value tooltip on mousemove.\n   *\n   * @type {boolean}\n   */\n  #displayTooltip = false;\n\n  /**\n   * Current layer group div id.\n   *\n   * @type {string}\n   */\n  #currentDivId;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n    this.#scrollWhell = new ScrollWheel(app);\n  }\n\n  /**\n   * Get the associated view layer.\n   *\n   * @param {LayerGroup} layerGroup The layer group to search.\n   * @returns {ViewLayer|undefined} The view layer.\n   */\n  #getViewLayer(layerGroup) {\n    let viewLayer = layerGroup.getActiveViewLayer();\n    if (typeof viewLayer === 'undefined') {\n      const drawLayer = layerGroup.getActiveDrawLayer();\n      if (typeof drawLayer === 'undefined') {\n        logger.warn('No draw layer to do scroll');\n        return;\n      }\n      viewLayer = layerGroup.getViewLayerById(\n        drawLayer.getReferenceLayerId());\n    }\n    return viewLayer;\n  }\n\n  /**\n   * Start tool interaction.\n   *\n   * @param {Point2D} point The start point.\n   * @param {string} divId The layer group divId.\n   */\n  #start(point, divId) {\n    // optional tooltip\n    this.#removeTooltipDiv();\n\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const viewLayer = this.#getViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to start scroll');\n      return;\n    }\n\n    const viewController = viewLayer.getViewController();\n\n    // stop auto scroll if playing\n    if (viewController.isPlaying()) {\n      viewController.stop();\n    }\n    // update base controller position\n    const planePos = viewLayer.displayToPlanePos(point);\n    const position = viewController.getPositionFromPlanePoint(planePos);\n    viewController.setCurrentPosition(position);\n\n    // start flag\n    this.#started = true;\n    this.#startPoint = point;\n\n  }\n\n  /**\n   * Update tool interaction.\n   *\n   * @param {Point2D} point The update point.\n   * @param {string} divId The layer group divId.\n   */\n  #update(point, divId) {\n    if (!this.#started) {\n      // optional tooltip\n      if (this.#displayTooltip) {\n        this.#showTooltip(point, divId);\n      }\n      return;\n    }\n\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const positionHelper = layerGroup.getPositionHelper();\n\n    // difference to last Y position\n    const diffY = point.getY() - this.#startPoint.getY();\n    const yMove = (Math.abs(diffY) > 15);\n    // difference to last X position\n    const diffX = point.getX() - this.#startPoint.getX();\n    const xMove = (Math.abs(diffX) > 15);\n\n    // do not trigger for small moves\n    if (yMove && layerGroup.canScroll()) {\n      // update view controller\n      if (diffY > 0) {\n        positionHelper.decrementPositionAlongScroll();\n      } else {\n        positionHelper.incrementPositionAlongScroll();\n      }\n    } else if (xMove && layerGroup.moreThanOne(3)) {\n      // update view controller\n      if (diffX > 0) {\n        positionHelper.incrementPosition(3);\n      } else {\n        positionHelper.decrementPosition(3);\n      }\n    }\n\n    // reset origin point\n    if (xMove || yMove) {\n      this.#startPoint = point;\n    }\n  }\n\n  /**\n   * Finish tool interaction.\n   */\n  #finish() {\n    if (this.#started) {\n      this.#started = false;\n    }\n  }\n\n  /**\n   * Handle mouse down event.\n   *\n   * @param {object} event The mouse down event.\n   */\n  mousedown = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#start(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse move event.\n   *\n   * @param {object} event The mouse move event.\n   */\n  mousemove = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse up event.\n   *\n   * @param {object} _event The mouse up event.\n   */\n  mouseup = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle mouse out event.\n   *\n   * @param {object} _event The mouse out event.\n   */\n  mouseout = (_event) => {\n    this.#finish();\n    // remove possible tooltip div\n    this.#removeTooltipDiv();\n  };\n\n  /**\n   * Handle touch start event.\n   *\n   * @param {object} event The touch start event.\n   */\n  touchstart = (event) => {\n    // long touch triggers the dblclick\n    // @ts-ignore\n    this.#touchTimerID = setTimeout(() => {\n      this.dblclick(event);\n    }, 500);\n    // call start\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#start(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch move event.\n   *\n   * @param {object} event The touch move event.\n   */\n  touchmove = (event) => {\n    // abort timer if move\n    if (this.#touchTimerID !== null) {\n      clearTimeout(this.#touchTimerID);\n      this.#touchTimerID = null;\n    }\n    // call update\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch end event.\n   *\n   * @param {object} _event The touch end event.\n   */\n  touchend = (_event) => {\n    // abort timer\n    if (this.#touchTimerID !== null) {\n      clearTimeout(this.#touchTimerID);\n      this.#touchTimerID = null;\n    }\n    // call mouse equivalent\n    this.#finish();\n  };\n\n  /**\n   * Handle mouse wheel event.\n   *\n   * @param {WheelEvent} event The mouse wheel event.\n   */\n  wheel = (event) => {\n    this.#scrollWhell.wheel(event);\n  };\n\n  /**\n   * Handle key down event.\n   *\n   * @param {object} event The key down event.\n   */\n  keydown = (event) => {\n    event.context = 'Scroll';\n    this.#app.onKeydown(event);\n  };\n\n  /**\n   * Handle double click.\n   *\n   * @param {object} event The key down event.\n   */\n  dblclick = (event) => {\n    const layerDetails = getLayerDetailsFromEvent(event);\n\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\n    const viewLayer = layerGroup.getActiveViewLayer();\n    if (typeof viewLayer !== 'undefined') {\n      const viewController = viewLayer.getViewController();\n      viewController.play();\n    }\n  };\n\n  /**\n   * Display a tooltip at the given point.\n   *\n   * @param {Point2D} point The update point.\n   * @param {string} divId The layer group divId.\n   */\n  #showTooltip(point, divId) {\n    // get layer group\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    this.#currentDivId = divId;\n    // show new tooltip\n    layerGroup.showTooltip(point);\n  }\n\n  /**\n   * Remove the last tooltip html div.\n   */\n  #removeTooltipDiv() {\n    if (typeof this.#currentDivId !== 'undefined') {\n      const layerGroup = this.#app.getLayerGroupByDivId(this.#currentDivId);\n      layerGroup.removeTooltipDiv();\n      this.#currentDivId = undefined;\n    }\n  }\n\n  /**\n   * Activate the tool.\n   *\n   * @param {boolean} _bool The flag to activate or not.\n   */\n  activate(_bool) {\n    // remove tooltip html when deactivating\n    if (!_bool) {\n      this.#removeTooltipDiv();\n    }\n  }\n\n  /**\n   * Set the tool live features: disaply tooltip.\n   *\n   * @param {object} features The list of features.\n   */\n  setFeatures(features) {\n    if (typeof features.displayTooltip !== 'undefined') {\n      this.#displayTooltip = features.displayTooltip;\n    }\n  }\n\n  /**\n   * Initialise the tool.\n   */\n  init() {\n    // does nothing\n  }\n\n} // Scroll class\n","import {Point2D} from '../math/point.js';\nimport {Line} from '../math/line.js';\nimport {getLayerDetailsFromEvent} from '../gui/layerGroup.js';\nimport {\n  getMousePoint,\n  getTouchPoints\n} from '../gui/generic.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\nimport {LayerGroup} from '../gui/layerGroup.js';\nimport {ViewLayer} from '../gui/viewLayer.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * ZoomAndPan class.\n *\n * @example\n * import {App, AppOptions, ViewConfig, ToolConfig} from '//esm.sh/dwv';\n * // create the dwv app\n * const app = new App();\n * // initialise\n * const viewConfig0 = new ViewConfig('layerGroup0');\n * const viewConfigs = {'*': [viewConfig0]};\n * const options = new AppOptions(viewConfigs);\n * options.tools = {ZoomAndPan: new ToolConfig()};\n * app.init(options);\n * // activate tool\n * app.addEventListener('load', function () {\n *   app.setTool('ZoomAndPan');\n * });\n * // load dicom data\n * app.loadURLs([\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\n * ]);\n */\nexport class ZoomAndPan {\n\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * Interaction start flag.\n   *\n   * @type {boolean}\n   */\n  #started = false;\n\n  /**\n   * Start point.\n   *\n   * @type {Point2D}\n   */\n  #startPoint;\n\n  /**\n   * Move flag: true if mouse or touch move.\n   *\n   * @type {boolean}\n   */\n  #hasMoved;\n\n  /**\n   * Line between input points.\n   *\n   * @type {Line}\n   */\n  #pointsLine;\n\n  /**\n   * PointsLine midpoint.\n   *\n   * @type {Point2D}\n   */\n  #midPoint;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n  }\n\n  /**\n   * Get the associated view layer.\n   *\n   * @param {LayerGroup} layerGroup The layer group to search.\n   * @returns {ViewLayer|undefined} The view layer.\n   */\n  #getViewLayer(layerGroup) {\n    let viewLayer = layerGroup.getActiveViewLayer();\n    if (typeof viewLayer === 'undefined') {\n      const drawLayer = layerGroup.getActiveDrawLayer();\n      if (typeof drawLayer === 'undefined') {\n        logger.warn('No draw layer to do zoom/pan');\n        return;\n      }\n      viewLayer = layerGroup.getViewLayerById(\n        drawLayer.getReferenceLayerId());\n    }\n    return viewLayer;\n  }\n\n  /**\n   * Start tool interaction.\n   *\n   * @param {Point2D} point The start point.\n   */\n  #start(point) {\n    this.#started = true;\n    this.#startPoint = point;\n    this.#hasMoved = false;\n  }\n\n  /**\n   * Two touch start.\n   *\n   * @param {Point2D[]} points The start points.\n   */\n  #twoTouchStart = (points) => {\n    this.#started = true;\n    this.#startPoint = points[0];\n    this.#hasMoved = false;\n    // points line\n    this.#pointsLine = new Line(points[0], points[1]);\n    this.#midPoint = this.#pointsLine.getCentroid();\n  };\n\n  /**\n   * Update tool interaction.\n   *\n   * @param {Point2D} point The update point.\n   * @param {string} divId The layer group divId.\n   */\n  #update(point, divId) {\n    if (!this.#started) {\n      return;\n    }\n    this.#hasMoved = true;\n\n    // calculate translation\n    const tx = point.getX() - this.#startPoint.getX();\n    const ty = point.getY() - this.#startPoint.getY();\n    // apply translation\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const viewLayer = this.#getViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to update zoom/pan');\n      return;\n    }\n    const viewController = viewLayer.getViewController();\n    const planeOffset = viewLayer.displayToPlaneScale(\n      new Point2D(tx, ty)\n    );\n    const offset3D = viewController.getOffset3DFromPlaneOffset({\n      x: planeOffset.getX(),\n      y: planeOffset.getY()\n    });\n    layerGroup.addTranslation({\n      x: offset3D.getX(),\n      y: offset3D.getY(),\n      z: offset3D.getZ()\n    });\n    layerGroup.draw();\n    // reset origin point\n    this.#startPoint = point;\n  }\n\n  /**\n   * Two touch update.\n   *\n   * @param {Point2D[]} points The update points.\n   * @param {string} divId The layer group divId.\n   */\n  #twoTouchUpdate = (points, divId) => {\n    if (!this.#started) {\n      return;\n    }\n    this.#hasMoved = true;\n\n    const newLine = new Line(points[0], points[1]);\n    const lineRatio = newLine.getLength() / this.#pointsLine.getLength();\n\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const positionHelper = layerGroup.getPositionHelper();\n\n    if (lineRatio === 1) {\n      // scroll mode\n      // difference  to last position\n      const diffY = points[0].getY() - this.#startPoint.getY();\n      // do not trigger for small moves\n      if (Math.abs(diffY) < 15) {\n        return;\n      }\n      // update view controller\n      if (layerGroup.canScroll()) {\n        if (diffY > 0) {\n          positionHelper.incrementPositionAlongScroll();\n        } else {\n          positionHelper.decrementPositionAlongScroll();\n        }\n      }\n    } else {\n      // zoom mode\n      const zoom = (lineRatio - 1) / 10;\n      if (Math.abs(zoom) % 0.1 <= 0.05 &&\n        typeof this.#midPoint !== 'undefined') {\n        const viewLayer = this.#getViewLayer(layerGroup);\n        if (typeof viewLayer === 'undefined') {\n          logger.warn('No view layer to do touch zoom/pan');\n          return;\n        }\n        const viewController = viewLayer.getViewController();\n        const planePos = viewLayer.displayToMainPlanePos(this.#midPoint);\n        const center = viewController.getPlanePositionFromPlanePoint(planePos);\n        layerGroup.addScale(zoom, center);\n        layerGroup.draw();\n      }\n    }\n  };\n\n  /**\n   * Set the current position.\n   *\n   * @param {Point2D} point The update point.\n   * @param {string} divId The layer group divId.\n   */\n  #setCurrentPosition(point, divId) {\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const viewLayer = this.#getViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to set current position');\n      return;\n    }\n    const viewController = viewLayer.getViewController();\n    const planePos = viewLayer.displayToPlanePos(point);\n    const position = viewController.getPositionFromPlanePoint(planePos);\n    viewController.setCurrentPosition(position);\n  }\n\n  /**\n   * Finish tool interaction.\n   */\n  #finish() {\n    if (this.#started) {\n      this.#started = false;\n    }\n  }\n\n  /**\n   * Handle mouse down event.\n   *\n   * @param {object} event The mouse down event.\n   */\n  mousedown = (event) => {\n    const mousePoint = getMousePoint(event);\n    this.#start(mousePoint);\n  };\n\n  /**\n   * Handle mouse move event.\n   *\n   * @param {object} event The mouse move event.\n   */\n  mousemove = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse up event.\n   *\n   * @param {object} event The mouse up event.\n   */\n  mouseup = (event) => {\n    // update position if no move\n    if (!this.#hasMoved) {\n      const mousePoint = getMousePoint(event);\n      const layerDetails = getLayerDetailsFromEvent(event);\n      this.#setCurrentPosition(mousePoint, layerDetails.groupDivId);\n    }\n    this.#finish();\n  };\n\n  /**\n   * Handle mouse out event.\n   *\n   * @param {object} _event The mouse out event.\n   */\n  mouseout = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle touch start event.\n   *\n   * @param {object} event The touch start event.\n   */\n  touchstart = (event) => {\n    const touchPoints = getTouchPoints(event);\n    if (touchPoints.length === 1) {\n      this.#start(touchPoints[0]);\n    } else if (touchPoints.length === 2) {\n      this.#twoTouchStart(touchPoints);\n    }\n  };\n\n  /**\n   * Handle touch move event.\n   *\n   * @param {object} event The touch move event.\n   */\n  touchmove = (event) => {\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    if (touchPoints.length === 1) {\n      this.#update(touchPoints[0], layerDetails.groupDivId);\n    } else if (touchPoints.length === 2) {\n      this.#twoTouchUpdate(touchPoints, layerDetails.groupDivId);\n    }\n  };\n\n  /**\n   * Handle touch end event.\n   *\n   * @param {object} event The touch end event.\n   */\n  touchend = (event) => {\n    // update position if no move\n    if (!this.#hasMoved) {\n      const mousePoint = getMousePoint(event);\n      const layerDetails = getLayerDetailsFromEvent(event);\n      this.#setCurrentPosition(mousePoint, layerDetails.groupDivId);\n    }\n    this.#finish();\n  };\n\n  /**\n   * Handle mouse wheel event.\n   *\n   * @param {object} event The mouse wheel event.\n   */\n  wheel = (event) => {\n    // prevent default page scroll\n    event.preventDefault();\n\n    const step = -event.deltaY / 500;\n\n    const layerDetails = getLayerDetailsFromEvent(event);\n    const mousePoint = getMousePoint(event);\n\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\n    const viewLayer = this.#getViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to do wheel zoom/pan');\n      return;\n    }\n    const viewController = viewLayer.getViewController();\n    const planePos = viewLayer.displayToMainPlanePos(mousePoint);\n    const center = viewController.getPlanePositionFromPlanePoint(planePos);\n    layerGroup.addScale(step, center);\n    layerGroup.draw();\n  };\n\n  /**\n   * Handle key down event.\n   *\n   * @param {object} event The key down event.\n   */\n  keydown = (event) => {\n    event.context = 'ZoomAndPan';\n    this.#app.onKeydown(event);\n  };\n\n  /**\n   * Activate the tool.\n   *\n   * @param {boolean} _bool The flag to activate or not.\n   */\n  activate(_bool) {\n    // does nothing\n  }\n\n  /**\n   * Initialise the tool.\n   */\n  init() {\n    // does nothing\n  }\n\n  /**\n   * Set the tool live features: does nothing.\n   *\n   * @param {object} _features The list of features.\n   */\n  setFeatures(_features) {\n    // does nothing\n  }\n\n} // ZoomAndPan class\n","import {getLayerDetailsFromEvent} from '../gui/layerGroup.js';\nimport {ScrollWheel} from './scrollWheel.js';\nimport {\n  getMousePoint,\n  getTouchPoints\n} from '../gui/generic.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\nimport {Point2D} from '../math/point.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Opacity class.\n *\n * @example\n * import {App, AppOptions, ViewConfig, ToolConfig} from '//esm.sh/dwv';\n * // create the dwv app\n * const app = new App();\n * // initialise\n * const viewConfig0 = new ViewConfig('layerGroup0');\n * const viewConfigs = {'*': [viewConfig0]};\n * const options = new AppOptions(viewConfigs);\n * options.tools = {Opacity: new ToolConfig()};\n * app.init(options);\n * // activate tool\n * app.addEventListener('load', function () {\n *   app.setTool('Opacity');\n * });\n * // load dicom data\n * app.loadURLs([\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\n * ]);\n */\nexport class Opacity {\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * Interaction start flag.\n   *\n   * @type {boolean}\n   */\n  #started = false;\n\n  /**\n   * Start point.\n   *\n   * @type {Point2D}\n   */\n  #startPoint;\n\n  /**\n   * Scroll wheel handler.\n   *\n   * @type {ScrollWheel}\n   */\n  #scrollWhell;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n    this.#scrollWhell = new ScrollWheel(app);\n  }\n\n  /**\n   * Start tool interaction.\n   *\n   * @param {Point2D} point The start point.\n   */\n  #start(point) {\n    this.#started = true;\n    this.#startPoint = point;\n  }\n\n  /**\n   * Update tool interaction.\n   *\n   * @param {Point2D} point The update point.\n   * @param {string} divId The layer group divId.\n   */\n  #update(point, divId) {\n    if (!this.#started) {\n      return;\n    }\n\n    // difference to last X position\n    const diffX = point.getX() - this.#startPoint.getX();\n    const xMove = (Math.abs(diffX) > 15);\n    // do not trigger for small moves\n    if (xMove) {\n      const layerGroup = this.#app.getLayerGroupByDivId(divId);\n      const layer = layerGroup.getActiveLayer();\n      const op = layer.getOpacity();\n      layer.setOpacity(op + (diffX / 200));\n      layer.draw();\n\n      // reset origin point\n      this.#startPoint = point;\n    }\n  }\n\n  /**\n   * Finish tool interaction.\n   */\n  #finish() {\n    if (this.#started) {\n      this.#started = false;\n    }\n  }\n\n  /**\n   * Handle mouse down event.\n   *\n   * @param {object} event The mouse down event.\n   */\n  mousedown = (event) => {\n    const mousePoint = getMousePoint(event);\n    this.#start(mousePoint);\n  };\n\n  /**\n   * Handle mouse move event.\n   *\n   * @param {object} event The mouse move event.\n   */\n  mousemove = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse up event.\n   *\n   * @param {object} _event The mouse up event.\n   */\n  mouseup = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle mouse out event.\n   *\n   * @param {object} _event The mouse out event.\n   */\n  mouseout = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle touch start event.\n   *\n   * @param {object} event The touch start event.\n   */\n  touchstart = (event) => {\n    const touchPoints = getTouchPoints(event);\n    this.#start(touchPoints[0]);\n  };\n\n  /**\n   * Handle touch move event.\n   *\n   * @param {object} event The touch move event.\n   */\n  touchmove = (event) => {\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch end event.\n   *\n   * @param {object} _event The touch end event.\n   */\n  touchend = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle mouse wheel event.\n   *\n   * @param {object} event The mouse wheel event.\n   */\n  wheel = (event) => {\n    this.#scrollWhell.wheel(event);\n  };\n\n  /**\n   * Handle key down event.\n   *\n   * @param {object} event The key down event.\n   */\n  keydown = (event) => {\n    event.context = 'Opacity';\n    this.#app.onKeydown(event);\n  };\n\n  /**\n   * Activate the tool.\n   *\n   * @param {boolean} _bool The flag to activate or not.\n   */\n  activate(_bool) {\n    // does nothing\n  }\n\n  /**\n   * Initialise the tool.\n   */\n  init() {\n    // does nothing\n  }\n\n  /**\n   * Set the tool live features: does nothing.\n   *\n   * @param {object} _features The list of features.\n   */\n  setFeatures(_features) {\n    // does nothing\n  }\n\n} // Opacity class\n","import {getLayerDetailsFromEvent} from '../gui/layerGroup.js';\nimport {\n  getMousePoint,\n  getTouchPoints\n} from '../gui/generic.js';\nimport {logger} from '../utils/logger.js';\nimport {\n  AddAnnotationCommand,\n  RemoveAnnotationCommand\n} from './drawCommands.js';\nimport {\n  isNodeNameShape,\n} from './drawBounds.js';\nimport {Annotation} from '../image/annotation.js';\nimport {ScrollWheel} from './scrollWheel.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\nimport {Style} from '../gui/style.js';\nimport {LayerGroup} from '../gui/layerGroup.js';\nimport {Point2D} from '../math/point.js';\nimport {DrawLayer} from '../gui/drawLayer.js';\nimport {ViewLayer} from '../gui/viewLayer.js';\nimport {DrawShapeHandler} from './drawShapeHandler.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Drawing tool.\n */\nexport class Draw {\n\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * Scroll wheel handler.\n   *\n   * @type {ScrollWheel}\n   */\n  #scrollWhell;\n\n  /**\n   * Drawing style.\n   *\n   * @type {Style}\n   */\n  #style;\n\n  /**\n   * Interaction start flag.\n   *\n   * @type {boolean}\n   */\n  #isDrawing = false;\n\n  /**\n   * Shape factory list.\n   *\n   * @type {object}\n   */\n  #shapeFactoryList = null;\n\n  /**\n   * Current shape factory.\n   *\n   * @type {object}\n   */\n  #currentFactory = null;\n\n  /**\n   * Current shape group.\n   *\n   * @type {object}\n   */\n  #tmpShapeGroup = null;\n\n  /**\n   * Shape name.\n   *\n   * @type {string}\n   */\n  #shapeName;\n\n  /**\n   * List of points.\n   *\n   * @type {Point2D[]}\n   */\n  #points = [];\n\n  /**\n   * Last selected point.\n   *\n   * @type {Point2D}\n   */\n  #lastPoint = null;\n\n  /**\n   * With scroll flag.\n   *\n   * @type {boolean}\n   */\n  #withScroll = true;\n\n  /**\n   * Reference data validator: function that takes the reference\n   *   image meta data and returns a boolean.\n   *\n   * @type {Function}\n   */\n  #refMetaValidator;\n\n  /**\n   * Draw data validator: function that takes the annotation group\n   *   meta data and returns a boolean.\n   *\n   * @type {Function}\n   */\n  #drawMetaValidator;\n\n  /**\n   * Annotation group meta data to pass to newly created groups.\n   * Array of {concept: string, value: string}.\n   *\n   * @type {object[]}\n   */\n  #annotationGroupMeta;\n\n  /**\n   * Annotation meta data to pass to newly created annotations.\n   * Array of either {concept: DicomCode, value: DicomCode} or\n   *   {concept: DicomCode, value: string}.\n   *\n   * @type {object[]}\n   */\n  #annotationMeta;\n\n  /**\n   * Shape handler: activate listeners on existing shape.\n   *\n   * @type {DrawShapeHandler}\n   */\n  #shapeHandler;\n\n  /**\n   * Auto shape colour: will use defaults colours and\n   * vary them according to the layer.\n   *\n   * @type {boolean}\n   */\n  #autoShapeColour = false;\n\n  /**\n   * Event listeners.\n   */\n  #listeners = {};\n\n  /**\n   * Flag to know if the last added point was made by mouse move.\n   *\n   * @type {boolean}\n   */\n  #lastIsMouseMovePoint = false;\n\n  /**\n   * Callback store to allow attach/detach.\n   *\n   * @type {Array}\n   */\n  #callbackStore = [];\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n    this.#scrollWhell = new ScrollWheel(app);\n    this.#shapeHandler = new DrawShapeHandler(app, this.#fireEvent);\n\n    this.#style = app.getStyle();\n  }\n\n  /**\n   * Check if a draw layer can be created in the given layer group.\n   * Uses the validator provided as feature. Default returns true.\n   *\n   * @param {LayerGroup} layerGroup The layer group\n   *   where to create the draw layer.\n   * @returns {boolean} True if possible.\n   */\n  #canCreateDrawLayer(layerGroup) {\n    let res = true;\n\n    // validate reference meta data\n    if (typeof this.#refMetaValidator !== 'undefined') {\n      const referenceViewLayer = layerGroup.getActiveViewLayer();\n      const dataId = referenceViewLayer.getDataId();\n      const data = this.#app.getData(dataId);\n      const meta = data.image.getMeta();\n      res = this.#refMetaValidator(meta);\n    }\n\n    return res;\n  }\n\n  /**\n   * Check if a draw can be created in the given draw layer.\n   * Uses the validator provided as feature. Default returns true.\n   *\n   * @param {DrawLayer} drawLayer The layer where to create the draw.\n   * @returns {boolean} True if possible.\n   */\n  #canCreateDraw(drawLayer) {\n    let res = true;\n\n    // validate annotation group meta data\n    if (typeof this.#drawMetaValidator !== 'undefined') {\n      const dataId = drawLayer.getDataId();\n      const data = this.#app.getData(dataId);\n      const meta = data.annotationGroup.getMeta();\n      res = this.#drawMetaValidator(meta);\n    }\n\n    return res;\n  }\n\n  /**\n   * Create a draw layer in the given layer group.\n   *\n   * @param {LayerGroup} layerGroup The layer group where to create.\n   * @returns {DrawLayer} The created layer.\n   */\n  #createDrawLayer(layerGroup) {\n    const referenceViewLayer = layerGroup.getActiveViewLayer();\n    const refDataId = referenceViewLayer.getDataId();\n\n    // create new data\n    const data = this.#app.createAnnotationData(refDataId);\n    // add possible meta data\n    if (typeof this.#annotationGroupMeta !== 'undefined') {\n      for (const meta of this.#annotationGroupMeta) {\n        data.annotationGroup.setMetaValue(meta.concept, meta.value);\n      }\n    }\n    // render (will create draw layer)\n    this.#app.addAndRenderAnnotationData(\n      data, layerGroup.getDivId(), refDataId);\n    // get draw layer\n    const drawLayer = layerGroup.getActiveDrawLayer();\n    // set the layer shape handler\n    drawLayer.setShapeHandler(this.#shapeHandler);\n    // set active to bind to toolboxController\n    layerGroup.setActiveLayerByDataId(drawLayer.getDataId());\n\n    return drawLayer;\n  }\n\n  /**\n   * Start tool interaction.\n   *\n   * @param {Point2D} point The start point.\n   * @param {string} divId The layer group divId.\n   */\n  #switchEditOrCreateShapeGroup(point, divId) {\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    let drawLayer = layerGroup.getActiveDrawLayer();\n\n    /**\n     * Draw warn event.\n     *\n     * @event Draw#warn\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {string} message The warning message.\n     */\n\n    if (typeof drawLayer === 'undefined') {\n      // drawLayer creation check\n      if (!this.#canCreateDrawLayer(layerGroup)) {\n        // fire warn if not possible\n        this.#fireEvent({\n          type: 'warn',\n          message: 'Cannot create draw layer, reference meta is invalid'\n        });\n        return;\n      }\n      // create draw layer\n      drawLayer = this.#createDrawLayer(layerGroup);\n    } else {\n      // draw creation check\n      if (!this.#canCreateDraw(drawLayer)) {\n        // fire warn if not possible\n        this.#fireEvent({\n          type: 'warn',\n          message: 'Cannot create draw, data meta is invalid'\n        });\n        return;\n      }\n    }\n\n    // data should exist / be created\n    const data = drawLayer.getDrawController().getAnnotationGroup();\n\n    const stage = drawLayer.getKonvaStage();\n\n    // update scale\n    this.#style.setZoomScale(stage.scale());\n\n    if (data.isEditable()) {\n      // determine if the click happened on an existing shape or not\n      const kshape = stage.getIntersection({\n        x: point.getX(),\n        y: point.getY()\n      });\n      if (kshape) {\n        // select shape for edition\n        this.#selectShapeGroup(drawLayer, kshape);\n      } else {\n        // create new shape\n        this.#startShapeGroupCreation(layerGroup, point);\n      }\n    }\n  }\n\n  /**\n   * Get the associated view layer.\n   *\n   * @param {LayerGroup} layerGroup The layer group to search.\n   * @returns {ViewLayer|undefined} The view layer.\n   */\n  #getViewLayer(layerGroup) {\n    const drawLayer = layerGroup.getActiveDrawLayer();\n    if (typeof drawLayer === 'undefined') {\n      logger.warn('No draw layer to do draw');\n      return;\n    }\n    return layerGroup.getViewLayerById(\n      drawLayer.getReferenceLayerId());\n  }\n\n  /**\n   * Initializes the new shape creation:\n   * - Updates the started variable,\n   * - Gets the factory,\n   * - Initializes the points array.\n   *\n   * @param {LayerGroup} layerGroup The layer group where the user clicks.\n   * @param {Point2D} point The start point where the user clicks.\n   */\n  #startShapeGroupCreation(layerGroup, point) {\n    // disable edition\n    this.#shapeHandler.disableAndResetEditor();\n    this.#setToDrawingState();\n    // store point\n    const viewLayer = this.#getViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to start shape');\n      return;\n    }\n    this.#lastPoint = viewLayer.displayToPlanePos(point);\n    this.#points.push(this.#lastPoint);\n  }\n\n  /**\n   * Sets the variables to drawing state:\n   * - Updates is drawing variable,\n   * - Initializes the current factory,\n   * - Resets points.\n   */\n  #setToDrawingState() {\n    // start storing points\n    this.#isDrawing = true;\n    // set factory\n    this.#currentFactory = new this.#shapeFactoryList[this.#shapeName]();\n    // clear array\n    this.#points = [];\n  }\n\n  /**\n   * Resets the variables to not drawing state:\n   * - Destroys tmp shape group,\n   * - Updates is drawing variable,\n   * - Resets points.\n   */\n  #setToNotDrawingState() {\n    this.#isDrawing = false;\n    this.#points = [];\n  }\n\n  /**\n   * Selects a shape group.\n   *\n   * @param {DrawLayer} drawLayer The draw layer where to draw.\n   * @param {Konva.Shape} kshape The shape that has been selected.\n   */\n  #selectShapeGroup(drawLayer, kshape) {\n    let group = kshape.getParent();\n    // kshape: Konva.Tag -> parent: Konva.Label -> parent: Konva.Group\n    if (kshape instanceof Konva.Tag) {\n      group = group.getParent();\n    }\n    const selectedShape = group.find('.shape')[0];\n    if (!(selectedShape instanceof Konva.Shape)) {\n      return;\n    }\n    /**\n     * Annotation select event.\n     *\n     * @event Draw#annotationselect\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {string} annotationid The annotation id.\n     * @property {string} dataid The data id.\n     */\n    this.#fireEvent({\n      type: 'annotationselect',\n      annotationid: group.id(),\n      dataid: drawLayer.getDataId()\n    });\n    this.#shapeHandler.setEditorShape(selectedShape, drawLayer);\n  }\n\n  /**\n   * Update tool interaction.\n   *\n   * @param {Point2D} point The update point.\n   * @param {string} divId The layer group divId.\n   */\n  #updateShapeGroupCreation(point, divId) {\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const viewLayer = this.#getViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to update shape');\n      return;\n    }\n    const pos = viewLayer.displayToPlanePos(point);\n\n    // validate position\n    const vc = viewLayer.getViewController();\n    if (!vc.validatePlanePoint(pos)) {\n      return;\n    }\n\n    // draw line to current pos\n    if (Math.abs(pos.getX() - this.#lastPoint.getX()) > 0 ||\n      Math.abs(pos.getY() - this.#lastPoint.getY()) > 0) {\n      // clear last mouse move point\n      if (this.#lastIsMouseMovePoint) {\n        this.#points.pop();\n      }\n      // current point\n      this.#lastPoint = pos;\n      // mark it as temporary\n      this.#lastIsMouseMovePoint = true;\n      // add it to the list\n      this.#points.push(this.#lastPoint);\n      // update points\n      this.#onNewPoints(this.#points, layerGroup);\n    }\n  }\n\n  /**\n   * Finish tool interaction.\n   *\n   * @param {string} divId The layer group divId.\n   */\n  #finishShapeGroupCreation(divId) {\n    // exit if no points\n    if (this.#points.length === 0) {\n      logger.warn('Draw mouseup but no points...');\n      return;\n    }\n\n    // do we have all the needed points\n    if (this.#points.length === this.#currentFactory.getNPoints()) {\n      // store points\n      const layerGroup =\n        this.#app.getLayerGroupByDivId(divId);\n      this.#onFinalPoints(this.#points, layerGroup);\n      this.#setToNotDrawingState();\n    }\n\n    // reset mouse move point flag\n    this.#lastIsMouseMovePoint = false;\n  }\n\n  /**\n   * Chack if the base image is resampled.\n   *\n   * @param {MouseEvent} event The mouse down event.\n   * @returns {boolean} True if the image is resampled.\n   */\n  #isResampled(event) {\n    const layerDetails = getLayerDetailsFromEvent(event);\n    const layerGroup = this.#app.getLayerGroupByDivId(\n      layerDetails.groupDivId\n    );\n    const viewLayer = layerGroup.getBaseViewLayer();\n    const referenceDataId = viewLayer.getDataId();\n    const referenceData = this.#app.getData(referenceDataId);\n    const image = referenceData.image;\n\n    return image.isResampled();\n  }\n\n  /**\n   * Handle mouse down event.\n   *\n   * @param {object} event The mouse down event.\n   */\n  mousedown = (event) => {\n    // exit if not started draw\n    if (this.#isDrawing || this.#isResampled(event)) {\n      return;\n    }\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#switchEditOrCreateShapeGroup(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse move event.\n   *\n   * @param {object} event The mouse move event.\n   */\n  mousemove = (event) => {\n    // exit if not started draw\n    if (!this.#isDrawing) {\n      return;\n    }\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#updateShapeGroupCreation(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse up event.\n   *\n   * @param {object} event The mouse up event.\n   */\n  mouseup = (event) => {\n    // exit if not started draw\n    if (!this.#isDrawing) {\n      return;\n    }\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#finishShapeGroupCreation(layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse out event.\n   *\n   * @param {object} event The mouse out event.\n   */\n  mouseout = (event) => {\n    this.mouseup(event);\n  };\n\n  /**\n   * Handle double click event: some tools use it to finish interaction.\n   *\n   * @param {object} event The double click event.\n   */\n  dblclick = (event) => {\n    // only end by double click undefined NPoints\n    if (this.#currentFactory &&\n      typeof this.#currentFactory.getNPoints() !== 'undefined') {\n      return;\n    }\n    // exit if not started draw\n    if (!this.#isDrawing) {\n      return;\n    }\n    // exit if no points\n    if (this.#points.length === 0) {\n      logger.warn('Draw dblclick but no points...');\n      return;\n    }\n\n    // store points\n    const layerDetails = getLayerDetailsFromEvent(event);\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\n    this.#onFinalPoints(this.#points, layerGroup);\n    this.#setToNotDrawingState();\n  };\n\n  /**\n   * Handle touch start event.\n   *\n   * @param {object} event The touch start event.\n   */\n  touchstart = (event) => {\n    // exit if not started draw\n    if (this.#isDrawing) {\n      return;\n    }\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#switchEditOrCreateShapeGroup(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch move event.\n   *\n   * @param {object} event The touch move event.\n   */\n  touchmove = (event) => {\n    // exit if not started draw\n    if (!this.#isDrawing) {\n      return;\n    }\n\n    const layerDetails = getLayerDetailsFromEvent(event);\n    const touchPoints = getTouchPoints(event);\n\n    const layerGroup = this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\n    const viewLayer = this.#getViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to handle touch move');\n      return;\n    }\n    const pos = viewLayer.displayToPlanePos(touchPoints[0]);\n\n    // validate position\n    const vc = viewLayer.getViewController();\n    if (!vc.validatePlanePoint(pos)) {\n      return;\n    }\n\n    if (Math.abs(pos.getX() - this.#lastPoint.getX()) > 0 ||\n      Math.abs(pos.getY() - this.#lastPoint.getY()) > 0) {\n      // clear last added point from the list (but not the first one)\n      if (this.#points.length !== 1) {\n        this.#points.pop();\n      }\n      // current point\n      this.#lastPoint = pos;\n      // add current one to the list\n      this.#points.push(this.#lastPoint);\n      // allow for anchor points\n      if (this.#points.length < this.#currentFactory.getNPoints()) {\n        clearTimeout(this.timer);\n        this.timer = setTimeout(() => {\n          this.#points.push(this.#lastPoint);\n        }, this.#currentFactory.getTimeout());\n      }\n      // update points\n      this.#onNewPoints(this.#points, layerGroup);\n    }\n  };\n\n  /**\n   * Handle touch end event.\n   *\n   * @param {object} event The touch end event.\n   */\n  touchend = (event) => {\n    this.dblclick(event);\n  };\n\n  /**\n   * Handle mouse wheel event.\n   *\n   * @param {WheelEvent} event The mouse wheel event.\n   */\n  wheel = (event) => {\n    if (this.#withScroll) {\n      this.#scrollWhell.wheel(event);\n    }\n  };\n\n  /**\n   * Handle key down event.\n   *\n   * @param {object} event The key down event.\n   */\n  keydown = (event) => {\n    // call app handler if we are not in the middle of a draw\n    if (!this.#isDrawing) {\n      event.context = 'Draw';\n      this.#app.onKeydown(event);\n    }\n\n    // press delete or backspace key\n    const annotation = this.#shapeHandler.getEditorAnnotation();\n    if ((event.key === 'Delete' ||\n      event.key === 'Backspace') &&\n      typeof annotation !== 'undefined') {\n      const layerGroup = this.#app.getActiveLayerGroup();\n      const drawLayer = layerGroup.getActiveDrawLayer();\n      if (typeof drawLayer === 'undefined') {\n        logger.warn('No draw layer to handle key down');\n        return;\n      }\n      const drawController = drawLayer.getDrawController();\n\n      // create remove annotation command\n      const command = new RemoveAnnotationCommand(annotation, drawController);\n      // add command to undo stack\n      this.#app.addToUndoStack(command);\n      // execute command: triggers draw remove\n      command.execute();\n\n      // reset cursor\n      this.#shapeHandler.onMouseOutShapeGroup();\n    }\n\n    // escape key: exit shape creation\n    if (event.key === 'Escape' && this.#tmpShapeGroup !== null) {\n      const konvaLayer = this.#tmpShapeGroup.getLayer();\n      // reset temporary shape group\n      this.#tmpShapeGroup.destroy();\n      this.#tmpShapeGroup = null;\n      // set state\n      this.#setToNotDrawingState();\n      // redraw\n      konvaLayer.draw();\n    }\n  };\n\n  /**\n   * Update the current draw with new points.\n   *\n   * @param {Point2D[]} tmpPoints The array of new points.\n   * @param {LayerGroup} layerGroup The origin layer group.\n   */\n  #onNewPoints(tmpPoints, layerGroup) {\n    // remove temporary shape draw\n    if (this.#tmpShapeGroup) {\n      this.#tmpShapeGroup.destroy();\n      this.#tmpShapeGroup = null;\n    }\n\n    const drawLayer = layerGroup.getActiveDrawLayer();\n    if (typeof drawLayer === 'undefined') {\n      logger.warn('No draw layer to handle new points');\n      return;\n    }\n    const drawController = drawLayer.getDrawController();\n    const konvaLayer = drawLayer.getKonvaLayer();\n    const viewLayer = layerGroup.getViewLayerById(\n      drawLayer.getReferenceLayerId());\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to handle new points');\n      return;\n    }\n    const viewController = viewLayer.getViewController();\n\n    // auto mode: vary shape colour with layer id\n    if (this.#autoShapeColour) {\n      const colours = [\n        '#ffff80', '#ff80ff', '#80ffff', '#80ff80', '8080ff', 'ff8080'\n      ];\n      // warning: depends on layer id nomenclature\n      const drawLayerId = drawLayer.getId();\n      const layerId = drawLayerId.substring(drawLayerId.length - 1);\n      const layerIndex = parseInt(layerId, 10) - 1;\n      const colour = colours[layerIndex];\n      if (typeof colour !== 'undefined') {\n        this.#style.setLineColour(colour);\n      }\n    }\n\n    // create tmp annotation\n    const annotation = new Annotation();\n    // use group colour if defined\n    const groupColour = drawController.getAnnotationGroup().getColour();\n    if (typeof groupColour !== 'undefined') {\n      annotation.colour = groupColour;\n    } else {\n      annotation.colour = this.#style.getLineColour();\n    }\n    annotation.init(viewController);\n    // set annotation shape\n    this.#currentFactory.setAnnotationMathShape(annotation, tmpPoints);\n    // create shape group\n    this.#tmpShapeGroup =\n      this.#currentFactory.createShapeGroup(annotation, this.#style);\n    // set the label visibility\n    drawLayer.setLabelVisibility(this.#tmpShapeGroup);\n\n    // do not listen during creation\n    const shape = this.#tmpShapeGroup.getChildren(isNodeNameShape)[0];\n    shape.listening(false);\n    konvaLayer.listening(false);\n    // draw shape\n    konvaLayer.add(this.#tmpShapeGroup);\n    konvaLayer.draw();\n  }\n\n  /**\n   * Create the final shape from a point list.\n   *\n   * @param {Point2D[]} finalPoints The array of points.\n   * @param {LayerGroup} layerGroup The origin layer group.\n   */\n  #onFinalPoints(finalPoints, layerGroup) {\n    // remove temporary shape draw\n    // (has to be done before sending add event)\n    if (this.#tmpShapeGroup) {\n      this.#tmpShapeGroup.destroy();\n      this.#tmpShapeGroup = null;\n    }\n\n    const drawLayer = layerGroup.getActiveDrawLayer();\n    if (typeof drawLayer === 'undefined') {\n      logger.warn('No draw layer to handle final points');\n      return;\n    }\n    const konvaLayer = drawLayer.getKonvaLayer();\n    const drawController = drawLayer.getDrawController();\n    const viewLayer = layerGroup.getViewLayerById(\n      drawLayer.getReferenceLayerId());\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to handle final points');\n      return;\n    }\n    const viewController = viewLayer.getViewController();\n\n    // create final annotation\n    const annotation = new Annotation();\n    // use group colour if defined\n    const groupColour = drawController.getAnnotationGroup().getColour();\n    if (typeof groupColour !== 'undefined') {\n      annotation.colour = groupColour;\n    } else {\n      annotation.colour = this.#style.getLineColour();\n    }\n    annotation.init(viewController);\n    // meta data\n    if (typeof this.#annotationMeta !== 'undefined') {\n      for (const meta of this.#annotationMeta) {\n        annotation.addMetaItem(meta.concept, meta.value);\n      }\n    }\n\n    // set annotation shape\n    this.#currentFactory.setAnnotationMathShape(annotation, finalPoints);\n\n    // create add annotation command\n    const command = new AddAnnotationCommand(annotation, drawController);\n    // add command to undo stack\n    this.#app.addToUndoStack(command);\n    // execute command: triggers draw creation\n    command.execute();\n\n    // re-activate layer\n    konvaLayer.listening(true);\n  }\n\n  /**\n   * Get a DrawLayer position callback.\n   *\n   * TODO: check need for store item removal.\n   *\n   * @param {DrawLayer} layer The layer to update.\n   * @returns {Function} The callback.\n   */\n  #getPositionCallback(layer) {\n    const layerId = layer.getId();\n    if (typeof this.#callbackStore[layerId] === 'undefined') {\n      this.#callbackStore[layerId] = () => {\n        layer.activateCurrentPositionShapes(true);\n      };\n    }\n    return this.#callbackStore[layerId];\n  }\n\n  /**\n   * Activate a draw layer.\n   *\n   * @param {DrawLayer} drawLayer The layer to update.\n   * @param {boolean} flag The flag to activate or not.\n   */\n  #activateLayer(drawLayer, flag) {\n    drawLayer.setShapeHandler(this.#shapeHandler);\n    drawLayer.activateCurrentPositionShapes(flag);\n    // update on position change\n    if (flag) {\n      this.#app.addEventListener('positionchange',\n        this.#getPositionCallback(drawLayer)\n      );\n    } else {\n      this.#app.removeEventListener('positionchange',\n        this.#getPositionCallback(drawLayer)\n      );\n    }\n  }\n\n  /**\n   * Activate the tool.\n   *\n   * @param {boolean} flag The flag to activate or not.\n   */\n  activate(flag) {\n    // force cursor if deactivate\n    if (!flag) {\n      this.#shapeHandler.onMouseOutShapeGroup();\n    }\n    // update draw layers\n    const drawLayers = this.#app.getDrawLayers();\n    for (const drawLayer of drawLayers) {\n      if (typeof drawLayer !== 'undefined') {\n        this.#activateLayer(drawLayer, flag);\n      }\n    }\n    // activate newly added layers\n    this.#app.addEventListener('drawlayeradd', (event) => {\n      const drawLayers = this.#app.getDrawLayers(function (item) {\n        return item.getId() === event.layerid;\n      });\n      // should be just one\n      if (drawLayers.length === 1) {\n        this.#activateLayer(drawLayers[0], flag);\n      }\n    });\n\n  }\n\n  /**\n   * Set the tool configuration options.\n   *\n   * @param {object} options The list of shape names amd classes.\n   */\n  setOptions(options) {\n    // save the options as the shape factory list\n    this.#shapeFactoryList = options;\n  }\n\n  /**\n   * Get the type of tool options: here 'factory' since the shape\n   * list contains factories to create each possible shape.\n   *\n   * @returns {string} The type.\n   */\n  getOptionsType() {\n    return 'factory';\n  }\n\n  /**\n   * Set the tool live features.\n   *\n   * @param {object} features The list of features.\n   */\n  setFeatures(features) {\n    if (typeof features.autoShapeColour !== 'undefined') {\n      this.#autoShapeColour = features.autoShapeColour;\n    }\n    if (typeof features.shapeColour !== 'undefined') {\n      this.#style.setLineColour(features.shapeColour);\n      this.#autoShapeColour = false;\n    }\n    if (typeof features.shapeName !== 'undefined') {\n      // check if we have it\n      if (!this.hasShape(features.shapeName)) {\n        throw new Error('Unknown shape: \\'' + features.shapeName + '\\'');\n      }\n      this.#shapeName = features.shapeName;\n    }\n    if (typeof features.mouseOverCursor !== 'undefined') {\n      this.#shapeHandler.storeMouseOverCursor(features.mouseOverCursor);\n    }\n    if (typeof features.withScroll !== 'undefined') {\n      this.#withScroll = features.withScroll;\n    }\n    if (typeof features.refMetaValidator !== 'undefined') {\n      this.#refMetaValidator = features.refMetaValidator;\n    }\n    if (typeof features.drawMetaValidator !== 'undefined') {\n      this.#drawMetaValidator = features.drawMetaValidator;\n    }\n    if (typeof features.annotationGroupMeta !== 'undefined') {\n      this.#annotationGroupMeta = features.annotationGroupMeta;\n    }\n    if (typeof features.annotationMeta !== 'undefined') {\n      this.#annotationMeta = features.annotationMeta;\n    }\n  }\n\n  /**\n   * Initialise the tool.\n   */\n  init() {\n    // does nothing\n  }\n\n  /**\n   * Get the list of event names that this tool can fire.\n   *\n   * @returns {string[]} The list of event names.\n   */\n  getEventNames() {\n    return [\n      'annotationupdate', 'annotationselect', 'warn'\n    ];\n  }\n\n  /**\n   * Add an event listener on the app.\n   *\n   * @param {string} type The event type.\n   * @param {Function} listener The function associated with the provided\n   *   event type.\n   */\n  addEventListener(type, listener) {\n    if (typeof this.#listeners[type] === 'undefined') {\n      this.#listeners[type] = [];\n    }\n    this.#listeners[type].push(listener);\n  }\n\n  /**\n   * Remove an event listener from the app.\n   *\n   * @param {string} type The event type.\n   * @param {Function} listener The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, listener) {\n    if (typeof this.#listeners[type] === 'undefined') {\n      return;\n    }\n    for (let i = 0; i < this.#listeners[type].length; ++i) {\n      if (this.#listeners[type][i] === listener) {\n        this.#listeners[type].splice(i, 1);\n      }\n    }\n  }\n\n  // Private Methods -----------------------------------------------------------\n\n  /**\n   * Fire an event: call all associated listeners.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    if (typeof this.#listeners[event.type] === 'undefined') {\n      return;\n    }\n    for (let i = 0; i < this.#listeners[event.type].length; ++i) {\n      this.#listeners[event.type][i](event);\n    }\n  };\n\n  /**\n   * Check if the shape is in the shape list.\n   *\n   * @param {string} name The name of the shape.\n   * @returns {boolean} True if there is a factory for the shape.\n   */\n  hasShape(name) {\n    return typeof this.#shapeFactoryList[name] !== 'undefined';\n  }\n\n} // Draw class\n","import {Annotation} from '../image/annotation.js';\nimport {\n  AddAnnotationCommand,\n  UpdateAnnotationCommand\n} from '../tools/drawCommands.js';\n//import {RoiFactory} from '../tools/roi.js';\nimport {ROI} from '../math/roi.js';\nimport {Point2D} from '../math/point.js';\nimport {Style} from '../gui/style.js';\nimport {\n  getMousePoint,\n  getTouchPoints\n} from '../gui/generic.js';\nimport {getLayerDetailsFromEvent} from '../gui/layerGroup.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\nimport {LayerGroup} from '../gui/layerGroup.js';\nimport {ViewLayer} from '../gui/viewLayer.js';\nimport {Scalar2D} from '../math/scalar.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * The magic wand namespace.\n *\n * Ref: {@link https://github.com/Tamersoul/magic-wand-js}.\n *\n * @external MagicWand\n */\nimport MagicWand from 'magic-wand-tool';\n\n/**\n * Floodfill painting tool.\n */\nexport class Floodfill {\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n  }\n\n  /**\n   * Original variables from external library. Used as in the lib example.\n   *\n   * @type {number}\n   */\n  #blurRadius = 5;\n  /**\n   * Original variables from external library. Used as in the lib example.\n   *\n   * @type {number}\n   */\n  #simplifyTolerant = 0;\n\n  /**\n   * Original variables from external library. Used as in the lib example.\n   *\n   * @type {number}\n   */\n  #simplifyCount = 2000;\n\n  /**\n   * Canvas info.\n   *\n   * @type {object}\n   */\n  #imageInfo = null;\n\n  /**\n   * Object created by MagicWand lib containing border points.\n   *\n   * @type {object}\n   */\n  #mask = null;\n\n  /**\n   * Threshold default tolerance of the tool border.\n   *\n   * @type {number}\n   */\n  #initialthreshold = 10;\n\n  /**\n   * Threshold tolerance of the tool border.\n   *\n   * @type {number}\n   */\n  #currentthreshold = null;\n\n  /**\n   * Interaction start flag.\n   *\n   * @type {boolean}\n   */\n  #started = false;\n\n  /**\n   * Current annotation.\n   *\n   * @type {Annotation}\n   */\n  #annotation;\n\n  /**\n   * Coordinates of the fist mousedown event.\n   *\n   * @type {object}\n   */\n  #initialpoint;\n\n  /**\n   * Floodfill border.\n   *\n   * @type {object}\n   */\n  #border = null;\n\n  /**\n   * List of parent points.\n   *\n   * @type {Point2D[]}\n   */\n  #parentPoints = [];\n\n  /**\n   * Assistant variable to paint border on all slices.\n   *\n   * @type {boolean}\n   */\n  #extender = false;\n\n  /**\n   * Drawing style.\n   *\n   * @type {Style}\n   */\n  #style = new Style();\n\n  /**\n   * Set extend option for painting border on all slices.\n   *\n   * @param {boolean} bool The option to set.\n   */\n  setExtend(bool) {\n    this.#extender = bool;\n  }\n\n  /**\n   * Get extend option for painting border on all slices.\n   *\n   * @returns {boolean} The actual value of of the variable to use Floodfill\n   *   on museup.\n   */\n  getExtend() {\n    return this.#extender;\n  }\n\n  /**\n   * Get the associated view layer.\n   *\n   * @param {LayerGroup} layerGroup The layer group to search.\n   * @returns {ViewLayer|undefined} The view layer.\n   */\n  #getViewLayer(layerGroup) {\n    const drawLayer = layerGroup.getActiveDrawLayer();\n    if (typeof drawLayer === 'undefined') {\n      logger.warn('No draw layer to do floodfill');\n      return;\n    }\n    return layerGroup.getViewLayerById(\n      drawLayer.getReferenceLayerId());\n  }\n\n  /**\n   * Get (x, y) coordinates referenced to the canvas.\n   *\n   * @param {Point2D} point The start point.\n   * @param {string} divId The layer group divId.\n   * @returns {Scalar2D|undefined} The coordinates as a {x,y}.\n   */\n  #getIndex = (point, divId) => {\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const viewLayer = this.#getViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to get index');\n      return;\n    }\n    const index = viewLayer.displayToPlaneIndex(point);\n    return {\n      x: index.get(0),\n      y: index.get(1)\n    };\n  };\n\n  /**\n   * Calculate border.\n   *\n   * @param {object} points The input points.\n   * @param {number} threshold The threshold of the floodfill.\n   * @param {boolean} simple Return first points or a list.\n   * @returns {Point2D[]} The parent points.\n   */\n  #calcBorder(points, threshold, simple) {\n\n    this.#parentPoints = [];\n    const image = {\n      data: this.#imageInfo.data,\n      width: this.#imageInfo.width,\n      height: this.#imageInfo.height,\n      bytes: 4\n    };\n\n    this.#mask = MagicWand.floodFill(image, points.x, points.y, threshold);\n    this.#mask = MagicWand.gaussBlurOnlyBorder(this.#mask, this.#blurRadius);\n\n    let cs = MagicWand.traceContours(this.#mask);\n    cs = MagicWand.simplifyContours(\n      cs, this.#simplifyTolerant, this.#simplifyCount);\n\n    if (cs.length > 0 && cs[0].points[0].x) {\n      if (simple) {\n        return cs[0].points;\n      }\n      for (let j = 0, icsl = cs[0].points.length; j < icsl; j++) {\n        this.#parentPoints.push(new Point2D(\n          cs[0].points[j].x,\n          cs[0].points[j].y\n        ));\n      }\n      return this.#parentPoints;\n    } else {\n      return [];\n    }\n  }\n\n  /**\n   * Paint Floodfill.\n   *\n   * @param {object} point The start point.\n   * @param {number} threshold The border threshold.\n   * @param {LayerGroup} layerGroup The origin layer group.\n   * @returns {boolean} False if no border.\n   */\n  #paintBorder(point, threshold, layerGroup) {\n    // Calculate the border\n    this.#border = this.#calcBorder(point, threshold, false);\n    // Paint the border\n    if (this.#border.length !== 0) {\n      const drawLayer = layerGroup.getActiveDrawLayer();\n      if (typeof drawLayer === 'undefined') {\n        logger.warn('No draw layer to paint border');\n        return false;\n      }\n      const drawController = drawLayer.getDrawController();\n\n      const newMathShape = new ROI(this.#border);\n\n      let command;\n      if (typeof this.#annotation === 'undefined') {\n        // create annotation\n        this.#annotation = new Annotation();\n        this.#annotation.colour = this.#style.getLineColour();\n\n        const viewLayer =\n          layerGroup.getViewLayerById(drawLayer.getReferenceLayerId());\n        if (typeof viewLayer === 'undefined') {\n          logger.warn('No view layer to paint border');\n          return false;\n        }\n        const viewController = viewLayer.getViewController();\n        this.#annotation.init(viewController);\n\n        this.#annotation.mathShape = newMathShape;\n        command = new AddAnnotationCommand(\n          this.#annotation,\n          drawController\n        );\n      } else {\n        // update annotation\n        const originalMathShape = this.#annotation.mathShape;\n        command = new UpdateAnnotationCommand(\n          this.#annotation,\n          {mathShape: originalMathShape},\n          {mathShape: newMathShape},\n          drawController\n        );\n      }\n\n      // add command to undo stack\n      this.#app.addToUndoStack(command);\n      // execute command: triggers draw creation\n      command.execute();\n    }\n\n    return this.#border.length !== 0;\n  }\n\n  /**\n   * Create Floodfill in all the prev and next slices while border is found.\n   *\n   * @param {number} ini The first slice to extend to.\n   * @param {number} end The last slice to extend to.\n   * @param {object} layerGroup The origin layer group.\n   */\n  extend(ini, end, layerGroup) {\n    //avoid errors\n    if (!this.#initialpoint) {\n      throw '\\'initialpoint\\' not found. User must click before use extend!';\n    }\n\n    const positionHelper = layerGroup.getPositionHelper();\n    const viewLayer = this.#getViewLayer(layerGroup);\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to extend floodfill');\n      return;\n    }\n    const viewController = viewLayer.getViewController();\n\n    const pos = viewController.getCurrentIndex();\n    const imageSize = viewController.getImageSize();\n    const threshold = this.#currentthreshold || this.#initialthreshold;\n\n    // Iterate over the next images and paint border on each slice.\n    for (let i = pos.get(2),\n      len = end\n        ? end : imageSize.get(2);\n      i < len; i++) {\n      if (!this.#paintBorder(this.#initialpoint, threshold, layerGroup)) {\n        break;\n      }\n      positionHelper.incrementPositionAlongScroll();\n    }\n    viewController.setCurrentIndex(pos);\n\n    // Iterate over the prev images and paint border on each slice.\n    for (let j = pos.get(2), jl = ini ? ini : 0; j > jl; j--) {\n      if (!this.#paintBorder(this.#initialpoint, threshold, layerGroup)) {\n        break;\n      }\n      positionHelper.decrementPositionAlongScroll();\n    }\n    viewController.setCurrentIndex(pos);\n  }\n\n  /**\n   * Event fired when threshold change.\n   *\n   * @param {number} _value Current threshold.\n   */\n  onThresholdChange(_value) {\n    // Defaults do nothing\n  }\n\n  /**\n   * Chack if the base image is resampled.\n   *\n   * @param {string} divId The layer group divId.\n   * @returns {boolean} True if the image is resampled.\n   */\n  #isResampled(divId) {\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const viewLayer = layerGroup.getBaseViewLayer();\n    const referenceDataId = viewLayer.getDataId();\n    const referenceData = this.#app.getData(referenceDataId);\n    const image = referenceData.image;\n\n    return image.isResampled();\n  }\n\n  /**\n   * Start tool interaction.\n   *\n   * @param {Point2D} point The start point.\n   * @param {string} divId The layer group divId.\n   */\n  #start(point, divId) {\n    if (this.#isResampled(divId)) {\n      return;\n    }\n\n    this.#annotation = undefined;\n\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    let viewLayer;\n    let drawLayer = layerGroup.getActiveDrawLayer();\n\n    if (typeof drawLayer === 'undefined') {\n      viewLayer = layerGroup.getActiveViewLayer();\n      const refDataId = viewLayer.getDataId();\n      // create new data\n      const data = this.#app.createAnnotationData(refDataId);\n      // render (will create draw layer)\n      this.#app.addAndRenderAnnotationData(data, divId, refDataId);\n      // get draw layer\n      drawLayer = layerGroup.getActiveDrawLayer();\n      // set active to bind to toolboxController\n      layerGroup.setActiveLayerByDataId(drawLayer.getDataId());\n    } else {\n      viewLayer = layerGroup.getViewLayerById(\n        drawLayer.getReferenceLayerId());\n      if (typeof viewLayer === 'undefined') {\n        logger.warn('No view layer to start floodfill');\n        return;\n      }\n    }\n\n    this.#imageInfo = viewLayer.getImageData();\n    if (!this.#imageInfo) {\n      logger.error('No image found');\n      return;\n    }\n\n    // update zoom scale\n    this.#style.setZoomScale(\n      drawLayer.getKonvaLayer().getAbsoluteScale());\n\n    this.#started = true;\n    this.#initialpoint = this.#getIndex(point, divId);\n    this.#paintBorder(this.#initialpoint, this.#initialthreshold, layerGroup);\n    this.onThresholdChange(this.#initialthreshold);\n  }\n\n  /**\n   * Update tool interaction.\n   *\n   * @param {Point2D} point The update point.\n   * @param {string} divId The layer group divId.\n   */\n  #update(point, divId) {\n    if (!this.#started) {\n      return;\n    }\n\n    const movedpoint = this.#getIndex(point, divId);\n    this.#currentthreshold = Math.round(Math.sqrt(\n      Math.pow((this.#initialpoint.x - movedpoint.x), 2) +\n      Math.pow((this.#initialpoint.y - movedpoint.y), 2)) / 2);\n    this.#currentthreshold = this.#currentthreshold < this.#initialthreshold\n      ? this.#initialthreshold\n      : this.#currentthreshold - this.#initialthreshold;\n\n    this.#paintBorder(\n      this.#initialpoint,\n      this.#currentthreshold,\n      this.#app.getLayerGroupByDivId(divId)\n    );\n\n    this.onThresholdChange(this.#currentthreshold);\n  }\n\n  /**\n   * Finish tool interaction.\n   */\n  #finish() {\n    if (this.#started) {\n      this.#started = false;\n    }\n  }\n\n  /**\n   * Handle mouse down event.\n   *\n   * @param {object} event The mouse down event.\n   */\n  mousedown = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#start(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse move event.\n   *\n   * @param {object} event The mouse move event.\n   */\n  mousemove = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse up event.\n   *\n   * @param {object} _event The mouse up event.\n   */\n  mouseup = (_event) => {\n    this.#finish();\n    // TODO: re-activate\n    // if (this.#extender) {\n    //   const layerDetails = getLayerDetailsFromEvent(event);\n    //   const layerGroup =\n    //     this.#app.getLayerGroupByDivId(layerDetails.groupDivId);\n    //   this.extend(layerGroup);\n    // }\n  };\n\n  /**\n   * Handle mouse out event.\n   *\n   * @param {object} _event The mouse out event.\n   */\n  mouseout = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle touch start event.\n   *\n   * @param {object} event The touch start event.\n   */\n  touchstart = (event) => {\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#start(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch move event.\n   *\n   * @param {object} event The touch move event.\n   */\n  touchmove = (event) => {\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch end event.\n   *\n   * @param {object} _event The touch end event.\n   */\n  touchend = (_event) => {\n    this.#finish();\n  };\n\n  /**\n   * Handle key down event.\n   *\n   * @param {object} event The key down event.\n   */\n  keydown = (event) => {\n    event.context = 'Floodfill';\n    this.#app.onKeydown(event);\n  };\n\n  /**\n   * Activate the tool.\n   *\n   * @param {boolean} bool The flag to activate or not.\n   */\n  activate(bool) {\n    if (bool) {\n      // init with the app window scale\n      this.#style.setBaseScale(this.#app.getBaseScale());\n      // set the default to the first in the list\n      this.setFeatures({shapeColour: this.#style.getLineColour()});\n    }\n  }\n\n  /**\n   * Initialise the tool.\n   */\n  init() {\n    // does nothing\n  }\n\n  /**\n   * Set the tool live features: shape colour.\n   *\n   * @param {object} features The list of features.\n   */\n  setFeatures(features) {\n    if (typeof features.shapeColour !== 'undefined') {\n      this.#style.setLineColour(features.shapeColour);\n    }\n  }\n\n} // Floodfill class\n","import {Style} from '../gui/style.js';\nimport {\n  getMousePoint,\n  getTouchPoints\n} from '../gui/generic.js';\nimport {Point2D} from '../math/point.js';\nimport {Path} from '../math/path.js';\nimport {Scissors} from '../image/scissors.js';\nimport {getLayerDetailsFromEvent} from '../gui/layerGroup.js';\nimport {logger} from '../utils/logger.js';\nimport {ROI} from '../math/roi.js';\nimport {Annotation} from '../image/annotation.js';\nimport {\n  AddAnnotationCommand,\n  UpdateAnnotationCommand\n} from '../tools/drawCommands.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Livewire painting tool.\n */\nexport class Livewire {\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * @param {App} app The associated application.\n   */\n  constructor(app) {\n    this.#app = app;\n  }\n\n  /**\n   * Interaction start flag.\n   *\n   * @type {boolean}\n   */\n  #started = false;\n\n  /**\n   * Start point.\n   *\n   * @type {Point2D}\n   */\n  #startPoint;\n\n  /**\n   * Current annotation.\n   *\n   * @type {Annotation}\n   */\n  #annotation;\n\n  /**\n   * Drawing style.\n   *\n   * @type {Style}\n   */\n  #style = new Style();\n\n  /**\n   * Path storage. Paths are stored in reverse order.\n   *\n   * @type {Path}\n   */\n  #path = new Path();\n\n  /**\n   * Current path storage. Paths are stored in reverse order.\n   *\n   * @type {Path}\n   */\n  #currentPath = new Path();\n\n  /**\n   * List of parent points.\n   *\n   * @type {Array}\n   */\n  #parentPoints = [];\n\n  /**\n   * Tolerance.\n   *\n   * @type {number}\n   */\n  #tolerance = 5;\n\n  /**\n   * Clear the parent points list.\n   *\n   * @param {object} imageSize The image size.\n   */\n  #clearParentPoints(imageSize) {\n    const nrows = imageSize.get(1);\n    for (let i = 0; i < nrows; ++i) {\n      this.#parentPoints[i] = [];\n    }\n  }\n\n  /**\n   * Clear the stored paths.\n   */\n  #clearPaths() {\n    this.#path = new Path();\n    this.#currentPath = new Path();\n  }\n\n  /**\n   * Scissor representation.\n   *\n   * @type {Scissors}\n   */\n  #scissors = new Scissors();\n\n  /**\n   * Chack if the base image is resampled.\n   *\n   * @param {string} divId The layer group divId.\n   * @returns {boolean} True if the image is resampled.\n   */\n  #isResampled(divId) {\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const viewLayer = layerGroup.getBaseViewLayer();\n    const referenceDataId = viewLayer.getDataId();\n    const referenceData = this.#app.getData(referenceDataId);\n    const image = referenceData.image;\n\n    return image.isResampled();\n  }\n\n  /**\n   * Start tool interaction.\n   *\n   * @param {Point2D} point The start point.\n   * @param {string} divId The layer group divId.\n   */\n  #start(point, divId) {\n    if (this.#isResampled(divId)) {\n      return;\n    }\n\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n\n    let viewLayer;\n    let drawLayer = layerGroup.getActiveDrawLayer();\n    if (typeof drawLayer === 'undefined') {\n      viewLayer = layerGroup.getActiveViewLayer();\n    } else {\n      viewLayer =\n        layerGroup.getViewLayerById(drawLayer.getReferenceLayerId());\n    }\n\n    const imageSize = viewLayer.getViewController().getImageSize();\n\n    this.#scissors.setDimensions(\n      imageSize.get(0),\n      imageSize.get(1));\n    this.#scissors.setData(viewLayer.getImageData().data);\n\n    const index = viewLayer.displayToPlaneIndex(point);\n\n    // first time\n    if (!this.#started) {\n      this.#annotation = undefined;\n      this.#started = true;\n      this.#startPoint = new Point2D(index.get(0), index.get(1));\n      // clear vars\n      this.#clearPaths();\n      this.#clearParentPoints(imageSize);\n      // get draw layer\n      if (typeof drawLayer === 'undefined') {\n        const refDataId = viewLayer.getDataId();\n        // create new data\n        const data = this.#app.createAnnotationData(refDataId);\n        // render (will create draw layer)\n        this.#app.addAndRenderAnnotationData(data, divId, refDataId);\n        // get draw layer\n        drawLayer = layerGroup.getActiveDrawLayer();\n        // set active to bind to toolboxController\n        layerGroup.setActiveLayerByDataId(drawLayer.getDataId());\n      }\n      // update zoom scale\n      this.#style.setZoomScale(\n        drawLayer.getKonvaLayer().getAbsoluteScale());\n      // do the training from the first point\n      const p = {x: index.get(0), y: index.get(1)};\n      this.#scissors.doTraining(p);\n      // add the initial point to the path\n      const p0 = new Point2D(index.get(0), index.get(1));\n      this.#path.addPoint(p0);\n      this.#path.addControlPoint(p0);\n    } else {\n      const diffX = Math.abs(index.get(0) - this.#startPoint.getX());\n      const diffY = Math.abs(index.get(1) - this.#startPoint.getY());\n      // final point: at 'tolerance' of the initial point\n      if (diffX < this.#tolerance &&\n        diffY < this.#tolerance) {\n        // finish\n        this.#finishShape();\n      } else {\n        // anchor point\n        this.#path = this.#currentPath;\n        this.#clearParentPoints(imageSize);\n        const pn = {x: index.get(0), y: index.get(1)};\n        this.#scissors.doTraining(pn);\n        this.#path.addControlPoint(this.#currentPath.getPoint(0));\n      }\n    }\n  }\n\n  /**\n   * Update tool interaction.\n   *\n   * @param {Point2D} point The update point.\n   * @param {string} divId The layer group divId.\n   */\n  #update(point, divId) {\n    if (!this.#started) {\n      return;\n    }\n    const layerGroup = this.#app.getLayerGroupByDivId(divId);\n    const drawLayer = layerGroup.getActiveDrawLayer();\n    if (typeof drawLayer === 'undefined') {\n      logger.warn('No draw layer to update livewire');\n      return;\n    }\n    const viewLayer = layerGroup.getViewLayerById(\n      drawLayer.getReferenceLayerId());\n    if (typeof viewLayer === 'undefined') {\n      logger.warn('No view layer to update livewire');\n      return;\n    }\n    const index = viewLayer.displayToPlaneIndex(point);\n\n    // set the point to find the path to\n    let p = {x: index.get(0), y: index.get(1)};\n    this.#scissors.setPoint(p);\n    // do the work\n    let results = [];\n    let stop = false;\n    while (!this.#parentPoints[p.y][p.x] && !stop) {\n      results = this.#scissors.doWork();\n\n      if (results.length === 0) {\n        stop = true;\n      } else {\n        // fill parents\n        for (let i = 0; i < results.length - 1; i += 2) {\n          const _p = results[i];\n          const _q = results[i + 1];\n          this.#parentPoints[_p.y][_p.x] = _q;\n        }\n      }\n    }\n\n    // get the path\n    this.#currentPath = new Path();\n    stop = false;\n    while (p && !stop) {\n      this.#currentPath.addPoint(new Point2D(p.x, p.y));\n      if (!this.#parentPoints[p.y]) {\n        stop = true;\n      } else {\n        if (!this.#parentPoints[p.y][p.x]) {\n          stop = true;\n        } else {\n          p = this.#parentPoints[p.y][p.x];\n        }\n      }\n    }\n    this.#currentPath.appenPath(this.#path);\n\n    const drawController = drawLayer.getDrawController();\n\n    const newMathShape = new ROI(this.#currentPath.pointArray);\n\n    let command;\n    if (typeof this.#annotation === 'undefined') {\n      // create annotation\n      this.#annotation = new Annotation();\n      this.#annotation.colour = this.#style.getLineColour();\n\n      const viewController = viewLayer.getViewController();\n      this.#annotation.init(viewController);\n\n      this.#annotation.mathShape = newMathShape;\n      command = new AddAnnotationCommand(\n        this.#annotation,\n        drawController\n      );\n    } else {\n      // update annotation\n      const originalMathShape = this.#annotation.mathShape;\n      command = new UpdateAnnotationCommand(\n        this.#annotation,\n        {mathShape: originalMathShape},\n        {mathShape: newMathShape},\n        drawController\n      );\n    }\n\n    // add command to undo stack\n    this.#app.addToUndoStack(command);\n    // execute command: triggers draw creation\n    command.execute();\n  }\n\n  /**\n   * Finish a livewire (roi) shape.\n   */\n  #finishShape() {\n    // set flag\n    this.#started = false;\n  }\n\n  /**\n   * Handle mouse down event.\n   *\n   * @param {object} event The mouse down event.\n   */\n  mousedown = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#start(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse move event.\n   *\n   * @param {object} event The mouse move event.\n   */\n  mousemove = (event) => {\n    const mousePoint = getMousePoint(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(mousePoint, layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle mouse up event.\n   *\n   * @param {object} _event The mouse up event.\n   */\n  mouseup(_event) {\n    // nothing to do\n  }\n\n  /**\n   * Handle mouse out event.\n   *\n   * @param {object} _event The mouse out event.\n   */\n  mouseout = (_event) => {\n    // nothing to do\n  };\n\n  /**\n   * Handle double click event.\n   *\n   * @param {object} _event The double click event.\n   */\n  dblclick = (_event) => {\n    this.#finishShape();\n  };\n\n  /**\n   * Handle touch start event.\n   *\n   * @param {object} event The touch start event.\n   */\n  touchstart = (event) => {\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#start(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch move event.\n   *\n   * @param {object} event The touch move event.\n   */\n  touchmove = (event) => {\n    const touchPoints = getTouchPoints(event);\n    const layerDetails = getLayerDetailsFromEvent(event);\n    this.#update(touchPoints[0], layerDetails.groupDivId);\n  };\n\n  /**\n   * Handle touch end event.\n   *\n   * @param {object} _event The touch end event.\n   */\n  touchend = (_event) => {\n    // nothing to do\n  };\n\n  /**\n   * Handle key down event.\n   *\n   * @param {object} event The key down event.\n   */\n  keydown = (event) => {\n    event.context = 'Livewire';\n    this.#app.onKeydown(event);\n  };\n\n  /**\n   * Activate the tool.\n   *\n   * @param {boolean} bool The flag to activate or not.\n   */\n  activate(bool) {\n    // start scissors if displayed\n    if (bool) {\n      // init with the app window scale\n      this.#style.setBaseScale(this.#app.getBaseScale());\n      // set the default to the first in the list\n      this.setFeatures({shapeColour: this.#style.getLineColour()});\n    }\n  }\n\n  /**\n   * Initialise the tool.\n   */\n  init() {\n    // does nothing\n  }\n\n\n  /**\n   * Set the tool live features: shape colour.\n   *\n   * @param {object} features The list of features.\n   */\n  setFeatures(features) {\n    if (typeof features.shapeColour !== 'undefined') {\n      this.#style.setLineColour(features.shapeColour);\n    }\n  }\n\n} // Livewire class\n","import {\n  Line,\n  getPerpendicularLine,\n  getPerpendicularLineAtDistance\n} from '../math/line.js';\nimport {Point2D} from '../math/point.js';\nimport {custom} from '../app/custom.js';\nimport {logger} from '../utils/logger.js';\nimport {\n  defaultLabelTexts,\n  getLineShape,\n  DRAW_DEBUG,\n  getDefaultAnchor,\n  getAnchorShape\n} from './drawBounds.js';\nimport {LabelFactory} from './labelFactory.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Style} from '../gui/style.js';\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Arrow factory.\n */\nexport class ArrowFactory {\n\n  /**\n   * The name of the factory.\n   *\n   * @type {string}\n   */\n  #name = 'arrow';\n\n  /**\n   * The associated label factory.\n   *\n   * @type {LabelFactory}\n   */\n  #labelFactory = new LabelFactory(this.#getDefaultLabelPosition);\n\n  /**\n   * Does this factory support the input math shape.\n   *\n   * @param {object} mathShape The mathematical shape.\n   * @returns {boolean} True if supported.\n   */\n  static supports(mathShape) {\n    return mathShape instanceof Point2D;\n  }\n\n  /**\n   * Get the name of the factory.\n   *\n   * @returns {string} The name.\n   */\n  getName() {\n    return this.#name;\n  }\n\n  /**\n   * Get the name of the shape group.\n   *\n   * @returns {string} The name.\n   */\n  getGroupName() {\n    return this.#name + '-group';\n  }\n\n  /**\n   * Get the number of points needed to build the shape.\n   *\n   * @returns {number} The number of points.\n   */\n  getNPoints() {\n    return 2;\n  }\n\n  /**\n   * Get the timeout between point storage.\n   *\n   * @returns {number} The timeout in milliseconds.\n   */\n  getTimeout() {\n    return 0;\n  }\n\n  /**\n   * Set an annotation math shape from input points.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Point2D[]} points The points.\n   */\n  setAnnotationMathShape(annotation, points) {\n    annotation.mathShape = this.#calculateMathShape(points);\n    annotation.referencePoints = [points[1]];\n    annotation.setTextExpr(this.#getDefaultLabel());\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Create a line shape to be displayed.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Group} The Konva group.\n   */\n  createShapeGroup(annotation, style) {\n    // konva group\n    const group = new Konva.Group();\n    group.name(this.getGroupName());\n    group.visible(true);\n    group.id(annotation.trackingUid);\n    // konva shape\n    const shape = this.#createShape(annotation, style);\n    group.add(shape);\n    // extras\n    const extras = this.#createShapeExtras(annotation, style);\n    for (const extra of extras) {\n      group.add(extra);\n    }\n    // konva label\n    const label = this.#labelFactory.create(annotation, style);\n    group.add(label);\n    // label-shape connector\n    const connectorsPos = this.#getConnectorsPositions(shape);\n    group.add(this.#labelFactory.getConnector(connectorsPos, label, style));\n    // konva shadow (if debug)\n    if (DRAW_DEBUG) {\n      group.add(this.#getDebugShadow(annotation));\n    }\n    return group;\n  }\n\n  /**\n   * Get the connectors positions for the shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @returns {Point2D[]} The connectors positions.\n   */\n  #getConnectorsPositions(shape) {\n    const points = shape.points();\n    const sx = shape.x();\n    const sy = shape.y();\n    const centerX = (points[0] + points[2]) / 2 + sx;\n    const centerY = (points[1] + points[3]) / 2 + sy;\n    return [new Point2D(centerX, centerY)];\n  }\n\n  /**\n   * Get the anchors positions for the shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @returns {Point2D[]} The anchor positions.\n   */\n  #getAnchorsPositions(shape) {\n    const points = shape.points();\n    const sx = shape.x();\n    const sy = shape.y();\n    return [\n      new Point2D(points[0] + sx, points[1] + sy),\n      new Point2D(points[2] + sx, points[3] + sy)\n    ];\n  }\n\n  /**\n   * Get anchors to update a line shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @param {Style} style The application style.\n   * @returns {Konva.Ellipse[]} A list of anchors.\n   */\n  getAnchors(shape, style) {\n    const positions = this.#getAnchorsPositions(shape);\n    const anchors = [];\n    for (let i = 0; i < positions.length; ++i) {\n      anchors.push(getDefaultAnchor(\n        positions[i].getX(),\n        positions[i].getY(),\n        'anchor' + i,\n        style\n      ));\n    }\n    return anchors;\n  }\n\n  /**\n   * Constrain anchor movement.\n   *\n   * @param {Konva.Ellipse} _anchor The active anchor.\n   */\n  constrainAnchorMove(_anchor) {\n    // no constraints\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} style The application style.\n   */\n  updateShapeGroupOnAnchorMove(annotation, anchor, style) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n\n    // update shape and anchors\n    this.#updateShape(annotation, anchor, style);\n    // update label\n    this.updateLabelContent(annotation, group, style);\n    // update label position if default position\n    if (typeof annotation.labelPosition === 'undefined') {\n      this.#labelFactory.updatePosition(annotation, group);\n    }\n    // update connector\n    this.updateConnector(group);\n    // update shadow\n    if (DRAW_DEBUG) {\n      this.#updateDebugShadow(annotation, group);\n    }\n  }\n\n  /**\n   * Update an annotation on anchor move.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Konva.Shape} anchor The anchor.\n   */\n  updateAnnotationOnAnchorMove(annotation, anchor) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kline = this.#getShape(group);\n    // find anchors\n    const begin = getAnchorShape(group, 0);\n    const end = getAnchorShape(group, 1);\n\n    // math shape\n    // compensate for possible shape drag\n    const pointBegin = new Point2D(\n      begin.x() - kline.x(),\n      begin.y() - kline.y()\n    );\n    const pointEnd = new Point2D(\n      end.x() - kline.x(),\n      end.y() - kline.y()\n    );\n    annotation.mathShape = pointBegin;\n    annotation.referencePoints = [pointEnd];\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update an annotation on translation (shape move).\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {object} translation The translation.\n   */\n  updateAnnotationOnTranslation(annotation, translation) {\n    // math shape\n    const point = annotation.mathShape;\n    const endPoint = annotation.referencePoints[0];\n    const line = new Line(point, endPoint);\n\n    const begin = line.getBegin();\n    const newBegin = new Point2D(\n      begin.getX() + translation.x,\n      begin.getY() + translation.y\n    );\n    const end = line.getEnd();\n    const newEnd = new Point2D(\n      end.getX() + translation.x,\n      end.getY() + translation.y\n    );\n    annotation.mathShape = newBegin;\n    annotation.referencePoints = [newEnd];\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update the shape label.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Group} group The shape group.\n   * @param {Style} _style The application style.\n   */\n  updateLabelContent(annotation, group, _style) {\n    this.#labelFactory.updateContent(annotation, group);\n  }\n\n  /**\n   * Update the shape connector.\n   *\n   * @param {Konva.Group} group The shape group.\n   */\n  updateConnector(group) {\n    const kshape = this.#getShape(group);\n    const connectorsPos = this.#getConnectorsPositions(kshape);\n    this.#labelFactory.updateConnector(group, connectorsPos);\n  }\n\n  /**\n   * Calculate the mathematical shape from a list of points.\n   *\n   * @param {Point2D[]} points The points that define the shape.\n   * @returns {Point2D} The mathematical shape.\n   */\n  #calculateMathShape(points) {\n    return points[0];\n  }\n\n  /**\n   * Get the default labels.\n   *\n   * @returns {object} The label list.\n   */\n  #getDefaultLabel() {\n    if (typeof custom.labelTexts !== 'undefined' &&\n      typeof custom.labelTexts[this.#name] !== 'undefined'\n    ) {\n      return custom.labelTexts[this.#name];\n    } else {\n      return defaultLabelTexts[this.#name];\n    }\n  }\n\n  /**\n   * Creates the konva shape.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Line} The konva shape.\n   */\n  #createShape(annotation, style) {\n    const point = annotation.mathShape;\n    if (typeof annotation.referencePoints === 'undefined' ||\n      annotation.referencePoints.length === 0) {\n      throw new Error('No reference point for arrow');\n    }\n    const endPoint = annotation.referencePoints[0];\n    const line = new Line(point, endPoint);\n\n    // konva line\n    const kshape = new Konva.Line({\n      points: [\n        point.getX(),\n        point.getY(),\n        endPoint.getX(),\n        endPoint.getY()\n      ],\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      name: 'shape'\n    });\n\n    // larger hitfunc\n    const tickLen = 20;\n    const linePerp0 = getPerpendicularLine(\n      line, point, tickLen, style.getZoomScale());\n    const linePerp1 = getPerpendicularLine(\n      line, endPoint, tickLen, style.getZoomScale());\n    kshape.hitFunc(function (context) {\n      context.beginPath();\n      context.moveTo(linePerp0.getBegin().getX(), linePerp0.getBegin().getY());\n      context.lineTo(linePerp0.getEnd().getX(), linePerp0.getEnd().getY());\n      context.lineTo(linePerp1.getEnd().getX(), linePerp1.getEnd().getY());\n      context.lineTo(linePerp1.getBegin().getX(), linePerp1.getBegin().getY());\n      context.closePath();\n      context.fillStrokeShape(kshape);\n    });\n\n    return kshape;\n  }\n\n  /**\n   * Get the associated shape from a group.\n   *\n   * @param {Konva.Group} group The group to look into.\n   * @returns {Konva.Line|undefined} The shape.\n   */\n  #getShape(group) {\n    return getLineShape(group);\n  }\n\n  /**\n   * Creates the konva shape extras.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Array} The konva shape extras.\n   */\n  #createShapeExtras(annotation, style) {\n    const point = annotation.mathShape;\n    const endPoint = annotation.referencePoints[0];\n    const line = new Line(point, endPoint);\n\n    const tickLen = 20;\n    // perpendicular line at 2*tickLen\n    const perpLine = getPerpendicularLineAtDistance(\n      line, 2 * tickLen, tickLen, style.getZoomScale());\n\n    // triangle\n    const ktriangle = new Konva.Line({\n      points: [\n        line.getBegin().getX(),\n        line.getBegin().getY(),\n        perpLine.getBegin().getX(),\n        perpLine.getBegin().getY(),\n        perpLine.getEnd().getX(),\n        perpLine.getEnd().getY(),\n      ],\n      fill: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      closed: true,\n      name: 'shape-triangle'\n    });\n\n    return [ktriangle];\n  }\n\n  /**\n   * Get the default annotation label position.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @returns {Point2D} The position.\n   */\n  #getDefaultLabelPosition(annotation) {\n    const point = annotation.mathShape;\n    return point;\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} style The application style.\n   */\n  #updateShape(annotation, anchor, style) {\n    const point = annotation.mathShape;\n    const endPoint = annotation.referencePoints[0];\n    const line = new Line(point, endPoint);\n\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kline = this.#getShape(group);\n\n    // reset position after possible shape drag\n    kline.position({x: 0, y: 0});\n    // update shape\n    kline.points([\n      point.getX(),\n      point.getY(),\n      endPoint.getX(),\n      endPoint.getY(),\n    ]);\n\n    // associated triangle shape\n    const ktriangle = group.getChildren(function (node) {\n      return node.name() === 'shape-triangle';\n    })[0];\n    if (!(ktriangle instanceof Konva.Line)) {\n      return;\n    }\n    // find anchors\n    const begin = getAnchorShape(group, 0);\n    const end = getAnchorShape(group, 1);\n\n    // update 'self' (undo case)\n    switch (anchor.id()) {\n      case 'anchor0':\n        begin.x(anchor.x());\n        begin.y(anchor.y());\n        break;\n      case 'anchor1':\n        end.x(anchor.x());\n        end.y(anchor.y());\n        break;\n      default:\n        logger.error('Unhandled anchor id: ' + anchor.id());\n        break;\n    }\n\n    const tickLen = 20;\n\n    // triangle\n    const perpLine = getPerpendicularLineAtDistance(\n      line, 2 * tickLen, tickLen, style.getZoomScale());\n    ktriangle.position({x: 0, y: 0});\n    ktriangle.points([\n      line.getBegin().getX(),\n      line.getBegin().getY(),\n      perpLine.getBegin().getX(),\n      perpLine.getBegin().getY(),\n      perpLine.getEnd().getX(),\n      perpLine.getEnd().getY(),\n    ]);\n\n    // larger hitfunc\n    const linePerp0 = getPerpendicularLine(\n      line, point, tickLen, style.getZoomScale());\n    const linePerp1 = getPerpendicularLine(\n      line, endPoint, tickLen, style.getZoomScale());\n    kline.hitFunc(function (context) {\n      context.beginPath();\n      context.moveTo(linePerp0.getBegin().getX(), linePerp0.getBegin().getY());\n      context.lineTo(linePerp0.getEnd().getX(), linePerp0.getEnd().getY());\n      context.lineTo(linePerp1.getEnd().getX(), linePerp1.getEnd().getY());\n      context.lineTo(linePerp1.getBegin().getX(), linePerp1.getBegin().getY());\n      context.closePath();\n      context.fillStrokeShape(kline);\n    });\n  }\n\n  /**\n   * Get the debug shadow.\n   *\n   * @param {Annotation} _annotation The annotation to shadow.\n   * @param {Konva.Group} [_group] The associated group.\n   * @returns {Konva.Group|undefined} The shadow konva group.\n   */\n  #getDebugShadow(_annotation, _group) {\n    return;\n  }\n\n  /**\n   * Update the debug shadow.\n   *\n   * @param {Annotation} _annotation The annotation to shadow.\n   * @param {Konva.Group} _group The associated group.\n   */\n  #updateDebugShadow(_annotation, _group) {\n    // does nothing\n  }\n\n} // class ArrowFactory\n","import {Circle} from '../math/circle.js';\nimport {Point2D} from '../math/point.js';\nimport {logger} from '../utils/logger.js';\nimport {custom} from '../app/custom.js';\nimport {\n  defaultLabelTexts,\n  isNodeNameShape,\n  DRAW_DEBUG,\n  getDefaultAnchor,\n  getAnchorShape\n} from './drawBounds.js';\nimport {LabelFactory} from './labelFactory.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Style} from '../gui/style.js';\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Circle factory.\n */\nexport class CircleFactory {\n\n  /**\n   * The name of the factory.\n   *\n   * @type {string}\n   */\n  #name = 'circle';\n\n  /**\n   * The associated label factory.\n   *\n   * @type {LabelFactory}\n   */\n  #labelFactory = new LabelFactory(this.#getDefaultLabelPosition);\n\n  /**\n   * Does this factory support the input math shape.\n   *\n   * @param {object} mathShape The mathematical shape.\n   * @returns {boolean} True if supported.\n   */\n  static supports(mathShape) {\n    return mathShape instanceof Circle;\n  }\n\n  /**\n   * Get the name of the factory.\n   *\n   * @returns {string} The name.\n   */\n  getName() {\n    return this.#name;\n  }\n\n  /**\n   * Get the name of the shape group.\n   *\n   * @returns {string} The name.\n   */\n  getGroupName() {\n    return this.#name + '-group';\n  }\n\n  /**\n   * Get the number of points needed to build the shape.\n   *\n   * @returns {number} The number of points.\n   */\n  getNPoints() {\n    return 2;\n  }\n\n  /**\n   * Get the timeout between point storage.\n   *\n   * @returns {number} The timeout in milliseconds.\n   */\n  getTimeout() {\n    return 0;\n  }\n\n  /**\n   * Set an annotation math shape from input points.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Point2D[]} points The points.\n   */\n  setAnnotationMathShape(annotation, points) {\n    annotation.mathShape = this.#calculateMathShape(points);\n    annotation.setTextExpr(this.#getDefaultLabel());\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Create a circle shape to be displayed.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Group} The Konva group.\n   */\n  createShapeGroup(annotation, style) {\n    // konva group\n    const group = new Konva.Group();\n    group.name(this.getGroupName());\n    group.visible(true);\n    group.id(annotation.trackingUid);\n    // konva shape\n    const shape = this.#createShape(annotation, style);\n    group.add(this.#createShape(annotation, style));\n    // konva label\n    const label = this.#labelFactory.create(annotation, style);\n    group.add(this.#labelFactory.create(annotation, style));\n    // label-shape connector\n    const connectorsPos = this.#getConnectorsPositions(shape);\n    group.add(this.#labelFactory.getConnector(connectorsPos, label, style));\n    // konva shadow (if debug)\n    if (DRAW_DEBUG) {\n      const shadow = this.#getDebugShadow(annotation, group);\n      group.add(shadow);\n      // move to bottom to not bother main shape\n      shadow.moveToBottom();\n    }\n    return group;\n  }\n\n  /**\n   * Get the connectors positions for the shape.\n   *\n   * @param {Konva.Circle} shape The associated shape.\n   * @returns {Point2D[]} The connectors positions.\n   */\n  #getConnectorsPositions(shape) {\n    const centerX = shape.x();\n    const centerY = shape.y();\n    const radius = shape.radius() * Math.sqrt(2) / 2;\n    return [\n      new Point2D(centerX - radius, centerY - radius),\n      new Point2D(centerX + radius, centerY - radius),\n      new Point2D(centerX - radius, centerY + radius),\n      new Point2D(centerX + radius, centerY + radius),\n    ];\n  }\n\n  /**\n   * Get the anchors positions for the shape.\n   *\n   * @param {Konva.Circle} shape The associated shape.\n   * @returns {Point2D[]} The anchor positions.\n   */\n  #getAnchorsPositions(shape) {\n    const centerX = shape.x();\n    const centerY = shape.y();\n    const radius = shape.radius();\n    return [\n      new Point2D(centerX - radius, centerY),\n      new Point2D(centerX + radius, centerY),\n      new Point2D(centerX, centerY + radius),\n      new Point2D(centerX, centerY - radius),\n    ];\n  }\n\n  /**\n   * Get anchors to update a circle shape.\n   *\n   * @param {Konva.Circle} shape The associated shape.\n   * @param {Style} style The application style.\n   * @returns {Konva.Ellipse[]} A list of anchors.\n   */\n  getAnchors(shape, style) {\n    const positions = this.#getAnchorsPositions(shape);\n    const anchors = [];\n    for (let i = 0; i < positions.length; ++i) {\n      anchors.push(getDefaultAnchor(\n        positions[i].getX(),\n        positions[i].getY(),\n        'anchor' + i,\n        style\n      ));\n    }\n    return anchors;\n  }\n\n  /**\n   * Constrain anchor movement.\n   *\n   * @param {Konva.Ellipse} anchor The active anchor.\n   */\n  constrainAnchorMove(anchor) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n\n    // find special points\n    const left = getAnchorShape(group, 0);\n    const right = getAnchorShape(group, 1);\n    const bottom = getAnchorShape(group, 2);\n    const top = getAnchorShape(group, 3);\n\n    // update 'self' (undo case) and special points\n    switch (anchor.id()) {\n      case 'anchor0':\n        // block y\n        left.y(right.y());\n        break;\n      case 'anchor1':\n        // block y\n        right.y(left.y());\n        break;\n      case 'anchor2':\n        // block x\n        bottom.x(top.x());\n        break;\n      case 'anchor3':\n        // block x\n        top.x(bottom.x());\n        break;\n      default :\n        logger.error('Unhandled anchor id: ' + anchor.id());\n        break;\n    }\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} style The application style.\n   */\n  updateShapeGroupOnAnchorMove(annotation, anchor, style) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n\n    // update shape and anchors\n    this.#updateShape(annotation, anchor, style);\n    // update label\n    this.updateLabelContent(annotation, group, style);\n    // update label position if default position\n    if (typeof annotation.labelPosition === 'undefined') {\n      this.#labelFactory.updatePosition(annotation, group);\n    }\n    // update connector\n    this.updateConnector(group);\n    // update shadow\n    if (DRAW_DEBUG) {\n      this.#updateDebugShadow(annotation, group);\n    }\n  }\n\n  /**\n   * Update an annotation on anchor move.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Konva.Shape} anchor The anchor.\n   */\n  updateAnnotationOnAnchorMove(annotation, anchor) {\n    // math shape\n    const circle = annotation.mathShape;\n    const center = new Point2D(\n      circle.getCenter().getX(),\n      circle.getCenter().getY()\n    );\n    const anchorPoint = new Point2D(anchor.x(), anchor.y());\n    const newRadius = center.getDistance(anchorPoint);\n    annotation.mathShape = new Circle(center, newRadius);\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update an annotation on translation (shape move).\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {object} translation The translation.\n   */\n  updateAnnotationOnTranslation(annotation, translation) {\n    // math shape\n    const circle = annotation.mathShape;\n    const center = circle.getCenter();\n    const newCenter = new Point2D(\n      center.getX() + translation.x,\n      center.getY() + translation.y\n    );\n    annotation.mathShape = new Circle(newCenter, circle.getRadius());\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update the shape label.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Group} group The shape group.\n   * @param {Style} _style The application style.\n   */\n  updateLabelContent(annotation, group, _style) {\n    this.#labelFactory.updateContent(annotation, group);\n  }\n\n  /**\n   * Update the shape connector.\n   *\n   * @param {Konva.Group} group The shape group.\n   */\n  updateConnector(group) {\n    const kshape = this.#getShape(group);\n    const connectorsPos = this.#getConnectorsPositions(kshape);\n    this.#labelFactory.updateConnector(group, connectorsPos);\n  }\n\n\n  /**\n   * Calculate the mathematical shape from a list of points.\n   *\n   * @param {Point2D[]} points The points that define the shape.\n   * @returns {Circle} The mathematical shape.\n   */\n  #calculateMathShape(points) {\n    // calculate radius\n    const a = Math.abs(points[0].getX() - points[1].getX());\n    const b = Math.abs(points[0].getY() - points[1].getY());\n    const radius = Math.round(Math.sqrt(a * a + b * b));\n    // physical shape\n    return new Circle(points[0], radius);\n  }\n\n  /**\n   * Get the default labels.\n   *\n   * @returns {object} The label list.\n   */\n  #getDefaultLabel() {\n    if (typeof custom.labelTexts !== 'undefined' &&\n      typeof custom.labelTexts[this.#name] !== 'undefined'\n    ) {\n      return custom.labelTexts[this.#name];\n    } else {\n      return defaultLabelTexts[this.#name];\n    }\n  }\n\n  /**\n   * Creates the konva shape.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Circle} The konva shape.\n   */\n  #createShape(annotation, style) {\n    const circle = annotation.mathShape;\n    // konva circle\n    return new Konva.Circle({\n      x: circle.getCenter().getX(),\n      y: circle.getCenter().getY(),\n      radius: circle.getRadius(),\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      name: 'shape'\n    });\n  }\n\n  /**\n   * Get the associated shape from a group.\n   *\n   * @param {Konva.Group} group The group to look into.\n   * @returns {Konva.Circle|undefined} The shape.\n   */\n  #getShape(group) {\n    const kshape = group.getChildren(isNodeNameShape)[0];\n    if (!(kshape instanceof Konva.Circle)) {\n      return;\n    }\n    return kshape;\n  }\n\n  /**\n   * Get the default annotation label position.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @returns {Point2D} The position.\n   */\n  #getDefaultLabelPosition(annotation) {\n    const circle = annotation.mathShape;\n    const center = circle.getCenter();\n    const radius = circle.getRadius();\n    return new Point2D(\n      center.getX() - radius,\n      center.getY() + radius,\n    );\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} _style The application style.\n   */\n  #updateShape(annotation, anchor, _style) {\n    const circle = annotation.mathShape;\n    const center = circle.getCenter();\n    const radius = circle.getRadius();\n\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kcircle = this.#getShape(group);\n    // update shape: just update the radius\n    kcircle.radius(radius);\n\n    // find anchors\n    const left = getAnchorShape(group, 0);\n    const right = getAnchorShape(group, 1);\n    const bottom = getAnchorShape(group, 2);\n    const top = getAnchorShape(group, 3);\n\n    const swapX = right.x() < left.x() ? -1 : 1;\n    const swapY = top.y() < bottom.y() ? 1 : -1;\n\n    // update 'self' (undo case) and other anchors\n    switch (anchor.id()) {\n      case 'anchor0':\n        // update self\n        left.x(anchor.x());\n        // update others\n        right.x(center.getX() + swapX * radius);\n        bottom.y(center.getY() + radius);\n        top.y(center.getY() - radius);\n        break;\n      case 'anchor1':\n        // update self\n        right.x(anchor.x());\n        // update others\n        left.x(center.getX() - swapX * radius);\n        bottom.y(center.getY() + radius);\n        top.y(center.getY() - radius);\n        break;\n      case 'anchor2':\n        // update self\n        bottom.y(anchor.y());\n        // update others\n        left.x(center.getX() - radius);\n        right.x(center.getX() + radius);\n        top.y(center.getY() - swapY * radius);\n        break;\n      case 'anchor3':\n        // update self\n        top.y(anchor.y());\n        // update others\n        left.x(center.getX() - radius);\n        right.x(center.getX() + radius);\n        bottom.y(center.getY() + swapY * radius);\n        break;\n      default :\n        logger.error('Unhandled anchor id: ' + anchor.id());\n        break;\n    }\n  }\n\n  /**\n   * Get the debug shadow.\n   *\n   * @param {Annotation} annotation The annotation to shadow.\n   * @param {Konva.Group} [group] The associated group.\n   * @returns {Konva.Group|undefined} The shadow konva group.\n   */\n  #getDebugShadow(annotation, group) {\n    const circle = annotation.mathShape;\n\n    // possible group offset\n    let offsetX = 0;\n    let offsetY = 0;\n    if (typeof group !== 'undefined') {\n      offsetX = group.x();\n      offsetY = group.y();\n    }\n    const kshadow = new Konva.Group();\n    kshadow.name('shadow');\n    const regions = circle.getRound();\n    for (let i = 0; i < regions.length; ++i) {\n      const region = regions[i];\n      const minX = region[0][0];\n      const minY = region[0][1];\n      const maxX = region[1][0];\n      const pixelLine = new Konva.Rect({\n        x: minX - offsetX,\n        y: minY - offsetY,\n        width: maxX - minX,\n        height: 1,\n        fill: annotation.colour,\n        strokeWidth: 0,\n        strokeScaleEnabled: false,\n        opacity: 0.3,\n        name: 'shadow-element'\n      });\n      kshadow.add(pixelLine);\n    }\n    return kshadow;\n  }\n\n  /**\n   * Update the debug shadow.\n   *\n   * @param {Annotation} annotation The annotation to shadow.\n   * @param {Konva.Group} group The associated group.\n   */\n  #updateDebugShadow(annotation, group) {\n    const kshadow = group.getChildren(function (node) {\n      return node.name() === 'shadow';\n    })[0];\n    if (typeof kshadow !== 'undefined') {\n      // remove previous\n      kshadow.destroy();\n      // add new\n      const shadow = this.#getDebugShadow(annotation, group);\n      group.add(shadow);\n      // move to bottom to not bother main shape\n      shadow.moveToBottom();\n    }\n  }\n\n} // class CircleFactory\n","import {Ellipse} from '../math/ellipse.js';\nimport {Point2D} from '../math/point.js';\nimport {logger} from '../utils/logger.js';\nimport {custom} from '../app/custom.js';\nimport {\n  defaultLabelTexts,\n  isNodeNameShape,\n  DRAW_DEBUG,\n  getDefaultAnchor,\n  getAnchorShape\n} from './drawBounds.js';\nimport {LabelFactory} from './labelFactory.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Style} from '../gui/style.js';\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Ellipse factory.\n */\nexport class EllipseFactory {\n\n  /**\n   * The name of the factory.\n   *\n   * @type {string}\n   */\n  #name = 'ellipse';\n\n  /**\n   * The associated label factory.\n   *\n   * @type {LabelFactory}\n   */\n  #labelFactory = new LabelFactory(this.#getDefaultLabelPosition);\n\n  /**\n   * Does this factory support the input math shape.\n   *\n   * @param {object} mathShape The mathematical shape.\n   * @returns {boolean} True if supported.\n   */\n  static supports(mathShape) {\n    return mathShape instanceof Ellipse;\n  }\n\n  /**\n   * Get the name of the factory.\n   *\n   * @returns {string} The name.\n   */\n  getName() {\n    return this.#name;\n  }\n\n  /**\n   * Get the name of the shape group.\n   *\n   * @returns {string} The name.\n   */\n  getGroupName() {\n    return this.#name + '-group';\n  }\n\n  /**\n   * Get the number of points needed to build the shape.\n   *\n   * @returns {number} The number of points.\n   */\n  getNPoints() {\n    return 2;\n  }\n\n  /**\n   * Get the timeout between point storage.\n   *\n   * @returns {number} The timeout in milliseconds.\n   */\n  getTimeout() {\n    return 0;\n  }\n\n  /**\n   * Set an annotation math shape from input points.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Point2D[]} points The points.\n   */\n  setAnnotationMathShape(annotation, points) {\n    annotation.mathShape = this.#calculateMathShape(points);\n    annotation.setTextExpr(this.#getDefaultLabel());\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Create an ellipse shape to be displayed.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Group} The Konva group.\n   */\n  createShapeGroup(annotation, style) {\n    // konva group\n    const group = new Konva.Group();\n    group.name(this.getGroupName());\n    group.visible(true);\n    group.id(annotation.trackingUid);\n    // konva shape\n    const shape = this.#createShape(annotation, style);\n    group.add(this.#createShape(annotation, style));\n    // konva label\n    const label = this.#labelFactory.create(annotation, style);\n    group.add(this.#labelFactory.create(annotation, style));\n    // label-shape connector\n    const connectorsPos = this.#getConnectorsPositions(shape);\n    group.add(this.#labelFactory.getConnector(connectorsPos, label, style));\n    // konva shadow (if debug)\n    if (DRAW_DEBUG) {\n      const shadow = this.#getDebugShadow(annotation, group);\n      group.add(shadow);\n      // move to bottom to not bother main shape\n      shadow.moveToBottom();\n    }\n    return group;\n  }\n\n  /**\n   * Get the connectors positions for the shape.\n   *\n   * @param {Konva.Ellipse} shape The associated shape.\n   * @returns {Point2D[]} The connectors positions.\n   */\n  #getConnectorsPositions(shape) {\n    const centerX = shape.x();\n    const centerY = shape.y();\n    const radiusX = shape.radiusX() * Math.sqrt(2) / 2;\n    const radiusY = shape.radiusY() * Math.sqrt(2) / 2;\n    return [\n      new Point2D(centerX - radiusX, centerY - radiusY),\n      new Point2D(centerX + radiusX, centerY - radiusY),\n      new Point2D(centerX - radiusX, centerY + radiusY),\n      new Point2D(centerX + radiusX, centerY + radiusY),\n    ];\n  }\n\n  /**\n   * Get the anchors positions for the shape.\n   *\n   * @param {Konva.Ellipse} shape The associated shape.\n   * @returns {Point2D[]} The anchor positions.\n   */\n  #getAnchorsPositions(shape) {\n    const centerX = shape.x();\n    const centerY = shape.y();\n    const radius = shape.radius();\n    return [\n      new Point2D(centerX - radius.x, centerY),\n      new Point2D(centerX + radius.x, centerY),\n      new Point2D(centerX, centerY + radius.y),\n      new Point2D(centerX, centerY - radius.y),\n    ];\n  }\n\n  /**\n   * Get anchors to update a ellipse shape.\n   *\n   * @param {Konva.Ellipse} shape The associated shape.\n   * @param {Style} style The application style.\n   * @returns {Konva.Ellipse[]} A list of anchors.\n   */\n  getAnchors(shape, style) {\n    const positions = this.#getAnchorsPositions(shape);\n    const anchors = [];\n    for (let i = 0; i < positions.length; ++i) {\n      anchors.push(getDefaultAnchor(\n        positions[i].getX(),\n        positions[i].getY(),\n        'anchor' + i,\n        style\n      ));\n    }\n    return anchors;\n  }\n\n  /**\n   * Constrain anchor movement.\n   *\n   * @param {Konva.Ellipse} anchor The active anchor.\n   */\n  constrainAnchorMove(anchor) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n\n    // find special points\n    const left = getAnchorShape(group, 0);\n    const right = getAnchorShape(group, 1);\n    const bottom = getAnchorShape(group, 2);\n    const top = getAnchorShape(group, 3);\n\n    // update 'self' (undo case) and special points\n    switch (anchor.id()) {\n      case 'anchor0':\n        // block y\n        left.y(right.y());\n        break;\n      case 'anchor1':\n        // block y\n        right.y(left.y());\n        break;\n      case 'anchor2':\n        // block x\n        bottom.x(top.x());\n        break;\n      case 'anchor3':\n        // block x\n        top.x(bottom.x());\n        break;\n      default :\n        logger.error('Unhandled anchor id: ' + anchor.id());\n        break;\n    }\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} style The application style.\n   */\n  updateShapeGroupOnAnchorMove(annotation, anchor, style) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n\n    // update shape and anchors\n    this.#updateShape(annotation, anchor, style);\n    // update label\n    this.updateLabelContent(annotation, group, style);\n    // update label position if default position\n    if (typeof annotation.labelPosition === 'undefined') {\n      this.#labelFactory.updatePosition(annotation, group);\n    }\n    // update connector\n    this.updateConnector(group);\n    // update shadow\n    if (DRAW_DEBUG) {\n      this.#updateDebugShadow(annotation, group);\n    }\n  }\n\n  /**\n   * Update an annotation on anchor move.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Konva.Shape} anchor The anchor.\n   */\n  updateAnnotationOnAnchorMove(annotation, anchor) {\n    // math shape\n    const ellipse = annotation.mathShape;\n    const center = ellipse.getCenter();\n    let radiusX = ellipse.getA();\n    let radiusY = ellipse.getB();\n\n    // update 'self' (undo case) and special points\n    switch (anchor.id()) {\n      case 'anchor0':\n        radiusX = center.getX() - anchor.x();\n        break;\n      case 'anchor1':\n        radiusX = anchor.x() - center.getX();\n        break;\n      case 'anchor2':\n        radiusY = anchor.y() - center.getY();\n        break;\n      case 'anchor3':\n        radiusY = center.getY() - anchor.y();\n        break;\n      default :\n        logger.error('Unhandled anchor id: ' + anchor.id());\n        break;\n    }\n\n    annotation.mathShape = new Ellipse(\n      center, Math.abs(radiusX), Math.abs(radiusY));\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update an annotation on translation (shape move).\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {object} translation The translation.\n   */\n  updateAnnotationOnTranslation(annotation, translation) {\n    // math shape\n    const ellipse = annotation.mathShape;\n    const center = ellipse.getCenter();\n    const newCenter = new Point2D(\n      center.getX() + translation.x,\n      center.getY() + translation.y\n    );\n    annotation.mathShape = new Ellipse(\n      newCenter, ellipse.getA(), ellipse.getB());\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update the shape label.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Group} group The shape group.\n   * @param {Style} _style The application style.\n   */\n  updateLabelContent(annotation, group, _style) {\n    this.#labelFactory.updateContent(annotation, group);\n  }\n\n  /**\n   * Update the shape connector.\n   *\n   * @param {Konva.Group} group The shape group.\n   */\n  updateConnector(group) {\n    const kshape = this.#getShape(group);\n    const connectorsPos = this.#getConnectorsPositions(kshape);\n    this.#labelFactory.updateConnector(group, connectorsPos);\n  }\n\n  /**\n   * Calculate the mathematical shape from a list of points.\n   *\n   * @param {Point2D[]} points The points that define the shape.\n   * @returns {Ellipse} The mathematical shape.\n   */\n  #calculateMathShape(points) {\n    // calculate radius\n    const a = Math.abs(points[0].getX() - points[1].getX());\n    const b = Math.abs(points[0].getY() - points[1].getY());\n    // physical shape\n    return new Ellipse(points[0], a, b);\n  }\n\n  /**\n   * Get the default labels.\n   *\n   * @returns {object} The label list.\n   */\n  #getDefaultLabel() {\n    if (typeof custom.labelTexts !== 'undefined' &&\n      typeof custom.labelTexts[this.#name] !== 'undefined'\n    ) {\n      return custom.labelTexts[this.#name];\n    } else {\n      return defaultLabelTexts[this.#name];\n    }\n  }\n\n  /**\n   * Creates the konva shape.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Ellipse} The konva shape.\n   */\n  #createShape(annotation, style) {\n    const ellipse = annotation.mathShape;\n    const center = ellipse.getCenter();\n    const radius = {\n      x: ellipse.getA(),\n      y: ellipse.getB()\n    };\n    // konva circle\n    return new Konva.Ellipse({\n      x: center.getX(),\n      y: center.getY(),\n      radius: radius,\n      radiusX: radius.x,\n      radiusY: radius.y,\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      name: 'shape'\n    });\n  }\n\n  /**\n   * Get the associated shape from a group.\n   *\n   * @param {Konva.Group} group The group to look into.\n   * @returns {Konva.Ellipse|undefined} The shape.\n   */\n  #getShape(group) {\n    const kshape = group.getChildren(isNodeNameShape)[0];\n    if (!(kshape instanceof Konva.Ellipse)) {\n      return;\n    }\n    return kshape;\n  }\n\n  /**\n   * Get the default annotation label position.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @returns {Point2D} The position.\n   */\n  #getDefaultLabelPosition(annotation) {\n    const ellipse = annotation.mathShape;\n    const center = ellipse.getCenter();\n    return new Point2D(\n      center.getX() - ellipse.getA(),\n      center.getY() + ellipse.getB()\n    );\n  }\n\n  /**\n   * Update shape on anchor move.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} _style The application style.\n   */\n  #updateShape(annotation, anchor, _style) {\n    const ellipse = annotation.mathShape;\n    const center = ellipse.getCenter();\n    const radiusX = ellipse.getA();\n    const radiusY = ellipse.getB();\n\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kellipse = this.#getShape(group);\n    // update shape: just update radius\n    kellipse.radius({\n      x: radiusX,\n      y: radiusY\n    });\n\n    // find anchors\n    const left = getAnchorShape(group, 0);\n    const right = getAnchorShape(group, 1);\n    const bottom = getAnchorShape(group, 2);\n    const top = getAnchorShape(group, 3);\n\n    const swapX = right.x() < left.x() ? -1 : 1;\n    const swapY = top.y() < bottom.y() ? 1 : -1;\n\n    // update 'self' (undo case) and other anchors\n    switch (anchor.id()) {\n      case 'anchor0':\n        // update self\n        left.x(anchor.x());\n        // update others\n        right.x(center.getX() + swapX * radiusX);\n        bottom.y(center.getY() + radiusY);\n        top.y(center.getY() - radiusY);\n        break;\n      case 'anchor1':\n        // update self\n        right.x(anchor.x());\n        // update others\n        left.x(center.getX() - swapX * radiusX);\n        bottom.y(center.getY() + radiusY);\n        top.y(center.getY() - radiusY);\n        break;\n      case 'anchor2':\n        // update self\n        bottom.y(anchor.y());\n        // update others\n        left.x(center.getX() - radiusX);\n        right.x(center.getX() + radiusX);\n        top.y(center.getY() - swapY * radiusY);\n        break;\n      case 'anchor3':\n        // update self\n        top.y(anchor.y());\n        // update others\n        left.x(center.getX() - radiusX);\n        right.x(center.getX() + radiusX);\n        bottom.y(center.getY() + swapY * radiusY);\n        break;\n      default :\n        logger.error('Unhandled anchor id: ' + anchor.id());\n        break;\n    }\n  }\n\n  /**\n   * Get the debug shadow.\n   *\n   * @param {Annotation} annotation The annotation to shadow.\n   * @param {Konva.Group} [group] The associated group.\n   * @returns {Konva.Group|undefined} The shadow konva group.\n   */\n  #getDebugShadow(annotation, group) {\n    const ellipse = annotation.mathShape;\n\n    // possible group offset\n    let offsetX = 0;\n    let offsetY = 0;\n    if (typeof group !== 'undefined') {\n      offsetX = group.x();\n      offsetY = group.y();\n    }\n    const kshadow = new Konva.Group();\n    kshadow.name('shadow');\n    const regions = ellipse.getRound();\n    for (let i = 0; i < regions.length; ++i) {\n      const region = regions[i];\n      const minX = region[0][0];\n      const minY = region[0][1];\n      const maxX = region[1][0];\n      const pixelLine = new Konva.Rect({\n        x: minX - offsetX,\n        y: minY - offsetY,\n        width: maxX - minX,\n        height: 1,\n        fill: annotation.colour,\n        strokeWidth: 0,\n        strokeScaleEnabled: false,\n        opacity: 0.3,\n        name: 'shadow-element'\n      });\n      kshadow.add(pixelLine);\n    }\n    return kshadow;\n  }\n\n  /**\n   * Update the debug shadow.\n   *\n   * @param {Annotation} annotation The annotation to shadow.\n   * @param {Konva.Group} group The associated group.\n   */\n  #updateDebugShadow(annotation, group) {\n    const kshadow = group.getChildren(function (node) {\n      return node.name() === 'shadow';\n    })[0];\n    if (typeof kshadow !== 'undefined') {\n      // remove previous\n      kshadow.destroy();\n      // add new\n      const shadow = this.#getDebugShadow(annotation, group);\n      group.add(shadow);\n      // move to bottom to not bother main shape\n      shadow.moveToBottom();\n    }\n  }\n\n} // class EllipseFactory\n","import {Line, getAngle} from '../math/line.js';\nimport {Protractor} from '../math/protractor.js';\nimport {Point2D} from '../math/point.js';\nimport {custom} from '../app/custom.js';\nimport {\n  defaultLabelTexts,\n  getLineShape,\n  DRAW_DEBUG,\n  getDefaultAnchor,\n  getAnchorShape\n} from './drawBounds.js';\nimport {LabelFactory} from './labelFactory.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Style} from '../gui/style.js';\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Protractor factory.\n */\nexport class ProtractorFactory {\n\n  /**\n   * The name of the factory.\n   *\n   * @type {string}\n   */\n  #name = 'protractor';\n\n  /**\n   * The associated label factory.\n   *\n   * @type {LabelFactory}\n   */\n  #labelFactory = new LabelFactory(this.#getDefaultLabelPosition);\n\n  /**\n   * Does this factory support the input math shape.\n   *\n   * @param {object} mathShape The mathematical shape.\n   * @returns {boolean} True if supported.\n   */\n  static supports(mathShape) {\n    return mathShape instanceof Protractor;\n  }\n\n  /**\n   * Get the name of the factory.\n   *\n   * @returns {string} The name.\n   */\n  getName() {\n    return this.#name;\n  }\n\n  /**\n   * Get the name of the shape group.\n   *\n   * @returns {string} The name.\n   */\n  getGroupName() {\n    return this.#name + '-group';\n  }\n\n  /**\n   * Get the number of points needed to build the shape.\n   *\n   * @returns {number} The number of points.\n   */\n  getNPoints() {\n    return 3;\n  }\n\n  /**\n   * Get the timeout between point storage.\n   *\n   * @returns {number} The timeout in milliseconds.\n   */\n  getTimeout() {\n    return 500;\n  }\n\n  /**\n   * Set an annotation math shape from input points.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Point2D[]} points The points.\n   */\n  setAnnotationMathShape(annotation, points) {\n    annotation.mathShape = this.#calculateMathShape(points);\n    annotation.setTextExpr(this.#getDefaultLabel());\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Create a line shape to be displayed.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Group} The Konva group.\n   */\n  createShapeGroup(annotation, style) {\n    const protractor = annotation.mathShape;\n\n    // konva group\n    const group = new Konva.Group();\n    group.name(this.getGroupName());\n    group.visible(true);\n    group.id(annotation.trackingUid);\n    // konva shape\n    const shape = this.#createShape(annotation, style);\n    group.add(this.#createShape(annotation, style));\n\n    if (protractor.getLength() === this.getNPoints()) {\n      // extras\n      const extras = this.#createShapeExtras(annotation, style);\n      for (const extra of extras) {\n        group.add(extra);\n      }\n      // konva label\n      const label = this.#labelFactory.create(annotation, style);\n      group.add(this.#labelFactory.create(annotation, style));\n      // label-shape connector\n      const connectorsPos = this.#getConnectorsPositions(shape);\n      group.add(this.#labelFactory.getConnector(connectorsPos, label, style));\n      // konva shadow (if debug)\n      if (DRAW_DEBUG) {\n        group.add(this.#getDebugShadow(annotation));\n      }\n    }\n    return group;\n  }\n\n\n  /**\n   * Get the connectors positions for the shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @returns {Point2D[]} The connectors positions.\n   */\n  #getConnectorsPositions(shape) {\n    const points = shape.points();\n    const sx = shape.x();\n    const sy = shape.y();\n    return [\n      new Point2D(points[2] + sx, points[3] + sy)\n    ];\n  }\n\n  /**\n   * Get the anchors positions for the shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @returns {Point2D[]} The anchor positions.\n   */\n  #getAnchorsPositions(shape) {\n    const points = shape.points();\n    const sx = shape.x();\n    const sy = shape.y();\n    return [\n      new Point2D(points[0] + sx, points[1] + sy),\n      new Point2D(points[2] + sx, points[3] + sy),\n      new Point2D(points[4] + sx, points[5] + sy)\n    ];\n  }\n\n  /**\n   * Get anchors to update a line shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @param {Style} style The application style.\n   * @returns {Konva.Ellipse[]} A list of anchors.\n   */\n  getAnchors(shape, style) {\n    const positions = this.#getAnchorsPositions(shape);\n    const anchors = [];\n    for (let i = 0; i < positions.length; ++i) {\n      anchors.push(getDefaultAnchor(\n        positions[i].getX(),\n        positions[i].getY(),\n        'anchor' + i,\n        style\n      ));\n    }\n    return anchors;\n  }\n\n  /**\n   * Constrain anchor movement.\n   *\n   * @param {Konva.Ellipse} _anchor The active anchor.\n   */\n  constrainAnchorMove(_anchor) {\n    // no constraints\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} style The application style.\n   */\n  updateShapeGroupOnAnchorMove(annotation, anchor, style) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n\n    // update shape and anchors\n    this.#updateShape(annotation, anchor, style);\n    // update label\n    this.updateLabelContent(annotation, group, style);\n    // update label position if default position\n    if (typeof annotation.labelPosition === 'undefined') {\n      this.#labelFactory.updatePosition(annotation, group);\n    }\n    // update connector\n    this.updateConnector(group);\n    // update shadow\n    if (DRAW_DEBUG) {\n      this.#updateDebugShadow(annotation, group);\n    }\n  }\n\n  /**\n   * Update an annotation on anchor move.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Konva.Shape} anchor The anchor.\n   */\n  updateAnnotationOnAnchorMove(annotation, anchor) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kline = this.#getShape(group);\n    // find special points\n    const begin = getAnchorShape(group, 0);\n    const mid = getAnchorShape(group, 1);\n    const end = getAnchorShape(group, 2);\n\n    // math shape\n    // compensate for possible shape drag\n    const pointBegin = new Point2D(\n      begin.x() - kline.x(),\n      begin.y() - kline.y()\n    );\n    const pointMid = new Point2D(\n      mid.x() - kline.x(),\n      mid.y() - kline.y()\n    );\n    const pointEnd = new Point2D(\n      end.x() - kline.x(),\n      end.y() - kline.y()\n    );\n    annotation.mathShape = new Protractor([pointBegin, pointMid, pointEnd]);\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update an annotation on translation (shape move).\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {object} translation The translation.\n   */\n  updateAnnotationOnTranslation(annotation, translation) {\n    // math shape\n    const protractor = annotation.mathShape;\n    const newPointList = [];\n    for (let i = 0; i < 3; ++i) {\n      newPointList.push(new Point2D(\n        protractor.getPoint(i).getX() + translation.x,\n        protractor.getPoint(i).getY() + translation.y\n      ));\n    }\n    annotation.mathShape = new Protractor(newPointList);\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update the shape label.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Group} group The shape group.\n   * @param {Style} _style The application style.\n   */\n  updateLabelContent(annotation, group, _style) {\n    this.#labelFactory.updateContent(annotation, group);\n  }\n\n  /**\n   * Update the shape connector.\n   *\n   * @param {Konva.Group} group The shape group.\n   */\n  updateConnector(group) {\n    const kshape = this.#getShape(group);\n    const connectorsPos = this.#getConnectorsPositions(kshape);\n    this.#labelFactory.updateConnector(group, connectorsPos);\n  }\n\n  /**\n   * Calculate the mathematical shape from a list of points.\n   *\n   * @param {Point2D[]} points The points that define the shape.\n   * @returns {Protractor} The mathematical shape.\n   */\n  #calculateMathShape(points) {\n    return new Protractor(points);\n  }\n\n  /**\n   * Get the default labels.\n   *\n   * @returns {object} The label list.\n   */\n  #getDefaultLabel() {\n    if (typeof custom.labelTexts !== 'undefined' &&\n      typeof custom.labelTexts[this.#name] !== 'undefined'\n    ) {\n      return custom.labelTexts[this.#name];\n    } else {\n      return defaultLabelTexts[this.#name];\n    }\n  }\n\n  /**\n   * Creates the konva shape.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Line} The konva shape.\n   */\n  #createShape(annotation, style) {\n    const protractor = annotation.mathShape;\n    const points = [];\n    for (let i = 0; i < protractor.getLength(); ++i) {\n      points.push(protractor.getPoint(i).getX());\n      points.push(protractor.getPoint(i).getY());\n    }\n\n    // konva line\n    const kshape = new Konva.Line({\n      points: points,\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      name: 'shape'\n    });\n\n    if (protractor.getLength() === this.getNPoints()) {\n      // larger hitfunc\n      kshape.hitFunc(function (context) {\n        context.beginPath();\n        context.moveTo(\n          protractor.getPoint(0).getX(), protractor.getPoint(0).getY());\n        context.lineTo(\n          protractor.getPoint(1).getX(), protractor.getPoint(1).getY());\n        context.lineTo(\n          protractor.getPoint(2).getX(), protractor.getPoint(2).getY());\n        context.closePath();\n        context.fillStrokeShape(kshape);\n      });\n    }\n\n    return kshape;\n  }\n\n  /**\n   * Get the associated shape from a group.\n   *\n   * @param {Konva.Group} group The group to look into.\n   * @returns {Konva.Line|undefined} The shape.\n   */\n  #getShape(group) {\n    return getLineShape(group);\n  }\n\n  /**\n   * Creates the konva shape extras.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Array} The konva shape extras.\n   */\n  #createShapeExtras(annotation, style) {\n    const protractor = annotation.mathShape;\n    const line0 = new Line(\n      protractor.getPoint(0), protractor.getPoint(1));\n    const line1 = new Line(\n      protractor.getPoint(1), protractor.getPoint(2));\n\n    let angle = getAngle(line0, line1);\n    let inclination = line0.getInclination();\n    if (angle > 180) {\n      angle = 360 - angle;\n      inclination += angle;\n    }\n\n    const radius = Math.min(line0.getLength(), line1.getLength()) * 33 / 100;\n    const karc = new Konva.Arc({\n      innerRadius: radius,\n      outerRadius: radius,\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      angle: angle,\n      rotation: -inclination,\n      x: protractor.getPoint(1).getX(),\n      y: protractor.getPoint(1).getY(),\n      name: 'shape-arc'\n    });\n\n    return [karc];\n  }\n\n  /**\n   * Get the default annotation label position.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @returns {Point2D} The position.\n   */\n  #getDefaultLabelPosition(annotation) {\n    const protractor = annotation.mathShape;\n    const line0 = new Line(\n      protractor.getPoint(0), protractor.getPoint(1));\n    const line1 = new Line(\n      protractor.getPoint(1), protractor.getPoint(2));\n\n    const midX =\n      (line0.getCentroid().getX() + line1.getCentroid().getX()) / 2;\n    const midY =\n      (line0.getCentroid().getY() + line1.getCentroid().getY()) / 2;\n\n    return new Point2D(\n      midX,\n      midY\n    );\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} _style The application style.\n   */\n  #updateShape(annotation, anchor, _style) {\n    const protractor = annotation.mathShape;\n    const line0 = new Line(\n      protractor.getPoint(0), protractor.getPoint(1));\n    const line1 = new Line(\n      protractor.getPoint(1), protractor.getPoint(2));\n\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kline = this.#getShape(group);\n\n    // reset position after possible shape drag\n    kline.position({x: 0, y: 0});\n    // update shape\n    kline.points([\n      protractor.getPoint(0).getX(),\n      protractor.getPoint(0).getY(),\n      protractor.getPoint(1).getX(),\n      protractor.getPoint(1).getY(),\n      protractor.getPoint(2).getX(),\n      protractor.getPoint(2).getY()\n    ]);\n\n    // associated arc\n    const karc = group.getChildren(function (node) {\n      return node.name() === 'shape-arc';\n    })[0];\n    if (!(karc instanceof Konva.Arc)) {\n      return;\n    }\n\n    // find special points\n    const begin = getAnchorShape(group, 0);\n    const mid = getAnchorShape(group, 1);\n    const end = getAnchorShape(group, 2);\n\n    // update special points\n    switch (anchor.id()) {\n      case 'anchor0':\n        begin.x(anchor.x());\n        begin.y(anchor.y());\n        break;\n      case 'anchor1':\n        mid.x(anchor.x());\n        mid.y(anchor.y());\n        break;\n      case 'anchor2':\n        end.x(anchor.x());\n        end.y(anchor.y());\n        break;\n    }\n\n    // angle\n    let angle = getAngle(line0, line1);\n    let inclination = line0.getInclination();\n    if (angle > 180) {\n      angle = 360 - angle;\n      inclination += angle;\n    }\n\n    // arc\n    const radius = Math.min(line0.getLength(), line1.getLength()) * 33 / 100;\n    karc.innerRadius(radius);\n    karc.outerRadius(radius);\n    karc.angle(angle);\n    karc.rotation(-inclination);\n    const arcPos = {x: mid.x(), y: mid.y()};\n    karc.position(arcPos);\n\n    // larger hitfunc\n    kline.hitFunc(function (context) {\n      context.beginPath();\n      context.moveTo(\n        protractor.getPoint(0).getX(), protractor.getPoint(0).getY());\n      context.lineTo(\n        protractor.getPoint(1).getX(), protractor.getPoint(1).getY());\n      context.lineTo(\n        protractor.getPoint(2).getX(), protractor.getPoint(2).getY());\n      context.closePath();\n      context.fillStrokeShape(kline);\n    });\n  }\n\n  /**\n   * Get the debug shadow.\n   *\n   * @param {Annotation} _annotation The annotation to shadow.\n   * @param {Konva.Group} [_group] The associated group.\n   * @returns {Konva.Group|undefined} The shadow konva group.\n   */\n  #getDebugShadow(_annotation, _group) {\n    return;\n  }\n\n  /**\n   * Update the debug shadow.\n   *\n   * @param {Annotation} _annotation The annotation to shadow.\n   * @param {Konva.Group} _group The associated group.\n   */\n  #updateDebugShadow(_annotation, _group) {\n    // does nothing\n  }\n\n} // class ProtractorFactory\n","import {Rectangle} from '../math/rectangle.js';\nimport {Point2D} from '../math/point.js';\nimport {logger} from '../utils/logger.js';\nimport {custom} from '../app/custom.js';\nimport {\n  defaultLabelTexts,\n  isNodeNameShape,\n  DRAW_DEBUG,\n  getDefaultAnchor,\n  getAnchorShape\n} from './drawBounds.js';\nimport {LabelFactory} from './labelFactory.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Style} from '../gui/style.js';\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Rectangle factory.\n */\nexport class RectangleFactory {\n\n  /**\n   * The name of the factory.\n   *\n   * @type {string}\n   */\n  #name = 'rectangle';\n\n  /**\n   * The associated label factory.\n   *\n   * @type {LabelFactory}\n   */\n  #labelFactory = new LabelFactory(this.#getDefaultLabelPosition);\n\n  /**\n   * Does this factory support the input math shape.\n   *\n   * @param {object} mathShape The mathematical shape.\n   * @returns {boolean} True if supported.\n   */\n  static supports(mathShape) {\n    return mathShape instanceof Rectangle;\n  }\n\n  /**\n   * Get the name of the factory.\n   *\n   * @returns {string} The name.\n   */\n  getName() {\n    return this.#name;\n  }\n\n  /**\n   * Get the name of the shape group.\n   *\n   * @returns {string} The name.\n   */\n  getGroupName() {\n    return this.#name + '-group';\n  }\n\n  /**\n   * Get the number of points needed to build the shape.\n   *\n   * @returns {number} The number of points.\n   */\n  getNPoints() {\n    return 2;\n  }\n\n  /**\n   * Get the timeout between point storage.\n   *\n   * @returns {number} The timeout in milliseconds.\n   */\n  getTimeout() {\n    return 0;\n  }\n\n  /**\n   * Set an annotation math shape from input points.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Point2D[]} points The points.\n   */\n  setAnnotationMathShape(annotation, points) {\n    annotation.mathShape = this.#calculateMathShape(points);\n    annotation.setTextExpr(this.#getDefaultLabel());\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Create a rectangle shape to be displayed.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Group} The Konva group.\n   */\n  createShapeGroup(annotation, style) {\n    // konva group\n    const group = new Konva.Group();\n    group.name(this.getGroupName());\n    group.visible(true);\n    group.id(annotation.trackingUid);\n    // konva shape\n    const shape = this.#createShape(annotation, style);\n    group.add(shape);\n    // konva label\n    const label = this.#labelFactory.create(annotation, style);\n    group.add(label);\n    // label-shape connector\n    const connectorsPos = this.#getConnectorsPositions(shape);\n    group.add(this.#labelFactory.getConnector(connectorsPos, label, style));\n    // konva shadow (if debug)\n    if (DRAW_DEBUG) {\n      const shadow = this.#getDebugShadow(annotation);\n      group.add(shadow);\n      // move to bottom to not bother main shape\n      shadow.moveToBottom();\n    }\n    return group;\n  }\n\n  /**\n   * Get the connectors positions for the shape.\n   *\n   * @param {Konva.Rect} shape The associated shape.\n   * @returns {Point2D[]} The connectors positions.\n   */\n  #getConnectorsPositions(shape) {\n    const sx = shape.x();\n    const sy = shape.y();\n    const width = shape.width();\n    const height = shape.height();\n    return [\n      new Point2D(sx + width / 2, sy),\n      new Point2D(sx, sy + height / 2),\n      new Point2D(sx + width / 2, sy + height),\n      new Point2D(sx + width, sy + height / 2),\n    ];\n  }\n\n  /**\n   * Get the anchors positions for the shape.\n   *\n   * @param {Konva.Rect} shape The associated shape.\n   * @returns {Point2D[]} The anchor positions.\n   */\n  #getAnchorsPositions(shape) {\n    const sx = shape.x();\n    const sy = shape.y();\n    const width = shape.width();\n    const height = shape.height();\n    return [\n      new Point2D(sx, sy),\n      new Point2D(sx + width, sy),\n      new Point2D(sx + width, sy + height),\n      new Point2D(sx, sy + height),\n    ];\n  }\n\n  /**\n   * Get anchors to update a rectangle shape.\n   *\n   * @param {Konva.Rect} shape The associated shape.\n   * @param {Style} style The application style.\n   * @returns {Konva.Ellipse[]} A list of anchors.\n   */\n  getAnchors(shape, style) {\n    const positions = this.#getAnchorsPositions(shape);\n    const anchors = [];\n    for (let i = 0; i < positions.length; ++i) {\n      anchors.push(getDefaultAnchor(\n        positions[i].getX(),\n        positions[i].getY(),\n        'anchor' + i,\n        style\n      ));\n    }\n    return anchors;\n  }\n\n  /**\n   * Constrain anchor movement.\n   *\n   * @param {Konva.Ellipse} _anchor The active anchor.\n   */\n  constrainAnchorMove(_anchor) {\n    // no constraints\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} style The application style.\n   */\n  updateShapeGroupOnAnchorMove(annotation, anchor, style) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n\n    // update shape and anchors\n    this.#updateShape(annotation, anchor, style);\n    // update label\n    this.updateLabelContent(annotation, group, style);\n    // update label position if default position\n    if (typeof annotation.labelPosition === 'undefined') {\n      this.#labelFactory.updatePosition(annotation, group);\n    }\n    // update connector\n    this.updateConnector(group);\n    // update shadow\n    if (DRAW_DEBUG) {\n      this.#updateDebugShadow(annotation, group);\n    }\n  }\n\n  /**\n   * Update an annotation on anchor move.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Konva.Shape} anchor The anchor.\n   */\n  updateAnnotationOnAnchorMove(annotation, anchor) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // find anchors\n    const topLeft = getAnchorShape(group, 0);\n    const bottomRight = getAnchorShape(group, 2);\n\n    const pointTopLeft = new Point2D(\n      topLeft.x(),\n      topLeft.y()\n    );\n    const pointBottomRight = new Point2D(\n      bottomRight.x(),\n      bottomRight.y()\n    );\n    // new rect\n    annotation.mathShape = new Rectangle(pointTopLeft, pointBottomRight);\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update an annotation on translation (shape move).\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {object} translation The translation.\n   */\n  updateAnnotationOnTranslation(annotation, translation) {\n    // math shape\n    const rectangle = annotation.mathShape;\n    const begin = rectangle.getBegin();\n    const newBegin = new Point2D(\n      begin.getX() + translation.x,\n      begin.getY() + translation.y\n    );\n    const end = rectangle.getEnd();\n    const newEnd = new Point2D(\n      end.getX() + translation.x,\n      end.getY() + translation.y\n    );\n    annotation.mathShape = new Rectangle(newBegin, newEnd);\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update the shape label content.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Group} group The shape group.\n   * @param {Style} _style The application style.\n   */\n  updateLabelContent(annotation, group, _style) {\n    this.#labelFactory.updateContent(annotation, group);\n  }\n\n  /**\n   * Update the shape connector.\n   *\n   * @param {Konva.Group} group The shape group.\n   */\n  updateConnector(group) {\n    const kshape = this.#getShape(group);\n    const connectorsPos = this.#getConnectorsPositions(kshape);\n    this.#labelFactory.updateConnector(group, connectorsPos);\n  }\n\n  /**\n   * Calculate the mathematical shape from a list of points.\n   *\n   * @param {Point2D[]} points The points that define the shape.\n   * @returns {Rectangle} The mathematical shape.\n   */\n  #calculateMathShape(points) {\n    return new Rectangle(points[0], points[1]);\n  }\n\n  /**\n   * Get the default labels.\n   *\n   * @returns {object} The label list.\n   */\n  #getDefaultLabel() {\n    if (typeof custom.labelTexts !== 'undefined' &&\n      typeof custom.labelTexts[this.#name] !== 'undefined'\n    ) {\n      return custom.labelTexts[this.#name];\n    } else {\n      return defaultLabelTexts[this.#name];\n    }\n  }\n\n  /**\n   * Creates the konva shape.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Rect} The konva shape.\n   */\n  #createShape(annotation, style) {\n    const rectangle = annotation.mathShape;\n    // konva rect\n    return new Konva.Rect({\n      x: rectangle.getBegin().getX(),\n      y: rectangle.getBegin().getY(),\n      width: rectangle.getWidth(),\n      height: rectangle.getHeight(),\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      name: 'shape'\n    });\n  }\n\n  /**\n   * Get the associated shape from a group.\n   *\n   * @param {Konva.Group} group The group to look into.\n   * @returns {Konva.Rect|undefined} The shape.\n   */\n  #getShape(group) {\n    const kshape = group.getChildren(isNodeNameShape)[0];\n    if (!(kshape instanceof Konva.Rect)) {\n      return;\n    }\n    return kshape;\n  }\n\n  /**\n   * Get the default annotation label position.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @returns {Point2D} The position.\n   */\n  #getDefaultLabelPosition(annotation) {\n    const rectangle = annotation.mathShape;\n    return new Point2D(\n      rectangle.getBegin().getX(),\n      rectangle.getEnd().getY(),\n    );\n  }\n\n  /**\n   * Update shape on anchor move.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} _style The application style.\n   */\n  #updateShape(annotation, anchor, _style) {\n    const rectangle = annotation.mathShape;\n    const begin = rectangle.getBegin();\n\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const krect = this.#getShape(group);\n    // update shape\n    krect.position({\n      x: begin.getX(),\n      y: begin.getY()\n    });\n    krect.size({\n      width: rectangle.getWidth(),\n      height: rectangle.getHeight()\n    });\n\n    // find anchors\n    const topLeft = getAnchorShape(group, 0);\n    const topRight = getAnchorShape(group, 1);\n    const bottomRight = getAnchorShape(group, 2);\n    const bottomLeft = getAnchorShape(group, 3);\n\n    // update 'self' (undo case) and other anchors\n    switch (anchor.id()) {\n      case 'anchor0':\n        // update self\n        topLeft.x(anchor.x());\n        topLeft.y(anchor.y());\n        // update others\n        topRight.y(anchor.y());\n        bottomLeft.x(anchor.x());\n        break;\n      case 'anchor1':\n        // update self\n        topRight.x(anchor.x());\n        topRight.y(anchor.y());\n        // update others\n        topLeft.y(anchor.y());\n        bottomRight.x(anchor.x());\n        break;\n      case 'anchor2':\n        // update self\n        bottomRight.x(anchor.x());\n        bottomRight.y(anchor.y());\n        // update others\n        bottomLeft.y(anchor.y());\n        topRight.x(anchor.x());\n        break;\n      case 'anchor3':\n        // update self\n        bottomLeft.x(anchor.x());\n        bottomLeft.y(anchor.y());\n        // update others\n        bottomRight.y(anchor.y());\n        topLeft.x(anchor.x());\n        break;\n      default :\n        logger.error('Unhandled anchor id: ' + anchor.id());\n        break;\n    }\n  }\n\n  /**\n   * Get the debug shadow.\n   *\n   * @param {Annotation} annotation The anootation to shadow.\n   * @param {Konva.Group} [_group] The associated group.\n   * @returns {Konva.Rect} The shadow konva rect.\n   */\n  #getDebugShadow(annotation, _group) {\n    const rectangle = annotation.mathShape;\n    const round = rectangle.getRound();\n    const rWidth = round.max.getX() - round.min.getX();\n    const rHeight = round.max.getY() - round.min.getY();\n    return new Konva.Rect({\n      x: round.min.getX(),\n      y: round.min.getY(),\n      width: rWidth,\n      height: rHeight,\n      fill: annotation.colour,\n      strokeWidth: 0,\n      strokeScaleEnabled: false,\n      opacity: 0.3,\n      name: 'shadow'\n    });\n  }\n\n  /**\n   * Update the debug shadow.\n   *\n   * @param {Annotation} annotation The annotation to shadow.\n   * @param {Konva.Group} group The associated group.\n   */\n  #updateDebugShadow(annotation, group) {\n    const kshadow = group.getChildren(function (node) {\n      return node.name() === 'shadow';\n    })[0];\n    if (typeof kshadow !== 'undefined') {\n      // remove previous\n      kshadow.destroy();\n      // add new\n      const shadow = this.#getDebugShadow(annotation);\n      group.add(shadow);\n      // move to bottom to not bother main shape\n      shadow.moveToBottom();\n    }\n  }\n\n} // class RectangleFactory\n","import {ROI} from '../math/roi.js';\nimport {Point2D} from '../math/point.js';\nimport {custom} from '../app/custom.js';\nimport {\n  defaultLabelTexts,\n  getLineShape,\n  DRAW_DEBUG,\n  getDefaultAnchor,\n  getAnchorIndex\n} from './drawBounds.js';\nimport {LabelFactory} from './labelFactory.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Style} from '../gui/style.js';\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * ROI factory.\n */\nexport class RoiFactory {\n\n  /**\n   * The name of the factory.\n   *\n   * @type {string}\n   */\n  #name = 'roi';\n\n  /**\n   * The associated label factory.\n   *\n   * @type {LabelFactory}\n   */\n  #labelFactory = new LabelFactory(this.#getDefaultLabelPosition);\n\n  /**\n   * Does this factory support the input math shape.\n   *\n   * @param {object} mathShape The mathematical shape.\n   * @returns {boolean} True if supported.\n   */\n  static supports(mathShape) {\n    return mathShape instanceof ROI;\n  }\n\n  /**\n   * Get the name of the factory.\n   *\n   * @returns {string} The name.\n   */\n  getName() {\n    return this.#name;\n  }\n\n  /**\n   * Get the name of the shape group.\n   *\n   * @returns {string} The name.\n   */\n  getGroupName() {\n    return this.#name + '-group';\n  }\n\n  /**\n   * Get the number of points needed to build the shape.\n   *\n   * @returns {number|undefined} The number of points.\n   */\n  getNPoints() {\n    // undefined to end with double click\n    return undefined;\n  }\n\n  /**\n   * Get the timeout between point storage.\n   *\n   * @returns {number} The timeout in milliseconds.\n   */\n  getTimeout() {\n    return 100;\n  }\n\n  /**\n   * Set an annotation math shape from input points.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Point2D[]} points The points.\n   */\n  setAnnotationMathShape(annotation, points) {\n    annotation.mathShape = this.#calculateMathShape(points);\n    annotation.setTextExpr(this.#getDefaultLabel());\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Create a roi shape to be displayed.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Group} The Konva group.\n   */\n  createShapeGroup(annotation, style) {\n    // konva group\n    const group = new Konva.Group();\n    group.name(this.getGroupName());\n    group.visible(true);\n    group.id(annotation.trackingUid);\n    // konva shape\n    const shape = this.#createShape(annotation, style);\n    group.add(this.#createShape(annotation, style));\n    // konva label\n    const label = this.#labelFactory.create(annotation, style);\n    group.add(this.#labelFactory.create(annotation, style));\n    // label-shape connector\n    const connectorsPos = this.#getConnectorsPositions(shape);\n    group.add(this.#labelFactory.getConnector(connectorsPos, label, style));\n\n    // konva shadow (if debug)\n    if (DRAW_DEBUG) {\n      group.add(this.#getDebugShadow(annotation));\n    }\n    return group;\n  }\n\n  /**\n   * Get the anchors positions for the shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @returns {Point2D[]} The anchor positions.\n   */\n  #getAnchorsPositions(shape) {\n    const points = shape.points();\n    const sx = shape.x();\n    const sy = shape.y();\n    const positions = [];\n    for (let i = 0; i < points.length; i = i + 2) {\n      positions.push(new Point2D(\n        points[i] + sx,\n        points[i + 1] + sy\n      ));\n    }\n    return positions;\n  }\n\n  /**\n   * Get the connectors positions for the shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @returns {Point2D[]} The connectors positions.\n   */\n  #getConnectorsPositions(shape) {\n    const points = shape.points();\n    const sx = shape.x();\n    const sy = shape.y();\n    const positions = [];\n    for (let i = 0; i < points.length; i += 2) {\n      const nextIndex = (i + 2) % points.length;\n      const midX = (points[i] + points[nextIndex]) / 2 + sx;\n      const midY = (points[i + 1] + points[nextIndex + 1]) / 2 + sy;\n      positions.push(new Point2D(midX, midY));\n    }\n    return positions;\n  }\n\n  /**\n   * Get anchors to update a roi shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @param {Style} style The application style.\n   * @returns {Konva.Ellipse[]} A list of anchors.\n   */\n  getAnchors(shape, style) {\n    const positions = this.#getAnchorsPositions(shape);\n    const anchors = [];\n    for (let i = 0; i < positions.length; ++i) {\n      anchors.push(getDefaultAnchor(\n        positions[i].getX(),\n        positions[i].getY(),\n        'anchor' + i,\n        style\n      ));\n    }\n    return anchors;\n  }\n\n  /**\n   * Constrain anchor movement.\n   *\n   * @param {Konva.Ellipse} _anchor The active anchor.\n   */\n  constrainAnchorMove(_anchor) {\n    // no constraints\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} style The application style.\n   */\n  updateShapeGroupOnAnchorMove(annotation, anchor, style) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n\n    // update shape and anchors\n    this.#updateShape(annotation, anchor, style);\n    // update label\n    this.updateLabelContent(annotation, group, style);\n    // update label position if default position\n    if (typeof annotation.labelPosition === 'undefined') {\n      this.#labelFactory.updatePosition(annotation, group);\n    }\n    // update connector\n    this.updateConnector(group);\n    // update shadow\n    if (DRAW_DEBUG) {\n      this.#updateDebugShadow(annotation, group);\n    }\n  }\n\n  /**\n   * Update an annotation on anchor move.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Konva.Shape} anchor The anchor.\n   */\n  updateAnnotationOnAnchorMove(annotation, anchor) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kroi = this.#getShape(group);\n\n    // update the roi point and compensate for possible drag\n    // (the anchor id is the index of the point in the main list)\n    const roi = annotation.mathShape;\n    const points = roi.getPoints().slice();\n    const newPoint = new Point2D(\n      anchor.x() - kroi.x(),\n      anchor.y() - kroi.y()\n    );\n    const index = getAnchorIndex(anchor.id());\n    points[index] = newPoint;\n\n    // new math shape\n    annotation.mathShape = new ROI(points);\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update an annotation on translation (shape move).\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {object} translation The translation.\n   */\n  updateAnnotationOnTranslation(annotation, translation) {\n    // math shape\n    const roi = annotation.mathShape;\n    const newPoints = [];\n    for (let i = 0; i < roi.getLength(); ++i) {\n      newPoints.push(new Point2D(\n        roi.getPoint(i).getX() + translation.x,\n        roi.getPoint(i).getY() + translation.y\n      ));\n    }\n    annotation.mathShape = new ROI(newPoints);\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update the shape label.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Group} group The shape group.\n   * @param {Style} _style The application style.\n   */\n  updateLabelContent(annotation, group, _style) {\n    this.#labelFactory.updateContent(annotation, group);\n  }\n\n  /**\n   * Update the shape connector.\n   *\n   * @param {Konva.Group} group The shape group.\n   */\n  updateConnector(group) {\n    const kshape = this.#getShape(group);\n    const connectorsPos = this.#getConnectorsPositions(kshape);\n    this.#labelFactory.updateConnector(group, connectorsPos);\n  }\n\n  /**\n   * Calculate the mathematical shape from a list of points.\n   *\n   * @param {Point2D[]} points The points that define the shape.\n   * @returns {ROI} The mathematical shape.\n   */\n  #calculateMathShape(points) {\n    return new ROI(points);\n  }\n\n  /**\n   * Get the default labels.\n   *\n   * @returns {object} The label list.\n   */\n  #getDefaultLabel() {\n    if (typeof custom.labelTexts !== 'undefined' &&\n      typeof custom.labelTexts[this.#name] !== 'undefined'\n    ) {\n      return custom.labelTexts[this.#name];\n    } else {\n      return defaultLabelTexts[this.#name];\n    }\n  }\n\n  /**\n   * Creates the konva shape.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Line} The konva shape.\n   */\n  #createShape(annotation, style) {\n    const roi = annotation.mathShape;\n    // konva line\n    const arr = [];\n    for (let i = 0; i < roi.getLength(); ++i) {\n      arr.push(roi.getPoint(i).getX());\n      arr.push(roi.getPoint(i).getY());\n    }\n    return new Konva.Line({\n      points: arr,\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      name: 'shape',\n      closed: true\n    });\n  }\n\n  /**\n   * Get the associated shape from a group.\n   *\n   * @param {Konva.Group} group The group to look into.\n   * @returns {Konva.Line|undefined} The shape.\n   */\n  #getShape(group) {\n    return getLineShape(group);\n  }\n\n  /**\n   * Get the default annotation label position.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @returns {Point2D} The position.\n   */\n  #getDefaultLabelPosition(annotation) {\n    const roi = annotation.mathShape;\n    return new Point2D(\n      roi.getPoint(0).getX(),\n      roi.getPoint(0).getY()\n    );\n  }\n\n  /**\n   * Update shape on anchor move.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} _style The application style.\n   */\n  #updateShape(annotation, anchor, _style) {\n\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kroi = this.#getShape(group);\n    // update the roi point and compensate for possible drag\n    // (the anchor id is the index of the point in the main list)\n    const points = kroi.points();\n    const index = getAnchorIndex(anchor.id()) * 2;\n    points[index] = anchor.x() - kroi.x();\n    points[index + 1] = anchor.y() - kroi.y();\n    kroi.points(points);\n\n    // update self\n    const point = group.getChildren(function (node) {\n      return node.id() === anchor.id();\n    })[0];\n\n    point.x(anchor.x());\n    point.y(anchor.y());\n  }\n\n  /**\n   * Get the debug shadow.\n   *\n   * @param {Annotation} _annotation The anootation to shadow.\n   * @param {Konva.Group} [_group] The associated group.\n   * @returns {Konva.Line} The shadow konva line.\n   */\n  #getDebugShadow(_annotation, _group) {\n    // does nothing\n    return undefined;\n  }\n\n  /**\n   * Update the debug shadow.\n   *\n   * @param {Annotation} _annotation The annotation to shadow.\n   * @param {Konva.Group} _group The associated group.\n   */\n  #updateDebugShadow(_annotation, _group) {\n    // does nothing\n  }\n\n} // class RoiFactory\n","import {Line, getPerpendicularLine} from '../math/line.js';\nimport {Point2D} from '../math/point.js';\nimport {logger} from '../utils/logger.js';\nimport {custom} from '../app/custom.js';\nimport {\n  defaultLabelTexts,\n  getLineShape,\n  DRAW_DEBUG,\n  getDefaultAnchor,\n  getAnchorShape\n} from './drawBounds.js';\nimport {LabelFactory} from './labelFactory.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Style} from '../gui/style.js';\nimport {Annotation} from '../image/annotation.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Ruler factory.\n */\nexport class RulerFactory {\n\n  /**\n   * The name of the factory.\n   *\n   * @type {string}\n   */\n  #name = 'ruler';\n\n  /**\n   * The associated label factory.\n   *\n   * @type {LabelFactory}\n   */\n  #labelFactory = new LabelFactory(this.#getDefaultLabelPosition);\n\n  /**\n   * Does this factory support the input math shape.\n   *\n   * @param {object} mathShape The mathematical shape.\n   * @returns {boolean} True if supported.\n   */\n  static supports(mathShape) {\n    return mathShape instanceof Line;\n  }\n\n  /**\n   * Get the name of the factory.\n   *\n   * @returns {string} The name.\n   */\n  getName() {\n    return this.#name;\n  }\n\n  /**\n   * Get the name of the shape group.\n   *\n   * @returns {string} The name.\n   */\n  getGroupName() {\n    return this.#name + '-group';\n  }\n\n  /**\n   * Get the number of points needed to build the shape.\n   *\n   * @returns {number} The number of points.\n   */\n  getNPoints() {\n    return 2;\n  }\n\n  /**\n   * Get the timeout between point storage.\n   *\n   * @returns {number} The timeout in milliseconds.\n   */\n  getTimeout() {\n    return 0;\n  }\n\n  /**\n   * Set an annotation math shape from input points.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Point2D[]} points The points.\n   */\n  setAnnotationMathShape(annotation, points) {\n    annotation.mathShape = this.#calculateMathShape(points);\n    annotation.setTextExpr(this.#getDefaultLabel());\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Create a line shape to be displayed.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Group} The Konva group.\n   */\n  createShapeGroup(annotation, style) {\n    // konva group\n    const group = new Konva.Group();\n    group.name(this.getGroupName());\n    group.visible(true);\n    group.id(annotation.trackingUid);\n    // konva shape\n    const shape = this.#createShape(annotation, style);\n    group.add(this.#createShape(annotation, style));\n    // extras\n    const extras = this.#createShapeExtras(annotation, style);\n    for (const extra of extras) {\n      group.add(extra);\n    }\n    // konva label\n    const label = this.#labelFactory.create(annotation, style);\n    group.add(this.#labelFactory.create(annotation, style));\n    // label-shape connector\n    const connectorsPos = this.#getConnectorsPositions(shape);\n    group.add(this.#labelFactory.getConnector(connectorsPos, label, style));\n    // konva shadow (if debug)\n    if (DRAW_DEBUG) {\n      group.add(this.#getDebugShadow(annotation));\n    }\n    return group;\n  }\n\n  /**\n   * Get the connectors positions for the shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @returns {Point2D[]} The connectors positions.\n   */\n  #getConnectorsPositions(shape) {\n    const points = shape.points();\n    const sx = shape.x();\n    const sy = shape.y();\n    const centerX = (points[0] + points[2]) / 2 + sx;\n    const centerY = (points[1] + points[3]) / 2 + sy;\n    return [new Point2D(centerX, centerY)];\n  }\n\n  /**\n   * Get the anchors positions for the shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @returns {Point2D[]} The anchor positions.\n   */\n  #getAnchorsPositions(shape) {\n    const points = shape.points();\n    const sx = shape.x();\n    const sy = shape.y();\n    return [\n      new Point2D(points[0] + sx, points[1] + sy),\n      new Point2D(points[2] + sx, points[3] + sy)\n    ];\n  }\n\n  /**\n   * Get anchors to update a line shape.\n   *\n   * @param {Konva.Line} shape The associated shape.\n   * @param {Style} style The application style.\n   * @returns {Konva.Ellipse[]} A list of anchors.\n   */\n  getAnchors(shape, style) {\n    const positions = this.#getAnchorsPositions(shape);\n    const anchors = [];\n    for (let i = 0; i < positions.length; ++i) {\n      anchors.push(getDefaultAnchor(\n        positions[i].getX(),\n        positions[i].getY(),\n        'anchor' + i,\n        style\n      ));\n    }\n    return anchors;\n  }\n\n  /**\n   * Constrain anchor movement.\n   *\n   * @param {Konva.Ellipse} _anchor The active anchor.\n   */\n  constrainAnchorMove(_anchor) {\n    // no constraints\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} style The application style.\n   */\n  updateShapeGroupOnAnchorMove(annotation, anchor, style) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n\n    // update shape and anchors\n    this.#updateShape(annotation, anchor, style);\n    // update label\n    this.updateLabelContent(annotation, group, style);\n    // update label position if default position\n    if (typeof annotation.labelPosition === 'undefined') {\n      this.#labelFactory.updatePosition(annotation, group);\n    }\n    // update connector\n    this.updateConnector(group);\n    // update shadow\n    if (DRAW_DEBUG) {\n      this.#updateDebugShadow(annotation, group);\n    }\n  }\n\n  /**\n   * Update an annotation on anchor move.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {Konva.Shape} anchor The anchor.\n   */\n  updateAnnotationOnAnchorMove(annotation, anchor) {\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kline = this.#getShape(group);\n    // find anchors\n    const begin = getAnchorShape(group, 0);\n    const end = getAnchorShape(group, 1);\n\n    // math shape\n    // compensate for possible shape drag\n    const pointBegin = new Point2D(\n      begin.x() - kline.x(),\n      begin.y() - kline.y()\n    );\n    const pointEnd = new Point2D(\n      end.x() - kline.x(),\n      end.y() - kline.y()\n    );\n    annotation.mathShape = new Line(pointBegin, pointEnd);\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update an annotation on translation (shape move).\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {object} translation The translation.\n   */\n  updateAnnotationOnTranslation(annotation, translation) {\n    // math shape\n    const line = annotation.mathShape;\n    const begin = line.getBegin();\n    const newBegin = new Point2D(\n      begin.getX() + translation.x,\n      begin.getY() + translation.y\n    );\n    const end = line.getEnd();\n    const newEnd = new Point2D(\n      end.getX() + translation.x,\n      end.getY() + translation.y\n    );\n    annotation.mathShape = new Line(newBegin, newEnd);\n    // quantification\n    annotation.updateQuantification();\n  }\n\n  /**\n   * Update the shape label.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Group} group The shape group.\n   * @param {Style} _style The application style.\n   */\n  updateLabelContent(annotation, group, _style) {\n    this.#labelFactory.updateContent(annotation, group);\n  }\n\n  /**\n   * Update the shape connector.\n   *\n   * @param {Konva.Group} group The shape group.\n   */\n  updateConnector(group) {\n    const kshape = this.#getShape(group);\n    const connectorsPos = this.#getConnectorsPositions(kshape);\n    this.#labelFactory.updateConnector(group, connectorsPos);\n  }\n\n  /**\n   * Calculate the mathematical shape from a list of points.\n   *\n   * @param {Point2D[]} points The points that define the shape.\n   * @returns {Line} The mathematical shape.\n   */\n  #calculateMathShape(points) {\n    return new Line(points[0], points[1]);\n  }\n\n  /**\n   * Get the default labels.\n   *\n   * @returns {object} The label list.\n   */\n  #getDefaultLabel() {\n    if (typeof custom.labelTexts !== 'undefined' &&\n      typeof custom.labelTexts[this.#name] !== 'undefined'\n    ) {\n      return custom.labelTexts[this.#name];\n    } else {\n      return defaultLabelTexts[this.#name];\n    }\n  }\n\n  /**\n   * Creates the konva shape.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Konva.Line} The konva shape.\n   */\n  #createShape(annotation, style) {\n    const line = annotation.mathShape;\n\n    // konva line\n    const kshape = new Konva.Line({\n      points: [\n        line.getBegin().getX(),\n        line.getBegin().getY(),\n        line.getEnd().getX(),\n        line.getEnd().getY()\n      ],\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      name: 'shape'\n    });\n\n    // larger hitfunc\n    const tickLen = 20;\n    const linePerp0 = getPerpendicularLine(\n      line, line.getBegin(), tickLen, style.getZoomScale());\n    const linePerp1 = getPerpendicularLine(\n      line, line.getEnd(), tickLen, style.getZoomScale());\n    kshape.hitFunc(function (context) {\n      context.beginPath();\n      context.moveTo(linePerp0.getBegin().getX(), linePerp0.getBegin().getY());\n      context.lineTo(linePerp0.getEnd().getX(), linePerp0.getEnd().getY());\n      context.lineTo(linePerp1.getEnd().getX(), linePerp1.getEnd().getY());\n      context.lineTo(linePerp1.getBegin().getX(), linePerp1.getBegin().getY());\n      context.closePath();\n      context.fillStrokeShape(kshape);\n    });\n\n    return kshape;\n  }\n\n  /**\n   * Get the associated shape from a group.\n   *\n   * @param {Konva.Group} group The group to look into.\n   * @returns {Konva.Line|undefined} The shape.\n   */\n  #getShape(group) {\n    return getLineShape(group);\n  }\n\n  /**\n   * Creates the konva shape extras.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Style} style The drawing style.\n   * @returns {Array} The konva shape extras.\n   */\n  #createShapeExtras(annotation, style) {\n    const line = annotation.mathShape;\n\n    const tickLen = 20;\n\n    // tick begin\n    const linePerp0 = getPerpendicularLine(\n      line, line.getBegin(), tickLen, style.getZoomScale());\n    const ktick0 = new Konva.Line({\n      points: [\n        linePerp0.getBegin().getX(),\n        linePerp0.getBegin().getY(),\n        linePerp0.getEnd().getX(),\n        linePerp0.getEnd().getY()\n      ],\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      name: 'shape-tick0'\n    });\n\n    // tick end\n    const linePerp1 = getPerpendicularLine(\n      line, line.getEnd(), tickLen, style.getZoomScale());\n    const ktick1 = new Konva.Line({\n      points: [\n        linePerp1.getBegin().getX(),\n        linePerp1.getBegin().getY(),\n        linePerp1.getEnd().getX(),\n        linePerp1.getEnd().getY()\n      ],\n      stroke: annotation.colour,\n      strokeWidth: style.getStrokeWidth(),\n      strokeScaleEnabled: false,\n      name: 'shape-tick1'\n    });\n\n    return [ktick0, ktick1];\n  }\n\n  /**\n   * Get the default annotation label position.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @returns {Point2D} The position.\n   */\n  #getDefaultLabelPosition(annotation) {\n    const line = annotation.mathShape;\n    const begin = line.getBegin();\n    const end = line.getEnd();\n    // lowest point\n    let res = begin;\n    if (begin.getY() < end.getY()) {\n      res = end;\n    }\n    return res;\n  }\n\n  /**\n   * Update shape and label on anchor move taking the updated\n   *   annotation as input.\n   *\n   * @param {Annotation} annotation The associated annotation.\n   * @param {Konva.Ellipse} anchor The active anchor.\n   * @param {Style} style The application style.\n   */\n  #updateShape(annotation, anchor, style) {\n    const line = annotation.mathShape;\n\n    // parent group\n    const group = anchor.getParent();\n    if (!(group instanceof Konva.Group)) {\n      return;\n    }\n    // associated shape\n    const kline = this.#getShape(group);\n\n    // reset position after possible shape drag\n    kline.position({x: 0, y: 0});\n    // update shape\n    kline.points([\n      line.getBegin().getX(),\n      line.getBegin().getY(),\n      line.getEnd().getX(),\n      line.getEnd().getY(),\n    ]);\n\n    // associated tick0\n    const ktick0 = group.getChildren(function (node) {\n      return node.name() === 'shape-tick0';\n    })[0];\n    if (!(ktick0 instanceof Konva.Line)) {\n      return;\n    }\n    // associated tick1\n    const ktick1 = group.getChildren(function (node) {\n      return node.name() === 'shape-tick1';\n    })[0];\n    if (!(ktick1 instanceof Konva.Line)) {\n      return;\n    }\n    // find anchors\n    const begin = getAnchorShape(group, 0);\n    const end = getAnchorShape(group, 1);\n\n    // update 'self' (undo case)\n    switch (anchor.id()) {\n      case 'anchor0':\n        begin.x(anchor.x());\n        begin.y(anchor.y());\n        break;\n      case 'anchor1':\n        end.x(anchor.x());\n        end.y(anchor.y());\n        break;\n      default:\n        logger.error('Unhandled anchor id: ' + anchor.id());\n        break;\n    }\n\n    // tick\n    const tickLen = 20;\n    const linePerp0 = getPerpendicularLine(\n      line, line.getBegin(), tickLen, style.getZoomScale());\n    ktick0.position({x: 0, y: 0});\n    ktick0.points([linePerp0.getBegin().getX(),\n      linePerp0.getBegin().getY(),\n      linePerp0.getEnd().getX(),\n      linePerp0.getEnd().getY()]);\n    const linePerp1 = getPerpendicularLine(\n      line, line.getEnd(), tickLen, style.getZoomScale());\n    ktick1.position({x: 0, y: 0});\n    ktick1.points([linePerp1.getBegin().getX(),\n      linePerp1.getBegin().getY(),\n      linePerp1.getEnd().getX(),\n      linePerp1.getEnd().getY()]);\n\n    // larger hitfunc\n    kline.hitFunc(function (context) {\n      context.beginPath();\n      context.moveTo(linePerp0.getBegin().getX(), linePerp0.getBegin().getY());\n      context.lineTo(linePerp0.getEnd().getX(), linePerp0.getEnd().getY());\n      context.lineTo(linePerp1.getEnd().getX(), linePerp1.getEnd().getY());\n      context.lineTo(linePerp1.getBegin().getX(), linePerp1.getBegin().getY());\n      context.closePath();\n      context.fillStrokeShape(kline);\n    });\n  }\n\n  /**\n   * Get the debug shadow.\n   *\n   * @param {Annotation} _annotation The annotation to shadow.\n   * @param {Konva.Group} [_group] The associated group.\n   * @returns {Konva.Group|undefined} The shadow konva group.\n   */\n  #getDebugShadow(_annotation, _group) {\n    return;\n  }\n\n  /**\n   * Update the debug shadow.\n   *\n   * @param {Annotation} _annotation The annotation to shadow.\n   * @param {Konva.Group} _group The associated group.\n   */\n  #updateDebugShadow(_annotation, _group) {\n    // does nothing\n  }\n\n} // class RulerFactory\n","import {logger} from '../utils/logger.js';\nimport {getFlags, replaceFlags} from '../utils/string.js';\nimport {Point} from '../math/point.js';\nimport {getOrientationName} from '../math/orientation.js';\nimport {defaultToolOptions, toolOptions} from '../tools/index.js';\nimport {guid} from '../math/stats.js';\nimport {getUID} from '../dicom/dicomWriter.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point2D, Point3D} from '../math/point.js';\nimport {Index} from '../math/index.js';\nimport {Value} from '../math/value.js';\nimport {ViewController} from '../app/viewController.js';\nimport {PlaneHelper} from './planeHelper.js';\nimport {DicomCode} from '../dicom/dicomCode.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Image annotation.\n */\nexport class Annotation {\n  /**\n   * Tracking id, unique within domain.\n   *\n   * @type {string}\n   */\n  trackingId;\n\n  /**\n   * Tracking Unique id.\n   *\n   * @type {string}\n   */\n  trackingUid;\n\n  /**\n   * Referenced image SOP isntance UID.\n   *\n   * @type {string}\n   */\n  referencedSopInstanceUID;\n\n  /**\n   * Referenced image SOP class UID.\n   *\n   * @type {string}\n   */\n  referencedSopClassUID;\n\n  /**\n   * Referenced frame number.\n   *\n   * @type {number|undefined}\n   */\n  referencedFrameNumber;\n\n  /**\n   * Mathematical shape.\n   *\n   * @type {object}\n   */\n  mathShape;\n\n  /**\n   * Additional points used to define the annotation.\n   *\n   * @type {Point2D[]|undefined}\n   */\n  referencePoints;\n\n  /**\n   * Colour: for example 'green', '#00ff00' or 'rgb(0,255,0)'.\n   *\n   * @type {string}\n   */\n  colour = '#ffff80';\n\n  /**\n   * Annotation quantification.\n   *\n   * @type {Object<string, Value>|undefined}\n   */\n  quantification;\n\n  /**\n   * Text expression. Can contain variables surrounded with '{}' that will\n   *   be extracted from the quantification object.\n   *\n   * @type {string}\n   */\n  textExpr = '';\n\n  /**\n   * Label position. If undefined, the default shape\n   *   label position will be used.\n   *\n   * @type {Point2D|undefined}\n   */\n  labelPosition;\n\n  /**\n   * Plane origin: 3D position of index [0, 0, k].\n   *\n   * @type {Point3D|undefined}\n   */\n  planeOrigin;\n\n  /**\n   * A couple of points that help define the annotation plane.\n   *\n   * @type {Point3D[]|undefined}\n   */\n  planePoints;\n\n  /**\n   * Associated view controller: needed for quantification and label.\n   *\n   * @type {ViewController|undefined}\n   */\n  #viewController;\n\n  /**\n   * Annotation meta data. Array of {concept:DicomCode, value:DicomCode}\n   *   or {concept:DicomCode, value:string}.\n   *\n   * @type {object}\n   */\n  #meta = {};\n\n  /**\n   * Constructor: set default annotation id and uid.\n   */\n  constructor() {\n    this.trackingId = guid();\n    this.trackingUid = getUID('TrackingUniqueIdentifier');\n  }\n\n  /**\n   * Get the concepts ids of the annotation meta data.\n   *\n   * @returns {string[]} The ids.\n   */\n  getMetaConceptIds() {\n    return Object.keys(this.#meta);\n  }\n\n  /**\n   * Get an annotation meta data.\n   *\n   * @param {string} conceptId The value of the concept dicom code.\n   * @returns {object|undefined} The corresponding meta data item\n   *   as {concept, value} or undefined.\n   */\n  getMetaItem(conceptId) {\n    return this.#meta[conceptId];\n  }\n\n  /**\n   * Add annotation meta data.\n   *\n   * @param {DicomCode} concept The concept code.\n   * @param {DicomCode|string} value The value code.\n   */\n  addMetaItem(concept, value) {\n    const conceptId = concept.value;\n    if (typeof this.#meta[conceptId] !== 'undefined') {\n      logger.warn('Overwriting annotation meta with id=' + conceptId);\n    }\n    this.#meta[concept.value] = {\n      concept: concept,\n      value: value\n    };\n  }\n\n  /**\n   * Remove an annotation meta data.\n   *\n   * @param {string} conceptId The value of the concept dicom code.\n   */\n  removeMetaItem(conceptId) {\n    if (typeof this.#meta[conceptId] !== 'undefined') {\n      delete this.#meta[conceptId];\n    }\n  }\n\n  /**\n   * Get the orientation name for this annotation.\n   *\n   * @returns {string|undefined} The orientation name,\n   *   undefined if same as reference data.\n   */\n  getOrientationName() {\n    let res;\n    if (typeof this.planePoints !== 'undefined') {\n      const cosines = this.planePoints[1].getValues().concat(\n        this.planePoints[2].getValues()\n      );\n      res = getOrientationName(cosines);\n    }\n    return res;\n  }\n\n  /**\n   * Initialise the annotation.\n   *\n   * @param {ViewController} viewController The associated view controller.\n   */\n  init(viewController) {\n    if (typeof this.referencedSopInstanceUID !== 'undefined') {\n      logger.debug('Cannot initialise annotation twice');\n      return;\n    }\n\n    this.#viewController = viewController;\n    const currentPosition = viewController.getCurrentPosition();\n    // set UID\n    this.referencedSopInstanceUID = viewController.getCurrentImageUid();\n    this.referencedSopClassUID = viewController.getSopClassUid();\n    if (currentPosition.length() > 3) {\n      this.referencedFrameNumber = currentPosition.get(3);\n    }\n    // set plane origin (not saved with file)\n    this.planeOrigin =\n      viewController.getOriginForImageUid(this.referencedSopInstanceUID);\n    // set plane points if not aquisition orientation\n    // (planePoints are saved with file if present)\n    if (!viewController.isAquisitionOrientation()) {\n      this.planePoints = viewController.getPlanePoints(currentPosition);\n    }\n  }\n\n  /**\n   * Check if the annotation can be displayed: true if it has\n   * an associated view controller.\n   *\n   * @returns {boolean} True if the annotation can be displayed.\n   */\n  canView() {\n    return typeof this.#viewController !== 'undefined';\n  }\n\n  /**\n   * Check if an input view is compatible with the annotation.\n   *\n   * @param {PlaneHelper} planeHelper The input view to check.\n   * @returns {boolean} True if compatible view.\n   */\n  isCompatibleView(planeHelper) {\n    let res = false;\n\n    // TODO: add check for referenceSopUID\n\n    if (typeof this.planePoints === 'undefined') {\n      // non oriented view\n      if (planeHelper.isAquisitionOrientation()) {\n        res = true;\n      }\n    } else {\n      // oriented view: compare cosines (independent of slice index)\n      const cosines = planeHelper.getCosines();\n      const cosine1 = new Point3D(cosines[0], cosines[1], cosines[2]);\n      const cosine2 = new Point3D(cosines[3], cosines[4], cosines[5]);\n\n      if (cosine1.equals(this.planePoints[1]) &&\n        cosine2.equals(this.planePoints[2])) {\n        res = true;\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Set the associated view controller if it is compatible.\n   *\n   * @param {ViewController} viewController The view controller.\n   */\n  setViewController(viewController) {\n    // check uid\n    if (!viewController.includesImageUid(this.referencedSopInstanceUID)) {\n      logger.warn('Cannot view annotation with reference UID: ' +\n        this.referencedSopInstanceUID);\n      return;\n    }\n    // check if same view\n    if (!this.isCompatibleView(viewController.getPlaneHelper())) {\n      return;\n    }\n    this.#viewController = viewController;\n\n    // set plane origin (not saved with file)\n    this.planeOrigin =\n      viewController.getOriginForImageUid(this.referencedSopInstanceUID);\n  }\n\n  /**\n   * Get the index of the plane origin.\n   *\n   * @returns {Index|undefined} The index.\n   */\n  #getOriginIndex() {\n    let res;\n    if (typeof this.#viewController !== 'undefined') {\n      let origin = this.planeOrigin;\n      if (typeof this.planePoints !== 'undefined') {\n        origin = this.planePoints[0];\n      }\n      const values = [origin.getX(), origin.getY(), origin.getZ()];\n      if (typeof this.referencedFrameNumber !== 'undefined') {\n        values.push(this.referencedFrameNumber);\n      }\n      const originPoint = new Point(values);\n      res = this.#viewController.getIndexFromPosition(originPoint);\n    }\n    return res;\n  }\n\n  /**\n   * Get the centroid of the math shape.\n   *\n   * @returns {Point|undefined} The 3D centroid point.\n   */\n  getCentroid() {\n    let res;\n    if (typeof this.#viewController !== 'undefined' &&\n      typeof this.mathShape.getCentroid !== 'undefined' &&\n      typeof this.mathShape.getCentroid() !== 'undefined') {\n      // find the slice index of the annotation origin\n      const originIndex = this.#getOriginIndex();\n      const scrollDimIndex = this.#viewController.getScrollDimIndex();\n      const k = originIndex.getValues()[scrollDimIndex];\n      // shape center converted to 3D\n      const planePoint = this.mathShape.getCentroid();\n      res = this.#viewController.getPositionFromPlanePoint(planePoint, k);\n      // add frame number if defined\n      if (typeof this.referencedFrameNumber !== 'undefined') {\n        const values = res.getValues();\n        values[3] = this.referencedFrameNumber;\n        res = new Point(values);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Set the annotation text expression.\n   *\n   * @param {Object.<string, string>} labelText The list of label\n   *   texts indexed by modality.\n   */\n  setTextExpr(labelText) {\n    if (typeof this.#viewController !== 'undefined') {\n      const modality = this.#viewController.getModality();\n\n      if (typeof labelText[modality] !== 'undefined') {\n        this.textExpr = labelText[modality];\n      } else {\n        this.textExpr = labelText['*'];\n      }\n    } else {\n      logger.warn('Cannot set text expr without a view controller');\n    }\n  }\n\n  /**\n   * Get the annotation label text by applying the\n   *   text expression on the current quantification.\n   *\n   * @returns {string} The resulting text.\n   */\n  getText() {\n    return replaceFlags(this.textExpr, this.quantification);\n  }\n\n  /**\n   * Update the annotation quantification.\n   */\n  updateQuantification() {\n    if (typeof this.#viewController !== 'undefined' &&\n      typeof this.mathShape.quantify !== 'undefined') {\n      this.quantification = this.mathShape.quantify(\n        this.#viewController,\n        this.#getOriginIndex(),\n        getFlags(this.textExpr)\n      );\n    }\n  }\n\n  /**\n   * Get the math shape associated draw factory.\n   *\n   * @returns {object|undefined} The factory.\n   */\n  getFactory() {\n    let fac;\n    // no factory if no mathShape\n    if (typeof this.mathShape === 'undefined') {\n      return fac;\n    }\n    // check in user provided factories\n    if (typeof toolOptions.draw !== 'undefined') {\n      for (const factoryName in toolOptions.draw) {\n        const factory = toolOptions.draw[factoryName];\n        if (factory.supports(this.mathShape)) {\n          fac = new factory();\n          break;\n        }\n      }\n    }\n    // check in default factories\n    if (typeof fac === 'undefined') {\n      for (const factoryName in defaultToolOptions.draw) {\n        const factory = defaultToolOptions.draw[factoryName];\n        if (factory.supports(this.mathShape)) {\n          fac = new factory();\n          break;\n        }\n      }\n    }\n    if (typeof fac === 'undefined') {\n      logger.warn('No shape factory found for math shape');\n    }\n    return fac;\n  }\n}\n","import {\n  dateToDateObj,\n  getDicomDate,\n  dateToTimeObj,\n  getDicomTime,\n} from '../dicom/dicomDate.js';\nimport {safeGet} from '../dicom/dataElement.js';\nimport {\n  ValueTypes,\n  RelationshipTypes,\n  ContinuityOfContents,\n  getSRContent,\n  getDicomSRContentItem,\n  getContentTemplate,\n  DicomSRContent,\n  getSRContentFromValue\n} from '../dicom/dicomSRContent.js';\nimport {\n  DcmCodes,\n  getDcmDicomCode,\n  getColourCode,\n  getQuantificationName,\n  getQuantificationUnit,\n  DicomCode,\n  getMeasurementUnitsCode,\n  isEqualCode\n} from '../dicom/dicomCode.js';\nimport {\n  isVersionInBounds,\n  getDwvVersionFromImplementationClassUID\n} from '../dicom/dicomParser.js';\nimport {MeasuredValue} from '../dicom/dicomMeasuredValue.js';\nimport {NumericMeasurement} from '../dicom/dicomNumericMeasurement.js';\nimport {getAsSimpleElements} from '../dicom/dicomTag.js';\nimport {getElementsFromJSONTags} from '../dicom/dicomWriter.js';\nimport {ImageReference} from '../dicom/dicomImageReference.js';\nimport {SopInstanceReference} from '../dicom/dicomSopInstanceReference.js';\nimport {\n  GraphicTypes,\n  getScoordFromShape,\n  getShapeFromScoord,\n  SpatialCoordinate\n} from '../dicom/dicomSpatialCoordinate.js';\nimport {SpatialCoordinate3D} from '../dicom/dicomSpatialCoordinate3D.js';\nimport {BIG_EPSILON_EXPONENT} from '../math/matrix.js';\nimport {precisionRound} from '../utils/string.js';\nimport {logger} from '../utils/logger.js';\nimport {Annotation} from './annotation.js';\nimport {AnnotationGroup} from './annotationGroup.js';\nimport {Point2D, Point3D} from '../math/point.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from '../dicom/dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  ImplementationClassUID: '00020012',\n  StudyInstanceUID: '0020000D',\n  StudyID: '00200010',\n  SeriesInstanceUID: '0020000E',\n  SeriesNumber: '00200011',\n  Modality: '00080060',\n  PatientName: '00100010',\n  PatientID: '00100020',\n  PatientBirthDate: '00100030',\n  PatientSex: '00100040',\n  CurrentRequestedProcedureEvidenceSequence: '0040A375'\n};\n\n/**\n * Merge two tag lists.\n *\n * @param {object} tags1 Base list, will be modified.\n * @param {object} tags2 List to merge.\n */\nfunction mergeTags(tags1, tags2) {\n  const keys2 = Object.keys(tags2);\n  for (const tagName2 of keys2) {\n    if (tags1[tagName2] !== undefined) {\n      logger.debug('Overwritting tag: ' + tagName2);\n    }\n    tags1[tagName2] = tags2[tagName2];\n  }\n}\n\n/**\n * Response evaluation class.\n */\nexport class ResponseEvaluation {\n  /**\n   * Current response.\n   *\n   * @type {DicomCode}\n   */\n  current;\n  /**\n   * Measurement of response (mm).\n   *\n   * @type {number}\n   */\n  measure;\n}\n\n/**\n * CAD report class.\n */\nexport class CADReport {\n  /**\n   * @type {AnnotationGroup[]}\n   */\n  annotationGroups;\n\n  /**\n   * @type {ResponseEvaluation[]}\n   */\n  responseEvaluations;\n\n  /**\n   * @type {string}\n   */\n  comment;\n}\n\n/**\n * {@link AnnotationGroup} factory.\n */\nexport class AnnotationGroupFactory {\n\n  /**\n   * Possible warning created by checkElements.\n   *\n   * @type {string|undefined}\n   */\n  #warning;\n\n  /**\n   * Get a warning string if elements are not as expected.\n   * Created by checkElements.\n   *\n   * @returns {string|undefined} The warning.\n   */\n  getWarning() {\n    return this.#warning;\n  }\n\n  /**\n   * Check if input elements contain a dwv 0.34 annotation.\n   *\n   * @param {Object<string, DataElement>} dataElements The DICOM data elements.\n   * @returns {boolean} True if the elements contain a dwv 0.34 annotation.\n   */\n  #isDwv034AnnotationDicomSR(dataElements) {\n    // version\n    const classUID =\n      safeGet(dataElements, TagKeys.ImplementationClassUID);\n    const dwvVersion = getDwvVersionFromImplementationClassUID(classUID);\n    const isDwv034 = typeof dwvVersion !== 'undefined' &&\n      isVersionInBounds(dwvVersion, '0.34.0', '0.35.0-beta.21');\n\n    // content template\n    const contentTemplate = getContentTemplate(dataElements);\n\n    // root SR concept\n    let rootConcept;\n    const srContent = getSRContent(dataElements);\n    if (typeof srContent.conceptNameCode !== 'undefined') {\n      rootConcept = srContent.conceptNameCode.value;\n    }\n\n    // dwv 0.34 annotations do not have template\n    return isDwv034 &&\n      typeof contentTemplate === 'undefined' &&\n      rootConcept === DcmCodes.MeasurementGroup.value;\n  }\n\n  /**\n   * Check if input elements contain a TID 1500 annotation.\n   * Ref: {@link https://dicom.nema.org/medical/Dicom/2022a/output/chtml/part16/chapter_A.html#sect_TID_1500}.\n   *\n   * @param {Object<string, DataElement>} dataElements The DICOM data elements.\n   * @returns {boolean} True if the elements contain a TID 1500 annotation.\n   */\n  #isTid1500AnnotationDicomSR(dataElements) {\n    // content template\n    const contentTemplate = getContentTemplate(dataElements);\n    const isTid1500Template = contentTemplate === 'DCMR-1500';\n\n    // root SR concept\n    let rootConcept;\n    const srContent = getSRContent(dataElements);\n    if (typeof srContent.conceptNameCode !== 'undefined') {\n      rootConcept = srContent.conceptNameCode.value;\n    }\n    const isImagingMeasurementReport =\n      rootConcept === DcmCodes.ImagingMeasurementReport.value;\n\n    let res = false;\n    if (isTid1500Template && isImagingMeasurementReport) {\n      // check for at least one:\n      // ImagingMeasurements\n      //   - MeasurementGroup\n      //     - ImageRegion (SCOORD) OR TID 300 Measure\n      const imagingMeas = srContent.contentSequence.find(\n        this.#isImagingMeasurementsItem\n      );\n      if (typeof imagingMeas !== 'undefined') {\n        const measGroup = imagingMeas.contentSequence.find(\n          this.#isMeasurementGroupItem\n        );\n        if (typeof measGroup !== 'undefined') {\n          const imageRegion = measGroup.contentSequence.find(\n            this.#isImageRegionItem\n          );\n          const measure = measGroup.contentSequence.find(\n            this.#isTid300Measurement\n          );\n          if (typeof imageRegion !== 'undefined' ||\n            typeof measure !== 'undefined'\n          ) {\n            res = true;\n          }\n        }\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Check if input elements contain a TID 4100 template.\n   * Ref: {@link https://dicom.nema.org/medical/Dicom/2022a/output/chtml/part16/chapter_A.html#sect_TID_4100}.\n   *\n   * @param {Object<string, DataElement>} dataElements The DICOM data elements.\n   * @returns {boolean} True if the elements contain a TID 4100 template.\n   */\n  #isTid4100DicomSR(dataElements) {\n    // content template\n    const contentTemplate = getContentTemplate(dataElements);\n    return contentTemplate === 'DCMR-4100';\n  }\n\n  /**\n   * Check dicom elements.\n   *\n   * @param {Object<string, DataElement>} dataElements The DICOM data elements.\n   * @returns {string|undefined} A possible warning.\n   */\n  checkElements(dataElements) {\n    // reset\n    this.#warning = undefined;\n\n    if (!this.#isDwv034AnnotationDicomSR(dataElements) &&\n      !this.#isTid1500AnnotationDicomSR(dataElements) &&\n      !this.#isTid4100DicomSR(dataElements)) {\n      this.#warning = 'Not a dwv supported annotation';\n    }\n\n    return this.#warning;\n  }\n\n  /**\n   * Add the source image to an annotation.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {DicomSRContent} content The content to add.\n   */\n  #addSourceImageToAnnotation(annotation, content) {\n    if (content.valueType === ValueTypes.image &&\n      content.relationshipType === RelationshipTypes.selectedFrom) {\n      annotation.referencedSopClassUID =\n        content.value.referencedSOPSequence.referencedSOPClassUID;\n      annotation.referencedSopInstanceUID =\n        content.value.referencedSOPSequence.referencedSOPInstanceUID;\n      if (typeof content.value.referencedFrameNumber !== 'undefined') {\n        annotation.referencedFrameNumber =\n          parseInt(content.value.referencedFrameNumber, 10);\n      }\n    }\n  }\n\n  /**\n   * Add ids to an annotation folowing the (wrong)\n   * dwv 0.34 format.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {DicomSRContent} content The content to add.\n   */\n  #addDwv034IdToAnnotation(annotation, content) {\n    // annotation id\n    if (content.hasHeader(\n      ValueTypes.uidref,\n      getDcmDicomCode(DcmCodes.TrackingIdentifier),\n      RelationshipTypes.hasProperties\n    )) {\n      annotation.trackingId = content.value;\n      // use it as uid\n      annotation.trackingUid = content.value;\n    }\n  }\n\n  /**\n   * Add ids to an annotation.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {DicomSRContent} content The content to add.\n   */\n  #addIdsToAnnotation(annotation, content) {\n    // annotation id\n    if (content.hasHeader(\n      ValueTypes.text,\n      getDcmDicomCode(DcmCodes.TrackingIdentifier),\n      RelationshipTypes.hasObsContext\n    )) {\n      annotation.trackingId = content.value;\n    }\n\n    // annotation uid\n    if (content.hasHeader(\n      ValueTypes.uidref,\n      getDcmDicomCode(DcmCodes.TrackingUniqueIdentifier),\n      RelationshipTypes.hasObsContext\n    )) {\n      annotation.trackingUid = content.value;\n    }\n  }\n\n  /**\n   * Add content to an annotation.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {DicomSRContent} content The content to add.\n   * @param {boolean} [isDwv034] True if the content was written using dwv 0.34,\n   * defaults to false.\n   */\n  #addContentToAnnotation(annotation, content, isDwv034) {\n    if (typeof isDwv034 === 'undefined') {\n      isDwv034 = false;\n    }\n    let relationshipType = RelationshipTypes.hasConceptMod;\n    if (isDwv034) {\n      relationshipType = RelationshipTypes.hasProperties;\n    }\n\n    // text expr\n    if (content.hasHeader(\n      ValueTypes.text,\n      getDcmDicomCode(DcmCodes.ShortLabel),\n      relationshipType\n    )) {\n      annotation.textExpr = content.value;\n      // optional label position\n      const scoord = content.contentSequence.find(function (item) {\n        return item.hasHeader(\n          ValueTypes.scoord,\n          getDcmDicomCode(DcmCodes.ReferencePoints),\n          RelationshipTypes.hasProperties\n        );\n      });\n      if (typeof scoord !== 'undefined') {\n        annotation.labelPosition = new Point2D(\n          scoord.value.graphicData[0],\n          scoord.value.graphicData[1]\n        );\n      }\n    }\n\n    // color\n    if (content.hasHeader(\n      ValueTypes.text,\n      getColourCode(),\n      relationshipType\n    )) {\n      annotation.colour = content.value;\n    }\n\n    // reference points\n    if (content.hasHeader(\n      ValueTypes.scoord,\n      getDcmDicomCode(DcmCodes.ReferencePoints),\n      relationshipType) &&\n      content.value.graphicType === GraphicTypes.multipoint\n    ) {\n      const points = [];\n      for (let i = 0; i < content.value.graphicData.length; i += 2) {\n        points.push(new Point2D(\n          content.value.graphicData[i],\n          content.value.graphicData[i + 1]\n        ));\n      }\n      annotation.referencePoints = points;\n    }\n\n    // plane points\n    if (content.hasHeader(\n      ValueTypes.scoord3d,\n      getDcmDicomCode(DcmCodes.ReferenceGeometry),\n      RelationshipTypes.contains) &&\n      content.value.graphicType === GraphicTypes.multipoint\n    ) {\n      const data = content.value.graphicData;\n      const points = [];\n      const nPoints = Math.floor(data.length / 3);\n      for (let i = 0; i < nPoints; ++i) {\n        const j = i * 3;\n        points.push(new Point3D(data[j], data[j + 1], data[j + 2]));\n      }\n      annotation.planePoints = points;\n    }\n\n    // quantification\n    this.#addQuantificationToAnnotation(annotation, content);\n    // meta\n    this.#addMetaToAnnotation(annotation, content);\n  }\n\n  /**\n   * Add quantification to an annotation.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {DicomSRContent} content The content to add.\n   * @param {string} [relationshipType] The content relationshipType, defaults\n   *   to 'CONTAINS'.\n   */\n  #addQuantificationToAnnotation(annotation, content, relationshipType) {\n    let relation;\n    if (typeof relationshipType === 'undefined') {\n      relation = RelationshipTypes.contains;\n    }\n    if (content.valueType === ValueTypes.num &&\n      content.relationshipType === relation) {\n      const quantifName =\n        getQuantificationName(content.conceptNameCode);\n      if (typeof quantifName !== 'undefined') {\n        const measuredValue = content.value.measuredValue;\n        const quantifUnit = getQuantificationUnit(\n          measuredValue.measurementUnitsCode);\n        if (typeof annotation.quantification === 'undefined') {\n          annotation.quantification = {};\n        }\n        annotation.quantification[quantifName] = {\n          value: measuredValue.numericValue,\n          unit: quantifUnit\n        };\n      }\n    }\n  }\n\n  /**\n   * Add meta to an annotation.\n   *\n   * @param {Annotation} annotation The annotation.\n   * @param {DicomSRContent} content The content to add.\n   */\n  #addMetaToAnnotation(annotation, content) {\n    if ((content.valueType === ValueTypes.code ||\n      content.valueType === ValueTypes.text) &&\n      content.relationshipType === RelationshipTypes.contains) {\n      annotation.addMetaItem(\n        content.conceptNameCode,\n        content.value\n      );\n    }\n  }\n\n  /**\n   * Check if a DicomSRContent is an 'ImagingMeasurements'.\n   *\n   * @param {DicomSRContent} item The item to check.\n   * @returns {boolean} True if item has the properties:\n   *   (CONTAINS) CONTAINER: (126010, DCM, 'Imaging Measurements').\n   */\n  #isImagingMeasurementsItem(item) {\n    return item.hasHeader(\n      ValueTypes.container,\n      getDcmDicomCode(DcmCodes.ImagingMeasurements),\n      RelationshipTypes.contains\n    );\n  }\n\n  /**\n   * Check if a DicomSRContent is a 'MeasurementGroup'.\n   *\n   * @param {DicomSRContent} item The item to check.\n   * @returns {boolean} True if item has the properties:\n   *   (CONTAINS) CONTAINER: (125007, DCM, 'Measurement Group').\n   */\n  #isMeasurementGroupItem(item) {\n    return item.hasHeader(\n      ValueTypes.container,\n      getDcmDicomCode(DcmCodes.MeasurementGroup),\n      RelationshipTypes.contains\n    );\n  }\n\n  /**\n   * Check if a DicomSRContent is a 'SingleImageFinding' code.\n   *\n   * @param {DicomSRContent} item The item to check.\n   * @returns {boolean} True if item has the properties:\n   *   (INFERRED FROM) CODE: (111059, DCM, 'Single Image Finding').\n   */\n  #isSingleImageFindingItem(item) {\n    return item.hasHeader(\n      ValueTypes.code,\n      getDcmDicomCode(DcmCodes.SingleImageFinding),\n      RelationshipTypes.inferredFrom\n    );\n  }\n\n  /**\n   * Check if a DicomSRContent is a 'ResponseEvaluation' container.\n   *\n   * @param {DicomSRContent} item The item to check.\n   * @returns {boolean} True if item has the properties:\n   *   (HAS PROPERTIES) CODE: (112020, DCM, 'Response Evaluation').\n   */\n  #isResponseEvaluationItem(item) {\n    return item.hasHeader(\n      ValueTypes.container,\n      getDcmDicomCode(DcmCodes.ResponseEvaluation),\n      RelationshipTypes.hasProperties\n    );\n  }\n\n  /**\n   * Check if a DicomSRContent is a 'Comment' text.\n   *\n   * @param {DicomSRContent} item The item to check.\n   * @returns {boolean} True if item has the properties:\n   *   (CONTAINS) TEXT: (121106, DCM, 'Comment').\n   */\n  #isCommentItem(item) {\n    return item.hasHeader(\n      ValueTypes.text,\n      getDcmDicomCode(DcmCodes.Comment),\n      RelationshipTypes.contains\n    );\n  }\n\n  /**\n   * Check if a DicomSRContent is a 'CurrentResponse' code.\n   *\n   * @param {DicomSRContent} item The item to check.\n   * @returns {boolean} True if item has the properties:\n   *   (CONTAINS) CODE: (112048, DCM, 'Current Response').\n   */\n  #isCurrentResponseItem(item) {\n    return item.hasHeader(\n      ValueTypes.code,\n      getDcmDicomCode(DcmCodes.CurrentResponse),\n      RelationshipTypes.contains\n    );\n  }\n\n  /**\n   * Check if a DicomSRContent is a 'MeasurementOfResponse' number.\n   *\n   * @param {DicomSRContent} item The item to check.\n   * @returns {boolean} True if item has the properties:\n   *   (CONTAINS) NUM: (112051, DCM, 'Measurement Of Response').\n   */\n  #isMeasurementOfResponseItem(item) {\n    return item.hasHeader(\n      ValueTypes.num,\n      getDcmDicomCode(DcmCodes.MeasurementOfResponse),\n      RelationshipTypes.contains\n    );\n  }\n\n  /**\n   * Check if a DicomSRContent is a 'CADProcessingAndFindingsSummary' code.\n   *\n   * @param {DicomSRContent} item The item to check.\n   * @returns {boolean} True if item has the properties:\n   *   (CONTAINS) CODE: (111017, DCM, 'CAD Processing and Findings Summary').\n   */\n  #isCadProcessingSummaryItem(item) {\n    return item.hasHeader(\n      ValueTypes.code,\n      getDcmDicomCode(DcmCodes.CADProcessingAndFindingsSummary),\n      RelationshipTypes.contains\n    );\n  }\n\n  /**\n   * Check if a DicomSRContent is an 'ImageRegion'.\n   *\n   * @param {DicomSRContent} item The item to check.\n   * @returns {boolean} True if item has the properties:\n   *   (CONTAINS) SCOORD: (111030, DCM, 'Image Region').\n   */\n  #isImageRegionItem(item) {\n    return item.hasHeader(\n      ValueTypes.scoord,\n      getDcmDicomCode(DcmCodes.ImageRegion),\n      RelationshipTypes.contains\n    );\n  }\n\n  /**\n   * Check is a measurement group follows TID 1410:\n   * it must contain an image region.\n   * Ref: {@link https://dicom.nema.org/medical/Dicom/2022a/output/chtml/part16/chapter_A.html#sect_TID_1410}.\n   *\n   * @param {DicomSRContent} content The SR content.\n   * @returns {boolean} True if an image region was found.\n   */\n  #isTid1410MeasGroup(content) {\n    const scoord = content.contentSequence.find(\n      this.#isImageRegionItem\n    );\n    return typeof scoord !== 'undefined';\n  }\n\n  /**\n   * Convert a TID 1410 measurement group into an annotation.\n   *\n   * @param {DicomSRContent} content The SR content.\n   * @returns {Annotation|undefined} The annotation.\n   */\n  #tid1410MeasGroupToAnnotation(content) {\n    let annotation;\n\n    // get shape from scoord\n    const scoord = content.contentSequence.find(\n      this.#isImageRegionItem\n    );\n    if (typeof scoord !== 'undefined') {\n      annotation = new Annotation();\n      // shape\n      annotation.mathShape = getShapeFromScoord(scoord.value);\n      // shape source image\n      const fromImage = scoord.contentSequence.find(function (item) {\n        return item.valueType === ValueTypes.image &&\n          item.relationshipType === RelationshipTypes.selectedFrom;\n      });\n      if (typeof fromImage !== 'undefined') {\n        this.#addSourceImageToAnnotation(annotation, fromImage);\n      }\n\n      for (const item of content.contentSequence) {\n        // shape ids\n        this.#addIdsToAnnotation(annotation, item);\n        // shape extra\n        this.#addContentToAnnotation(annotation, item);\n      }\n    }\n    return annotation;\n  }\n\n  /**\n   * Check is an SR content follows TID 300: it must be\n   *   a 'contains' numeric value with an 'inferred from' scoord.\n   * Ref: {@link https://dicom.nema.org/medical/Dicom/2022a/output/chtml/part16/chapter_A.html#sect_TID_300}.\n   *\n   * @param {DicomSRContent} item The SR content.\n   * @returns {boolean} True if TID 300 measure.\n   */\n  #isTid300Measurement(item) {\n    // no specific concept\n    const isContainedNum =\n      item.valueType === ValueTypes.num &&\n      item.relationshipType === RelationshipTypes.contains;\n    let scoord;\n    if (isContainedNum) {\n      // no specific concept (?)\n      scoord = item.contentSequence.find(function (subItem) {\n        return subItem.valueType === ValueTypes.scoord &&\n          subItem.relationshipType === RelationshipTypes.inferredFrom;\n      });\n    }\n    return typeof scoord !== 'undefined';\n  }\n\n  /**\n   * Check is an SR content follows TID 1400: it must be\n   *   a 'has properties' numeric value with an 'inferred from' scoord.\n   * Ref: {@link https://dicom.nema.org/medical/Dicom/current/output/chtml/part16/chapter_A.html#sect_TID_1400}.\n   *\n   * @param {DicomSRContent} item The SR content.\n   * @returns {boolean} True if TID 300 measure.\n   */\n  #isTid1400LinearMeasurement(item) {\n    // no specific concept\n    const isHasPropNum =\n      item.valueType === ValueTypes.num &&\n      item.relationshipType === RelationshipTypes.hasProperties;\n    let scoord;\n    if (isHasPropNum) {\n      // no specific concept (?)\n      scoord = item.contentSequence.find(function (subItem) {\n        return subItem.valueType === ValueTypes.scoord &&\n          subItem.relationshipType === RelationshipTypes.inferredFrom;\n      });\n    }\n    return typeof scoord !== 'undefined';\n  }\n\n  /**\n   * Check is a measurement group follows TID 1501:\n   * it must contain a measure.\n   * Ref: {@link https://dicom.nema.org/medical/Dicom/2022a/output/chtml/part16/chapter_A.html#sect_TID_1501}.\n   *\n   * @param {DicomSRContent} content The SR content.\n   * @returns {boolean} True if a measure was found.\n   */\n  #isTid1501MeasGroup(content) {\n    const measure = content.contentSequence.find(\n      this.#isTid300Measurement\n    );\n    return typeof measure !== 'undefined';\n  }\n\n  /**\n   * Convert a TID 1501 measurement group into an annotation.\n   *\n   * @param {DicomSRContent} content The SR content.\n   * @returns {Annotation|undefined} The annotation.\n   */\n  #tid1501MeasGroupToAnnotation(content) {\n    let annotation;\n\n    // just use the first measure to get the scoord\n    // (expecting all measures to refer to the same scoord)\n    const measure = content.contentSequence.find(\n      this.#isTid300Measurement\n    );\n    if (typeof measure !== 'undefined') {\n      annotation = new Annotation();\n      // shape\n      // no specific concept (?)\n      const scoord = measure.contentSequence.find(function (subItem) {\n        return subItem.valueType === ValueTypes.scoord &&\n          subItem.relationshipType === RelationshipTypes.inferredFrom;\n      });\n      annotation.mathShape = getShapeFromScoord(scoord.value);\n      // special point/arrow case\n      // TODO: not very valid...\n      if (annotation.mathShape instanceof Point2D &&\n        scoord.value.graphicData.length >= 4\n      ) {\n        annotation.referencePoints = [\n          new Point2D(scoord.value.graphicData[2], scoord.value.graphicData[3])\n        ];\n      }\n      // shape source image\n      // no specific concept (?)\n      const fromImage = scoord.contentSequence.find(function (item) {\n        return item.valueType === ValueTypes.image &&\n          item.relationshipType === RelationshipTypes.selectedFrom;\n      });\n      if (typeof fromImage !== 'undefined') {\n        this.#addSourceImageToAnnotation(annotation, fromImage);\n      }\n    }\n\n    // shape extra\n    if (typeof annotation !== 'undefined') {\n      for (const item of content.contentSequence) {\n        // add ids\n        this.#addIdsToAnnotation(annotation, item);\n        // add quantification\n        this.#addQuantificationToAnnotation(annotation, measure);\n        // add meta\n        this.#addMetaToAnnotation(annotation, item);\n      }\n    }\n\n    return annotation;\n  }\n\n  /**\n   * Convert a TID 4104 image finding into an annotation.\n   * Similar to tid1501MeasGroupToAnnotation apart from measure\n   *  code and quantification relationship.\n   *\n   * @param {DicomSRContent} content The SR content.\n   * @returns {Annotation|undefined} The annotation.\n   */\n  #singleImageFindingToAnnotation(content) {\n    let annotation;\n\n    // just use the first measure to get the scoord\n    // (expecting all measures to refer to the same scoord)\n    const measure = content.contentSequence.find(\n      this.#isTid1400LinearMeasurement\n    );\n    if (typeof measure !== 'undefined') {\n      annotation = new Annotation();\n      // shape\n      // no specific concept (?)\n      const scoord = measure.contentSequence.find(function (subItem) {\n        return subItem.valueType === ValueTypes.scoord &&\n          subItem.relationshipType === RelationshipTypes.inferredFrom;\n      });\n      annotation.mathShape = getShapeFromScoord(scoord.value);\n      // special point/arrow case\n      // TODO: not very valid...\n      if (annotation.mathShape instanceof Point2D &&\n        scoord.value.graphicData.length >= 4\n      ) {\n        annotation.referencePoints = [\n          new Point2D(scoord.value.graphicData[2], scoord.value.graphicData[3])\n        ];\n      }\n      // shape source image\n      // no specific concept (?)\n      const fromImage = scoord.contentSequence.find(function (item) {\n        return item.valueType === ValueTypes.image &&\n          item.relationshipType === RelationshipTypes.selectedFrom;\n      });\n      if (typeof fromImage !== 'undefined') {\n        this.#addSourceImageToAnnotation(annotation, fromImage);\n      }\n    }\n\n    // shape extra\n    if (typeof annotation !== 'undefined') {\n      for (const item of content.contentSequence) {\n        // add ids\n        this.#addIdsToAnnotation(annotation, item);\n        // add quantification\n        this.#addQuantificationToAnnotation(\n          annotation, measure, RelationshipTypes.hasProperties);\n        // add meta\n        this.#addMetaToAnnotation(annotation, item);\n      }\n    }\n\n    return annotation;\n  }\n\n  /**\n   * Convert an imaging measurement into an annotation group.\n   * Supports TID1500 > TID1410 (\"Planar ROI Measurements\n   * and Qualitative Evaluations) or TID1501 (Measurement and\n   * Qualitative Evaluation Group).\n   *\n   * @param {DicomSRContent} content The SR content.\n   * @returns {AnnotationGroup|undefined} The annotation group.\n   */\n  #imagingMeasToAnnotationGroup(content) {\n    if (content.contentSequence.length === 0) {\n      return undefined;\n    }\n    const item0 = content.contentSequence[0];\n    let isTid1410 = false;\n    let isTid1501 = false;\n    if (this.#isMeasurementGroupItem(item0)) {\n      isTid1410 = this.#isTid1410MeasGroup(item0);\n      isTid1501 = this.#isTid1501MeasGroup(item0);\n    }\n\n    const annotations = [];\n    let hasMeasGroup = false;\n    for (const item of content.contentSequence) {\n      // measurement group content\n      if (this.#isMeasurementGroupItem(item)) {\n        hasMeasGroup = true;\n        let annotation;\n        if (isTid1410) {\n          annotation = this.#tid1410MeasGroupToAnnotation(item);\n        } else if (isTid1501) {\n          annotation = this.#tid1501MeasGroupToAnnotation(item);\n        }\n        if (typeof annotation !== 'undefined') {\n          annotations.push(annotation);\n        }\n      }\n    }\n\n    let annotationGroup;\n    if (!hasMeasGroup) {\n      logger.warn('No measurement groups in TID 1500 SR');\n    } else {\n      if (annotations.length !== 0) {\n        annotationGroup = new AnnotationGroup(annotations);\n      } else {\n        logger.warn('No valid measurement groups in TID 1500 SR');\n      }\n    }\n    return annotationGroup;\n  }\n\n  /**\n   * Convert a CAD processing summary into an annotation group.\n   *\n   * @param {DicomSRContent} content The SR content.\n   * @returns {AnnotationGroup[]|undefined} The annotation group.\n   */\n  #cadProcessingSummaryToAnnotationGroups(content) {\n    // get annotations\n    const annotations = [];\n    let hasMeasGroup = false;\n    for (const item of content.contentSequence) {\n      // measurement group content\n      if (this.#isSingleImageFindingItem(item)) {\n        hasMeasGroup = true;\n        const annotation = this.#singleImageFindingToAnnotation(item);\n        if (typeof annotation !== 'undefined') {\n          annotations.push(annotation);\n        }\n      }\n    }\n\n    // TODO: split annotations according to referenced image.\n\n    // create group\n    const annotationGroups = [];\n    if (!hasMeasGroup) {\n      logger.warn('No image findings in TID 4100 SR');\n    } else {\n      if (annotations.length !== 0) {\n        annotationGroups.push(new AnnotationGroup(annotations));\n      } else {\n        logger.warn('No valid measurement groups in TID 4100 SR');\n      }\n    }\n    return annotationGroups;\n  }\n\n  /**\n   * Convert a DICOM SR content of type SCOORD into an annotation.\n   *\n   * @param {DicomSRContent} content The input SCOORD.\n   * @returns {Annotation} The annotation.\n   */\n  #dwv034ScoordToAnnotation(content) {\n    const annotation = new Annotation();\n    // shape\n    annotation.mathShape = getShapeFromScoord(content.value);\n\n    for (const item of content.contentSequence) {\n      // shape source image\n      this.#addSourceImageToAnnotation(annotation, item);\n      // shape id\n      this.#addDwv034IdToAnnotation(annotation, item);\n      // shape extra\n      this.#addContentToAnnotation(annotation, item, true);\n    }\n    return annotation;\n  }\n\n  /**\n   * Convert a DICOM SR content folowing TID 1500 into a list of annotations.\n   *\n   * Structure: 'Imaging Measurement Report' >\n   * 'Imaging Measurements' > 'Measurement Group'.\n   *\n   * Measurement Group can follow TID1410 \"Planar ROI Measurements\n   * and Qualitative Evaluations (scoord and measurements at\n   * same level) or TID1501 Measurement and Qualitative Evaluation Group\n   * (measurements with scoord child).\n   *\n   * @param {DicomSRContent} content The input SR content.\n   * @returns {AnnotationGroup|undefined} The annotation group.\n   */\n  #tid1500ToAnnotationGroup(content) {\n    if (!(content.valueType === ValueTypes.container &&\n      isEqualCode(\n        content.conceptNameCode,\n        getDcmDicomCode(DcmCodes.ImagingMeasurementReport)\n      )\n    )) {\n      logger.warn('Not the expected TID 1500 SR content header');\n    }\n\n    let annotationGroup;\n\n    // imaging measurements content\n    const imagingMeas = content.contentSequence.find(\n      this.#isImagingMeasurementsItem\n    );\n    if (typeof imagingMeas !== 'undefined') {\n      annotationGroup = this.#imagingMeasToAnnotationGroup(imagingMeas);\n    } else {\n      logger.warn('No imaging measurements in TID 1500 SR');\n    }\n\n    return annotationGroup;\n  }\n\n  /**\n   * Get the CAD processing and findings summary from\n   *   and input SR content.\n   *\n   * @param {DicomSRContent} content The input SR content.\n   * @returns {DicomSRContent|undefined} The summary.\n   */\n  #getTid4100Summary(content) {\n    if (!(content.valueType === ValueTypes.container &&\n      isEqualCode(\n        content.conceptNameCode,\n        getDcmDicomCode(DcmCodes.ChestCADReport)\n      )\n    )) {\n      logger.warn('Not the expected TID 4100 SR content header');\n    }\n\n    // CAD processing summary content\n    return content.contentSequence.find(\n      this.#isCadProcessingSummaryItem\n    );\n  }\n\n  /**\n   * Convert a DICOM SR content 'Measurement group' into a list of annotations.\n   *\n   * Structure: (root) 'Measurement group'\n   * - scoord,\n   *   - meta.\n   *\n   * @param {DicomSRContent} content The input.\n   * @returns {AnnotationGroup|undefined} The annotation.\n   */\n  #dwv034MeasGroupToAnnotationGroup(content) {\n    if (!(content.valueType === ValueTypes.container &&\n      isEqualCode(\n        content.conceptNameCode,\n        getDcmDicomCode(DcmCodes.MeasurementGroup)\n      )\n    )) {\n      console.warn('Not the expected dwv034 content header');\n    }\n\n    const annotations = [];\n    for (const item of content.contentSequence) {\n      if (item.valueType === ValueTypes.scoord) {\n        annotations.push(this.#dwv034ScoordToAnnotation(item));\n      }\n    }\n    return new AnnotationGroup(annotations);\n  }\n\n  /**\n   * Add root meta data to an annotation group.\n   *\n   * @param {AnnotationGroup} annotationGroup The group to add meta to.\n   * @param {Object<string, DataElement>} dataElements The DICOM tags.\n   */\n  #addMetaToAnnotationGroup(annotationGroup, dataElements) {\n    const safeGetLocal = function (key) {\n      return safeGet(dataElements, key);\n    };\n\n    // study\n    annotationGroup.setMetaValue('StudyInstanceUID',\n      safeGetLocal(TagKeys.StudyInstanceUID));\n    annotationGroup.setMetaValue('StudyID',\n      safeGetLocal(TagKeys.StudyID));\n    // series\n    annotationGroup.setMetaValue('SeriesInstanceUID',\n      safeGetLocal(TagKeys.SeriesInstanceUID));\n    annotationGroup.setMetaValue('SeriesNumber',\n      safeGetLocal(TagKeys.SeriesNumber));\n    // modality\n    annotationGroup.setMetaValue('Modality',\n      safeGetLocal(TagKeys.Modality));\n    // patient\n    annotationGroup.setMetaValue('PatientName',\n      safeGetLocal(TagKeys.PatientName));\n    annotationGroup.setMetaValue('PatientID',\n      safeGetLocal(TagKeys.PatientID));\n    annotationGroup.setMetaValue('PatientBirthDate',\n      safeGetLocal(TagKeys.PatientBirthDate));\n    annotationGroup.setMetaValue('PatientSex',\n      safeGetLocal(TagKeys.PatientSex));\n\n    // reference\n    const evidenceTagKey = TagKeys.CurrentRequestedProcedureEvidenceSequence;\n    const evidenceSq = dataElements[evidenceTagKey];\n    if (typeof evidenceSq !== 'undefined') {\n      const evidenceSqElement = {\n        [evidenceTagKey]: evidenceSq\n      };\n      const evidences = getAsSimpleElements(evidenceSqElement);\n      annotationGroup.setMetaValue(\n        'CurrentRequestedProcedureEvidenceSequence',\n        evidences.CurrentRequestedProcedureEvidenceSequence\n      );\n    }\n  }\n\n  /**\n   * Get an {@link AnnotationGroup} object from the read DICOM file.\n   *\n   * @param {Object<string, DataElement>} dataElements The DICOM tags.\n   * @returns {AnnotationGroup} A new annotation group.\n   * @throws {Error} Error for missing or wrong data.\n   */\n  create(dataElements) {\n    const srContent = getSRContent(dataElements);\n\n    let annotationGroup;\n    let srType;\n    if (this.#isTid1500AnnotationDicomSR(dataElements)) {\n      srType = 'TID 1500 SR';\n      annotationGroup = this.#tid1500ToAnnotationGroup(srContent);\n    } else if (this.#isDwv034AnnotationDicomSR(dataElements)) {\n      logger.warn('DWV v0.34 annotation');\n      srType = 'DWV v0.34 SR';\n      annotationGroup = this.#dwv034MeasGroupToAnnotationGroup(srContent);\n    }\n\n    // CAD report\n    if (this.#isTid4100DicomSR(dataElements)) {\n      srType = 'TID 4100 SR';\n      const report = this.createCADReport(dataElements);\n      if (typeof report !== 'undefined') {\n        annotationGroup = report.annotationGroups[0];\n        // console.log('-- CAD report -- ');\n        // console.log('comment', report.comment);\n        // console.log('evaluations', report.responseEvaluations);\n      }\n    }\n\n    if (typeof annotationGroup === 'undefined') {\n      throw new Error('Cannot create annotation group from ' + srType);\n    }\n\n    // add dicom meta\n    this.#addMetaToAnnotationGroup(annotationGroup, dataElements);\n\n    return annotationGroup;\n  }\n\n  /**\n   * Get an {@link CADReport} object from the read DICOM file.\n   *\n   * @param {Object<string, DataElement>} dataElements The DICOM tags.\n   * @returns {CADReport|undefined} A new CAD report.\n   */\n  createCADReport(dataElements) {\n    const srContent = getSRContent(dataElements);\n\n    // get the summary\n    const summary = this.#getTid4100Summary(srContent);\n    if (typeof summary === 'undefined') {\n      logger.warn('No CAD processing and Findings Summary in TID 4100 SR');\n      return;\n    }\n\n    let annotationGroups = [];\n    if (this.#isTid4100DicomSR(dataElements)) {\n      annotationGroups = this.#cadProcessingSummaryToAnnotationGroups(summary);\n    }\n\n    if (typeof annotationGroups === 'undefined') {\n      throw new Error('Cannot create annotation groups from TID 4100 SR');\n    }\n\n    // add dicom meta\n    for (const group of annotationGroups) {\n      this.#addMetaToAnnotationGroup(group, dataElements);\n    }\n\n    // evaluations\n    const evaluations = [];\n    let comment;\n    for (const item of summary.contentSequence) {\n      // measurement group content\n      if (this.#isResponseEvaluationItem(item)) {\n        const evaluation = this.#tid4106ResponseEvaluationToResponse(item);\n        if (typeof evaluation !== 'undefined') {\n          evaluations.push(evaluation);\n        }\n      } else if (this.#isCommentItem(item)) {\n        comment = item.value;\n      }\n    }\n\n    const report = new CADReport();\n    report.annotationGroups = annotationGroups;\n    report.responseEvaluations = evaluations;\n    report.comment = comment;\n\n    return report;\n  }\n\n  /**\n   * Get the annotation source image as SR content.\n   *\n   * @param {Annotation} annotation The input annotation.\n   * @returns {DicomSRContent} The SR content.\n   */\n  #getAnnotationSourceImageContent(annotation) {\n    // reference image UID\n    const srImage = new DicomSRContent(ValueTypes.image);\n    srImage.relationshipType = RelationshipTypes.selectedFrom;\n    srImage.conceptNameCode = getDcmDicomCode(DcmCodes.SourceImage);\n    const sopRef = new SopInstanceReference();\n    sopRef.referencedSOPClassUID = annotation.referencedSopClassUID;\n    sopRef.referencedSOPInstanceUID = annotation.referencedSopInstanceUID;\n    const imageRef = new ImageReference();\n    imageRef.referencedSOPSequence = sopRef;\n    if (typeof annotation.referencedFrameNumber !== 'undefined') {\n      imageRef.referencedFrameNumber =\n        annotation.referencedFrameNumber.toString();\n    }\n    srImage.value = imageRef;\n\n    return srImage;\n  }\n\n  /**\n   * Get the annotation meta as SR content list.\n   *\n   * @param {Annotation} annotation The input annotation.\n   * @returns {DicomSRContent[]} The SR content list.\n   */\n  #getAnnotationContentSequence(annotation) {\n    const contentSequence = [];\n\n    // annotation id\n    const srId = new DicomSRContent(ValueTypes.text);\n    srId.relationshipType = RelationshipTypes.hasObsContext;\n    srId.conceptNameCode = getDcmDicomCode(DcmCodes.TrackingIdentifier);\n    srId.value = annotation.trackingId;\n    contentSequence.push(srId);\n\n    // annotation uid\n    const srUid = new DicomSRContent(ValueTypes.uidref);\n    srUid.relationshipType = RelationshipTypes.hasObsContext;\n    srUid.conceptNameCode = getDcmDicomCode(DcmCodes.TrackingUniqueIdentifier);\n    srUid.value = annotation.trackingUid;\n    contentSequence.push(srUid);\n\n    // text expr\n    if (typeof annotation.textExpr !== 'undefined' &&\n      annotation.textExpr.length !== 0\n    ) {\n      const shortLabel = new DicomSRContent(ValueTypes.text);\n      shortLabel.relationshipType = RelationshipTypes.hasConceptMod;\n      shortLabel.conceptNameCode = getDcmDicomCode(DcmCodes.ShortLabel);\n      shortLabel.value = annotation.textExpr;\n      // label position\n      if (typeof annotation.labelPosition !== 'undefined') {\n        const labelPosition = new DicomSRContent(ValueTypes.scoord);\n        labelPosition.relationshipType = RelationshipTypes.hasProperties;\n        labelPosition.conceptNameCode =\n          getDcmDicomCode(DcmCodes.ReferencePoints);\n        const labelPosScoord = new SpatialCoordinate();\n        labelPosScoord.graphicType = GraphicTypes.point;\n        const graphicData = [\n          annotation.labelPosition.getX().toString(),\n          annotation.labelPosition.getY().toString()\n        ];\n        labelPosScoord.graphicData = graphicData;\n        labelPosition.value = labelPosScoord;\n        const srcImage = this.#getAnnotationSourceImageContent(annotation);\n        labelPosition.contentSequence = [srcImage];\n\n        // add position to label sequence\n        shortLabel.contentSequence = [labelPosition];\n      }\n      contentSequence.push(shortLabel);\n    }\n\n    // colour\n    const colour = new DicomSRContent(ValueTypes.text);\n    colour.relationshipType = RelationshipTypes.hasConceptMod;\n    colour.conceptNameCode = getColourCode();\n    colour.value = annotation.colour;\n    contentSequence.push(colour);\n\n    // reference points\n    if (typeof annotation.referencePoints !== 'undefined') {\n      const referencePoints = new DicomSRContent(ValueTypes.scoord);\n      referencePoints.relationshipType = RelationshipTypes.hasConceptMod;\n      referencePoints.conceptNameCode =\n        getDcmDicomCode(DcmCodes.ReferencePoints);\n      const refPointsScoord = new SpatialCoordinate();\n      refPointsScoord.graphicType = GraphicTypes.multipoint;\n      const graphicData = [];\n      for (const point of annotation.referencePoints) {\n        graphicData.push(point.getX().toString());\n        graphicData.push(point.getY().toString());\n      }\n      refPointsScoord.graphicData = graphicData;\n\n      referencePoints.value = refPointsScoord;\n      const srcImage = this.#getAnnotationSourceImageContent(annotation);\n      referencePoints.contentSequence = [srcImage];\n\n      contentSequence.push(referencePoints);\n    }\n\n    // plane points\n    if (typeof annotation.planePoints !== 'undefined') {\n      const planePoints = new DicomSRContent(ValueTypes.scoord3d);\n      planePoints.relationshipType = RelationshipTypes.contains;\n      planePoints.conceptNameCode = getDcmDicomCode(DcmCodes.ReferenceGeometry);\n      const pointsScoord = new SpatialCoordinate3D();\n      pointsScoord.graphicType = GraphicTypes.multipoint;\n      const graphicData = [];\n      for (const planePoint of annotation.planePoints) {\n        graphicData.push(planePoint.getX().toString());\n        graphicData.push(planePoint.getY().toString());\n        graphicData.push(planePoint.getZ().toString());\n      }\n      pointsScoord.graphicData = graphicData;\n\n      planePoints.value = pointsScoord;\n      const srcImage = this.#getAnnotationSourceImageContent(annotation);\n      planePoints.contentSequence = [srcImage];\n\n      contentSequence.push(planePoints);\n    }\n\n    // quantification\n    if (typeof annotation.quantification !== 'undefined') {\n      for (const key in annotation.quantification) {\n        const quantifContent = getSRContentFromValue(\n          key,\n          precisionRound(\n            annotation.quantification[key].value,\n            BIG_EPSILON_EXPONENT\n          ),\n          annotation.quantification[key].unit\n        );\n        if (typeof quantifContent !== 'undefined') {\n          contentSequence.push(quantifContent);\n        }\n      }\n    }\n\n    // meta\n    const conceptIds = annotation.getMetaConceptIds();\n    for (const conceptId of conceptIds) {\n      const item = annotation.getMetaItem(conceptId);\n      let valueType = ValueTypes.text;\n      if (item.value instanceof DicomCode) {\n        valueType = ValueTypes.code;\n      }\n      const meta = new DicomSRContent(valueType);\n      meta.relationshipType = RelationshipTypes.contains;\n      meta.conceptNameCode = item.concept;\n      meta.value = item.value;\n      contentSequence.push(meta);\n    }\n\n    return contentSequence;\n  }\n\n  /**\n   * Convert an annotation into a 'Measurement Group' SR content.\n   *\n   * @param {Annotation} annotation The input annotation.\n   * @returns {DicomSRContent} The result SR content.\n   */\n  #annotationToTid1410MeasGroup(annotation) {\n    // measurement group\n    const srContent = new DicomSRContent(ValueTypes.container);\n    srContent.relationshipType = RelationshipTypes.contains;\n    srContent.conceptNameCode = getDcmDicomCode(DcmCodes.MeasurementGroup);\n    srContent.value = ContinuityOfContents.separate;\n\n    // scoord\n    const srScoord = new DicomSRContent(ValueTypes.scoord);\n    srScoord.relationshipType = RelationshipTypes.contains;\n    srScoord.conceptNameCode = getDcmDicomCode(DcmCodes.ImageRegion);\n    srScoord.value = getScoordFromShape(annotation.mathShape);\n    const srcImage = this.#getAnnotationSourceImageContent(annotation);\n    srScoord.contentSequence = [srcImage];\n\n    // add extras\n    srContent.contentSequence = [srScoord].concat(\n      this.#getAnnotationContentSequence(annotation));\n\n    return srContent;\n  }\n\n  /**\n   * Convert an annotation group into a TID 1500 report SR content\n   * (internally using TID 1410).\n   *\n   * @param {AnnotationGroup} annotationGroup The input annotation group.\n   * @returns {DicomSRContent|undefined} The result SR content.\n   */\n  #annotationGroupToTid1500(annotationGroup) {\n    let srContent;\n\n    if (annotationGroup.getList().length !== 0) {\n      // imaging measurements\n      const measContent = new DicomSRContent(ValueTypes.container);\n      measContent.conceptNameCode =\n        getDcmDicomCode(DcmCodes.ImagingMeasurements);\n      measContent.relationshipType = RelationshipTypes.contains;\n      measContent.value = ContinuityOfContents.separate;\n      const contentSequence = [];\n      for (const annotation of annotationGroup.getList()) {\n        contentSequence.push(\n          this.#annotationToTid1410MeasGroup(annotation)\n        );\n      }\n      measContent.contentSequence = contentSequence;\n\n      // imaging measurements report\n      srContent = new DicomSRContent(ValueTypes.container);\n      srContent.conceptNameCode =\n        getDcmDicomCode(DcmCodes.ImagingMeasurementReport);\n      srContent.value = ContinuityOfContents.separate;\n      srContent.contentSequence = [measContent];\n    }\n\n    return srContent;\n  }\n\n  /**\n   * Convert an annotation group into a DICOM SR object using the\n   * TID 1500 template.\n   *\n   * @param {AnnotationGroup} annotationGroup The annotation group.\n   * @param {Object<string, any>} [extraTags] Optional list of extra tags.\n   * @returns {Object<string, DataElement>} A list of dicom elements.\n   */\n  toDicom(annotationGroup, extraTags) {\n    let tags = annotationGroup.getMeta();\n\n    // transfer syntax: ExplicitVRLittleEndian\n    tags.TransferSyntaxUID = '1.2.840.10008.1.2.1';\n    // class: Comprehensive 3D SR Storage\n    // https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_A.35.13.html\n    tags.SOPClassUID = '1.2.840.10008.5.1.4.1.1.88.34';\n    tags.MediaStorageSOPClassUID = '1.2.840.10008.5.1.4.1.1.88.34';\n    tags.CompletionFlag = 'PARTIAL';\n    tags.VerificationFlag = 'UNVERIFIED';\n\n    // date\n    const now = new Date();\n    tags.ContentDate = getDicomDate(dateToDateObj(now));\n    tags.ContentTime = getDicomTime(dateToTimeObj(now));\n\n    // reference\n    const evidenceSq = tags.CurrentRequestedProcedureEvidenceSequence;\n    // hoping for just one element...\n    const evidenceSq0 = evidenceSq.value[0];\n    const refSeriesSq = evidenceSq0.ReferencedSeriesSequence;\n    // hoping for just one element...\n    const refSeriesSq0 = refSeriesSq.value[0];\n    let refSopSq = refSeriesSq0.ReferencedSOPSequence;\n    if (typeof refSopSq === 'undefined') {\n      refSeriesSq0.ReferencedSOPSequence = {\n        value: []\n      };\n      refSopSq = refSeriesSq0.ReferencedSOPSequence;\n    }\n    const refs = refSopSq.value;\n    // add reference if not yet present\n    for (const annotation of annotationGroup.getList()) {\n      const ref = {\n        ReferencedSOPInstanceUID: annotation.referencedSopInstanceUID,\n        ReferencedSOPClassUID: annotation.referencedSopClassUID\n      };\n      const isSameRef = function (item) {\n        return item.ReferencedSOPInstanceUID === ref.ReferencedSOPInstanceUID &&\n          item.ReferencedSOPClassUID === ref.ReferencedSOPClassUID;\n      };\n      if (typeof refs.find(isSameRef) === 'undefined') {\n        refs.push(ref);\n      }\n    }\n\n    // TID 1500\n    tags.ContentTemplateSequence = {\n      value: [{\n        MappingResource: 'DCMR',\n        TemplateIdentifier: '1500'\n      }]\n    };\n\n    const srContent = this.#annotationGroupToTid1500(annotationGroup);\n\n    // main\n    if (typeof srContent !== 'undefined') {\n      tags = {\n        ...tags,\n        ...getDicomSRContentItem(srContent)\n      };\n    } else {\n      throw new Error('No annotation group SR content');\n    }\n\n    // merge extra tags if provided\n    if (typeof extraTags !== 'undefined') {\n      mergeTags(tags, extraTags);\n    }\n\n    return getElementsFromJSONTags(tags);\n  }\n\n  /**\n   * Convert an annotation into a 'Single Image Finding' SR content.\n   *\n   * @param {Annotation} annotation The input annotation.\n   * @returns {DicomSRContent} The result SR content.\n   */\n  #annotationToTid4104SingleImageFinding(annotation) {\n    // image finding\n    const srContent = new DicomSRContent(ValueTypes.code);\n    srContent.relationshipType = RelationshipTypes.inferredFrom;\n    srContent.conceptNameCode = getDcmDicomCode(DcmCodes.SingleImageFinding);\n    // TODO: CID 6101\n    srContent.value = getDcmDicomCode(DcmCodes.SelectedRegion);\n\n    srContent.contentSequence = [];\n\n    // annotation id\n    const srId = new DicomSRContent(ValueTypes.text);\n    srId.relationshipType = RelationshipTypes.hasObsContext;\n    srId.conceptNameCode = getDcmDicomCode(DcmCodes.TrackingIdentifier);\n    srId.value = annotation.trackingId;\n    srContent.contentSequence.push(srId);\n\n    // annotation uid\n    const srUid = new DicomSRContent(ValueTypes.uidref);\n    srUid.relationshipType = RelationshipTypes.hasObsContext;\n    srUid.conceptNameCode = getDcmDicomCode(DcmCodes.TrackingUniqueIdentifier);\n    srUid.value = annotation.trackingUid;\n    srContent.contentSequence.push(srUid);\n\n    // quantification\n    if (typeof annotation.quantification !== 'undefined') {\n      for (const key in annotation.quantification) {\n        const quantifContent = getSRContentFromValue(\n          key,\n          precisionRound(\n            annotation.quantification[key].value,\n            BIG_EPSILON_EXPONENT\n          ),\n          annotation.quantification[key].unit,\n          RelationshipTypes.hasProperties\n        );\n        if (typeof quantifContent !== 'undefined') {\n          // scoord as 'has properties'\n          const srScoord = new DicomSRContent(ValueTypes.scoord);\n          srScoord.relationshipType = RelationshipTypes.inferredFrom;\n          srScoord.conceptNameCode = getDcmDicomCode(DcmCodes.Path);\n          srScoord.value = getScoordFromShape(annotation.mathShape);\n          const srcImage = this.#getAnnotationSourceImageContent(annotation);\n          srScoord.contentSequence = [srcImage];\n\n          // add scoord to quantif\n          quantifContent.contentSequence = [srScoord];\n          // add quantif to root\n          srContent.contentSequence.push(quantifContent);\n        }\n      }\n    }\n\n    // meta\n    const conceptIds = annotation.getMetaConceptIds();\n    for (const conceptId of conceptIds) {\n      const item = annotation.getMetaItem(conceptId);\n      let valueType = ValueTypes.text;\n      if (item.value instanceof DicomCode) {\n        valueType = ValueTypes.code;\n      }\n      const meta = new DicomSRContent(valueType);\n      meta.relationshipType = RelationshipTypes.contains;\n      meta.conceptNameCode = item.concept;\n      meta.value = item.value;\n      srContent.contentSequence.push(meta);\n    }\n\n    return srContent;\n  }\n\n  /**\n   * Convert an annotation group into a TID 1500 report SR content\n   * (internally using TID 1410).\n   *\n   * @param {AnnotationGroup} annotationGroup The input annotation group.\n   * @param {DicomSRContent[]} contentSequence The content sequence to add to.\n   */\n  #addAnnotationGroupToTid4101Sequence(annotationGroup, contentSequence) {\n    if (annotationGroup.getList().length !== 0) {\n      for (const annotation of annotationGroup.getList()) {\n        contentSequence.push(\n          this.#annotationToTid4104SingleImageFinding(annotation)\n        );\n      }\n    }\n  }\n\n  /**\n   * Get the SR content for a response evaluation.\n   *\n   * @param {ResponseEvaluation|undefined} response The response evaluation.\n   * @returns {DicomSRContent} The SR content.\n   */\n  #responseToTid4106ResponseEvaluation(response) {\n    const srEvalutation = new DicomSRContent(ValueTypes.container);\n    srEvalutation.relationshipType = RelationshipTypes.hasProperties;\n    srEvalutation.conceptNameCode =\n      getDcmDicomCode(DcmCodes.ResponseEvaluation);\n    srEvalutation.value = ContinuityOfContents.separate;\n    srEvalutation.contentSequence = [];\n\n    // method: RECIST\n    const srMethod = new DicomSRContent(ValueTypes.code);\n    srMethod.relationshipType = RelationshipTypes.hasObsContext;\n    srMethod.conceptNameCode =\n      getDcmDicomCode(DcmCodes.ResponseEvaluationMethod);\n    srMethod.value = getDcmDicomCode(DcmCodes.RECIST);\n    srEvalutation.contentSequence.push(srMethod);\n\n    if (typeof response !== 'undefined') {\n      // current response\n      if (typeof response.current !== 'undefined') {\n        const srResponse = new DicomSRContent(ValueTypes.code);\n        srResponse.relationshipType = RelationshipTypes.contains;\n        srResponse.conceptNameCode = getDcmDicomCode(DcmCodes.CurrentResponse);\n        srResponse.value = response.current;\n        srEvalutation.contentSequence.push(srResponse);\n      }\n\n      // measurement of response\n      if (typeof response.measure !== 'undefined') {\n        const srMeas = new DicomSRContent(ValueTypes.num);\n        srMeas.relationshipType = RelationshipTypes.contains;\n        srMeas.conceptNameCode =\n          getDcmDicomCode(DcmCodes.MeasurementOfResponse);\n        const measure = new MeasuredValue();\n        measure.numericValue = response.measure;\n        measure.measurementUnitsCode = getMeasurementUnitsCode('unit.mm');\n        const numMeasure = new NumericMeasurement();\n        numMeasure.measuredValue = measure;\n        srMeas.value = numMeasure;\n        srEvalutation.contentSequence.push(srMeas);\n      }\n    }\n\n    return srEvalutation;\n  }\n\n  /**\n   * Convert a TID 4106 response evaluation into an response evaluation.\n   *\n   * @param {DicomSRContent} content The SR content.\n   * @returns {ResponseEvaluation|undefined} The response.\n   */\n  #tid4106ResponseEvaluationToResponse(content) {\n    let currentResponse;\n    let measure;\n    for (const item of content.contentSequence) {\n      if (this.#isCurrentResponseItem(item)) {\n        currentResponse = item.value;\n      } else if (this.#isMeasurementOfResponseItem(item)) {\n        measure = item.value.measuredValue.numericValue;\n      }\n    }\n\n    let response;\n    if (typeof currentResponse !== 'undefined') {\n      response = new ResponseEvaluation();\n      response.current = currentResponse;\n      if (typeof measure !== 'undefined') {\n        response.measure = measure;\n      }\n    }\n    return response;\n  }\n\n  /**\n   * Convert a CAD report into a DICOM CAD report SR object using\n   *   the TID 4100 template.\n   *\n   * @param {CADReport} report The CAD report.\n   * @param {Object<string, any>} [extraTags] Optional list of extra tags.\n   * @returns {Object<string, DataElement>} A list of dicom elements.\n   */\n  toDicomCADReport(report, extraTags) {\n    // first group as tag base\n    let tags = report.annotationGroups[0].getMeta();\n\n    // transfer syntax: ExplicitVRLittleEndian\n    tags.TransferSyntaxUID = '1.2.840.10008.1.2.1';\n    // class: Comprehensive 3D SR Storage\n    // https://dicom.nema.org/medical/dicom/2022a/output/chtml/part03/sect_A.35.13.html\n    tags.SOPClassUID = '1.2.840.10008.5.1.4.1.1.88.34';\n    tags.MediaStorageSOPClassUID = '1.2.840.10008.5.1.4.1.1.88.34';\n    tags.CompletionFlag = 'PARTIAL';\n    tags.VerificationFlag = 'UNVERIFIED';\n\n    // date\n    const now = new Date();\n    tags.ContentDate = getDicomDate(dateToDateObj(now));\n    tags.ContentTime = getDicomTime(dateToTimeObj(now));\n\n    // reference\n    const evidenceSq = tags.CurrentRequestedProcedureEvidenceSequence;\n    // hoping for just one element...\n    const evidenceSq0 = evidenceSq.value[0];\n    const refSeriesSq = evidenceSq0.ReferencedSeriesSequence;\n    // hoping for just one element...\n    const refSeriesSq0 = refSeriesSq.value[0];\n    let refSopSq = refSeriesSq0.ReferencedSOPSequence;\n    if (typeof refSopSq === 'undefined') {\n      refSeriesSq0.ReferencedSOPSequence = {\n        value: []\n      };\n      refSopSq = refSeriesSq0.ReferencedSOPSequence;\n    }\n    const refs = refSopSq.value;\n    // add reference if not yet present\n    for (const annotationGroup of report.annotationGroups) {\n      for (const annotation of annotationGroup.getList()) {\n        const ref = {\n          ReferencedSOPInstanceUID: annotation.referencedSopInstanceUID,\n          ReferencedSOPClassUID: annotation.referencedSopClassUID\n        };\n        const isSameRef = function (item) {\n          return item.ReferencedSOPInstanceUID ===\n            ref.ReferencedSOPInstanceUID &&\n            item.ReferencedSOPClassUID ===\n            ref.ReferencedSOPClassUID;\n        };\n        if (typeof refs.find(isSameRef) === 'undefined') {\n          refs.push(ref);\n        }\n      }\n    }\n\n    // TID 4100\n    tags.ContentTemplateSequence = {\n      value: [{\n        MappingResource: 'DCMR',\n        TemplateIdentifier: '4100'\n      }]\n    };\n\n    // findings summary\n    const srSummary = new DicomSRContent(ValueTypes.code);\n    srSummary.relationshipType = RelationshipTypes.contains;\n    srSummary.conceptNameCode =\n      getDcmDicomCode(DcmCodes.CADProcessingAndFindingsSummary);\n    // TODO: CID 6047 (All algorithms succeeded, ...)\n    srSummary.value =\n      getDcmDicomCode(DcmCodes.AllAlgorithmsSucceededWithFindings);\n    srSummary.contentSequence = [];\n\n    // response evaluation\n    for (const response of report.responseEvaluations) {\n      const srResponse =\n        this.#responseToTid4106ResponseEvaluation(response);\n      srSummary.contentSequence.push(srResponse);\n    }\n\n    // findings\n    for (const annotationGroup of report.annotationGroups) {\n      this.#addAnnotationGroupToTid4101Sequence(\n        annotationGroup, srSummary.contentSequence);\n    }\n\n    // comment (not part of TID 4100)\n    if (typeof report.comment !== 'undefined') {\n      const srComment = new DicomSRContent(ValueTypes.text);\n      srComment.relationshipType = RelationshipTypes.contains;\n      srComment.conceptNameCode = getDcmDicomCode(DcmCodes.Comment);\n      srComment.value = report.comment;\n      srSummary.contentSequence.push(srComment);\n    }\n\n    // main content\n    const srContent = new DicomSRContent(ValueTypes.container);\n    srContent.conceptNameCode = getDcmDicomCode(DcmCodes.ChestCADReport);\n    srContent.value = ContinuityOfContents.separate;\n    srContent.contentSequence.push(srSummary);\n\n    // main\n    if (typeof srContent !== 'undefined') {\n      tags = {\n        ...tags,\n        ...getDicomSRContentItem(srContent)\n      };\n    } else {\n      throw new Error('No annotation group SR content');\n    }\n\n    // merge extra tags if provided\n    if (typeof extraTags !== 'undefined') {\n      mergeTags(tags, extraTags);\n    }\n\n    return getElementsFromJSONTags(tags);\n  }\n\n}\n","import {ListenerHandler} from '../utils/listen.js';\nimport {mergeObjects} from '../utils/operator.js';\nimport {MaskFactory} from '../image/maskFactory.js';\nimport {ImageFactory} from '../image/imageFactory.js';\nimport {AnnotationGroupFactory} from '../image/annotationGroupFactory.js';\nimport {imageEventNames} from '../image/image.js';\nimport {annotationGroupEventNames} from '../image/annotationGroup.js';\nimport {safeGet} from '../dicom/dataElement.js';\nimport {\n  getVolumeIdTagValue,\n  getPostLoadVolumeIdTagValue\n} from '../dicom/dicomVolume.js';\nimport {hasAnyPixelDataElement} from '../dicom/dicomTag.js';\nimport {getReferencedSeriesUID} from '../dicom/dicomImage.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Image} from '../image/image.js';\nimport {DataElement} from '../dicom/dataElement.js';\nimport {AnnotationGroup} from '../image/annotationGroup.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  Modality: '00080060'\n};\n\n/**\n * List of data event names.\n *\n * @type {string[]}\n */\nexport const dataEventNames = [\n  'dataadd',\n  'dataremove',\n  'dataimageset',\n  'dataupdate'\n];\n\n/**\n * Merge meta datas.\n *\n * @param {Object<string, DataElement>} meta0 The first data to merge.\n * @param {Object<string, DataElement>} meta1 The second data to merge.\n * @param {string} meta1Id A meta1 specific id.\n * @returns {Object<string, DataElement>} The merged data.\n */\nfunction mergeMeta(meta0, meta1, meta1Id) {\n  // update meta data\n  let idKey = '';\n  if (typeof meta1['00020010'] !== 'undefined') {\n    // dicom case, use 'InstanceNumber'\n    idKey = '00200013';\n  } else {\n    idKey = 'imageUid';\n  }\n  // possible time suffix\n  // merge\n  return mergeObjects(\n    meta0,\n    meta1,\n    idKey,\n    'value',\n    meta1Id\n  );\n}\n\n/**\n * DICOM data: meta and possible image.\n */\nexport class DicomData {\n  /**\n   * DICOM meta data.\n   *\n   * @type {Object<string, DataElement>}\n   */\n  meta;\n\n  /**\n   * Image extracted from meta data.\n   *\n   * @type {Image|undefined}\n   */\n  image;\n  /**\n   * Annotattion group extracted from meta data.\n   *\n   * @type {AnnotationGroup|undefined}\n   */\n  annotationGroup;\n\n  /**\n   * Image buffer used to build image.\n   *\n   * @type {any|undefined}\n   */\n  buffer;\n\n  /**\n   * Number of files/urls associated to the data.\n   *\n   * @type {number}\n   */\n  numberOfFiles;\n\n  /**\n   * List of data creation warning.\n   *\n   * @type {string[]}\n   */\n  warn = [];\n\n  /**\n   * Duplicate origin flag. If true, the image slice append\n   * will be blocked. Use a DicomSliceDataList to create the\n   * full image.\n   *\n   * @type {boolean}\n   */\n  #hasDuplicateOrigin = false;\n\n  /**\n   * @param {Object<string, DataElement>} meta The DICOM meta data.\n   */\n  constructor(meta) {\n    this.meta = meta;\n  }\n\n  /**\n   * Get the image complete flag (for image data).\n   *\n   * @returns {boolean|undefined} True if the image is complete.\n   */\n  getComplete() {\n    let res;\n    if (typeof this.image !== 'undefined') {\n      res = this.image.getComplete();\n    }\n    return res;\n  }\n\n  /**\n   * Set the image complete flag (for image data).\n   *\n   * @param {boolean} flag True if the image is complete.\n   */\n  setComplete(flag) {\n    if (typeof this.image !== 'undefined') {\n      this.image.setComplete(flag);\n    }\n  }\n\n  /**\n   * Get the duplicate origin flag.\n   *\n   * @returns {boolean} The flag.\n   */\n  hasDuplicateOrigin() {\n    return this.#hasDuplicateOrigin;\n  }\n\n  /**\n   * Append slice and update meta data.\n   *\n   * @param {DicomData} data The data to append.\n   */\n  appendData(data) {\n    // only process if no duplicate origins were found\n    // if there was, then the image must be created when\n    // the load finishes via a DicomSliceDataList.buildImage\n    if (!this.#hasDuplicateOrigin) {\n      // append slice to current image\n      if (typeof this.image !== 'undefined' &&\n        typeof data.image !== 'undefined'\n      ) {\n        this.#appendSlice(data.image);\n      }\n\n      this.#mergeMeta(data.meta);\n    }\n  }\n\n  /**\n   * Append a slice image to this image.\n   *\n   * @param {Image} image The image to append.\n   */\n  #appendSlice(image) {\n    // check if append is possible\n    const geom0 = this.image.getGeometry();\n    const geom1 = image.getGeometry();\n    const canAppend = geom0.canAppendOrigin(\n      geom1.getOrigin(), geom1.getInitialTime());\n\n    // store result if not possible to stop future appends\n    if (!canAppend.success) {\n      this.#hasDuplicateOrigin = true;\n    }\n\n    // append if possible\n    if (!this.#hasDuplicateOrigin) {\n      this.image.appendSlice(image);\n    }\n  }\n\n  /**\n   * Merge meta data to this meta.\n   *\n   * @param {Object<string, DataElement>} meta The data to merge.\n   */\n  #mergeMeta(meta) {\n    const meta1IdNum = getVolumeIdTagValue(meta);\n    let meta1Id;\n    if (typeof meta1IdNum !== 'undefined') {\n      meta1Id = meta1IdNum.toString();\n    }\n    this.meta = mergeMeta(this.meta, meta, meta1Id);\n  }\n}\n\n/**\n * DICOM slice data list.\n */\nexport class DicomSliceDataList {\n\n  /**\n   * @type {DicomData[]|undefined}\n   */\n  #list = [];\n\n  /**\n   * Add a clone of the input data to the local list.\n   *\n   * @param {DicomData} data The data to clone and add.\n   */\n  addClone(data) {\n    const clone = new DicomData(structuredClone(data.meta));\n    clone.image = data.image.clone();\n    this.add(clone);\n  }\n\n  /**\n   * Add data to the local list.\n   *\n   * @param {DicomData} data The data to add.\n   */\n  add(data) {\n    this.#list.push(data);\n  }\n\n  /**\n   * Build a data from the stored slice data.\n   *\n   * @returns {{image, meta}} The result data.\n   */\n  buildData() {\n    // get and check the number of volumes\n    const numberOfVolumes = this.#getNumberOfVolumes();\n    if (typeof numberOfVolumes === 'undefined') {\n      throw new Error('Non constant number of volumes');\n    }\n    if (numberOfVolumes === 0) {\n      throw new Error('Duplicate origins but no volumes');\n    }\n    if (numberOfVolumes === 1) {\n      throw new Error('Duplicate origins but just one volume');\n    }\n\n    // get indices per volumes\n    const volsIndices = this.#getVolumesIndices(\n      numberOfVolumes, getPostLoadVolumeIdTagValue);\n\n    if (typeof volsIndices === 'undefined') {\n      throw new Error('Cannot create image for multi-volume');\n    }\n\n    // reset times and append slice\n    let image;\n    let meta;\n    for (let i = 0; i < volsIndices.length; ++i) {\n      const indices = volsIndices[i];\n      // meta\n      // TODO fix slow when in indices loop\n      const sliceMeta = this.#list[indices[0]].meta;\n      if (typeof meta === 'undefined') {\n        meta = sliceMeta;\n      } else {\n        const sliceMetaId = i + ':' +\n          getPostLoadVolumeIdTagValue(sliceMeta);\n        meta = mergeMeta(\n          meta, sliceMeta, sliceMetaId);\n      }\n      // image\n      for (const index of indices) {\n        const sliceImage = this.#list[index].image;\n        sliceImage.getGeometry().setInitialTime(i);\n        if (typeof image === 'undefined') {\n          image = sliceImage;\n        } else {\n          image.appendSlice(sliceImage);\n        }\n      }\n    }\n    return {image, meta};\n  }\n\n  /**\n   * Get the list of indices per volume.\n   *\n   * @param {number} numberOfVolumes The number of expected volumes.\n   * @param {Function} volumeIndexGetter A function to get the volume index from\n   *   meta data.\n   * @returns {number[][]|undefined} List of indices per volume or\n   *   undefined if something went wrong.\n   */\n  #getVolumesIndices(numberOfVolumes, volumeIndexGetter) {\n    const originList = this.#getOriginList();\n    const volumesIndices = [];\n    const volIndexValues = [];\n    for (const item of originList) {\n      // build volume index list\n      if (volIndexValues.length === 0) {\n        for (const index of item.indices) {\n          const relData = this.#list[index];\n          const volumeIndex = volumeIndexGetter(relData.meta);\n          if (volIndexValues.includes(volumeIndex)) {\n            // duplicate volume index\n            return;\n          } else {\n            volIndexValues.push(volumeIndex);\n          }\n        }\n        if (volIndexValues.length !== numberOfVolumes) {\n          // too many indices\n          return;\n        }\n        volIndexValues.sort();\n      }\n      // add indices to volume indices\n      for (const index of item.indices) {\n        const relData = this.#list[index];\n        const volumeIndex = volumeIndexGetter(relData.meta);\n        const volIndex = volIndexValues.indexOf(volumeIndex);\n        if (volIndex === -1) {\n          // unknown index\n          return;\n        }\n        // add data index to volume indices\n        if (typeof volumesIndices[volIndex] === 'undefined') {\n          volumesIndices[volIndex] = [];\n        }\n        volumesIndices[volIndex].push(index);\n      }\n    }\n\n    // check same size\n    const numberOfSlices = originList.length;\n    for (const list of volumesIndices) {\n      if (list.length !== numberOfSlices) {\n        // wrong number of slices\n        return;\n      }\n    }\n\n    return volumesIndices;\n  }\n\n  /**\n   * Get the number of volumes of a data.\n   *\n   * @returns {number|undefined} The number of volumes or\n   *   undefined if non constant.\n   */\n  #getNumberOfVolumes() {\n    const originList = this.#getOriginList();\n    if (originList.length === 0) {\n      return 0;\n    }\n    const count = originList[0].count;\n    // check if constant count\n    for (const item of originList) {\n      if (item.count !== count) {\n        // non constant number of origins\n        return;\n      }\n    }\n    return count;\n  }\n\n  /**\n   * Get the list of origins and thein occurences in a list\n   *   of {pos, indices, count}.\n   *\n   * @returns {object[]} A list of origins and\n   *   their number of occurences.\n   */\n  #getOriginList() {\n    // equal callback\n    const getEqualPosCallback = function (pos) {\n      return function (element) {\n        return element.pos.equals(pos);\n      };\n    };\n\n    const res = [];\n    for (let i = 0; i < this.#list.length; ++i) {\n      const relData = this.#list[i];\n      const origin = relData.image.getGeometry().getOrigin();\n      const findCallback = getEqualPosCallback(origin);\n      const found = res.find(findCallback);\n      if (typeof found === 'undefined') {\n        res.push({\n          pos: origin,\n          indices: [i],\n          count: 1\n        });\n      } else {\n        ++found.count;\n        found.indices.push(i);\n      }\n    }\n\n    return res;\n  }\n}\n\n/**\n * DicomData controller.\n */\nexport class DataController {\n\n  /**\n   * List of DICOM data.\n   *\n   * @type {Object<string, DicomData>}\n   */\n  #dataList = {};\n\n  /**\n   * Temporary slice list for data with duplicate origin\n   * that needs to be created once the load is finished.\n   *\n   * @type {Object<string, DicomSliceDataList>}\n   */\n  #tmpSliceList = {};\n\n  /**\n   * List of DICOM data.\n   *\n   * @type {Object<string, DicomData>}\n   */\n  #dataListStashed = {};\n\n  /**\n   * Distinct data loaded counter.\n   *\n   * @type {number}\n   */\n  #dataIdCounter = -1;\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Get the next data id.\n   *\n   * @returns {string} The data id.\n   */\n  getNextDataId() {\n    ++this.#dataIdCounter;\n    return this.#dataIdCounter.toString();\n  }\n\n  /**\n   * Get the list of ids in the data storage.\n   *\n   * @returns {string[]} The list of data ids.\n   */\n  getDataIds() {\n    return Object.keys(this.#dataList);\n  }\n\n  /**\n   * Reset the class: empty the data storage.\n   */\n  reset() {\n    this.#dataList = {};\n  }\n\n  /**\n   * Get a data at a given index.\n   *\n   * @param {string} dataId The data id.\n   * @returns {DicomData|undefined} The DICOM data.\n   */\n  get(dataId) {\n    return this.#dataList[dataId];\n  }\n\n  /**\n   * Get the list of dataIds that contain the input UIDs.\n   *\n   * @param {string[]} uids A list of UIDs.\n   * @returns {string[]} The list of dataIds that contain the UIDs.\n   */\n  getDataIdsFromSopUids(uids) {\n    const res = [];\n    // check input\n    if (typeof uids === 'undefined' ||\n      uids.length === 0) {\n      return res;\n    }\n    const keys = Object.keys(this.#dataList);\n    for (const key of keys) {\n      if (typeof this.#dataList[key].image !== 'undefined' &&\n        this.#dataList[key].image.containsImageUids(uids)) {\n        res.push(key);\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Get the first data id with the given SeriesInstanceUID.\n   *\n   * @param {string} uid The SeriesInstanceUID.\n   * @returns {string} The data id.\n   */\n  getDataIdFromSeriesUid(uid) {\n    let res;\n    const keys = Object.keys(this.#dataList);\n    for (const key of keys) {\n      const image = this.#dataList[key].image;\n      if (typeof image !== 'undefined') {\n        const imageSeriesUID = image.getMeta().SeriesInstanceUID;\n        if (uid === imageSeriesUID) {\n          res = key;\n          break;\n        }\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Set the image at a given index.\n   *\n   * @param {string} dataId The data id.\n   * @param {Image} image The image to set.\n   */\n  setImage(dataId, image) {\n    this.#dataList[dataId].image = image;\n\n    // propagate image events\n    for (const eventName of imageEventNames) {\n      image.addEventListener(eventName, this.#getFireEvent(dataId));\n    }\n\n    /**\n     * Data image set event.\n     *\n     * @event DataController#dataimageset\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {Array} value The event value, first element is the image.\n     * @property {string} dataid The data id.\n     */\n    this.#fireEvent({\n      type: 'dataimageset',\n      value: [image],\n      dataid: dataId\n    });\n  }\n\n  /**\n   * Interpret dicom data and create its 'content': image in\n   * most cases, annotationGroup for dicom SR.\n   *\n   * @param {DicomData} data The dicom data.\n   */\n  #setDataContent(data) {\n    const modality = safeGet(data.meta, TagKeys.Modality);\n\n    let factory;\n    if (hasAnyPixelDataElement(data.meta)) {\n      if (modality === 'SEG') {\n        // DICOM seg case\n        // find the referenced data to allow for geometry creation\n        const referencedSeriesUID = getReferencedSeriesUID(data.meta);\n        if (typeof referencedSeriesUID === 'undefined') {\n          throw new Error('Cannot create mask image: ' +\n            'the DICOM seg does not have a referenced series UID');\n        }\n        // get the reference data id\n        const refDataId = this.getDataIdFromSeriesUid(referencedSeriesUID);\n        if (typeof refDataId === 'undefined') {\n          throw new Error('Cannot create mask image: ' +\n            'the DICOM seg referenced series is not loaded');\n        }\n        // create image\n        factory = new MaskFactory();\n        if (typeof factory.checkElements(data.meta) === 'undefined') {\n          data.image = factory.create(\n            data.meta,\n            data.buffer,\n            this.#dataList[refDataId].image\n          );\n        }\n      } else {\n        // image case\n        factory = new ImageFactory();\n        if (typeof factory.checkElements(data.meta) === 'undefined') {\n          data.image = factory.create(\n            data.meta,\n            data.buffer,\n            data.numberOfFiles\n          );\n        }\n      }\n    } else if (modality === 'SR') {\n      // annotation case\n      factory = new AnnotationGroupFactory();\n      if (typeof factory.checkElements(data.meta) === 'undefined') {\n        data.annotationGroup = factory.create(data.meta);\n      }\n    }\n\n    // add warnings if present\n    if (typeof factory !== 'undefined' &&\n      typeof factory.getWarning() !== 'undefined') {\n      data.warn.push(factory.getWarning());\n    }\n  }\n\n  /**\n   * Add a new data.\n   *\n   * @param {string} dataId The data id.\n   * @param {DicomData} data The data.\n   * @returns {boolean} False if the data cannot be added.\n   */\n  add(dataId, data) {\n    if (typeof dataId === 'undefined' ||\n      typeof this.#dataList[dataId] !== 'undefined') {\n      return false;\n    }\n    // store the new image\n    this.#dataList[dataId] = data;\n\n    // create the data content if not present\n    if (typeof data.image === 'undefined' &&\n      typeof data.annotationGroup === 'undefined') {\n      // create content\n      this.#setDataContent(data);\n      // store data for possible processing at complete time\n      // (see markDataAsComplete)\n      if (typeof data.numberOfFiles !== 'undefined' &&\n        data.numberOfFiles > 1) {\n        this.#tmpSliceList[dataId] = new DicomSliceDataList();\n        // add first data as clone since this data\n        // is the base for future appends with no\n        // duplicate origin\n        this.#tmpSliceList[dataId].addClone(data);\n      }\n    }\n\n    // propagate image events\n    if (typeof data.image !== 'undefined') {\n      for (const eventName of imageEventNames) {\n        data.image.addEventListener(eventName, this.#getFireEvent(dataId));\n      }\n    }\n    // propagate annotation group events\n    if (typeof data.annotationGroup !== 'undefined') {\n      for (const eventName of annotationGroupEventNames) {\n        data.annotationGroup.addEventListener(\n          eventName, this.#getFireEvent(dataId));\n      }\n    }\n\n    /**\n     * Data add event.\n     *\n     * @event DataController#dataadd\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {string} dataid The data id.\n     */\n    this.#fireEvent({\n      type: 'dataadd',\n      dataid: dataId\n    });\n\n    return true;\n  }\n\n  /**\n   * Remove a data from the list.\n   *\n   * @param {string} dataId The data id.\n   */\n  remove(dataId) {\n    if (typeof this.#dataList[dataId] !== 'undefined') {\n      // stop propagating image events\n      const image = this.#dataList[dataId].image;\n      if (typeof image !== 'undefined') {\n        for (const eventName of imageEventNames) {\n          image.removeEventListener(eventName, this.#getFireEvent(dataId));\n        }\n      }\n      // stop propagating annotation group events\n      const annotationGroup = this.#dataList[dataId].annotationGroup;\n      if (typeof annotationGroup !== 'undefined') {\n        for (const eventName of annotationGroupEventNames) {\n          annotationGroup.removeEventListener(\n            eventName, this.#getFireEvent(dataId));\n        }\n      }\n      // remove data from list\n      delete this.#dataList[dataId];\n      /**\n       * Data remove event.\n       *\n       * @event DataController#dataremove\n       * @type {object}\n       * @property {string} type The event type.\n       * @property {string} dataid The data id.\n       */\n      this.#fireEvent({\n        type: 'dataremove',\n        dataid: dataId\n      });\n    }\n  }\n\n  /**\n   * Stash a data from the list.\n   *\n   * @param {string} dataId The data id.\n   */\n  stash(dataId) {\n    if (typeof this.#dataList[dataId] !== 'undefined') {\n      this.#dataListStashed[dataId] = this.#dataList[dataId];\n      this.remove(dataId);\n    }\n  }\n\n  /**\n   * Unstash a data from the list.\n   *\n   * @param {string} dataId The data id.\n   */\n  unstash(dataId) {\n    if (typeof this.#dataListStashed[dataId] !== 'undefined') {\n      this.add(dataId, this.#dataListStashed[dataId]);\n      delete this.#dataListStashed[dataId];\n    }\n  }\n\n  /**\n   * Get the list of ids in the stashed data storage.\n   *\n   * @returns {string[]} The list of data ids.\n   */\n  getStashedDataIds() {\n    return Object.keys(this.#dataListStashed);\n  }\n\n  /**\n   * Get a stashed data at a given index.\n   *\n   * @param {string} dataId The data id.\n   * @returns {DicomData|undefined} The DICOM data.\n   */\n  getStashed(dataId) {\n    return this.#dataListStashed[dataId];\n  }\n\n  /**\n   * Update the current data.\n   *\n   * @param {string} dataId The data id.\n   * @param {DicomData} data The data.\n   */\n  update(dataId, data) {\n    if (typeof this.#dataList[dataId] === 'undefined') {\n      throw new Error('Cannot find data to update: ' + dataId);\n    }\n    const dataToUpdate = this.#dataList[dataId];\n\n    // create the data content\n    this.#setDataContent(data);\n\n    // store data for possible processing at complete time\n    // (see markDataAsComplete)\n    if (typeof this.#tmpSliceList[dataId] !== 'undefined') {\n      this.#tmpSliceList[dataId].add(data);\n    }\n\n    // append data if no duplicate origin\n    // (if has duplicates, data will be created in markDataAsComplete)\n    if (!dataToUpdate.hasDuplicateOrigin()) {\n      dataToUpdate.appendData(data);\n    }\n\n    /**\n     * Data udpate event.\n     *\n     * @event DataController#dataupdate\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {string} dataid The data id.\n     */\n    this.#fireEvent({\n      type: 'dataupdate',\n      dataid: dataId\n    });\n  }\n\n  /**\n   * Mark a data a complete (fully loaded).\n   *\n   * @param {string} dataId The data id.\n   * @returns {{imageHasChanged}} An object with an imageHasChanged property.\n   */\n  markDataAsComplete(dataId) {\n    const data = this.#dataList[dataId];\n    if (typeof data === 'undefined') {\n      throw new Error('Cannot find data to mark as complete: ' + dataId);\n    }\n\n    const res = {imageHasChanged: false};\n\n    // data with duplicate origin case: build image\n    // from final slice list\n    if (typeof this.#tmpSliceList[dataId] !== 'undefined' &&\n      data.hasDuplicateOrigin()\n    ) {\n      const finalData = this.#tmpSliceList[dataId].buildData();\n      // set image: sends dataimageset event\n      this.setImage(dataId, finalData.image);\n      // set meta\n      data.meta = finalData.meta;\n      // reset tmp var\n      delete this.#tmpSliceList[dataId];\n      // mark image as changed\n      res.imageHasChanged = true;\n    }\n\n    // mark image as complete\n    data.setComplete(true);\n\n    return res;\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    this.#listenerHandler.fireEvent(event);\n  };\n\n  /**\n   * Get a fireEvent function that adds the input data id\n   * to the event value.\n   *\n   * @param {string} dataId The data id.\n   * @returns {Function} A fireEvent function.\n   */\n  #getFireEvent(dataId) {\n    return (event) => {\n      event.dataid = dataId;\n      this.#fireEvent(event);\n    };\n  }\n\n} // DataController class\n","import {arrayEquals} from './array.js';\n\n/**\n * Merge two similar objects.\n *\n * Objects need to be in the form of:\n * <code>\n * {\n *   idKey: {valueKey: ['0']},\n *   key0: {valueKey: [\"abc\"]},\n *   key1: {valueKey: [33]}\n * }\n * </code>.\n *\n * Merged objects will be in the form of:\n * <code>\n * {\n *   idKey: {valueKey: ['0','1','2'], merged: true},\n *   key0: {valueKey: {\n *     0: [\"abc\"],\n *     1: [\"def\"],\n *     2: [\"ghi\"]\n *   }},\n *   key1: {valueKey: {\n *     0: [33],\n *     1: [44],\n *     2: [55]\n *   }}\n * }\n * </code>.\n *\n * @param {object} obj1 The first object, can be the result of a previous merge.\n * @param {object} obj2 The second object.\n * @param {string} idKey The key to use as index for duplicate values.\n * @param {string} valueKey The key to use to access object values.\n * @param {string} [idSuffix] Optional suffix to add to id value\n * (to differentiate time points for example).\n * @returns {object} The merged object.\n */\nexport function mergeObjects(obj1, obj2, idKey, valueKey, idSuffix) {\n  // default suffix to empty string\n  if (typeof idSuffix === 'undefined') {\n    idSuffix = '';\n  }\n\n  const res = {};\n  // check id key\n  if (!idKey) {\n    throw new Error('Cannot merge object with an undefined id key: ' + idKey);\n  } else {\n    if (!Object.prototype.hasOwnProperty.call(obj1, idKey)) {\n      throw new Error('Id key not found in first object while merging: ' +\n        idKey + ', obj: ' + obj1);\n    }\n    if (!Object.prototype.hasOwnProperty.call(obj2, idKey)) {\n      throw new Error('Id key not found in second object while merging: ' +\n        idKey + ', obj: ' + obj2);\n    }\n  }\n  // check value key\n  if (!valueKey) {\n    throw new Error('Cannot merge object with an undefined value key: ' +\n      valueKey);\n  }\n\n  // check if merged object\n  let mergedObj1 = false;\n  if (Object.prototype.hasOwnProperty.call(obj1[idKey], 'merged') &&\n    obj1[idKey].merged) {\n    mergedObj1 = true;\n  }\n  // handle the id part\n  if (!Object.prototype.hasOwnProperty.call(obj1[idKey], valueKey)) {\n    throw new Error('Id value not found in first object while merging: ' +\n      idKey + ', valueKey: ' + valueKey + ', ojb: ' + obj1);\n  }\n  if (!Object.prototype.hasOwnProperty.call(obj2[idKey], valueKey)) {\n    throw new Error('Id value not found in second object while merging: ' +\n      idKey + ', valueKey: ' + valueKey + ', ojb: ' + obj2);\n  }\n  let id1 = obj1[idKey][valueKey];\n  const id2 = obj2[idKey][valueKey][0] + idSuffix;\n  // update id key\n  res[idKey] = obj1[idKey];\n  if (mergedObj1) {\n    // check if array does not include id2\n    for (let k = 0; k < id1.length; ++k) {\n      if (id1[k] === id2) {\n        throw new Error('The first object already contains id2: ' +\n          id2 + ', id1: ' + id1);\n      }\n    }\n    res[idKey][valueKey].push(id2);\n  } else {\n    id1 = id1[0] + idSuffix;\n    if (id1 === id2) {\n      throw new Error('Cannot merge object with same ids: ' +\n        id1 + ', id2: ' + id2);\n    }\n    // add suffix to first key\n    res[idKey][valueKey][0] = id1;\n    // add second key\n    res[idKey][valueKey].push(id2);\n    // mark as merged\n    res[idKey].merged = true;\n  }\n\n  // get keys\n  const keys1 = Object.keys(obj1);\n  // keys2 without duplicates of keys1\n  const keys2 = Object.keys(obj2).filter(function (item) {\n    return keys1.indexOf(item) < 0;\n  });\n  const keys = keys1.concat(keys2);\n\n  // loop through keys\n  for (let i = 0; i < keys.length; ++i) {\n    const key = keys[i];\n    if (key !== idKey) {\n      // first\n      let value1;\n      let subValue1;\n      if (Object.prototype.hasOwnProperty.call(obj1, key)) {\n        value1 = obj1[key];\n        if (Object.prototype.hasOwnProperty.call(value1, valueKey)) {\n          subValue1 = value1[valueKey];\n        }\n      }\n      // second\n      let value2;\n      let subValue2;\n      if (Object.prototype.hasOwnProperty.call(obj2, key)) {\n        value2 = obj2[key];\n        if (Object.prototype.hasOwnProperty.call(value2, valueKey)) {\n          subValue2 = value2[valueKey];\n        }\n      }\n      // result value\n      let value;\n      // use existing to copy properties\n      if (typeof value1 !== 'undefined') {\n        value = value1;\n      } else if (typeof value2 !== 'undefined') {\n        value = value2;\n      }\n      // create merge object if different values\n      if (!arrayEquals(subValue1, subValue2)) {\n        // add to merged object or create new\n        if (mergedObj1) {\n          if (Array.isArray(subValue1)) {\n            // merged object with repeated value\n            // copy it with the index list\n            value[valueKey] = {};\n            for (let j = 0; j < id1.length; ++j) {\n              value[valueKey][id1[j]] = subValue1;\n            }\n          } else {\n            value[valueKey] = subValue1;\n          }\n          // undefined subValue1\n          if (typeof value[valueKey] === 'undefined') {\n            value[valueKey] = {};\n          }\n          // add obj2 value\n          value[valueKey][id2] = subValue2;\n        } else {\n          // create merge object\n          const newValue = {};\n          newValue[id1] = subValue1;\n          newValue[id2] = subValue2;\n          value[valueKey] = newValue;\n        }\n      }\n      // store value in result object\n      res[key] = value;\n    }\n  }\n  return res;\n}\n","import {Point, Point3D} from '../math/point.js';\nimport {WindowLevel} from '../image/windowLevel.js';\nimport {LayerGroup} from './layerGroup.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {ViewLayer} from '../gui/viewLayer.js';\nimport {DrawLayer} from '../gui/drawLayer.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Window/level binder.\n */\nexport class WindowLevelBinder {\n  /**\n   * Get the associated event.\n   *\n   * @returns {string} The event name.\n   */\n  getEventType = function () {\n    return 'wlchange';\n  };\n  /**\n   * Get the event handler.\n   *\n   * @param {LayerGroup} layerGroup The input lqyer group.\n   * @returns {Function} The event handler.\n   */\n  getCallback = function (layerGroup) {\n    return function (event) {\n      const viewLayers = layerGroup.getViewLayersByDataId(event.dataid);\n      if (viewLayers.length !== 0) {\n        const vc = viewLayers[0].getViewController();\n        if (event.value.length === 2) {\n          const wl = new WindowLevel(event.value[0], event.value[1]);\n          vc.setWindowLevel(wl);\n        }\n        if (event.value.length === 3) {\n          vc.setWindowLevelPreset(event.value[2]);\n        }\n      }\n    };\n  };\n}\n\n/**\n * Colour map binder.\n */\nexport class ColourMapBinder {\n  /**\n   * Get the associated event.\n   *\n   * @returns {string} The event name.\n   */\n  getEventType = function () {\n    return 'colourmapchange';\n  };\n  /**\n   * Get the event handler.\n   *\n   * @param {LayerGroup} layerGroup The input lqyer group.\n   * @returns {Function} The event handler.\n   */\n  getCallback = function (layerGroup) {\n    return function (event) {\n      const viewLayers = layerGroup.getViewLayersByDataId(event.dataid);\n      if (viewLayers.length !== 0) {\n        const vc = viewLayers[0].getViewController();\n        vc.setColourMap(event.value[0]);\n      }\n    };\n  };\n}\n\n/**\n * Mask view binder.\n */\nexport class MaskViewBinder {\n  /**\n   * Get the associated event.\n   *\n   * @returns {string} The event name.\n   */\n  getEventType = function () {\n    return 'maskviewchange';\n  };\n  /**\n   * Get the event handler.\n   *\n   * @param {LayerGroup} layerGroup The input layer group.\n   * @returns {Function} The event handler.\n   */\n  getCallback = function (layerGroup) {\n    return function (event) {\n      const viewLayers = layerGroup.getViewLayersByDataId(event.dataid);\n      if (viewLayers.length !== 0) {\n        viewLayers[0].setFillOpacity(event.value[0]);\n        viewLayers[0].setContourThickness(event.value[1]);\n      }\n    };\n  };\n}\n\n/**\n * Position binder.\n */\nexport class PositionBinder {\n  /**\n   * Get the associated event.\n   *\n   * @returns {string} The event name.\n   */\n  getEventType = function () {\n    return 'positionchange';\n  };\n  /**\n   * Get the event handler.\n   *\n   * @param {LayerGroup} layerGroup The input lqyer group.\n   * @returns {Function} The event handler.\n   */\n  getCallback = function (layerGroup) {\n    return function (event) {\n      const pointValues = event.value[1];\n      const vls = layerGroup.getViewLayersByDataId(event.dataid);\n      let vl;\n      let sameData = false;\n      if (vls.length !== 0) {\n        // use first layer\n        vl = vls[0];\n        sameData = true;\n      } else {\n        vl = layerGroup.getBaseViewLayer();\n      }\n      const vc = vl.getViewController();\n      // bind 3D for all\n      // bind 4D if same data, otherwise use 3D and keep current\n      const currentPos = vc.getCurrentPosition();\n      const currentDims = currentPos.length();\n      const inputDims = pointValues.length;\n      if (!sameData &&\n        inputDims > 3 && currentDims > 3) {\n        pointValues[3] = currentPos.get(3);\n      }\n      vc.setCurrentPosition(new Point(pointValues));\n    };\n  };\n}\n\n/**\n * Zoom binder.\n */\nexport class ZoomBinder {\n  /**\n   * Get the associated event.\n   *\n   * @returns {string} The event name.\n   */\n  getEventType = function () {\n    return 'zoomchange';\n  };\n  /**\n   * Get the event handler.\n   *\n   * @param {LayerGroup} layerGroup The input lqyer group.\n   * @returns {Function} The event handler.\n   */\n  getCallback = function (layerGroup) {\n    return function (event) {\n      const scale = {\n        x: event.value[0],\n        y: event.value[1],\n        z: event.value[2]\n      };\n      let center;\n      if (event.value.length === 6) {\n        center = new Point3D(\n          event.value[3],\n          event.value[4],\n          event.value[5]\n        );\n      }\n      layerGroup.setScale(scale, center);\n      layerGroup.draw();\n    };\n  };\n}\n\n/**\n * Offset binder.\n */\nexport class OffsetBinder {\n  /**\n   * Get the associated event.\n   *\n   * @returns {string} The event name.\n   */\n  getEventType = function () {\n    return 'offsetchange';\n  };\n  /**\n   * Get the event handler.\n   *\n   * @param {LayerGroup} layerGroup The input lqyer group.\n   * @returns {Function} The event handler.\n   */\n  getCallback = function (layerGroup) {\n    return function (event) {\n      layerGroup.setOffset({\n        x: event.value[0],\n        y: event.value[1],\n        z: event.value[2]\n      });\n      layerGroup.draw();\n    };\n  };\n}\n\n/**\n * Opacity binder. Only propagates to view layers of the same data.\n */\nexport class OpacityBinder {\n  /**\n   * Get the associated event.\n   *\n   * @returns {string} The event name.\n   */\n  getEventType = function () {\n    return 'opacitychange';\n  };\n  /**\n   * Get the event handler.\n   *\n   * @param {LayerGroup} layerGroup The input lqyer group.\n   * @returns {Function} The event handler.\n   */\n  getCallback = function (layerGroup) {\n    return function (event) {\n      // exit if no data id\n      if (typeof event.dataid === 'undefined') {\n        return;\n      }\n      // propagate to first view layer if it is not base layer\n      const viewLayers = layerGroup.getViewLayersByDataId(event.dataid);\n      const baseLayer = layerGroup.getBaseViewLayer();\n      if (viewLayers.length !== 0 && baseLayer !== viewLayers[0]) {\n        viewLayers[0].setOpacity(event.value);\n        viewLayers[0].draw();\n      }\n    };\n  };\n}\n\n/**\n * List of binders.\n */\nexport const binderList = {\n  WindowLevelBinder,\n  PositionBinder,\n  ZoomBinder,\n  OffsetBinder,\n  OpacityBinder,\n  ColourMapBinder,\n  MaskViewBinder\n};\n\n/**\n * Stage: controls a list of layer groups and their\n * synchronisation.\n */\nexport class Stage {\n\n  /**\n   * Associated layer groups.\n   *\n   * @type {LayerGroup[]}\n   */\n  #layerGroups = [];\n\n  /**\n   * Active layer group index.\n   *\n   * @type {number|undefined}\n   */\n  #activeLayerGroupIndex;\n\n  /**\n   * Image smoothing flag.\n   *\n   * @type {boolean}\n   */\n  #imageSmoothing = false;\n\n  // layer group binders\n  #binders = [];\n  // binder callbacks\n  #callbackStore = null;\n\n  /**\n   * Get the layer group at the given index.\n   *\n   * @param {number} index The index.\n   * @returns {LayerGroup|undefined} The layer group.\n   */\n  getLayerGroup(index) {\n    return this.#layerGroups[index];\n  }\n\n  /**\n   * Get the number of layer groups that form the stage.\n   *\n   * @returns {number} The number of layer groups.\n   */\n  getNumberOfLayerGroups() {\n    return this.#layerGroups.length;\n  }\n\n  /**\n   * Get the active layer group.\n   *\n   * @returns {LayerGroup|undefined} The layer group.\n   */\n  getActiveLayerGroup() {\n    return this.getLayerGroup(this.#activeLayerGroupIndex);\n  }\n\n  /**\n   * Set the active layer group.\n   *\n   * @param {number} index The layer group index.\n   */\n  setActiveLayerGroup(index) {\n    if (typeof this.getLayerGroup(index) !== 'undefined') {\n      this.#activeLayerGroupIndex = index;\n    } else {\n      logger.warn('No layer group to set as active with index: ' +\n        index);\n    }\n  }\n\n  /**\n   * Get the view layers associated to a data id.\n   *\n   * @param {string} dataId The data id.\n   * @returns {ViewLayer[]} The layers.\n   */\n  getViewLayersByDataId(dataId) {\n    let res = [];\n    for (const layerGroup of this.#layerGroups) {\n      res = res.concat(layerGroup.getViewLayersByDataId(dataId));\n    }\n    return res;\n  }\n\n  /**\n   * Get a list of view layers according to an input callback function.\n   *\n   * @param {Function} [callbackFn] A function that takes\n   *   a ViewLayer as input and returns a boolean. If undefined,\n   *   returns all view layers.\n   * @returns {ViewLayer[]} The layers that\n   *   satisfy the callbackFn.\n   */\n  getViewLayers(callbackFn) {\n    let res = [];\n    for (const layerGroup of this.#layerGroups) {\n      res = res.concat(layerGroup.getViewLayers(callbackFn));\n    }\n    return res;\n  }\n\n  /**\n   * Get the draw layers associated to a data id.\n   *\n   * @param {string} dataId The data id.\n   * @returns {DrawLayer[]} The layers.\n   */\n  getDrawLayersByDataId(dataId) {\n    let res = [];\n    for (const layerGroup of this.#layerGroups) {\n      res = res.concat(layerGroup.getDrawLayersByDataId(dataId));\n    }\n    return res;\n  }\n\n  /**\n   * Get a list of draw layers according to an input callback function.\n   *\n   * @param {Function} [callbackFn] A function that takes\n   *   a DrawLayer as input and returns a boolean. If undefined,\n   *   returns all draw layers.\n   * @returns {DrawLayer[]} The layers that\n   *   satisfy the callbackFn.\n   */\n  getDrawLayers(callbackFn) {\n    let res = [];\n    for (const layerGroup of this.#layerGroups) {\n      res = res.concat(layerGroup.getDrawLayers(callbackFn));\n    }\n    return res;\n  }\n\n  /**\n   * Add a layer group to the list.\n   *\n   * The new layer group will be marked as the active layer group.\n   *\n   * @param {object} htmlElement The HTML element of the layer group.\n   * @param {boolean} [withInfoOverlay] Optional with info overlay flag,\n   * default to false.\n   * @returns {LayerGroup} The newly created layer group.\n   */\n  addLayerGroup(htmlElement, withInfoOverlay) {\n    this.#activeLayerGroupIndex = this.#layerGroups.length;\n    const layerGroup = new LayerGroup(htmlElement, withInfoOverlay);\n    layerGroup.setImageSmoothing(this.#imageSmoothing);\n    // add to storage\n    const isBound = this.#callbackStore && this.#callbackStore.length !== 0;\n    if (isBound) {\n      this.unbindLayerGroups();\n    }\n    this.#layerGroups.push(layerGroup);\n    if (isBound) {\n      this.bindLayerGroups();\n    }\n    // return created group\n    return layerGroup;\n  }\n\n  /**\n   * Get a layer group from an HTML element id.\n   *\n   * @param {string} id The element id to find.\n   * @returns {LayerGroup|undefined} The layer group.\n   */\n  getLayerGroupByDivId(id) {\n    return this.#layerGroups.find(function (item) {\n      return item.getDivId() === id;\n    });\n  }\n\n  /**\n   * Set the layer groups binders.\n   *\n   * @param {Array} list The list of binder objects.\n   */\n  setBinders(list) {\n    if (typeof list === 'undefined' || list === null) {\n      throw new Error('Cannot set null or undefined binders');\n    }\n    if (this.#binders.length !== 0) {\n      this.unbindLayerGroups();\n    }\n    this.#binders = list.slice();\n    this.bindLayerGroups();\n  }\n\n  /**\n   * Empty the layer group list.\n   */\n  empty() {\n    this.unbindLayerGroups();\n    for (const layerGroup of this.#layerGroups) {\n      layerGroup.empty();\n    }\n    this.#layerGroups = [];\n    this.#activeLayerGroupIndex = undefined;\n  }\n\n  /**\n   * Remove all layers for a specific data.\n   *\n   * @param {string} dataId The data to remove its layers.\n   */\n  removeLayersByDataId(dataId) {\n    for (const layerGroup of this.#layerGroups) {\n      layerGroup.removeLayersByDataId(dataId);\n    }\n  }\n\n  /**\n   * Remove a layer group from this stage.\n   *\n   * @param {LayerGroup} layerGroup The layer group to remove.\n   */\n  removeLayerGroup(layerGroup) {\n    // find layer\n    const index = this.#layerGroups.findIndex((item) => item === layerGroup);\n    if (index === -1) {\n      throw new Error('Cannot find layerGroup to remove');\n    }\n    // unbind\n    this.unbindLayerGroups();\n    // empty layer group\n    layerGroup.empty();\n    // remove from storage\n    this.#layerGroups.splice(index, 1);\n    // update active index\n    if (this.#activeLayerGroupIndex === index) {\n      this.#activeLayerGroupIndex = undefined;\n    }\n    // bind\n    this.bindLayerGroups();\n  }\n\n  /**\n   * Reset the stage: calls reset on all layer groups.\n   *\n   * @deprecated Since v0.35, prefer resetZoomPan.\n   */\n  reset() {\n    for (const layerGroup of this.#layerGroups) {\n      layerGroup.reset();\n    }\n  }\n\n  /**\n   * Reset the zoom and pan of all layer groups.\n   */\n  resetZoomPan() {\n    for (const layerGroup of this.#layerGroups) {\n      layerGroup.resetZoomPan();\n    }\n  }\n\n  /**\n   * Reset the position and window level of all layer groups.\n   */\n  resetViews() {\n    for (const layerGroup of this.#layerGroups) {\n      layerGroup.resetViews();\n    }\n  }\n\n  /**\n   * Draw the stage: calls draw on all layer groups.\n   */\n  draw() {\n    for (const layerGroup of this.#layerGroups) {\n      layerGroup.draw();\n    }\n  }\n\n  /**\n   * Fit to container: synchronise the div to world size ratio\n   *   of the group layers.\n   */\n  fitToContainer() {\n    // find the minimum ratio\n    let minRatio;\n    const hasRatio = [];\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\n      const ratio = this.#layerGroups[i].getDivToWorldSizeRatio();\n      if (typeof ratio !== 'undefined' && this.#layerGroups[i].shouldBind()) {\n        hasRatio.push(i);\n        if (typeof minRatio === 'undefined' || ratio < minRatio) {\n          minRatio = ratio;\n        }\n      }\n    }\n    // apply min ratio to layers\n    for (let j = 0; j < this.#layerGroups.length; ++j) {\n      if (hasRatio.includes(j) && this.#layerGroups[j].shouldBind()) {\n        // minRatio has been set since hasRatio include j\n        this.#layerGroups[j].fitToContainer(minRatio);\n      } else {\n        const ratio = this.#layerGroups[j].getDivToWorldSizeRatio();\n        this.#layerGroups[j].fitToContainer(ratio);\n      }\n    }\n  }\n\n  /**\n   * Bind the layer groups of the stage.\n   */\n  bindLayerGroups() {\n    if (this.#layerGroups.length === 0 ||\n      this.#layerGroups.length === 1 ||\n      this.#binders.length === 0) {\n      return;\n    }\n    // create callback store\n    this.#callbackStore = new Array(this.#layerGroups.length);\n    // add listeners\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\n      if (this.#layerGroups[i].shouldBind()) {\n        for (let j = 0; j < this.#binders.length; ++j) {\n          this.#addEventListeners(i, this.#binders[j]);\n        }\n      }\n    }\n  }\n\n  /**\n   * Unbind the layer groups of the stage.\n   */\n  unbindLayerGroups() {\n    if (this.#layerGroups.length === 0 ||\n      this.#binders.length === 0 ||\n      !this.#callbackStore) {\n      return;\n    }\n    // remove listeners\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\n      if (this.#layerGroups[i].shouldBind()) {\n        for (let j = 0; j < this.#binders.length; ++j) {\n          this.#removeEventListeners(i, this.#binders[j]);\n        }\n      }\n    }\n    // clear callback store\n    this.#callbackStore = null;\n  }\n\n  /**\n   * Set the imageSmoothing flag value.\n   *\n   * @param {boolean} flag True to enable smoothing.\n   */\n  setImageSmoothing(flag) {\n    this.#imageSmoothing = flag;\n    // set for existing layer groups\n    for (const layerGroup of this.#layerGroups) {\n      layerGroup.setImageSmoothing(flag);\n    }\n  }\n\n  /**\n   * Get the binder callback function for a given layer group index.\n   * The function is created if not yet stored.\n   *\n   * @param {object} binder The layer binder.\n   * @param {number} index The index of the associated layer group.\n   * @returns {Function} The binder function.\n   */\n  #getBinderCallback(binder, index) {\n    if (typeof this.#callbackStore[index] === 'undefined') {\n      this.#callbackStore[index] = [];\n    }\n    const store = this.#callbackStore[index];\n    let binderObj = store.find(function (elem) {\n      return elem.binder === binder;\n    });\n    if (typeof binderObj === 'undefined') {\n      // create new callback object\n      binderObj = {\n        binder: binder,\n        callback: (event) => {\n          // stop listeners\n          this.#removeEventListeners(index, binder);\n          // apply binder\n          binder.getCallback(this.#layerGroups[index])(event);\n          // re-start listeners\n          this.#addEventListeners(index, binder);\n        }\n      };\n      this.#callbackStore[index].push(binderObj);\n    }\n    return binderObj.callback;\n  }\n\n  /**\n   * Add event listeners for a given layer group index and binder.\n   *\n   * @param {number} index The index of the associated layer group.\n   * @param {object} binder The layer binder.\n   */\n  #addEventListeners(index, binder) {\n    for (let i = 0; i < this.#layerGroups.length; ++i) {\n      if (i !== index && this.#layerGroups[i].shouldBind()) {\n        this.#layerGroups[index].addEventListener(\n          binder.getEventType(),\n          this.#getBinderCallback(binder, i)\n        );\n      }\n    }\n  }\n\n  /**\n   * Remove event listeners for a given layer group index and binder.\n   *\n   * @param {number} index The index of the associated layer group.\n   * @param {object} binder The layer binder.\n   */\n  #removeEventListeners(index, binder) {\n    if (!this.#callbackStore) {\n      return;\n    }\n    for (const key in this.#callbackStore) {\n      if (parseInt(key, 10) !== index) {\n        for (const binderObj of this.#callbackStore[key]) {\n          if (binderObj.binder.getEventType() === binder.getEventType()) {\n            this.#layerGroups[index].removeEventListener(\n              binder.getEventType(),\n              binderObj.callback\n            );\n          }\n        }\n      }\n    }\n  }\n\n} // class Stage\n","import {Index} from '../math/index.js';\nimport {colourNameToHex} from '../utils/colour.js';\nimport {WindowLevel} from '../image/windowLevel.js';\n\n// external\nimport Konva from 'konva';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * State class.\n * Saves: data url/path, display info.\n *\n * @deprecated Since v0.34, please switch to DICOM SR annotations.\n *\n * History:\n * - v0.5 (dwv 0.30.0, 12/2021):\n *   - store position as array,\n *   - new draw position group key.\n * - v0.4 (dwv 0.29.0, 06/2021):\n *   - move drawing details into meta property,\n *   - remove scale center and translation, add offset.\n * - v0.3 (dwv v0.23.0, 03/2018):\n *   - new drawing structure, drawings are now the full layer object and\n *     using toObject to avoid saving a string representation,\n *   - new details structure: simple array of objects referenced by draw ids.\n * - v0.2 (dwv v0.17.0, 12/2016):\n *   - adds draw details: array [nslices][nframes] of detail objects.\n * - v0.1 (dwv v0.15.0, 07/2016):\n *   - adds version,\n *   - drawings: array [nslices][nframes] with all groups.\n * - initial release (dwv v0.10.0, 05/2015), no version number:\n *   - content: window-center, window-width, position, scale,\n *       scaleCenter, translation, drawings,\n *   - drawings: array [nslices] with all groups.\n */\nexport class State {\n  /**\n   * The state data id.\n   *\n   * @type {string}\n   */\n  #dataId;\n\n  /**\n   * @param {string} dataId The associated data id.\n   */\n  constructor(dataId) {\n    this.#dataId = dataId;\n  }\n\n  /**\n   * Load an application state from JSON.\n   *\n   * @param {string} json The state as a JSON string.\n   * @returns {object} The state object.\n   */\n  fromJSON(json) {\n    const data = JSON.parse(json);\n    let res = null;\n    if (data.version === '0.1') {\n      res = this.#readV01(data);\n    } else if (data.version === '0.2') {\n      res = this.#readV02(data);\n    } else if (data.version === '0.3') {\n      res = this.#readV03(data);\n    } else if (data.version === '0.4') {\n      res = this.#readV04(data);\n    } else if (data.version === '0.5') {\n      res = this.#readV05(data);\n    } else {\n      throw new Error('Unknown state file format version: \\'' +\n        data.version + '\\'.');\n    }\n    return res;\n  }\n\n  /**\n   * Load an application state from JSON.\n   *\n   * @param {App} app The app to apply the state to.\n   * @param {object} data The state data.\n   */\n  apply(app, data) {\n    const layerGroup = app.getActiveLayerGroup();\n    const viewLayer = layerGroup.getBaseViewLayer();\n    const viewController = viewLayer.getViewController();\n    // display\n    const wl = new WindowLevel(data['window-center'], data['window-width']);\n    viewController.setWindowLevel(wl);\n\n    // position is index for state before v0.4, point for v0.5\n    // position is origin so set position does not make much sense...\n    //viewController.setCurrentIndex(new Index(data.position));\n\n    // apply saved scale on top of current base one\n    const baseScale = app.getActiveLayerGroup().getBaseScale();\n    let scale = null;\n    let offset = null;\n    if (typeof data.scaleCenter !== 'undefined') {\n      scale = {\n        x: data.scale * baseScale.x,\n        y: data.scale * baseScale.y,\n        z: 1\n      };\n      // ---- transform translation (now) ----\n      // Tx = -offset.x * scale.x\n      // => offset.x = -Tx / scale.x\n      // ---- transform translation (before) ----\n      // origin.x = centerX - (centerX - origin.x) * (newZoomX / zoom.x);\n      // (zoom.x -> initial zoom = base scale, origin.x = 0)\n      // Tx = origin.x + (trans.x * zoom.x)\n      const originX = data.scaleCenter.x - data.scaleCenter.x * data.scale;\n      const originY = data.scaleCenter.y - data.scaleCenter.y * data.scale;\n      const oldTx = originX + data.translation.x * scale.x;\n      const oldTy = originY + data.translation.y * scale.y;\n      offset = {\n        x: -oldTx / scale.x,\n        y: -oldTy / scale.y,\n        z: 0\n      };\n    } else {\n      scale = {\n        x: data.scale.x * baseScale.x,\n        y: data.scale.y * baseScale.y,\n        z: baseScale.z\n      };\n      offset = {\n        x: data.offset.x,\n        y: data.offset.y,\n        z: 0\n      };\n    }\n    app.getActiveLayerGroup().setScale(scale);\n    app.getActiveLayerGroup().setOffset(offset);\n    // drawings (will draw the draw layer)\n    app.setDrawings(data.drawings, data.drawingsDetails, this.#dataId);\n  }\n\n  /**\n   * Read an application state from an Object in v0.1 format.\n   *\n   * @param {object} data The Object representation of the state.\n   * @returns {object} The state object.\n   */\n  #readV01(data) {\n    // v0.1 -> v0.2\n    const v02DAndD = v01Tov02DrawingsAndDetails(data.drawings);\n    // v0.2 -> v0.3, v0.4\n    data.drawings = v02Tov03Drawings(v02DAndD.drawings).toObject();\n    data.drawingsDetails = v03Tov04DrawingsDetails(\n      v02DAndD.drawingsDetails);\n    // v0.4 -> v0.5\n    data = v04Tov05Data(data);\n    data.drawings = v04Tov05Drawings(data.drawings);\n    return data;\n  }\n\n  /**\n   * Read an application state from an Object in v0.2 format.\n   *\n   * @param {object} data The Object representation of the state.\n   * @returns {object} The state object.\n   */\n  #readV02(data) {\n    // v0.2 -> v0.3, v0.4\n    data.drawings = v02Tov03Drawings(data.drawings).toObject();\n    data.drawingsDetails = v03Tov04DrawingsDetails(\n      v02Tov03DrawingsDetails(data.drawingsDetails));\n    // v0.4 -> v0.5\n    data = v04Tov05Data(data);\n    data.drawings = v04Tov05Drawings(data.drawings);\n    return data;\n  }\n\n  /**\n   * Read an application state from an Object in v0.3 format.\n   *\n   * @param {object} data The Object representation of the state.\n   * @returns {object} The state object.\n   */\n  #readV03(data) {\n    // v0.3 -> v0.4\n    data.drawingsDetails = v03Tov04DrawingsDetails(data.drawingsDetails);\n    // v0.4 -> v0.5\n    data = v04Tov05Data(data);\n    data.drawings = v04Tov05Drawings(data.drawings);\n    return data;\n  }\n\n  /**\n   * Read an application state from an Object in v0.4 format.\n   *\n   * @param {object} data The Object representation of the state.\n   * @returns {object} The state object.\n   */\n  #readV04(data) {\n    // v0.4 -> v0.5\n    data = v04Tov05Data(data);\n    data.drawings = v04Tov05Drawings(data.drawings);\n    return data;\n  }\n  /**\n   * Read an application state from an Object in v0.5 format.\n   *\n   * @param {object} data The Object representation of the state.\n   * @returns {object} The state object.\n   */\n  #readV05(data) {\n    return data;\n  }\n\n} // State class\n\n/**\n * Convert drawings from v0.2 to v0.3:\n * - v0.2: one layer per slice/frame,\n * - v0.3: one layer, one group per slice. `setDrawing` expects the full stage.\n *\n * @param {Array} drawings An array of drawings.\n * @returns {object} The layer with the converted drawings.\n */\nfunction v02Tov03Drawings(drawings) {\n  // Auxiliar variables\n  let group, groupShapes, parentGroup;\n  // Avoid errors when dropping multiple states\n  //drawLayer.getChildren().each(function(node){\n  //    node.visible(false);\n  //});\n\n  /**\n   * Get the draw group id for a given position.\n   *\n   * @param {Index} currentPosition The current position.\n   * @returns {string} The group id.\n   */\n  function getDrawPositionGroupId(currentPosition) {\n    const sliceNumber = currentPosition.get(2);\n    const frameNumber = currentPosition.length() === 4\n      ? currentPosition.get(3) : 0;\n    return 'slice-' + sliceNumber + '_frame-' + frameNumber;\n  }\n\n  const drawLayer = new Konva.Layer({\n    listening: false,\n    visible: true\n  });\n\n  // Get the positions-groups data\n  const groupDrawings = typeof drawings === 'string'\n    ? JSON.parse(drawings) : drawings;\n  // Iterate over each position-groups\n  for (let k = 0, lenk = groupDrawings.length; k < lenk; ++k) {\n    // Iterate over each frame\n    for (let f = 0, lenf = groupDrawings[k].length; f < lenf; ++f) {\n      groupShapes = groupDrawings[k][f];\n      if (groupShapes.length !== 0) {\n        // Create position-group set as visible and append it to drawLayer\n        parentGroup = new Konva.Group({\n          id: getDrawPositionGroupId(new Index([1, 1, k, f])),\n          name: 'position-group',\n          visible: false\n        });\n\n        // Iterate over shapes-group\n        for (let g = 0, leng = groupShapes.length; g < leng; ++g) {\n          // create the konva group\n          group = Konva.Node.create(groupShapes[g]);\n          // enforce draggable: only the shape was draggable in v0.2,\n          // now the whole group is.\n          group.draggable(true);\n          group.getChildren().forEach(function (gnode) {\n            gnode.draggable(false);\n          });\n          // add to position group\n          parentGroup.add(group);\n        }\n        // add to layer\n        drawLayer.add(parentGroup);\n      }\n    }\n  }\n\n  return drawLayer;\n}\n\n/**\n * Convert drawings from v0.1 to v0.2:\n * - v0.1: text on its own,\n * - v0.2: text as part of label.\n *\n * @param {Array} inputDrawings An array of drawings.\n * @returns {object} The converted drawings.\n */\nfunction v01Tov02DrawingsAndDetails(inputDrawings) {\n  const newDrawings = [];\n  const drawingsDetails = {};\n\n  let drawGroups;\n  let drawGroup;\n  // loop over each slice\n  for (let k = 0, lenk = inputDrawings.length; k < lenk; ++k) {\n    // loop over each frame\n    newDrawings[k] = [];\n    for (let f = 0, lenf = inputDrawings[k].length; f < lenf; ++f) {\n      // draw group\n      drawGroups = inputDrawings[k][f];\n      const newFrameDrawings = [];\n      // Iterate over shapes-group\n      for (let g = 0, leng = drawGroups.length; g < leng; ++g) {\n        // create konva group from input\n        drawGroup = Konva.Node.create(drawGroups[g]);\n        // force visible (not set in state)\n        drawGroup.visible(true);\n        // label position\n        let pos = {x: 0, y: 0};\n        // update shape colour\n        const kshape = drawGroup.getChildren(function (node) {\n          return node.name() === 'shape';\n        })[0];\n        kshape.stroke(colourNameToHex(kshape.stroke()));\n        // special line case\n        if (drawGroup.name() === 'line-group') {\n          // update name\n          drawGroup.name('ruler-group');\n          // add ticks\n          const ktick0 = new Konva.Line({\n            points: [kshape.points()[0],\n              kshape.points()[1],\n              kshape.points()[0],\n              kshape.points()[1]],\n            name: 'shape-tick0'\n          });\n          drawGroup.add(ktick0);\n          const ktick1 = new Konva.Line({\n            points: [kshape.points()[2],\n              kshape.points()[3],\n              kshape.points()[2],\n              kshape.points()[3]],\n            name: 'shape-tick1'\n          });\n          drawGroup.add(ktick1);\n        }\n        // special protractor case: update arc name\n        const karcs = drawGroup.getChildren(function (node) {\n          return node.name() === 'arc';\n        });\n        if (karcs.length === 1) {\n          karcs[0].name('shape-arc');\n        }\n        // get its text\n        const ktexts = drawGroup.getChildren(function (node) {\n          return node.name() === 'text';\n        });\n        // update text: move it into a label\n        let ktext = new Konva.Text({\n          name: 'text',\n          text: ''\n        });\n        if (ktexts.length === 1) {\n          pos.x = ktexts[0].x();\n          pos.y = ktexts[0].y();\n          // remove it from the group\n          ktexts[0].remove();\n          // use it\n          ktext = ktexts[0];\n        } else {\n          // use shape position if no text\n          if (kshape.points().length !== 0) {\n            pos = {x: kshape.points()[0],\n              y: kshape.points()[1]};\n          }\n        }\n        // create new label with text and tag\n        const klabel = new Konva.Label({\n          x: pos.x,\n          y: pos.y,\n          name: 'label'\n        });\n        klabel.add(ktext);\n        klabel.add(new Konva.Tag());\n        // add label to group\n        drawGroup.add(klabel);\n        // add group to list\n        newFrameDrawings.push(JSON.stringify(drawGroup.toObject()));\n\n        // create details (v0.3 format)\n        let textExpr = ktext.text();\n        const txtLen = textExpr.length;\n        let quant = null;\n        // adapt to text with flag\n        if (drawGroup.name() === 'ruler-group') {\n          quant = {\n            length: {\n              value: parseFloat(textExpr.substring(0, txtLen - 2)),\n              unit: textExpr.substring(-2)\n            }\n          };\n          textExpr = '{length}';\n        } else if (drawGroup.name() === 'ellipse-group' ||\n          drawGroup.name() === 'rectangle-group') {\n          quant = {\n            surface: {\n              value: parseFloat(textExpr.substring(0, txtLen - 3)),\n              unit: textExpr.substring(-3)\n            }\n          };\n          textExpr = '{surface}';\n        } else if (drawGroup.name() === 'protractor-group' ||\n          drawGroup.name() === 'rectangle-group') {\n          quant = {\n            angle: {\n              value: parseFloat(textExpr.substring(0, txtLen - 1)),\n              unit: textExpr.substring(-1)\n            }\n          };\n          textExpr = '{angle}';\n        }\n        // set details\n        drawingsDetails[drawGroup.id()] = {\n          textExpr: textExpr,\n          longText: '',\n          quant: quant\n        };\n\n      }\n      newDrawings[k].push(newFrameDrawings);\n    }\n  }\n\n  return {drawings: newDrawings, drawingsDetails: drawingsDetails};\n}\n\n/**\n * Convert drawing details from v0.2 to v0.3:\n * - v0.2: array [nslices][nframes] with all,\n * - v0.3: simple array of objects referenced by draw ids.\n *\n * @param {Array} details An array of drawing details.\n * @returns {object} The converted drawings.\n */\nfunction v02Tov03DrawingsDetails(details) {\n  const res = {};\n  // Get the positions-groups data\n  const groupDetails = typeof details === 'string'\n    ? JSON.parse(details) : details;\n  // Iterate over each position-groups\n  for (let k = 0, lenk = groupDetails.length; k < lenk; ++k) {\n    // Iterate over each frame\n    for (let f = 0, lenf = groupDetails[k].length; f < lenf; ++f) {\n      // Iterate over shapes-group\n      for (let g = 0, leng = groupDetails[k][f].length; g < leng; ++g) {\n        const group = groupDetails[k][f][g];\n        res[group.id] = {\n          textExpr: group.textExpr,\n          longText: group.longText,\n          quant: group.quant\n        };\n      }\n    }\n  }\n  return res;\n}\n\n/**\n * Convert drawing details from v0.3 to v0.4:\n * - v0.3: properties at group root,\n * - v0.4: properties in group meta object.\n *\n * @param {Array} details An array of drawing details.\n * @returns {object} The converted drawings.\n */\nfunction v03Tov04DrawingsDetails(details) {\n  const res = {};\n  const keys = Object.keys(details);\n  // Iterate over each position-groups\n  for (let k = 0, lenk = keys.length; k < lenk; ++k) {\n    const detail = details[keys[k]];\n    res[keys[k]] = {\n      meta: {\n        textExpr: detail.textExpr,\n        longText: detail.longText,\n        quantification: detail.quant\n      }\n    };\n  }\n  return res;\n}\n\n/**\n * Convert drawing from v0.4 to v0.5:\n * - v0.4: position as object,\n * - v0.5: position as array.\n *\n * @param {object} data An array of drawing.\n * @returns {object} The converted drawings.\n */\nfunction v04Tov05Data(data) {\n  const pos = data.position;\n  data.position = [pos.i, pos.j, pos.k];\n  return data;\n}\n\n/**\n * Convert drawing from v0.4 to v0.5:\n * - v0.4: draw id as 'slice-0_frame-1',\n * - v0.5: draw id as '#2-0_#3-1'.\n *\n * @param {object} inputDrawings An array of drawing.\n * @returns {object} The converted drawings.\n */\nfunction v04Tov05Drawings(inputDrawings) {\n  // Iterate over each position-groups\n  const posGroups = inputDrawings.children;\n  for (let k = 0, lenk = posGroups.length; k < lenk; ++k) {\n    const posGroup = posGroups[k];\n    const id = posGroup.attrs.id;\n    const ids = id.split('_');\n    const sliceNumber = parseInt(ids[0].substring(6), 10); // 'slice-0'\n    const frameNumber = parseInt(ids[1].substring(6), 10); // 'frame-0'\n    let newId = '#2-';\n    if (sliceNumber === 0 && frameNumber !== 0) {\n      newId += frameNumber;\n    } else {\n      newId += sliceNumber;\n    }\n    posGroup.attrs.id = newId;\n  }\n  return inputDrawings;\n}\n","import {logger} from './logger.js';\nimport {splitKeyValueString} from './string.js';\n\n/**\n * Get an full object URL from a string uri.\n *\n * @param {string} uri A string representing the url.\n * @returns {URL} A URL object.\n */\nexport function getUrlFromUri(uri) {\n  // add base to allow for relative urls\n  // (base is not used for absolute urls)\n  let base;\n  if (window.location.origin !== 'null') {\n    base = window.location.origin;\n  }\n  return new URL(uri, base);\n}\n\n/**\n * Split an input URI:\n * 'root?key0=val00&key0=val01&key1=val10' returns\n * { base : root, query : [ key0 : [val00, val01], key1 : val1 ] }\n * Returns an empty object if the input string is not correct (null, empty...)\n * or if it is not a query string (no question mark).\n *\n * @param {string} uri The string to split.\n * @returns {object} The split string.\n */\nexport function splitUri(uri) {\n  // result\n  const result = {};\n  // check if query string\n  let sepIndex = null;\n  if (uri && (sepIndex = uri.indexOf('?')) !== -1) {\n    // base: before the '?'\n    result.base = uri.substring(0, sepIndex);\n    // query : after the '?' and until possible '#'\n    let hashIndex = uri.indexOf('#');\n    if (hashIndex === -1) {\n      hashIndex = uri.length;\n    }\n    const query = uri.substring(sepIndex + 1, hashIndex);\n    // split key/value pairs of the query\n    result.query = splitKeyValueString(query);\n  }\n  // return\n  return result;\n}\n\n/**\n * Get the query part, split into an array, of an input URI.\n * The URI scheme is: `base?query#fragment`.\n *\n * @param {string} uri The input URI.\n * @returns {object} The query part, split into an array, of the input URI.\n */\nexport function getUriQuery(uri) {\n  // split\n  const parts = splitUri(uri);\n  // check not empty\n  if (Object.keys(parts).length === 0) {\n    return null;\n  }\n  // return query\n  return parts.query;\n}\n\n/**\n * Generic URI query decoder.\n * Supports manifest:\n *   `[dwv root]?input=encodeURIComponent('[manifest file]')&type=manifest`.\n * Or encoded URI with base and key value/pairs:\n *   `[dwv root]?input=encodeURIComponent([root]?key0=value0&key1=value1)`.\n *\n * @param {object} query The query part to the input URI.\n * @param {Function} callback The function to call with the decoded file urls.\n * @param {object} options Optional url request options.\n * @deprecated Since v0.36, please use specialised\n *   getURLsFromKeyValueUri and app.loadURLS or\n *   handleURLsFromWeasisXMLManifest.\n */\nexport function decodeQuery(query, callback, options) {\n  // manifest\n  if (query.type && query.type === 'manifest') {\n    decodeWeasisXMLManifest(query.input, query.nslices, callback);\n  } else {\n    // default case: encoded URI with base and key/value pairs\n    callback(\n      decodeKeyValueUri(query.input, query.dwvReplaceMode),\n      options);\n  }\n}\n\n/**\n * Get a list of URLs from a uri containing key-value pairs as in:\n * `[dwv root]?input=encodeURIComponent([root]?key0=value0&key1=value1)`.\n *\n * @param {string} uri The input URI.\n * @returns {string[]|undefined} The list of URLs.\n */\nexport function getURLsFromKeyValueUri(uri) {\n  let urls;\n  const query = getUriQuery(uri);\n  if (query && typeof query.input !== 'undefined') {\n    urls = decodeKeyValueUri(query.input, query.dwvReplaceMode);\n  }\n  return urls;\n}\n\n/**\n * Handle (ie call callback) with the list of urls contained in\n *   a WEASIS XML manifest provided via a uri as in:\n *   `[dwv root]?input=encodeURIComponent('[manifest file]')&type=manifest`.\n *\n * @param {string} uri The input URI.\n * @param {Function} callback The function to call with the decoded file urls.\n */\nexport function handleURLsFromWeasisXMLManifest(uri, callback) {\n  const query = getUriQuery(uri);\n  if (query && typeof query.input !== 'undefined') {\n    decodeWeasisXMLManifest(query.input, query.nslices, callback);\n  }\n}\n\n/**\n * Decode a Key/Value pair URI. If a key is repeated, the result\n *   be an array of base + each key.\n *\n * @param {string} uri The URI to decode.\n * @param {string} replaceMode The key replace mode. Can be:\n * - key (default): keep the key\n * - other than key: do not use the key\n *   'file' is a special case where the '?' of the query is not kept.\n * @returns {string[]} The list of input file urls.\n */\nexport function decodeKeyValueUri(uri, replaceMode) {\n  const result = [];\n\n  // repeat key replace mode (default to keep key)\n  let repeatKeyReplaceMode = 'key';\n  if (replaceMode) {\n    repeatKeyReplaceMode = replaceMode;\n  }\n\n  // decode input URI\n  const queryUri = decodeURIComponent(uri);\n  // get key/value pairs from input URI\n  const inputQueryPairs = splitUri(queryUri);\n  if (Object.keys(inputQueryPairs).length === 0) {\n    result.push(queryUri);\n  } else {\n    const keys = Object.keys(inputQueryPairs.query);\n    // find repeat key\n    let repeatKey = null;\n    for (let i = 0; i < keys.length; ++i) {\n      if (inputQueryPairs.query[keys[i]] instanceof Array) {\n        repeatKey = keys[i];\n        break;\n      }\n    }\n\n    if (!repeatKey) {\n      result.push(queryUri);\n    } else {\n      const repeatList = inputQueryPairs.query[repeatKey];\n      // build base uri\n      let baseUrl = inputQueryPairs.base;\n      // add '?' when:\n      // - base is not empty\n      // - the repeatKey is not 'file'\n      // root/path/to/?file=0.jpg&file=1.jpg\n      if (baseUrl !== '' && repeatKey !== 'file') {\n        baseUrl += '?';\n      }\n      let gotOneArg = false;\n      for (let j = 0; j < keys.length; ++j) {\n        if (keys[j] !== repeatKey) {\n          if (gotOneArg) {\n            baseUrl += '&';\n          }\n          baseUrl += keys[j] + '=' + inputQueryPairs.query[keys[j]];\n          gotOneArg = true;\n        }\n      }\n      // append built urls to result\n      let url;\n      for (let k = 0; k < repeatList.length; ++k) {\n        url = baseUrl;\n        if (gotOneArg) {\n          url += '&';\n        }\n        if (repeatKeyReplaceMode === 'key') {\n          url += repeatKey + '=';\n        }\n        // other than 'key' mode: do nothing\n        url += repeatList[k];\n        result.push(url);\n      }\n    }\n  }\n  // return\n  return result;\n}\n\n/**\n * Decode a WEASIS XML manifest.\n *\n * @external XMLHttpRequest\n * @param {string} manifestUri The manifest uri.\n * @param {number} nslices The number of slices.\n * @param {Function} callback The function to call with the WADO urls.\n */\nexport function decodeWeasisXMLManifest(manifestUri, nslices, callback) {\n  let uri = '';\n  if (manifestUri[0] === '/') {\n    uri = window.location.protocol + '//' + window.location.host;\n  }\n  // TODO: needs to be decoded (decodeURIComponent?\n  uri += manifestUri;\n\n  /**\n   * Handle error.\n   *\n   * @param {object} event The error event.\n   */\n  function onError(event) {\n    logger.warn('RequestError while receiving manifest: ' +\n      event.target.status);\n  }\n\n  /**\n   * Handle load.\n   *\n   * @param {object} event The load event.\n   */\n  function onLoad(event) {\n    callback(parseWeasisXMLManifest(event.target.responseXML, nslices));\n  }\n\n  const request = new XMLHttpRequest();\n  request.open('GET', decodeURIComponent(uri), true);\n  request.responseType = 'document';\n  request.onload = onLoad;\n  request.onerror = onError;\n  request.send(null);\n}\n\n/**\n * Parse a WEASIS XML manifest.\n * See: {@link https://weasis.org/en/basics/customize/integration/#build-an-xml-manifest}.\n *\n * @param {XMLDocument} manifest The manifest to decode.\n * @param {number} nslices The number of slices to load.\n * @returns {string[]} A list of WADO urls.\n */\nexport function parseWeasisXMLManifest(manifest, nslices) {\n  const result = [];\n  // wado url\n  const wadoElement = manifest.getElementsByTagName('wado_query');\n  const wadoURL = wadoElement[0].getAttribute('wadoURL');\n  const rootURL = wadoURL + '?requestType=WADO&contentType=application/dicom&';\n  // patient list\n  const patientList = manifest.getElementsByTagName('Patient');\n  if (patientList.length > 1) {\n    logger.warn('More than one patient, loading first one.');\n  }\n  // study list\n  const studyList = patientList[0].getElementsByTagName('Study');\n  if (studyList.length > 1) {\n    logger.warn('More than one study, loading first one.');\n  }\n  const studyUID = studyList[0].getAttribute('StudyInstanceUID');\n  // series list\n  const seriesList = studyList[0].getElementsByTagName('Series');\n  if (seriesList.length > 1) {\n    logger.warn('More than one series, loading first one.');\n  }\n  const seriesUID = seriesList[0].getAttribute('SeriesInstanceUID');\n  // instance list\n  const instanceList = seriesList[0].getElementsByTagName('Instance');\n  // loop on instances and push links\n  let max = instanceList.length;\n  if (nslices < max) {\n    max = nslices;\n  }\n  for (let i = 0; i < max; ++i) {\n    const sopInstanceUID = instanceList[i].getAttribute('SOPInstanceUID');\n    const link = rootURL +\n      '&studyUID=' + studyUID +\n      '&seriesUID=' + seriesUID +\n      '&objectUID=' + sopInstanceUID;\n    result.push(link);\n  }\n  // return\n  return result;\n}\n","import {InteractionEventNames} from '../gui/generic.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {LayerGroup} from '../gui/layerGroup.js';\nimport {ViewLayer} from '../gui/viewLayer.js';\nimport {DrawLayer} from '../gui/drawLayer.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Toolbox controller.\n */\nexport class ToolboxController {\n\n  /**\n   * List of tools to control.\n   *\n   * @type {object}\n   */\n  #toolList;\n\n  /**\n   * Selected tool.\n   *\n   * @type {object}\n   */\n  #selectedTool = null;\n\n  /**\n   * Callback store to allow attach/detach.\n   *\n   * @type {Array}\n   */\n  #callbackStore = [];\n\n  /**\n   * Current layers bound to tool.\n   *\n   * @type {object}\n   */\n  #boundLayers = {};\n\n  /**\n   * @param {object} toolList The list of tool objects.\n   */\n  constructor(toolList) {\n    this.#toolList = toolList;\n  }\n\n  /**\n   * Initialise.\n   */\n  init() {\n    for (const key in this.#toolList) {\n      this.#toolList[key].init();\n    }\n    // enable shortcuts\n    this.enableShortcuts(true);\n  }\n\n  /**\n   * Enable or disable shortcuts. The 'init' methods enables shortcuts\n   *  by default. Call this method after init to disable shortcuts.\n   *\n   * @param {boolean} flag True to enable shortcuts.\n   */\n  enableShortcuts(flag) {\n    if (flag) {\n      window.addEventListener('keydown',\n        this.#getCallback('window', 'keydown'), true);\n    } else {\n      window.removeEventListener('keydown',\n        this.#getCallback('window', 'keydown'), true);\n    }\n  }\n\n  /**\n   * Get the tool list.\n   *\n   * @returns {Array} The list of tool objects.\n   */\n  getToolList() {\n    return this.#toolList;\n  }\n\n  /**\n   * Check if a tool is in the tool list.\n   *\n   * @param {string} name The name to check.\n   * @returns {boolean} The tool list element for the given name.\n   */\n  hasTool(name) {\n    return typeof this.getToolList()[name] !== 'undefined';\n  }\n\n  /**\n   * Get the selected tool.\n   *\n   * @returns {object} The selected tool.\n   */\n  getSelectedTool() {\n    return this.#selectedTool;\n  }\n\n  /**\n   * Get the selected tool event handler.\n   *\n   * @param {string} eventType The event type, for example\n   *   mousedown, touchstart...\n   * @returns {Function} The event handler.\n   */\n  getSelectedToolEventHandler(eventType) {\n    return this.getSelectedTool()[eventType];\n  }\n\n  /**\n   * Set the selected tool.\n   *\n   * @param {string} name The name of the tool.\n   */\n  setSelectedTool(name) {\n    // check if we have it\n    if (!this.hasTool(name)) {\n      throw new Error('Unknown tool: \\'' + name + '\\'');\n    }\n    // de-activate previous\n    if (this.#selectedTool) {\n      this.#selectedTool.activate(false);\n    }\n    // set internal var\n    this.#selectedTool = this.#toolList[name];\n    // activate new tool\n    this.#selectedTool.activate(true);\n  }\n\n  /**\n   * Set the selected tool live features.\n   *\n   * @param {object} list The list of features.\n   */\n  setToolFeatures(list) {\n    if (this.getSelectedTool()) {\n      this.getSelectedTool().setFeatures(list);\n    }\n  }\n\n  /**\n   * Listen to layer interaction events.\n   *\n   * @param {LayerGroup} layerGroup The associated layer group.\n   * @param {ViewLayer|DrawLayer} layer The layer to listen to.\n   */\n  bindLayerGroup(layerGroup, layer) {\n    const divId = layerGroup.getDivId();\n    // listen to active layer changes\n    layerGroup.addEventListener(\n      'activelayerchange', this.#getActiveLayerChangeHandler(divId));\n    // bind the layer\n    this.#internalBindLayerGroup(divId, layer);\n  }\n\n  /**\n   * Bind a layer group to this controller.\n   *\n   * @param {string} layerGroupDivId The layer group div id.\n   * @param {ViewLayer|DrawLayer} layer The layer.\n   */\n  #internalBindLayerGroup(layerGroupDivId, layer) {\n    // remove from local list if preset\n    if (typeof this.#boundLayers[layerGroupDivId] !== 'undefined') {\n      this.#unbindLayer(this.#boundLayers[layerGroupDivId]);\n    }\n    // replace layer in local list\n    this.#boundLayers[layerGroupDivId] = layer;\n    // bind layer\n    this.#bindLayer(layer);\n  }\n\n  /**\n   * Get an active layer change handler.\n   *\n   * @param {string} divId The associated layer group div id.\n   * @returns {Function} The event handler.\n   */\n  #getActiveLayerChangeHandler(divId) {\n    return (event) => {\n      const layer = event.value[0];\n      if (typeof layer !== 'undefined') {\n        this.#internalBindLayerGroup(divId, layer);\n      }\n    };\n  }\n\n  /**\n   * Add canvas mouse and touch listeners to a layer.\n   *\n   * @param {ViewLayer|DrawLayer} layer The layer to start listening to.\n   */\n  #bindLayer(layer) {\n    layer.bindInteraction();\n    // interaction events\n    const names = InteractionEventNames;\n    for (let i = 0; i < names.length; ++i) {\n      layer.addEventListener(names[i],\n        this.#getCallback(layer.getId(), names[i]));\n    }\n  }\n\n  /**\n   * Remove canvas mouse and touch listeners to a layer.\n   *\n   * @param {ViewLayer|DrawLayer} layer The layer to stop listening to.\n   */\n  #unbindLayer(layer) {\n    layer.unbindInteraction();\n    // interaction events\n    const names = InteractionEventNames;\n    for (let i = 0; i < names.length; ++i) {\n      layer.removeEventListener(names[i],\n        this.#getCallback(layer.getId(), names[i]));\n    }\n  }\n\n  /**\n   * Mou(se) and (T)ouch event handler. This function just determines\n   * the mouse/touch position relative to the canvas element.\n   * It then passes it to the current tool.\n   *\n   * @param {string} layerId The layer id.\n   * @param {string} eventType The event type.\n   * @returns {object} A callback for the provided layer and event.\n   */\n  #getCallback(layerId, eventType) {\n    if (typeof this.#callbackStore[layerId] === 'undefined') {\n      this.#callbackStore[layerId] = [];\n    }\n\n    if (typeof this.#callbackStore[layerId][eventType] === 'undefined') {\n      const applySelectedTool = (event) => {\n        // make sure we have a tool\n        if (this.#selectedTool) {\n          const func = this.#selectedTool[event.type];\n          if (func) {\n            func(event);\n          }\n        }\n      };\n      // store callback\n      this.#callbackStore[layerId][eventType] = applySelectedTool;\n    }\n\n    return this.#callbackStore[layerId][eventType];\n  }\n\n} // class ToolboxController\n","/**\n * Multiple progresses handler.\n * Stores a multi dimensional list of progresses to allow to\n * calculate a global progress.\n *\n */\nexport class MultiProgressHandler {\n\n  /**\n   * List of progresses.\n   * First dimension is a list of item for which the progress is recorded,\n   *   for example file names.\n   * Second dimension is a list of possible progresses, for example\n   *   the progress of the download and the progress of the decoding.\n   *\n   * @type {Array}\n   */\n  #progresses = [];\n\n  /**\n   * Number of dimensions.\n   *\n   * @type {number}\n   */\n  #numberOfDimensions = 2;\n\n  /**\n   * Progress callback.\n   *\n   * @type {Function}\n   */\n  #callback;\n\n  /**\n   * @param {Function} callback The function to pass the global progress to.\n   */\n  constructor(callback) {\n    this.#callback = callback;\n  }\n\n  /**\n   * Set the number of dimensions.\n   *\n   * @param {number} num The number.\n   */\n  setNumberOfDimensions(num) {\n    this.#numberOfDimensions = num;\n  }\n\n  /**\n   * Set the number of data to load.\n   *\n   * @param {number} n The number of data to load.\n   */\n  setNToLoad(n) {\n    for (let i = 0; i < n; ++i) {\n      this.#progresses[i] = [];\n      for (let j = 0; j < this.#numberOfDimensions; ++j) {\n        this.#progresses[i][j] = 0;\n      }\n    }\n  }\n\n  /**\n   * Handle a load progress.\n   * Call the member callback with a global event.\n   *\n   * @param {object} event The progress event.\n   */\n  onprogress = (event) => {\n    // check event\n    if (!event.lengthComputable) {\n      return;\n    }\n    if (typeof event.subindex === 'undefined') {\n      return;\n    }\n    if (typeof event.index === 'undefined') {\n      return;\n    }\n    // calculate percent\n    const percent = (event.loaded * 100) / event.total;\n    // set percent for index\n    this.#progresses[event.index][event.subindex] = percent;\n\n    // item progress\n    let item = null;\n    if (typeof event.item !== 'undefined') {\n      item = event.item;\n    } else {\n      item = {\n        loaded: this.#getItemProgress(event.index),\n        total: 100,\n        source: event.source\n      };\n    }\n\n    // call callback with a global event\n    this.#callback({\n      lengthComputable: true,\n      loaded: this.#getGlobalPercent(),\n      total: 100,\n      item: item\n    });\n  };\n\n  /**\n   * Get the item load percent.\n   *\n   * @param {number} index The index of the item.\n   * @returns {number} The load percentage.\n   */\n  #getItemProgress(index) {\n    let sum = 0;\n    for (let j = 0; j < this.#numberOfDimensions; ++j) {\n      sum += this.#progresses[index][j];\n    }\n    return sum / this.#numberOfDimensions;\n  }\n\n  /**\n   * Get the global load percent including the provided one.\n   *\n   * @returns {number} The accumulated percentage.\n   */\n  #getGlobalPercent() {\n    let sum = 0;\n    const lenprog = this.#progresses.length;\n    for (let i = 0; i < lenprog; ++i) {\n      sum += this.#getItemProgress(i);\n    }\n    return Math.round(sum / lenprog);\n  }\n\n\n  /**\n   * @callback eventFn\n   * @param {object} event The event.\n   */\n\n  /**\n   * Create a mono progress event handler.\n   *\n   * @param {number} index The index of the data.\n   * @param {number} subindex The sub-index of the data.\n   * @returns {eventFn} A progress handler function.\n   */\n  getMonoProgressHandler(index, subindex) {\n    return (event) => {\n      event.index = index;\n      event.subindex = subindex;\n      this.onprogress(event);\n    };\n  }\n\n  /**\n   * Create a mono progress event handler with an undefined index.\n   * Warning: The caller handles the progress index.\n   *\n   * @param {number} subindex The sub-index of the data.\n   * @returns {eventFn} A progress handler function.\n   */\n  getUndefinedMonoProgressHandler(subindex) {\n    return (event) => {\n      event.subindex = subindex;\n      this.onprogress(event);\n    };\n  }\n}\n","import {endsWith, getRootPath} from '../utils/string.js';\nimport {MultiProgressHandler} from '../utils/progress.js';\nimport {getFileListFromDicomDir} from '../dicom/dicomDir.js';\nimport {loaderList} from './loaderList.js';\n\n// url content types\nexport const urlContentTypes = {\n  Text: 0,\n  ArrayBuffer: 1\n};\n\n/**\n * Urls loader.\n */\nexport class UrlsLoader {\n\n  /**\n   * Input data.\n   *\n   * @type {string[]}\n   */\n  #inputData = null;\n\n  /**\n   * Array of launched requests.\n   *\n   * @type {XMLHttpRequest[]}\n   */\n  #requests = [];\n\n  /**\n   * Data loader.\n   *\n   * @type {object}\n   */\n  #runningLoader = null;\n\n  /**\n   * Number of loaded data.\n   *\n   * @type {number}\n   */\n  #nLoad = 0;\n\n  /**\n   * Number of load end events.\n   *\n   * @type {number}\n   */\n  #nLoadend = 0;\n\n  /**\n   * Flag to know if the load is aborting.\n   *\n   * @type {boolean}\n   */\n  #aborting;\n\n  /**\n   * The default character set (optional).\n   *\n   * @type {string}\n   */\n  #defaultCharacterSet;\n\n  /**\n   * Get the default character set.\n   *\n   * @returns {string} The default character set.\n   */\n  getDefaultCharacterSet() {\n    return this.#defaultCharacterSet;\n  }\n\n  /**\n   * Set the default character set.\n   *\n   * @param {string} characterSet The character set.\n   */\n  setDefaultCharacterSet(characterSet) {\n    this.#defaultCharacterSet = characterSet;\n  }\n\n  /**\n   * Store the current input.\n   *\n   * @param {string[]} data The input data.\n   */\n  #storeInputData(data) {\n    this.#inputData = data;\n    // reset counters\n    this.#nLoad = 0;\n    this.#nLoadend = 0;\n    // reset flag\n    this.#aborting = false;\n    // clear storage\n    this.#clearStoredRequests();\n    this.#clearStoredLoader();\n  }\n\n  /**\n   * Store a launched request.\n   *\n   * @param {XMLHttpRequest} request The launched request.\n   */\n  #storeRequest(request) {\n    this.#requests.push(request);\n  }\n\n  /**\n   * Clear the stored requests.\n   *\n   */\n  #clearStoredRequests() {\n    this.#requests = [];\n  }\n\n  /**\n   * Store the launched loader.\n   *\n   * @param {object} loader The launched loader.\n   */\n  #storeLoader(loader) {\n    this.#runningLoader = loader;\n  }\n\n  /**\n   * Clear the stored loader.\n   *\n   */\n  #clearStoredLoader() {\n    this.#runningLoader = null;\n  }\n\n  /**\n   * Increment the number of loaded data\n   *   and call onload if loaded all data.\n   *\n   * @param {object} _event The load data event.\n   */\n  #addLoad = (_event) => {\n    this.#nLoad++;\n    // call onload when all is loaded\n    // (not using the input event since it is\n    //   an individual load)\n    if (this.#nLoad === this.#inputData.length) {\n      this.onload({\n        source: this.#inputData\n      });\n    }\n  };\n\n  /**\n   * Increment the counter of load end events\n   *   and run callbacks when all done, erroneus or not.\n   *\n   * @param {object} _event The load end event.\n   */\n  #addLoadend = (_event) => {\n    this.#nLoadend++;\n    // call onloadend when all is run\n    // (not using the input event since it is\n    //   an individual load end)\n    if (this.#nLoadend === this.#inputData.length) {\n      this.onloadend({\n        source: this.#inputData\n      });\n    }\n  };\n\n  /**\n   * @callback eventFn\n   * @param {object} event The event.\n   */\n\n  /**\n   * Augment a callback event with a srouce.\n   *\n   * @param {object} callback The callback to augment its event.\n   * @param {object} source The source to add to the event.\n   * @returns {eventFn} The augmented callback.\n   */\n  #augmentCallbackEvent(callback, source) {\n    return (event) => {\n      event.source = source;\n      callback(event);\n    };\n  }\n\n  /**\n   * Load a list of URLs or a DICOMDIR.\n   *\n   * @param {string[]} data The list of urls to load.\n   * @param {object} [options] Load options.\n   */\n  load(data, options) {\n    // send start event\n    this.onloadstart({\n      source: data\n    });\n\n    // check if DICOMDIR case\n    if (data.length === 1 &&\n      (endsWith(data[0], 'DICOMDIR') ||\n        endsWith(data[0], '.dcmdir'))) {\n      this.#loadDicomDir(data[0], options);\n    } else {\n      this.#loadUrls(data, options);\n    }\n  }\n\n  /**\n   * Get a load handler for a data element.\n   *\n   * @param {object} loader The associated loader.\n   * @param {string} dataElement The data element.\n   * @param {number} i The index of the element.\n   * @returns {eventFn} A load handler.\n   */\n  #getLoadHandler(loader, dataElement, i) {\n    return (event) => {\n      // check response status\n      // https://developer.mozilla.org/en-US/docs/Web/HTTP/Response_codes\n      // status 200: \"OK\"; status 0: \"debug\"\n      const status = event.target.status;\n      if (status !== 200 && status !== 0) {\n        this.onerror({\n          source: dataElement,\n          error: 'GET ' + event.target.responseURL +\n            ' ' + event.target.status +\n            ' (' + event.target.statusText + ')',\n          target: event.target\n        });\n        this.#addLoadend();\n      } else {\n        loader.load(event.target.response, dataElement, i);\n      }\n    };\n  }\n\n  /**\n   * Load a list of urls.\n   *\n   * @param {string[]} data The list of urls to load.\n   * @param {object} [options] The options object, can contain:\n   * - requestHeaders: an array of {name, value} to use as request headers,\n   * - withCredentials: boolean xhr.withCredentials flag to pass\n   *   to the request,\n   * - batchSize: the size of the request url batch.\n   */\n  #loadUrls(data, options) {\n    // check input\n    if (typeof data === 'undefined' || data.length === 0) {\n      return;\n    }\n    this.#storeInputData(data);\n\n    // create prgress handler\n    const mproghandler = new MultiProgressHandler(this.onprogress);\n    mproghandler.setNToLoad(data.length);\n\n    // create loaders\n    const loaders = [];\n    for (let m = 0; m < loaderList.length; ++m) {\n      loaders.push(new loaderList[m]());\n    }\n\n    // find an appropriate loader\n    let dataElement = data[0];\n    let loader = null;\n    let foundLoader = false;\n    for (let l = 0; l < loaders.length; ++l) {\n      loader = loaders[l];\n      if (loader.canLoadUrl(dataElement, options)) {\n        foundLoader = true;\n        // load options\n        loader.setOptions({\n          numberOfFiles: data.length,\n          defaultCharacterSet: this.getDefaultCharacterSet()\n        });\n        // set loader callbacks\n        // loader.onloadstart: nothing to do\n        loader.onprogress = mproghandler.getUndefinedMonoProgressHandler(1);\n        loader.onloaditem = this.onloaditem;\n        loader.onload = this.#addLoad;\n        loader.onloadend = this.#addLoadend;\n        loader.onerror = this.onerror;\n        loader.onabort = this.onabort;\n\n        // store loader\n        this.#storeLoader(loader);\n        // exit\n        break;\n      }\n    }\n    if (!foundLoader) {\n      throw new Error('No loader found for url: ' + dataElement);\n    }\n\n    // store last run request index\n    let lastRunRequestIndex = 0;\n    const requestOnLoadEnd = () => {\n      // launch next in queue\n      if (lastRunRequestIndex < this.#requests.length - 1 && !this.#aborting) {\n        ++lastRunRequestIndex;\n        this.#requests[lastRunRequestIndex].send(null);\n      }\n    };\n\n    // loop on I/O elements\n    for (let i = 0; i < data.length; ++i) {\n      dataElement = data[i];\n\n      // check loader\n      if (!loader.canLoadUrl(dataElement, options)) {\n        throw new Error('Input url of different type: ' + dataElement);\n      }\n      /**\n       * The http request.\n       *\n       * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest}.\n       *\n       * @external XMLHttpRequest\n       */\n      const request = new XMLHttpRequest();\n      request.open('GET', dataElement, true);\n\n      // request options\n      if (typeof options !== 'undefined') {\n        // optional request headers\n        if (typeof options.requestHeaders !== 'undefined') {\n          const requestHeaders = options.requestHeaders;\n          for (let j = 0; j < requestHeaders.length; ++j) {\n            if (typeof requestHeaders[j].name !== 'undefined' &&\n              typeof requestHeaders[j].value !== 'undefined') {\n              request.setRequestHeader(\n                requestHeaders[j].name, requestHeaders[j].value);\n            }\n          }\n        }\n        // optional withCredentials\n        // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials\n        if (typeof options.withCredentials !== 'undefined') {\n          request.withCredentials = options.withCredentials;\n        }\n      }\n\n      // set request callbacks\n      // request.onloadstart: nothing to do\n      request.onprogress = this.#augmentCallbackEvent(\n        mproghandler.getMonoProgressHandler(i, 0), dataElement);\n      request.onload = this.#getLoadHandler(loader, dataElement, i);\n      request.onloadend = requestOnLoadEnd;\n      const errorCallback =\n        this.#augmentCallbackEvent(this.onerror, dataElement);\n      request.onerror = (event) => {\n        this.#addLoadend();\n        errorCallback(event);\n      };\n      const timeoutCallback =\n        this.#augmentCallbackEvent(this.ontimeout, dataElement);\n      request.ontimeout = (event) => {\n        this.#addLoadend();\n        timeoutCallback(event);\n      };\n      const abortCallback =\n        this.#augmentCallbackEvent(this.onabort, dataElement);\n      request.onabort = (event) => {\n        this.#addLoadend();\n        abortCallback(event);\n      };\n      // response type (default is 'text')\n      if (loader.loadUrlAs() === urlContentTypes.ArrayBuffer) {\n        request.responseType = 'arraybuffer';\n      }\n\n      // store request\n      this.#storeRequest(request);\n    }\n\n    // launch requests in batch\n    let batchSize = this.#requests.length;\n    if (typeof options !== 'undefined') {\n      // optional request batch size\n      if (typeof options.batchSize !== 'undefined' && batchSize !== 0) {\n        batchSize = Math.min(options.batchSize, this.#requests.length);\n      }\n    }\n    for (let r = 0; r < batchSize; ++r) {\n      if (!this.#aborting) {\n        lastRunRequestIndex = r;\n        this.#requests[lastRunRequestIndex].send(null);\n      }\n    }\n  }\n\n  /**\n   * Load a DICOMDIR.\n   *\n   * @param {string} dicomDirUrl The DICOMDIR url.\n   * @param {object} [options] Load options.\n   */\n  #loadDicomDir(dicomDirUrl, options) {\n    // read DICOMDIR\n    const request = new XMLHttpRequest();\n    request.open('GET', dicomDirUrl, true);\n    request.responseType = 'arraybuffer';\n    // request.onloadstart: nothing to do\n    /**\n     * @param {object} event The load event.\n     */\n    request.onload = (event) => {\n      // check status\n      const status = event.target.status;\n      if (status !== 200 && status !== 0) {\n        this.onerror({\n          source: dicomDirUrl,\n          error: 'GET ' + event.target.responseURL +\n            ' ' + event.target.status +\n            ' (' + event.target.statusText + ')',\n          target: event.target\n        });\n        this.onloadend({});\n      } else {\n        // get the file list\n        const list = getFileListFromDicomDir(event.target.response);\n        // use the first list\n        const urls = list[0][0];\n        // append root url\n        const rootUrl = getRootPath(dicomDirUrl);\n        const fullUrls = [];\n        for (let i = 0; i < urls.length; ++i) {\n          fullUrls.push(rootUrl + '/' + urls[i]);\n        }\n        // load urls\n        this.#loadUrls(fullUrls, options);\n      }\n    };\n    request.onerror = (event) => {\n      this.#augmentCallbackEvent(this.onerror, dicomDirUrl)(event);\n      this.onloadend({});\n    };\n    request.onabort = (event) => {\n      this.#augmentCallbackEvent(this.onabort, dicomDirUrl)(event);\n      this.onloadend({});\n    };\n    // request.onloadend: nothing to do\n    // send request\n    request.send(null);\n  }\n\n  /**\n   * Abort a load.\n   */\n  abort() {\n    this.#aborting = true;\n    // abort non finished requests\n    for (let i = 0; i < this.#requests.length; ++i) {\n      // 0: UNSENT, 1: OPENED, 2: HEADERS_RECEIVED (send()), 3: LOADING, 4: DONE\n      if (this.#requests[i].readyState !== 4) {\n        this.#requests[i].abort();\n      }\n    }\n    // abort loader\n    if (this.#runningLoader && this.#runningLoader.isLoading()) {\n      this.#runningLoader.abort();\n    }\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a load progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event fired\n   *   when a file item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle a load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle a timeout event.\n   * Default does nothing.\n   *\n   * @param {object} _event The timeout event.\n   */\n  ontimeout(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class UrlsLoader\n","import {DicomParser} from './dicomParser.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {DataElement} from './dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  DirectoryRecordSequence: '00041220',\n  DirectoryRecordType: '00041430',\n  ReferencedFileID: '00041500'\n};\n\n/**\n * DICOM record types.\n *\n * Ref: {@link https://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_F.3.2.2.html#table_F.3-3}.\n */\nconst DirectoryRecordTypes = {\n  study: 'STUDY',\n  series: 'SERIES',\n  image: 'IMAGE'\n};\n\n/**\n * Get the file list from a DICOMDIR.\n *\n * @param {object} data The buffer data of the DICOMDIR.\n * @returns {Array|undefined} The file list as an array ordered by\n *   STUDY > SERIES > IMAGES.\n */\nexport function getFileListFromDicomDir(data) {\n  // parse file\n  const parser = new DicomParser();\n  parser.parse(data);\n  return getDicomDirFileList(parser.getDicomElements());\n}\n\n/**\n * Get a DICOMDIR file list.\n *\n * @param {Object<string, DataElement>} dicomElements The dicom elements.\n * @returns {Array|undefined} The file list as an array ordered by\n *   STUDY > SERIES > IMAGES.\n */\nfunction getDicomDirFileList(dicomElements) {\n  // Directory Record Sequence\n  const dirRecSqElement = dicomElements[TagKeys.DirectoryRecordSequence];\n  if (typeof dirRecSqElement === 'undefined' ||\n    typeof dirRecSqElement.value === 'undefined') {\n    logger.warn('No Directory Record Sequence found in DICOMDIR.');\n    return undefined;\n  }\n  const dirSeq = dirRecSqElement.value;\n\n  if (dirSeq.length === 0) {\n    logger.warn('The Directory Record Sequence of the DICOMDIR is empty.');\n    return undefined;\n  }\n\n  const records = [];\n  let series = null;\n  let study = null;\n  for (let i = 0; i < dirSeq.length; ++i) {\n    // Directory Record Type\n    const dirRecTypeElement = dirSeq[i][TagKeys.DirectoryRecordType];\n    if (typeof dirRecTypeElement === 'undefined' ||\n      typeof dirRecTypeElement.value === 'undefined') {\n      continue;\n    }\n    const recType = dirRecTypeElement.value[0];\n\n    // supposed to come in order...\n    if (recType === DirectoryRecordTypes.study) {\n      study = [];\n      records.push(study);\n    } else if (recType === DirectoryRecordTypes.series) {\n      series = [];\n      study.push(series);\n    } else if (recType === DirectoryRecordTypes.image) {\n      // Referenced File ID\n      const refFileIdElement = dirSeq[i][TagKeys.ReferencedFileID];\n      if (typeof refFileIdElement === 'undefined' ||\n        typeof refFileIdElement.value === 'undefined') {\n        continue;\n      }\n      const refFileIds = refFileIdElement.value;\n      // join ids\n      series.push(refFileIds.join('/'));\n    }\n  }\n  return records;\n}\n","import {ThreadPool, WorkerTask} from '../utils/thread.js';\n\n/**\n * List of compatible typed arrays.\n *\n * @typedef {(\n *   Uint8Array | Int8Array |\n *   Uint16Array | Int16Array |\n *   Uint32Array | Int32Array\n * )} TypedArray\n */\n\n/**\n * Jpeg baseline worker task.\n */\nclass JpegBaselineWorkerTask extends WorkerTask {\n  constructor(message, info) {\n    super(message, info);\n  }\n  getWorker() {\n    return new Worker(\n      new URL('../decoders/pdfjs/jpegbaseline.worker.js', import.meta.url),\n      {\n        name: 'jpegbaseline.worker'\n      }\n    );\n  }\n}\n\n/**\n * Jpeg lossless worker task.\n */\nclass JpegLosslessWorkerTask extends WorkerTask {\n  constructor(message, info) {\n    super(message, info);\n  }\n  getWorker() {\n    return new Worker(\n      new URL('../decoders/rii-mango/jpegloss.worker.js', import.meta.url),\n      {\n        name: 'jpegloss.worker'\n      }\n    );\n  }\n}\n\n/**\n * Jpeg 2000 worker task.\n */\nclass Jpeg2000WorkerTask extends WorkerTask {\n  constructor(message, info) {\n    super(message, info);\n  }\n  getWorker() {\n    return new Worker(\n      new URL('../decoders/pdfjs/jpeg2000.worker.js', import.meta.url),\n      {\n        name: 'jpeg2000.worker'\n      }\n    );\n  }\n}\n\n/**\n * RLE worker task.\n */\nclass RleWorkerTask extends WorkerTask {\n  constructor(message, info) {\n    super(message, info);\n  }\n  getWorker() {\n    return new Worker(\n      new URL('../decoders/dwv/rle.worker.js', import.meta.url),\n      {\n        name: 'rle.worker'\n      }\n    );\n  }\n}\n\n/**\n * Pixel buffer decoder.\n */\nexport class PixelBufferDecoder {\n\n  /**\n   * The name of the compression algorithm.\n   *\n   * @type {string}\n   */\n  #algoName;\n\n  /**\n   * Associated thread pool.\n   *\n   * @type {ThreadPool}\n   */\n  #pool;\n\n  /**\n   * Flag to know if callbacks are set.\n   *\n   * @type {boolean}\n   */\n  #areCallbacksSet = false;\n\n  /**\n   * @param {string} algoName The compression algorithm name.\n   */\n  constructor(algoName) {\n    this.#algoName = algoName;\n    // create pool\n    this.#pool = new ThreadPool(10);\n  }\n\n  /**\n   * Decode a pixel buffer.\n   *\n   * @param {TypedArray} pixelBuffer The pixel buffer.\n   * @param {object} pixelMeta The input meta data.\n   * @param {object} info Information object about the input data.\n   */\n  decode(pixelBuffer, pixelMeta, info) {\n    // wait until last minute to set callbacks\n    if (!this.#areCallbacksSet) {\n      this.#areCallbacksSet = true;\n      // set event handlers\n      this.#pool.onworkstart = this.ondecodestart;\n      this.#pool.onworkitem = this.ondecodeditem;\n      this.#pool.onwork = this.ondecoded;\n      this.#pool.onworkend = this.ondecodeend;\n      this.#pool.onerror = this.onerror;\n      this.#pool.onabort = this.onabort;\n    }\n\n    const message = {\n      buffer: pixelBuffer,\n      meta: pixelMeta\n    };\n\n    let workerTask;\n    if (this.#algoName === 'jpeg-baseline') {\n      workerTask = new JpegBaselineWorkerTask(message, info);\n    } else if (this.#algoName === 'jpeg-lossless') {\n      workerTask = new JpegLosslessWorkerTask(message, info);\n    } else if (this.#algoName === 'jpeg2000') {\n      workerTask = new Jpeg2000WorkerTask(message, info);\n    } else if (this.#algoName === 'rle') {\n      workerTask = new RleWorkerTask(message, info);\n    }\n\n    // add it the queue and run it\n    if (typeof workerTask !== 'undefined') {\n      this.#pool.addWorkerTask(workerTask);\n    }\n  }\n\n  /**\n   * Abort decoding.\n   */\n  abort() {\n    // abort the thread pool, will trigger pool.onabort\n    this.#pool.abort();\n  }\n\n  /**\n   * Handle a decode start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The decode start event.\n   */\n  ondecodestart(_event) {}\n\n  /**\n   * Handle a decode item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The decode item event fired\n   *   when a decode item ended successfully.\n   */\n  ondecodeditem(_event) {}\n\n  /**\n   * Handle a decode event.\n   * Default does nothing.\n   *\n   * @param {object} _event The decode event fired\n   *   when a file has been decoded successfully.\n   */\n  ondecoded(_event) {}\n\n  /**\n   * Handle a decode end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The decode end event fired\n   *  when a file decoding has completed, successfully or not.\n   */\n  ondecodeend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class PixelBufferDecoder\n","import {logger} from '../utils/logger.js';\nimport {safeGet} from '../dicom/dataElement.js';\nimport {\n  DicomParser,\n  getSyntaxDecompressionName\n} from '../dicom/dicomParser.js';\nimport {getAnyPixelDataElement} from '../dicom/dicomTag.js';\nimport {PixelBufferDecoder} from './decoder.js';\nimport {DicomData} from '../app/dataController.js';\n\n/**\n * List of compatible typed arrays.\n *\n * @typedef {(\n *   Uint8Array | Int8Array |\n *   Uint16Array | Int16Array |\n *   Uint32Array | Int32Array\n * )} TypedArray\n */\n\n/**\n * Related DICOM tag keys.\n */\nconst TagKeys = {\n  TransferSyntaxUID: '00020010',\n  SamplesPerPixel: '00280002',\n  PlanarConfiguration: '00280006',\n  Rows: '00280010',\n  Columns: '00280011',\n  BitsAllocated: '00280100',\n  PixelRepresentation: '00280103'\n};\n\n/**\n * Create a DicomData from a DICOM buffer: parses it, stores the meta data and\n * the image buffer if pixel data is present. Buffer is decoded if needed,\n * only necessary tags for decompression are checked.\n */\nexport class DicomBufferToData {\n\n  /**\n   * Converter options.\n   *\n   * @type {object}\n   */\n  #options;\n\n  /**\n   * Set the converter options.\n   *\n   * @param {object} opt The input options.\n   */\n  setOptions(opt) {\n    this.#options = opt;\n  }\n\n  /**\n   * Pixel buffer decoder.\n   * Define only once to allow optional asynchronous mode.\n   *\n   * @type {PixelBufferDecoder|undefined}\n   */\n  #pixelDecoder;\n\n  /**\n   * List of dicom parsers.\n   *\n   * @type {DicomParser[]}\n   */\n  #dicomParserStore = [];\n\n  /**\n   * List of decompressed data sizes.\n   *\n   * @type {number[]}\n   */\n  #decompressedSizes = [];\n\n  /**\n   * Local buffer storage.\n   *\n   * @type {TypedArray[]}\n   */\n  #finalBufferStore = [];\n\n  /**\n   * Abort flag.\n   *\n   * @type {boolean}\n   */\n  #aborted = false;\n\n  /**\n   * Generate the data object.\n   *\n   * @param {number} index The data index.\n   * @param {string} origin The data origin.\n   */\n  #generateData(index, origin) {\n    const dataElements = this.#dicomParserStore[index].getDicomElements();\n    // create data\n    const data = new DicomData(dataElements);\n    if (typeof this.#finalBufferStore[index] !== 'undefined') {\n      data.buffer = this.#finalBufferStore[index];\n    }\n    data.numberOfFiles = this.#options.numberOfFiles;\n\n    // call onloaditem\n    this.onloaditem({\n      data: data,\n      source: origin\n    });\n  }\n\n  /**\n   * Send final events for a succesfull load.\n   *\n   * @param {number} index The data index.\n   * @param {string} origin The data origin.\n   */\n  #sendFinalEvents(index, origin) {\n    if (this.#aborted) {\n      return;\n    }\n    // send 100% progress\n    this.onprogress({\n      lengthComputable: true,\n      loaded: 100,\n      total: 100,\n      index: index,\n      source: origin\n    });\n    // send load event\n    this.onload({\n      source: origin\n    });\n    // allways send loadend\n    this.onloadend({\n      source: origin\n    });\n  }\n\n  /**\n   * Setup the pixel decoder.\n   *\n   * @param {string} algoName The algorithm name.\n   */\n  #setupPixelDecoder(algoName) {\n    this.#pixelDecoder = new PixelBufferDecoder(algoName);\n    // callbacks\n    // pixelDecoder.ondecodestart: nothing to do\n    this.#pixelDecoder.ondecodeditem = (event) => {\n      this.#onDecodedItem(event);\n      // send onload and onloadend when all items have been decoded\n      if (event.itemNumber + 1 === event.numberOfItems) {\n        this.onload(event);\n        this.onloadend(event);\n      }\n    };\n    // pixelDecoder.ondecoded: nothing to do\n    // pixelDecoder.ondecodeend: nothing to do\n    this.#pixelDecoder.onerror = this.onerror;\n    this.#pixelDecoder.onabort = this.onabort;\n  }\n\n  /**\n   * Get the dicom meta used by decoders.\n   *\n   * @param {number} dataIndex The data index.\n   * @returns {object} The DICOM meta data.\n   */\n  #getPixelMeta(dataIndex) {\n    const dataElements = this.#dicomParserStore[dataIndex].getDicomElements();\n    const pixelMeta = {missing: []};\n    // bits allocated\n    const bitsAllocated = safeGet(dataElements, TagKeys.BitsAllocated);\n    if (typeof bitsAllocated !== 'undefined') {\n      pixelMeta.bitsAllocated = bitsAllocated;\n    } else {\n      pixelMeta.missing.push('bitsAllocated');\n    }\n    // pixel reprensentation\n    const pixelRepresentation =\n      safeGet(dataElements, TagKeys.PixelRepresentation);\n    if (typeof pixelRepresentation !== 'undefined') {\n      pixelMeta.isSigned = (pixelRepresentation === 1);\n    } else {\n      pixelMeta.missing.push('pixelRepresentation');\n    }\n    // slice size\n    const columns = safeGet(dataElements, TagKeys.Columns);\n    const rows = safeGet(dataElements, TagKeys.Rows);\n    if (typeof columns !== 'undefined' &&\n      typeof rows !== 'undefined') {\n      pixelMeta.sliceSize = columns * rows;\n    } else {\n      if (typeof columns !== 'undefined') {\n        pixelMeta.missing.push('columns');\n      }\n      if (typeof rows !== 'undefined') {\n        pixelMeta.missing.push('rows');\n      }\n    }\n    // samples per pixel\n    const samplesPerPixel =\n      safeGet(dataElements, TagKeys.SamplesPerPixel);\n    if (typeof samplesPerPixel !== 'undefined') {\n      pixelMeta.samplesPerPixel = samplesPerPixel;\n      // planar configuration\n      if (samplesPerPixel !== 1) {\n        const planarConfiguration =\n          safeGet(dataElements, TagKeys.PlanarConfiguration);\n        if (typeof planarConfiguration !== 'undefined') {\n          pixelMeta.planarConfiguration = planarConfiguration;\n        } else {\n          pixelMeta.missing.push('planarConfiguration');\n        }\n      }\n    } else {\n      pixelMeta.missing.push('samplesPerPixel');\n    }\n\n    return pixelMeta;\n  }\n\n  /**\n   * Decode and generate data for a compressed buffer.\n   *\n   * @param {number} dataIndex The data index.\n   * @param {string} origin The data origin.\n   * @param {TypedArray[]} pixelBuffer The pixel buffer.\n   */\n  #decodeAndGenerateData(dataIndex, origin, pixelBuffer) {\n    // get pixel meta\n    const pixelMeta = this.#getPixelMeta(dataIndex);\n    // abort if missing data\n    if (pixelMeta.missing.length !== 0) {\n      // abort\n      this.#pixelDecoder.abort();\n      // send events\n      this.onerror({\n        error: new Error('Missing tags to decompress data:' +\n          pixelMeta.missing.toString()),\n        source: origin\n      });\n      this.onloadend({\n        source: origin\n      });\n      return;\n    }\n\n    const numberOfItems = pixelBuffer.length;\n\n    // launch decode\n    for (let i = 0; i < numberOfItems; ++i) {\n      this.#pixelDecoder.decode(pixelBuffer[i], pixelMeta,\n        {\n          itemNumber: i,\n          numberOfItems: numberOfItems,\n          index: dataIndex,\n          indexOrigin: origin\n        }\n      );\n    }\n  }\n\n  /**\n   * Handle a decoded item event.\n   *\n   * @param {object} event The decoded item event.\n   */\n  #onDecodedItem(event) {\n    const dataIndex = event.index;\n    const origin = event.indexOrigin;\n\n    // send progress\n    this.onprogress({\n      lengthComputable: true,\n      loaded: event.itemNumber + 1,\n      total: event.numberOfItems,\n      index: event.index,\n      source: origin\n    });\n\n    // store decoded data\n    const decodedData = event.data[0];\n    if (event.numberOfItems !== 1) {\n      // allocate buffer if not done yet\n      if (typeof this.#decompressedSizes[dataIndex] === 'undefined') {\n        this.#decompressedSizes[dataIndex] = decodedData.length;\n        const fullSize = event.numberOfItems *\n          this.#decompressedSizes[dataIndex];\n        try {\n          this.#finalBufferStore[dataIndex] =\n            new decodedData.constructor(fullSize);\n        } catch (error) {\n          if (error instanceof RangeError) {\n            const powerOf2 = Math.floor(Math.log(fullSize) / Math.log(2));\n            logger.error('Cannot allocate ' +\n              decodedData.constructor.name +\n              ' of size: ' +\n              fullSize + ' (>2^' + powerOf2 + ') for decompressed data.');\n          }\n          // abort\n          this.#pixelDecoder.abort();\n          // send events\n          this.onerror({\n            error: error,\n            source: origin\n          });\n          this.onloadend({\n            source: origin\n          });\n          // exit\n          return;\n        }\n      }\n      // hoping for all items to have the same size...\n      if (decodedData.length !== this.#decompressedSizes[dataIndex]) {\n        logger.warn('Unsupported varying decompressed data size: ' +\n          decodedData.length + ' != ' + this.#decompressedSizes[dataIndex]);\n      }\n      // set buffer item data\n      this.#finalBufferStore[dataIndex].set(\n        decodedData, this.#decompressedSizes[dataIndex] * event.itemNumber);\n    } else {\n      this.#finalBufferStore[dataIndex] = decodedData;\n    }\n\n    // create data for the first item\n    if (event.itemNumber === 0) {\n      this.#generateData(dataIndex, origin);\n    }\n  }\n\n  /**\n   * Convert an input buffer into DicomData using a DICOM parser. Asynchronous\n   * method in case of possible buffer decompression. Get the data\n   * from the 'onload' event.\n   *\n   * @param {TypedArray} buffer The input data buffer.\n   * @param {string} origin The data origin.\n   * @param {number} dataIndex The data index.\n   */\n  convert(buffer, origin, dataIndex) {\n    this.#aborted = false;\n    // start event\n    this.onloadstart({\n      source: origin,\n      index: dataIndex\n    });\n\n    // DICOM parser\n    const dicomParser = new DicomParser();\n\n    if (typeof this.#options.defaultCharacterSet !== 'undefined') {\n      dicomParser.setDefaultCharacterSet(this.#options.defaultCharacterSet);\n    }\n\n    // parse the buffer\n    try {\n      dicomParser.parse(buffer);\n      // check elements\n    } catch (error) {\n      this.onerror({\n        error: error,\n        source: origin\n      });\n      this.onloadend({\n        source: origin\n      });\n      return;\n    }\n\n    // store parser\n    this.#dicomParserStore[dataIndex] = dicomParser;\n\n    const elements = dicomParser.getDicomElements();\n    const pixelDataElement = getAnyPixelDataElement(elements);\n    if (typeof pixelDataElement !== 'undefined') {\n      const rawBuffer = pixelDataElement.value;\n      // transfer syntax (always there)\n      const transferSyntax = safeGet(elements, TagKeys.TransferSyntaxUID);\n      const algoName = getSyntaxDecompressionName(transferSyntax);\n      if (typeof algoName !== 'undefined') {\n        // setup the decoder (one decoder per all converts)\n        // TODO check constant algo name?\n        if (typeof this.#pixelDecoder === 'undefined') {\n          this.#setupPixelDecoder(algoName);\n        }\n        // decode and generate data (asynchronous)\n        this.#decodeAndGenerateData(dataIndex, origin, rawBuffer);\n      } else {\n        // store buffer\n        this.#finalBufferStore[dataIndex] = rawBuffer[0];\n        // generate data\n        this.#generateData(dataIndex, origin);\n        this.#sendFinalEvents(dataIndex, origin);\n      }\n    } else {\n      // non image data -> no buffer\n      // generate data\n      this.#generateData(dataIndex, origin);\n      this.#sendFinalEvents(dataIndex, origin);\n    }\n  }\n\n  /**\n   * Abort a conversion.\n   */\n  abort() {\n    this.#aborted = true;\n    // abort decoding, will trigger pixelDecoder.onabort\n    if (typeof this.#pixelDecoder !== 'undefined') {\n      this.#pixelDecoder.abort();\n    } else {\n      this.onabort({});\n    }\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n  /**\n   * Handle a load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class DicomBufferToView\n","import {MultiProgressHandler} from '../utils/progress.js';\nimport {loaderList} from './loaderList.js';\n\n/**\n * Memory loader.\n */\nexport class MemoryLoader {\n\n  /**\n   * Input data.\n   *\n   * @type {Array}\n   */\n  #inputData = null;\n\n  /**\n   * Data loader.\n   *\n   * @type {object}\n   */\n  #runningLoader = null;\n\n  /**\n   * Number of loaded data.\n   *\n   * @type {number}\n   */\n  #nLoad = 0;\n\n  /**\n   * Number of load end events.\n   *\n   * @type {number}\n   */\n  #nLoadend = 0;\n\n  /**\n   * The default character set (optional).\n   *\n   * @type {string}\n   */\n  #defaultCharacterSet;\n\n  /**\n   * Get the default character set.\n   *\n   * @returns {string} The default character set.\n   */\n  getDefaultCharacterSet() {\n    return this.#defaultCharacterSet;\n  }\n\n  /**\n   * Set the default character set.\n   *\n   * @param {string} characterSet The character set.\n   */\n  setDefaultCharacterSet(characterSet) {\n    this.#defaultCharacterSet = characterSet;\n  }\n\n  /**\n   * Store the current input.\n   *\n   * @param {object} data The input data.\n   */\n  #storeInputData(data) {\n    this.#inputData = data;\n    // reset counters\n    this.#nLoad = 0;\n    this.#nLoadend = 0;\n    // clear storage\n    this.#clearStoredLoader();\n  }\n\n  /**\n   * Store the launched loader.\n   *\n   * @param {object} loader The launched loader.\n   */\n  #storeLoader(loader) {\n    this.#runningLoader = loader;\n  }\n\n  /**\n   * Clear the stored loader.\n   *\n   */\n  #clearStoredLoader() {\n    this.#runningLoader = null;\n  }\n\n  /**\n   * Increment the number of loaded data\n   *   and call onload if loaded all data.\n   *\n   * @param {object} _event The load data event.\n   */\n  #addLoad = (_event) => {\n    this.#nLoad++;\n    // call onload when all is loaded\n    // (not using the input event since it is not the\n    //   general load)\n    if (this.#nLoad === this.#inputData.length) {\n      this.onload({\n        source: this.#inputData\n      });\n    }\n  };\n\n  /**\n   * Increment the counter of load end events\n   *   and run callbacks when all done, erroneus or not.\n   *\n   * @param {object} _event The load end event.\n   */\n  #addLoadend = (_event) => {\n    this.#nLoadend++;\n    // call onloadend when all is run\n    // (not using the input event since it is not the\n    //   general load end)\n    if (this.#nLoadend === this.#inputData.length) {\n      this.onloadend({\n        source: this.#inputData\n      });\n    }\n  };\n\n  /**\n   * Load a list of buffers.\n   *\n   * @param {Array} data The list of buffers to load.\n   */\n  load(data) {\n    // check input\n    if (typeof data === 'undefined' || data.length === 0) {\n      return;\n    }\n    this.#storeInputData(data);\n\n    // send start event\n    this.onloadstart({\n      source: data\n    });\n\n    // create prgress handler\n    const mproghandler = new MultiProgressHandler(this.onprogress);\n    mproghandler.setNToLoad(data.length);\n    mproghandler.setNumberOfDimensions(1);\n\n    // create loaders\n    const loaders = [];\n    for (let m = 0; m < loaderList.length; ++m) {\n      loaders.push(new loaderList[m]());\n    }\n\n    // find an appropriate loader\n    let dataElement = data[0];\n    let loader = null;\n    let foundLoader = false;\n    for (let l = 0; l < loaders.length; ++l) {\n      loader = loaders[l];\n      if (loader.canLoadMemory(dataElement)) {\n        foundLoader = true;\n        // load options\n        loader.setOptions({\n          numberOfFiles: data.length,\n          defaultCharacterSet: this.getDefaultCharacterSet()\n        });\n        // set loader callbacks\n        // loader.onloadstart: nothing to do\n        loader.onprogress = mproghandler.getUndefinedMonoProgressHandler(0);\n        loader.onloaditem = this.onloaditem;\n        loader.onload = this.#addLoad;\n        loader.onloadend = this.#addLoadend;\n        loader.onerror = this.onerror;\n        loader.onabort = this.onabort;\n\n        // store loader\n        this.#storeLoader(loader);\n        // exit\n        break;\n      }\n    }\n    if (!foundLoader) {\n      throw new Error('No loader found for data: ' + dataElement.filename);\n    }\n\n    // loop on I/O elements\n    for (let i = 0; i < data.length; ++i) {\n      dataElement = data[i];\n      // check loader\n      if (!loader.canLoadMemory(dataElement)) {\n        throw new Error('Input data of different type: ' +\n          dataElement.filename);\n      }\n      // read\n      loader.load(dataElement.data, dataElement.filename, i);\n    }\n  }\n\n  /**\n   * Abort a load.\n   */\n  abort() {\n    // abort loader\n    if (this.#runningLoader && this.#runningLoader.isLoading()) {\n      this.#runningLoader.abort();\n    }\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a load progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event fired\n   *   when a file item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle a load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class MemoryLoader\n","import {Size} from '../image/size.js';\nimport {Spacing} from '../image/spacing.js';\nimport {Geometry} from '../image/geometry.js';\nimport {Image} from '../image/image.js';\nimport {Point3D} from '../math/point.js';\nimport {DicomData} from '../app/dataController.js';\n\n/**\n * Convert a string into an UID.\n *\n * @param {string} str The input string.\n * @returns {string} The input string converted to numbers\n *   using parseInt with a 36 radix\n *   (10 digits from 0 to 9 + 26 digits from a to z).\n */\nfunction toUID(str) {\n  return parseInt(str, 36).toString();\n}\n\n/**\n * Create a simple array buffer from an ImageData buffer.\n *\n * @param {object} imageData The ImageData taken from a context.\n * @returns {Uint8Array} The image buffer.\n */\nfunction imageDataToBuffer(imageData) {\n  // remove alpha\n  // TODO support passing the full image data\n  const dataLen = imageData.data.length;\n  const buffer = new Uint8Array((dataLen / 4) * 3);\n  let j = 0;\n  for (let i = 0; i < dataLen; i += 4) {\n    buffer[j] = imageData.data[i];\n    buffer[j + 1] = imageData.data[i + 1];\n    buffer[j + 2] = imageData.data[i + 2];\n    j += 3;\n  }\n  return buffer;\n}\n\n/**\n * Get an image from an input context imageData.\n *\n * @param {number} width The width of the coresponding image.\n * @param {number} height The height of the coresponding image.\n * @param {number} sliceIndex The slice index of the imageData.\n * @param {object} imageBuffer The image buffer.\n * @param {number} numberOfFrames The final number of frames.\n * @param {string} imageUid The image UID.\n * @returns {object} The corresponding view.\n */\nfunction getDefaultImage(\n  width, height, sliceIndex,\n  imageBuffer, numberOfFrames,\n  imageUid) {\n  // image size\n  const imageSize = new Size([width, height, 1]);\n  // default spacing\n  // TODO: misleading...\n  const imageSpacing = new Spacing([1, 1, 1]);\n  // default origin\n  const origin = new Point3D(0, 0, sliceIndex);\n  // create image\n  const geometry = new Geometry([origin], imageSize, imageSpacing);\n  const image = new Image(geometry, imageBuffer, [imageUid]);\n  image.setPhotometricInterpretation('RGB');\n  // meta information\n  const meta = {};\n  meta.BitsStored = 8;\n  if (typeof numberOfFrames !== 'undefined') {\n    meta.numberOfFiles = numberOfFrames;\n  }\n  image.setMeta(meta);\n  // return\n  return image;\n}\n\n/**\n * Get data from an input image using a canvas.\n *\n * @param {HTMLImageElement} domImage The DOM Image,\n *   an HTMLImageElement with extra info.\n * @param {string|File} origin The data origin.\n * @param {number} index The data index.\n * @returns {object} A load data event.\n */\nexport function getViewFromDOMImage(domImage, origin, index) {\n  // image size\n  const width = domImage.width;\n  const height = domImage.height;\n\n  // draw the image in the canvas in order to get its data\n  const canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext('2d');\n  ctx.drawImage(domImage, 0, 0);\n  // get the image data\n  const imageData = ctx.getImageData(0, 0, width, height);\n\n  // image properties\n  const info = {};\n  let seriesUID;\n  if (typeof origin === 'string') {\n    info['origin'] = {value: [origin]};\n    seriesUID = toUID(origin);\n  } else {\n    info['fileName'] = {value: [origin.name]};\n    seriesUID = toUID(origin.name);\n    info['fileType'] = {value: [origin.type]};\n    info['fileLastModifiedDate'] = {value: [origin.lastModified]};\n  }\n  info['imageWidth'] = {value: [width]};\n  info['imageHeight'] = {value: [height]};\n\n  // image identifier (~UID like)\n  const sliceIndex = index ? index : 0;\n  info['imageUid'] = {value: [sliceIndex]};\n  // series identifier (~UID like)\n  info['seriesUid'] = {value: [seriesUID]};\n\n  // create view\n  const imageBuffer = imageDataToBuffer(imageData);\n  const image = getDefaultImage(\n    width, height, sliceIndex, imageBuffer, 1, sliceIndex.toString());\n\n  // add seriesUID to meta\n  const meta = image.getMeta();\n  meta.SeriesInstanceUID = seriesUID;\n  image.setMeta(meta);\n\n  // create data\n  // @ts-expect-error\n  const data = new DicomData(info);\n  data.image = image;\n\n  // return\n  return {\n    data,\n    source: origin\n  };\n}\n\n/**\n * Get data from an input image using a canvas.\n *\n * @param {object} video The DOM Video, an HTMLVideoElement with extra info.\n * @param {Function} onloaditem On load callback.\n * @param {object} onload The function to call once the data is loaded.\n * @param {object} onprogress The function to call to report progress.\n * @param {object} onloadend The function to call to report load end.\n * @param {string|File} origin The data origin.\n * @param {number} dataIndex The data index.\n */\nexport function getViewFromDOMVideo(\n  video, onloaditem, onload, onprogress, onloadend,\n  origin, dataIndex) {\n  // video size\n  const width = video.videoWidth;\n  const height = video.videoHeight;\n\n  // default frame rate...\n  const frameRate = 30;\n  // number of frames\n  const numberOfFrames = Math.ceil(video.duration * frameRate);\n\n  // video properties\n  const info = {};\n  let seriesUID;\n  if (typeof origin === 'string') {\n    info['origin'] = {value: [origin]};\n    seriesUID = toUID(origin);\n  } else {\n    info['fileName'] = {value: [origin.name]};\n    seriesUID = toUID(origin.name);\n    info['fileType'] = {value: [origin.type]};\n    info['fileLastModifiedDate'] = {value: [origin.lastModified]};\n  }\n  info['imageWidth'] = {value: [width]};\n  info['imageHeight'] = {value: [height]};\n  info['numberOfFrames'] = {value: [numberOfFrames]};\n\n  // image identifier (~UID like)\n  info['imageUid'] = {value: [0]};\n  // series identifier (~UID like)\n  info['seriesUid'] = {value: [seriesUID]};\n\n  // draw the image in the canvas in order to get its data\n  const canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext('2d');\n\n  // using seeked to loop through all video frames\n  video.addEventListener('seeked', onseeked, false);\n\n  // current frame index\n  let frameIndex = 0;\n  // video image\n  let image = null;\n\n  /**\n   * Draw the context and store it as a frame.\n   */\n  function storeFrame() {\n    // send progress\n    onprogress({\n      lengthComputable: true,\n      loaded: frameIndex,\n      total: numberOfFrames,\n      index: dataIndex,\n      source: origin\n    });\n    // draw image\n    ctx.drawImage(video, 0, 0);\n    // context to image buffer\n    const imgBuffer = imageDataToBuffer(\n      ctx.getImageData(0, 0, width, height));\n    if (frameIndex === 0) {\n      // create view\n      image = getDefaultImage(\n        width, height, 1, imgBuffer, numberOfFrames, dataIndex.toString());\n      // add seriesUID to meta\n      const meta = image.getMeta();\n      meta.SeriesInstanceUID = seriesUID;\n      image.setMeta(meta);\n      // create data\n      // @ts-expect-error\n      const data = new DicomData(info);\n      data.image = image;\n      // call callback\n      onloaditem({\n        data,\n        source: origin\n      });\n    } else {\n      image.appendFrameBuffer(imgBuffer, frameIndex);\n    }\n    // increment index\n    ++frameIndex;\n  }\n\n  let nextTime = 0;\n\n  /**\n   * Handle seeked event.\n   *\n   * @param {object} event The seeked event.\n   */\n  function onseeked(event) {\n    // store\n    storeFrame();\n    // set the next time\n    // (not using currentTime, it seems to get offseted)\n    nextTime += 1 / frameRate;\n    if (nextTime <= event.target.duration) {\n      this.currentTime = nextTime;\n    } else {\n      onload({\n        source: origin\n      });\n      onloadend({\n        source: origin\n      });\n      // stop listening\n      video.removeEventListener('seeked', onseeked);\n    }\n  }\n\n  // trigger the first seek\n  video.currentTime = nextTime;\n}\n","import {DicomDataLoader} from './dicomDataLoader.js';\nimport {JSONTextLoader} from './jsonTextLoader.js';\nimport {MultipartLoader} from './multipartLoader.js';\nimport {RawImageLoader} from './rawImageLoader.js';\nimport {RawVideoLoader} from './rawVideoLoader.js';\nimport {ZipLoader} from './zipLoader.js';\n\nexport const loaderList = [\n  DicomDataLoader,\n  JSONTextLoader,\n  MultipartLoader,\n  RawImageLoader,\n  RawVideoLoader,\n  ZipLoader\n];\n","import {startsWith, getFileExtension} from '../utils/string.js';\nimport {getUrlFromUri} from '../utils/uri.js';\nimport {fileContentTypes} from './filesLoader.js';\nimport {urlContentTypes} from './urlsLoader.js';\nimport {DicomBufferToData} from '../image/dicomBufferToData.js';\n\n/**\n * DICOM data loader.\n */\nexport class DicomDataLoader {\n\n  /**\n   * Loader options.\n   *\n   * @type {object}\n   */\n  #options = {};\n\n  /**\n   * Loading flag.\n   *\n   * @type {boolean}\n   */\n  #isLoading = false;\n\n  /**\n   * Set the loader options.\n   *\n   * @param {object} opt The input options.\n   */\n  setOptions(opt) {\n    this.#options = opt;\n  }\n\n  /**\n   * Is the load ongoing?\n   *\n   * @returns {boolean} True if loading.\n   */\n  isLoading() {\n    return this.#isLoading;\n  }\n\n  /**\n   * DICOM buffer to Data (asynchronous).\n   *\n   */\n  #db2d = new DicomBufferToData();\n\n  /**\n   * Load data.\n   *\n   * @param {object} buffer The DICOM buffer.\n   * @param {string} origin The data origin.\n   * @param {number} index The data index.\n   */\n  load(buffer, origin, index) {\n    // setup db2d ony once\n    if (!this.#isLoading) {\n      // pass options\n      this.#db2d.setOptions(this.#options);\n      // connect handlers\n      this.#db2d.onloadstart = this.onloadstart;\n      this.#db2d.onprogress = this.onprogress;\n      this.#db2d.onloaditem = this.onloaditem;\n      this.#db2d.onload = this.onload;\n      this.#db2d.onloadend = (event) => {\n        // reset loading flag\n        this.#isLoading = false;\n        // call listeners\n        this.onloadend(event);\n      };\n      this.#db2d.onerror = (event) => {\n        event.source = origin;\n        this.onerror(event);\n      };\n      this.#db2d.onabort = this.onabort;\n    }\n\n    // set loading flag\n    this.#isLoading = true;\n    // convert\n    this.#db2d.convert(buffer, origin, index);\n  }\n\n  /**\n   * Abort load.\n   */\n  abort() {\n    // reset loading flag\n    this.#isLoading = false;\n    // abort conversion, will trigger db2d.onabort\n    this.#db2d.abort();\n  }\n\n  /**\n   * Check if the loader can load the provided file.\n   * True if one of the folowing conditions is true:\n   * - the file has a 'dcm' extension,\n   * - the file has no extension.\n   *\n   * @param {File} file The file to check.\n   * @returns {boolean} True if the file can be loaded.\n   */\n  canLoadFile(file) {\n    const ext = getFileExtension(file.name);\n    const hasNoExt = (ext === null);\n    const hasDcmExt = (ext === 'dcm');\n    return hasNoExt || hasDcmExt;\n  }\n\n  /**\n   * Check if the loader can load the provided url.\n   * True if one of the folowing conditions is true:\n   * - the `options.forceLoader` is 'dicom',\n   * - the `options.requestHeaders` contains a 'Accept: application/dicom',\n   * - the url has a 'contentType' and it is 'application/dicom'\n   *   (as in wado urls),\n   * - the url has no 'contentType' and no extension or the extension is 'dcm'.\n   *\n   * @param {string} url The url to check.\n   * @param {object} [options] Optional url request options.\n   * @returns {boolean} True if the url can be loaded.\n   */\n  canLoadUrl(url, options) {\n    // check options\n    if (typeof options !== 'undefined') {\n      // check options.forceLoader\n      if (typeof options.forceLoader !== 'undefined' &&\n        options.forceLoader === 'dicom') {\n        return true;\n      }\n      // check options.requestHeaders for 'Accept'\n      if (typeof options.requestHeaders !== 'undefined') {\n        const isNameAccept = function (element) {\n          return element.name === 'Accept';\n        };\n        const acceptHeader = options.requestHeaders.find(isNameAccept);\n        if (typeof acceptHeader !== 'undefined') {\n          // starts with 'application/dicom' and no '+'\n          const acceptValue = 'application/dicom';\n          return startsWith(acceptHeader.value, acceptValue) &&\n            acceptHeader.value[acceptValue.length] !== '+';\n        }\n      }\n    }\n\n    const urlObjext = getUrlFromUri(url);\n    // extension\n    const ext = getFileExtension(urlObjext.pathname);\n    const hasNoExt = (ext === null);\n    const hasDcmExt = (ext === 'dcm');\n    // content type (for wado url)\n    const contentType = urlObjext.searchParams.get('contentType');\n    const hasContentType = contentType !== null &&\n      typeof contentType !== 'undefined';\n    const hasDicomContentType = (contentType === 'application/dicom');\n\n    return hasContentType ? hasDicomContentType : (hasNoExt || hasDcmExt);\n  }\n\n  /**\n   * Check if the loader can load the provided memory object.\n   *\n   * @param {object} mem The memory object.\n   * @returns {boolean} True if the object can be loaded.\n   */\n  canLoadMemory(mem) {\n    const contentType = mem['Content-Type'];\n    if (typeof contentType !== 'undefined' &&\n      contentType.startsWith('application/dicom')) {\n      return true;\n    }\n    if (typeof mem.filename !== 'undefined') {\n      const tmpFile = new File(['from memory'], mem.filename);\n      return this.canLoadFile(tmpFile);\n    }\n    return false;\n  }\n\n  /**\n   * Get the file content type needed by the loader.\n   *\n   * @returns {number} One of the 'fileContentTypes'.\n   */\n  loadFileAs() {\n    return fileContentTypes.ArrayBuffer;\n  }\n\n  /**\n   * Get the url content type needed by the loader.\n   *\n   * @returns {number} One of the 'urlContentTypes'.\n   */\n  loadUrlAs() {\n    return urlContentTypes.ArrayBuffer;\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event fired\n   *   when a file item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle an load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class DicomDataLoader\n","import {startsWith, getFileExtension} from '../utils/string.js';\nimport {getUrlFromUri} from '../utils/uri.js';\nimport {fileContentTypes} from './filesLoader.js';\nimport {urlContentTypes} from './urlsLoader.js';\n\n/**\n * JSON text loader.\n */\nexport class JSONTextLoader {\n\n  /**\n   * Loading flag.\n   *\n   * @type {boolean}\n   */\n  #isLoading = false;\n\n  /**\n   * Set the loader options.\n   *\n   * @param {object} _opt The input options.\n   */\n  setOptions(_opt) {\n    // does nothing\n  }\n\n  /**\n   * Is the load ongoing?\n   *\n   * @returns {boolean} True if loading.\n   */\n  isLoading() {\n    return this.#isLoading;\n  }\n\n  /**\n   * Load data.\n   *\n   * @param {object} text The input text.\n   * @param {string} origin The data origin.\n   * @param {number} index The data index.\n   */\n  load(text, origin, index) {\n    // set loading flag\n    this.#isLoading = true;\n    this.onloadstart({\n      source: origin\n    });\n\n    try {\n      this.onprogress({\n        lengthComputable: true,\n        loaded: 100,\n        total: 100,\n        index: index,\n        source: origin\n      });\n      const data = {\n        data: text,\n        source: origin\n      };\n      // only expecting one item\n      this.onloaditem(data);\n      this.onload(data);\n    } catch (error) {\n      this.onerror({\n        error: error,\n        source: origin\n      });\n    } finally {\n      // reset loading flag\n      this.#isLoading = false;\n      this.onloadend({\n        source: origin\n      });\n    }\n  }\n\n  /**\n   * Abort load: pass to listeners.\n   */\n  abort() {\n    // reset loading flag\n    this.#isLoading = false;\n    // call listeners\n    this.onabort({});\n    this.onloadend({});\n  }\n\n  /**\n   * Check if the loader can load the provided file.\n   * True if the file has a 'json' extension.\n   *\n   * @param {File} file The file to check.\n   * @returns {boolean} True if the file can be loaded.\n   */\n  canLoadFile(file) {\n    const ext = getFileExtension(file.name);\n    return (ext === 'json');\n  }\n\n  /**\n   * Check if the loader can load the provided url.\n   * True if one of the folowing conditions is true:\n   * - the `options.forceLoader` is 'json',\n   * - the `options.requestHeaders` contains a 'Accept: application/json' or\n   *   'Accept: application/dicom+json',\n   * - the url has a 'json' extension.\n   *\n   * @param {string} url The url to check.\n   * @param {object} [options] Optional url request options.\n   * @returns {boolean} True if the url can be loaded.\n   */\n  canLoadUrl(url, options) {\n    // check options\n    if (typeof options !== 'undefined') {\n      // check options.forceLoader\n      if (typeof options.forceLoader !== 'undefined' &&\n        options.forceLoader === 'json') {\n        return true;\n      }\n      // check options.requestHeaders for 'Accept'\n      if (typeof options.requestHeaders !== 'undefined') {\n        const isNameAccept = function (element) {\n          return element.name === 'Accept';\n        };\n        const acceptHeader = options.requestHeaders.find(isNameAccept);\n        if (typeof acceptHeader !== 'undefined') {\n          // starts with 'application/json' or 'application/dicom+json\n          return startsWith(acceptHeader.value, 'application/json') ||\n            startsWith(acceptHeader.value, 'application/dicom+json');\n        }\n      }\n    }\n\n    const urlObjext = getUrlFromUri(url);\n    const ext = getFileExtension(urlObjext.pathname);\n    return (ext === 'json');\n  }\n\n  /**\n   * Check if the loader can load the provided memory object.\n   *\n   * @param {object} mem The memory object.\n   * @returns {boolean} True if the object can be loaded.\n   */\n  canLoadMemory(mem) {\n    const contentType = mem['Content-Type'];\n    if (typeof contentType !== 'undefined' &&\n      contentType.startsWith('application/json')) {\n      return true;\n    }\n    if (typeof mem.filename !== 'undefined') {\n      const tmpFile = new File(['from memory'], mem.filename);\n      return this.canLoadFile(tmpFile);\n    }\n    return false;\n  }\n\n  /**\n   * Get the file content type needed by the loader.\n   *\n   * @returns {number} One of the 'fileContentTypes'.\n   */\n  loadFileAs() {\n    return fileContentTypes.Text;\n  }\n\n  /**\n   * Get the url content type needed by the loader.\n   *\n   * @returns {number} One of the 'urlContentTypes'.\n   */\n  loadUrlAs() {\n    return urlContentTypes.Text;\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event fired\n   *   when a file item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle an load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class JSONTextLoader\n","import {startsWith} from '../utils/string.js';\nimport {parseMultipart} from '../utils/array.js';\nimport {MemoryLoader} from './memoryLoader.js';\nimport {fileContentTypes} from './filesLoader.js';\nimport {urlContentTypes} from './urlsLoader.js';\n\n/**\n * Multipart data loader.\n */\nexport class MultipartLoader {\n\n  /**\n   * Loading flag.\n   *\n   * @type {boolean}\n   */\n  #isLoading = false;\n\n  /**\n   * Set the loader options.\n   *\n   * @param {object} _opt The input options.\n   */\n  setOptions(_opt) {\n    // does nothing\n  }\n\n  /**\n   * Is the load ongoing?\n   *\n   * @returns {boolean} True if loading.\n   */\n  isLoading() {\n    return this.#isLoading;\n  }\n\n  /**\n   * Load data.\n   *\n   * @param {object} buffer The DICOM buffer.\n   * @param {string} origin The data origin.\n   * @param {number} index The data index.\n   */\n  load(buffer, origin, index) {\n    // send start event\n    this.onloadstart({\n      source: origin\n    });\n    // set loading flag\n    this.#isLoading = true;\n\n    const memoryIO = new MemoryLoader();\n    // memoryIO.onloadstart: nothing to do\n    memoryIO.onprogress = (progress) => {\n      // add 50% to take into account the un-Multipartping\n      progress.loaded = 50 + progress.loaded / 2;\n      // set data index\n      progress.index = index;\n      this.onprogress(progress);\n    };\n    memoryIO.onloaditem = this.onloaditem;\n    memoryIO.onload = this.onload;\n    memoryIO.onloadend = (event) => {\n      // reset loading flag\n      this.#isLoading = false;\n      // call listeners\n      this.onloadend(event);\n    };\n    memoryIO.onerror = this.onerror;\n    memoryIO.onabort = this.onabort;\n    // launch\n    memoryIO.load(parseMultipart(buffer));\n  }\n\n  /**\n   * Abort load: pass to listeners.\n   */\n  abort() {\n    // reset loading flag\n    this.#isLoading = false;\n    // call listeners\n    this.onabort({});\n    this.onloadend({});\n  }\n\n  /**\n   * Check if the loader can load the provided file.\n   * Always returns false.\n   *\n   * @param {File} _file The file to check.\n   * @returns {boolean} True if the file can be loaded.\n   */\n  canLoadFile(_file) {\n    return false;\n  }\n\n  /**\n   * Check if the loader can load the provided url.\n   * True if one of the folowing conditions is true:\n   * - the `options.forceLoader` is 'multipart',\n   * - the `options.requestHeaders` contains a 'Accept: multipart/related'.\n   *\n   * @param {string} url The url to check.\n   * @param {object} [options] Optional url request options.\n   * @returns {boolean} True if the url can be loaded.\n   */\n  canLoadUrl(url, options) {\n    // check options\n    if (typeof options !== 'undefined') {\n      // check options.forceLoader\n      if (typeof options.forceLoader !== 'undefined' &&\n        options.forceLoader === 'multipart') {\n        return true;\n      }\n      // check options.requestHeaders for 'Accept'\n      if (typeof options.requestHeaders !== 'undefined') {\n        const isNameAccept = function (element) {\n          return element.name === 'Accept';\n        };\n        const acceptHeader = options.requestHeaders.find(isNameAccept);\n        if (typeof acceptHeader !== 'undefined') {\n          // starts with 'multipart/related'\n          return startsWith(acceptHeader.value, 'multipart/related');\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Check if the loader can load the provided memory object.\n   *\n   * @param {object} _mem The memory object.\n   * @returns {boolean} True if the url can be loaded.\n   */\n  canLoadMemory(_mem) {\n    return false;\n  }\n\n  /**\n   * Get the file content type needed by the loader.\n   *\n   * @returns {number} One of the 'fileContentTypes'.\n   */\n  loadFileAs() {\n    return fileContentTypes.ArrayBuffer;\n  }\n\n  /**\n   * Get the url content type needed by the loader.\n   *\n   * @returns {number} One of the 'urlContentTypes'.\n   */\n  loadUrlAs() {\n    return urlContentTypes.ArrayBuffer;\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a load progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event fired\n   *   when a file item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle an load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class MultipartLoader\n","import {startsWith, getFileExtension} from '../utils/string.js';\nimport {getUrlFromUri} from '../utils/uri.js';\nimport {getViewFromDOMImage} from '../image/domReader.js';\nimport {fileContentTypes} from './filesLoader.js';\nimport {urlContentTypes} from './urlsLoader.js';\n\n/**\n * Raw image loader.\n */\nexport class RawImageLoader {\n\n  /**\n   * If abort is triggered, all image.onload callbacks have to be cancelled.\n   *\n   * @type {boolean}\n   */\n  #aborted = false;\n\n  /**\n   * Set the loader options.\n   *\n   * @param {object} _opt The input options.\n   */\n  setOptions(_opt) {\n    // does nothing\n  }\n\n  /**\n   * Is the load ongoing? TODO...\n   *\n   * @returns {boolean} True if loading.\n   */\n  isLoading() {\n    return true;\n  }\n\n  /**\n   * Create a Data URI from an HTTP request response.\n   *\n   * @param {ArrayBuffer} response The HTTP request response.\n   * @param {string} dataType The data type.\n   * @returns {string} The data URI.\n   */\n  #createDataUri(response, dataType) {\n    // image type\n    let imageType = dataType;\n    if (!imageType || imageType === 'jpg') {\n      imageType = 'jpeg';\n    }\n    // create uri\n    const file = new Blob([response], {type: 'image/' + imageType});\n    return window.URL.createObjectURL(file);\n  }\n\n  /**\n   * Load data.\n   *\n   * @param {ArrayBuffer|string} buffer The read data.\n   * @param {string|File} origin The data origin.\n   * @param {number} index The data index.\n   */\n  load(buffer, origin, index) {\n    this.#aborted = false;\n    // create a DOM image\n    const image = new Image();\n    // triggered by ctx.drawImage\n    image.onload = (/*event*/) => {\n      try {\n        if (!this.#aborted) {\n          this.onprogress({\n            lengthComputable: true,\n            loaded: 100,\n            total: 100,\n            index: index,\n            source: origin\n          });\n          const data = getViewFromDOMImage(image, origin, index);\n          // only expecting one item\n          this.onloaditem(data);\n          this.onload(data);\n        }\n      } catch (error) {\n        this.onerror({\n          error: error,\n          source: origin\n        });\n      } finally {\n        this.onloadend({\n          source: origin\n        });\n      }\n    };\n    // storing values to pass them on\n    if (typeof buffer === 'string') {\n      // file case\n      image.src = buffer;\n    } else if (typeof origin === 'string') {\n      // url case\n      const ext = origin.split('.').pop().toLowerCase();\n      image.src = this.#createDataUri(buffer, ext);\n    }\n  }\n\n  /**\n   * Abort load.\n   */\n  abort() {\n    this.#aborted = true;\n    this.onabort({});\n    this.onloadend({});\n  }\n\n  /**\n   * Check if the loader can load the provided file.\n   * True for files with type 'image.*'.\n   *\n   * @param {File} file The file to check.\n   * @returns {boolean} True if the file can be loaded.\n   */\n  canLoadFile(file) {\n    return (typeof file.type !== 'undefined' &&\n      file.type.match('image.*') !== null);\n  }\n\n  /**\n   * Check if the loader can load the provided url.\n   * True if one of the folowing conditions is true:\n   * - the `options.forceLoader` is 'rawimage',\n   * - the `options.requestHeaders` contains an item\n   *   starting with 'Accept: image/'.\n   * - the url has a 'contentType' and it is 'image/jpeg', 'image/png'\n   *   or 'image/gif' (as in wado urls),\n   * - the url has no 'contentType' and the extension is 'jpeg', 'jpg',\n   *   'png' or 'gif'.\n   *\n   * @param {string} url The url to check.\n   * @param {object} [options] Optional url request options.\n   * @returns {boolean} True if the url can be loaded.\n   */\n  canLoadUrl(url, options) {\n    // check options\n    if (typeof options !== 'undefined') {\n      // check options.forceLoader\n      if (typeof options.forceLoader !== 'undefined' &&\n        options.forceLoader === 'rawimage') {\n        return true;\n      }\n      // check options.requestHeaders for 'Accept'\n      if (typeof options.requestHeaders !== 'undefined') {\n        const isNameAccept = function (element) {\n          return element.name === 'Accept';\n        };\n        const acceptHeader = options.requestHeaders.find(isNameAccept);\n        if (typeof acceptHeader !== 'undefined') {\n          // starts with 'image/'\n          return startsWith(acceptHeader.value, 'image/');\n        }\n      }\n    }\n\n    const urlObjext = getUrlFromUri(url);\n    // extension\n    const ext = getFileExtension(urlObjext.pathname);\n    const hasImageExt = (ext === 'jpeg') || (ext === 'jpg') ||\n      (ext === 'png') || (ext === 'gif');\n    // content type (for wado url)\n    const contentType = urlObjext.searchParams.get('contentType');\n    const hasContentType = contentType !== null &&\n      typeof contentType !== 'undefined';\n    const hasImageContentType = (contentType === 'image/jpeg') ||\n      (contentType === 'image/png') ||\n      (contentType === 'image/gif');\n\n    return hasContentType ? hasImageContentType : hasImageExt;\n  }\n\n  /**\n   * Check if the loader can load the provided memory object.\n   *\n   * @param {object} mem The memory object.\n   * @returns {boolean} True if the object can be loaded.\n   */\n  canLoadMemory(mem) {\n    if (typeof mem.filename !== 'undefined') {\n      const tmpFile = new File(['from memory'], mem.filename);\n      return this.canLoadFile(tmpFile);\n    }\n    return false;\n  }\n\n  /**\n   * Get the file content type needed by the loader.\n   *\n   * @returns {number} One of the 'fileContentTypes'.\n   */\n  loadFileAs() {\n    return fileContentTypes.DataURL;\n  }\n\n  /**\n   * Get the url content type needed by the loader.\n   *\n   * @returns {number} One of the 'urlContentTypes'.\n   */\n  loadUrlAs() {\n    return urlContentTypes.ArrayBuffer;\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event fired\n   *   when a file item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle an load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class RawImageLoader","import {startsWith, getFileExtension} from '../utils/string.js';\nimport {getUrlFromUri} from '../utils/uri.js';\nimport {getViewFromDOMVideo} from '../image/domReader.js';\nimport {fileContentTypes} from './filesLoader.js';\nimport {urlContentTypes} from './urlsLoader.js';\n\n/**\n * Raw video loader.\n *\n * Url example (cors enabled):\n *   {@link https://raw.githubusercontent.com/clappr/clappr/master/test/fixtures/SampleVideo_360x240_1mb.mp4}.\n */\nexport class RawVideoLoader {\n\n  /**\n   * Set the loader options.\n   *\n   * @param {object} _opt The input options.\n   */\n  setOptions(_opt) {\n    // does nothing\n  }\n\n  /**\n   * Is the load ongoing? TODO...\n   *\n   * @returns {boolean} True if loading.\n   */\n  isLoading() {\n    return true;\n  }\n\n  /**\n   * Create a Data URI from an HTTP request response.\n   *\n   * @param {object} response The HTTP request response.\n   * @param {string} dataType The data type.\n   * @returns {string} The data URI.\n   */\n  #createDataUri(response, dataType) {\n    // image data as string\n    const bytes = new Uint8Array(response);\n    let videoDataStr = '';\n    for (let i = 0; i < bytes.byteLength; ++i) {\n      videoDataStr += String.fromCharCode(bytes[i]);\n    }\n    // create uri\n    const uri = 'data:video/' + dataType +\n      ';base64,' + window.btoa(videoDataStr);\n    return uri;\n  }\n\n  /**\n   * Internal Data URI load.\n   *\n   * @param {object} buffer The read data.\n   * @param {string} origin The data origin.\n   * @param {number} index The data index.\n   */\n  load(buffer, origin, index) {\n    // create a DOM video\n    const video = document.createElement('video');\n    if (typeof origin === 'string') {\n      // url case\n      const ext = origin.split('.').pop().toLowerCase();\n      video.src = this.#createDataUri(buffer, ext);\n    } else {\n      video.src = buffer;\n    }\n    // onload handler\n    video.onloadedmetadata = (event) => {\n      try {\n        getViewFromDOMVideo(event.target,\n          this.onloaditem, this.onload,\n          this.onprogress, this.onloadend,\n          origin, index);\n      } catch (error) {\n        this.onerror({\n          error: error,\n          source: origin\n        });\n        this.onloadend({\n          source: origin\n        });\n      }\n    };\n  }\n\n  /**\n   * Abort load.\n   */\n  abort() {\n    this.onabort({});\n    this.onloadend({});\n  }\n\n  /**\n   * Check if the loader can load the provided file.\n   * True for files with type 'video.*'.\n   *\n   * @param {File} file The file to check.\n   * @returns {boolean} True if the file can be loaded.\n   */\n  canLoadFile(file) {\n    return (typeof file.type !== 'undefined' &&\n      file.type.match('video.*') !== null);\n  }\n\n  /**\n   * Check if the loader can load the provided url.\n   * True if one of the folowing conditions is true:\n   * - the `options.forceLoader` is 'rawvideo',\n   * - the `options.requestHeaders` contains an item\n   *   starting with 'Accept: video/'.\n   * - the url has a 'mp4', 'ogg' or 'webm' extension.\n   *\n   * @param {string} url The url to check.\n   * @param {object} [options] Optional url request options.\n   * @returns {boolean} True if the url can be loaded.\n   */\n  canLoadUrl(url, options) {\n    // check options\n    if (typeof options !== 'undefined') {\n      // check options.forceLoader\n      if (typeof options.forceLoader !== 'undefined' &&\n        options.forceLoader === 'rawvideo') {\n        return true;\n      }\n      // check options.requestHeaders for 'Accept'\n      if (typeof options.requestHeaders !== 'undefined') {\n        const isNameAccept = function (element) {\n          return element.name === 'Accept';\n        };\n        const acceptHeader = options.requestHeaders.find(isNameAccept);\n        if (typeof acceptHeader !== 'undefined') {\n          // starts with 'video/'\n          return startsWith(acceptHeader.value, 'video/');\n        }\n      }\n    }\n\n    const urlObjext = getUrlFromUri(url);\n    const ext = getFileExtension(urlObjext.pathname);\n    return (ext === 'mp4') ||\n      (ext === 'ogg') ||\n      (ext === 'webm');\n  }\n\n  /**\n   * Check if the loader can load the provided memory object.\n   *\n   * @param {object} mem The memory object.\n   * @returns {boolean} True if the object can be loaded.\n   */\n  canLoadMemory(mem) {\n    if (typeof mem.filename !== 'undefined') {\n      const tmpFile = new File(['from memory'], mem.filename);\n      return this.canLoadFile(tmpFile);\n    }\n    return false;\n  }\n\n  /**\n   * Get the file content type needed by the loader.\n   *\n   * @returns {number} One of the 'fileContentTypes'.\n   */\n  loadFileAs() {\n    return fileContentTypes.DataURL;\n  }\n\n  /**\n   * Get the url content type needed by the loader.\n   *\n   * @returns {number} One of the 'urlContentTypes'.\n   */\n  loadUrlAs() {\n    return urlContentTypes.ArrayBuffer;\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event fired\n   * when a file item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   * when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle an load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class RawVideoLoader\n","import {startsWith, getFileExtension} from '../utils/string.js';\nimport {getUrlFromUri} from '../utils/uri.js';\nimport {fileContentTypes} from './filesLoader.js';\nimport {urlContentTypes} from './urlsLoader.js';\nimport {MemoryLoader} from './memoryLoader.js';\n\n/**\n * The zip library.\n *\n * Ref: {@link https://github.com/Stuk/jszip}.\n *\n * @external JSZip\n */\nimport JSZip from 'jszip';\n\n/**\n * ZIP data loader.\n */\nexport class ZipLoader {\n\n  /**\n   * Loading flag.\n   *\n   * @type {boolean}\n   */\n  #isLoading = false;\n\n  /**\n   * Set the loader options.\n   *\n   * @param {object} _opt The input options.\n   */\n  setOptions(_opt) {\n    // does nothing\n  }\n\n  /**\n   * Is the load ongoing?\n   *\n   * @returns {boolean} True if loading.\n   */\n  isLoading() {\n    return this.#isLoading;\n  }\n\n  #filename = '';\n  #files = [];\n  #zobjs = null;\n\n  /**\n   * JSZip.async callback.\n   *\n   * @param {ArrayBuffer} content Unzipped file image.\n   * @param {object} origin The origin of the file.\n   * @param {number} index The data index.\n   */\n  #zipAsyncCallback(content, origin, index) {\n    this.#files.push({filename: this.#filename, data: content});\n\n    // sent un-ziped progress with the data index\n    // (max 50% to take into account the memory loading)\n    const unzipPercent = this.#files.length * 100 / this.#zobjs.length;\n    this.onprogress({\n      lengthComputable: true,\n      loaded: (unzipPercent / 2),\n      total: 100,\n      index: index,\n      item: {\n        loaded: unzipPercent,\n        total: 100,\n        source: origin\n      }\n    });\n\n    // recursively call until we have all the files\n    if (this.#files.length < this.#zobjs.length) {\n      const num = this.#files.length;\n      this.#filename = this.#zobjs[num].name;\n      this.#zobjs[num].async('arrayBuffer').then((content) => {\n        this.#zipAsyncCallback(content, origin, index);\n      });\n    } else {\n      const memoryIO = new MemoryLoader();\n      // memoryIO.onloadstart: nothing to do\n      memoryIO.onprogress = (progress) => {\n        // add 50% to take into account the un-zipping\n        progress.loaded = 50 + progress.loaded / 2;\n        // set data index\n        progress.index = index;\n        this.onprogress(progress);\n      };\n      memoryIO.onloaditem = this.onloaditem;\n      memoryIO.onload = this.onload;\n      memoryIO.onloadend = (event) => {\n        // reset loading flag\n        this.#isLoading = false;\n        // call listeners\n        this.onloadend(event);\n      };\n      memoryIO.onerror = this.onerror;\n      memoryIO.onabort = this.onabort;\n      // launch\n      memoryIO.load(this.#files);\n    }\n  }\n\n  /**\n   * Load data.\n   *\n   * @param {object} buffer The DICOM buffer.\n   * @param {string} origin The data origin.\n   * @param {number} index The data index.\n   */\n  load(buffer, origin, index) {\n    // send start event\n    this.onloadstart({\n      source: origin\n    });\n    // set loading flag\n    this.#isLoading = true;\n\n    JSZip.loadAsync(buffer).then((zip) => {\n      this.#files = [];\n      this.#zobjs = zip.file(/.*\\.dcm/);\n      // recursively load zip files into the files array\n      const num = this.#files.length;\n      this.#filename = this.#zobjs[num].name;\n      this.#zobjs[num].async('arrayBuffer').then((content) => {\n        this.#zipAsyncCallback(content, origin, index);\n      });\n    });\n  }\n\n  /**\n   * Abort load: pass to listeners.\n   */\n  abort() {\n    // reset loading flag\n    this.#isLoading = false;\n    // call listeners\n    this.onabort({});\n    this.onloadend({});\n  }\n\n  /**\n   * Check if the loader can load the provided file.\n   * True if the file has a 'zip' extension.\n   *\n   * @param {File} file The file to check.\n   * @returns {boolean} True if the file can be loaded.\n   */\n  canLoadFile(file) {\n    const ext = getFileExtension(file.name);\n    return (ext === 'zip');\n  }\n\n  /**\n   * Check if the loader can load the provided url.\n   * True if one of the folowing conditions is true:\n   * - the `options.forceLoader` is 'zip',\n   * - the `options.requestHeaders` contains an item\n   *   starting with 'Accept: application/zip'.\n   * - the url has a 'zip' extension.\n   *\n   * @param {string} url The url to check.\n   * @param {object} [options] Optional url request options.\n   * @returns {boolean} True if the url can be loaded.\n   */\n  canLoadUrl(url, options) {\n    // check options\n    if (typeof options !== 'undefined') {\n      // check options.forceLoader\n      if (typeof options.forceLoader !== 'undefined' &&\n        options.forceLoader === 'zip') {\n        return true;\n      }\n      // check options.requestHeaders for 'Accept'\n      if (typeof options.requestHeaders !== 'undefined') {\n        const isNameAccept = function (element) {\n          return element.name === 'Accept';\n        };\n        const acceptHeader = options.requestHeaders.find(isNameAccept);\n        if (typeof acceptHeader !== 'undefined') {\n          // starts with 'application/zip'\n          return startsWith(acceptHeader.value, 'application/zip');\n        }\n      }\n    }\n\n    const urlObjext = getUrlFromUri(url);\n    const ext = getFileExtension(urlObjext.pathname);\n    return (ext === 'zip');\n  }\n\n  /**\n   * Check if the loader can load the provided memory object.\n   *\n   * @param {object} mem The memory object.\n   * @returns {boolean} True if the object can be loaded.\n   */\n  canLoadMemory(mem) {\n    const contentType = mem['Content-Type'];\n    if (typeof contentType !== 'undefined' &&\n      contentType.startsWith('application/zip')) {\n      return true;\n    }\n    if (typeof mem.filename !== 'undefined') {\n      const tmpFile = new File(['from memory'], mem.filename);\n      return this.canLoadFile(tmpFile);\n    }\n    return false;\n  }\n\n  /**\n   * Get the file content type needed by the loader.\n   *\n   * @returns {number} One of the 'fileContentTypes'.\n   */\n  loadFileAs() {\n    return fileContentTypes.ArrayBuffer;\n  }\n\n  /**\n   * Get the url content type needed by the loader.\n   *\n   * @returns {number} One of the 'urlContentTypes'.\n   */\n  loadUrlAs() {\n    return urlContentTypes.ArrayBuffer;\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a load progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event fired\n   *   when a file item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle an load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class ZipLoader\n","import {MultiProgressHandler} from '../utils/progress.js';\nimport {loaderList} from './loaderList.js';\n\n// file content types\nexport const fileContentTypes = {\n  Text: 0,\n  ArrayBuffer: 1,\n  DataURL: 2\n};\n\n/**\n * Files loader.\n */\nexport class FilesLoader {\n\n  /**\n   * Input data.\n   *\n   * @type {File[]}\n   */\n  #inputData = null;\n\n  /**\n   * Array of launched file readers.\n   *\n   * @type {FileReader[]}\n   */\n  #readers = [];\n\n  /**\n   * Data loader.\n   *\n   * @type {object}\n   */\n  #runningLoader = null;\n\n  /**\n   * Number of loaded data.\n   *\n   * @type {number}\n   */\n  #nLoad = 0;\n\n  /**\n   * Number of load end events.\n   *\n   * @type {number}\n   */\n  #nLoadend = 0;\n\n  /**\n   * The default character set (optional).\n   *\n   * @type {string}\n   */\n  #defaultCharacterSet;\n\n  /**\n   * Get the default character set.\n   *\n   * @returns {string} The default character set.\n   */\n  getDefaultCharacterSet() {\n    return this.#defaultCharacterSet;\n  }\n\n  /**\n   * Set the default character set.\n   *\n   * @param {string} characterSet The character set.\n   */\n  setDefaultCharacterSet(characterSet) {\n    this.#defaultCharacterSet = characterSet;\n  }\n\n  /**\n   * Store the current input.\n   *\n   * @param {File[]} data The input data.\n   */\n  #storeInputData(data) {\n    this.#inputData = data;\n    // reset counters\n    this.#nLoad = 0;\n    this.#nLoadend = 0;\n    // clear storage\n    this.#clearStoredReaders();\n    this.#clearStoredLoader();\n  }\n\n  /**\n   * Store a launched reader.\n   *\n   * @param {FileReader} reader The launched reader.\n   */\n  #storeReader(reader) {\n    this.#readers.push(reader);\n  }\n\n  /**\n   * Clear the stored readers.\n   *\n   */\n  #clearStoredReaders() {\n    this.#readers = [];\n  }\n\n  /**\n   * Store the launched loader.\n   *\n   * @param {object} loader The launched loader.\n   */\n  #storeLoader(loader) {\n    this.#runningLoader = loader;\n  }\n\n  /**\n   * Clear the stored loader.\n   *\n   */\n  #clearStoredLoader() {\n    this.#runningLoader = null;\n  }\n\n  /**\n   * Increment the number of loaded data\n   *   and call onload if loaded all data.\n   *\n   * @param {object} _event The load data event.\n   */\n  #addLoad = (_event) => {\n    this.#nLoad++;\n    // call onload when all is loaded\n    // (not using the input event since it is\n    //   an individual load)\n    if (this.#nLoad === this.#inputData.length) {\n      this.onload({\n        source: this.#inputData\n      });\n    }\n  };\n\n  /**\n   * Increment the counter of load end events\n   *   and run callbacks when all done, erroneus or not.\n   *\n   * @param {object} _event The load end event.\n   */\n  #addLoadend = (_event) => {\n    this.#nLoadend++;\n    // call onloadend when all is run\n    // (not using the input event since it is\n    //   an individual load end)\n    if (this.#nLoadend === this.#inputData.length) {\n      this.onloadend({\n        source: this.#inputData\n      });\n    }\n  };\n\n  /**\n   * @callback eventFn\n   * @param {object} event The event.\n   */\n\n  /**\n   * Augment a callback event with a srouce.\n   *\n   * @param {object} callback The callback to augment its event.\n   * @param {object} source The source to add to the event.\n   * @returns {eventFn} The augmented callback.\n   */\n  #augmentCallbackEvent(callback, source) {\n    return (event) => {\n      event.source = source;\n      callback(event);\n    };\n  }\n\n  /**\n   * Get a load handler for a data element.\n   *\n   * @param {object} loader The associated loader.\n   * @param {File} dataElement The data element.\n   * @param {number} i The index of the element.\n   * @returns {eventFn} A load handler.\n   */\n  #getLoadHandler(loader, dataElement, i) {\n    return (event) => {\n      loader.load(event.target.result, dataElement, i);\n    };\n  }\n\n\n  /**\n   * Load a list of files.\n   *\n   * @param {File[]} data The list of files to load.\n   */\n  load(data) {\n    // check input\n    if (typeof data === 'undefined' || data.length === 0) {\n      return;\n    }\n    this.#storeInputData(data);\n\n    // send start event\n    this.onloadstart({\n      source: data\n    });\n\n    // create prgress handler\n    const mproghandler = new MultiProgressHandler(this.onprogress);\n    mproghandler.setNToLoad(data.length);\n\n    // create loaders\n    const loaders = [];\n    for (let m = 0; m < loaderList.length; ++m) {\n      loaders.push(new loaderList[m]());\n    }\n\n    // find an appropriate loader\n    let dataElement = data[0];\n    let loader = null;\n    let foundLoader = false;\n    for (let l = 0; l < loaders.length; ++l) {\n      loader = loaders[l];\n      if (loader.canLoadFile(dataElement)) {\n        foundLoader = true;\n        // load options\n        loader.setOptions({\n          numberOfFiles: data.length,\n          defaultCharacterSet: this.getDefaultCharacterSet()\n        });\n        // set loader callbacks\n        // loader.onloadstart: nothing to do\n        loader.onprogress = mproghandler.getUndefinedMonoProgressHandler(1);\n        loader.onloaditem = this.onloaditem;\n        loader.onload = this.#addLoad;\n        loader.onloadend = this.#addLoadend;\n        loader.onerror = this.onerror;\n        loader.onabort = this.onabort;\n\n        // store loader\n        this.#storeLoader(loader);\n        // exit\n        break;\n      }\n    }\n    if (!foundLoader) {\n      throw new Error('No loader found for file: ' + dataElement.name);\n    }\n\n    // loop on I/O elements\n    for (let i = 0; i < data.length; ++i) {\n      dataElement = data[i];\n\n      // check loader\n      if (!loader.canLoadFile(dataElement)) {\n        throw new Error('Input file of different type: ' + dataElement);\n      }\n\n      /**\n       * The file reader.\n       *\n       * Ref: {@link https://developer.mozilla.org/en-US/docs/Web/API/FileReader}.\n       *\n       * @external FileReader\n       */\n      const reader = new FileReader();\n      // store reader\n      this.#storeReader(reader);\n\n      // set reader callbacks\n      // reader.onloadstart: nothing to do\n      reader.onprogress = this.#augmentCallbackEvent(\n        mproghandler.getMonoProgressHandler(i, 0), dataElement);\n      reader.onload = this.#getLoadHandler(loader, dataElement, i);\n      // reader.onloadend: nothing to do\n      const errorCallback =\n        this.#augmentCallbackEvent(this.onerror, dataElement);\n      reader.onerror = (event) => {\n        this.#addLoadend();\n        errorCallback(event);\n      };\n      const abortCallback =\n        this.#augmentCallbackEvent(this.onabort, dataElement);\n      reader.onabort = (event) => {\n        this.#addLoadend();\n        abortCallback(event);\n      };\n      // read\n      if (loader.loadFileAs() === fileContentTypes.Text) {\n        reader.readAsText(dataElement);\n      } else if (loader.loadFileAs() === fileContentTypes.DataURL) {\n        reader.readAsDataURL(dataElement);\n      } else if (loader.loadFileAs() === fileContentTypes.ArrayBuffer) {\n        reader.readAsArrayBuffer(dataElement);\n      }\n    }\n  }\n\n  /**\n   * Abort a load.\n   */\n  abort() {\n    // abort readers\n    for (let i = 0; i < this.#readers.length; ++i) {\n      // 0: EMPTY, 1: LOADING, 2: DONE\n      if (this.#readers[i].readyState === 1) {\n        this.#readers[i].abort();\n      }\n    }\n    // abort loader\n    if (this.#runningLoader && this.#runningLoader.isLoading()) {\n      this.#runningLoader.abort();\n    }\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a load progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load item event fired\n   *   when a file item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle a load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class FilesLoader\n","import {FilesLoader} from '../io/filesLoader.js';\nimport {MemoryLoader} from '../io/memoryLoader.js';\nimport {UrlsLoader} from '../io/urlsLoader.js';\n\n/**\n * Load controller.\n */\nexport class LoadController {\n\n  /**\n   * The default character set.\n   *\n   * @type {string}\n   */\n  #defaultCharacterSet;\n\n  /**\n   * List of current loaders.\n   *\n   * @type {object}\n   */\n  #currentLoaders = {};\n\n  /**\n   * @param {string} defaultCharacterSet The default character set.\n   */\n  constructor(defaultCharacterSet) {\n    this.#defaultCharacterSet = defaultCharacterSet;\n  }\n\n  /**\n   * Load a list of files. Can be image files or a state file.\n   *\n   * @param {File[]} files The list of files to load.\n   * @param {string} dataId The data Id.\n   */\n  loadFiles(files, dataId) {\n    // has been checked for emptiness.\n    const ext = files[0].name.split('.').pop().toLowerCase();\n    if (ext === 'json') {\n      this.#loadStateFile(files[0], dataId);\n    } else {\n      this.#loadImageFiles(files, dataId);\n    }\n  }\n\n  /**\n   * Load a list of URLs. Can be image files or a state file.\n   *\n   * @param {string[]} urls The list of urls to load.\n   * @param {string} dataId The data Id.\n   * @param {object} [options] The load options:\n   * - requestHeaders: an array of {name, value} to use as request headers.\n   * - withCredentials: credentials flag to pass to the request.\n   */\n\n  loadURLs(urls, dataId, options) {\n    // has been checked for emptiness.\n    const ext = urls[0].split('.').pop().toLowerCase();\n    if (ext === 'json') {\n      this.#loadStateUrl(urls[0], dataId, options);\n    } else {\n      this.#loadImageUrls(urls, dataId, options);\n    }\n  }\n\n  /**\n   * Load a list of ArrayBuffers.\n   *\n   * @param {Array} data The list of ArrayBuffers to load\n   *   in the form of [{name: '', filename: '', data: data}].\n   * @param {string} dataId The data Id.\n   */\n  loadImageObject(data, dataId) {\n    // create IO\n    const memoryIO = new MemoryLoader();\n    // load data\n    this.#loadData(data, memoryIO, 'image', dataId);\n  }\n\n  /**\n   * Get the currently loaded data ids.\n   *\n   * @returns {string[]} The data ids.\n   */\n  getLoadingDataIds() {\n    return Object.keys(this.#currentLoaders);\n  }\n\n  /**\n   * Abort an individual current loader.\n   *\n   * @param {string} dataId The data to stop loading.\n   */\n  abort(dataId) {\n    if (typeof this.#currentLoaders[dataId] !== 'undefined') {\n      this.#currentLoaders[dataId].loader.abort();\n      delete this.#currentLoaders[dataId];\n    }\n  }\n\n  // private ----------------------------------------------------------------\n\n  /**\n   * Load a list of image files.\n   *\n   * @param {File[]} files The list of image files to load.\n   * @param {string} dataId The data Id.\n   */\n  #loadImageFiles(files, dataId) {\n    // create IO\n    const fileIO = new FilesLoader();\n    fileIO.setDefaultCharacterSet(this.#defaultCharacterSet);\n    // load data\n    this.#loadData(files, fileIO, 'image', dataId);\n  }\n\n  /**\n   * Load a list of image URLs.\n   *\n   * @param {string[]} urls The list of urls to load.\n   * @param {string} [dataId] The data Id.\n   * @param {object} [options] The load options:\n   * - requestHeaders: an array of {name, value} to use as request headers.\n   * - withCredentials: credentials flag to pass to the request.\n   */\n  #loadImageUrls(urls, dataId, options) {\n    // create IO\n    const urlIO = new UrlsLoader();\n    urlIO.setDefaultCharacterSet(this.#defaultCharacterSet);\n    // load data\n    this.#loadData(urls, urlIO, 'image', dataId, options);\n  }\n\n  /**\n   * Load a State file.\n   *\n   * @param {File} file The state file to load.\n   * @param {string} dataId The data Id.\n   */\n  #loadStateFile(file, dataId) {\n    // create IO\n    const fileIO = new FilesLoader();\n    // load data\n    this.#loadData([file], fileIO, 'state', dataId);\n  }\n\n\n  /**\n   * Load a State url.\n   *\n   * @param {string} url The state url to load.\n   * @param {string} [dataId] The data Id.\n   * @param {object} [options] The load options:\n   * - requestHeaders: an array of {name, value} to use as request headers.\n   * - withCredentials: credentials flag to pass to the request.\n   */\n  #loadStateUrl(url, dataId, options) {\n    // create IO\n    const urlIO = new UrlsLoader();\n    // load data\n    this.#loadData([url], urlIO, 'state', dataId, options);\n  }\n\n  /**\n   * Load a list of data.\n   *\n   * @param {string[]|File[]|Array} data Array of data to load.\n   * @param {object} loader The data loader.\n   * @param {string} loadType The data load type: 'image' or 'state'.\n   * @param {string} dataId The data id.\n   * @param {object} [options] Options passed to the final loader.\n   */\n  #loadData(data, loader, loadType, dataId, options) {\n    const eventInfo = {\n      loadtype: loadType,\n      dataid: dataId\n    };\n\n    // set callbacks\n    loader.onloadstart = (event) => {\n      // store loader to allow abort\n      this.#currentLoaders[dataId] = {\n        loader: loader,\n        isFirstItem: true\n      };\n      // callback\n      this.#augmentCallbackEvent(this.onloadstart, eventInfo)(event);\n    };\n    loader.onprogress = this.#augmentCallbackEvent(this.onprogress, eventInfo);\n    loader.onloaditem = (event) => {\n      const eventInfoItem = {\n        loadtype: loadType,\n        dataid: dataId\n      };\n      if (typeof this.#currentLoaders[dataId] !== 'undefined') {\n        eventInfoItem.isfirstitem = this.#currentLoaders[dataId].isFirstItem;\n      }\n      // callback\n      this.#augmentCallbackEvent(this.onloaditem, eventInfoItem)(event);\n      // update loader\n      if (typeof this.#currentLoaders[dataId] !== 'undefined' &&\n        this.#currentLoaders[dataId].isFirstItem) {\n        this.#currentLoaders[dataId].isFirstItem = false;\n      }\n    };\n    loader.onload = this.#augmentCallbackEvent(this.onload, eventInfo);\n    loader.onloadend = (event) => {\n      // reset current loader\n      delete this.#currentLoaders[dataId];\n      // callback\n      this.#augmentCallbackEvent(this.onloadend, eventInfo)(event);\n    };\n    loader.onerror = this.#augmentCallbackEvent(this.onerror, eventInfo);\n    loader.onabort = this.#augmentCallbackEvent(this.onabort, eventInfo);\n    if (typeof loader.ontimeout !== 'undefined') {\n      loader.ontimeout = this.#augmentCallbackEvent(this.ontimeout, eventInfo);\n    }\n    // launch load\n    try {\n      loader.load(data, options);\n    } catch (error) {\n      this.onerror({\n        error: error,\n        dataid: dataId\n      });\n      this.onloadend({\n        dataid: dataId\n      });\n      return;\n    }\n  }\n\n  /**\n   * Augment a callback event: adds loadtype to the event\n   *  passed to a callback.\n   *\n   * @param {object} callback The callback to update.\n   * @param {object} info Info object to append to the event.\n   * @returns {object} A function representing the modified callback.\n   */\n  #augmentCallbackEvent(callback, info) {\n    return function (event) {\n      const keys = Object.keys(info);\n      for (let i = 0; i < keys.length; ++i) {\n        const key = keys[i];\n        event[key] = info[key];\n      }\n      callback(event);\n    };\n  }\n\n  /**\n   * Handle a load start event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load start event.\n   */\n  onloadstart(_event) {}\n\n  /**\n   * Handle a load progress event.\n   * Default does nothing.\n   *\n   * @param {object} _event The progress event.\n   */\n  onprogress(_event) {}\n\n  /**\n   * Handle a load event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when a file has been loaded successfully.\n   */\n  onload(_event) {}\n\n  /**\n   * Handle a load item event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load event fired\n   *   when an item has been loaded successfully.\n   */\n  onloaditem(_event) {}\n\n  /**\n   * Handle a load end event.\n   * Default does nothing.\n   *\n   * @param {object} _event The load end event fired\n   *  when a file load has completed, successfully or not.\n   */\n  onloadend(_event) {}\n\n  /**\n   * Handle an error event.\n   * Default does nothing.\n   *\n   * @param {object} _event The error event.\n   */\n  onerror(_event) {}\n\n  /**\n   * Handle a timeout event.\n   * Default does nothing.\n   *\n   * @param {object} _event The timeout event.\n   */\n  ontimeout(_event) {}\n\n  /**\n   * Handle an abort event.\n   * Default does nothing.\n   *\n   * @param {object} _event The abort event.\n   */\n  onabort(_event) {}\n\n} // class LoadController\n","import {ListenerHandler} from '../utils/listen.js';\nimport {getReverseOrientation} from '../dicom/dicomParser.js';\nimport {\n  getDateObj,\n  getTimeObj,\n  getDate\n} from '../dicom/dicomDate.js';\nimport {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {App} from '../app/application.js';\nimport {DataElement} from '../dicom/dataElement.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Info data item class.\n */\nexport class InfoDataItem {\n  /**\n   * List of tag keys.\n   *\n   * @type {string[]|undefined}\n   */\n  tags;\n  /**\n   * @type {string|undefined}\n   */\n  event;\n\n  /**\n   * @type {string}\n   */\n  pos;\n  /**\n   * @type {string}\n   */\n  format;\n  /**\n   * @type {string|undefined}\n   */\n  precision;\n\n  /**\n   * @type {string}\n   */\n  value;\n}\n\n/**\n * Get a number toprecision function with the provided precision.\n *\n * @param {number} precision The precision to achieve.\n * @returns {Function} The to precision function.\n */\nfunction getNumberToPrecision(precision) {\n  return function (num) {\n    return Number(num).toPrecision(precision);\n  };\n}\n\n/**\n * Create a default replace format from a given length.\n * For example: '{v0}, {v1}'.\n *\n * @param {number} length The length of the format.\n * @returns {string} A replace format.\n */\nfunction createDefaultReplaceFormat(length) {\n  let res = '';\n  for (let i = 0; i < length; ++i) {\n    if (i !== 0) {\n      res += ', ';\n    }\n    res += '{v' + i + '}';\n  }\n  return res;\n}\n\n/**\n * Replace flags in a input string. Flags are keywords surrounded with curly\n * braces in the form: '{v0}, {v1}'.\n *\n * @param {string} inputStr The input string.\n * @param {Array} values An array of values.\n * @example\n *    var values = [\"a\", \"b\"];\n *    var str = \"The length is: {v0}. The size is: {v1}\";\n *    var res = replaceFlags(str, values);\n *    // \"The length is: a. The size is: b\"\n * @returns {string} The result string.\n */\nfunction replaceFlags(inputStr, values) {\n  let res = inputStr;\n  for (let i = 0; i < values.length; ++i) {\n    res = res.replace('{v' + i + '}', values[i]);\n  }\n  return res;\n}\n\n/**\n * DICOM Header info data.\n */\nexport class InfoData {\n\n  /**\n   * Associated app.\n   *\n   * @type {App}\n   */\n  #app;\n\n  /**\n   * Associated data id.\n   *\n   * @type {string}\n   */\n  #dataId;\n\n  /**\n   * Info data config indexed by modality.\n   *\n   * @type {Object<string, InfoDataItem[]>}\n   */\n  #infoConfigs;\n\n  /**\n   * List of event used by the config.\n   *\n   * @type {string[]}\n   */\n  #eventNames = [];\n\n  /**\n   * Flag to know if listening to app.\n   *\n   * @type {boolean}\n   */\n  #isListening;\n\n  /**\n   * Meta data storage indexed by dataUid.\n   *\n   * @type {Object<string, InfoDataItem[]>|undefined}\n   */\n  #infoData = {};\n\n  /**\n   * Current data uid: set on pos change.\n   *\n   * @type {string}\n   */\n  #currentDataUid;\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * @param {App} app The associated application.\n   * @param {string} dataId The associated data id.\n   * @param {Object<string, InfoDataItem[]>} configs The info data config.\n   */\n  constructor(app, dataId, configs) {\n    this.#app = app;\n    this.#dataId = dataId;\n    this.#infoConfigs = configs;\n\n    // parse config to get the list of events to listen to\n    const keys = Object.keys(this.#infoConfigs);\n    for (let i = 0; i < keys.length; ++i) {\n      const modalityConfig = this.#infoConfigs[keys[i]];\n      for (const item of modalityConfig) {\n        const eventType = item.event;\n        if (typeof eventType !== 'undefined') {\n          if (!this.#eventNames.includes(eventType)) {\n            this.#eventNames.push(eventType);\n          }\n        }\n      }\n    }\n    // add app listeners\n    this.addAppListeners();\n  }\n\n  /**\n   * Reset the data.\n   */\n  reset() {\n    this.#infoData = {};\n    this.#currentDataUid = undefined;\n  }\n\n  /**\n   * Handle a new loaded item event.\n   *\n   * @param {Object<string, DataElement>} data The item meta data.\n   */\n  addItemMeta(data) {\n    // create and store info data\n    let dataUid;\n    // check if dicom data (00020010: transfer syntax)\n    if (typeof data['00020010'] !== 'undefined') {\n      if (typeof data['00080018'] !== 'undefined') {\n        // SOP instance UID\n        dataUid = data['00080018'].value[0];\n        this.#infoData[dataUid] = createInfoData(data, this.#infoConfigs);\n      } else {\n        logger.warn('Missing DICOM SOP instance UID for info data indexing');\n      }\n    } else {\n      // image file case\n      if (typeof data['imageUid'] !== 'undefined') {\n        dataUid = data['imageUid'].value[0];\n        this.#infoData[dataUid] = createInfoDataForDom(data, this.#infoConfigs);\n      } else {\n        logger.warn('Missing DOM image UID for info data indexing');\n      }\n    }\n    // store uid\n    if (typeof dataUid !== 'undefined') {\n      this.#currentDataUid = dataUid;\n    }\n  }\n\n  /**\n   * Handle a changed slice event.\n   *\n   * @param {object} event The slicechange event.\n   */\n  onSliceChange = (event) => {\n    if (event.dataid !== this.#dataId) {\n      return;\n    }\n    if (typeof event.data !== 'undefined' &&\n      typeof event.data.imageUid !== 'undefined' &&\n      this.#currentDataUid !== event.data.imageUid) {\n      this.#currentDataUid = event.data.imageUid;\n      this.#updateData(event);\n    }\n  };\n\n  /**\n   * Update the info data.\n   *\n   * @param {object} event An event defined by the info map and\n   *   registered in toggleListeners.\n   */\n  #updateData = (event) => {\n    if (typeof event.dataid !== 'undefined' &&\n      event.dataid !== this.#dataId) {\n      return;\n    }\n\n    const sliceInfoData = this.#infoData[this.#currentDataUid];\n    if (typeof sliceInfoData === 'undefined') {\n      console.warn('No slice info data for: ' + this.#currentDataUid);\n      return;\n    }\n\n    for (const infoDataItem of sliceInfoData) {\n      let text = undefined;\n      if (typeof infoDataItem.tags !== 'undefined') {\n        // update tags only on slice change\n        if (event.type === 'positionchange') {\n          text = infoDataItem.value;\n        }\n      } else {\n        // update text if the value is an event type\n        if (typeof infoDataItem.event !== 'undefined' &&\n          infoDataItem.event === event.type) {\n          const format = infoDataItem.format;\n          let values = event.value;\n          // optional number precision\n          if (typeof infoDataItem.precision !== 'undefined') {\n            let mapFunc = null;\n            if (infoDataItem.precision === 'round') {\n              mapFunc = Math.round;\n            } else {\n              mapFunc = getNumberToPrecision(\n                parseInt(infoDataItem.precision, 10)\n              );\n            }\n            values = values.map(mapFunc);\n          }\n          text = replaceFlags(format, values);\n        }\n      }\n      if (typeof text !== 'undefined') {\n        infoDataItem.value = text;\n      }\n    }\n\n    /**\n     * Value change event.\n     *\n     * @event InfoData#valuechange\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {InfoDataItem[]} data The value of the info data.\n     */\n    this.#fireEvent({\n      type: 'valuechange',\n      data: sliceInfoData\n    });\n  };\n\n  /**\n   * Is this class listening to app events.\n   *\n   * @returns {boolean} True is listening to app events.\n   */\n  isListening() {\n    return this.#isListening;\n  }\n\n  /**\n   * Toggle info listeners.\n   */\n  addAppListeners() {\n    // listen to update tags data\n    this.#app.addEventListener('positionchange', this.onSliceChange);\n    // add event listeners\n    for (const eventName of this.#eventNames) {\n      this.#app.addEventListener(eventName, this.#updateData);\n    }\n    // update flag\n    this.#isListening = true;\n  }\n\n  /**\n   * Toggle info listeners.\n   */\n  removeAppListeners() {\n    // stop listening to update tags data\n    this.#app.removeEventListener('positionchange', this.onSliceChange);\n    // remove event listeners\n    for (const eventName of this.#eventNames) {\n      this.#app.removeEventListener(eventName, this.#updateData);\n    }\n    // update flag\n    this.#isListening = false;\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {object} callback The method associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {object} callback The method associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent(event) {\n    this.#listenerHandler.fireEvent(event);\n  }\n\n} // class InfoData\n\n/**\n * Create info data array for a DICOM image.\n *\n * @param {object} dicomElements DICOM elements of the image.\n * @param {Object<string, InfoDataItem[]>} configs The info data configs.\n * @returns {InfoDataItem[]} Info data array.\n */\nfunction createInfoData(dicomElements, configs) {\n  const datas = [];\n  let modality;\n  const modElement = dicomElements['00080060'];\n  if (typeof modElement !== 'undefined') {\n    modality = modElement.value[0];\n  } else {\n    return datas;\n  }\n  const modalityConfigs = configs[modality] || configs['*'];\n  if (!modalityConfigs) {\n    return datas;\n  }\n\n  // transform a config item into data item by adding a value\n  for (const modalityConfig of modalityConfigs) {\n    // deep copy\n    const dataItem = JSON.parse(JSON.stringify(modalityConfig));\n\n    // add tag values\n    const tags = dataItem.tags;\n    if (typeof tags !== 'undefined' && tags.length !== 0) {\n      // get values\n      const values = [];\n      for (const tag of tags) {\n        const elem = dicomElements[tag];\n        if (typeof elem !== 'undefined') {\n          if (elem.vr === 'DA') {\n            const da = getDate(getDateObj(elem));\n            if (typeof da !== 'undefined') {\n              values.push(da.toLocaleDateString());\n            }\n          } else if (elem.vr === 'TM') {\n            const baseDateObj = {year: 1900, monthIndex: 0, day: 1};\n            const da = getDate(baseDateObj, getTimeObj(elem));\n            if (typeof da !== 'undefined') {\n              values.push(da.toLocaleTimeString());\n            }\n          } else {\n            values.push(elem.value);\n          }\n        } else {\n          values.push('undefined');\n        }\n      }\n      // format\n      if (typeof dataItem.format === 'undefined' || dataItem.format === null) {\n        dataItem.format = createDefaultReplaceFormat(values.length);\n      }\n      dataItem.value = replaceFlags(dataItem.format, values).trim();\n    }\n\n    // store\n    datas.push(dataItem);\n  }\n\n  // (0020,0020) Patient Orientation\n  const poElement = dicomElements['00200020'];\n  if (typeof poElement !== 'undefined' &&\n    poElement.value.length === 2\n  ) {\n    const po0 = poElement.value[0];\n    const po1 = poElement.value[1];\n    datas.push({\n      pos: 'cr', value: po0, format: '{v0}'\n    });\n    datas.push({\n      pos: 'cl', value: getReverseOrientation(po0), format: '{v0}'\n    });\n    datas.push({\n      pos: 'bc', value: po1, format: '{v0}'\n    });\n    datas.push({\n      pos: 'tc', value: getReverseOrientation(po1), format: '{v0}'\n    });\n  }\n\n  return datas;\n}\n\n/**\n * Create info data array for a DOM image.\n *\n * @param {object} domElements Meta data.\n * @param {Object<string, InfoDataItem[]>} configs The info data configs.\n * @returns {InfoDataItem[]} Info data array.\n */\nfunction createInfoDataForDom(domElements, configs) {\n  const datas = [];\n  const domConfigs = configs.DOM;\n  if (!domConfigs) {\n    return datas;\n  }\n\n  // transform a config item into data item by adding a value\n  for (const domConfig of domConfigs) {\n    // deep copy\n    const dataItem = JSON.parse(JSON.stringify(domConfig));\n\n    // add tag values\n    const tags = dataItem.tags;\n    if (typeof tags !== 'undefined' && tags.length !== 0) {\n      // get values\n      const values = [];\n      for (const tag of tags) {\n        const elem = domElements[tag];\n        if (typeof elem !== 'undefined') {\n          values.push(elem.value);\n        }\n      }\n      // format\n      if (typeof dataItem.format === 'undefined' || dataItem.format === null) {\n        dataItem.format = createDefaultReplaceFormat(values.length);\n      }\n      dataItem.value = replaceFlags(dataItem.format, values).trim();\n    }\n\n    // store\n    datas.push(dataItem);\n  }\n\n  return datas;\n}\n","import {viewEventNames} from '../image/view.js';\nimport {imageEventNames} from '../image/image.js';\nimport {annotationGroupEventNames} from '../image/annotationGroup.js';\nimport {dataEventNames} from '../app/dataController.js';\nimport {ViewFactory} from '../image/viewFactory.js';\nimport {\n  getMatrixFromName,\n  getOrientationStringLPS,\n  Orientation,\n  getViewOrientation\n} from '../math/orientation.js';\nimport {Point3D} from '../math/point.js';\nimport {Stage} from '../gui/stage.js';\nimport {Style} from '../gui/style.js';\nimport {getLayerDetailsFromLayerDivId} from '../gui/layerGroup.js';\nimport {ListenerHandler} from '../utils/listen.js';\nimport {State} from '../io/state.js';\nimport {logger} from '../utils/logger.js';\nimport {getUriQuery, decodeQuery} from '../utils/uri.js';\nimport {UndoStack} from '../utils/undoStack.js';\nimport {ToolboxController} from './toolboxController.js';\nimport {LoadController} from './loadController.js';\nimport {DataController} from './dataController.js';\nimport {InfoData} from '../gui/infoData.js';\nimport {\n  toolList,\n  defaultToolList,\n  toolOptions,\n  defaultToolOptions\n} from '../tools/index.js';\nimport {binderList} from '../gui/stage.js';\nimport {WindowLevel} from '../image/windowLevel.js';\nimport {PlaneHelper} from '../image/planeHelper.js';\nimport {AnnotationGroup} from '../image/annotationGroup.js';\nimport {konvaToAnnotation} from '../gui/drawLayer.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {LayerGroup} from '../gui/layerGroup.js';\nimport {ViewLayer} from '../gui/viewLayer.js';\nimport {DrawLayer} from '../gui/drawLayer.js';\nimport {Image} from '../image/image.js';\nimport {Matrix33} from '../math/matrix.js';\nimport {DataElement} from '../dicom/dataElement.js';\nimport {Scalar3D} from '../math/scalar.js';\nimport {DicomData} from './dataController.js';\nimport {Command} from '../utils/undoStack.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * View configuration: mainly defines the divId\n * of the associated HTML div.\n */\nexport class ViewConfig {\n  /**\n   * Associated HTML div id.\n   *\n   * @type {string}\n   */\n  divId;\n  /**\n   * Optional orientation of the data; 'axial', 'coronal' or 'sagittal'.\n   * If undefined, will use the data aquisition plane.\n   *\n   * @type {string|undefined}\n   */\n  orientation;\n  /**\n   * Optional view colour map name.\n   *\n   * @type {string|undefined}\n   */\n  colourMap;\n  /**\n   * Optional layer opacity; in [0, 1] range.\n   *\n   * @type {number|undefined}\n   */\n  opacity;\n  /**\n   * Optional segmentation layer fill opacity; in [0, 1] range.\n   *\n   * @type {number|undefined}\n   */\n  fillOpacity;\n  /**\n   * Optional segmentation contour thickness; in [0, 10] range.\n   *\n   * @type {number|undefined}\n   */\n  contourThickness;\n  /**\n   * Optional layer window level preset name.\n   * If present, the preset name will be used and\n   * the window centre and width ignored.\n   *\n   * @type {string|undefined}\n   */\n  wlPresetName;\n  /**\n   * Optional layer window center.\n   *\n   * @type {number|undefined}\n   */\n  windowCenter;\n  /**\n   * Optional layer window width.\n   *\n   * @type {number|undefined}\n   */\n  windowWidth;\n\n  /**\n   * @param {string} divId The associated HTML div id.\n   */\n  constructor(divId) {\n    this.divId = divId;\n  }\n}\n\n/**\n * Tool configuration.\n */\nexport class ToolConfig {\n  /**\n   * Optional tool options.\n   * For Draw: list of shape names.\n   * For Filter: list of filter names.\n   *\n   * @type {string[]|undefined}\n   */\n  options;\n\n  /**\n   * @param {string[]} [options] Optional tool options.\n   */\n  constructor(options) {\n    this.options = options;\n  }\n}\n\n/**\n * Application options.\n */\nexport class AppOptions {\n  /**\n   * DataId indexed object containing the data view configurations.\n   *\n   * @type {Object<string, ViewConfig[]>|undefined}\n   */\n  dataViewConfigs;\n  /**\n   * Tool name indexed object containing individual tool configurations.\n   *\n   * @type {Object<string, ToolConfig>|undefined}\n   */\n  tools;\n  /**\n   * Optional array of layerGroup binder names.\n   *\n   * @type {string[]|undefined}\n   */\n  binders;\n  /**\n   * Optional boolean flag to trigger the first data render\n   *   after the first loaded data or not. Defaults to true.\n   *\n   * @type {boolean|undefined}\n   */\n  viewOnFirstLoadItem;\n  /**\n   * Optional default chraracterset string used for DICOM parsing if\n   *   not passed in DICOM file.\n   *\n   * Valid values: {@link https://developer.mozilla.org/en-US/docs/Web/API/Encoding_API/Encodings}.\n   *\n   * @type {string|undefined}\n   */\n  defaultCharacterSet;\n  /**\n   * Optional overlay layer config.\n   *\n   * @type {object|undefined}\n   */\n  overlayConfig;\n  /**\n   * DOM root document.\n   *\n   * @type {DocumentFragment}\n   */\n  rootDocument;\n\n  /**\n   * @param {Object<string, ViewConfig[]>} [dataViewConfigs] Optional dataId\n   *   indexed object containing the data view configurations.\n   */\n  constructor(dataViewConfigs) {\n    this.dataViewConfigs = dataViewConfigs;\n  }\n}\n\n/**\n * List of ViewConfigs indexed by dataIds.\n *\n * @typedef {Object<string, ViewConfig[]>} DataViewConfigs\n */\n\n/**\n * Main application class.\n *\n * @example\n * import {App, AppOptions, ViewConfig} from '//esm.sh/dwv';\n * // create the dwv app\n * const app = new App();\n * // initialise\n * const viewConfig0 = new ViewConfig('layerGroup0');\n * const viewConfigs = {'*': [viewConfig0]};\n * const options = new AppOptions(viewConfigs);\n * app.init(options);\n * // load dicom data\n * app.loadURLs([\n *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\n * ]);\n */\nexport class App {\n\n  /**\n   * App options.\n   *\n   * @type {AppOptions}\n   */\n  #options = null;\n\n  /**\n   * Data controller.\n   *\n   * @type {DataController}\n   */\n  #dataController = null;\n\n  /**\n   * Toolbox controller.\n   *\n   * @type {ToolboxController}\n   */\n  #toolboxController = null;\n\n  /**\n   * Load controller.\n   *\n   * @type {LoadController}\n   */\n  #loadController = null;\n\n  /**\n   * Stage.\n   *\n   * @type {Stage}\n   */\n  #stage = null;\n\n  /**\n   * Undo stack.\n   *\n   * @type {UndoStack}\n   */\n  #undoStack = null;\n\n  /**\n   * Style.\n   *\n   * @type {Style}\n   */\n  #style = new Style();\n\n  /**\n   * Info datas.\n   *\n   * @type {Object<string, InfoData>}\n   */\n  #infoDatas = {};\n\n  /**\n   * Listener handler.\n   *\n   * @type {ListenerHandler}\n   */\n  #listenerHandler = new ListenerHandler();\n\n  /**\n   * Get a DicomData.\n   *\n   * @param {string} dataId The data id.\n   * @returns {DicomData|undefined} The data.\n   */\n  getData(dataId) {\n    return this.#dataController.get(dataId);\n  }\n\n  /**\n   * Get the image.\n   *\n   * @param {string} dataId The data id.\n   * @returns {Image|undefined} The associated image.\n   * @deprecated Since v0.34, please use the getData method.\n   */\n  getImage(dataId) {\n    let res;\n    if (typeof this.getData(dataId) !== 'undefined') {\n      res = this.getData(dataId).image;\n    }\n    return res;\n  }\n\n  /**\n   * Set the image at the given id.\n   *\n   * @param {string} dataId The data id.\n   * @param {Image} img The associated image.\n   */\n  setImage(dataId, img) {\n    this.#dataController.setImage(dataId, img);\n  }\n\n  /**\n   * Get the next data id.\n   *\n   * @returns {string} The data id.\n   */\n  getNextDataId() {\n    return this.#dataController.getNextDataId();\n  }\n\n  /**\n   * Add a new DicomData.\n   *\n   * @param {string} dataId The data id.\n   * @param {DicomData} data The new data.\n   * @returns {boolean} False if the data cannot be added.\n   */\n  addData(dataId, data) {\n    return this.#dataController.add(dataId, data);\n  }\n\n  /**\n   * Get the meta data.\n   *\n   * @param {string} dataId The data id.\n   * @returns {Object<string, DataElement>|undefined} The list of meta data.\n   */\n  getMetaData(dataId) {\n    let res;\n    if (typeof this.#dataController.get(dataId) !== 'undefined') {\n      res = this.#dataController.get(dataId).meta;\n    }\n    return res;\n  }\n\n  /**\n   * Get the list of ids in the data storage.\n   *\n   * @returns {string[]} The list of data ids.\n   */\n  getDataIds() {\n    return this.#dataController.getDataIds();\n  }\n\n  /**\n   * Get the list of dataIds that contain the input UIDs.\n   *\n   * @param {string[]} uids A list of UIDs.\n   * @returns {string[]} The list of dataIds that contain the UIDs.\n   */\n  getDataIdsFromSopUids(uids) {\n    return this.#dataController.getDataIdsFromSopUids(uids);\n  }\n\n  /**\n   * Get the first data id with the given SeriesInstanceUID.\n   *\n   * @param {string} uid The SeriesInstanceUID.\n   * @returns {string} The data id.\n   */\n  getDataIdFromSeriesUid(uid) {\n    return this.#dataController.getDataIdFromSeriesUid(uid);\n  }\n\n  /**\n   * Can the data (of the active view of the active layer) be scrolled?\n   *\n   * @returns {boolean} True if the data has a third dimension greater than one.\n   * @deprecated Since v0.33, please use the ViewController\n   *   equivalent directly instead.\n   */\n  canScroll() {\n    const viewLayer = this.#stage.getActiveLayerGroup().getActiveViewLayer();\n    const controller = viewLayer.getViewController();\n    return controller.canScroll();\n  }\n\n  /**\n   * Can window and level be applied to the data\n   * (of the active view of the active layer)?\n   *\n   * @returns {boolean} True if the data is monochrome.\n   * @deprecated Since v0.33, please use the ViewController\n   *   equivalent directly instead.\n   */\n  canWindowLevel() {\n    const viewLayer = this.#stage.getActiveLayerGroup().getActiveViewLayer();\n    const controller = viewLayer.getViewController();\n    return controller.canWindowLevel();\n  }\n\n  /**\n   * Get the active layer group scale on top of the base scale.\n   *\n   * @returns {Scalar3D} The scale as {x,y,z}.\n   */\n  getAddedScale() {\n    return this.#stage.getActiveLayerGroup().getAddedScale();\n  }\n\n  /**\n   * Get the base scale of the active layer group.\n   *\n   * @returns {Scalar3D} The scale as {x,y,z}.\n   */\n  getBaseScale() {\n    return this.#stage.getActiveLayerGroup().getBaseScale();\n  }\n\n  /**\n   * Get the layer offset of the active layer group.\n   *\n   * @returns {Scalar3D} The offset as {x,y,z}.\n   */\n  getOffset() {\n    return this.#stage.getActiveLayerGroup().getOffset();\n  }\n\n  /**\n   * Get the toolbox controller.\n   *\n   * @returns {ToolboxController} The controller.\n   */\n  getToolboxController() {\n    return this.#toolboxController;\n  }\n\n  /**\n   * Get the active layer group.\n   * The layer is available after the first loaded item.\n   *\n   * @returns {LayerGroup|undefined} The layer group.\n   */\n  getActiveLayerGroup() {\n    return this.#stage.getActiveLayerGroup();\n  }\n\n  /**\n   * Set the active layer group.\n   *\n   * @param {number} index The layer group index.\n   */\n  setActiveLayerGroup(index) {\n    this.#stage.setActiveLayerGroup(index);\n  }\n\n  /**\n   * Get the view layers associated to a data id.\n   * The layer are available after the first loaded item.\n   *\n   * @param {string} dataId The data id.\n   * @returns {ViewLayer[]} The layers.\n   */\n  getViewLayersByDataId(dataId) {\n    return this.#stage.getViewLayersByDataId(dataId);\n  }\n\n  /**\n   * Get a list of view layers according to an input callback function.\n   *\n   * @param {Function} [callbackFn] A function that takes\n   *   a ViewLayer as input and returns a boolean. If undefined,\n   *   returns all view layers.\n   * @returns {ViewLayer[]} The layers that\n   *   satisfy the callbackFn.\n   */\n  getViewLayers(callbackFn) {\n    return this.#stage.getViewLayers(callbackFn);\n  }\n\n  /**\n   * Get the draw layers associated to a data id.\n   * The layer are available after the first loaded item.\n   *\n   * @param {string} dataId The data id.\n   * @returns {DrawLayer[]} The layers.\n   */\n  getDrawLayersByDataId(dataId) {\n    return this.#stage.getDrawLayersByDataId(dataId);\n  }\n\n  /**\n   * Get a list of draw layers according to an input callback function.\n   *\n   * @param {Function} [callbackFn] A function that takes\n   *   a DrawLayer as input and returns a boolean. If undefined,\n   *   returns all draw layers.\n   * @returns {DrawLayer[]} The layers that\n   *   satisfy the callbackFn.\n   */\n  getDrawLayers(callbackFn) {\n    return this.#stage.getDrawLayers(callbackFn);\n  }\n\n  /**\n   * Get a layer group by div id.\n   * The layer is available after the first loaded item.\n   *\n   * @param {string} divId The div id.\n   * @returns {LayerGroup|undefined} The layer group.\n   */\n  getLayerGroupByDivId(divId) {\n    return this.#stage.getLayerGroupByDivId(divId);\n  }\n\n  /**\n   * Get the number of layer groups.\n   *\n   * @returns {number} The number of groups.\n   */\n  getNumberOfLayerGroups() {\n    return this.#stage.getNumberOfLayerGroups();\n  }\n\n  /**\n   * Get the app style.\n   *\n   * @returns {object} The app style.\n   */\n  getStyle() {\n    return this.#style;\n  }\n\n  /**\n   * Add a command to the undo stack.\n   *\n   * @param {Command} cmd The command to add.\n   * @fires UndoStack#undoadd\n   * @function\n   */\n  addToUndoStack = (cmd) => {\n    if (this.#undoStack !== null) {\n      this.#undoStack.add(cmd);\n    }\n  };\n\n  /**\n   * Remove a command from the undo stack.\n   *\n   * @param {string} name The name of the command to remove.\n   * @returns {boolean} True if the command was found and removed.\n   * @fires UndoStack#undoremove\n   * @function\n   */\n  removeFromUndoStack = (name) => {\n    let res = false;\n    if (this.#undoStack !== null) {\n      res = this.#undoStack.remove(name);\n    }\n    return res;\n  };\n\n  /**\n   * Initialise the application.\n   *\n   * @param {AppOptions} opt The application options.\n   * @example\n   * import {App, AppOptions, ViewConfig} from '//esm.sh/dwv';\n   * // create the dwv app\n   * const app = new App();\n   * // initialise\n   * const viewConfig0 = new ViewConfig('layerGroup0');\n   * const viewConfigs = {'*': [viewConfig0]};\n   * const options = new AppOptions(viewConfigs);\n   * options.viewOnFirstLoadItem = false;\n   * app.init(options);\n   * // render button\n   * const button = document.createElement('button');\n   * button.id = 'render';\n   * button.disabled = true;\n   * button.appendChild(document.createTextNode('render'));\n   * document.body.appendChild(button);\n   * app.addEventListener('load', function () {\n   *   const button = document.getElementById('render');\n   *   button.disabled = false;\n   *   button.onclick = function () {\n   *     // render data #0\n   *     app.render(0);\n   *   };\n   * });\n   * // load dicom data\n   * app.loadURLs([\n   *   'https://raw.githubusercontent.com/ivmartel/dwv/master/tests/data/bbmri-53323851.dcm'\n   * ]);\n   */\n  init(opt) {\n    // store\n    this.#options = opt;\n    // defaults\n    if (typeof this.#options.viewOnFirstLoadItem === 'undefined') {\n      this.#options.viewOnFirstLoadItem = true;\n    }\n    if (typeof this.#options.dataViewConfigs === 'undefined') {\n      this.#options.dataViewConfigs = {};\n    }\n    if (typeof this.#options.rootDocument === 'undefined' &&\n      typeof document !== 'undefined'\n    ) {\n      this.#options.rootDocument = document;\n    }\n\n    // undo stack\n    this.#undoStack = new UndoStack();\n    this.#undoStack.addEventListener('undoadd', this.#fireEvent);\n    this.#undoStack.addEventListener('undo', this.#fireEvent);\n    this.#undoStack.addEventListener('redo', this.#fireEvent);\n\n    // tools\n    if (typeof this.#options.tools !== 'undefined') {\n      // setup the tool list\n      const appToolList = {};\n      const keys = Object.keys(this.#options.tools);\n      for (let t = 0; t < keys.length; ++t) {\n        const toolName = keys[t];\n        // find the tool in the default tool list\n        let toolClass = defaultToolList[toolName];\n        // or use external one\n        if (typeof toolClass === 'undefined') {\n          toolClass = toolList[toolName];\n        }\n        if (typeof toolClass !== 'undefined') {\n          // create tool instance\n          appToolList[toolName] = new toolClass(this);\n          // register listeners\n          if (typeof appToolList[toolName].addEventListener !== 'undefined') {\n            const names = appToolList[toolName].getEventNames();\n            for (let j = 0; j < names.length; ++j) {\n              appToolList[toolName].addEventListener(names[j], this.#fireEvent);\n            }\n          }\n          // tool options\n          const toolParams = this.#options.tools[toolName];\n          if (typeof toolParams.options !== 'undefined' &&\n            toolParams.options.length !== 0) {\n            let type = 'raw';\n            if (typeof appToolList[toolName].getOptionsType !== 'undefined') {\n              type = appToolList[toolName].getOptionsType();\n            }\n            let appToolOptions;\n            if (type === 'instance' || type === 'factory') {\n              appToolOptions = {};\n              for (let i = 0; i < toolParams.options.length; ++i) {\n                const optionName = toolParams.options[i];\n                let optionClassName = optionName;\n                if (type === 'factory') {\n                  optionClassName += 'Factory';\n                }\n                const toolNamespace = toolName.charAt(0).toLowerCase() +\n                  toolName.slice(1);\n                // find the option in the external tool list\n                let tOptions = toolOptions[toolNamespace];\n                let optionClass;\n                if (typeof tOptions !== 'undefined') {\n                  optionClass = tOptions[optionClassName];\n                }\n                // or use the default one\n                if (typeof optionClass === 'undefined') {\n                  tOptions = defaultToolOptions[toolNamespace];\n                  if (typeof tOptions !== 'undefined') {\n                    optionClass = tOptions[optionClassName];\n                  }\n                }\n                if (typeof optionClass !== 'undefined') {\n                  appToolOptions[optionName] = optionClass;\n                } else {\n                  logger.warn('Could not find option class for: ' +\n                    optionName);\n                }\n              }\n            } else {\n              appToolOptions = toolParams.options;\n            }\n            appToolList[toolName].setOptions(appToolOptions);\n          }\n        } else {\n          logger.warn('Could not initialise unknown tool: ' + toolName);\n        }\n      }\n      // add tools to the controller\n      this.#toolboxController = new ToolboxController(appToolList);\n    }\n\n    // create load controller\n    this.#loadController =\n      new LoadController(this.#options.defaultCharacterSet);\n    this.#loadController.onloadstart = this.#onloadstart;\n    this.#loadController.onprogress = this.#onloadprogress;\n    this.#loadController.onloaditem = this.#onloaditem;\n    this.#loadController.onload = this.#onload;\n    this.#loadController.onloadend = this.#onloadend;\n    this.#loadController.onerror = this.#onloaderror;\n    this.#loadController.ontimeout = this.#onloadtimeout;\n    this.#loadController.onabort = this.#onloadabort;\n\n    // create data controller\n    this.#dataController = new DataController();\n    // propagate data events\n    for (const eventName of dataEventNames) {\n      this.#dataController.addEventListener(eventName, this.#fireEvent);\n    }\n    // propage image events\n    for (const eventName of imageEventNames) {\n      this.#dataController.addEventListener(eventName, this.#fireEvent);\n    }\n    // propage annotation events\n    for (const eventName of annotationGroupEventNames) {\n      this.#dataController.addEventListener(eventName, this.#fireEvent);\n    }\n    // create stage\n    this.#stage = new Stage();\n    if (typeof this.#options.binders !== 'undefined') {\n      this.#stage.setBinders(this.#options.binders);\n    }\n  }\n\n  /**\n   * Reset the application.\n   */\n  reset() {\n    // clear objects\n    this.#stage.empty();\n    this.#infoDatas = {};\n    // reset undo/redo\n    if (this.#undoStack) {\n      this.#undoStack = new UndoStack();\n      this.#undoStack.addEventListener('undoadd', this.#fireEvent);\n      this.#undoStack.addEventListener('undo', this.#fireEvent);\n      this.#undoStack.addEventListener('redo', this.#fireEvent);\n    }\n  }\n\n  /**\n   * Reset the layout of the application.\n   *\n   * @deprecated Since v0.35, prefer resetZoomPan.\n   */\n  resetLayout() {\n    this.#stage.reset();\n    this.#stage.draw();\n  }\n\n  /**\n   * Reset the zoom and pan of the stage.\n   */\n  resetZoomPan() {\n    this.#stage.resetZoomPan();\n    this.#stage.draw();\n  }\n\n  /**\n   * Reset the position and window level of the stage.\n   */\n  resetViews() {\n    this.#stage.resetViews();\n  }\n\n  /**\n   * Add an event listener to this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type, will be called with the fired event.\n   */\n  addEventListener(type, callback) {\n    this.#listenerHandler.add(type, callback);\n  }\n\n  /**\n   * Remove an event listener from this class.\n   *\n   * @param {string} type The event type.\n   * @param {Function} callback The function associated with the provided\n   *   event type.\n   */\n  removeEventListener(type, callback) {\n    this.#listenerHandler.remove(type, callback);\n  }\n\n  // load API [begin] -------------------------------------------------------\n\n  /**\n   * Load a list of files. Can be image files or a state file.\n   *\n   * @param {File[]} files The list of files to load.\n   * @returns {string} The data ID, '-1' if problem.\n   * @fires App#loadstart\n   * @fires App#loadprogress\n   * @fires App#loaditem\n   * @fires App#loadend\n   * @fires App#error\n   * @fires App#abort\n   * @function\n   */\n  loadFiles = (files) => {\n    if (files.length === 0) {\n      logger.warn('Ignoring empty input file list.');\n      return '-1';\n    }\n    const dataId = this.#dataController.getNextDataId();\n    this.#loadController.loadFiles(files, dataId);\n    return dataId;\n  };\n\n  /**\n   * Load a list of URLs. Can be image files or a state file.\n   *\n   * @param {string[]} urls The list of urls to load.\n   * @param {object} [options] The options object, can contain:\n   * - requestHeaders: an array of {name, value} to use as request headers,\n   * - withCredentials: boolean xhr.withCredentials flag to pass to the request,\n   * - batchSize: the size of the request url batch.\n   * @returns {string} The data ID, '-1' if problem.\n   * @fires App#loadstart\n   * @fires App#loadprogress\n   * @fires App#loaditem\n   * @fires App#loadend\n   * @fires App#error\n   * @fires App#abort\n   * @function\n   */\n  loadURLs = (urls, options) => {\n    if (urls.length === 0) {\n      logger.warn('Ignoring empty input url list.');\n      return '-1';\n    }\n    const dataId = this.#dataController.getNextDataId();\n    this.#loadController.loadURLs(urls, dataId, options);\n    return dataId;\n  };\n\n  /**\n   * Load from an input uri.\n   *\n   * @param {string} uri The input uri, for example: 'window.location.href'.\n   * @param {object} [options] Optional url request options.\n   * @deprecated Since v0.36, please extract the file list and\n   *   pass it to loadURLs. State from uri is no longer supported.\n   * @function\n   */\n  loadFromUri = (uri, options) => {\n    const query = getUriQuery(uri);\n    // check query\n    if (query && typeof query.input !== 'undefined') {\n      // load base image\n      decodeQuery(query, this.loadURLs, options);\n    }\n    // no else to allow for empty uris\n  };\n\n  /**\n   * Load a list of ArrayBuffers.\n   *\n   * @param {Array} data The list of ArrayBuffers to load\n   *   in the form of [{name: \"\", filename: \"\", data: data}].\n   * @returns {string} The data ID.\n   * @fires App#loadstart\n   * @fires App#loadprogress\n   * @fires App#loaditem\n   * @fires App#loadend\n   * @fires App#error\n   * @fires App#abort\n   * @function\n   */\n  loadImageObject = (data) => {\n    const dataId = this.#dataController.getNextDataId();\n    this.#loadController.loadImageObject(data, dataId);\n    return dataId;\n  };\n\n  /**\n   * Abort all the current loads.\n   */\n  abortAllLoads() {\n    const ids = this.#loadController.getLoadingDataIds();\n    for (const id of ids) {\n      this.abortLoad(id);\n    }\n  }\n\n  /**\n   * Abort an individual data load.\n   *\n   * @param {string} dataId The data to stop loading.\n   */\n  abortLoad(dataId) {\n    // abort load\n    this.#loadController.abort(dataId);\n    // remove data\n    this.#dataController.remove(dataId);\n    // clean up stage\n    this.#stage.removeLayersByDataId(dataId);\n  }\n\n  // load API [end] ---------------------------------------------------------\n\n  /**\n   * Fit the display to the data of each layer group.\n   * To be called once the image is loaded.\n   */\n  fitToContainer() {\n    this.#stage.fitToContainer();\n  }\n\n  /**\n   * Init the Window/Level display\n   * (of the active layer of the active layer group).\n   *\n   * @deprecated Since v0.33, please set the opacity\n   *   of the desired view layer directly.\n   */\n  initWLDisplay() {\n    const viewLayer = this.#stage.getActiveLayerGroup().getActiveViewLayer();\n    const controller = viewLayer.getViewController();\n    controller.initialise();\n  }\n\n  /**\n   * Set the imageSmoothing flag value. Default is false.\n   *\n   * @param {boolean} flag True to enable smoothing.\n   */\n  setImageSmoothing(flag) {\n    this.#stage.setImageSmoothing(flag);\n    this.#stage.draw();\n  }\n\n  /**\n   * Get the layer group configuration from a data id.\n   *\n   * @param {string} dataId The data id.\n   * @param {boolean} [excludeStarConfig] Exclude the star config\n   *  (default to false).\n   * @returns {ViewConfig[]} The list of associated configs.\n   */\n  getViewConfigs(dataId, excludeStarConfig) {\n    if (typeof excludeStarConfig === 'undefined') {\n      excludeStarConfig = false;\n    }\n    // check options\n    if (this.#options.dataViewConfigs === null ||\n      typeof this.#options.dataViewConfigs === 'undefined') {\n      throw new Error('No available data view configuration');\n    }\n    let configs = [];\n    if (typeof this.#options.dataViewConfigs[dataId] !== 'undefined') {\n      configs = this.#options.dataViewConfigs[dataId];\n    } else if (!excludeStarConfig &&\n      typeof this.#options.dataViewConfigs['*'] !== 'undefined') {\n      configs = this.#options.dataViewConfigs['*'];\n    }\n    return configs;\n  }\n\n  /**\n   * Get the layer group configuration for a data id and group\n   * div id.\n   *\n   * @param {string} dataId The data id.\n   * @param {string} groupDivId The layer group div id.\n   * @param {boolean} [excludeStarConfig] Exclude the star config\n   *  (default to false).\n   * @returns {ViewConfig|undefined} The associated config.\n   */\n  getViewConfig(dataId, groupDivId, excludeStarConfig) {\n    const configs = this.getViewConfigs(dataId, excludeStarConfig);\n    return configs.find(function (item) {\n      return item.divId === groupDivId;\n    });\n  }\n\n  /**\n   * Get the data view config.\n   * Carefull, returns a reference, do not modify without resetting.\n   *\n   * @returns {Object<string, ViewConfig[]>} The configuration list.\n   */\n  getDataViewConfigs() {\n    return this.#options.dataViewConfigs;\n  }\n\n  /**\n   * Set the data view configuration.\n   * Resets the stage and recreates all the views.\n   *\n   * @param {Object<string, ViewConfig[]>} configs The configuration list.\n   */\n  setDataViewConfigs(configs) {\n    // clean up\n    this.#stage.empty();\n    // set new\n    this.#options.dataViewConfigs = configs;\n    // create layer groups\n    this.#createLayerGroups(configs);\n  }\n\n  /**\n   * Add a data view config.\n   *\n   * @param {string} dataId The data id.\n   * @param {ViewConfig} config The view configuration.\n   * @param {boolean} [doRender] Render data after configuration\n   *   add. Defaults to true.\n   */\n  addDataViewConfig(dataId, config, doRender) {\n    if (typeof doRender === 'undefined') {\n      doRender = true;\n    }\n    // add to list\n    const configs = this.#options.dataViewConfigs;\n    if (typeof configs[dataId] === 'undefined') {\n      configs[dataId] = [];\n    }\n    const equalDivId = function (item) {\n      return item.divId === config.divId;\n    };\n    const itemIndex = configs[dataId].findIndex(equalDivId);\n    if (itemIndex === -1) {\n      this.#options.dataViewConfigs[dataId].push(config);\n    } else {\n      throw new Error('Duplicate view config for data ' + dataId +\n        ' and div ' + config.divId);\n    }\n\n    // add layer group if not done\n    if (typeof this.#stage.getLayerGroupByDivId(config.divId) === 'undefined') {\n      this.#createLayerGroup(config);\n    }\n\n    // render (will create layers)\n    if (typeof this.#dataController.get(dataId) !== 'undefined' &&\n      doRender) {\n      this.render(dataId, [config]);\n    }\n  }\n\n  /**\n   * Remove a data view config.\n   * Removes the associated layer if found, removes\n   *   the layer group if empty.\n   *\n   * @param {string} dataId The data id.\n   * @param {string} divId The div id.\n   */\n  removeDataViewConfig(dataId, divId) {\n    // input checks\n    const configs = this.#options.dataViewConfigs;\n    if (typeof configs[dataId] === 'undefined') {\n      // no config for dataId\n      return;\n    }\n    const equalDivId = function (item) {\n      return item.divId === divId;\n    };\n    const itemIndex = configs[dataId].findIndex(equalDivId);\n    if (itemIndex === -1) {\n      // no config for divId\n      return;\n    }\n\n    // remove from config list\n    configs[dataId].splice(itemIndex, 1);\n    if (configs[dataId].length === 0) {\n      delete configs[dataId];\n    }\n\n    // update layer group\n    const layerGroup = this.#stage.getLayerGroupByDivId(divId);\n    if (typeof layerGroup !== 'undefined') {\n      // remove layer if possible\n      const vls = layerGroup.getViewLayersByDataId(dataId);\n      if (vls.length === 1) {\n        layerGroup.removeLayer(vls[0]);\n      }\n      const dls = layerGroup.getDrawLayersByDataId(dataId);\n      if (dls.length === 1) {\n        layerGroup.removeLayer(dls[0]);\n      }\n      // remove layer group if empty\n      if (layerGroup.getNumberOfLayers() === 0) {\n        this.#stage.removeLayerGroup(layerGroup);\n      }\n    }\n  }\n\n  /**\n   * Update an existing data view config.\n   * Removes and re-creates the layer if found.\n   *\n   * @param {string} dataId The data id.\n   * @param {string} divId The div id.\n   * @param {ViewConfig} config The view configuration.\n   */\n  updateDataViewConfig(dataId, divId, config) {\n    // input checks\n    const configs = this.#options.dataViewConfigs;\n    // check data id\n    if (typeof configs[dataId] === 'undefined') {\n      throw new Error('No config for dataId: ' + dataId);\n    }\n    // check div id\n    const equalDivId = function (item) {\n      return item.divId === divId;\n    };\n    const itemIndex = configs[dataId].findIndex(equalDivId);\n    if (itemIndex === -1) {\n      throw new Error('No config for dataId: ' +\n        dataId + ' and divId: ' + divId);\n    }\n\n    // update config\n    const configToUpdate = configs[dataId][itemIndex];\n    for (const prop in config) {\n      configToUpdate[prop] = config[prop];\n    }\n\n    // update layer group\n    const layerGroup = this.#stage.getLayerGroupByDivId(configToUpdate.divId);\n    if (typeof layerGroup !== 'undefined') {\n      // remove layer if possible\n      const vls = layerGroup.getViewLayersByDataId(dataId);\n      if (vls.length === 1) {\n        layerGroup.removeLayer(vls[0]);\n      }\n      const dls = layerGroup.getDrawLayersByDataId(dataId);\n      if (dls.length === 1) {\n        layerGroup.removeLayer(dls[0]);\n      }\n    }\n\n    // render (will create layer)\n    if (typeof this.#dataController.get(dataId) !== 'undefined') {\n      this.render(dataId, [configToUpdate]);\n    }\n  }\n\n  /**\n   * Create layer groups according to a data view config:\n   * adds them to stage and binds them.\n   *\n   * @param {DataViewConfigs} dataViewConfigs The data view config.\n   */\n  #createLayerGroups(dataViewConfigs) {\n    const dataKeys = Object.keys(dataViewConfigs);\n    const divIds = [];\n    for (let i = 0; i < dataKeys.length; ++i) {\n      const viewConfigs = dataViewConfigs[dataKeys[i]];\n      for (let j = 0; j < viewConfigs.length; ++j) {\n        const viewConfig = viewConfigs[j];\n        // view configs can contain the same divIds, avoid duplicating\n        if (!divIds.includes(viewConfig.divId)) {\n          this.#createLayerGroup(viewConfig);\n          divIds.push(viewConfig.divId);\n        }\n      }\n    }\n  }\n\n  /**\n   * Create a layer group according to a view config:\n   * adds it to stage and binds it.\n   *\n   * @param {ViewConfig} viewConfig The view config.\n   */\n  #createLayerGroup(viewConfig) {\n    // create new layer group\n    const element = this.#options.rootDocument.getElementById(viewConfig.divId);\n    const withInfoOverlay = typeof this.#options.overlayConfig !== 'undefined';\n    const layerGroup = this.#stage.addLayerGroup(element, withInfoOverlay);\n    // bind events\n    this.#bindLayerGroupToApp(layerGroup);\n  }\n\n  /**\n   * Set the layer groups binders.\n   *\n   * @param {string[]} list The list of binder names.\n   */\n  setLayerGroupsBinders(list) {\n    // create instances\n    const instances = [];\n    for (let i = 0; i < list.length; ++i) {\n      if (typeof binderList[list[i]] !== 'undefined') {\n        instances.push(new binderList[list[i]]);\n      }\n    }\n    // pass to stage\n    this.#stage.setBinders(instances);\n  }\n\n  /**\n   * Check if a data can be rendered in a provided layer group.\n   * If the layer group contains data, only similar orientation\n   * are permited. If not, returns true.\n   *\n   * @param {string} dataId The id of the data to check.\n   * @param {LayerGroup} layerGroup The layer group where to render.\n   * @returns {boolean} True if the data can be rendered.\n   */\n  #canRenderData(dataId, layerGroup) {\n    let res = false;\n    const baseViewLayer = layerGroup.getBaseViewLayer();\n    if (typeof baseViewLayer !== 'undefined') {\n      // base view exists: render is possible if overlay data\n      // has similar geometry than base\n      const baseData = this.#dataController.get(baseViewLayer.getDataId());\n      const baseImage = baseData.image;\n      const newData = this.#dataController.get(dataId);\n      const newImage = newData.image;\n      if (typeof baseImage !== 'undefined' &&\n        typeof newImage !== 'undefined'\n      ) {\n        const baseOrientation = baseImage.getGeometry().getOrientation();\n        const newOrientation = newImage.getGeometry().getOrientation();\n        res = newOrientation.isSimilar(baseOrientation);\n      }\n    } else {\n      // no base view: can render\n      res = true;\n    }\n    return res;\n  }\n\n  /**\n   * Render the current data.\n   *\n   * @param {string} dataId The data id to render.\n   * @param {ViewConfig[]} [viewConfigs] The list of configs to render.\n   */\n  render(dataId, viewConfigs) {\n    if (typeof dataId === 'undefined' || dataId === null) {\n      throw new Error('Cannot render without data id');\n    }\n    const data = this.getData(dataId);\n\n    // guess data type\n    const isImage = typeof data !== 'undefined' &&\n      typeof data.image !== 'undefined';\n    const isMeasurement = typeof data !== 'undefined' &&\n      typeof data.annotationGroup !== 'undefined';\n\n    // create layer groups if not done yet\n    // (create all to allow for ratio sync)\n    if (this.#stage.getNumberOfLayerGroups() === 0) {\n      this.#createLayerGroups(this.#options.dataViewConfigs);\n    }\n\n    // use options list if non provided\n    if (typeof viewConfigs === 'undefined') {\n      viewConfigs = this.getViewConfigs(dataId);\n    }\n\n    // nothing to do if no view config\n    if (viewConfigs.length === 0) {\n      logger.info('Not rendering data: ' + dataId +\n        ' (no data view config)');\n      return;\n    }\n\n    // loop on configs\n    for (let i = 0; i < viewConfigs.length; ++i) {\n      const config = viewConfigs[i];\n      const layerGroup =\n        this.#stage.getLayerGroupByDivId(config.divId);\n      // layer group must exist\n      if (!layerGroup) {\n        throw new Error('No layer group for ' + config.divId);\n      }\n      // check compatibility\n      if (isImage && !this.#canRenderData(dataId, layerGroup)) {\n        // fire render error\n        this.#fireEvent({\n          type: 'error',\n          error: new Error('Render error: incompatible geometries for overlay'),\n          dataid: dataId\n        });\n        continue;\n      }\n      // create layer if needed\n      // warn: needs a loaded DOM\n      if (isImage &&\n        layerGroup.getViewLayersByDataId(dataId).length === 0\n      ) {\n        this.#addViewLayer(dataId, config);\n      } else if (isMeasurement &&\n        layerGroup.getDrawLayersByDataId(dataId).length === 0\n      ) {\n        this.addDrawLayer(dataId, config);\n      }\n      // draw\n      layerGroup.draw();\n    }\n  }\n\n  /**\n   * Zoom the layers of the active layer group.\n   *\n   * @param {number} step The step to add to the current zoom.\n   * @param {number} cx The zoom center X coordinate.\n   * @param {number} cy The zoom center Y coordinate.\n   */\n  zoom(step, cx, cy) {\n    const layerGroup = this.#stage.getActiveLayerGroup();\n    const viewController = layerGroup.getBaseViewLayer().getViewController();\n    const k = viewController.getCurrentScrollPosition();\n    const center = new Point3D(cx, cy, k);\n    layerGroup.addScale(step, center);\n    layerGroup.draw();\n  }\n\n  /**\n   * Apply a translation to the layers of the active layer group.\n   *\n   * @param {number} tx The translation along X.\n   * @param {number} ty The translation along Y.\n   */\n  translate(tx, ty) {\n    const layerGroup = this.#stage.getActiveLayerGroup();\n    layerGroup.addTranslation({x: tx, y: ty, z: 0});\n    layerGroup.draw();\n  }\n\n  /**\n   * Resample one image to match the orientation of another.\n   *\n   * @param {string} dataIdTarget The target image id to resample.\n   * @param {string} dataIdSource The source image id to copy the\n   *  orientation from.\n   */\n  resampleMatch(dataIdTarget, dataIdSource) {\n    // target (to do orientation check)\n    const targetData = this.#dataController.get(dataIdTarget);\n    if (typeof targetData === 'undefined') {\n      logger.debug(\n        'Cannot resample match, target data \\'' +\n        dataIdTarget + '\\' is undefined');\n      return;\n    }\n    if (typeof targetData.image === 'undefined') {\n      logger.debug(\n        'Cannot resample match, target image \\'' +\n        dataIdTarget + '\\' is undefined');\n      return;\n    }\n    // source\n    const sourceData = this.#dataController.get(dataIdSource);\n    if (typeof sourceData === 'undefined') {\n      logger.debug(\n        'Cannot resample match, source data \\'' +\n        dataIdSource + '\\' is undefined');\n      return;\n    }\n    if (typeof sourceData.image === 'undefined') {\n      logger.debug(\n        'Cannot resample match, source image \\'' +\n        dataIdSource + '\\' is undefined');\n      return;\n    }\n    // check orientation\n    const targetOrientation =\n      targetData.image.getGeometry().getOrientation();\n    const sourceOrientation =\n      sourceData.image.getGeometry().getOrientation();\n    if (targetOrientation.equals(sourceOrientation)) {\n      logger.info(\n        'Same orientation, no resample match for data \\'' +\n        dataIdTarget + '\\' and \\'' + dataIdSource + '\\'');\n      return;\n    }\n    // resample\n    this.resample(dataIdTarget, sourceOrientation);\n  }\n\n  /**\n   * Resample an image to match an arbitrary orientation.\n   *\n   * @param {string} dataIdTarget The target image id to resample.\n   * @param {Matrix33} orientation The orientation to resample to.\n   */\n  resample(dataIdTarget, orientation) {\n    // target\n    const targetData = this.#dataController.get(dataIdTarget);\n    if (typeof targetData === 'undefined') {\n      logger.debug(\n        'Cannot resample, target data \\'' +\n        dataIdTarget + '\\' is undefined');\n      return;\n    }\n    if (typeof targetData.image === 'undefined') {\n      logger.debug(\n        'Cannot resample, target image \\'' +\n        dataIdTarget + '\\' is undefined');\n      return;\n    }\n    // check orientation\n    const targetOrientation =\n      targetData.image.getGeometry().getOrientation();\n    if (targetOrientation.equals(orientation)) {\n      logger.info(\n        'Same orientation, no resample for data \\'' +\n        dataIdTarget + '\\'');\n      return;\n    }\n\n    targetData.image.resample(orientation);\n\n    const configs = this.#options.dataViewConfigs;\n\n    const metaTarget = targetData.image.getMeta();\n    const dataIds = this.#dataController.getDataIds();\n    for (let i = 0; i < dataIds.length; i++) {\n      const data = this.#dataController.get(dataIds[i]);\n\n      const meta = data.image.getMeta();\n      if (meta.Modality === 'SEG' &&\n        meta.SeriesInstanceUID === metaTarget.SeriesInstanceUID) {\n        this.#dataController.stash(dataIds[i]);\n      }\n    }\n\n    // the image drastically changed, it is much easier to just\n    // take the view config and forcefully re-initialize it\n\n    // Only updating the configs of the affected images can cause\n    // layers to inherit some configs from their segmentation layers\n    // for some unknown reason. For now we just update all of them.\n    this.setDataViewConfigs(configs);\n    // render data (creates layers)\n    const newDataIds = this.#dataController.getDataIds();\n    for (let i = 0; i < newDataIds.length; ++i) {\n      this.render(newDataIds[i]);\n    }\n  }\n\n  /**\n   * Revert an image back to its original orientation.\n   *\n   * @param {string} dataIdTarget The target image id to revert.\n   */\n  revertResample(dataIdTarget) {\n    const targetData = this.#dataController.get(dataIdTarget);\n    if (typeof targetData === 'undefined') {\n      logger.debug(\n        'Cannot revert resample, target data \\'' +\n        dataIdTarget + '\\' is undefined');\n      return;\n    }\n    if (typeof targetData.image === 'undefined') {\n      logger.debug(\n        'Cannot revert resample, target image \\'' +\n        dataIdTarget + '\\' is undefined');\n      return;\n    }\n    // exit if not resampled\n    if (!targetData.image.isResampled()) {\n      logger.info(\n        'No revert resample needed for data \\'' +\n        dataIdTarget + '\\'');\n      return;\n    }\n\n    targetData.image.revert();\n\n    const configs = this.#options.dataViewConfigs;\n\n    const metaTarget = targetData.image.getMeta();\n    const dataIds = this.#dataController.getStashedDataIds();\n    for (let i = 0; i < dataIds.length; i++) {\n      const data = this.#dataController.getStashed(dataIds[i]);\n\n      const meta = data.image.getMeta();\n      if (meta.Modality === 'SEG' &&\n        meta.SeriesInstanceUID === metaTarget.SeriesInstanceUID) {\n        this.#dataController.unstash(dataIds[i]);\n      }\n    }\n\n    // the image drastically changed, it is much easier to just\n    // take the view config and forcefully re-initialize it\n\n    // Only updating the configs of the affected images can cause\n    // layers to inherit some configs from their segmentation layers\n    // for some unknown reason. For now we just update all of them.\n    this.setDataViewConfigs(configs);\n    // render data (creates layers)\n    const newDataIds = this.#dataController.getDataIds();\n    for (let i = 0; i < newDataIds.length; ++i) {\n      this.render(newDataIds[i]);\n    }\n  }\n\n  /**\n   * Set the active view layer (of the active layer group) opacity.\n   *\n   * @param {number} alpha The opacity ([0:1] range).\n   * @deprecated Since v0.33, pplease set the opacity\n   *   of the desired view layer directly.\n   */\n  setOpacity(alpha) {\n    const viewLayer = this.#stage.getActiveLayerGroup().getActiveViewLayer();\n    viewLayer.setOpacity(alpha);\n    viewLayer.draw();\n  }\n\n  /**\n   * Set the drawings of the active layer group.\n   *\n   * @deprecated Since v0.34, please switch to DICOM SR annotations.\n   * @param {Array} drawings An array of drawings.\n   * @param {Array} drawingsDetails An array of drawings details.\n   * @param {string} dataId The converted data id.\n   */\n  setDrawings(drawings, drawingsDetails, dataId) {\n    const layerGroup = this.#stage.getActiveLayerGroup();\n    const viewLayer = layerGroup.getBaseViewLayer();\n    const refDataId = viewLayer.getDataId();\n    const refData = this.getData(refDataId);\n    const viewController = viewLayer.getViewController();\n\n    // convert konva to annotation\n    // (assume current image is ref image)\n    const annotations = konvaToAnnotation(\n      drawings, drawingsDetails, refData.image);\n    // create data\n    const data = this.createAnnotationData(refDataId);\n    // add annotations to data\n    for (const annotation of annotations) {\n      annotation.setViewController(viewController);\n      data.annotationGroup.add(annotation);\n    }\n    // add to data controller\n    this.#dataController.add(dataId, data);\n    // render\n    this.render(dataId);\n  }\n\n  /**\n   * Apply a JSON state to this app.\n   *\n   * @deprecated Since v0.34, please switch to DICOM SR\n   *   for annotations.\n   * @param {string} jsonState The state of the app as a JSON string.\n   * @param {string} dataId The state data id.\n   */\n  applyJsonState(jsonState, dataId) {\n    const state = new State(dataId);\n    state.apply(this, state.fromJSON(jsonState));\n  }\n\n  // Handler Methods -----------------------------------------------------------\n\n  /**\n   * Handle resize: fit the display to the window.\n   * To be called once the image is loaded.\n   * Can be connected to a window 'resize' event.\n   *\n   * @function\n   */\n  onResize = () => {\n    this.fitToContainer();\n  };\n\n  /**\n   * Key down callback. Meant to be used in tools.\n   *\n   * @param {KeyboardEvent} event The key down event.\n   * @fires App#keydown\n   * @function\n   */\n  onKeydown = (event) => {\n    /**\n     * Key down event.\n     *\n     * @event App#keydown\n     * @type {KeyboardEvent}\n     * @property {string} type The event type: keydown.\n     * @property {string} context The tool where the event originated.\n     */\n    this.#fireEvent(event);\n  };\n\n  /**\n   * Key down event handler example.\n   * - CRTL-Z: undo,\n   * - CRTL-Y: redo,\n   * - CRTL-ARROW_LEFT: next element on fourth dim,\n   * - CRTL-ARROW_UP: next element on third dim,\n   * - CRTL-ARROW_RIGHT: previous element on fourth dim,\n   * - CRTL-ARROW_DOWN: previous element on third dim.\n   *\n   * Applies to the active view of the active layer group.\n   *\n   * @param {KeyboardEvent} event The key down event.\n   * @fires UndoStack#undo\n   * @fires UndoStack#redo\n   * @function\n   */\n  defaultOnKeydown = (event) => {\n    if (event.ctrlKey) {\n      if (event.shiftKey) {\n        const layerGroup = this.#stage.getActiveLayerGroup();\n        const positionHelper = layerGroup.getPositionHelper();\n        if (event.key === 'ArrowLeft') { // crtl-shift-arrow-left\n          if (layerGroup.moreThanOne(3)) {\n            positionHelper.decrementPosition(3);\n          }\n        } else if (event.key === 'ArrowUp') { // crtl-shift-arrow-up\n          if (layerGroup.canScroll()) {\n            positionHelper.incrementPositionAlongScroll();\n          }\n        } else if (event.key === 'ArrowRight') { // crtl-shift-arrow-right\n          if (layerGroup.moreThanOne(3)) {\n            positionHelper.incrementPosition(3);\n          }\n        } else if (event.key === 'ArrowDown') { // crtl-shift-arrow-down\n          if (layerGroup.canScroll()) {\n            positionHelper.decrementPositionAlongScroll();\n          }\n        }\n      } else if (event.key === 'y') { // crtl-y\n        this.#undoStack.redo();\n      } else if (event.key === 'z') { // crtl-z\n        this.#undoStack.undo();\n      } else if (event.key === ' ') { // crtl-space\n        for (let i = 0; i < this.#stage.getNumberOfLayerGroups(); ++i) {\n          this.#stage.getLayerGroup(i).setShowCrosshair(\n            !this.#stage.getLayerGroup(i).getShowCrosshair()\n          );\n        }\n      }\n    }\n  };\n\n  // Internal members shortcuts-----------------------------------------------\n\n  /**\n   * Reset the display.\n   */\n  resetDisplay() {\n    this.resetLayout();\n    this.initWLDisplay();\n  }\n\n  /**\n   * Reset the app zoom.\n   */\n  resetZoom() {\n    this.resetLayout();\n  }\n\n  /**\n   * Set the colour map of the active view of the active layer group.\n   *\n   * @param {string} name The colour map name.\n   * @deprecated Since v0.33, please use the ViewController\n   *   equivalent directly instead.\n   */\n  setColourMap(name) {\n    const viewController =\n      this.#stage.getActiveLayerGroup()\n        .getActiveViewLayer().getViewController();\n    viewController.setColourMap(name);\n  }\n\n  /**\n   * Set the window/level preset of the active view of the active layer group.\n   *\n   * @param {string} preset The window/level preset.\n   * @deprecated Since v0.33, please use the ViewController\n   *   equivalent directly instead.\n   */\n  setWindowLevelPreset(preset) {\n    const viewController =\n      this.#stage.getActiveLayerGroup()\n        .getActiveViewLayer().getViewController();\n    viewController.setWindowLevelPreset(preset);\n  }\n\n  /**\n   * Set the tool.\n   *\n   * @param {string} tool The tool.\n   */\n  setTool(tool) {\n    // bind tool to active layer\n    for (let i = 0; i < this.#stage.getNumberOfLayerGroups(); ++i) {\n      const layerGroup = this.#stage.getLayerGroup(i);\n      const layer = layerGroup.getActiveLayer();\n      if (typeof layer !== 'undefined') {\n        this.#toolboxController.bindLayerGroup(layerGroup, layer);\n      }\n    }\n    // set toolbox tool\n    this.#toolboxController.setSelectedTool(tool);\n  }\n\n  /**\n   * Set the tool live features.\n   *\n   * @param {object} list The list of features.\n   */\n  setToolFeatures(list) {\n    this.#toolboxController.setToolFeatures(list);\n  }\n\n  /**\n   * Undo the last action.\n   *\n   * @fires UndoStack#undo\n   */\n  undo() {\n    this.#undoStack.undo();\n  }\n\n  /**\n   * Redo the last action.\n   *\n   * @fires UndoStack#redo\n   */\n  redo() {\n    this.#undoStack.redo();\n  }\n\n  /**\n   * Get the undo stack size.\n   *\n   * @returns {number} The size of the stack.\n   */\n  getStackSize() {\n    return this.#undoStack.getStackSize();\n  }\n\n  /**\n   * Get the current undo stack index.\n   *\n   * @returns {number} The stack index.\n   */\n  getCurrentStackIndex() {\n    return this.#undoStack.getCurrentStackIndex();\n  }\n\n  /**\n   * Get the info data for a data id.\n   *\n   * @param {string} dataId The data id.\n   * @returns {InfoData|undefined} The info data.\n   */\n  getInfoData(dataId) {\n    let data;\n    if (typeof this.#infoDatas !== 'undefined') {\n      data = this.#infoDatas[dataId];\n    }\n    return data;\n  }\n\n  /**\n   * Toggle info data listeners.\n   *\n   * @param {string} dataId The data id.\n   */\n  toggleInfoDataListeners(dataId) {\n    const data = this.getInfoData(dataId);\n    if (typeof data !== 'undefined') {\n      if (data.isListening()) {\n        data.removeAppListeners();\n      } else {\n        data.addAppListeners();\n      }\n    }\n  }\n\n  /**\n   * Create new annotation data based on the data of\n   *   the active view layer.\n   *\n   * @param {string} refDataId The reference data id.\n   * @returns {DicomData} The new data.\n   */\n  createAnnotationData(refDataId) {\n    const refData = this.getData(refDataId);\n    const refMeta = refData.image.getMeta();\n\n    const data = new DicomData({});\n    data.annotationGroup = new AnnotationGroup();\n    data.annotationGroup.setMetaValue('Modality', 'SR');\n\n    const tagsToCopy = [\n      'PatientName',\n      'PatientID',\n      'PatientBirthDate',\n      'PatientSex',\n      'StudyDate',\n      'StudyTime',\n      'StudyInstanceUID',\n      'StudyID',\n      'StudyDescription'\n    ];\n    for (const tag of tagsToCopy) {\n      data.annotationGroup.setMetaValue(tag, refMeta[tag]);\n    }\n\n    // used to associate with a view layer\n    data.annotationGroup.setMetaValue(\n      'CurrentRequestedProcedureEvidenceSequence', {\n        value: [{\n          ReferencedSeriesSequence: {\n            value: [{\n              // ReferencedSOPSequence: left to fill in later\n              SeriesInstanceUID: refMeta.SeriesInstanceUID\n            }]\n          },\n          StudyInstanceUID: refMeta.StudyInstanceUID\n        }]\n      }\n    );\n\n    return data;\n  }\n\n  /**\n   * Add new data and render it with a simple new data view config.\n   *\n   * @param {DicomData} data The data to add.\n   * @param {string} divId The div where to draw.\n   * @param {string} refDataId The reference data id.\n   */\n  addAndRenderAnnotationData(data, divId, refDataId) {\n    // add new data\n    const dataId = this.getNextDataId();\n    const added = this.addData(dataId, data);\n    if (!added) {\n      throw new Error('Cannot add annotation data');\n    }\n    // add data view config based on reference data\n    const refDataViewConfigs = this.getViewConfigs(refDataId);\n    const refDataViewConfig = refDataViewConfigs.find(\n      element => element.divId === divId);\n    if (typeof refDataViewConfig === 'undefined') {\n      throw new Error('No reference data view config for draw');\n    }\n    const drawDataViewConfig = new ViewConfig(divId);\n    drawDataViewConfig.orientation = refDataViewConfig.orientation;\n    this.addDataViewConfig(dataId, drawDataViewConfig);\n    // render (will create draw layer)\n    this.render(dataId);\n  }\n\n  // Private Methods -----------------------------------------------------------\n\n  /**\n   * Fire an event: call all associated listeners with the input event object.\n   *\n   * @param {object} event The event to fire.\n   */\n  #fireEvent = (event) => {\n    let propagate = true;\n    if (typeof event.propagate !== 'undefined') {\n      propagate = event.propagate;\n      delete event.propagate;\n    }\n    if (propagate) {\n      this.#listenerHandler.fireEvent(event);\n    }\n  };\n\n  /**\n   * Data load start callback.\n   *\n   * @param {object} event The load start event.\n   */\n  #onloadstart = (event) => {\n    // create info data\n    if (typeof this.#options.overlayConfig !== 'undefined') {\n      this.#infoDatas[event.dataid] = new InfoData(\n        this, event.dataid, this.#options.overlayConfig);\n    }\n    /**\n     * Load start event.\n     *\n     * @event App#loadstart\n     * @type {object}\n     * @property {string} type The event type: loadstart.\n     * @property {string} loadType The load type: image or state.\n     * @property {*} source The load source: string for an url,\n     *   File for a file.\n     */\n    event.type = 'loadstart';\n    this.#fireEvent(event);\n  };\n\n  /**\n   * Data load progress callback.\n   *\n   * @param {object} event The progress event.\n   */\n  #onloadprogress = (event) => {\n    /**\n     * Load progress event.\n     *\n     * @event App#loadprogress\n     * @type {object}\n     * @property {string} type The event type: loadprogress.\n     * @property {string} loadType The load type: image or state.\n     * @property {*} source The load source: string for an url,\n     *   File for a file.\n     * @property {number} loaded The loaded percentage.\n     * @property {number} total The total percentage.\n     */\n    event.type = 'loadprogress';\n    this.#fireEvent(event);\n  };\n\n  /**\n   * Data load callback.\n   *\n   * @param {object} event The load event.\n   */\n  #onloaditem = (event) => {\n    // check event\n    if (typeof event.data === 'undefined') {\n      logger.error('Missing loaditem event data.');\n    }\n    if (typeof event.loadtype === 'undefined') {\n      logger.error('Missing loaditem event load type.');\n    }\n\n    let eventMetaData;\n    if (event.loadtype === 'image') {\n      eventMetaData = event.data.meta;\n    } else if (event.loadtype === 'state') {\n      eventMetaData = 'state';\n    }\n\n    const isFirstLoadItem = event.isfirstitem;\n\n    if (event.loadtype === 'image') {\n      try {\n        if (isFirstLoadItem) {\n          this.#dataController.add(event.dataid, event.data);\n        } else {\n          this.#dataController.update(event.dataid, event.data);\n        }\n      } catch (error) {\n        this.#onloaderror({\n          dataid: event.dataid,\n          error: error,\n          source: event.source\n        });\n        this.#onloadend({\n          dataid: event.dataid,\n          source: event.source\n        });\n        return;\n      }\n    } else if (event.loadtype === 'state') {\n      this.applyJsonState(event.data, event.dataid);\n    }\n\n    /**\n     * Load item event: fired when an item has been successfully loaded.\n     *\n     * @event App#loaditem\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {string} loadType The load type: image or state.\n     * @property {*} source The load source: string for an url,\n     *   File for a file.\n     * @property {object} data The loaded meta data.\n     */\n    this.#fireEvent({\n      type: 'loaditem',\n      data: eventMetaData,\n      source: event.source,\n      loadtype: event.loadtype,\n      dataid: event.dataid,\n      isfirstitem: event.isfirstitem,\n      warn: event.warn\n    });\n\n    // update info data if present\n    if (typeof this.#infoDatas !== 'undefined' &&\n      typeof this.#infoDatas[event.dataid] !== 'undefined') {\n      this.#infoDatas[event.dataid].addItemMeta(eventMetaData);\n    }\n\n    // render if first and flag allows\n    if (event.loadtype === 'image' &&\n      this.getViewConfigs(event.dataid).length !== 0 &&\n      isFirstLoadItem && this.#options.viewOnFirstLoadItem) {\n      this.render(event.dataid);\n    }\n  };\n\n  /**\n   * Data load callback.\n   *\n   * @param {object} event The load event.\n   */\n  #onload = (event) => {\n    // mark data as complete\n    const res = this.#dataController.markDataAsComplete(event.dataid);\n\n    // render if image has changed\n    if (this.#options.viewOnFirstLoadItem &&\n      typeof res.imageHasChanged !== 'undefined' &&\n      res.imageHasChanged) {\n      this.render(event.dataid);\n    }\n\n    /**\n     * Load event: fired when a load finishes successfully.\n     *\n     * @event App#load\n     * @type {object}\n     * @property {string} type The event type: load.\n     * @property {string} loadType The load type: image or state.\n     */\n    event.type = 'load';\n    this.#fireEvent(event);\n  };\n\n  /**\n   * Data load end callback.\n   *\n   * @param {object} event The load end event.\n   */\n  #onloadend = (event) => {\n    /**\n     * Main load end event: fired when the load finishes,\n     *   successfully or not.\n     *\n     * @event App#loadend\n     * @type {object}\n     * @property {string} type The event type: loadend.\n     * @property {string} loadType The load type: image or state.\n     * @property {*} source The load source: string for an url,\n     *   File for a file.\n     */\n    event.type = 'loadend';\n    this.#fireEvent(event);\n  };\n\n  /**\n   * Data load error callback.\n   *\n   * @param {object} event The error event.\n   */\n  #onloaderror = (event) => {\n    /**\n     * Load error event.\n     *\n     * @event App#error\n     * @type {object}\n     * @property {string} type The event type: error.\n     * @property {string} loadType The load type: image or state.\n     * @property {*} source The load source: string for an url,\n     *   File for a file.\n     * @property {object} error The error.\n     * @property {object} target The event target.\n     */\n    if (typeof event.type === 'undefined') {\n      event.type = 'error';\n    }\n    this.#fireEvent(event);\n  };\n\n  /**\n   * Data load timeout callback.\n   *\n   * @param {object} event The timeout event.\n   */\n  #onloadtimeout = (event) => {\n    /**\n     * Load timeout event.\n     *\n     * @event App#timeout\n     * @type {object}\n     * @property {string} type The event type: timeout.\n     * @property {string} loadType The load type: image or state.\n     * @property {*} source The load source: an url as a string.\n     * @property {object} target The event target.\n     */\n    if (typeof event.type === 'undefined') {\n      event.type = 'timeout';\n    }\n    this.#fireEvent(event);\n  };\n\n  /**\n   * Data load abort callback.\n   *\n   * @param {object} event The abort event.\n   */\n  #onloadabort = (event) => {\n    /**\n     * Load abort event.\n     *\n     * @event App#abort\n     * @type {object}\n     * @property {string} type The event type: abort.\n     * @property {string} loadType The load type: image or state.\n     * @property {*} source The load source: string for an url,\n     *   File for a file.\n     */\n    if (typeof event.type === 'undefined') {\n      event.type = 'abort';\n    }\n    this.#fireEvent(event);\n  };\n\n  /**\n   * Bind layer group events to app.\n   *\n   * @param {LayerGroup} group The layer group.\n   */\n  #bindLayerGroupToApp(group) {\n    // propagate layer group events\n    group.addEventListener('zoomchange', this.#fireEvent);\n    group.addEventListener('offsetchange', this.#fireEvent);\n    group.addEventListener('layerremove', this.#fireEvent);\n    group.addEventListener('outofrange', this.#fireEvent);\n    // propagate viewLayer events\n    group.addEventListener('renderstart', this.#fireEvent);\n    group.addEventListener('renderend', this.#fireEvent);\n    // propagate view events\n    for (const eventName of viewEventNames) {\n      group.addEventListener(eventName, this.#fireEvent);\n    }\n    // updata data view config\n    group.addEventListener('wlchange', (event) => {\n      const layerDetails = getLayerDetailsFromLayerDivId(event.srclayerid);\n      const groupId = layerDetails.groupDivId;\n      const config = this.getViewConfig(event.dataid, groupId, true);\n      if (typeof config !== 'undefined') {\n        // reset previous values\n        config.windowCenter = undefined;\n        config.windowWidth = undefined;\n        config.wlPresetName = undefined;\n        // window width, center and name\n        if (event.value.length === 3) {\n          config.windowCenter = event.value[0];\n          config.windowWidth = event.value[1];\n          config.wlPresetName = event.value[2];\n        }\n      }\n    });\n    group.addEventListener('opacitychange', (event) => {\n      const layerDetails = getLayerDetailsFromLayerDivId(event.srclayerid);\n      const groupId = layerDetails.groupDivId;\n      const config = this.getViewConfig(event.dataid, groupId, true);\n      if (typeof config !== 'undefined') {\n        config.opacity = event.value[0];\n      }\n    });\n    group.addEventListener('colourmapchange', (event) => {\n      const layerDetails = getLayerDetailsFromLayerDivId(event.srclayerid);\n      const groupId = layerDetails.groupDivId;\n      const config = this.getViewConfig(event.dataid, groupId, true);\n      if (typeof config !== 'undefined') {\n        config.colourMap = event.value[0];\n      }\n    });\n  }\n\n  /**\n   * Add a view layer.\n   *\n   * @param {string} dataId The data id.\n   * @param {ViewConfig} viewConfig The data view config.\n   */\n  #addViewLayer(dataId, viewConfig) {\n    const data = this.#dataController.get(dataId);\n    if (!data) {\n      throw new Error('Cannot initialise layer with missing data, id: ' +\n        dataId);\n    }\n    const layerGroup = this.#stage.getLayerGroupByDivId(viewConfig.divId);\n    if (!layerGroup) {\n      throw new Error('Cannot initialise layer with missing group, id: ' +\n        viewConfig.divId);\n    }\n    const imageGeometry = data.image.getGeometry();\n\n    // un-bind\n    this.#stage.unbindLayerGroups();\n\n    // create and setup view\n    const viewFactory = new ViewFactory();\n    const view = viewFactory.create(data.meta, data.image);\n    const viewOrientation = getViewOrientation(\n      imageGeometry.getOrientation(),\n      getMatrixFromName(viewConfig.orientation)\n    );\n    view.setOrientation(viewOrientation);\n\n    // segmentation settings\n    if (view.isMask()) {\n      data.image.initializeContour();\n      // possible presets\n      if (typeof viewConfig.fillOpacity !== 'undefined') {\n        view.setFillOpacity(viewConfig.fillOpacity);\n      }\n      if (typeof viewConfig.contourThickness !== 'undefined') {\n        view.setContourThickness(viewConfig.contourThickness);\n      }\n    }\n\n    // do we have more than one layer\n    // (the layer has not been added to the layer group yet)\n    const isBaseLayer = layerGroup.getNumberOfViewLayers() === 0;\n\n    // opacity\n    let opacity = 1;\n    if (typeof viewConfig.opacity !== 'undefined') {\n      opacity = viewConfig.opacity;\n    } else {\n      if (!isBaseLayer) {\n        if (view.isMask()) {\n          // Assuming contours are enabled be default\n          opacity = 0.8;\n        } else {\n          opacity = 0.5;\n        }\n      }\n    }\n\n    // view layer\n    const viewLayer = layerGroup.addViewLayer();\n    viewLayer.setView(view, dataId);\n    const size2D = imageGeometry.getSize(viewOrientation).get2D();\n    const spacing2D = imageGeometry.getSpacing(viewOrientation).get2D();\n    viewLayer.initialise(size2D, spacing2D, opacity);\n\n    // view controller\n    const viewController = viewLayer.getViewController();\n    // window/level\n    if (typeof viewConfig.wlPresetName !== 'undefined') {\n      viewController.setWindowLevelPreset(viewConfig.wlPresetName);\n    } else if (typeof viewConfig.windowCenter !== 'undefined' &&\n      typeof viewConfig.windowWidth !== 'undefined') {\n      const wl = new WindowLevel(\n        viewConfig.windowCenter, viewConfig.windowWidth);\n      viewController.setWindowLevel(wl);\n    }\n    // colour map\n    if (typeof viewConfig.colourMap !== 'undefined') {\n      viewController.setColourMap(viewConfig.colourMap);\n    } else {\n      if (!isBaseLayer) {\n        if (data.image.getMeta().Modality === 'PT') {\n          viewController.setColourMap('hot');\n        } else {\n          viewController.setColourMap('rainbow');\n        }\n      }\n    }\n\n    // listen to image set\n    this.#dataController.addEventListener(\n      'dataimageset', viewLayer.onimageset);\n\n    // bind overlay data\n    if (typeof this.#options.overlayConfig !== 'undefined') {\n      layerGroup.addInfoData(this.getInfoData(dataId), dataId);\n      layerGroup.bindInfoData(dataId);\n    }\n\n    // sync layers position\n    const value = [\n      viewController.getCurrentIndex().getValues(),\n      viewController.getCurrentPosition().getValues()\n    ];\n    layerGroup.updateLayersToPositionChange({\n      value: value,\n      srclayerid: viewLayer.getId()\n    });\n\n    // sync layer groups\n    this.#stage.fitToContainer();\n\n    // layer offset (done before scale)\n    viewLayer.setOffset(layerGroup.getOffset());\n\n    // get and apply flip flags\n    const flipFlags = this.#getViewFlipFlags(\n      imageGeometry.getOrientation(),\n      viewConfig.orientation);\n    this.#applyFlipFlags(flipFlags, viewLayer);\n\n    // layer scale (done after possible flip)\n    if (!isBaseLayer) {\n      // use zoom offset of base layer\n      const baseViewLayer = layerGroup.getBaseViewLayer();\n      viewLayer.initScale(\n        layerGroup.getScale(),\n        baseViewLayer.getAbsoluteZoomOffset()\n      );\n    } else {\n      viewLayer.setScale(layerGroup.getScale());\n    }\n\n    // bind\n    this.#stage.bindLayerGroups();\n    if (this.#toolboxController) {\n      this.#toolboxController.bindLayerGroup(layerGroup, viewLayer);\n    }\n\n    /**\n     * Add view layer event.\n     *\n     * @event App#viewlayeradd\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {string} layerid The layer id.\n     * @property {string} layergroupid The layer group id.\n     * @property {string} dataid The data id.\n     */\n    this.#fireEvent({\n      type: 'viewlayeradd',\n      layerid: viewLayer.getId(),\n      layergroupid: layerGroup.getDivId(),\n      dataid: dataId\n    });\n\n    // initialise the toolbox for base\n    if (isBaseLayer) {\n      if (this.#toolboxController) {\n        this.#toolboxController.init();\n      }\n    }\n  }\n\n  /**\n   * Get the reference layer of an annotation group.\n   *\n   * @param {AnnotationGroup} annotationGroup The annotation group to attach.\n   * @param {LayerGroup} layerGroup The group where to find the reference.\n   * @returns {ViewLayer} The reference view layer.\n   */\n  #getReferenceLayer(annotationGroup, layerGroup) {\n    let refViewLayer;\n\n    // use meta\n    // -> will match empty groups created with createAnnotationData\n    const evidenceSeq =\n      annotationGroup.getMetaValue('CurrentRequestedProcedureEvidenceSequence');\n    if (typeof evidenceSeq !== 'undefined') {\n      const evidenceSeqItem0 = evidenceSeq.value[0];\n      const refSeriesSeq = evidenceSeqItem0?.ReferencedSeriesSequence;\n      const refSeriesSeqItem0 = refSeriesSeq?.value[0];\n      const refSeriesInstanceUID = refSeriesSeqItem0?.SeriesInstanceUID;\n      const metaSearch = {\n        SeriesInstanceUID: refSeriesInstanceUID\n      };\n      const viewLayers = layerGroup.searchViewLayers(metaSearch);\n      if (viewLayers.length !== 0) {\n        refViewLayer = viewLayers[0];\n      }\n    }\n\n    // dwv034 wrongly uses ReferencedSeriesSequence tag at root\n    // and does not set the SOPClassUID of annotation reference...\n    const refSeriesSeq =\n      annotationGroup.getMetaValue('ReferencedSeriesSequence');\n    if (typeof refSeriesSeq !== 'undefined') {\n      const refSeriesSeqItem0 = refSeriesSeq.value[0];\n      const refSeriesInstanceUID = refSeriesSeqItem0?.SeriesInstanceUID;\n      const metaSearch = {\n        SeriesInstanceUID: refSeriesInstanceUID\n      };\n      const viewLayers = layerGroup.searchViewLayers(metaSearch);\n      if (viewLayers.length !== 0) {\n        refViewLayer = viewLayers[0];\n      }\n    }\n\n    // if no meta, go through annotations\n    if (typeof refViewLayer === 'undefined') {\n      for (const annotation of annotationGroup.getList()) {\n        const metaSearch = {\n          SOPInstanceUID: annotation.referencedSopInstanceUID,\n          SOPClassUID: annotation.referencedSopClassUID\n        };\n        const viewLayers = layerGroup.searchViewLayers(metaSearch);\n        if (viewLayers.length !== 0) {\n          // exit at first match\n          refViewLayer = viewLayers[0];\n          break;\n        }\n      }\n    }\n\n    return refViewLayer;\n  }\n\n  /**\n   * Add a draw layer.\n   *\n   * @param {string} dataId The data id.\n   * @param {ViewConfig} viewConfig The data view config.\n   */\n  addDrawLayer(dataId, viewConfig) {\n    const layerGroup = this.#stage.getLayerGroupByDivId(viewConfig.divId);\n    if (!layerGroup) {\n      throw new Error('Cannot initialise layer with missing group, id: ' +\n        viewConfig.divId);\n    }\n\n    const data = this.#dataController.get(dataId);\n    if (!data) {\n      throw new Error('Cannot initialise layer with missing data, id: ' +\n        dataId);\n    }\n    const annotationGroup = data.annotationGroup;\n\n    // find referenced view layer\n    const refViewLayer = this.#getReferenceLayer(annotationGroup, layerGroup);\n    if (typeof refViewLayer === 'undefined') {\n      console.warn(\n        'No loaded data that matches the measurements reference series UID');\n      return;\n    }\n    const refDataId = refViewLayer.getDataId();\n\n    // un-bind\n    this.#stage.unbindLayerGroups();\n\n    // set annotation view controller (allows quantification)\n    const refViewController = refViewLayer.getViewController();\n    data.annotationGroup.setViewController(refViewController);\n\n    // reference data to use as base for layer properties\n    const refData = this.#dataController.get(refDataId);\n    if (!refData) {\n      throw new Error(\n        'Cannot initialise layer without reference data, id: ' +\n        refDataId);\n    }\n    const imageGeometry = refData.image.getGeometry();\n\n    const viewOrientation = getViewOrientation(\n      imageGeometry.getOrientation(),\n      getMatrixFromName(viewConfig.orientation)\n    );\n    const size2D = imageGeometry.getSize(viewOrientation).get2D();\n    const spacing2D = imageGeometry.getSpacing(viewOrientation).get2D();\n\n    const drawLayer = layerGroup.addDrawLayer();\n    drawLayer.initialise(size2D, spacing2D, refViewLayer.getId());\n\n    const planeHelper = new PlaneHelper(\n      imageGeometry,\n      viewOrientation\n    );\n    drawLayer.setPlaneHelper(planeHelper);\n\n    // sync layers position\n    const value = [\n      refViewController.getCurrentIndex().getValues(),\n      refViewController.getCurrentPosition().getValues()\n    ];\n    layerGroup.updateLayersToPositionChange({\n      value: value,\n      srclayerid: drawLayer.getId()\n    });\n\n    // sync layer groups\n    this.#stage.fitToContainer();\n\n    // layer offset (done before scale)\n    drawLayer.setOffset(layerGroup.getOffset());\n\n    // get and apply flip flags\n    const flipFlags = this.#getViewFlipFlags(\n      imageGeometry.getOrientation(),\n      viewConfig.orientation);\n    this.#applyFlipFlags(flipFlags, drawLayer);\n\n    // layer scale (done after possible flip)\n    // use zoom offset of ref layer\n    drawLayer.initScale(\n      layerGroup.getScale(),\n      refViewLayer.getAbsoluteZoomOffset()\n    );\n\n    // add possible existing data\n    drawLayer.setAnnotationGroup(\n      data.annotationGroup,\n      dataId,\n      this.addToUndoStack);\n\n    drawLayer.setCurrentPosition(\n      refViewController.getCurrentPosition(),\n      refViewController.getCurrentIndex()\n    );\n\n    // bind\n    this.#stage.bindLayerGroups();\n    if (this.#toolboxController) {\n      this.#toolboxController.bindLayerGroup(layerGroup, drawLayer);\n    }\n\n    /**\n     * Add draw layer event.\n     *\n     * @event App#drawlayeradd\n     * @type {object}\n     * @property {string} type The event type.\n     * @property {string} layerid The layer id.\n     * @property {string} layergroupid The layer group id.\n     * @property {string} dataid The data id.\n     */\n    this.#fireEvent({\n      type: 'drawlayeradd',\n      layerid: drawLayer.getId(),\n      layergroupid: layerGroup.getDivId(),\n      dataid: dataId\n    });\n  }\n\n  /**\n   * Get the view flip flags: offset (x, y) and scale (x, y, z) flags.\n   *\n   * @param {Matrix33} imageOrientation The image orientation.\n   * @param {string} viewConfigOrientation The view config orientation.\n   * @returns {object} Offset and scale flip flags.\n   */\n  #getViewFlipFlags(imageOrientation, viewConfigOrientation) {\n    // 'simple' orientation code (does not take into account angles)\n    const orientationCode =\n      getOrientationStringLPS(imageOrientation.asOneAndZeros());\n    if (typeof orientationCode === 'undefined') {\n      throw new Error('Unsupported undefined orientation code');\n    }\n\n    // view orientation flags\n    const isViewUndefined = typeof viewConfigOrientation === 'undefined';\n    const isViewAxial = !isViewUndefined &&\n      viewConfigOrientation === Orientation.Axial;\n    const isViewCoronal = !isViewUndefined &&\n      viewConfigOrientation === Orientation.Coronal;\n    const isViewSagittal = !isViewUndefined &&\n      viewConfigOrientation === Orientation.Sagittal;\n\n    // default flags\n    const flipOffset = {\n      x: false,\n      y: false\n    };\n    const flipScale = {\n      x: false,\n      y: false,\n      z: false\n    };\n\n    if (orientationCode === 'LPS') {\n      // axial\n      if (isViewCoronal || isViewSagittal) {\n        flipScale.z = true;\n        flipOffset.y = true;\n      }\n    } else if (orientationCode === 'LAI') {\n      // axial\n      if (isViewUndefined || isViewAxial) {\n        flipOffset.y = true;\n      } else if (isViewCoronal) {\n        flipScale.z = true;\n      } else if (isViewSagittal) {\n        flipScale.z = true;\n        flipOffset.x = true;\n      }\n    } else if (orientationCode === 'RPI') {\n      // axial\n      if (isViewUndefined || isViewAxial) {\n        flipOffset.x = true;\n      } else if (isViewCoronal) {\n        flipScale.z = true;\n        flipOffset.x = true;\n      } else if (isViewSagittal) {\n        flipScale.z = true;\n      }\n    } else if (orientationCode === 'RAS') {\n      // axial\n      flipOffset.x = true;\n      flipOffset.y = true;\n      if (isViewCoronal || isViewSagittal) {\n        flipScale.z = true;\n      }\n    } else if (orientationCode === 'LSA') {\n      // coronal\n      flipOffset.y = true;\n      if (isViewUndefined || isViewCoronal) {\n        flipScale.z = true;\n      } else if (isViewAxial) {\n        flipScale.y = true;\n      } else if (isViewSagittal) {\n        flipOffset.x = true;\n        flipScale.y = true;\n        flipScale.z = true;\n      }\n    // } else if (orientationCode === 'LIP') { // nothing to do\n    } else if (orientationCode === 'RSP') {\n      // coronal\n      if (isViewUndefined || isViewCoronal) {\n        flipOffset.x = true;\n        flipOffset.y = true;\n        flipScale.x = true;\n        flipScale.z = true;\n      } else if (isViewAxial) {\n        flipOffset.x = true;\n        flipScale.x = true;\n      } else if (isViewSagittal) {\n        flipOffset.y = true;\n        flipScale.z = true;\n      }\n    } else if (orientationCode === 'RIA') {\n      // coronal\n      flipOffset.x = true;\n      if (isViewUndefined || isViewCoronal) {\n        flipScale.x = true;\n      } else if (isViewAxial) {\n        flipOffset.y = true;\n        flipScale.x = true;\n        flipScale.y = true;\n      } else if (isViewSagittal) {\n        flipScale.y = true;\n      }\n    } else if (orientationCode === 'PSL') {\n      // sagittal\n      flipScale.z = true;\n      if (isViewUndefined || isViewSagittal) {\n        flipOffset.y = true;\n      } else if (isViewCoronal) {\n        flipOffset.y = true;\n      }\n    } else if (orientationCode === 'PIR') {\n      // sagittal\n      flipScale.z = true;\n      if (isViewAxial || isViewCoronal) {\n        flipOffset.x = true;\n      }\n    } else if (orientationCode === 'ASR') {\n      // sagittal\n      flipOffset.x = true;\n      flipOffset.y = true;\n      if (isViewUndefined || isViewSagittal) {\n        flipScale.z = true;\n      } else if (isViewCoronal) {\n        flipScale.z = true;\n      }\n    } else if (orientationCode === 'AIL') {\n      // sagittal\n      if (isViewUndefined || isViewSagittal) {\n        flipOffset.x = true;\n        flipScale.z = true;\n      } else if (isViewAxial) {\n        flipOffset.y = true;\n      } else if (isViewCoronal) {\n        flipScale.z = true;\n      }\n    } else {\n      // LIP uses default scale and offset\n      if (orientationCode !== 'LIP') {\n        logger.warn('Unsupported orientation code: ' +\n          orientationCode + ', display could be incorrect');\n      }\n    }\n\n    return {\n      scale: flipScale,\n      offset: flipOffset\n    };\n  }\n\n  #applyFlipFlags(flipFlags, layer) {\n    if (flipFlags.offset.x) {\n      layer.addFlipOffsetX();\n    }\n    if (flipFlags.offset.y) {\n      layer.addFlipOffsetY();\n    }\n    if (flipFlags.scale.x) {\n      layer.flipScaleX();\n    }\n    if (flipFlags.scale.y) {\n      layer.flipScaleY();\n    }\n    if (flipFlags.scale.z) {\n      layer.flipScaleZ();\n    }\n  }\n\n} // class App\n","import {logger} from '../utils/logger.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Image} from './image.js';\nimport {MaskSegment} from '../dicom/dicomSegment.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Mask segment helper: helps handling the segments list,\n *   but does *NOT* update the associated mask (use special commands\n *   for that such as DeleteSegmentCommand, ChangeSegmentColourCommand...).\n */\nexport class MaskSegmentHelper {\n\n  /**\n   * The associated mask.\n   *\n   * @type {Image}\n   */\n  #mask;\n\n  /**\n   * The segments: array of segment description.\n   *\n   * @type {MaskSegment[]}\n   */\n  #segments;\n\n  /**\n   * @param {Image} mask The associated mask image.\n   */\n  constructor(mask) {\n    this.#mask = mask;\n    // check segments in meta\n    const meta = mask.getMeta();\n    if (typeof meta.custom === 'undefined') {\n      meta.custom = {};\n    }\n    if (typeof meta.custom.segments === 'undefined') {\n      meta.custom.segments = [];\n    }\n    this.#segments = meta.custom.segments;\n  }\n\n  /**\n   * Get the associated mask image.\n   *\n   * @returns {Image} The mask image.\n   */\n  getMask() {\n    return this.#mask;\n  }\n\n  /**\n   * Find the index of a segment in the segments list.\n   *\n   * @param {number} segmentNumber The number to find.\n   * @returns {number} The index in the segments list, -1 if not found.\n   */\n  #findSegmentIndex(segmentNumber) {\n    return this.#segments.findIndex(function (item) {\n      return item.number === segmentNumber;\n    });\n  }\n\n  /**\n   * Check if a segment is part of the segments list.\n   *\n   * @param {number} segmentNumber The segment number.\n   * @returns {boolean} True if the segment is included.\n   */\n  hasSegment(segmentNumber) {\n    return this.#findSegmentIndex(segmentNumber) !== -1;\n  }\n\n  /**\n   * Get the number of segments of the segmentation.\n   *\n   * @returns {number} The number of segments.\n   */\n  getNumberOfSegments() {\n    return this.#segments.length;\n  }\n\n  /**\n   * Check if a segment is present in a mask image.\n   *\n   * @param {number[]} numbers Array of segment numbers.\n   * @returns {boolean[]} Array of boolean set to true\n   *   if the segment is present in the mask.\n   */\n  maskHasSegments(numbers) {\n    // create values using displayValue\n    const values = [];\n    const unknowns = [];\n    for (let i = 0; i < numbers.length; ++i) {\n      const segment = this.getSegment(numbers[i]);\n      if (typeof segment !== 'undefined') {\n        if (typeof segment.displayValue !== 'undefined') {\n          values.push(segment.displayValue);\n        } else {\n          values.push(segment.number);\n        }\n      } else {\n        logger.warn('Unknown segment in maskHasSegments: ' + numbers[i]);\n        unknowns.push(i);\n      }\n    }\n    const res = this.#mask.hasValues(values);\n    // insert unknowns as false in result\n    for (let j = 0; j < unknowns.length; ++j) {\n      res.splice(unknowns[j], 0, false);\n    }\n    return res;\n  }\n\n  /**\n   * Get a segment from the inner segment list.\n   *\n   * @param {number} segmentNumber The segment number.\n   * @returns {MaskSegment|undefined} The segment or undefined if not found.\n   */\n  getSegment(segmentNumber) {\n    let segment;\n    const index = this.#findSegmentIndex(segmentNumber);\n    if (index !== -1) {\n      segment = this.#segments[index];\n    }\n    return segment;\n  }\n\n  /**\n   * Add a segment to the segments list.\n   *\n   * @param {MaskSegment} segment The segment to add.\n   */\n  addSegment(segment) {\n    const index = this.#findSegmentIndex(segment.number);\n    if (index === -1) {\n      this.#segments.push(segment);\n      // update palette colour map\n      if (typeof segment.displayRGBValue !== 'undefined') {\n        this.#mask.updatePaletteColourMap(\n          segment.number, segment.displayRGBValue);\n      }\n    } else {\n      logger.warn(\n        'Not adding segment, it is allready in the segments list: ' +\n        segment.number);\n    }\n  }\n\n  /**\n   * Remove a segment from the segments list.\n   *\n   * @param {number} segmentNumber The segment number.\n   */\n  removeSegment(segmentNumber) {\n    const index = this.#findSegmentIndex(segmentNumber);\n    if (index !== -1) {\n      this.#segments.splice(index, 1);\n    } else {\n      logger.warn(\n        'Cannot remove segment, it is not in the segments list: ' +\n        segmentNumber);\n    }\n  }\n\n  /**\n   * Update a segment of the segments list.\n   *\n   * @param {MaskSegment} segment The segment to update.\n   */\n  updateSegment(segment) {\n    const index = this.#findSegmentIndex(segment.number);\n    if (index !== -1) {\n      this.#segments[index] = segment;\n    } else {\n      logger.warn(\n        'Cannot update segment, it is not in the segments list: ' +\n        segment.number);\n    }\n  }\n\n  /**\n   * The overlap count of a single segment with another segment.\n   *\n   * @typedef OverlapCount\n   * @property {string} label The segment label.\n   * @property {number} count The number of overlapping voxels.\n   * @property {number} percentage The overlap percentage between 0 and 100.\n   */\n\n  /**\n   * The count of overlapping voxels of a single segment with a set of\n   * different segments.\n   *\n   * @typedef Overlap\n   * @property {string} label The segment label.\n   * @property {Object.<number, OverlapCount>} overlap A Dictionary\n   *  containing the counts. The key is the segment number of the overlapping\n   *  segment.\n   * @property {number} count The voxel volume of this segment.\n   */\n\n  /**\n   * An Dictionary containing the count of overlapping voxels between two\n   * sets of segments.\n   * The key is the segment number of a segment in the first set.\n   * The value is a Dictionary of all of the segments in the second set\n   * that overlap with the key segment.\n   *\n   * @typedef {Object.<number, Overlap>} OverlapMap\n   */\n\n  /**\n   * Find the overlap for each segment between two segmentation masks.\n   * It is assumed these images have the same orientation.\n   *\n   * @param {MaskSegmentHelper} rhs The helper of the\n   *   segmentation image to find overlap with.\n   * @returns {OverlapMap} The overlapping voxel counts. First level is the\n   *  segments from this image, second level is the compare image segments.\n   */\n  findOverlap(rhs) {\n    // Find the overlapping slices\n    const thisGeometry = this.#mask.getGeometry();\n    const thisSize = thisGeometry.getSize();\n    const compareMask = rhs.getMask();\n    const compareGeometry = compareMask.getGeometry();\n    const compareSize = compareGeometry.getSize();\n\n    /**\n     * @type {OverlapMap}\n     */\n    const overlap = {};\n\n    const thisTotalSize = thisSize.getTotalSize();\n    for (let i = 0; i < thisTotalSize; i++) {\n      const thisValue = this.#mask.getValueAtOffset(i);\n      if (thisValue !== 0) {\n        if (typeof overlap[thisValue] !== 'undefined') {\n          overlap[thisValue].count += 1;\n        } else {\n          const thisSegment = this.getSegment(thisValue);\n          overlap[thisValue] = {\n            label: thisSegment.label,\n            overlap: {},\n            count: 1\n          };\n        }\n\n        const thisIndex = thisSize.offsetToIndex(i);\n        const thisWorld = thisGeometry.indexToWorld(thisIndex);\n        const compareIndex = compareGeometry.worldToIndex(thisWorld);\n        const compareOffset = compareSize.indexToOffset(compareIndex);\n        const compareValue = compareMask.getValueAtOffset(compareOffset);\n\n        if (typeof compareValue !== 'undefined' && compareValue !== 0) {\n          if (typeof overlap[thisValue].overlap[compareValue] !== 'undefined') {\n            overlap[thisValue].overlap[compareValue].count += 1;\n          } else {\n            const compareSegment = rhs.getSegment(compareValue);\n            overlap[thisValue].overlap[compareValue] = {\n              label: compareSegment.label,\n              count: 1,\n              percentage: 0\n            };\n          }\n        }\n      }\n    }\n\n    for (const thisOverlap of Object.values(overlap)) {\n      for (const overlapCount of Object.values(thisOverlap.overlap)) {\n        overlapCount.percentage = overlapCount.count * 100 / thisOverlap.count;\n      }\n    }\n\n    return overlap;\n  }\n\n} // class MaskSegmentHelper\n","import {MaskSegmentHelper} from './maskSegmentHelper.js';\nimport {Command} from '../utils/undoStack.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Image} from './image.js';\nimport {MaskSegment} from '../dicom/dicomSegment.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Delete segment command.\n */\nexport class DeleteSegmentCommand extends Command {\n\n  /**\n   * The associated mask.\n   *\n   * @type {Image}\n   */\n  #mask;\n\n  /**\n   * The segment to remove.\n   *\n   * @type {MaskSegment}\n   */\n  #segment;\n\n  /**\n   * Flag to send creation events.\n   *\n   * @type {boolean}\n   */\n  #isSilent;\n\n  /**\n   * List of offsets.\n   *\n   * @type {number[]}\n   */\n  #offsets;\n\n  /**\n   * @param {Image} mask The mask image.\n   * @param {MaskSegment} segment The segment to remove.\n   * @param {boolean} [silent] Whether to send a creation event or not.\n   */\n  constructor(mask, segment, silent) {\n    super();\n    this.#mask = mask;\n    this.#segment = segment;\n    this.#isSilent = (typeof silent === 'undefined') ? false : silent;\n    // list of offsets with the colour to delete\n    if (typeof segment.displayRGBValue !== 'undefined') {\n      this.#offsets = mask.getOffsets(segment.number);\n    } else {\n      this.#offsets = mask.getOffsets(segment.displayValue);\n    }\n  }\n\n  /**\n   * Get the command name.\n   *\n   * @returns {string} The command name.\n   */\n  getName() {\n    return 'Delete-segment';\n  }\n\n  /**\n   * Check if a command is valid and can be executed.\n   *\n   * @returns {boolean} True if the command is valid.\n   */\n  isValid() {\n    // check that input segment is still there\n    const segments = this.#mask.getMeta().custom.segments;\n    return segments.some(segmentItem =>\n      segmentItem.number === this.#segment.number\n    );\n  }\n\n  /**\n   * Execute the command.\n   *\n   * @fires DeleteSegmentCommand#masksegmentdelete\n   */\n  execute() {\n    if (this.#offsets.length !== 0) {\n      // remove from image\n      this.#mask.setAtOffsets(this.#offsets, 0);\n    }\n\n    // remove from segments\n    const segHelper = new MaskSegmentHelper(this.#mask);\n    segHelper.removeSegment(this.#segment.number);\n\n    // callback\n    if (!this.#isSilent) {\n      /**\n       * Segment delete event.\n       *\n       * @event DeleteSegmentCommand#masksegmentdelete\n       * @type {object}\n       * @property {number} segmentnumber The segment number.\n       */\n      this.onExecute({\n        type: 'masksegmentdelete',\n        segmentnumber: this.#segment.number\n      });\n    }\n  }\n\n  /**\n   * Undo the command.\n   *\n   * @fires DeleteSegmentCommand#masksegmentredraw\n   */\n  undo() {\n    if (this.#offsets.length !== 0) {\n      // re-draw in image\n      if (typeof this.#segment.displayRGBValue !== 'undefined') {\n        this.#mask.setAtOffsets(this.#offsets, this.#segment.number);\n      } else {\n        this.#mask.setAtOffsets(this.#offsets, this.#segment.displayValue);\n      }\n    }\n    // add back to segments\n    const segHelper = new MaskSegmentHelper(this.#mask);\n    segHelper.addSegment(this.#segment);\n\n    // callback\n    /**\n     * Segment redraw event.\n     *\n     * @event DeleteSegmentCommand#masksegmentredraw\n     * @type {object}\n     * @property {number} segmentnumber The segment number.\n     */\n    this.onUndo({\n      type: 'masksegmentredraw',\n      segmentnumber: this.#segment.number\n    });\n  }\n\n  /**\n   * Handle an execute event.\n   *\n   * @param {object} _event The execute event with type and id.\n   */\n  onExecute(_event) {\n    // default does nothing.\n  }\n\n  /**\n   * Handle an undo event.\n   *\n   * @param {object} _event The undo event with type and id.\n   */\n  onUndo(_event) {\n    // default does nothing.\n  }\n\n} // DeleteSegmentCommand class\n","import {Command} from '../utils/undoStack.js';\n\n// doc imports\n/* eslint-disable no-unused-vars */\nimport {Image} from './image.js';\nimport {MaskSegment} from '../dicom/dicomSegment.js';\nimport {RGB} from '../utils/colour.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Change segment colour command.\n */\nexport class ChangeSegmentColourCommand extends Command {\n\n  /**\n   * The associated mask.\n   *\n   * @type {Image}\n   */\n  #mask;\n\n  /**\n   * The segment to modify.\n   *\n   * @type {MaskSegment}\n   */\n  #segment;\n\n  /**\n   * The new segment colour.\n   *\n   * @type {RGB|number}\n   */\n  #newColour;\n\n  /**\n   * The previous segment colour.\n   *\n   * @type {RGB|number}\n   */\n  #previousColour;\n\n  /**\n   * Flag to send creation events.\n   *\n   * @type {boolean}\n   */\n  #isSilent;\n\n  /**\n   * List of offsets.\n   *\n   * @type {number[]}\n   */\n  #offsets;\n\n  /**\n   * @param {Image} mask The mask image.\n   * @param {MaskSegment} segment The segment to modify.\n   * @param {RGB|number} newColour The new segment colour.\n   * @param {boolean} [silent] Whether to send a creation event or not.\n   */\n  constructor(mask, segment, newColour, silent) {\n    super();\n    this.#mask = mask;\n    this.#segment = segment;\n    this.#newColour = newColour;\n\n    this.#isSilent = (typeof silent === 'undefined') ? false : silent;\n    // list of offsets with the colour to delete\n    if (typeof segment.displayRGBValue !== 'undefined') {\n      this.#previousColour = segment.displayRGBValue;\n    } else {\n      this.#previousColour = segment.displayValue;\n      this.#offsets = mask.getOffsets(this.#previousColour);\n    }\n  }\n\n  /**\n   * Get the command name.\n   *\n   * @returns {string} The command name.\n   */\n  getName() {\n    return 'Change-segment-colour';\n  }\n\n  /**\n   * Check if a command is valid and can be executed.\n   *\n   * @returns {boolean} True if the command is valid.\n   */\n  isValid() {\n    let valid = true;\n    if (typeof this.#offsets !== 'undefined') {\n      valid = this.#offsets.length !== 0;\n    }\n    return valid;\n  }\n\n  /**\n   * Execute the command.\n   *\n   * @fires ChangeSegmentColourCommand#changemasksegmentcolour\n   */\n  execute() {\n    // update segment property\n    if (typeof this.#newColour === 'number') {\n      // remove\n      this.#mask.setAtOffsets(this.#offsets, this.#newColour);\n      // update segment\n      this.#segment.displayValue = this.#newColour;\n    } else {\n      // update palette colour map (sends update event)\n      this.#mask.updatePaletteColourMap(\n        this.#segment.number,\n        this.#newColour\n      );\n      // update segment\n      this.#segment.displayRGBValue = this.#newColour;\n    }\n\n    // callback\n    if (!this.#isSilent) {\n      /**\n       * Segment delete event.\n       *\n       * @event ChangeSegmentColourCommand#changemasksegmentcolour\n       * @type {object}\n       * @property {number} segmentnumber The segment number.\n       */\n      this.onExecute({\n        type: 'changemasksegmentcolour',\n        segmentnumber: this.#segment.number,\n        value: [this.#newColour]\n      });\n    }\n  }\n\n  /**\n   * Undo the command.\n   *\n   * @fires ChangeSegmentColourCommand#changemasksegmentcolour\n   */\n  undo() {\n    // update segment property\n    if (typeof this.#previousColour === 'number') {\n      // update values\n      this.#mask.setAtOffsets(this.#offsets, this.#previousColour);\n      // update segment\n      this.#segment.displayValue = this.#previousColour;\n    } else {\n      // update palette colour map (sends update event)\n      this.#mask.updatePaletteColourMap(\n        this.#segment.number,\n        this.#previousColour\n      );\n      // udpate segment\n      this.#segment.displayRGBValue = this.#previousColour;\n    }\n\n    // callback\n    /**\n     * Segment redraw event.\n     *\n     * @event ChangeSegmentColourCommand#changemasksegmentcolour\n     * @type {object}\n     * @property {number} segmentnumber The segment number.\n     */\n    this.onUndo({\n      type: 'changemasksegmentcolour',\n      segmentnumber: this.#segment.number,\n      value: [this.#previousColour]\n    });\n  }\n\n  /**\n   * Handle an execute event.\n   *\n   * @param {object} _event The execute event with type and id.\n   */\n  onExecute(_event) {\n    // default does nothing.\n  }\n\n  /**\n   * Handle an undo event.\n   *\n   * @param {object} _event The undo event with type and id.\n   */\n  onUndo(_event) {\n    // default does nothing.\n  }\n\n} // ChangeSegmentColourCommand class\n","// doc imports\n/* eslint-disable no-unused-vars */\nimport {Point} from '../math/point.js';\nimport {Value} from '../math/value.js';\n/* eslint-enable no-unused-vars */\n\n/**\n * Diameter type.\n */\nexport class Diameter {\n  /**\n   * The scaled diameter value.\n   *\n   * @type {Value}\n   */\n  diameter;\n\n  /**\n   * The offset of the pixel at the start\n   * of the line used to calculate this diameter.\n   *\n   * @type {number}\n   */\n  offset1;\n\n  /**\n   * The offset of the pixel at the end\n   * of the line used to calculate this diameter.\n   *\n   * @type {number}\n   */\n  offset2;\n}\n\n/**\n * Diameters type.\n */\nexport class Diameters {\n  /**\n   * The major (longest) diameter of the segment.\n   *\n   * @type {Diameter}\n   */\n  major;\n\n  /**\n   * The minor (longest perpendicular to the major) diameter of the segment.\n   *\n   * @type {Diameter}\n   */\n  minor;\n}\n\n/**\n * Label type.\n */\nexport class Label {\n  /**\n   * The world coordinates of the centroid.\n   *\n   * @type {Point}\n   */\n  centroid;\n\n  /**\n   * The closest voxel Index to the centroid.\n   *\n   * @type {number[]}\n   */\n  centroidIndex;\n\n  /**\n   * The volume of the labeled segment.\n   *\n   * @type {Value}\n   */\n  volume;\n\n  /**\n   * The voxel count of the labeled segment.\n   *\n   * @type {number}\n   */\n  count;\n\n  /**\n   * The diameters of the segment.\n   *\n   * @type {Diameters}\n   */\n  diameters;\n\n  /**\n   * The scaled height of the segment.\n   *\n   * @type {Value}\n   */\n  height;\n\n  /**\n   * The segment label id.\n   *\n   * @type {number}\n   */\n  id;\n\n  /**\n   * The Z index of the largest slice of the segment.\n   *\n   * @type {number}\n   */\n  largestSliceZ;\n}","/**\n * Mutable 2D scalar ({x,y}).\n */\nexport class Scalar2D {\n  /**\n   * X value.\n   *\n   * @type {number}\n   */\n  x;\n\n  /**\n   * Y value.\n   *\n   * @type {number}\n   */\n  y;\n}\n\n/**\n * Mutable 3D scalar ({x,y,z}).\n */\nexport class Scalar3D {\n  /**\n   * X value.\n   *\n   * @type {number}\n   */\n  x;\n\n  /**\n   * Y value.\n   *\n   * @type {number}\n   */\n  y;\n\n  /**\n   * Z value.\n   *\n   * @type {number}\n   */\n  z;\n}","/**\n * Class to store a value and a unit.\n */\nexport class Value {\n  /**\n   * @type {number}\n   */\n  value;\n  /**\n   * @type {string|undefined}\n   */\n  unit;\n}\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","chunkId","obj","prop","prototype","hasOwnProperty","call","scriptUrl","url","Error","replace","p","b","document","baseURI","self","location","href","Index","constructor","values","length","every","val","isNaN","this","i","toString","getValues","slice","canCompare","rhs","equals","leni","compare","diffDims","push","add","dim","value","console","warn","next","previous","getWithNew2D","j","l","lenl","ModalityLut","rsi","bitsStored","isID","Math","pow","Float32Array","apply","getRSI","getLength","getValue","offset","WindowLut","modalityLut","isSigned","isDiscrete","size","getVoiLut","getModalityLut","setVoiLut","lut","setSignedOffset","getSlope","Uint8ClampedArray","floor","buildLut","func","id","invId","lut_range_max","ColourMap","red","green","blue","luts","plain","invPlain","rainbow","hot","third","hot_iron","pet","hot_metal_blue","pet_20step","logger","levels","TRACE","DEBUG","INFO","WARN","ERROR","level","trace","msg","debug","info","error","VoiLutFunctionNames","linear","linear_exact","sigmoid","VoiLutLinearFunction","center","width","isExact","c","w","getY","x","res","VoiLutSigmoidFunction","exp","VoiLut","wl","voiLutFunctionName","names","includes","getWindowLevel","WindowLevel","equalWl","wl0","wl1","validateWindowLevel","range","centerBound","min","max","minWindowWidth","widthBound","RGB","r","g","isEqualRgb","c1","c2","hexToRgb","hexStr","parseInt","substring","rgbToHex","rgb","labToUintLab","triplet","a","d65","y","z","srgbToCielab","labFunc","illuminant","fy","ciexyzToCielab","invGammaFunc","rl","gl","bl","srgbToCiexyz","colourNameToHex","name","dict","Yellow","Red","White","Green","Blue","Lime","Fuchsia","Black","custom","wlPresets","undefined","labelTexts","privateBValueRules","openRoiDialog","getVolumeIdTagValue","getPostLoadVolumeIdTagValue","getTagPixelUnit","defaultWlPresets","CT","mediastinum","lung","bone","brain","head","ViewFactory","create","dataElements","image","view","View","getPhotometricInterpretation","setColourMap","windowPresets","getMeta","minmax","modality","Modality","preset","setWindowPresets","Vector3D","getX","getZ","norm","sqrt","crossProduct","vector3D","dotProduct","isCodirectional","Point2D","getCentroid","getDistance","point2D","dx","dy","Point3D","isSimilar","tol","point3D","dz","getClosest","pointList","minIndex","minDist","dist","minus","Point","get3D","values0","values1","mergeWith3D","Number","EPSILON","REAL_WORLD_EPSILON","abs","Matrix33","row","col","getInverse","m","m00","m01","m02","m10","m11","m12","m20","m21","m22","a1212","a2012","a0112","det","getMatrixInverse","str","multiply","tmp","k","getAbs","multiplyArray3D","array3D","a0","a1","a2","Array","multiplyTypedArray3D","sourceArray","outArray","multiplyVector3D","multiplyPoint3D","multiplyIndex3D","index3D","getRowAbsMax","absMax","index","indexOf","getColAbsMax","asOneAndZeros","sign","getThirdColMajorDirection","getIdentityMat33","isIdentityMat33","mat33","dataAccessor","start","maxIter","increment","blockMaxIter","blockIncrement","reverse1","reverse2","nextIndex","finalBlockIncrement","mainCount","blockCount","result","done","getIteratorValues","iterator","ival","getSliceIterator","isRescaled","viewOrientation","getGeometry","getSize","dirMax2Index","posValues","posStart","map","element","indexToOffset","getRescaledValueAtOffset","getValueAtOffset","ncols","nrows","nslices","sliceSize","getDimSize","ncomp","getNumberOfComponents","isPlanar","getPlanarConfiguration","getRange","iters","r0","r1","r2","range3d","rangeObj","dirMax0","dirMax2","end","simpleRange","componentIncrement","nextIndex1","nextIndex2","simpleRange3d","valueRange","nextValueIndex","ListenerHandler","type","callback","remove","nFound","splice","fireEvent","event","stack","RescaleSlopeAndIntercept","slope","intercept","getIntercept","MaskSegmentViewHelper","segmentNumber","isHidden","addToHidden","removeFromHidden","viewEventNames","createView","elements","_value","_index","#maskAlphaFuntion","getContourThickness","getContourDistance","getOrientation","getFillOpacity","setImage","getImage","getCurrentPosition","setCurrentIndex","isMask","addEventListener","getCurrentIndex","setMaskViewHelper","helper","setOrientation","setFillOpacity","opacity","setContourThickness","thickness","fill","normaliseIndex","getPlaybackMilliseconds","recommendedDisplayFrameRate","round","getAlphaFunction","setAlphaFunction","perslice","isResampled","currentIndex","getSecondaryOffset","sliceWl","setWindowLevel","setWindowLevelPresetById","isConstantRSI","getRescaleSlopeAndIntercept","BitsStored","PixelRepresentation","voiLut","voiLutWl","VOILUTFunction","getWindowPresets","getWindowPresetsNames","keys","presets","addWindowPresets","getCurrentWindowPresetName","getColourMap","position","worldToIndex","getCurrentImageUid","getImageUid","getOriginForImageUid","uid","includesImageUid","isPositionInBounds","geometry","dirs","getScrollDimIndex","isIndexInBounds","getOrigin","originIndex","getOrigins","silent","indexToWorld","setCurrentPosition","inPosition","normalisePoint","valid","minLen","maxLen","posEvent","data","imageUid","canQuantify","pixValue","getRescaledValueAtIndex","wlBound","getRescaledDataRange","isNewWl","isNewName","manual","wc","ww","skipGenerate","setWindowLevelPreset","getWindowLevelMinMax","removeEventListener","setWindowLevelMinMax","generateImageData","photoInterpretation","array","alphaFunc","windowLut","colourMap","pxValue","generateImageDataMonochrome","is16BitsStored","to8","generateImageDataPaletteColor","getPaletteColourMap","generateImageDataRgb","cb","cr","generateImageDataYbrFull","orientation","isAquisitionOrientation","i18n","t","props","split","mm","cm2","ml","degree","pixel","startsWith","search","rawPos","pos","endsWith","getFlags","inputStr","flags","regex","match","exec","getFileExtension","filePath","ext","pathSplit","toLowerCase","pop","test","stringToUint8Array","arr","Uint8Array","charCodeAt","precisionRound","number","precision","factor","delta","toStringId","dims","arrayMap","arr0","arr1","v","checkAndApply","concat","arraySortEquals","arrayEquals","sort","uint8ArrayToString","String","fromCharCode","findInArraySubset","callbackFn","getFindArrayInArrayCallback","buildMultipart","parts","boundary","lineBreak","partsSize","headers","headerStr","partKeys","header","byteLength","trailer","buffer","set","dictionary","addTagsToDictionary","group","tags","tagGroups","vr32bitVL","OB","OD","OF","OL","OV","OW","SQ","SV","UC","UN","UR","UT","UV","ox","is32bitVLVR","vr","vrCharSetString","SH","LO","ST","LT","PN","isCharSetStringVR","vrTypes","AE","AS","AT","CS","DA","DS","DT","FL","FD","IS","SL","SS","TM","UI","UL","US","transferSyntaxes","transferSyntaxKeywords","Tag","getGroup","getElement","getKey","getNameFromDictionary","getGroupName","isWithVR","isPrivate","getVrFromDictionary","getMultiplicityFromDictionary","multiplicity","tagCompareFunction","getTagFromKey","getItemTag","isItemTag","tag","isItemDelimitationItemTag","isSequenceDelimitationItemTag","getPixelDataTag","isAnyPixelDataTag","getAnyPixelDataElement","hasAnyPixelDataElement","getTagFromDictionary","tagName","keys0","keys1","foundTag","k0","lenK0","k1","lenK1","getSimpleElementReducer","accumulator","currentValue","currentMeta","property","tagValue","item","reduce","getAsSimpleElements","metaData","meta","structuredClone","DataElement","vl","undefinedLength","startOffset","endOffset","items","hasValue","safeGet","safeGetAll","checkDataElement","warning","flipArrayEndianness","blen","u8","byteOffset","bpe","BYTES_PER_ELEMENT","DataReader","Int8Array","Int16Array","isNativeLittleEndian","isLittleEndian","DataView","readUint16","getUint16","readInt16","getInt16","readUint32","getUint32","readBigUint64","getBigUint64","readInt32","getInt32","readBigInt64","getBigInt64","readFloat32","getFloat32","readFloat64","getFloat64","readBinaryArray","outputSize","bitArray","byteArrayLength","bitNumber","bitIndex","readUint8Array","readInt8Array","readUint16Array","Uint16Array","arraySize","readInt16Array","readUint32Array","Uint32Array","readUint64Array","BigUint64Array","readInt32Array","Int32Array","readInt64Array","BigInt64Array","readFloat32Array","readFloat64Array","Float64Array","readHex","toUpperCase","getDwvVersion","splitVersion","version","versions","s","compareVersions","splitA","splitB","betaIndex","betaA","betaB","hasDicomPrefix","current","ZWS","DefaultTextDecoder","decode","getReverseOrientation","ori","rlabels","L","R","A","P","H","F","rori","n","isImplicitTransferSyntax","syntax","isBigEndianTransferSyntax","isJpegBaselineTransferSyntax","isJpegLosslessTransferSyntax","isJpeg2000TransferSyntax","isRleTransferSyntax","getTypedArray","bitsAllocated","pixelRepresentation","RangeError","powerOf2","log","getDataElementPrefixByteSize","isImplicit","TagKeys","DicomParser","getDefaultCharacterSet","setDefaultCharacterSet","characterSet","setDecoderCharacterSet","TextDecoder","getDicomElements","reader","implicit","itemData","isSeqDelim","isItemDelim","offsetTableVl","untilTag","readTagRes","is32bitVL","isKnownVR","pixItemData","sqEndOffset","pixelTags","vrType","imageBufferSize","from","stream","lastIndex","trim","cleanString","raw","stri","stri1","sqBitsAllocated","sqPixelRepresentation","dataElement","sqPixelTags","subElement","parse","metaReader","dataReader","magicword","metaEnd","tsElement","firstDataElement","oEightGroupLittleEndian","vr0","vr1","guessTransferSyntax","isReadSupportedTransferSyntax","getTransferSyntaxName","reachedUntilTag","rows","cols","numberOfFrames","charSetTerm","label","getUtfLabel","pixItems","nItemPerFrame","newPixItems","f","newBuffer","fragOffset","Size","moreThanOne","dimension","canScroll3D","canScroll","getTotalSize","isInBounds","dimMax","dimIndex","offsetToIndex","off","dimSize","get2D","inValues","extraValues","point","extra","newValues","Spacing","Statistics","mean","stdDev","median","p25","p75","getStats","includesFullStatsFlags","stats","getBasicStats","getPercentile","getFullStats","sum","sumSqr","variance","ratio","i0","v0","NumberRange","BooleanResult","success","message","Geometry","origins","spacing","time","clone","getInitialTime","setInitialTime","getCurrentTotalNumberOfSlices","count","hasSlicesAtTime","getCurrentNumberOfSlicesBeforeTime","includesOrigin","getOrientedArray3D","updateSliceSpacing","geoSliceSpacing","spacings","origin1","origin2","sliceSpacing","getSliceGeometrySpacing","getSpacing","orientedValues","getRealSpacing","getSliceIndex","localOrigins","closestOriginIndex","closestOrigin","pointDir","canAppend","rhsSize","canAppendOrigin","origin","equalToOrigin","find","appendOrigin","appendFrame","sizeValues","spacingValues","nDims","minValues","maxIndex","orientedPoint3D","pointToWorld","worldToPoint","getDeOrientedArray3D","getCoronalMat33","Orientation","Axial","Coronal","Sagittal","getMatrixFromName","matrix","getOrientationStringLPS","v1","v2","getVectorStringLPS","vector","orientationX","orientationY","orientationZ","threshold","getOrientationName","cosines","orientMatrix","getOrientationFromCosines","code","orientStr","getLPSGroup","orientationMatrix","rowCosines","colCosines","normal","getViewOrientation","imageOrientation","targetOrientation","TransferSyntax","SOPClassUID","ReferencedSeriesSequence","SeriesInstanceUID","Rows","Columns","PixelSpacing","ImagerPixelSpacing","NominalScannedPixelSpacing","DistanceSourceToDetector","DistanceSourceToPatient","EstimatedRadiographicMagnificationFactor","PixelAspectRatio","SpacingBetweenSlices","RescaleType","Units","ImageOrientationPatient","PhotometricInterpretation","SamplesPerPixel","PixelMeasuresSequence","SharedFunctionalGroupsSequence","PerFrameFunctionalGroupsSequence","getImage2DSize","columns","get2DSpacingValues","tagKey","parseFloat","get2DSpacingValuesFromFuncGroup","funcGroupElements","pixelMeasuresSeq","getSpacingFromMeasure","sbs","photometricInterpretation","transferSyntax","photo","isMonochrome","samplesPerPixel","getReferencedSeriesUID","refSeriesSq","NormalisedManufacturers","GE","SIEMENS","PHILIPS","HITASHI","getManufacturer","getNormalisedManufacturer","manufacturer","LocalBValueRules","SOPClassUIDs","getDiffusionBValueFromFunctionalSeq","diffSeq","getStandardDiffusionBValueFromEMR","sharedGroupSeq","perFrameGroupSeq","getDiffusionBValue","sopClassUID","gotBValuePointer","indexSeq","pointer","frameContentSeq","dimValues","getDiffusionBValueFromFrameContent","getNonStandardDiffusionBValueFromEMR","sopInstanceUID","rules","rule","uidPrefix","getNonStandardDiffusionBValueFromMR","volumeId","bvalue","getMRVolumeIdTagValue","acqTime","getDateObj","daValue","monthBeginIndex","dayBeginIndex","year","monthIndex","day","getTimeObj","tmValue","tmHours","tmMinutes","tmSeconds","tmFracSecondsStr","hours","minutes","seconds","milliseconds","getDate","dateObj","timeObj","Date","dateToDateObj","date","getFullYear","getMonth","dateToTimeObj","getHours","getMinutes","getSeconds","getMilliseconds","getDicomDate","padStart","getDicomTime","MetaTagKeys","PatientName","PatientID","PatientBirthDate","PatientSex","StudyDate","StudyTime","StudyInstanceUID","StudyID","StudyDescription","ReferringPhysicianName","SeriesDate","SeriesTime","SeriesNumber","FrameOfReferenceUID","Manufacturer","ManufacturerModelName","DeviceSerialNumber","SoftwareVersions","LossyImageCompression","ImageFactory","getWarning","checkElements","suvFactor","patWeight","patWeightEl","weight","decayedDose","seriesDateObj","totalDose","halfLife","radioStart","radioInfoSq","totalDoseStr","totalDoseEl","dose","halfLifeStr","halfLifeEl","hl","radioStartDateTimeEl","radioStartDateObj","radioStartTimeObj","radioStartDateTime","dtValue","dateDataElement","dtDate","timeDataElement","getDateTimeObj","scanStart","acqDateEl","acqTimeEl","acqDateObj","acqTimeObj","acqDate","getTime","frameRefTime","frameRefTimeElStr","frameRefTimeEl","actualFrameDuration","actualFrameDurationElStr","actualFrameDurationEl","decayConstant","decayDuringFrame","offsetSeconds","decayTime","getDecayedDose","getSuvFactor","pixelBuffer","numberOfFiles","safeGetLocal","size2D","spacing2D","magnification","d0","d1","getProjection2DSpacingValues","getSecondaryCapture2DSpacingValues","sharedFunctionalGroupsSeq","perFrameFunctionalGroupsSeq","getMultiFrame2DSpacingValues","getPixelSpacing","imagePositionPatient","slicePosition","imageOrientationPatient","getOrientationMatrix","sopInstanceUid","bufferSize","Image","setPhotometricInterpretation","planarConfiguration","setPlanarConfiguration","rescaleSlope","rescaleIntercept","isPetWithSuv","intensityFactor","setRescaleSlopeAndIntercept","descriptor","redLut","greenLut","blueLut","redLutElement","greenLutElement","blueLutElement","doScale","descSize","vlSize","scaleTo8","setPaletteColourMap","TransferSyntaxUID","MediaStorageSOPClassUID","ImageType","BitsAllocated","HighBit","metaKeys","pixelUnit","unit","defaultGetTagPixelUnit","lengthUnit","windowCenter","windowWidth","windowCWExplanation","setMeta","DataWriter","writeUint8","setUint8","writeInt8","setInt8","writeUint16","setUint16","writeInt16","setInt16","writeUint32","setUint32","writeUint64","setBigUint64","writeInt32","setInt32","writeInt64","setBigInt64","writeFloat32","setFloat32","writeFloat64","setFloat64","writeHex","writeBinaryArray","byte","len","writeUint8Array","writeInt8Array","writeUint16Array","writeInt16Array","writeUint32Array","writeUint64Array","writeInt32Array","writeInt64Array","writeFloat32Array","writeFloat64Array","_uidCount","WriterRule","action","writerActions","copy","clear","getUID","datePart","toISOString","countPart","getDwvUIDPrefix","nonTagLength","prefix","tagNumber","isEven","isStringVr","uint8ArrayPush","newArr","DefaultTextEncoder","encode","DicomWriter","default","setUseUnVrForPrivateSq","flag","setFixUnknownVR","setRules","addMissingTags","isKey","useSpecialTextEncoder","TextEncoder","getElementToWrite","groupName","writer","isItemTagWithNoVR","itemTag","subItem","itemElement","itemDelimElement","newSize","ceil","padd","valueItem","hexString","hexString1","hexString2","atValue","diff","sqItem","finalValue","initialArray","flattenendArrayLength","subArray","flattenedArray","flattenArrayOfTypedArrays","isTagWithVR","undefinedLengthSequence","undefinedLengthItem","seqDelimElement","getBuffer","isBigEndian","oldscs","totalSize","localSize","metaElements","rawElements","metaLength","fmiglTag","fmivTag","icUIDTag","ivnTag","missingTags","originalElement","checkAndFixUnknownVR","fmiv","getDataElement","fmivSize","icUID","icUIDSize","icUIDValue","ivn","ivnSize","elemSortFunc","fmigl","fmiglSize","ArrayBuffer","metaWriter","dataWriter","metaElement","metaOffset","rawElement","newItems","oldItemElements","newItemElements","subSize","itemKeys","itemKey","padStr","pad","getVrPad","join","padOBValue","isTypedArrayVr","isArray","itemPrefixSize","getBpeForVrType","dictVr","getUint8ToVrValue","getElementsFromJSONTags","simpleTags","simpleTag","DicomCode","meaning","longValue","urnValue","schemeDesignator","isEqualCode","code1","code2","getCode","getDicomCodeItem","CodeValue","LongCodeValue","URNCodeValue","CodingSchemeDesignator","CodeMeaning","DcmCodes","SctCodes","UcumCodes","deg","getDcmDicomCode","dcmCode","getDicomCode","scheme","getSegmentationCode","getColourCode","QuantificationName2DictItem","angle","surface","height","radius","stddev","QuantificationUnit2UcumKey","HU","MGML","ED","PCT","CNTS","NONE","CM2","CM2ML","PCNT","CPS","BQML","MGMINML","UMOLMINML","MLMING","MLG","UMOLML","PROPCNTS","PROPCPS","MLMINML","MLML","GML","SUV","getMeasurementUnitsCode","MaskSegment","algorithmType","algorithmName","displayValue","displayRGBValue","propertyTypeCode","propertyCategoryCode","trackingUid","trackingId","getSegment","segment","cielabElement","gammaFunc","ciexyzToSrgb","invLabFunc","l0","cielabToCiexyz","cielabToSrgb","colours","colour","random","getDefaultColour","getDicomSegmentItem","algoType","segmentItem","SegmentNumber","SegmentLabel","SegmentAlgorithmType","SegmentAlgorithmName","cieLab","RecommendedDisplayCIELabValue","RecommendedDisplayGrayscaleValue","SegmentedPropertyCategoryCodeSequence","SegmentedPropertyTypeCodeSequence","TrackingID","TrackingUID","DicomSegmentFrameInfo","imagePosPat","derivationImages","refSegmentNumber","getSegmentFrameInfo","derivationImageSq","sourceImages","sourceImageSq","sourceImage","referencedSOPClassUID","referencedSOPInstanceUID","segmentIdSq","frameInfo","framePlaneOrientationSeq","frameImageOrientation","framePixelMeasuresSeq","frameSpacing","getDicomSegmentFrameInfoItem","FrameContentSequence","DimensionIndexValues","PlanePositionSequence","ImagePositionPatient","SegmentIdentificationSequence","ReferencedSegmentNumber","sourceImgPurposeOfReferenceCode","segDerivationCode","derivationImageItems","derivationImage","PurposeOfReferenceCodeSequence","ReferencedSOPClassUID","ReferencedSOPInstanceUID","DerivationCodeSequence","SourceImageSequence","DerivationImageSequence","checkTag","tagDefinition","enum","createRoiSliceBuffers","segments","sliceOffset","buffers","inputOffset","pixelValue","segmentIndex","RequiredDicomTags","getDefaultDicomSegJson","MaskFactory","_dicomElements","refImage","safeGetAllLocal","orgSq","orgUID","indices","indexSqElem","indexSq","indexPointer","indexOrg","DimensionOrganizationUID","DimensionIndexPointer","DimensionDescriptionLabel","organizations","getDimensionOrganization","segSequence","paletteColourMap","hasDisplayRGBValue","funcGroup0","planeOrientationSeq","includesPosPat","some","arrVal","pos1","pos2","JSON","stringify","findPointIndex","findIndex","perFrameFuncGroupSequence","frameInfos","framePosPats","ii","invOrientation","p1","p2","getComparePosPat","point3DFromArray","frameOrigins","framePosPat","numberOfSlices","getFindSegmentFunc","maskOrigins","sliceIndex","frameOffset","frameSegment","uids","DimensionOrganizationSequence","DimensionIndexSequence","SOPInstanceUID","refOrigins","previousIndex","frameOrigin","tmpGeometry","isAboveEpsilon","distPrevious","toDicom","extraTags","now","ContentDate","ContentTime","segmentItems","SegmentSequence","PlaneOrientationSequence","roiBuffers","key0","createRoiBuffers","finalBuffers","referencedSOPs","number40","number4","key1","posPat","posPatArray","sourceIndex","NumberOfFrames","frameInfosTag","refSeriesTag","ReferencedInstanceSequence","tags1","tags2","keys2","tagName2","mergeTags","dicomElements","pixVl","de","ThreadPool","poolSize","taskQueue","freeThreads","runningThreads","WorkerThread","addWorkerTask","workerTask","onworkstart","workerThread","shift","run","abort","onabort","onworkend","onTaskEnd","stop","getId","onwork","handleWorkerError","onerror","_event","onworkitem","parentPool","runningTask","worker","getWorker","onmessage","postMessage","startMessage","terminate","itemNumber","numberOfItems","indexOrigin","WorkerTask","LabelingWorkerTask","super","Worker","URL","LabelingThread","e","imageBuffer","ondone","imageGeometry","imageSize","imageSpacing","ndims","unitVectors","d","sizes","generateWorkerMessage","ResamplingWorkerTask","ResamplingThread","sourceImageBuffer","sourceImageGeometry","interpolated","centerOfRotation","jobId","targetImageGeometry","sourceOrientation","relativeMatrix","sourceSize","sourceSpacing","sourceSpacingArr","maxSpacingBounds","minSpacingBounds","boundPoint","orientedBoundPoint","targetSpacingArrMax","targetSpacingMaxVolume","sourceSpacingVolume","volumeRatio","cbrt","targetSpacingArr","sourceSpacingNDims","targetSpacing","boundIndex","firstValue","maxBounds","minBounds","sizeArr","sourceSizeNDims","targetSize","sourceCenterIndex","targetCenterIndexArr","relativeSourceCenterOffsetArr","relativeTargetCenterOffsetArr","targetCenterIndexSpaced","targetCenterPointLocal","sourceCenterPoint","targetOrigin","unitVector","targetUnit","targetOrigins","generateResampledGeometry","targetImageBuffer","generateBuffer","workerMessages","sourceNDims","targetNDims","sourceUnitVectors","targetUnitVectors","sourceTotalSize","targetTotalSize","generateMessage","sourceStartOffset","targetStartOffset","frame","sourceOrigin","interpolate","frames","sourceFrameSize","targetFrameSize","messages","sourceOffset","targetOffset","generateWorkerMessages","ondoneframe","forEach","workerMessage","imageEventNames","createImage","createMaskImage","imageUids","setComplete","getComplete","uidIndex","containsImageUids","itemArr1","arrayContains","canWindowLevel","nFiles","inRsi","isIdentityRSI","interp","updatePaletteColourMap","config","getOffsets","bufferValue","offsets","equal","hasValues","finalValues","equalFunc","getEqualCallback","valuesToFind","indicesToRemove","clonedBuffer","tmpBuffer","geoCanAppend","appendSlice","rhsRange","getDataRange","rhsResRange","resRange","timeId","isNewFrame","volumeGeometry","sliceGeometry","fullBufferSize","contourSize","fullSliceIndex","indexOffset","totalSlices","maxOffset","subarray","contourSliceSize","contourIndexOffset","contourMaxOffset","numberOfImages","rhsPresets","pkey","rhsPreset","windowPreset","appendFrameBuffer","frameBuffer","frameIndex","frameSize","calculateDataRange","calculateRescaledDataRange","getHistogram","calculateHistogram","dataRange","rescaledDataRange","histogram","setAtOffsets","xOffset","yOffset","zOffset","MAX_CONTOUR_SIZE","setAtOffsetsAndGetOriginals","offsetsLists","originalValuesLists","previousValue","originalValues","setAtOffsetsWithIterator","isValueArray","getValueAtIndex","getRescaledValue","resmin","resmax","rmin","rmax","rvalue","histo","convolute2D","weights","newImage","imgSize","dimOffset","convoluteBuffer","componentOffset","wOff","wOff00","wOff0x","wOff0n","wOffx0","wOffxn","wOffn0","wOffnx","wOffnn","pixelOffset","newValue","wOffFinal","wi","transform","operator","compose","initializeContour","countourIsInitialized","distance","direction","checkValue","queue","newIndex","newDistance","borderCheck","yDirection","xDirection","yDim","xDim","orientationIndex","contourIndex","bufferedDistance","operationQueue","yDimSize","xDimSize","opCount","maxOps","distanceCheck","operation","Infinity","recalculateLabels","pixelVolume","volumeUnit","labels","majorDiameter","minorDiameter","centroid","centroidIndex","volume","diameters","major","diameter","minor","labelsSorted","resample","_","source","resampled","revert","annotationGroupEventNames","AnnotationGroup","list","getList","isEditable","setEditable","getColour","setColour","annotation","propagate","update","propKeys","updateQuantification","setViewController","viewController","hasMeta","getMetaValue","setMetaValue","MeasuredValue","numericValue","floatingPointValue","rationalNumeratorValue","rationalDenominatorValue","measurementUnitsCode","getDicomMeasuredValueItem","MeasurementUnitsCodeSequence","FloatingPointValue","RationalNumeratorValue","RationalDenominatorValue","NumericValue","NumericMeasurement","measuredValue","numericValueQualifierCode","getDicomNumericMeasurementItem","measurement","MeasuredValueSequence","NumericValueQualifierCodeSequence","SopInstanceReference","getSopInstanceReference","ref","getDicomSopInstanceReferenceItem","ImageReference","referencedSOPSequence","referencedFrameNumber","referencedSegmentNumber","getDicomImageReferenceItem","ReferencedFrameNumber","ReferencedSOPSequence","Line","begin","getBegin","getEnd","getDeltaX","getDeltaY","getWorldLength","wlen","dxs","dys","getMidpoint","getInclination","atan2","PI","getFlipped","quantify","get2DSpacing","worldLength","getLengthUnit","getAngle","line0","line1","dx0","dy0","dx1","dy1","dot","areOrthogonal","getPerpendicularLine","line","perpSlope","getLineFromEquation","getPerpendicularLineAtDistance","lineFromEq","startPoint","minX","maxX","minY","maxY","isPointInLineRange","beginX","beginY","endX","endY","sx2","sy2","Protractor","points","getPoint","_viewController","_flags","angleNumber","ROI","getPoints","addPoint","addPoints","cx","cy","pi","pi1","ai","Circle","centre","getCenter","getRadius","getSurface","getWorldSurface","mulABC","getRound","centerX","centerY","rSquare","regions","transX","worldSurface","quant","canQuantifyImage","getImageVariableRegionValues","getPixelUnit","quantif","Ellipse","getA","getB","radiusX","radiusY","radiusRatio","rySquare","getEllipseIndices","dir","centerValues","radiusI","radiusJ","radiusJ2","di","dj","jmax","jmin","imax","imin","Rectangle","getRealWidth","getRealHeight","getWidth","getHeight","getImageRegionValues","getRectangleIndices","sizeI","halfSizeI","sizeJ","halfSizeJ","GraphicTypes","SpatialCoordinate","graphicData","graphicType","pixelOriginInterpretation","fiducialUID","getDicomSpatialCoordinateItem","scoord","PixelOriginInterpretation","GraphicData","GraphicType","FiducialUID","getScoordFromShape","shape","firstPoint","pointPerimeter","getShapeFromScoord","dataLength","isClosed","numberOfPoints","lastPoint","line2","line3","SpatialCoordinate3D","referencedFrameofReferenceUID","getDicomSpatialCoordinate3DItem","ReferencedFrameofReferenceUID","RelationshipType","ValueType","ConceptNameCodeSequence","ConceptCodeSequence","ContentSequence","DateTime","Time","UID","PersonName","TextValue","ContinuityOfContent","ContentTemplateSequence","MappingResource","TemplateIdentifier","RelationshipTypes","ValueTypes","ContinuityOfContents","ValueTypeValueTagName","TEXT","DATE","TIME","DATETIME","UIDREF","PNAME","CONTAINER","getContentTemplate","template","templateItem","mappingResource","templateId","DicomSRContent","valueType","conceptNameCode","relationshipType","contentSequence","hasHeader","getSRContent","content","getMeasuredValue","getNumericMeasurement","getImageReference","getSpatialCoordinate","getSpatialCoordinate3D","valueTagName","contentSq","getDicomSRContentItem","contentItem","getSRContentFromValue","relation","getConceptNameCode","relationShip","measure","numMeasure","PlaneHelper","getTargetOrientation","getOffset3DFromPlaneOffset","offset2D","planeOffset","getTargetDeOrientedVector3D","getPlaneOffsetFromOffset3D","offset3D","getTargetOrientedVector3D","planeVector","getTargetDeOrientedPoint3D","planePoint","getImageOrientedVector3D","getImageOrientedPoint3D","getImageDeOrientedVector3D","getImageDeOrientedPoint3D","getPositionFromPlanePoint","getPlanePointFromPosition","getCosines","getPlanePoints","snapPosition","planeOrigin","imageOrigin","pValues","iValues","scrollDimIndex","getNativeScrollDimIndex","getTargetOrientedPositiveXYZ","ViewPositionAccessor","PositionHelper","getMaximumDimValue","getMaximumScrollValue","getCurrentPositionDimValue","getCurrentPositionScrollValue","getCurrentPositionAtDimValue","getCurrentPositionAtScrollValue","setCurrentPositionSafe","merge","geometry1","geometry2","minByIndex","array1","array2","maxByIndex","newSpacing","deorient","range1","range2","minRangeValues","maxRangeValues","maxSize","newOrigins","mergeGeometries","getIncrementPosition","getDecrementPosition","incrementPosition","decrementPosition","incrementPositionAlongScroll","decrementPositionAlongScroll","ViewController","getPlaneHelper","updatePlaneHelper","initialise","resetWindowLevel","resetPosition","getModality","getSopClassUid","getWindowLevelPresetsNames","addWindowLevelPresets","isPlaying","getPositionHelper","getCurrentOrientedIndex","getCurrentIndexScrollValue","getCurrentScrollPosition","img","geometry0","getRescaledImageValue","sliceValues","sliceOrigin","imageIndex","rescaled","iter","rangeNumberOfColumns","regionSize","regionOffset","regionElementCount","rangeRegion","getRegionSliceIterator","offsetRegions","region","regionIndex","regionCount","rangeRegions","getVariableRegionSliceIterator","getImageSize","getImageSpacing","getImageWorldSize","getImageRescaledDataRange","equalImageMeta","imageMeta","metaKey","validatePlanePoint","getPlanePositionFromPosition","getIndexFromPosition","getPlanePositionFromPlanePoint","play","RecommendedDisplayFrameRate","window","setInterval","canDoMore","clearInterval","setViewAlphaFunction","bindImageAndLayer","viewLayer","onimagecontentchange","onimagegeometrychange","onimageresampled","unbindImageAndLayer","InteractionEventNames","getTouchesPositions","touches","offsetLeft","offsetTop","target","offsetParent","positions","pageX","pageY","getTouchPoints","targetTouches","changedTouches","getMousePoint","offsetX","offsetY","canCreateCanvas","testCvs","createElement","cropCvs","testCtx","getContext","cropCtx","fillRect","drawImage","getImageData","ViewLayer","containerDiv","className","getDataId","getScale","getAbsoluteZoomOffset","setImageSmoothing","setView","dataId","eventName","bindImage","getViewController","onimageset","dataid","unbindImage","draw","vcSize","vcSpacing","sizeChanged","spacingChanged","origin0","scrollOffset","setBaseOffset","maybeTimeIndex","matchingTimeIndex","removeFromDOM","getBaseSize","getOpacity","setOpacity","alpha","addFlipOffsetX","addFlipOffsetY","flipScaleX","flipScaleY","flipScaleZ","setScale","newScale","orientedNewScale","finalNewScale","resetOffset","worldCenter","newOffset","getScaledOffset","newZoomOffset","initScale","absoluteZoomOffset","layerGroupOrigin","layerGroupOrigin0","needsUpdate","setOffset","newPanOffset","displayToPlaneIndex","planePos","displayToPlanePos","displayToPlaneScale","deScaled","planePosToDisplay","posX","posY","displayToMainPlanePos","display","style","isVisible","layerid","globalAlpha","setTransform","imageSmoothingEnabled","appendChild","alert","clearRect","createImageData","fitToContainer","containerSize","divToWorldSizeRatio","fitOffset","needsDraw","newFitScale","fitRatio","sizeRatio","newViewOffset","scaledImageSize","newFlipOffset","bindInteraction","pointerEvents","passive","unbindInteraction","srclayerid","putImageData","dims3D","indexScrollDimIndex","filter","isValidPosition","save","restore","Command","getName","execute","undo","UndoStack","EventTarget","getStackSize","getCurrentStackIndex","getCurrentCommand","cmd","dispatchEvent","Event","CustomEvent","detail","commandName","redo","AddAnnotationCommand","drawController","addAnnotation","removeAnnotation","RemoveAnnotationCommand","UpdateAnnotationCommand","originaProps","newProps","updateAnnotation","DrawController","getAnnotation","getAnnotationGroup","isAnnotationGroupEditable","setAnnotationGroupEditable","removeAnnotationWithCommand","exeCallback","command","updateAnnotationWithCommand","originalProps","removeAllAnnotationsWithCommand","hasAnnotationMeta","setAnnotationMeta","defaultLabelTexts","arrow","circle","ellipse","protractor","rectangle","roi","ruler","isNodeNameLabel","node","isNodeNameShape","isPositionNode","getLineShape","kshape","getChildren","Konva","getAnchorShape","isNodeWithId","getDefaultAnchor","applyZoomScale","absRadius","stroke","strokeWidth","getStrokeWidth","strokeScaleEnabled","dragOnTop","draggable","visible","getAnchorIndex","Style","getFontFamily","getFontSize","getTextColour","getLineColour","setLineColour","setBaseScale","scale","setZoomScale","getBaseScale","getZoomScale","applyZoomRatio","getShadowOffset","getTagOpacity","getTextPadding","getFontStr","getLineHeight","getScaledFontSize","getScaledStrokeWidth","getShadowLineColour","hexColour","isDarkColour","DrawLayer","setShapeHandler","handler","getReferenceLayerId","getKonvaStage","getKonvaLayer","getLayers","getDrawController","setPlaneHelper","refLayerId","container","listening","getContent","setAttribute","konvaLayer","setAnnotationGroup","annotationGroup","activateCurrentPositionShapes","disableAndResetEditor","allPosGroups","posGroup","removeShapeListeners","shapeGroups","addShapeGroupListeners","posId","planePoints","frameNumber","posGroupId","layerChildren","posChildren","canView","isCompatibleView","stage","factory","getFactory","shapeGroup","createShapeGroup","setLabelVisibility","isAnnotationVisible","setAnnotationVisibility","setLabelsVisibility","posGroups","getText","text","connector","deleteDraw","_id","_exeCallback","deleteDraws","getNumberOfDraws","findOne","ratioX","ratioY","posGroupIdToArray","splitHashes","splitHash","getPosDivId","getLiId","format","encodeURIComponent","InfoLayer","div","onDataChange","srcDetails","getLayerDetailsFromLayerDivId","details","groupDivId","idString","posList","dataPos","ul","li","createTextNode","posElement","querySelector","replaceChildren","layerIndex","layerId","getLayerDetailsFromEvent","layerDiv","closest","indexCenter","LayerGroup","layer","withInfoLayer","getShowCrosshair","setShowCrosshair","getDivId","divId","getAddedScale","getOffset","getNumberOfLayers","getViewLayers","getViewLayersFromActive","activeIndex","someViewLayer","hasOne","getDrawLayers","getNumberOfViewLayers","getActiveLayer","getActiveViewLayer","activeLayer","getBaseViewLayer","baseLayer","getViewLayerById","layers","getViewLayersByDataId","searchViewLayers","metaClone","hasSopInstance","equalMeta","includesSopInstance","check","getViewDataIndices","getActiveDrawLayer","getDrawLayerById","getDrawLayersByDataId","setActiveLayer","unbindInfoData","bindInfoData","setActiveLayerById","setActiveLayerByDataId","addViewLayer","viewLayerIndex","append","addDrawLayer","updateLayersToPositionChange","drawLayer","addInfoData","infoData","empty","removeLayer","removeLayersByDataId","layergroupid","vc","displayPos","lineH","offsetWidth","left","top","lineV","offsetHeight","showTooltip","removeTooltipDiv","span","shouldBind","hasAnyLayerWithValidPosition","onSliceChange","viewLayerOffsets","baseViewLayerOrigin0","baseViewLayerOrigin","hasSetOffset","scrollDiff","planeDiff","scroll","plane","refOffsets","hasSetPos","hasValidPosition","getDivToWorldSizeRatio","maxWorldSize","getMaxWorldSize","addScale","scaleStep","addTranslation","translation","reset","resetZoomPan","resetViews","isFirstViewLayer","ScrollSum","getSum","wheelDeltaY","deltaY","getSpinY","isTick","ScrollWheel","app","wheel","up","preventDefault","layerDetails","layerGroup","getLayerGroupByDivId","positionHelper","DrawShapeEditor","eventCallback","setShape","inshape","getShape","isActive","enable","getLayer","disable","resetAnchors","getParent","anchor","setAnchorsActive","anchors","getAnchors","getStyle","on","cancelBubble","mathShape","referencePoints","stageSize","changed","boundNodePosition","validateAnchorPosition","constrainAnchorMove","updateAnnotationOnAnchorMove","updateShapeGroupOnAnchorMove","addToUndoStack","moveToTop","DrawTrash","createTrashIcon","trashLine1","trashLine2","activate","invscale","changeChildrenColourOnTrashHover","eventPosition","originalShapeColour","isOverTrash","changeGroupChildrenColour","tshape","trashHalfWidth","scaleX","trashHalfHeight","scaleY","DrawShapeHandler","setEditorShape","getEditorShapeGroup","getEditorAnnotation","storeMouseOverCursor","cursor","body","onMouseOutShapeGroup","originalTextExpr","textExpr","onSaveCallback","newTextExpr","prompt","defaultOpenRoiDialog","dragStartPos","previousPos","getShapePositionRange","boundRect","getClientRect","relativeTo","isShapeInRange","children","labelWithDefaultPosition","labelPosition","child","move","updateAnnotationOnTranslation","updateLabelContent","updateConnector","mousePoint","evt","eventPos","originalLabelPosition","newLabelPosition","ERROR_MESSAGES","formatString","_match","_BrushMode","getCircleIndices","radiuses","DrawBrushCommandProperties","mask","mode","isSilent","DrawBrushCommand","properties","getOriginalValuesLists","getExecuteEvent","segNumber","segmentnumber","onExecute","undoEvent","onUndo","Brush","maskSize","maskGeometry","maskSlice","sourceGeometry","circleDims","sliceMeta","newOrigIndexRange","sorted","va","vb","z0","index0","z1","at","index1","indexStart","originStart","indexEnd","originEnd","getOriginIndexRangeFromMaskIndices","sourceOrigins","maskOrigIndexStart","maskOrigIndexEnd","indicesToAdd","originsToAdd","maskData","getData","imgK","firstSliceMeta","organizationUID","FunctionalGroupPointer","referenceSeriesTag","DicomData","getNextDataId","addData","dataConfigs","getDataViewConfigs","orient","viewConfig","ViewConfig","addDataViewConfig","render","dataUid","sourceDataUID","ids","getDataIdsFromSopUids","sourceDataId","maskViewLayers","maskDataId","savedPosition","maskVl","maskVc","sourcePosition","sourceData","sourceVl","sourceViewController","layerGroupHasDiv","scrollIndex","maskPlanePos","getOffsetsFromIndices","referenceDataId","seriesInstanceUID","mousedown","button","activateErasingEvent","deactivateErasingEvent","mousemove","diffX","diffY","mouseup","reverse","mouseout","touchstart","touchmove","touchend","maskLayers","keydown","context","onKeydown","ctrlOrAlt","ctrlKey","altKey","sizeEvent","bool","allDivIds","dataViewConfigs","viewConfigs","divIds","Set","getUniqueDataViewConfigsDivIds","stopPropagation","setFeatures","features","brushSizeRange","brushSize","brushMode","createMask","selectedSegmentNumber","blacklist","init","getEventNames","getHelpKeys","title","brief","mouse","mouse_click","touch","touch_click","Path","inputPointArray","inputControlPointIndexArray","pointArray","controlPointIndexArray","isControlPoint","addControlPoint","newPointArray","appenPath","other","oldSize","indexArray","BucketQueue","bits","cost_functor","bucketCount","loc","cost","buckets","buildArray","bucket","getBucket","ret","isEmpty","__twothirdpi","gradUnitVector","gradX","gradY","px","py","out","oy","gvm","Scissors","curPoint","searchGranBits","searchGran","pointsPerPost","greyscale","laplace","gradient","parents","working","trained","trainingPoints","edgeWidth","trainingLength","edgeGran","edgeTraining","gradPointsNeeded","gradGran","gradTraining","insideGran","insideTraining","outsideGran","outsideTraining","getTrainingIdx","granularity","getTrainedEdge","edge","getTrainedGrad","grad","getTrainedInside","inside","getTrainedOutside","outside","setWorking","setDimensions","setData","gradMagnitude","lap","computeGreyscale","computeLaplace","computeGradient","computeGradX","computeGradY","sides","guv","ix","iy","computeSides","findTrainingPoints","resetTraining","doTraining","calculateTraining","addInStaticGrad","input","output","maxVal","idx","gaussianBlur","have","need","gradDirection","qx","qy","__dgpuv","__gdquv","dp","dq","SQRT1_2","acos","adj","sx","sy","ex","ey","setPoint","sp","visited","MAX_VALUE","pq","doWork","timeout","pointCount","newPoints","adjList","q","pqCost","LabelFactory","positionGetter","getPosition","ktext","fontSize","fontFamily","padding","shadowColor","shadowOffset","labelText","setText","zoomScale","labelScale","klabel","updatePosition","getLabelAnchorsPosition","lx","ly","getClosestPoints","points1","points2","point1","point2","getConnector","connectorsPos","labelAnchorsPos","anchorPoints","dash","kconnect","updateContent","ThresholdFilter","getMin","setMin","getMax","setMax","setOriginalImage","getOriginalImage","imageMin","SharpenFilter","SobelFilter","RunFilterCommand","toolList","toolOptions","defaultToolList","pixelToIntensity","WindowLevelValues","touchPoints","dblclick","_bool","strictViewLayer","Scroll","yMove","xMove","setTimeout","clearTimeout","displayTooltip","ZoomAndPan","tx","ty","#twoTouchUpdate","lineRatio","zoom","step","_features","Opacity","op","Draw","refDataId","createAnnotationData","concept","addAndRenderAnnotationData","getIntersection","selectedShape","annotationid","getNPoints","timer","getTimeout","getActiveLayerGroup","destroy","tmpPoints","drawLayerId","Annotation","groupColour","setAnnotationMathShape","finalPoints","addMetaItem","drawLayers","setOptions","options","getOptionsType","autoShapeColour","shapeColour","shapeName","hasShape","mouseOverCursor","withScroll","refMetaValidator","drawMetaValidator","annotationGroupMeta","annotationMeta","listener","Filter","getSelectedFilter","filterName","hasFilter","args","runArgs","getFilterList","Floodfill","setExtend","getExtend","#getIndex","simple","bytes","MagicWand","cs","icsl","newMathShape","originalMathShape","extend","ini","jl","onThresholdChange","getAbsoluteScale","movedpoint","Livewire","pn","p0","results","_p","_q","defaultToolOptions","ArrowFactory","supports","setTextExpr","extras","_anchor","kline","pointBegin","pointEnd","endPoint","newBegin","newEnd","_style","linePerp0","linePerp1","hitFunc","beginPath","moveTo","lineTo","closePath","fillStrokeShape","perpLine","closed","ktriangle","_annotation","_group","CircleFactory","right","bottom","anchorPoint","newRadius","newCenter","swapX","swapY","kshadow","pixelLine","shadow","moveToBottom","EllipseFactory","ProtractorFactory","mid","pointMid","newPointList","inclination","innerRadius","outerRadius","rotation","midX","midY","karc","arcPos","RectangleFactory","topLeft","bottomRight","pointTopLeft","pointBottomRight","krect","topRight","bottomLeft","rWidth","rHeight","RoiFactory","kroi","newPoint","RulerFactory","ktick0","ktick1","Threshold","Sobel","Sharpen","referencedSopInstanceUID","referencedSopClassUID","quantification","getMetaConceptIds","getMetaItem","conceptId","removeMetaItem","currentPosition","planeHelper","cosine1","cosine2","originPoint","valueObj","valueStr","toPrecision","replaceFlags","fac","factoryName","ResponseEvaluation","CADReport","annotationGroups","responseEvaluations","comment","AnnotationGroupFactory","dwvVersion","dwvPrefix","getDwvVersionFromImplementationClassUID","isDwv034","compareMin","compareMax","isVersionInBounds","contentTemplate","rootConcept","srContent","isTid1500Template","imagingMeas","measGroup","imageRegion","nPoints","quantifName","propKey","getQuantificationName","quantifUnit","ucumKey","getQuantificationUnit","fromImage","item0","isTid1410","isTid1501","annotations","hasMeasGroup","evidenceTagKey","evidenceSq","evidences","CurrentRequestedProcedureEvidenceSequence","srType","report","createCADReport","summary","evaluations","evaluation","srImage","sopRef","imageRef","srId","srUid","shortLabel","labelPosScoord","srcImage","refPointsScoord","pointsScoord","quantifContent","conceptIds","srScoord","measContent","CompletionFlag","VerificationFlag","refSeriesSq0","refSopSq","refs","isSameRef","response","srEvalutation","srMethod","srResponse","srMeas","currentResponse","toDicomCADReport","srSummary","srComment","dataEventNames","mergeMeta","meta0","meta1","meta1Id","idKey","obj1","obj2","valueKey","idSuffix","mergedObj1","merged","id1","id2","value1","subValue1","value2","subValue2","mergeObjects","hasDuplicateOrigin","appendData","geom0","geom1","meta1IdNum","DicomSliceDataList","addClone","buildData","numberOfVolumes","volsIndices","sliceImage","volumeIndexGetter","originList","volumesIndices","volIndexValues","volumeIndex","volIndex","getEqualPosCallback","findCallback","found","DataController","getDataIds","getDataIdFromSeriesUid","referencedSeriesUID","stash","unstash","getStashedDataIds","getStashed","dataToUpdate","markDataAsComplete","imageHasChanged","finalData","binderList","WindowLevelBinder","getEventType","getCallback","viewLayers","PositionBinder","pointValues","vls","sameData","currentPos","currentDims","inputDims","ZoomBinder","OffsetBinder","OpacityBinder","ColourMapBinder","MaskViewBinder","Stage","getLayerGroup","getNumberOfLayerGroups","setActiveLayerGroup","addLayerGroup","htmlElement","withInfoOverlay","isBound","unbindLayerGroups","bindLayerGroups","setBinders","removeLayerGroup","minRatio","hasRatio","binder","binderObj","elem","State","fromJSON","json","baseScale","scaleCenter","originX","originY","oldTx","oldTy","setDrawings","drawings","drawingsDetails","v02DAndD","inputDrawings","newDrawings","drawGroups","drawGroup","lenk","lenf","newFrameDrawings","leng","karcs","ktexts","toObject","txtLen","longText","v01Tov02DrawingsAndDetails","v02Tov03Drawings","v03Tov04DrawingsDetails","v04Tov05Data","v04Tov05Drawings","groupDetails","v02Tov03DrawingsDetails","groupShapes","parentGroup","groupDrawings","gnode","attrs","sliceNumber","newId","getUrlFromUri","uri","base","splitUri","sepIndex","hashIndex","query","pairs","pair","splitKeyValueString","getUriQuery","getURLsFromKeyValueUri","urls","decodeKeyValueUri","dwvReplaceMode","handleURLsFromWeasisXMLManifest","decodeWeasisXMLManifest","replaceMode","repeatKeyReplaceMode","queryUri","decodeURIComponent","inputQueryPairs","repeatKey","repeatList","baseUrl","gotOneArg","manifestUri","protocol","host","request","XMLHttpRequest","open","responseType","onload","manifest","rootURL","getElementsByTagName","getAttribute","patientList","studyList","studyUID","seriesList","seriesUID","instanceList","link","parseWeasisXMLManifest","responseXML","status","send","ToolboxController","enableShortcuts","getToolList","hasTool","getSelectedTool","getSelectedToolEventHandler","eventType","setSelectedTool","setToolFeatures","bindLayerGroup","layerGroupDivId","applySelectedTool","MultiProgressHandler","setNumberOfDimensions","num","setNToLoad","onprogress","lengthComputable","subindex","percent","loaded","total","lenprog","getMonoProgressHandler","getUndefinedMonoProgressHandler","UrlsLoader","loader","onloadend","load","onloadstart","responseURL","statusText","mproghandler","loaders","loaderList","foundLoader","canLoadUrl","defaultCharacterSet","onloaditem","lastRunRequestIndex","requestOnLoadEnd","requestHeaders","setRequestHeader","withCredentials","errorCallback","timeoutCallback","ontimeout","abortCallback","loadUrlAs","batchSize","dicomDirUrl","parser","dirRecSqElement","dirSeq","records","series","study","dirRecTypeElement","recType","refFileIdElement","refFileIds","getDicomDirFileList","getFileListFromDicomDir","rootUrl","fullUrls","readyState","isLoading","JpegBaselineWorkerTask","JpegLosslessWorkerTask","Jpeg2000WorkerTask","RleWorkerTask","PixelBufferDecoder","algoName","pixelMeta","ondecodestart","ondecodeditem","ondecoded","ondecodeend","DicomBufferToData","opt","dataIndex","missing","decodedData","fullSize","convert","dicomParser","pixelDataElement","rawBuffer","algo","getSyntaxDecompressionName","MemoryLoader","canLoadMemory","filename","toUID","imageDataToBuffer","imageData","dataLen","getDefaultImage","canLoadFile","file","forceLoader","isNameAccept","acceptHeader","acceptValue","urlObjext","pathname","hasNoExt","hasDcmExt","contentType","searchParams","mem","tmpFile","File","loadFileAs","fileContentTypes","_opt","Text","memoryIO","progress","u8Array","partHeaderEndCb","partHeaderEndIndex","lines","boundaryStr","boundaryCb","boundaryLen","nextBoundaryIndex","part","partHeaderLines","semiColonIndex","dataBeginIndex","dataEndIndex","parseMultipart","_file","_mem","dataType","imageType","Blob","createObjectURL","domImage","canvas","ctx","lastModified","getViewFromDOMImage","src","hasImageExt","DataURL","videoDataStr","btoa","video","onloadedmetadata","videoWidth","videoHeight","duration","onseeked","imgBuffer","storeFrame","nextTime","currentTime","getViewFromDOMVideo","unzipPercent","async","then","JSZip","zip","FilesLoader","FileReader","readAsText","readAsDataURL","readAsArrayBuffer","LoadController","loadFiles","files","loadURLs","loadImageObject","getLoadingDataIds","fileIO","urlIO","loadType","eventInfo","loadtype","isFirstItem","eventInfoItem","isfirstitem","InfoDataItem","getNumberToPrecision","createDefaultReplaceFormat","InfoData","configs","modalityConfig","addAppListeners","addItemMeta","datas","modElement","modalityConfigs","dataItem","da","toLocaleDateString","toLocaleTimeString","poElement","po0","po1","createInfoData","domElements","domConfigs","DOM","domConfig","createInfoDataForDom","sliceInfoData","infoDataItem","mapFunc","isListening","removeAppListeners","fillOpacity","contourThickness","wlPresetName","ToolConfig","AppOptions","tools","binders","viewOnFirstLoadItem","overlayConfig","rootDocument","App","getMetaData","getToolboxController","removeFromUndoStack","appToolList","toolName","toolClass","toolParams","appToolOptions","optionName","optionClassName","toolNamespace","charAt","optionClass","tOptions","resetLayout","loadFromUri","decodeQuery","abortAllLoads","abortLoad","initWLDisplay","getViewConfigs","excludeStarConfig","getViewConfig","setDataViewConfigs","doRender","removeDataViewConfig","itemIndex","dls","updateDataViewConfig","configToUpdate","dataKeys","getElementById","setLayerGroupsBinders","instances","baseViewLayer","baseImage","baseOrientation","isImage","isMeasurement","translate","resampleMatch","dataIdTarget","dataIdSource","targetData","metaTarget","dataIds","newDataIds","revertResample","refData","statePosGroups","statePosGroup","statePosKids","lenj","posGroupIndex","stateGroup","pointsArray","absPosition","absolutePosition","konvaToAnnotation","applyJsonState","jsonState","state","onResize","defaultOnKeydown","shiftKey","resetDisplay","resetZoom","setTool","tool","getInfoData","toggleInfoDataListeners","refMeta","tagsToCopy","refDataViewConfig","drawDataViewConfig","eventMetaData","isFirstLoadItem","groupId","isBaseLayer","flipFlags","refViewLayer","evidenceSeq","evidenceSeqItem0","refSeriesSeq","refSeriesSeqItem0","refSeriesInstanceUID","metaSearch","refViewController","viewConfigOrientation","orientationCode","isViewUndefined","isViewAxial","isViewCoronal","isViewSagittal","flipOffset","flipScale","MaskSegmentHelper","getMask","hasSegment","getNumberOfSegments","maskHasSegments","numbers","unknowns","addSegment","removeSegment","updateSegment","findOverlap","thisGeometry","thisSize","compareMask","compareGeometry","compareSize","overlap","thisTotalSize","thisValue","thisSegment","thisIndex","thisWorld","compareIndex","compareOffset","compareValue","compareSegment","percentage","thisOverlap","overlapCount","DeleteSegmentCommand","isValid","ChangeSegmentColourCommand","newColour","Diameter","offset1","offset2","Diameters","Label","largestSliceZ","Scalar2D","Scalar3D","Value"],"ignoreList":[],"sourceRoot":""}